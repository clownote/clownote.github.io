<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>å¼‚æ­¥ç¼–ç¨‹ä¸Combine</title>
      <link href="/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/"/>
      <url>/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/</url>
      
        <content type="html"><![CDATA[<h1 id="å¼‚æ­¥ç¼–ç¨‹ä¸-Combine"><a href="#å¼‚æ­¥ç¼–ç¨‹ä¸-Combine" class="headerlink" title="å¼‚æ­¥ç¼–ç¨‹ä¸ Combine"></a>å¼‚æ­¥ç¼–ç¨‹ä¸ Combine</h1><h2 id="å¼‚æ­¥ç¼–ç¨‹"><a href="#å¼‚æ­¥ç¼–ç¨‹" class="headerlink" title="å¼‚æ­¥ç¼–ç¨‹"></a>å¼‚æ­¥ç¼–ç¨‹</h2><p><img src="AsyncProgrammingAndCombine/asynchronous.png" alt="asynchronous"></p><h2 id="Combine"><a href="#Combine" class="headerlink" title="Combine"></a>Combine</h2><p><strong><a href="https://developer.apple.com/documentation/combine">Combine</a></strong>: Customize handling of asynchronous events by combining event-processing operators.</p><p><img src="AsyncProgrammingAndCombine/Combine.png" alt="Combine"></p><h3 id="Publisher"><a href="#Publisher" class="headerlink" title="Publisher"></a>Publisher</h3><p>Publisher è´Ÿè´£å‘å¸ƒäº‹ä»¶ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">Publisher</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// è¦å‘å¸ƒçš„å€¼ç±»å‹</span></span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">Output</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// å¯èƒ½å‘å¸ƒçš„é”™è¯¯ç±»å‹</span></span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">Failure</span> : <span class="type">Error</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// è¿æ¥è®¢é˜…è€…ï¼Œè¿ä¸Šå subscriber å°±å¯ä»¥ä» Publisher æ¥æ”¶äº†</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">receive</span>&lt;S&gt;<span class="params">(subscriber: S)</span></span> <span class="keyword">where</span> </span><br><span class="line">        <span class="type">S</span> : <span class="type">Subscriber</span>, </span><br><span class="line">        <span class="keyword">Self</span>.<span class="type">Failure</span> <span class="operator">==</span> <span class="type">S</span>.<span class="type">Failure</span>, </span><br><span class="line">        <span class="keyword">Self</span>.<span class="type">Output</span> <span class="operator">==</span> <span class="type">S</span>.<span class="type">Input</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Publisher å¯ä»¥å‘å¸ƒä¸‰ç§äº‹ä»¶:</p><ul><li>outputï¼šäº‹ä»¶æµä¸­å‘å¸ƒæ–°çš„å€¼ï¼Œç±»å‹ä¸º Outputï¼›</li><li>failureï¼šå‘ç”Ÿé”™è¯¯ï¼Œäº‹ä»¶æµç»ˆæ­¢ï¼Œç±»å‹ä¸º Failureï¼› (<code>.failure(e)</code>).</li><li>finishedï¼šäº‹ä»¶æµç»“æŸï¼› (<code>.finished</code>)</li></ul><h3 id="Operator"><a href="#Operator" class="headerlink" title="Operator"></a>Operator</h3><h4 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h4><p> Publisher çš„ <code>scan</code> æ–¹æ³•æä¾›ä¸€ä¸ªæš‚å­˜å€¼ï¼Œæ¯æ¬¡äº‹ä»¶å‘ç”Ÿæ—¶æ‰§è¡Œä¸€ä¸ªé—­åŒ…æ¥æ›´æ–°è¿™ä¸ªæš‚å­˜å€¼ï¼Œå¹¶å‡†å¤‡å¥½åœ¨ä¸‹ä¸€æ¬¡äº‹ä»¶æ—¶ä½¿ç”¨å®ƒã€‚è¿™ä¸ªæš‚å­˜å€¼ä¹Ÿå°†è¢«ä½œä¸ºæ–°çš„ Publisher äº‹ä»¶è¢«å‘é€å‡ºå»ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">scan</span>&lt;T&gt;<span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">_</span> initialResult: T, </span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">_</span> nextPartialResult: <span class="params">(T, <span class="keyword">Self</span>.Output)</span></span></span> -&gt; <span class="type">T</span>) </span><br><span class="line">-&gt; <span class="type">Publishers</span>.<span class="type">Scan</span>&lt;<span class="keyword">Self</span>, <span class="type">T</span>&gt;</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> foo: <span class="type">AnyPublisher</span>&lt;<span class="type">Void</span>, <span class="type">Never</span>&gt;</span><br><span class="line"><span class="keyword">let</span> fooCounter <span class="operator">=</span> foo.scan(<span class="number">0</span>) &#123; value, <span class="keyword">_</span> <span class="keyword">in</span> value <span class="operator">+</span> <span class="number">1</span> &#125;</span><br></pre></td></tr></table></figure><ul><li><code>foo</code> å‘å‡º E, E, E, â€¦</li><li><code>fooCounter</code> å‘å‡º 1, 2, 3, â€¦</li></ul><h4 id="map"><a href="#map" class="headerlink" title="map"></a>map</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">map</span>&lt;T&gt;<span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">_</span> transform: <span class="params">(<span class="keyword">Self</span>.Output)</span></span></span> -&gt; <span class="type">T</span>) </span><br><span class="line">-&gt; <span class="type">Publishers</span>.<span class="type">Map</span>&lt;<span class="keyword">Self</span>, <span class="type">T</span>&gt;</span><br></pre></td></tr></table></figure><p>map ä¹Ÿæ˜¯è¿”å›ä¸€ä¸ªæ–°çš„ Publisherï¼Œé€šè¿‡ä¸€ä¸ªé—­åŒ…æ¥è½¬åŒ–åŸæ¥çš„ Publisher çš„ç»“æœã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fooCounterStr <span class="operator">=</span> foo</span><br><span class="line">    .scan(<span class="number">0</span>) &#123; value, <span class="keyword">_</span> <span class="keyword">in</span> value <span class="operator">+</span> <span class="number">1</span> &#125;</span><br><span class="line">    .map&#123; <span class="type">String</span>(<span class="variable">$0</span>) &#125;</span><br></pre></td></tr></table></figure><ul><li><code>foo</code> å‘å‡º E, E, E, â€¦</li><li><code>fooCounterStr</code> å‘å‡º â€œ1â€, â€œ2â€, â€œ3â€, â€¦</li></ul><p>ç±»ä¼¼çš„è¿˜æœ‰å¾ˆå¤šå•¦ï¼Œå¤§æŠµéƒ½æ˜¯ç”¨è¿™ç§å‡½æ•°å¼çš„å½¢å¼ï¼Œæ¥å¯¹åŸæœ‰çš„ Publisher è¿›è¡Œå˜å½¢ç­‰é€»è¾‘æ“ä½œã€‚è¿™äº›æ“ä½œå°±æ‰®æ¼”äº† Operator çš„è§’è‰²ã€‚</p><p>æ¯ä¸ª Operator éƒ½ä½¿ç”¨ä¸Šæ¸¸ Publisher æ‰€å‘å¸ƒçš„æ•°æ®ä½œä¸ºè¾“å…¥ï¼Œ ä»¥æ­¤äº§ç”Ÿçš„æ–°çš„æ•°æ®ï¼Œç„¶åè‡ªèº«æˆä¸ºæ–°çš„ Publisherï¼Œå¹¶å°†æ–°çš„æ•°æ®ä½œä¸ºè¾“å‡ºï¼Œ å‘å¸ƒç»™ä¸‹æ¸¸ã€‚</p><p>é€šè¿‡ä¸€ç³»åˆ—ç»„åˆï¼ˆCombineï¼‰ï¼Œå°±å¾—åˆ°äº†ä¸€ä¸ª Publisher çš„é“¾æ¡ã€‚é¦–éƒ¨æ˜¯å‘ç”Ÿçš„äº‹ä»¶ï¼Œä¸­é—´å¯¹äº‹ä»¶è¿›è¡Œå˜å½¢å¤„ç†ï¼Œæœ«å°¾å°±å¾—åˆ°äº†å¯ä»¥ç›´æ¥ä¾›ç»™ Subscriber æ¶ˆè´¹ã€‚</p><h3 id="Subscriber"><a href="#Subscriber" class="headerlink" title="Subscriber"></a>Subscriber</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">Subscriber</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// è¦æ¥æ”¶çš„å€¼çš„ç±»å‹</span></span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">Input</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// å¯èƒ½æ¥æ”¶çš„é”™è¯¯ç±»å‹</span></span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">Failure</span> : <span class="type">Error</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// å‘Šè¯‰ subscriber æˆåŠŸè®¢é˜…äº† publisherï¼Œå¯ä»¥æ¥æ”¶äº†</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">receive</span><span class="params">(subscription: Subscription)</span></span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">receive</span><span class="params">(<span class="keyword">_</span> input: <span class="keyword">Self</span>.Input)</span></span> -&gt; <span class="type">Subscribers</span>.<span class="type">Demand</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">receive</span><span class="params">(completion: Subscribers.Completion&lt;<span class="keyword">Self</span>.Failure&gt;)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Combine é‡Œé¢ä¹Ÿå·²ç»æä¾›äº†ä¸€äº›å¸¸ç”¨çš„ Subscriber äº†ï¼Œä¾‹å¦‚ <code>Sink</code> å’Œ <code>Assign</code>ã€‚</p><h4 id="Sink"><a href="#Sink" class="headerlink" title="Sink"></a>Sink</h4><p>Sink æ˜¯ä¸ªé€šè¿‡é—­åŒ…å»å¤„ç†æ¥æ”¶åˆ°çš„å€¼çš„ Subscriberã€‚</p><p>è°ƒç”¨ <code>sink</code> æ–¹æ³•ï¼Œå¯ä»¥æŠŠ Sink Subscriber åŠ åˆ° Publisher çš„é“¾æ¡æœ«ç«¯ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">sink</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    receiveCompletion: <span class="params">(<span class="params">(Subscribers.Completion&lt;<span class="keyword">Self</span>.Failure&gt;)</span></span></span></span> -&gt; <span class="type">Void</span>), </span><br><span class="line">    receiveValue: ((<span class="keyword">Self</span>.<span class="type">Output</span>) -&gt; <span class="type">Void</span>)) </span><br><span class="line">-&gt; <span class="type">AnyCancellable</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡ç»™ sink çš„é—­åŒ…ï¼Œå°±å¯¹æ‹¿åˆ°çš„äº‹ä»¶å¯ä»¥æ‰§è¡Œä»»æ„æ“ä½œã€‚å¯ä»¥ç”¨ Sink ç»“æŸå“åº”å‡½æ•°å¼çš„ Publisher é“¾ï¼Œæœ€ç»ˆæ¡¥æ¥åˆ°åŸºäºé—­åŒ…çš„æŒ‡ä»¤å¼ä»£ç ã€‚</p><p>e.g.</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> foo <span class="operator">=</span> (<span class="number">0</span> <span class="operator">...</span> <span class="number">5</span>).publisher.map &#123; <span class="keyword">_</span> <span class="keyword">in</span> &#125;</span><br><span class="line"></span><br><span class="line">foo</span><br><span class="line">    .scan(<span class="number">0</span>) &#123; value, <span class="keyword">_</span> <span class="keyword">in</span> value <span class="operator">+</span> <span class="number">1</span> &#125;</span><br><span class="line">    .map &#123; <span class="type">String</span>(<span class="variable">$0</span>) &#125;</span><br><span class="line">    .sink &#123; <span class="built_in">print</span>(<span class="string">&quot;foo count: <span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>) &#125;</span><br></pre></td></tr></table></figure><h4 id="Assign"><a href="#Assign" class="headerlink" title="Assign"></a>Assign</h4><p>Assignï¼Œå¦‚å…¶åï¼Œå°±æ˜¯ä¸ªä¸“æ³¨äºèµ‹å€¼çš„ Subscriberã€‚<code>assign</code> æ¥å—ä¸€ä¸ªæŸ class çš„å®ä¾‹ä»¥åŠå¯¹è±¡ç±»å‹ä¸Šçš„æŸä¸ªé”®è·¯å¾„ (<code>\.name</code>)ã€‚å½“ output äº‹ä»¶åˆ°æ¥æ—¶ï¼Œå…¶ä¸­åŒ…å«çš„å€¼å°±å°†è¢«è®¾ç½®åˆ°å¯¹åº”çš„å±æ€§ä¸Šå»:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bar</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> count: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> bar <span class="operator">=</span> <span class="type">Bar</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> foo <span class="operator">=</span> (<span class="number">0</span> <span class="operator">...</span> <span class="number">5</span>).publisher.map &#123; <span class="keyword">_</span> <span class="keyword">in</span> &#125;</span><br><span class="line"></span><br><span class="line">foo</span><br><span class="line">    .scan(<span class="number">0</span>) &#123; value, <span class="keyword">_</span> <span class="keyword">in</span> value <span class="operator">+</span> <span class="number">1</span> &#125;</span><br><span class="line">    .map &#123; <span class="type">String</span>(<span class="variable">$0</span>) &#125;</span><br><span class="line">    .assign(to: \.count, on: bar)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(bar.count)  # output: <span class="number">6</span></span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–è§’è‰²"><a href="#å…¶ä»–è§’è‰²" class="headerlink" title="å…¶ä»–è§’è‰²"></a>å…¶ä»–è§’è‰²</h2><h3 id="Subject"><a href="#Subject" class="headerlink" title="Subject"></a>Subject</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">Subject</span> : <span class="title">AnyObject</span>, <span class="title">Publisher</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// Sends a value to the subscriber.</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">send</span><span class="params">(<span class="keyword">_</span> value: <span class="keyword">Self</span>.Output)</span></span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Sends a completion signal (`.failure(e)` or `.finished`)</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">send</span><span class="params">(completion: Subscribers.Completion&lt;<span class="keyword">Self</span>.Failure&gt;)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Subject</code> æ˜¯ç”¨æ¥ç»™å¤–éƒ¨è°ƒç”¨è€…é€šè¿‡ send æ–¹æ³•æ¥å‘å¸ƒ output å€¼ã€failure æˆ– finished äº‹ä»¶çš„ã€‚</p><p>å’Œ Sink åˆšå¥½ç›¸åï¼ŒSubject å¯ä»¥å®Œæˆâ€œæŒ‡ä»¤å¼ -&gt; å“åº”å¼â€ã€‚</p><h4 id="PassthroughSubject"><a href="#PassthroughSubject" class="headerlink" title="PassthroughSubject"></a>PassthroughSubject</h4><p><code>PassthroughSubject</code> æ˜¯ Combine ä¸­çš„ä¸€ç§ Subject å…·ä½“å®ç°ã€‚PassthroughSubject å°† send æ¥æ”¶åˆ°çš„äº‹ä»¶è½¬å‘ç»™ä¸‹æ¸¸ã€‚æ¥æ”¶åˆ°æ‰è½¬å‘ï¼Œæ²¡æ¥æ”¶åˆ°å°±é—²ç€ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mySubject <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">Int</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"></span><br><span class="line">mySubject.send(<span class="number">123</span>)  <span class="comment">// æ²¡äººç›‘å¬ï¼Œä¸¢å¤±äº†</span></span><br><span class="line"></span><br><span class="line">mySubject.sink(</span><br><span class="line">    receiveCompletion: &#123; <span class="built_in">print</span>(<span class="string">&quot;complete: <span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>) &#125;,</span><br><span class="line">    receiveValue: &#123; <span class="built_in">print</span>(<span class="string">&quot;value: <span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>)&#125;</span><br><span class="line">)  <span class="comment">// å¼€å§‹ç›‘å¬</span></span><br><span class="line"></span><br><span class="line">mySubject.send(<span class="number">666</span>)</span><br><span class="line">mySubject.send(completion: .finished)</span><br></pre></td></tr></table></figure><p>è¿è¡Œè¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">value: 666</span><br><span class="line">complete: finished</span><br></pre></td></tr></table></figure><h4 id="CurrentValueSubject"><a href="#CurrentValueSubject" class="headerlink" title="CurrentValueSubject"></a>CurrentValueSubject</h4><p><code>CurrentValueSubject</code> ç›¸å½“äºæ˜¯ä¸ªå¸¦äº†ç¼“å†²çš„ PassthroughSubjectã€‚åœ¨è®¢é˜…å‘ç”Ÿçš„ç¬é—´ï¼ŒCurrentValueSubject ä¼šæŠŠå½“å‰ä¿å­˜çš„å€¼å‘é€ç»™è®¢é˜…è€…ï¼Œä¹‹åçš„è¡Œä¸ºå°±å’Œ PassthroughSubject ç›¸åŒäº†ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¯ä»¥ç¼“å†²ä¸€ä¸ªå€¼ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> anotherSubject <span class="operator">=</span> <span class="type">CurrentValueSubject</span>&lt;<span class="type">Int</span>, <span class="type">Never</span>&gt;(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// anotherSubject.send(2048)</span></span><br><span class="line"><span class="comment">// anotherSubject.send(4096)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å¼€å§‹ç›‘å¬&quot;</span>)</span><br><span class="line">anotherSubject.sink(</span><br><span class="line">    receiveCompletion: &#123; <span class="built_in">print</span>(<span class="string">&quot;complete: <span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>) &#125;,</span><br><span class="line">    receiveValue: &#123; <span class="built_in">print</span>(<span class="string">&quot;value: <span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>)&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">anotherSubject.send(<span class="number">8192</span>)</span><br><span class="line">anotherSubject.send(<span class="number">16384</span>)</span><br><span class="line">anotherSubject.send(completion: .finished)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å¼€å§‹ç›‘å¬</span><br><span class="line">value: 1024</span><br><span class="line">value: 8192</span><br><span class="line">value: 16384</span><br><span class="line">complete: finished</span><br></pre></td></tr></table></figure><p>æŠŠä¸Šé¢çš„ä¸¤è¡Œæ³¨é‡Šå–æ¶ˆï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="operator">...</span></span><br><span class="line"></span><br><span class="line">anotherSubject.send(<span class="number">2048</span>)</span><br><span class="line">anotherSubject.send(<span class="number">4096</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;å¼€å§‹ç›‘å¬&quot;</span>)</span><br><span class="line"><span class="operator">...</span></span><br></pre></td></tr></table></figure><p>åˆ™è¾“å‡ºï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å¼€å§‹ç›‘å¬</span><br><span class="line">value: <span class="number">4096</span></span><br><span class="line">value: <span class="number">8192</span></span><br><span class="line">value: <span class="number">16384</span></span><br><span class="line">complete: finished</span><br></pre></td></tr></table></figure><h3 id="Scheduler"><a href="#Scheduler" class="headerlink" title="Scheduler"></a>Scheduler</h3><ul><li><code>Publisher</code>ï¼šå†³å®šå‘å¸ƒä»€ä¹ˆäº‹ä»¶æµ (what)ï¼›</li><li><code>Scheduler</code>ï¼šå†³å®šåœ¨ä»€ä¹ˆåœ°æ–¹ (where)ã€ä»€ä¹ˆæ—¶å€™ (when) å‘å¸ƒäº‹ä»¶å’Œæ‰§è¡Œä»£ç ï¼›</li></ul><h4 id="where"><a href="#where" class="headerlink" title="where"></a>where</h4><p>åœ¨ç½‘ç»œè¯·æ±‚ä¹‹åï¼Œå“åº”æ˜¯åœ¨åå°çº¿ç¨‹çš„ï¼Œç”¨ç”¨è¯·æ±‚çš„ç»“æœæ›´æ–° UIï¼Œå°±éœ€è¦è½¬åˆ°ä¸»çº¿ç¨‹ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">URLSession</span>.shared</span><br><span class="line">    .dataTaskPublisher(<span class="keyword">for</span>: <span class="type">URL</span>(string: <span class="string">&quot;https://example.com&quot;</span>)<span class="operator">!</span>)</span><br><span class="line">    .compactMap &#123; <span class="type">String</span>(data: <span class="variable">$0</span>.data, encoding: .utf8) &#125;</span><br><span class="line">    .receive(on: <span class="type">RunLoop</span>.main)  <span class="comment">// Scheduler here</span></span><br><span class="line">    .sink(</span><br><span class="line">        receiveCompletion: &#123; <span class="keyword">_</span> <span class="keyword">in</span> &#125;, </span><br><span class="line">        receiveValue: &#123; textView.text <span class="operator">=</span> <span class="variable">$0</span> &#125;</span><br><span class="line">     )</span><br></pre></td></tr></table></figure><p><code>RunLoop</code> å°±æ˜¯å®ç°äº† Scheduler åè®®çš„ç±»å‹ã€‚<code>receive(on: RunLoop.main) </code> æŠŠæ¥æ”¶ä»åå°çº¿ç¨‹è½¬åˆ°ä¸»çº¿ç¨‹ï¼Œä»¥æ›´æ–° UIã€‚</p><h4 id="when"><a href="#when" class="headerlink" title="when"></a>when</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒPublisher ä¼šå°½é‡åŠæ—¶æŠŠäº‹ä»¶ä¼ é€’ç»™ä¸‹æ¸¸ã€‚ä½†å¯ä»¥ç”¨ Scheduler åŠ å…¥å»¶è¿Ÿã€‚</p><ul><li><code>delay</code>ï¼šå°†äº‹ä»¶é€ä¸€å»¶åä¸€å®šæ—¶é—´</li></ul><p><img src="AsyncProgrammingAndCombine/delay.png" alt="delayæ“ä½œçš„æ—¶åºè¡¨ç¤º"></p><ul><li><code>debounce</code>ï¼šå»¶è¿Ÿæ‰€æœ‰äº‹ä»¶ï¼Œç›´åˆ°åœ¨ä¸€å®šæ—¶é—´é‡Œæ²¡æœ‰æ–°çš„äº‹ä»¶åˆ°æ¥ï¼Œæ‰å‘ç”Ÿæœ€åä¸€æ¬¡äº‹ä»¶çš„å€¼ã€‚</li></ul><p><img src="AsyncProgrammingAndCombine/debounce.png" alt="debounce æ“ä½œçš„æ—¶åºè¡¨ç¤º"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>[1] ç‹å·ã€ŠSwiftUIä¸Combineç¼–ç¨‹ã€‹ch5</p>]]></content>
      
      
      
        <tags>
            
            <tag> SwiftUI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”¨GitHub Actionsè‡ªåŠ¨æ‰“åŒ…å‘å¸ƒPythoné¡¹ç›®</title>
      <link href="/2021/01/16/blog/PyPiGitHubActions/"/>
      <url>/2021/01/16/blog/PyPiGitHubActions/</url>
      
        <content type="html"><![CDATA[<h1 id="ç”¨-GitHub-Actions-è‡ªåŠ¨æ‰“åŒ…å‘å¸ƒ-Python-é¡¹ç›®"><a href="#ç”¨-GitHub-Actions-è‡ªåŠ¨æ‰“åŒ…å‘å¸ƒ-Python-é¡¹ç›®" class="headerlink" title="ç”¨ GitHub Actions è‡ªåŠ¨æ‰“åŒ…å‘å¸ƒ Python é¡¹ç›®"></a>ç”¨ GitHub Actions è‡ªåŠ¨æ‰“åŒ…å‘å¸ƒ Python é¡¹ç›®</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿˜åœ¨æ‰‹åŠ¨æ‰“åŒ…ä¸Šä¼  PyPIï¼ŸGitHub Actions è‡ªåŠ¨åŒ–çœŸé¦™ï½ï¼</p><p>åœ¨ã€Š<a href="https://blog.csdn.net/u012419550/article/details/109258117">Python ä»£ç ä¸€é”®è½¬æµç¨‹å›¾</a>ã€‹ä¸€æ–‡é‡Œï¼Œæˆ‘ä»‹ç»äº†æˆ‘çš„å¼€æºé¡¹ç›® <a href="https://github.com/cdfmlr/pyflowchart">PyFlowchart</a>ã€‚è¿‡å»è¿™æ®µæ—¶é—´é‡Œï¼Œå·²ç»æœ‰å¥½å‡ ä½å°ä¼™ä¼´ä¸ºè¿™ä¸ªé¡¹ç›®æå‡ºäº†å»ºè®®ï¼Œæˆ–è€…æŠ¥å‘Šäº† Bug å•¦ã€‚åœ¨è¿™å‡ ä½æœ‹å‹çš„å¸®åŠ©ä¸‹ï¼Œé¡¹ç›®ä¹Ÿè¿­ä»£äº†å‡ ä¸ªç‰ˆæœ¬äº†ã€‚ä¹‹å‰ï¼Œè¿™ä¸ªé¡¹ç›®æ¯æ¬¡ç‰ˆæœ¬æ›´æ–°ï¼Œæˆ‘éƒ½éœ€è¦åšå¾ˆå¤šå†™ä»£ç æ„å¤–çš„éº»çƒ¦å·¥ä½œï¼š</p><ol><li>åœ¨ GitHub ä¸Š publish ä¸€ä¸ª releaseï¼Œ</li><li>æ‰‹åŠ¨æ‰“åŒ…ä¸Šä¼  PyPIã€‚</li></ol><p>è¿™ä¸ªè¿‡ç¨‹éå¸¸åäººç±»ï¼Œrelease ä¸€ä¸ªç‰ˆæœ¬è¦åšä¸¤ä¸ªå·¥ä½œã€‚æ›´å¯æ€•çš„æ˜¯ï¼Œæ‰“åŒ…ä¸Šä¼  PyPI çš„å·¥ä½œååˆ†æ¨¡ç‰ˆåŒ–ï¼ˆé„™äººæ‹™ä½œã€Š<a href="https://blog.csdn.net/u012419550/article/details/105967006">å¦‚ä½•ç”¨ pip å®‰è£…è‡ªå·±å†™çš„åŒ…</a>ã€‹ä¸€æ–‡ä»‹ç»äº†è¿™ä¸ªè¿‡ç¨‹ï¼‰ã€‚æˆ‘è§‰å¾—ä½œä¸ºå¼€å‘è€…ï¼Œä¸åº”è¯¥æŠŠæ—¶é—´æµªè´¹åœ¨è¿™ç§å¥—è·¯å·¥ä½œä¸Šã€‚</p><p>äºæ˜¯æˆ‘æƒ³å»äº†è¿‡å»æˆ‘å†™è¿‡ä¸€ç¯‡å«åšã€Š<a href="https://blog.csdn.net/u012419550/article/details/107594751">è¿˜åœ¨æ‰‹åŠ¨å‘åšå®¢ï¼ŸGitHub Actionsè‡ªåŠ¨åŒ–çœŸé¦™</a>ã€‹çš„æ–‡ç« ï¼Œå¤§è‡´ä»‹ç»äº†æˆ‘æ˜¯å¦‚ä½•åˆ©ç”¨ GitHub Actions è‡ªåŠ¨æ›´æ–°åšå®¢ç½‘ç«™çš„ã€‚æ‰€ä»¥ï¼Œä»Šå›ï¼Œæˆ‘å°è¯•ç”¨ GitHub Actions æ­å»ºäº†ä¸€å¥—å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶ï¼Œè‡ªåŠ¨æ‰“åŒ…ä¸Šä¼  PyPI ğŸ“¦ çš„å·¥ä½œæµç¨‹ã€‚</p><p>ç°åœ¨ï¼Œå‘å¸ƒæ–°çš„ç‰ˆæœ¬æ—¶ï¼Œå°±åªéœ€åœ¨ GitHub ä¸Šæ–°å»ºä¸€ä¸ª Releaseã€‚GitHub Actions ä¼šè‡ªåŠ¨å¸®æˆ‘å®Œæˆæ„å»ºã€æ‰“åŒ…ã€ä¸Šä¼  PyPI çš„å·¥ä½œã€‚</p><p>æœ¬æ–‡å°±ä»‹ç»å¦‚ä½•åˆ©ç”¨ GitHub Actions è‡ªåŠ¨å‘å¸ƒ Python åŒ…åˆ° PyPIã€‚</p><p>ï¼ˆæ³¨ï¼šæˆ‘åœ¨ PyFlowchart é¡¹ç›®ä¸­ä½¿ç”¨çš„å®ç°å’Œä¸‹æ–‡ç•¥æœ‰ä¸åŒï¼Œæˆ‘æ ¹æ®éœ€æ±‚åšäº†ä¸€äº›ä¿®æ”¹ï¼Œå¦‚æœä½ æ„Ÿå…´è¶£ï¼Œå¯ä»¥çœ‹ä¸€çœ‹æˆ‘çš„å®ç°ï¼š<a href="https://github.com/cdfmlr/pyflowchart/tree/master/.github/workflows%EF%BC%89">https://github.com/cdfmlr/pyflowchart/tree/master/.github/workflowsï¼‰</a></p><hr><blockquote><p>ä¸‹æ–‡ç¿»è¯‘è‡ª PyPA çš„æ–‡ç« ã€ŠPublishing package distribution releases using GitHub Actions CI/CD workflowsã€‹</p><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://packaging.python.org/guides/publishing-package-distribution-releases-using-github-actions-ci-cd-workflows/">https://packaging.python.org/guides/publishing-package-distribution-releases-using-github-actions-ci-cd-workflows/</a></p></blockquote><p><a href="https://github.com/features/actions">GitHub Actions CI/CD</a> å…è®¸åœ¨ GitHub å¹³å°ä¸Šç‰¹å®šçš„äº‹ä»¶å‘ç”Ÿæ—¶è‡ªåŠ¨è¿è¡Œä¸€ç³»åˆ—çš„å‘½ä»¤ã€‚ç”¨è¿™ä¸ªå°±å¯ä»¥åšè®¾ç½®ä¸€ä¸ªå“åº” push äº‹ä»¶çš„å·¥ä½œæµç¨‹ã€‚æœ¬æ–‡å°†å±•ç¤ºå¦‚ä½•å½“æœ‰ git push æ—¶å‘å¸ƒä¸€ä¸ªæ–°çš„ Python åŒ…å‘è¡Œç‰ˆï¼ˆåˆ° PyPIï¼‰ã€‚æˆ‘ä»¬å°†ä½¿ç”¨åˆ° <a href="https://github.com/marketplace/actions/pypi-publish">pypa/gh-action-pypi-publish GitHub Action</a>ã€‚</p><p>æ³¨æ„ï¼šè¿™ä¸ªæ•™ç¨‹å‡è®¾ä½ å·²ç»æœ‰åœ¨ GitHub ä¸Šæœ‰ä¸€ä¸ª Python é¡¹ç›®ï¼Œå¹¶ä¸”ä½ çŸ¥é“å¦‚ä½•æ„å»ºåŒ…ï¼Œå¹¶æŠŠå®ƒå‘å¸ƒåˆ° PyPIã€‚</p><h2 id="åœ¨-GitHub-ä¸Šä¿å­˜-token"><a href="#åœ¨-GitHub-ä¸Šä¿å­˜-token" class="headerlink" title="åœ¨ GitHub ä¸Šä¿å­˜ token"></a>åœ¨ GitHub ä¸Šä¿å­˜ token</h2><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä¼šæŠŠé¡¹ç›®ä¸Šä¼ åˆ° PyPI å’Œ TestPyPIã€‚æ‰€ä»¥éœ€è¦ç”Ÿæˆä¸¤ä»½ç‹¬ç«‹çš„ tokenï¼Œå¹¶æŠŠå®ƒä»¬ä¿å­˜åˆ° GitHub çš„ä»“åº“è®¾ç½®ä¸­ã€‚</p><p>æˆ‘ä»¬å¼€å§‹å§ï¼ğŸš€</p><ol><li>è®¿é—® <a href="https://pypi.org/manage/account/#api-tokens">https://pypi.org/manage/account/#api-tokens</a> ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ <a href="https://pypi.org/help/#apitoken">API token</a>ã€‚ å¦‚æœä½ å·²ç»åœ¨ PyPI é‡Œå‘å¸ƒè¿‡ä½ çš„é¡¹ç›®äº†ï¼Œé‚£ä¹ˆä½ åº”è¯¥æŠŠ token çš„èŒƒå›´(token scope) é™å®šä¸ºåªèƒ½æ“ä½œè¿™ä¸ªé¡¹ç›®çš„ã€‚ä½ å¯ä»¥æŠŠæ–° token å‘½åä¸º <code>GitHub Actions CI/CD â€”project-org/project-repo</code> ä¹‹ç±»çš„ï¼Œæ–¹ä¾¿è¾¨è¯†ã€‚ç”Ÿæˆ token å<strong>ä¸è¦å…³é—­æµè§ˆå™¨é¡µé¢â€”â€” token åªä¼šæ˜¾ç¤ºä¸€æ¬¡</strong>ã€‚</li><li>åœ¨å¦ä¸€ä¸ªæµè§ˆå™¨é€‰é¡¹å¡æˆ–çª—å£ä¸­ï¼Œæ‰“å¼€ GitHub ä¸Šä½ çš„é¡¹ç›®é¡µé¢ï¼Œç‚¹å‡» <code>Settings</code> é€‰é¡¹å¡ï¼Œç„¶åç‚¹å‡»å·¦ä¾§è¾¹æ é‡Œçš„ <a href="https://help.github.com/en/articles/virtual-environments-for-github-actions#creating-and-using-secrets-encrypted-variables">Secrets</a> ã€‚</li><li>åˆ›å»ºä¸€ä¸ªæ–°çš„ sercretï¼Œå‘½ä»¤ä¸º <code>PYPI_API_TOKEN</code>ï¼Œç„¶åå¤åˆ¶ç²˜è´´ç¬¬ä¸€æ­¥ç”Ÿæˆçš„ tokenã€‚</li><li>è®¿é—® <a href="https://test.pypi.org/manage/account/#api-tokens">https://test.pypi.org/manage/account/#api-tokens</a> ï¼Œé‡å¤ä¹‹å‰çš„æ­¥éª¤ï¼ŒæŠŠ TestPyPI çš„ token ä¿å­˜æˆ <code>TEST_PYPI_API_TOKEN</code>ã€‚</li></ol><p><strong>æ³¨æ„</strong>ï¼šå¦‚æœä½ è¿˜æ²¡æœ‰ TestPyPI è´¦å·ï¼Œä½ åº”è¯¥æ³¨å†Œä¸€ä¸ªã€‚TestPyPI å’Œ PyPI çš„è´¦å·ä¸å…±é€šå“¦ã€‚</p><h2 id="åˆ›å»º-workflow"><a href="#åˆ›å»º-workflow" class="headerlink" title="åˆ›å»º workflow"></a>åˆ›å»º workflow</h2><p>GitHub CI/CD å·¥ä½œæµç¨‹ï¼ˆworkflowï¼‰æ˜¯ç”¨ YAML æ ¼å¼çš„æ–‡ä»¶å‚¨å­˜åˆ°ä»“åº“çš„ <code>.github/workflows/</code> ç›®å½•é‡Œçš„ã€‚</p><p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª  <code>.github/workflows/publish-to-test-pypi.yml</code> æ–‡ä»¶ã€‚</p><p>æˆ‘ä»¬å°†ä»ä¸€ä¸ªæœ‰æ„ä¹‰çš„åç§°å¼€å§‹ï¼Œç„¶åå®šä¹‰è§¦å‘ GitHub è¿è¡Œæ­¤å·¥ä½œæµç¨‹çš„äº‹ä»¶ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Publish</span> <span class="string">Python</span> <span class="string">ğŸ</span> <span class="string">distributions</span> <span class="string">ğŸ“¦</span> <span class="string">to</span> <span class="string">PyPI</span> <span class="string">and</span> <span class="string">TestPyPI</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span> <span class="string">push</span></span><br></pre></td></tr></table></figure><h2 id="å®šä¹‰å·¥ä½œæµç¨‹çš„å·¥ä½œç¯å¢ƒ"><a href="#å®šä¹‰å·¥ä½œæµç¨‹çš„å·¥ä½œç¯å¢ƒ" class="headerlink" title="å®šä¹‰å·¥ä½œæµç¨‹çš„å·¥ä½œç¯å¢ƒ"></a>å®šä¹‰å·¥ä½œæµç¨‹çš„å·¥ä½œç¯å¢ƒ</h2><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥ä¸ºå·¥ä½œï¼ˆjobï¼‰æ·»åŠ åˆå§‹è®¾ç½®ã€‚è¿™ä¸ªè¿‡ç¨‹å°†æ‰§è¡Œæˆ‘ä»¬ç¨åå®šä¹‰çš„å‘½ä»¤ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Ubuntu 18.04ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build-n-publish:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Build</span> <span class="string">and</span> <span class="string">publish</span> <span class="string">Python</span> <span class="string">ğŸ</span> <span class="string">distributions</span> <span class="string">ğŸ“¦</span> <span class="string">to</span> <span class="string">PyPI</span> <span class="string">and</span> <span class="string">TestPyPI</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-18.04</span></span><br></pre></td></tr></table></figure><h2 id="ç­¾å‡ºé¡¹ç›®ï¼Œæ„å»ºå‘è¡Œç‰ˆ"><a href="#ç­¾å‡ºé¡¹ç›®ï¼Œæ„å»ºå‘è¡Œç‰ˆ" class="headerlink" title="ç­¾å‡ºé¡¹ç›®ï¼Œæ„å»ºå‘è¡Œç‰ˆ"></a>ç­¾å‡ºé¡¹ç›®ï¼Œæ„å»ºå‘è¡Œç‰ˆ</h2><p>ç„¶åï¼Œåœ¨è¯¥ <code>build-n-publish</code> éƒ¨åˆ†ä¸‹æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">steps:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@master</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Set</span> <span class="string">up</span> <span class="string">Python</span> <span class="number">3.7</span></span><br><span class="line">  <span class="attr">uses:</span> <span class="string">actions/setup-python@v1</span></span><br><span class="line">  <span class="attr">with:</span></span><br><span class="line">    <span class="attr">python-version:</span> <span class="number">3.7</span></span><br></pre></td></tr></table></figure><p>è¿™äº›æ“ä½œä¼šæŠŠæˆ‘ä»¬çš„é¡¹ç›®æºç ä¸‹è½½åˆ° CI è¿è¡Œå®¹å™¨é‡Œï¼Œç„¶åå®‰è£…å¹¶æ¿€æ´» Python 3.7 ç¯å¢ƒã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»æºç æ„å»º dist äº†ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<code>build</code>åŒ…ï¼Œæ‰€ä»¥å‡è®¾é¡¹ç›®é‡Œå·²æ­£ç¡®è®¾ç½® <code>pyproject.toml</code> ï¼ˆè¯·å‚è§ <a href="https://www.python.org/dev/peps/pep-0517">PEP 517</a> / <a href="https://www.python.org/dev/peps/pep-0518">PEP 518</a>ï¼‰ã€‚</p><p>ï¼ˆæ³¨ï¼šemmmï¼Œå…¶å®è¿™é‡Œä¸å†™ <code>pyproject.toml</code> é—®é¢˜ä¹Ÿä¸å¤§ï¼‰</p><p>æç¤ºï¼šä½ å¯ä»¥ä½¿ç”¨ä»»ä½•å…¶ä»–æ–¹æ³•æ¥æ„å»ºå‘è¡Œç‰ˆï¼Œåªè¦å°†å‡†å¤‡å¥½ä¸Šä¼ çš„åŒ…ä¿å­˜åˆ° <code>dist/</code> æ–‡ä»¶å¤¹ä¸­å³å¯ã€‚</p><p>å°†ä¸‹é¢çš„ä»£ç åŠ åˆ° <code>steps</code> é‡Œï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">pypa/build</span></span><br><span class="line">  <span class="attr">run:</span> <span class="string">&gt;-</span></span><br><span class="line">    <span class="string">python</span> <span class="string">-m</span></span><br><span class="line">    <span class="string">pip</span> <span class="string">install</span></span><br><span class="line">    <span class="string">build</span></span><br><span class="line">    <span class="string">--user</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="string">a</span> <span class="string">binary</span> <span class="string">wheel</span> <span class="string">and</span> <span class="string">a</span> <span class="string">source</span> <span class="string">tarball</span></span><br><span class="line">  <span class="attr">run:</span> <span class="string">&gt;-</span></span><br><span class="line">    <span class="string">python</span> <span class="string">-m</span></span><br><span class="line">    <span class="string">build</span></span><br><span class="line">    <span class="string">--sdist</span></span><br><span class="line">    <span class="string">--wheel</span></span><br><span class="line">    <span class="string">--outdir</span> <span class="string">dist/</span></span><br><span class="line">    <span class="string">.</span></span><br></pre></td></tr></table></figure><h2 id="å‘å¸ƒåˆ°-PyPI-å’Œ-TestPyPI"><a href="#å‘å¸ƒåˆ°-PyPI-å’Œ-TestPyPI" class="headerlink" title="å‘å¸ƒåˆ° PyPI å’Œ TestPyPI"></a>å‘å¸ƒåˆ° PyPI å’Œ TestPyPI</h2><p>æœ€åï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Publish</span> <span class="string">distribution</span> <span class="string">ğŸ“¦</span> <span class="string">to</span> <span class="string">Test</span> <span class="string">PyPI</span></span><br><span class="line">  <span class="attr">uses:</span> <span class="string">pypa/gh-action-pypi-publish@master</span></span><br><span class="line">  <span class="attr">with:</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.TEST_PYPI_API_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="attr">repository_url:</span> <span class="string">https://test.pypi.org/legacy/</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Publish</span> <span class="string">distribution</span> <span class="string">ğŸ“¦</span> <span class="string">to</span> <span class="string">PyPI</span></span><br><span class="line">  <span class="attr">if:</span> <span class="string">startsWith(github.ref,</span> <span class="string">&#x27;refs/tags&#x27;</span><span class="string">)</span></span><br><span class="line">  <span class="attr">uses:</span> <span class="string">pypa/gh-action-pypi-publish@master</span></span><br><span class="line">  <span class="attr">with:</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.PYPI_API_TOKEN</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ª step è°ƒç”¨äº† <a href="https://github.com/pypa/gh-action-pypi-publish">pypa/gh-action-pypi-publish</a> GitHub Actionï¼š</p><p>ç¬¬ä¸€ä¸ªæ­¥éª¤æ— æ¡ä»¶åœ°å°† <code>dist/</code> æ–‡ä»¶å¤¹çš„å†…å®¹ä¸Šä¼ åˆ°TestPyPIã€‚ç¬¬äºŒä¸ªæ­¥éª¤å°†å…¶å†…å®¹ä¸Šä¼ åˆ° PyPIï¼Œè¿™ä¸€æ­¥åªä¼šå¯¹è¢«æ‰“äº†æ ‡ç­¾ï¼ˆgit tagï¼‰çš„æäº¤æ‰§è¡Œã€‚</p><h2 id="å®Œäº‹ï¼Œæ”¶å·¥ï¼"><a href="#å®Œäº‹ï¼Œæ”¶å·¥ï¼" class="headerlink" title="å®Œäº‹ï¼Œæ”¶å·¥ï¼"></a>å®Œäº‹ï¼Œæ”¶å·¥ï¼</h2><p>ç°åœ¨ï¼Œæ¯å½“ä½ å°†æ‰“äº†æ ‡ç­¾ï¼ˆtagï¼‰çš„æäº¤ push åˆ° GitHub ä¸Šæ—¶ï¼Œæ­¤å·¥ä½œæµç¨‹éƒ½ä¼šå°†å…¶å‘å¸ƒåˆ° PyPIã€‚åŒæ—¶ï¼Œå¯¹äºä»»æ„ push ï¼Œå®ƒéƒ½ä¼šå°†å…¶æ‰“åŒ…å‘å¸ƒåˆ° TestPyPIï¼Œè¿™å¯¹äºæä¾› alpha æµ‹è¯•ç‰ˆæœ¬ä»¥åŠç¡®ä¿å‘å¸ƒæ¸ é“ä¿æŒå¥åº·éå¸¸æœ‰ç”¨ï¼</p><hr><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">by(<span class="string">&quot;CDFMLR&quot;</span>, <span class="string">&quot;2021-01-17&quot;</span>)</span><br><span class="line"><span class="comment"># å•Šï¼Œä»Šå¤©æ˜†æ˜éƒ½ä¸‹é›ªäº†ï¼Œå®¶é‡Œå·¨å†·ã€‚ã€‚ã€‚</span></span><br><span class="line"><span class="comment"># See you â„ï¸</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SwiftUIæ•°æ®çŠ¶æ€å’Œç»‘å®š</title>
      <link href="/2021/01/14/SwiftUI/SwiftUIDataStateAndBinding/"/>
      <url>/2021/01/14/SwiftUI/SwiftUIDataStateAndBinding/</url>
      
        <content type="html"><![CDATA[<h1 id="SwiftUI-æ•°æ®çŠ¶æ€å’Œç»‘å®š"><a href="#SwiftUI-æ•°æ®çŠ¶æ€å’Œç»‘å®š" class="headerlink" title="SwiftUI æ•°æ®çŠ¶æ€å’Œç»‘å®š"></a>SwiftUI æ•°æ®çŠ¶æ€å’Œç»‘å®š</h1><table><thead><tr><th>æ–¹æ¡ˆ</th><th>è¯´æ˜</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><code>@State</code> &amp; <code>@Binding</code></td><td>æä¾› View å†…éƒ¨çš„çŠ¶æ€å­˜å‚¨</td><td>åº”è¯¥æ˜¯è¢«æ ‡è®°ä¸º private çš„ç®€å•å€¼ç±»å‹ï¼Œä»…åœ¨å†…éƒ¨ä½¿ç”¨ã€‚</td></tr><tr><td><code>ObservableObject</code> &amp; <code>@ObservedObject</code></td><td>é’ˆå¯¹è·¨è¶Š View å±‚çº§çš„çŠ¶æ€å…±äº«</td><td>å¤„ç†æ›´å¤æ‚çš„æ•°æ®ç±»å‹ï¼Œåœ¨æ•°æ®å˜åŒ–æ—¶è§¦å‘ç•Œé¢åˆ·æ–°ã€‚</td></tr><tr><td><code>@EnvironmentObject</code></td><td>å¯¹äº â€œè·³è·ƒå¼â€ è·¨è¶Šå¤šä¸ª View å±‚çº§çš„çŠ¶æ€</td><td>æ›´æ–¹ä¾¿åœ°ä½¿ç”¨ ObservableObjectï¼Œä»¥ç®€åŒ–ä»£ç ã€‚</td></tr></tbody></table><h2 id="State-amp-Binding"><a href="#State-amp-Binding" class="headerlink" title="@State &amp; @Binding"></a><code>@State</code> &amp; <code>@Binding</code></h2><p>Parent view:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ParentView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> foo: <span class="type">Bool</span> <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(spacing: <span class="number">25</span>) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;foo in Parent: <span class="subst">\(<span class="keyword">self</span>.foo <span class="operator">?</span> <span class="string">&quot;âœ”ï¸&quot;</span> : <span class="string">&quot;âŒ&quot;</span>)</span>&quot;</span>)</span><br><span class="line">            <span class="type">ChildView</span>(foo: <span class="variable">$foo</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Child view:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ChildView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> foo: <span class="type">Bool</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Button</span>(<span class="string">&quot;toggle foo from Child&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.foo.toggle()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œæ•ˆæœï¼š</p><p><img src="SwiftUIDataStateAndBinding/StateBinding.png" alt="æˆªå±2021-01-15 10.25.15"></p><p>##<code>@ObservedObject</code> </p><p>Model:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Model</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Published</span> <span class="keyword">var</span> foo: <span class="type">Bool</span> <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œ<code>@Published</code> æ˜¯ä¸ª internal çš„ã€‚åœ¨ Xcode å·¥ç¨‹é‡Œæ²¡äº‹ï¼Œä½†åœ¨ Playground çš„ Sources é‡Œå†™æ˜¯å¿…é¡» public çš„ï¼Œè¿™æ—¶å¯ä»¥é‡‡ç”¨ä¸‹é¢è¿™ç§æ‰‹åŠ¨å¤„ç†çš„æ–¹æ³•ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Model</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> objectWillChange <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">Void</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> foo: <span class="type">Bool</span> <span class="operator">=</span> <span class="literal">false</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123; objectWillChange.send() &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>let objectWillChange = PassthroughSubject&lt;Void, Never&gt;()</code> ç”¨æ¥å®ç° <code>ObservableObject</code> åè®®ï¼›</li><li>ç»™æ¯ä¸ªéœ€è¦ <code>@Published</code> çš„å˜é‡åŠ  <code>willSet &#123; objectWillChange.send() &#125;</code> ã€‚</li></ul><p>Parent View:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">ParentView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">   <span class="meta">@ObservedObject</span> <span class="keyword">var</span> model: <span class="type">Model</span> <span class="operator">=</span> <span class="type">Model</span>()</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">       <span class="type">VStack</span>(spacing: <span class="number">25</span>) &#123;</span><br><span class="line">           <span class="type">Text</span>(<span class="string">&quot;foo in Parent: <span class="subst">\(<span class="keyword">self</span>.model.foo <span class="operator">?</span> <span class="string">&quot;âœ”ï¸&quot;</span> : <span class="string">&quot;âŒ&quot;</span>)</span>&quot;</span>)</span><br><span class="line">           <span class="type">ChildView</span>(model: model)</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Child View:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">ChildView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">   <span class="keyword">var</span> model: <span class="type">Model</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">       <span class="type">Button</span>(<span class="string">&quot;toggle foo from Child&quot;</span>) &#123;</span><br><span class="line">           <span class="keyword">self</span>.model.foo.toggle()</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(model: <span class="type">Model</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.model <span class="operator">=</span> model</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå…¶å®æ˜¯åˆ©ç”¨ class çš„â€œä¼ å¼•ç”¨â€ç‰¹æ€§æ¥è®©å­è®¿é—®åˆ°çˆ¶çš„ model çš„ï¼Œæ²¡ä»€ä¹ˆç‰¹æ®Šçš„ã€‚</p><p>##<code>@EnvironmentObject</code> </p><p>æ²¿ç”¨ä¸Šé¢ <code>ObservableObject</code> çš„ Model:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Model</span>: <span class="title">ObservableObject</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Published</span> <span class="keyword">var</span> foo: <span class="type">Bool</span> <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Parent View:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">ParentView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">   <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> model: <span class="type">Model</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">       <span class="type">VStack</span>(spacing: <span class="number">25</span>) &#123;</span><br><span class="line">           <span class="type">Text</span>(<span class="string">&quot;foo in Parent: <span class="subst">\(<span class="keyword">self</span>.model.foo <span class="operator">?</span> <span class="string">&quot;âœ”ï¸&quot;</span> : <span class="string">&quot;âŒ&quot;</span>)</span>&quot;</span>)</span><br><span class="line">           <span class="type">ChildView</span>()</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Child View:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">ChildView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">   <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> model: <span class="type">Model</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">       <span class="type">Button</span>(<span class="string">&quot;toggle foo from Child&quot;</span>) &#123;</span><br><span class="line">           <span class="keyword">self</span>.model.foo.toggle()</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è°ƒç”¨ Parent çš„ Viewï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ParentView</span>().environmentObject(<span class="type">Model</span>())</span><br></pre></td></tr></table></figure><p>ç”¨ EnvironmentObject è®©æ‰€æœ‰å­éƒ½è®¿é—®åˆ°çˆ¶çš„ Modelï¼Œå¯ä»¥é¿å…é€å±‚æ‰‹åŠ¨ä¼ é€’å¯¹è±¡ã€‚</p><p>å®Œæ•´æºç å®ç°ï¼š<a href="https://github.com/cdfmlr/clownote/tree/master/source/_posts/SwiftUI/SwiftUIDataStateAndBinding/SwiftUIDataStateAndBinding.playground">SwiftUIDataStateAndBinding.playground</a>ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>ç‹å· (@onevcat)ã€ŠSwiftUI ä¸ Combine ç¼–ç¨‹ã€‹Chapter 3ï¼šæ•°æ®çŠ¶æ€å’Œç»‘å®š</p>]]></content>
      
      
      
        <tags>
            
            <tag> SwiftUI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‘½ä»¤å¼ç¼–ç¨‹ V.S. å£°æ˜å¼ç¼–ç¨‹</title>
      <link href="/2021/01/09/note/ImperativeDeclarativeProgramming/"/>
      <url>/2021/01/09/note/ImperativeDeclarativeProgramming/</url>
      
        <content type="html"><![CDATA[<h1 id="å‘½ä»¤å¼ç¼–ç¨‹-V-S-å£°æ˜å¼ç¼–ç¨‹"><a href="#å‘½ä»¤å¼ç¼–ç¨‹-V-S-å£°æ˜å¼ç¼–ç¨‹" class="headerlink" title="å‘½ä»¤å¼ç¼–ç¨‹ V.S. å£°æ˜å¼ç¼–ç¨‹"></a>å‘½ä»¤å¼ç¼–ç¨‹ V.S. å£°æ˜å¼ç¼–ç¨‹</h1><blockquote><p>Programming: Imperative &amp; Declarative</p></blockquote><p><img src="ImperativeDeclarativeProgramming/ImperativeDeclarativeProgramming.png" alt="ImperativeDeclarativeProgramming"></p><p>Qï¼šæ£€æŸ¥ students é‡Œçš„å­¦ç”Ÿçš„å¹³å‡åˆ†ï¼Œå¹¶è¾“å‡ºå¹³å‡åˆ†çš„ç¬¬ä¸€åã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> scores: [<span class="type">Subject</span>: <span class="type">Int</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Subject</span>: <span class="title">String</span>, <span class="title">CaseIterable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">Chinese</span>, <span class="type">Math</span>, <span class="type">English</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> s1 <span class="operator">=</span> <span class="type">Student</span>(</span><br><span class="line">    name: <span class="string">&quot;Foo&quot;</span>,</span><br><span class="line">    scores: [.<span class="type">Chinese</span>: <span class="number">86</span>, .<span class="type">Math</span>: <span class="number">92</span>, .<span class="type">English</span>: <span class="number">73</span>]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> s2 <span class="operator">=</span> <span class="type">Student</span>(</span><br><span class="line">    name: <span class="string">&quot;Bar&quot;</span>,</span><br><span class="line">    scores: [.<span class="type">Chinese</span>: <span class="number">99</span>, .<span class="type">Math</span>: <span class="number">52</span>, .<span class="type">English</span>: <span class="number">97</span>]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> s3 <span class="operator">=</span> <span class="type">Student</span>(</span><br><span class="line">    name: <span class="string">&quot;Joe&quot;</span>,</span><br><span class="line">    scores: [.<span class="type">Chinese</span>: <span class="number">91</span>, .<span class="type">Math</span>: <span class="number">92</span>, .<span class="type">English</span>: <span class="number">100</span>]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> students <span class="operator">=</span> [s1, s2, s3]</span><br></pre></td></tr></table></figure><h2 id="å‘½ä»¤å¼ç¼–ç¨‹"><a href="#å‘½ä»¤å¼ç¼–ç¨‹" class="headerlink" title="å‘½ä»¤å¼ç¼–ç¨‹"></a>å‘½ä»¤å¼ç¼–ç¨‹</h2><p>ä¸€æ­¥æ­¥å‘Šè¯‰è®¡ç®—æœºæ€ä¹ˆåšã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‘½ä»¤å¼.swift</span></span><br><span class="line"><span class="keyword">var</span> best: (<span class="type">Student</span>, <span class="type">Double</span>)<span class="operator">?</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> students &#123;</span><br><span class="line">    <span class="keyword">var</span> totalScore <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> <span class="type">Subject</span>.allCases &#123;</span><br><span class="line">        totalScore <span class="operator">+=</span> s.scores[key] <span class="operator">??</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> averageScore <span class="operator">=</span> <span class="type">Double</span>(totalScore) <span class="operator">/</span></span><br><span class="line">    <span class="type">Double</span>(<span class="type">Subject</span>.allCases.count)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> temp <span class="operator">=</span> best &#123;</span><br><span class="line">        <span class="keyword">if</span> averageScore <span class="operator">&gt;</span> temp.<span class="number">1</span> &#123;</span><br><span class="line">            best <span class="operator">=</span> (s, averageScore)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        best <span class="operator">=</span> (s, averageScore)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(best<span class="operator">?</span>.<span class="number">0</span>.name <span class="operator">??</span> <span class="string">&quot;no students&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="å£°æ˜å¼ç¼–ç¨‹"><a href="#å£°æ˜å¼ç¼–ç¨‹" class="headerlink" title="å£°æ˜å¼ç¼–ç¨‹"></a>å£°æ˜å¼ç¼–ç¨‹</h2><p>å‘Šè¯‰è®¡ç®—æœºè¦åšä»€ä¹ˆï¼Œå…·ä½“å®ç°ç”±è®¡ç®—æœºå†³å®šã€‚</p><h3 id="å‡½æ•°å¼"><a href="#å‡½æ•°å¼" class="headerlink" title="å‡½æ•°å¼"></a>å‡½æ•°å¼</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‡½æ•°å¼.swift</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">average</span><span class="params">(<span class="keyword">_</span> scores: [Subject: Int])</span></span> -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Double</span>(scores.values.reduce(<span class="number">0</span>, <span class="operator">+</span>)) <span class="operator">/</span> <span class="type">Double</span>(<span class="type">Subject</span>.allCases.count)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> bestStudent <span class="operator">=</span> students</span><br><span class="line">    .map &#123; (<span class="variable">$0</span>, average(<span class="variable">$0</span>.scores)) &#125;</span><br><span class="line">    .sorted &#123; <span class="variable">$0</span>.<span class="number">1</span> <span class="operator">&gt;</span> <span class="variable">$1</span>.<span class="number">1</span> &#125;</span><br><span class="line">    .first</span><br></pre></td></tr></table></figure><p>ï¼ˆæˆ‘æ˜¯æœ‰ç‚¹å–œæ¬¢å‡½æ•°å¼å•¦ï¼Œä½† SICP è‡³ä»Šæ²¡çœ‹å®Œã€‚ã€‚ï¼‰</p><h3 id="DSL"><a href="#DSL" class="headerlink" title="DSL"></a>DSL</h3><p>ä¾‹å¦‚ SQLï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name, <span class="built_in">avg</span>(score) <span class="keyword">as</span> avs_score </span><br><span class="line"><span class="keyword">from</span> scores <span class="keyword">group</span> <span class="keyword">by</span> name <span class="keyword">order</span> <span class="keyword">by</span> avg_score;</span><br></pre></td></tr></table></figure><p>ï¼ˆä¸å–œæ¬¢ SQLï¼Œæˆ‘éå¸¸è®¨åŒ <code>group by</code> è¿™ç§è¶…è¿‡ä¸€ä¸ªè¯çš„å…³é”®å­—ï¼Œæ‰€ä»¥å¤©å¤©ç”¨ ORMã€‚ã€‚ï¼‰</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ•°å€¼åˆ†æç®—æ³•æ€»ç»“</title>
      <link href="/2020/11/28/Algorithm/NumericalAnalysisAlogrithm/"/>
      <url>/2020/11/28/Algorithm/NumericalAnalysisAlogrithm/</url>
      
        <content type="html"><![CDATA[<h1 id="æ•°å€¼åˆ†æç®—æ³•æ€»ç»“"><a href="#æ•°å€¼åˆ†æç®—æ³•æ€»ç»“" class="headerlink" title="æ•°å€¼åˆ†æç®—æ³•æ€»ç»“"></a>æ•°å€¼åˆ†æç®—æ³•æ€»ç»“</h1><p>æ•°å€¼åˆ†æçš„ç®—æ³•æ€»ç»“ï¼Œç”¨ Python ç®€è¦æè¿°å„ç§æ–¹æ³•ã€‚è€ƒå‰å¤ï¼ˆyuï¼‰ä¹ å‘ã€‚</p><p>æœ¬æ–‡ç»™å‡ºçš„ä»£ç ä¸»è¦æ˜¯é’ˆå¯¹é—­å·è€ƒè¯•èƒŒç®—æ³•å†™çš„ã€‚æˆ‘ jo å¾—è®°æ•°å­¦å…¬å¼å’Œå†™ LaTeX ä¸€æ ·ï¼Œæ˜¯ä»¶æ¯”å†™ä»£ç æ›´å¯æ€•çš„äº‹ã€‚æ‰€ä»¥ï¼ŒæŠŠä¸€äº›ä¸»è¦çš„ç®—æ³•ç”¨ç¨‹åºå†™äº†å‡ºæ¥ï¼Œæ–¹ä¾¿è®°å¿†ã€‚</p><p>ï¼ˆå…¶ä¸­ä¸€éƒ¨åˆ†æ˜¯è€ƒè¯•å‰å¤ä¹ æ—¶å†™çš„ï¼Œç»è¿‡è€ƒåœºçš„æŠ½æ ·æ£€éªŒï¼Œæ¯”è¾ƒé è°±ã€‚ä½†é‚£æ—¶å†™çš„ä¸å¤ªå®Œæ•´ï¼Œåé¢åˆè¡¥å……å†™äº†ç‚¹ï¼Œè¿™æ—¶æˆç»©éƒ½å‡ºäº†ï¼Œå­¦çš„ä¹Ÿéƒ½å¿˜äº†ï¼Œæ‰€ä»¥å¯èƒ½ä¸å¤ªå¯¹ï¼Œæ€»ä¹‹åˆ«æŠ¥å¤ªå¤§æœŸæœ›å•¦~ï¼‰</p><p>å¦‚æœä½ éœ€è¦çš„æ˜¯æ›´å…¨çš„å„ç§ç®—æ³•å®Œæ•´çš„ä»£ç å®ç°ä¸æè¿°ï¼Œè¯·ç§»æ­¥ï¼š</p><ul><li><a href="https://github.com/cdfmlr/NumericalAnalysis">https://github.com/cdfmlr/NumericalAnalysis</a></li><li>or <a href="https://gitee.com/cdfmlr/NumericalAnalysis">https://gitee.com/cdfmlr/NumericalAnalysis</a></li></ul><p>All right, talk is cheap, let me show you the code!</p><h2 id="éçº¿æ€§æ–¹ç¨‹æ±‚æ ¹"><a href="#éçº¿æ€§æ–¹ç¨‹æ±‚æ ¹" class="headerlink" title="éçº¿æ€§æ–¹ç¨‹æ±‚æ ¹"></a>éçº¿æ€§æ–¹ç¨‹æ±‚æ ¹</h2><h3 id="äºŒåˆ†æ³•"><a href="#äºŒåˆ†æ³•" class="headerlink" title="äºŒåˆ†æ³•"></a>äºŒåˆ†æ³•</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">x = (a + b) / <span class="number">2</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">if</span> f(x) * f(a) &lt; <span class="number">0</span>:</span><br><span class="line">        b = x</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">a = x</span><br><span class="line">x = (a + b) / <span class="number">2</span></span><br></pre></td></tr></table></figure><h3 id="ä¸åŠ¨ç‚¹è¿­ä»£"><a href="#ä¸åŠ¨ç‚¹è¿­ä»£" class="headerlink" title="ä¸åŠ¨ç‚¹è¿­ä»£"></a>ä¸åŠ¨ç‚¹è¿­ä»£</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = x_0</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    x = phi(x)</span><br></pre></td></tr></table></figure><p>æ”¶æ•›ï¼š<code>diff(phi, x)</code>å­˜åœ¨ä¸”è¿ç»­ &amp;&amp; <code>abs(diff(phi, x)(x_0)) &lt; 1</code>ã€‚</p><p>or: è®¾ $x^*$ ä¸º $f(x)=0$ çš„æ ¹ï¼Œå¯ä»¥å¾—åˆ° $x^*=â€¦(x^*)$ï¼Œæ‰€ä»¥ $x^*$ ä¸º <code>x = phi(x)</code> çš„ä¸åŠ¨ç‚¹ï¼Œå¯¹ $x^*$ é¢†åŸŸçš„ xï¼š<code>abs(diff(phi, x)) &lt; 1</code></p><h3 id="ç‰›é¡¿è¿­ä»£"><a href="#ç‰›é¡¿è¿­ä»£" class="headerlink" title="ç‰›é¡¿è¿­ä»£"></a>ç‰›é¡¿è¿­ä»£</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = x_0</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    x -= f(x) / df(x)</span><br></pre></td></tr></table></figure><h2 id="æ’å€¼"><a href="#æ’å€¼" class="headerlink" title="æ’å€¼"></a>æ’å€¼</h2><h3 id="Lagrange-æ’å€¼"><a href="#Lagrange-æ’å€¼" class="headerlink" title="Lagrange æ’å€¼"></a>Lagrange æ’å€¼</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lagrange_interpolate</span>(<span class="params">points</span>):</span></span><br><span class="line">L = <span class="number">0</span>  <span class="comment"># æ’å€¼å¤šé¡¹å¼</span></span><br><span class="line">    <span class="keyword">for</span> i, (xi, yi) <span class="keyword">in</span> <span class="built_in">enumerate</span>(points):</span><br><span class="line">        li = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> j, (xj, yj) <span class="keyword">in</span> <span class="built_in">enumerate</span>(points):</span><br><span class="line">            <span class="keyword">if</span> j == i:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            li *= (x - xj) / (xi - xj)</span><br><span class="line">        L += yi * li</span><br><span class="line">    <span class="keyword">return</span> L</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç¨‹åºä¸å¤ªå¥½æ‡‚ï¼Œè¿˜æ˜¯çœ‹å…¬å¼ï¼š</p><p>$$<br>L(x)=\sum <em>{j=0}^{k}y</em>{j}\ell _{j}(x)<br>$$</p><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gm74xhj8pcj31fk06eta3.jpg" alt="æˆªå±2020-12-31 16.48.44"></p><p>P.S. è¿™ä¸ªå…¬å¼æ˜¯ç›´æ¥ Wikipedia ä¸Šå¤åˆ¶çš„ï¼ŒKaTeX æ¸²æŸ“ä¸å‡ºæ¥ï¼Œå°±æ”¾å›¾ç‰‡äº†ã€‚ä¸‹é¢æ˜¯å®ƒçš„æºç ï¼š</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br><span class="line"><span class="keyword">\ell</span> <span class="built_in">_</span>&#123;j&#125;(x)=<span class="keyword">\prod</span> <span class="built_in">_</span>&#123;&#123;i=0,<span class="keyword">\,</span>i<span class="keyword">\neq</span> j&#125;&#125;<span class="built_in">^</span>&#123;&#123;k&#125;&#125;&#123;<span class="keyword">\frac</span> &#123;x-x<span class="built_in">_</span>&#123;i&#125;&#125;&#123;x<span class="built_in">_</span>&#123;j&#125;-x<span class="built_in">_</span>&#123;i&#125;&#125;&#125;=&#123;<span class="keyword">\frac</span> &#123;(x-x<span class="built_in">_</span>&#123;0&#125;)&#125;&#123;(x<span class="built_in">_</span>&#123;j&#125;-x<span class="built_in">_</span>&#123;0&#125;)&#125;&#125;<span class="keyword">\cdots</span> &#123;<span class="keyword">\frac</span> &#123;(x-x<span class="built_in">_</span>&#123;&#123;j-1&#125;&#125;)&#125;&#123;(x<span class="built_in">_</span>&#123;j&#125;-x<span class="built_in">_</span>&#123;&#123;j-1&#125;&#125;)&#125;&#125;&#123;<span class="keyword">\frac</span> &#123;(x-x<span class="built_in">_</span>&#123;&#123;j+1&#125;&#125;)&#125;&#123;(x<span class="built_in">_</span>&#123;j&#125;-x<span class="built_in">_</span>&#123;&#123;j+1&#125;&#125;)&#125;&#125;<span class="keyword">\cdots</span> &#123;<span class="keyword">\frac</span> &#123;(x-x<span class="built_in">_</span>&#123;&#123;k&#125;&#125;)&#125;&#123;(x<span class="built_in">_</span>&#123;j&#125;-x<span class="built_in">_</span>&#123;&#123;k&#125;&#125;)&#125;&#125;</span><br><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br></pre></td></tr></table></figure><h3 id="Newton-æ’å€¼"><a href="#Newton-æ’å€¼" class="headerlink" title="Newton æ’å€¼"></a>Newton æ’å€¼</h3><p>å·®å•†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dq</span>(<span class="params">f, xs</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(xs) == <span class="number">1</span>:  <span class="comment"># 0é˜¶</span></span><br><span class="line">        <span class="keyword">return</span> f(xs[<span class="number">0</span>])</span><br><span class="line">    <span class="comment"># n é˜¶</span></span><br><span class="line">    <span class="keyword">return</span> (dq(f, xs[<span class="number">1</span>:]) - dq(f, xs[:-<span class="number">1</span>])) / (xs[-<span class="number">1</span>] - xs[<span class="number">0</span>]) </span><br></pre></td></tr></table></figure><p>æ‰‹ç®—ç”¨è¡¨ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gl6bgm6utbj31540igtek.jpg" alt="æˆªå±2020-11-29 20.25.29"></p><p>Newton æ’å€¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">newton_interpolate</span>(<span class="params">points</span>):</span></span><br><span class="line">    N = <span class="number">0</span></span><br><span class="line">    xs = []</span><br><span class="line">    <span class="keyword">for</span> (x, y) <span class="keyword">in</span> points:</span><br><span class="line">        xs.append(x)</span><br><span class="line">        N += dq(f, xs) * prod( [(<span class="string">&#x27;x&#x27;</span> - xi) <span class="keyword">for</span> xi <span class="keyword">in</span> xs[:-<span class="number">1</span>]] )</span><br><span class="line">    <span class="keyword">return</span> N</span><br></pre></td></tr></table></figure><h2 id="æœ€å°äºŒä¹˜æ‹Ÿåˆ"><a href="#æœ€å°äºŒä¹˜æ‹Ÿåˆ" class="headerlink" title="æœ€å°äºŒä¹˜æ‹Ÿåˆ"></a>æœ€å°äºŒä¹˜æ‹Ÿåˆ</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].T</span><br><span class="line">y = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>].T</span><br><span class="line"></span><br><span class="line">X = [<span class="number">1</span>, x, x**<span class="number">2</span>]</span><br><span class="line"><span class="comment"># (X.T @ X) @ theta = X.T @ y</span></span><br><span class="line">theta = pinv(X.T @ X) @ X.T @ y</span><br></pre></td></tr></table></figure><p><code>@</code> æ˜¯çŸ©é˜µä¹˜æ³•ï¼ˆè¿™æ˜¯æ ‡å‡†çš„ Python è¿ç®—ç¬¦å“¦ï¼š<a href="https://docs.python.org/3/library/operator.html#operator.matmul%EF%BC%89">https://docs.python.org/3/library/operator.html#operator.matmulï¼‰</a></p><h2 id="æ•°å€¼ç§¯åˆ†"><a href="#æ•°å€¼ç§¯åˆ†" class="headerlink" title="æ•°å€¼ç§¯åˆ†"></a>æ•°å€¼ç§¯åˆ†</h2><h3 id="æ¢¯å½¢æ±‚ç§¯å…¬å¼"><a href="#æ¢¯å½¢æ±‚ç§¯å…¬å¼" class="headerlink" title="æ¢¯å½¢æ±‚ç§¯å…¬å¼"></a>æ¢¯å½¢æ±‚ç§¯å…¬å¼</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = (b - a) * (f(a) + f(b)) / <span class="number">2</span></span><br></pre></td></tr></table></figure><h3 id="è¾›æ™®æ£®æ±‚ç§¯å…¬å¼"><a href="#è¾›æ™®æ£®æ±‚ç§¯å…¬å¼" class="headerlink" title="è¾›æ™®æ£®æ±‚ç§¯å…¬å¼"></a>è¾›æ™®æ£®æ±‚ç§¯å…¬å¼</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = (b - a) * (f(a) + <span class="number">4</span> * f((a + b) / <span class="number">2</span>) + f(b)) / <span class="number">6</span></span><br></pre></td></tr></table></figure><h3 id="Newton-Cotes"><a href="#Newton-Cotes" class="headerlink" title="Newton-Cotes"></a>Newton-Cotes</h3><p>æ±‚æŸ¯ç‰¹æ–¯ç³»æ•° $C_k^{(n)}$:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">costes_coefficient</span>(<span class="params">n, k</span>):</span></span><br><span class="line">    ckn = ((-<span class="number">1</span>) ** (n - k)) / n * factorial(k) * factorial(n - k)</span><br><span class="line"></span><br><span class="line">    h = <span class="number">1</span></span><br><span class="line">    t = Symbol(<span class="string">&#x27;t&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> j != k:</span><br><span class="line">            h *= (t - j)</span><br><span class="line"></span><br><span class="line">    ckn *= integrate(h, (t, <span class="number">0</span>, n))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ckn</span><br></pre></td></tr></table></figure><p>æ‰“å¼ è¡¨æ–¹ä¾¿æ‰‹ç®—ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gm74jwolc6j315s0fw40k.jpg" alt="costes_coefficient_table"></p><p>ç‰›é¡¿-ç§‘ç‰¹æ–¯æ±‚ç§¯å…¬å¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">newton_cotes_integral</span>(<span class="params">f, a, b, n</span>):</span></span><br><span class="line">    step = (b - a) / n</span><br><span class="line">    xs = [a + i * step <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n+<span class="number">1</span>)]</span><br><span class="line">    <span class="keyword">return</span> (b - a) * <span class="built_in">sum</span>([costes_coefficient(n, k) * f(xs[k]) <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, n+<span class="number">1</span>)])</span><br></pre></td></tr></table></figure><h2 id="å¸¸å¾®åˆ†æ–¹ç¨‹åˆå€¼é—®é¢˜"><a href="#å¸¸å¾®åˆ†æ–¹ç¨‹åˆå€¼é—®é¢˜" class="headerlink" title="å¸¸å¾®åˆ†æ–¹ç¨‹åˆå€¼é—®é¢˜"></a>å¸¸å¾®åˆ†æ–¹ç¨‹åˆå€¼é—®é¢˜</h2><p>é—®é¢˜ï¼š<br>$$<br>\begin{cases}<br>yâ€™(x)=f(x,y)\<br>y(a)=y_0\<br>\end{cases}<br>\qquad (a\le x \le b)<br>$$</p><h3 id="æ”¹è¿›-Euler"><a href="#æ”¹è¿›-Euler" class="headerlink" title="æ”¹è¿› Euler"></a>æ”¹è¿› Euler</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">improved_euler</span>(<span class="params">f, a, b, h, y0</span>):</span>    </span><br><span class="line">    x = a</span><br><span class="line">    y = y0</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> x &lt;= b:</span><br><span class="line">        <span class="keyword">yield</span> (x, y)</span><br><span class="line"></span><br><span class="line">        y_next_g = y + h * f(x, y)  <span class="comment"># é¢„ä¼°</span></span><br><span class="line">        y_next = y + h * ( f(x, y) + f(x+h, y_next_g) ) / <span class="number">2</span>  <span class="comment"># æ ¡æ­£</span></span><br><span class="line">        </span><br><span class="line">        x = x + h</span><br><span class="line">        y = y_next</span><br></pre></td></tr></table></figure><h3 id="RK4"><a href="#RK4" class="headerlink" title="RK4"></a>RK4</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">runge_kutta</span>(<span class="params">f, a, b, h, y0</span>):</span></span><br><span class="line">    x = a</span><br><span class="line">    y = y0</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> x &lt;= b:</span><br><span class="line">        <span class="keyword">yield</span> (x, y)</span><br><span class="line"></span><br><span class="line">        k1 = f(x, y)</span><br><span class="line">        k2 = f(x + h / <span class="number">2</span>, y + h * k1 / <span class="number">2</span>)</span><br><span class="line">        k3 = f(x + h / <span class="number">2</span>, y + h * k2 / <span class="number">2</span>)</span><br><span class="line">        k4 = f(x + h, y + h * k3)</span><br><span class="line">        </span><br><span class="line">        x = x + h</span><br><span class="line">        y = y + h * (k1 + <span class="number">2</span> * k2 + <span class="number">2</span> * k3 + k4) / <span class="number">6</span></span><br></pre></td></tr></table></figure><h2 id="çº¿æ€§æ–¹ç¨‹ç»„ç›´æ¥è§£æ³•"><a href="#çº¿æ€§æ–¹ç¨‹ç»„ç›´æ¥è§£æ³•" class="headerlink" title="çº¿æ€§æ–¹ç¨‹ç»„ç›´æ¥è§£æ³•"></a>çº¿æ€§æ–¹ç¨‹ç»„ç›´æ¥è§£æ³•</h2><h3 id="é«˜æ–¯æ¶ˆå…ƒ"><a href="#é«˜æ–¯æ¶ˆå…ƒ" class="headerlink" title="é«˜æ–¯æ¶ˆå…ƒ"></a>é«˜æ–¯æ¶ˆå…ƒ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">A = np.c_[a, b]  <span class="comment"># å¢å¹¿çŸ©é˜µ</span></span><br><span class="line"></span><br><span class="line">n = A.shape[<span class="number">0</span>]</span><br><span class="line">x = np.zeros(n)  <span class="comment"># è§£</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¶ˆå…ƒ</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>):</span><br><span class="line">    <span class="comment"># åˆ—é€‰ä¸»å…ƒï¼Œå¦‚æœåšé¡ºåºæ¶ˆå…ƒå°±ä¸ç”¨åšä¸‹é¢ä¸¤è¡Œ</span></span><br><span class="line">    i_max = k + argmax(<span class="built_in">abs</span>(A[k:n, k]))</span><br><span class="line">    A[[i_max, k]] = A[[k, i_max]]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># if A[k][k] == 0: æ±‚è§£å¤±è´¥</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k+<span class="number">1</span>, n):</span><br><span class="line">        m = A[i][k] / A[k][k];</span><br><span class="line">        A[i][k] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(k+<span class="number">1</span>, n+<span class="number">1</span>):</span><br><span class="line">            A[i][j] -= A[k][j] * m</span><br><span class="line"></span><br><span class="line"><span class="comment"># å›ä»£ï¼šè§£ä¸‰è§’æ–¹ç¨‹</span></span><br><span class="line">x[n-<span class="number">1</span>] = A[n-<span class="number">1</span>][n] / A[n-<span class="number">1</span>][n-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">2</span>, -<span class="number">1</span>, -<span class="number">1</span>): <span class="comment"># from n-2 (included) to 0 (included)</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(k+<span class="number">1</span>, n):</span><br><span class="line">        A[k][n] -= A[k][j] * x[j]</span><br><span class="line">    x[k] = A[k][n] / A[k][k]</span><br></pre></td></tr></table></figure><h3 id="LU-åˆ†è§£"><a href="#LU-åˆ†è§£" class="headerlink" title="LU åˆ†è§£"></a>LU åˆ†è§£</h3><p>ç³»æ•°çŸ©é˜µ aï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">n = a.shape[<span class="number">0</span>]</span><br><span class="line">p = [<span class="number">0</span>, <span class="number">1</span>, ..., n-<span class="number">1</span>]  <span class="comment"># è®°å½•äº¤æ¢</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">if</span> åˆ—é€‰ä¸»å…ƒ:</span><br><span class="line">        i_max = k + argmax(<span class="built_in">abs</span>(a[k:n, k]))</span><br><span class="line">        <span class="keyword">if</span> i_max != k:</span><br><span class="line">            a[[i_max, k]] = a[[k, i_max]]  <span class="comment"># swap rows</span></span><br><span class="line">            p[[i_max, k]] = p[[k, i_max]]  <span class="comment"># record</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> a[k][k] != <span class="number">0</span>, <span class="string">&quot;é”™è¯¯: ä¸»å…ƒç´ ä¸ºé›¶&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k+<span class="number">1</span>, n):</span><br><span class="line">        a[i][k] /= a[k][k]  <span class="comment"># L @ ä¸¥æ ¼ä¸‹ä¸‰è§’</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(k+<span class="number">1</span>, n):</span><br><span class="line">            a[i][j] -= a[i][k] * a[k][j]  <span class="comment"># U @ ä¸Šä¸‰è§’</span></span><br></pre></td></tr></table></figure><p>æŠŠå³ç«¯å¸¸æ•° b åšç›¸åŒçš„è¡Œäº¤æ¢ï¼ˆp è®°å½•ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b = [b[v] <span class="keyword">for</span> v <span class="keyword">in</span> p]</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥è§£æ–¹ç¨‹äº†ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è§£æ–¹ç¨‹(&quot;L * y = b&quot;) =&gt; y</span><br><span class="line">è§£æ–¹ç¨‹(&quot;U * x = y&quot;) =&gt; x</span><br></pre></td></tr></table></figure><p>é™„ï¼šè§£ä¸‰è§’æ–¹ç¨‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">x = np.zeros(n, dtype=np.<span class="built_in">float</span>)</span><br><span class="line">x[n-<span class="number">1</span>] = y[n-<span class="number">1</span>] / u[n-<span class="number">1</span>][n-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">2</span>, -<span class="number">1</span>, -<span class="number">1</span>): <span class="comment"># from n-2 (included) to 0 (included)</span></span><br><span class="line">    yi = y[i]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i+<span class="number">1</span>, n):</span><br><span class="line">        yi -= x[j] * u[i][j]</span><br><span class="line">    x[i] = yi / u[i][i]</span><br></pre></td></tr></table></figure><h2 id="çº¿æ€§æ–¹ç¨‹ç»„è¿­ä»£è§£æ³•"><a href="#çº¿æ€§æ–¹ç¨‹ç»„è¿­ä»£è§£æ³•" class="headerlink" title="çº¿æ€§æ–¹ç¨‹ç»„è¿­ä»£è§£æ³•"></a>çº¿æ€§æ–¹ç¨‹ç»„è¿­ä»£è§£æ³•</h2><h3 id="Jacobi-è¿­ä»£"><a href="#Jacobi-è¿­ä»£" class="headerlink" title="Jacobi è¿­ä»£"></a>Jacobi è¿­ä»£</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># A =  D - L - U</span></span><br><span class="line">D = diag(diag(A))</span><br><span class="line">L = - tril(A, -<span class="number">1</span>)</span><br><span class="line">U = - triu(A, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">B = inv(D) @ (L + U)</span><br><span class="line">f = inv(D) @ </span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    x_prev = x</span><br><span class="line">    x = B @ x + f</span><br></pre></td></tr></table></figure><p>emmmmï¼Œè¿™ç§å»æ‰‹ç®—ä¸å¤ªç°å®ã€‚æˆ‘ä¾ç¨€è®°å¾—ç›´æ¥å†™å‡ºæ–¹ç¨‹æ¥ç®—æ›´å®¹æ˜“ï¼ˆæˆ‘è€ƒå®Œè¯•å¥½ä¹…äº†ï¼Œå·²ç»å¿˜äº†ï¼‰ã€‚ã€‚ã€‚</p><h3 id="Gauss-Seidel-è¿­ä»£"><a href="#Gauss-Seidel-è¿­ä»£" class="headerlink" title="Gauss-Seidel è¿­ä»£"></a>Gauss-Seidel è¿­ä»£</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">B = inv(D - L) @ U</span><br><span class="line">f = inv(D - L) @ b</span><br></pre></td></tr></table></figure><h2 id="ç‰¹å¾å€¼æ±‚æ³•"><a href="#ç‰¹å¾å€¼æ±‚æ³•" class="headerlink" title="ç‰¹å¾å€¼æ±‚æ³•"></a>ç‰¹å¾å€¼æ±‚æ³•</h2><h3 id="æ­£å¹‚æ³•"><a href="#æ­£å¹‚æ³•" class="headerlink" title="æ­£å¹‚æ³•"></a>æ­£å¹‚æ³•</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">A = array(shape=(n, n)) <span class="comment"># A æ˜¯è¦æ±‚ç‰¹å¾å€¼çš„ n*n çŸ©é˜µ</span></span><br><span class="line"></span><br><span class="line">m = m0 = <span class="number">1</span>  <span class="comment"># ä¸»ç‰¹å¾å€¼</span></span><br><span class="line">u = u0 = [<span class="number">1</span>, <span class="number">1</span>, ..., <span class="number">1</span>]  <span class="comment"># å¯¹åº”çš„ç‰¹å¾å‘é‡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">m_prev = m</span><br><span class="line"></span><br><span class="line">v = dot(A, u)</span><br><span class="line">m = v[argmax(<span class="built_in">abs</span>(v))]</span><br><span class="line">u = v / m</span><br></pre></td></tr></table></figure><h3 id="åå¹‚æ³•"><a href="#åå¹‚æ³•" class="headerlink" title="åå¹‚æ³•"></a>åå¹‚æ³•</h3><p>æ­£å¹‚æ³•æ”¹ä¸€ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v = solve(A, u)</span><br></pre></td></tr></table></figure><p>æœ€åç»“æœæ˜¯ <code>1/m</code> å’Œ <code>u</code>ã€‚</p><hr><blockquote><p>EOF</p><p>By CDFMLR 2020.12.31</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> Algorithm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonåˆ é™¤å­—ç¬¦ä¸²åç¼€é—®é¢˜</title>
      <link href="/2020/11/24/blog/python_removesuffix/"/>
      <url>/2020/11/24/blog/python_removesuffix/</url>
      
        <content type="html"><![CDATA[<h1 id="Pythonåˆ é™¤å­—ç¬¦ä¸²åç¼€é—®é¢˜"><a href="#Pythonåˆ é™¤å­—ç¬¦ä¸²åç¼€é—®é¢˜" class="headerlink" title="Pythonåˆ é™¤å­—ç¬¦ä¸²åç¼€é—®é¢˜"></a>Pythonåˆ é™¤å­—ç¬¦ä¸²åç¼€é—®é¢˜</h1><p>[TOC]</p><h2 id="é—®é¢˜å‘ç°"><a href="#é—®é¢˜å‘ç°" class="headerlink" title="é—®é¢˜å‘ç°"></a>é—®é¢˜å‘ç°</h2><p>æˆ‘çš„ GitHub Pages åšå®¢ <a href="https://clownote.github.io/">clownote</a> æ˜¯é€šè¿‡ Hexo + ä¸€äº›è‡ªå·±å†™çš„æœ¬åœ°è„šæœ¬ + Github Action æ¥è‡ªåŠ¨å‘å¸ƒçš„ï¼ˆå‚è€ƒé„™äººæ‹™ä½œã€Š<a href="https://blog.csdn.net/u012419550/article/details/107594751">è¿˜åœ¨æ‰‹åŠ¨å‘åšå®¢ï¼ŸGitHub Actionsè‡ªåŠ¨åŒ–çœŸé¦™</a>ã€‹ï¼‰ã€‚</p><p>æ–‡ç« ä¿®æ”¹çš„ GitHub æäº¤ä¿¡æ¯æ˜¯é€šè¿‡ä¸€ä¸ªè„šæœ¬è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œå®ƒä¼šåˆ—å‡ºä¿®æ”¹çš„æ–‡ç« åå¯¹äºå…·ä½“çš„æ–‡ç« ï¼ˆéƒ½æ˜¯ markdownï¼‰ï¼Œä¼šå¿½ç•¥åç¼€ <code>.md</code>ï¼Œè¿™æ ·å¥½çœ‹ä¸€äº›ï¼Œè€Œå…¶ä»–æ–‡ä»¶ï¼ˆå·¥å…·è„šæœ¬ï¼‰åˆ™ä¿ç•™å®Œæ•´æ–‡ä»¶åï¼š</p><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gl041kzke7j30n50ai0u3.jpg" alt="æˆªå±2020-11-24 11.39.24"></p><p>å‰å‡ å¤©å†™äº†ç¯‡åå« <code>Intro_sham.md</code> çš„æ–‡ç« ï¼Œå³ã€Š<a href="https://blog.csdn.net/u012419550/article/details/109731346">æˆ‘è¿™äººä¸æ‡‚ä»€ä¹ˆæ“ä½œç³»ç»Ÿï¼Œäºæ˜¯ç”¨Goè¯­è¨€æ¨¡æ‹Ÿå‡ºäº†ä¸€ä¸ª</a>ã€‹ï¼Œå®ƒçš„æäº¤ä¿¡æ¯æ˜¯ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gl043el96rj30k303c3yq.jpg" alt="æˆªå±2020-11-24 11.41.14"></p><p><code>changed files: Intro_sha</code> è«åç¼ºäº†ä¸€ä¸ª <code>m</code>ã€‚ã€‚ã€‚</p><h2 id="é—®é¢˜å®šä½"><a href="#é—®é¢˜å®šä½" class="headerlink" title="é—®é¢˜å®šä½"></a>é—®é¢˜å®šä½</h2><p>æ‰“å¼€å·¥å…·è„šæœ¬ï¼Œæ‰¾åˆ°å†™ Git æäº¤ message çš„ä»£ç åœ¨è¿™é‡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">push</span>(<span class="params">**kwargs</span>):</span></span><br><span class="line">    ...</span><br><span class="line">    names = <span class="built_in">map</span>(<span class="keyword">lambda</span> f: os.path.basename(f).rstrip(<span class="string">&#x27;.md&#x27;</span>), changed)</span><br><span class="line">    commit_msg = <span class="string">&#x27;changed files: &#x27;</span> + <span class="string">&#x27;, &#x27;</span>.join(names)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p><code>changed files</code> çš„åå­—æ˜¯é€šè¿‡ä¸€ä¸ªä½œç”¨äºæ‰€æœ‰æ”¹å˜äº†çš„æ–‡ä»¶çš„ map æ–¹æ³•å¾—åˆ°çš„ã€‚è¿™ä¸ª map åšçš„å·¥ä½œæ˜¯æŠŠæ–‡ä»¶çš„è·¯å¾„å’Œ <code>.md</code> åç¼€å»æ‰ï¼ˆåªæ˜¯ä¸ºäº†å¥½çœ‹ï¼‰ã€‚</p><p>é—®é¢˜å‘¼ä¹‹æ¬²å‡º â€”â€” <code>rstrip</code> çš„é”™è¯¯ä½¿ç”¨ã€‚</p><h2 id="é—®é¢˜å¤ç°"><a href="#é—®é¢˜å¤ç°" class="headerlink" title="é—®é¢˜å¤ç°"></a>é—®é¢˜å¤ç°</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">&quot;emmm.md&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.rstrip(<span class="string">&#x27;.md&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;e&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="RTFM"><a href="#RTFM" class="headerlink" title="RTFM"></a>RTFM</h2><p>çœ‹ä¸€çœ‹ rstrip çš„æ–‡æ¡£ï¼š<a href="https://docs.python.org/3.7/library/stdtypes.html#str.rstrip">https://docs.python.org/3.7/library/stdtypes.html#str.rstrip</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">str</span>.rstrip([chars])</span><br></pre></td></tr></table></figure><p>é‡Œé¢å†™äº†ï¼š</p><blockquote><p>Return a copy of the string with trailing characters removed.<br>The chars argument is a string specifying the set of charactersto be removed.<br>The chars argument is not a suffix; rather, all combinations of its values are stripped.</p></blockquote><p>æ˜¯ç»“å°¾å¤„æœ‰ä½ ç»™çš„ chars å‚æ•°é‡Œå­—ç¬¦çš„ä»»æ„ç»„åˆéƒ½ä¼šè¢«åˆ ã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>è¿™ä¸ªé—®é¢˜å…¶å®æ˜¯ä¸ªé•¿æœŸä»¥æ¥çš„ç—›ç‚¹ï¼ŒStackOverflow ç›¸å…³é—®é¢˜é˜…è¯»é‡ç ´ä¸‡ï¼Œé—®é¢˜æ´»è·ƒæ—¶é•¿è¶…è¿‡ 7 å¹´ã€‚ä»¥å‰æˆ‘å°±ç¢°åˆ°è¿‡ï¼Œå½“æ—¶å†™è¿™é‡Œçš„æ—¶å€™å°±æœ‰ç‚¹æ„Ÿè§‰ï¼Œä¼¼ä¹ç”¨ rstrip å¥½åƒä¸å¤ªå¦¥å½“ï¼Œä½†éšä¾¿æµ‹è¯•äº†å‡ ä¸ªä¾‹å­æ²¡é—®é¢˜ä¹Ÿå°±è¿™ä¹ˆç”¨äº†ã€‚</p><h3 id="æ­£åˆ™"><a href="#æ­£åˆ™" class="headerlink" title="æ­£åˆ™"></a>æ­£åˆ™</h3><p>è§£å†³è¿™ç§é—®é¢˜çš„ä¸€ä¸ªæ–¹æ³•æ˜¯ç”¨æ­£åˆ™ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">re.sub(<span class="string">&#x27;^&#x27;</span> + re.escape(prefix), <span class="string">&#x27;&#x27;</span>, s)  <span class="comment"># åˆ å‰ç¼€</span></span><br><span class="line">re.sub(re.escape(suffix) + <span class="string">&#x27;$&#x27;</span>, <span class="string">&#x27;&#x27;</span>, s)  <span class="comment"># åˆ åç¼€</span></span><br></pre></td></tr></table></figure><p>è¦å¯¼ä¸ªåŒ…ï¼Œéº»çƒ¦ã€‚ä»£ç å¯è¯»æ€§ä¹Ÿä½ï¼Œæ•ˆç‡â€¦.ä¼°è®¡ä¹Ÿä¸æ€ä¹ˆæ ·ã€‚</p><h3 id="åˆ‡ç‰‡"><a href="#åˆ‡ç‰‡" class="headerlink" title="åˆ‡ç‰‡"></a>åˆ‡ç‰‡</h3><p>å¦ä¸€ç§æ–¹æ³•æ˜¯ç”¨åˆ‡ç‰‡è§£å†³ï¼Œä»£ç å¯ä»¥å°è£…åœ°å¥½çœ‹ä¸€ç‚¹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Reference https://www.python.org/dev/peps/pep-0616/</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">removeprefix</span>(<span class="params">self: <span class="built_in">str</span>, prefix: <span class="built_in">str</span>, /</span>) -&gt; str:</span></span><br><span class="line">    <span class="keyword">if</span> self.startswith(prefix):</span><br><span class="line">        <span class="keyword">return</span> self[<span class="built_in">len</span>(prefix):]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> self[:]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">removesuffix</span>(<span class="params">self: <span class="built_in">str</span>, suffix: <span class="built_in">str</span>, /</span>) -&gt; str:</span></span><br><span class="line">    <span class="comment"># suffix=&#x27;&#x27; should not call self[:-0].</span></span><br><span class="line">    <span class="keyword">if</span> suffix <span class="keyword">and</span> self.endswith(suffix):</span><br><span class="line">        <span class="keyword">return</span> self[:-<span class="built_in">len</span>(suffix)]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> self[:]</span><br></pre></td></tr></table></figure><h3 id="å®˜æ–¹"><a href="#å®˜æ–¹" class="headerlink" title="å®˜æ–¹"></a>å®˜æ–¹</h3><p>å®é™…ä¸Šï¼Œä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œ<a href="https://www.python.org/dev/peps/pep-0616/">PEP 616 â€“ String methods to remove prefixes and suffixes</a> æå‡ºäº†ä¸“é—¨ç”¨æ¥åˆ å‰ç¼€/åç¼€çš„æ–¹æ³•ï¼Œè¿™æ˜¯ Python 3.9 çš„æ–°ç‰¹æ€§ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s.removeprefix(<span class="string">&#x27;prefix&#x27;</span>)</span><br><span class="line">s.removesuffix(<span class="string">&#x27;suffix&#x27;</span>)</span><br></pre></td></tr></table></figure><p>P.S. å®˜æ–¹çš„ C å®ç°è¿˜æ˜¯å¾ˆæœ‰æ„æ€çš„ï¼Œå¯ä»¥å»çœ‹çœ‹ï¼š<a href="https://github.com/python/cpython/pull/18939/files">cpython/pull/18939</a> ã€‚</p><p>ä½†è¿™é‡Œæˆ‘çš„ç¯å¢ƒæ˜¯ Python 3.7ï¼Œæ‰€ä»¥åªèƒ½ç”¨å‰ä¸¤ç§æ–¹æ³•æ‰‹æ’¸ä¸€ä¸ªå•¦ã€‚</p><h2 id="TL-DR-å¤ªé•¿ä¸çœ‹"><a href="#TL-DR-å¤ªé•¿ä¸çœ‹" class="headerlink" title="TL;DR å¤ªé•¿ä¸çœ‹"></a>TL;DR å¤ªé•¿ä¸çœ‹</h2><p>ç”¨ <code>str.rstrip</code> æ¥åˆ é™¤å­—ç¬¦ä¸²åç¼€æ˜¯é”™è¯¯çš„ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåˆ é™¤å‚æ•°ä¸­å„å­—ç¬¦çš„ä»»æ„ç»„åˆã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">&quot;emmm.md&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.rstrip(<span class="string">&#x27;.md&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;e&#x27;</span></span><br></pre></td></tr></table></figure><p>è§£å†³æ–¹æ³•ï¼š</p><ol><li>ç”¨ Python 3.9ï¼š<code>s.removesuffix(&#39;suffix&#39;)</code></li><li>æ­£åˆ™è¡¨è¾¾å¼ï¼š<code>re.sub(re.escape(suffix) + &#39;$&#39;, &#39;&#39;, s)</code></li><li>endswith + åˆ‡ç‰‡ï¼š</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">removesuffix</span>(<span class="params">s: <span class="built_in">str</span>, suffix: <span class="built_in">str</span></span>) -&gt; str:</span></span><br><span class="line">    <span class="keyword">if</span> suffix <span class="keyword">and</span> self.endswith(suffix):</span><br><span class="line">        <span class="keyword">return</span> self[:-<span class="built_in">len</span>(suffix)]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> self[:]</span><br></pre></td></tr></table></figure><hr><p>å¥½äº†ï¼Œè¿™èŠ‚è¯¾æˆ‘ä»¬ä¸å¾€ä¸‹è®²äº†ï¼Œå‰©ä¸‹çš„æ—¶é—´æ¥åšä¸ªå°ç»ƒä¹ ï¼Œçœ‹çœ‹ä»Šå¤©çš„çŸ¥è¯†å¤§å®¶å­¦åºŸäº†å—ã€‚ã€‚ã€‚ï¼ˆ**â€™è ¢â€™.capitalize()**ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># See you!</span></span><br><span class="line"><span class="string">&#x27;CDFMLR 2020-11-24 11:22&#x27;</span>.rstrip(<span class="string">&#x27;:2333&#x27;</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Introducing Sham</title>
      <link href="/2020/11/16/blog/Intro_sham/"/>
      <url>/2020/11/16/blog/Intro_sham/</url>
      
        <content type="html"><![CDATA[<h1 id="Introducing-Sham"><a href="#Introducing-Sham" class="headerlink" title="Introducing: Sham"></a>Introducing: Sham</h1><p>1024é‚£å¤©å†™äº†ç¯‡çš„æ–‡ç« ã€Š<a href="https://blog.csdn.net/u012419550/article/details/109258117">Python ä»£ç ä¸€é”®è½¬æµç¨‹å›¾</a>ã€‹ã€‚CSDN å±…ç„¶ç»™äº†ä¸ª â€œæœ€è¶£å‘³â€å¥–ğŸ†ï¼š<a href="https://blogdev.blog.csdn.net/article/details/109536460">https://blogdev.blog.csdn.net/article/details/109536460</a> ã€‚</p><p>ä¸€å¼€å§‹æˆ‘æ˜¯ä¸çŸ¥é“è·å¥–çš„äº‹çš„ï¼Œï¼ˆå®³ï¼Œå’±æƒ³éƒ½ä¸æ•¢æƒ³ï¼‰ï¼Œç›´åˆ°æœ‰ä¸€å¤©ï¼Œ CSDN çš„å°å§å§ä¸»åŠ¨æ¥åŠ æˆ‘å¾®ä¿¡ï¼Œæ€’æ–¥æˆ‘ä»æœªå¡«å†™æ”¶è´§åœ°å€[æ‚è„¸]ã€‚ã€‚ã€‚</p><p>ç»å†äº†ä¸€äº›æ›²æŠ˜ï¼Œå‰ä¸¤å¤©æˆ‘ç»ˆäºè¿˜æ˜¯æ”¶åˆ°äº† CSDN çš„å¥–å“ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gkrcr94smgj30vm0u0kjo.jpg" alt="æˆªå±2020-11-16 21.49.18"></p><p>æ„Ÿè°¢ CSDN ğŸ™ã€‚</p><p>ä¸è¿‡ï¼Œè¿™ä¸æ˜¯ä»Šå¤©çš„ä¸»é¢˜ï¼Œ<del>åªæ˜¯ç‚«è€€ä¸€ä¸‹</del>ã€‚ä»Šå¤©è¦è®²çš„æ•…äº‹æ˜¯ï¼š</p><p><strong>æˆ‘è¿™ä¸ªäººä¸æ‡‚ä»€ä¹ˆæ“ä½œç³»ç»Ÿï¼Œäºæ˜¯æˆ‘ç”¨ Go è¯­è¨€æ¨¡æ‹Ÿå‡ºäº†ä¸€ä¸ªâ€¦â€¦</strong></p><h2 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h2><p>ä»¥å‰çœ‹è¿‡ä¸€ç¯‡æ–‡ç« å«åšã€Š<a href="https://mp.weixin.qq.com/s/eezs6MTL-quuG0q5jBoMyw">æˆ‘è¿™ä¸ªäººä¸æ‡‚ä»€ä¹ˆCPUï¼Œäºæ˜¯æˆ‘ç”¨ä»£ç æ¨¡æ‹Ÿå‡ºäº†ä¸€ä¸ª</a>ã€‹ã€‚è¿™ç¯‡æ–‡ç« ä»‹ç»äº†ä¸€ä½å¤§ä½¬ä¸€è¨€ä¸åˆç”¨ Go è¯­è¨€æ¨¡æ‹Ÿäº†ä¸€å°è®¡ç®—æœºï¼ˆé¡¹ç›®ï¼š<a href="https://github.com/djhworld/simple-computer">djhworld/simple-computer</a>ï¼‰çš„æ•…äº‹ï¼Œå¸…çˆ†äº†å¥½å—ã€‚</p><p>è¿™å­¦æœŸæœ‰æ“ä½œç³»ç»Ÿè¯¾ï¼Œä¸Šè¿™ä¸ªè¯¾ç¨‹çš„ä¸»è¦æ”¶è·å°±æ˜¯ï¼Œè¯¾ä¸Šé‚£äº›æ´»åœ¨ PPT ä¸­çš„ç®—æ³•ï¼Œå°±å¾ˆè¿·ï¼æˆ‘æ˜¯ä¸å¤ªå–œæ¬¢è¿™ç§æ–¹å¼çš„ï¼Œæˆ‘å¥‰è¡Œ <em>Talk is cheap. Show me the code.</em></p><p>æ‰€ä»¥ï¼Œæˆ‘ä¹Ÿç”¨ Go è¯­è¨€æ¨¡æ‹Ÿäº†ä¸€ä¸ªâ€œæ“ä½œç³»ç»Ÿâ€â€”â€”ä¸€ä¸ªæ‹¥æœ‰æ ‡å‡†è¾“å…¥è¾“å‡ºä¸è¿›ç¨‹é—´é€šä¿¡çš„ã€åŸºäºæ—¶é—´ç‰‡è½®è½¬è°ƒåº¦çš„å¤šé“ç¨‹åºè¿è¡Œå™¨ï¼š<a href="https://github.com/cdfmlr/sham">cdfmlr/sham</a> ï¼ˆsham æ„ä¸ºï¼šéª—å±€ã€è™šå‡äº‹ç‰©ï¼‰ã€‚</p><p>å–åå«åš sham å°±æ˜¯å¸Œæœ›å¤§å®¶åŸè°…æˆ‘çš„æ ‡é¢˜å…šè¡Œä¸ºï¼Œäº‹å®ä¸Šï¼Œè¿™ä¸ªä¸œè¥¿è¿œè°ˆä¸ä¸Šä¸€ä¸ªâ€œæ“ä½œç³»ç»Ÿâ€ï¼Œå’Œ <a href="https://github.com/djhworld/simple-computer">djhworld/simple-computer</a> ç­‰ç±»ä¼¼çš„ä¼˜ç§€é¡¹ç›®æ¯”èµ·æ¥ï¼Œï¼Œæˆ‘åšçš„ä»€ä¹ˆéƒ½ä¸æ˜¯ã€‚ä½†æˆ‘åªåšäº†ä¸åˆ° 10 åˆ†é’Ÿçš„è®¾è®¡ï¼Œå¹¶ç”¨ä¸åˆ° 2k è¡Œä»£ç å®ç°äº†å®ƒã€‚ä½œä¸ºä¸šä½™è’Ÿè’»å®ç°çš„ç©å…·é¡¹ç›®ï¼Œä½ è¿˜èƒ½å¯¹å®ƒæœ‰ä»€ä¹ˆæ›´é«˜çš„è¦æ±‚å‘¢ï¼Ÿ</p><p>ä¸‹é¢ï¼Œä»‹ç» Sham ç³»ç»Ÿã€‚</p><h2 id="Sham-ç³»ç»Ÿæ¦‚è¿°"><a href="#Sham-ç³»ç»Ÿæ¦‚è¿°" class="headerlink" title="Sham ç³»ç»Ÿæ¦‚è¿°"></a>Sham ç³»ç»Ÿæ¦‚è¿°</h2><p>åœ¨è¿™é‡Œï¼Œç®€è¦ä»‹ç»ç³»ç»Ÿä¸­çš„ä¸€äº›å…³é”®è®¾è®¡æ€è·¯ã€‚</p><p>è‡³äºå…·ä½“çš„å®ç°ï¼Œäº‹å®ä¸Šï¼Œè¿™ä¸ªé¡¹ç›®éå¸¸ç®€å•ï¼Œè€Œä¸”æˆ‘å†™äº†ä¸å°‘æ³¨é‡Šï¼Œåœ¨ git commit message ä¸­ä¹Ÿç•™ä¸‹äº†ï¼ˆåœ¨æˆ‘çœ‹æ¥ï¼‰è¾ƒä¸ºè¯¦ç»†çš„è¯´æ˜ï¼Œå¦‚æœæ‚¨ä¸ä»‹æ„ï¼Œå®Œå…¨å¯ä»¥å»è¯»ä¸€è¯»æºç ï¼š</p><ul><li><a href="https://github.com/cdfmlr/sham">https://github.com/cdfmlr/sham</a></li><li>å¤‡ä»½ï¼š<a href="https://gitee.com/cdfmlr/sham">https://gitee.com/cdfmlr/sham</a></li></ul><p>å½“ç„¶ï¼Œå¦‚æœä½ å–œæ¬¢è¿™ä¸ªé¡¹ç›®ï¼Œæ¬¢è¿ Starã€Forkã€Watch ä¸‰è¿ã€‚å¦‚æœæœ‰ä»»ä½•ç–‘é—®ã€æ„è§æˆ–å»ºè®®ï¼Œä¹Ÿæ¬¢è¿ Issue å’Œ PRã€‚</p><h3 id="æŠ½è±¡ç»“æ„"><a href="#æŠ½è±¡ç»“æ„" class="headerlink" title="æŠ½è±¡ç»“æ„"></a>æŠ½è±¡ç»“æ„</h3><p>è¿™ä¸ªæ¨¡æ‹Ÿçš„æ“ä½œç³»ç»Ÿä¸­ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹æŠ½è±¡ï¼š</p><ul><li>CPUï¼šä¸€ä¸ªå¸¦æœ‰äº’æ–¥é”çš„ç»“æ„ï¼Œå•ç‹¬åœ¨ä¸€ä¸ªåç¨‹ä¸­è¿è¡Œåº”ç”¨ç¨‹åºçš„çº¿ç¨‹ã€‚</li><li>å†…å­˜ï¼šä¸€ä¸ªæ— é™å¤§çš„ç»“æ„ï¼Œä¸éœ€è¦ç®¡ç†ã€‚</li><li>IOè®¾å¤‡ï¼šä¸€ä¸ªç‹¬ç«‹çš„è®¾å¤‡ï¼Œå•ç‹¬åœ¨ä¸€ä¸ªåç¨‹ä¸­è¿è¡Œï¼Œå¯ä»¥è¾“å…¥æˆ–è¾“å‡ºã€‚</li><li>æ“ä½œç³»ç»Ÿï¼šåŒ…æ‹¬æ“ä½œç³»ç»ŸåŸºç¡€ç»“æ„ã€è°ƒåº¦å™¨ã€ç³»ç»Ÿè°ƒç”¨ã€ä¸­æ–­å¤„ç†ç¨‹åºç»„ã€‚ä¸ºä¾‹ç®€åŒ–æ¨¡å‹ï¼Œæ“ä½œç³»ç»Ÿå•ç‹¬è¿è¡Œåœ¨ä¸€ä¸ªåç¨‹ä¸­ï¼Œå®ƒæœ¬èº«ä¸éœ€è¦åœ¨ CPUã€å†…å­˜ä¸Šè¿è¡Œï¼Œè€Œæ˜¯åœ¨å†…éƒ¨æŒæœ‰ CPU å’Œå†…å­˜ã€‚<ul><li>æ“ä½œç³»ç»ŸåŸºç¡€ç»“æ„ï¼šæŒæœ‰å¹¶ç®¡ç† CPUï¼Œå†…å­˜ã€IO è®¾å¤‡ã€è¿›ç¨‹è¡¨å’Œä¸­æ–­å‘é‡ã€‚</li><li>è°ƒåº¦å™¨ï¼šå®Œæˆè¿›ç¨‹è°ƒåº¦å·¥ä½œçš„å…·ä½“ç®—æ³•ã€‚</li><li>ç³»ç»Ÿè°ƒç”¨ï¼šä¸ºåº”ç”¨ç¨‹åºæä¾›çš„â€œå†…æ ¸æ€â€æ“ä½œæ¥å£ã€‚</li><li>ä¸­æ–­å¤„ç†ç¨‹åºï¼šå¤„ç†åº”ç”¨ç¨‹åºæˆ–æ“ä½œç³»ç»Ÿå†…éƒ¨å‘å‡ºçš„å„ç±»ä¸­æ–­ã€‚</li></ul></li><li>è¿›ç¨‹ã€çº¿ç¨‹ï¼šä¸ºäº†ç®€åŒ–æ¨¡å‹ï¼Œä¸€ä¸ªè¿›ç¨‹åªèƒ½æŒæœ‰ä¸”å¿…é¡»æŒæœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚<ul><li>è¿›ç¨‹ï¼šåŒ…æ‹¬ä¸€ä¸ªå¯è¿è¡Œçš„è¿›ç¨‹ã€å½“å‰çŠ¶æ€ï¼ˆè¿è¡Œã€å°±ç»ªã€é˜»å¡ï¼‰ä»¥åŠéœ€è¦çš„å„ç§èµ„æºï¼ˆå†…å­˜ç­‰ï¼‰ã€‚</li><li>çº¿ç¨‹ï¼šè¿›ç¨‹å…·ä½“å¯æ‰§è¡Œçš„éƒ¨åˆ†ï¼ŒåŒ…å«è¦è¿è¡Œçš„â€œç¨‹åºä»£ç â€ä»¥åŠè¿è¡Œæ—¶çš„ä¸Šä¸‹æ–‡ã€‚</li><li>ä¸Šä¸‹æ–‡ï¼šåŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨ã€è¿›ç¨‹æŒ‡é’ˆã€æ“ä½œç³»ç»Ÿæ¥å£ã€‚</li></ul></li><li>å…·ä½“åº”ç”¨ç¨‹åºï¼šè¿›ç¨‹çš„å®ä¾‹ï¼ˆåœ¨ <a href="./sham_test.go">sham_test.go</a> ä¸­å®ç°äº†ä¸€äº›æœ‰æ„æ€çš„åº”ç”¨ï¼‰ã€‚</li></ul><p>ç›®å‰çš„å®ç°ä¸­ï¼Œè°ƒåº¦å™¨ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªå¸¦æ—¶é—´ç‰‡è½®è½¬çš„ FCFS è°ƒåº¦å™¨ï¼Œä½†å¯ä»¥ååˆ†å®¹æ˜“åœ°æ·»åŠ ã€æ›¿æ¢æ–°çš„è°ƒåº¦ç®—æ³•ã€‚</p><h3 id="ç³»ç»Ÿçš„å·¥ä½œæµç¨‹"><a href="#ç³»ç»Ÿçš„å·¥ä½œæµç¨‹" class="headerlink" title="ç³»ç»Ÿçš„å·¥ä½œæµç¨‹"></a>ç³»ç»Ÿçš„å·¥ä½œæµç¨‹</h3><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gknstu9g88j31e00u0dkx.jpg" alt="æˆªå±2020-11-13 19.58.42"></p><h3 id="çº¿ç¨‹çš„è¿è¡Œ"><a href="#çº¿ç¨‹çš„è¿è¡Œ" class="headerlink" title="çº¿ç¨‹çš„è¿è¡Œ"></a>çº¿ç¨‹çš„è¿è¡Œ</h3><p>å…³äºçº¿ç¨‹çš„è¿è¡Œï¼Œç›´æ¥çœ‹ä¸€éƒ¨åˆ† Thread å…·ä½“ä»£ç å®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Thread çº¿ç¨‹ï¼šæ˜¯ä¸€ä¸ªå¯ä»¥åœ¨ CPU é‡Œè·‘çš„ä¸œè¥¿ã€‚</span></span><br><span class="line"><span class="keyword">type</span> Thread <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// runnable æ˜¯å®é™…è¦è¿è¡Œçš„å†…å®¹</span></span><br><span class="line">runnable Runnable</span><br><span class="line"><span class="comment">// contextual æ˜¯ Thread çš„ç¯å¢ƒ</span></span><br><span class="line">contextual *Contextual</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Runnable ç¨‹åºï¼šåº”ç”¨ç¨‹åºçš„å…·ä½“çš„ä»£ç å°±å†™åœ¨è¿™é‡Œé¢</span></span><br><span class="line"><span class="comment">// æ¯ä¸€æ¬¡è¿”å›å°±ä»£è¡¨â€œä¸€æ¡æŒ‡ä»¤â€ï¼ˆä¸€ä¸ªåŸå­æ“ä½œï¼‰æ‰§è¡Œå®Œæ¯•ï¼Œè¿”å›å€¼ä¸ºçŠ¶æ€ï¼š</span></span><br><span class="line"><span class="comment">//  - StatusRunning ç»§ç»­è¿è¡Œï¼ˆå¦‚æœæ—¶é—´ç‰‡æœªç”¨å°½ï¼‰</span></span><br><span class="line"><span class="comment">//  - StatusReady ä¼šè¿›å…¥å°±ç»ªé˜Ÿåˆ—ï¼ˆå³ yieldï¼Œä¸»åŠ¨è®©å‡º CPUï¼‰</span></span><br><span class="line"><span class="comment">//  - StatusBlocked ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼ˆä¸€èˆ¬ä¸ç”¨ã€‚éœ€è¦é˜»å¡æ—¶ä¸€èˆ¬é€šè¿‡ä¸­æ–­è¯·æ±‚ï¼‰</span></span><br><span class="line"><span class="comment">//  - StatusDone è¿›ç¨‹è¿è¡Œç»“æŸã€‚</span></span><br><span class="line"><span class="keyword">type</span> Runnable <span class="function"><span class="keyword">func</span><span class="params">(contextual *Contextual)</span> <span class="title">int</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿›ç¨‹çš„çŠ¶æ€</span></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">StatusBlocked = <span class="number">-1</span></span><br><span class="line">StatusReady   = <span class="number">0</span></span><br><span class="line">StatusRunning = <span class="number">1</span></span><br><span class="line">StatusDone    = <span class="number">2</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Contextual ä¸Šä¸‹æ–‡ï¼šçº¿ç¨‹çš„ä¸Šä¸‹æ–‡ã€‚</span></span><br><span class="line"><span class="keyword">type</span> Contextual <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="comment">// æŒ‡å‘ Process çš„æŒ‡é’ˆï¼Œå¯ä»¥å–ç”¨ Process çš„èµ„æº</span></span><br><span class="line">Process *Process</span><br><span class="line"><span class="comment">// é€šè¿‡ Contextual.OS.XX è°ƒç³»ç»Ÿè°ƒç”¨</span></span><br><span class="line">OS OSInterface</span><br><span class="line"><span class="comment">// ç¨‹åºè®¡æ•°å™¨</span></span><br><span class="line">PC <span class="keyword">uint</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“çš„åº”ç”¨ç¨‹åºæŠŠâ€œä»£ç â€å†™åœ¨ä¸€ä¸ª Runnable å‹çš„å‡½æ•°ä¸­ï¼Œè¿™ä¸ªå‡½æ•°æ¯æ‰§è¡Œå®Œä¸€ä¸ªåŸå­æ“ä½œå°±åº”è¯¥è¿”å›ä¸€æ¬¡ã€‚åŒæ—¶ runnable ä¹Ÿå¯ä»¥åœ¨æ‰§è¡Œå®Œä»»ä½•ä¸€ä¸ªåŸå­æ“ä½œæ—¶ï¼Œè¢«å¤–éƒ¨äº‹ä»¶å¼ºè¡Œæ‰“æ–­ï¼ˆæ¯”å¦‚æ—¶é—´ç‰‡ç”¨å°½ï¼‰ã€‚</p><p> <code>Thread.Run()</code>  å®ç°äº†ä¸Šè¿°æ§åˆ¶ï¼Œrunnable çš„è¿”å›ã€å¤–éƒ¨çš„æ‰“æ–­éƒ½ä¼šè¢« <code>Thread.Run()</code> æ•è·ã€‚å‰é¢çš„æµç¨‹å›¾ä¸­ï¼Œã€ŒCPU è¿è¡Œçº¿ç¨‹ã€ä¹Ÿå°±æ˜¯è°ƒç”¨ <code>Thread.Run()</code> æ–¹æ³•ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Run åŒ…è£…å¹¶è¿è¡Œ Thread çš„ runnableã€‚</span></span><br><span class="line"><span class="comment">// è¯¥å‡½æ•°è¿”å›çš„ doneã€cancel è®© runnable å˜å¾—å¯æ§ï¼š</span></span><br><span class="line"><span class="comment">// - å½“ runnable è¿”å›ï¼Œå³ Thread ç»“æŸæ—¶ï¼Œdone ä¼šæ¥æ”¶åˆ° Process/Thread çš„çŠ¶æ€ã€‚</span></span><br><span class="line"><span class="comment">// - å½“å¤–éƒ¨éœ€è¦å¼ºåˆ¶ç»ˆæ­¢ runnable çš„è¿è¡Œï¼ˆè°ƒåº¦ï¼‰ï¼Œè°ƒç”¨ cancel() å³å¯ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *Thread)</span> <span class="title">Run</span><span class="params">()</span> <span class="params">(done <span class="keyword">chan</span> <span class="keyword">int</span>, cancel context.CancelFunc)</span></span> &#123;</span><br><span class="line">done = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line">_ctx, cancel := context.WithCancel(context.Background())</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> &#123; <span class="comment">// ä¸€æ¡æ¡ä»£ç ä¸åœè·‘ï¼Œç›´åˆ°é˜»å¡ï½œé€€å‡ºï½œè¢«å–æ¶ˆ</span></span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> &lt;-_ctx.Done(): <span class="comment">// è¢«å–æ¶ˆï¼Œå–æ¶ˆç”± CPU å‘èµ·</span></span><br><span class="line">                <span class="comment">// å–æ¶ˆæ—¶ CPU ä¼šä¸´æ—¶ç½® Status ä¸ºéœ€è¦è½¬åˆ°çš„çŠ¶æ€ï¼Œ</span></span><br><span class="line"><span class="comment">// è¿™é‡Œè·å–å¹¶æŠŠè¿™ä¸ªå€¼ä¼ ç»™æ“ä½œç³»ç»Ÿ</span></span><br><span class="line"><span class="comment">// åŒæ—¶æŠŠçŠ¶æ€é‡ç½®ä¸º StatusRunning</span></span><br><span class="line">                <span class="comment">//ï¼ˆçŠ¶æ€è½¬åŒ–éœ€ç”±æ“ä½œç³»ç»Ÿå®Œæˆï¼Œè¿™é‡Œåªæ˜¯æš‚æ—¶å€Ÿç”¨è¿™ä¸ªå€¼ï¼Œæ•…è¦è¿˜åŸï¼‰</span></span><br><span class="line">s := t.contextual.Process.Status</span><br><span class="line">t.contextual.Process.Status = StatusRunning</span><br><span class="line">done &lt;- s</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">ret := t.runnable(t.contextual)</span><br><span class="line">                t.contextual.Commit()  <span class="comment">// PC++, clockTick()</span></span><br><span class="line"><span class="keyword">if</span> ret != StatusRunning &#123; <span class="comment">// ç»“æŸ|é˜»å¡|å°±ç»ªï¼Œäº¤ç»™è°ƒåº¦å™¨å¤„ç†</span></span><br><span class="line">done &lt;- ret</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> done, cancel</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨ go è¯­è¨€æ ‡å‡†åº“çš„ context åŒ…ï¼Œæ§åˆ¶çº¿ç¨‹è¿è¡Œçš„å–æ¶ˆï¼ˆå¤–éƒ¨æ‰“æ–­ï¼‰ã€‚å¦‚æœæ²¡æœ‰å¤–éƒ¨æ‰“æ–­ï¼Œrunnable è¿”å›æ—¶å°±ä¼šå°†ç¨‹åºè®¡æ•°å™¨å’Œæ—¶é’ŸåŠ ä¸€ã€‚å¦‚æœ runnable ä¸€ç›´è¿”å› StatusRunning å°±å¯ä»¥ä¸€ç›´è¿è¡Œä¸‹å»ã€‚åœ¨ runnable å†…éƒ¨ï¼Œé€šè¿‡ <code>contextual.PC</code> ä»¥åŠä¾‹å¦‚ <code>switch</code> çš„æµç¨‹æ§åˆ¶è¯­å¥å³å¯å®ç°ä¸€æ¡æ¡ä»£ç æ‰§è¡Œçš„æ•ˆæœã€‚</p><p>ä¾‹å¦‚ï¼Œä¸‹é¢çš„è¿™ä¸ª Runnable å‡½æ•°ï¼ˆç¨‹åºï¼‰æœ‰ 4 ä¸ªæ“ä½œï¼ˆ4 æ¡æŒ‡ä»¤ï¼‰å®ƒä»¬ä¼šä¾æ¬¡æ‰§è¡Œï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">processSeq</span><span class="params">(contextual *Contextual)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> contextual.PC &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        log.Debug(<span class="string">&quot;Line 0&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> StatusRunning</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        log.Debug(<span class="string">&quot;Line 1&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> StatusRunning</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        log.Debug(<span class="string">&quot;Line 2&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> StatusRunning</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">return</span> StatusDone</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> StatusDone</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„å†™æ³•æœ‰äº›åƒæ±‡ç¼–è¯­è¨€ï¼Œè€Œäº‹å®ä¸Šï¼Œrunnable ç”šè‡³å°±æ˜¯è¿™ä¸ªæ¨¡æ‹Ÿçš„æ“ä½œç³»ç»Ÿçš„æœºå™¨è¯­è¨€ï¼æ‰€ä»¥å†™èµ·æ¥ç•¥ä¸ºç¹çï¼Œè¿™ä¸ªéš¾ä»¥é¿å…ã€‚</p><p>è¿è¡Œçš„æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gkndrmwyhcj31hm09sn1b.jpg" alt="æˆªå±2020-11-13 11.21.54"></p><p><strong>æ³¨</strong>ï¼šæŠŠä¸Šé¢çš„ç¨‹åºç¿»è¯‘æˆæˆ‘ä»¬å¹³æ—¶çš„ Go ç¨‹åºå°±æ˜¯ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">func <span class="title">processSeq</span><span class="params">()</span> <span class="keyword">int</span> </span>&#123;</span><br><span class="line">    <span class="built_in">log</span>.Debug(<span class="string">&quot;Line 0&quot;</span>)</span><br><span class="line"><span class="built_in">log</span>.Debug(<span class="string">&quot;Line 1&quot;</span>)</span><br><span class="line"><span class="built_in">log</span>.Debug(<span class="string">&quot;Line 2&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> StatusDone</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸­æ–­ä¸-IO"><a href="#ä¸­æ–­ä¸-IO" class="headerlink" title="ä¸­æ–­ä¸ IO"></a>ä¸­æ–­ä¸ IO</h3><p>ä¸­æ–­åœ¨æ“ä½œç³»ç»Ÿä¸­è‡³å…³é‡è¦ï¼Œæ‰€ä»¥è¿™ä¸ªæ¨¡æ‹Ÿçš„æ“ä½œç³»ç»Ÿä¹Ÿéœ€è¦ä¸­æ–­çš„å®ç°ã€‚</p><p>è¿™é‡Œå¯¹ä¸­æ–­çš„å»ºæ¨¡å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Interrupt <span class="keyword">struct</span> &#123;</span><br><span class="line">Typ     <span class="keyword">string</span></span><br><span class="line">Handler InterruptHandler</span><br><span class="line">Data    InterruptData</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// InterruptHandler æ˜¯ã€Œä¸­æ–­å¤„ç†ç¨‹åºã€</span></span><br><span class="line"><span class="keyword">type</span> InterruptHandler <span class="function"><span class="keyword">func</span><span class="params">(os *OS, data InterruptData)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// InterruptData æ˜¯ä¸­æ–­çš„æ•°æ®</span></span><br><span class="line"><span class="keyword">type</span> InterruptData <span class="keyword">struct</span> &#123;</span><br><span class="line">Pid <span class="keyword">string</span></span><br><span class="line"><span class="comment">// Channel æ˜¯ç”¨æ¥ç»™ä¸­æ–­å‘èµ·ç¨‹åºä¸ä¸­æ–­å¤„ç†ç¨‹åºé€šä¿¡çš„ä¿¡é“ã€‚</span></span><br><span class="line">Channel <span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸­æ–­åŒ…å«ä¸€ä¸ªç±»å‹ï¼Œå¤„ç†ç¨‹åºï¼ˆå¤„ç†ç¨‹åºå’Œä¸­æ–­ç±»å‹ä¸€ä¸€å¯¹åº”ï¼‰ï¼Œä»¥åŠé™„åŠ çš„æ•°æ®ã€‚</p><p>åº”ç”¨ç¨‹åºï¼Œæˆ–æ“ä½œç³»ç»Ÿå†…éƒ¨éƒ½å¯ä»¥é€šè¿‡ä¸€ä¸ª<strong>ç³»ç»Ÿè°ƒç”¨</strong>å‘å‡ºä¸­æ–­ï¼ˆè¿™ä¸ªæ¨¡æ‹Ÿä¸­å‡ ä¹æ²¡æœ‰ç¡¬ä»¶ï¼Œæ‰€ä»¥ä¸è€ƒè™‘ç¡¬ä»¶ä¸­æ–­ï¼‰ã€‚æ“ä½œç³»ç»Ÿå—åˆ°ä¸­æ–­è¯·æ±‚ï¼Œä¼šæŠŠä¸­æ–­æ”¾å…¥ä¸€ä¸ªä¸­æ–­è¡¨ï¼Œç„¶ååœ¨å½“å‰æ—¶é’Ÿå‘¨æœŸç»“æŸåï¼Œè°ƒåº¦è¿è¡Œæ—¶ç¨‹åºé˜»å¡ï¼Œä¾æ¬¡è°ƒç”¨ç›¸åº”ä¸­æ–­å¤„ç†ç¨‹åºå¤„ç†ä¸­æ–­è¡¨é‡Œçš„ä¸­æ–­ã€‚</p><p>ä¸­æ–­å¤„ç†ç¨‹åºä¼šåšå¿…è¦çš„å·¥ä½œï¼Œå®Œæˆåè§£é™¤å‘èµ·è¿›ç¨‹çš„é˜»å¡çŠ¶æ€ã€‚</p><p>æœ‰äº†è¿™ä¸ªä¸­æ–­æœºåˆ¶ï¼Œå°±å¯ä»¥å¾ˆå®¹æ˜“åœ°å®ç°æ—¶é—´ç‰‡è½®è½¬â€”â€”åœ¨æ—¶é—´ç‰‡ç”¨å°½åï¼Œå‘å‡ºä¸€ä¸ªæ—¶é’Ÿä¸­æ–­ï¼Œå…¶å¤„ç†ç¨‹åºä¼šæŠŠè¿›ç¨‹å°±ç»ªã€‚</p><p>åŒæ—¶ï¼Œä¸­æ–­æ”¯æŒäº†å„ç§ IO è®¾å¤‡çš„ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œæœ€ç®€å•çš„æ˜¯ä½¿ç”¨æ ‡å‡†è¾“å‡ºï¼Œå‘å‡ºä¸€ä¸ªæ ‡å‡†è¾“å‡ºçš„ä¸­æ–­è¯·æ±‚ï¼Œä¼ å…¥éœ€è¦çš„æ•°æ®å³å¯ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">helloWorld</span><span class="params">(contextual *Contextual)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;, <span class="number">1</span>)</span><br><span class="line">    ch &lt;- <span class="string">&quot;Hello, world!&quot;</span></span><br><span class="line">    contextual.OS.InterruptRequest(contextual.Process.Thread, </span><br><span class="line">                                   StdOutInterrupt, ch)</span><br><span class="line">    <span class="keyword">return</span> StatusDone</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¸­æ–­çš„å¤„ç†ç¨‹åºä¼šä½¿ç”¨æ ‡å‡†è¾“å‡ºè®¾å¤‡ï¼Œå®Œæˆè¾“å‡ºã€‚è¿è¡Œç»“æœï¼š</p><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gkndndoqc4j31jc0dk7au.jpg" alt="æˆªå±2020-11-13 11.18.57"></p><p>å‡ºäº†æ ‡å‡†è¾“å…¥ï¼Œæˆ‘è¿˜å®ç°äº†æ ‡å‡†è¾“å‡ºè®¾å¤‡ï¼Œä»¥åŠç‰¹æ®Šçš„ Pipe è®¾å¤‡ã€‚è¿™ä¸¤ä¸ªä¸œè¥¿çš„è°ƒç”¨ä»£ç éƒ½æ¯”è¾ƒå¤æ‚ï¼Œåœ¨æ­¤ä¸åšæ¼”ç¤ºã€‚</p><p>æ ‡å‡†è¾“å…¥ã€è¾“å‡ºéƒ½æ˜¯æ¨¡æ‹Ÿçš„â€œç¡¬ä»¶â€ï¼Œè¿™äº›ä¸œè¥¿ä¼šå•ç‹¬åœ¨ä¸€ä¸ªåç¨‹ä¸­è¿è¡Œã€‚è€Œ Pipe è®¾å¤‡åˆ™æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„è®¾å¤‡ï¼Œå®ƒæ˜¯å¯¹ Go è¯­è¨€ channel çš„å°è£…ã€‚æ“ä½œç³»ç»Ÿå¯ä»¥åŠ¨æ€ç”Ÿæˆä»»æ„å¤šä¸ª Pipe å¹¶åˆ†é…ç»™éœ€è¦çš„è¿›ç¨‹ï¼Œé€šè¿‡ Pipe è¿›ç¨‹ä¹‹é—´å°±å¯ä»¥åˆ©ç”¨ CSP æ¨¡å‹å¯ä»¥å®Œæˆé€šä¿¡ä¸åŒæ­¥ã€‚</p><p>åˆ©ç”¨ Pipe è®¾å¤‡ï¼Œåœ¨è¿™ä¸ªæ¨¡æ‹Ÿçš„æ“ä½œç³»ç»Ÿä¸­ï¼Œå¯ä»¥å®ç°ã€Œç”Ÿäº§è€…-æ¶ˆè´¹è€…ã€é—®é¢˜ã€‚ä»£ç ç¨å¾®å¤æ‚ï¼ˆéœ€è¦çº¦ 150 è¡Œä»£ç ï¼Œè§ <a href="./sham_test.go">sham_test.go</a> ä¹‹ TestProducerConsumerï¼‰ï¼Œä½†å®Œå…¨å¯ä»¥æ­£ç¡®å·¥ä½œï¼š</p><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gknf17o30tj31jj0u0hbm.jpg" alt="æˆªå±2020-11-13 12.07.16"></p><h2 id="Sham-ç¨‹åºè®¾è®¡"><a href="#Sham-ç¨‹åºè®¾è®¡" class="headerlink" title="Sham ç¨‹åºè®¾è®¡"></a>Sham ç¨‹åºè®¾è®¡</h2><p>ä½œä¸ºç³»ç»Ÿå¯ç”¨æ€§çš„<del>ä¸ä¸¥è°¨</del>è¯æ˜ï¼Œä¸‹é¢ç»™å‡ºä¸€ä»½ Sham ç¨‹åºè®¾è®¡æŒ‡å—ã€‚</p><p>åœ¨ Sham æºç çš„ <a href="https://github.com/cdfmlr/sham/blob/master/sham_test.go">sham_test.go</a> æ–‡ä»¶ä¸­ï¼ŒåŒ…å«äº†ä¸€ç³»åˆ—å¼€å‘è¿‡ç¨‹ä¸­æµ‹è¯•ä½¿ç”¨çš„åº”ç”¨ç¨‹åºå®ç°ã€‚æˆ‘ä»¬å®Œå…¨å¯ä»¥æŠŠè¿™ä¸ªæ–‡ç« çœ‹ä½œ Sham ç¨‹åºè®¾è®¡çš„å®˜æ–¹å®ä¾‹ã€‚ä¸‹æ–‡ä¸­ä»»ä½•ä¸æ˜æœ—éƒ¨åˆ†éƒ½è¯·å‚è€ƒé‚£äº›å®ä¾‹ã€‚</p><h3 id="å¦‚ä½•è¿è¡Œ-Sham"><a href="#å¦‚ä½•è¿è¡Œ-Sham" class="headerlink" title="å¦‚ä½•è¿è¡Œ Sham?"></a>å¦‚ä½•è¿è¡Œ Sham?</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">shamOS := NewOS()</span><br><span class="line">shamOS.Scheduler = FCFSScheduler&#123;&#125;</span><br><span class="line"><span class="comment">// shamOS.ReadyProcs = []*Process&#123;&#125; // No Noop</span></span><br><span class="line"></span><br><span class="line">shamOS.CreateProcess(...)</span><br><span class="line">shamOS.CreateProcess(...)</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">shamOS.Boot()</span><br></pre></td></tr></table></figure><p>è·å–ä¸€ä¸ª OS å®ä¾‹ï¼ŒæŒ‡å®šè°ƒåº¦å™¨ï¼ˆFCFSScheduler æ˜¯å…ˆæ¥å…ˆæœåŠ¡ç®—æ³•ï¼‰ï¼Œæ·»åŠ åº”ç”¨ç¨‹åºè¿›ç¨‹ï¼Œç„¶å Boot å°±å¼€å§‹è¿è¡Œäº†ï¼</p><p>ç³»ç»Ÿçš„å°±ç»ªé˜Ÿåˆ—ä¸­é»˜è®¤æœ‰ä¸€ä¸ª Noopï¼ˆNO OPerationï¼‰è¿›ç¨‹ï¼Œè¿™ä¸ªè¿›ç¨‹ä»€ä¹ˆä¹Ÿä¸åšã€‚å¦‚æœä¸éœ€è¦ï¼Œå¯ä»¥å‚è€ƒè¢«æ³¨é‡Šæ‰çš„ç¬¬ä¸‰è¡Œä»£ç åˆ é™¤å®ƒã€‚</p><p>è°ƒç”¨ <code>shamOS.CreateProcess</code> å¯ä»¥ç»™ç³»ç»Ÿä¸­æ–°å»ºè¿›ç¨‹ï¼Œæ–°çš„è¿›ç¨‹ä¼šè¢«æ­£ç¡®åˆå§‹åŒ–ï¼Œå¹¶æ”¾å…¥å°±ç»ªé˜Ÿåˆ—ç­‰å¾…è¿è¡Œï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(os *OS)</span> <span class="title">CreateProcess</span><span class="params">(pid <span class="keyword">string</span>, precedence <span class="keyword">uint</span>, timeCost <span class="keyword">uint</span>, runnable Runnable)</span></span></span><br></pre></td></tr></table></figure><p>precedence å’Œ timeCost æ˜¯ç»™ç•™ç‰¹å®šçš„è°ƒåº¦ç®—æ³•ä½¿ç”¨çš„ï¼Œå¦‚æœä½¿ç”¨ FCFSScheduler å°±æ²¡ä»€ä¹ˆç”¨ï¼Œéšä¾¿å†™å³å¯ï¼Œrunnable å°±æ˜¯å…·ä½“çš„ç¨‹åºä»£ç äº†ï¼Œä¸‹é¢å°±ä»‹ç» runnable çš„å†™æ³•ã€‚</p><h3 id="é¡ºåºç¨‹åº"><a href="#é¡ºåºç¨‹åº" class="headerlink" title="é¡ºåºç¨‹åº"></a>é¡ºåºç¨‹åº</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">processSeq</span><span class="params">(contextual *Contextual)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> contextual.PC &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        log.Debug(<span class="string">&quot;Line 0&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> StatusRunning</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        log.Debug(<span class="string">&quot;Line 1&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> StatusRunning</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        log.Debug(<span class="string">&quot;Line 2&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> StatusRunning</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">return</span> StatusDone</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> StatusDone</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å€ŸåŠ© <code>switch contextual.PC</code> å’Œ <code>return StatusRunning</code> ä¸€ä¸ªæ—¶é’Ÿæ‰§è¡Œä¸€ä¸ªæ“ä½œã€‚å½“ç¨‹åºç»“æŸæ—¶ï¼Œ<code>return StatusDone</code>ã€‚</p><p>æ³¨ï¼šè¿™é‡Œæ˜¯è°ƒç”¨äº† logï¼ˆgithub.com/sirupsen/logrusï¼Œæ‰“ä¸€æ¡æ—¥å¿—ï¼‰ï¼Œè¿™å…¶å®æ˜¯ä¸ªã€Œè¶…ç³»ç»Ÿè°ƒç”¨ã€ï¼Œè°ƒç”¨äº† sham ä»¥å¤–çš„ä¸œè¥¿ã€‚ä½œä¸ºæµ‹è¯•ï¼Œè¿™æ²¡é—®é¢˜ã€‚</p><h3 id="ç³»ç»Ÿè°ƒç”¨"><a href="#ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨"></a>ç³»ç»Ÿè°ƒç”¨</h3><p>å¦‚æœä½ å¯¹åˆšæ‰çš„ã€Œè¶…ç³»ç»Ÿè°ƒç”¨ã€æ„Ÿè§‰ä¸çˆ½ï¼Œé‚£æ²¡å…³ç³»ï¼Œä¸‹é¢å°±ä»‹ç» Sham çš„ç³»ç»Ÿè°ƒç”¨ã€‚å…¶å®ä¹‹å‰æˆ‘ä»¬ä½¿ç”¨çš„ <code>CreateProcess</code> å°±æ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼š</p><ul><li><code>CreateProcess(pid string, precedence uint, timeCost uint, runnable Runnable)</code></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">shamOS.CreateProcess(<span class="string">&quot;processFoo&quot;</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="function"><span class="keyword">func</span><span class="params">(contextual *Contextual)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    contextual.OS.CreateProcess(<span class="string">&quot;ProcessBar&quot;</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="function"><span class="keyword">func</span><span class="params">(contextual *Contextual)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;ProcessBar, a Process dynamic created by processFoo&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> StatusDone</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> StatusDone</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä½¿ç”¨ <code>contextual.OS.XXX</code> å®Œæˆç³»ç»Ÿè°ƒç”¨ã€‚è¿™é‡Œ processFoo è°ƒç”¨ <code>CreateProcess</code> æ–°å»ºäº†ä¸€ä¸ªè¿›ç¨‹ ProcessBarã€‚ </p><p>è¿˜æœ‰ä¸€ä¸ªæ›´æœ‰ç”¨çš„ç³»ç»Ÿè°ƒç”¨â€”â€”ä¸­æ–­è¯·æ±‚ï¼š</p><ul><li><code>InterruptRequest(thread *Thread, typ string, channel chan interface&#123;&#125;)</code></li></ul><p>thread æ˜¯å‘èµ·ä¸­æ–­çš„è¿›ç¨‹ï¼Œä¸€èˆ¬æ˜¯å½“å‰çº¿ç¨‹è‡ªå·±ï¼š <code>contextual.Process.Thread</code> ï¼Œtyp æ˜¯è¦è°ƒç”¨çš„ä¸­æ–­ç±»å‹ï¼Œchannel æ˜¯å½“å‰çº¿ç¨‹ä¸ä¸­æ–­å¤„ç†ç¨‹åºç›´æ¥é€šä¿¡çš„ã€‚</p><p>ç”±äºå½“å‰çº¿ç¨‹ä¸ä¸­æ–­å¤„ç†ç¨‹åºæ˜¾ç„¶ä¸åŒæ­¥ï¼Œchannel å¿…é¡»æ˜¯å¸¦ç¼“å†²åŒºçš„ï¼</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">helloWorld</span><span class="params">(contextual *Contextual)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;, <span class="number">1</span>)</span><br><span class="line">    ch &lt;- <span class="string">&quot;Hello, world!&quot;</span></span><br><span class="line">    contextual.OS.InterruptRequest(contextual.Process.Thread, </span><br><span class="line">                                   StdOutInterrupt, ch)</span><br><span class="line">    <span class="keyword">return</span> StatusDone</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›®å‰å¯ç”¨çš„ä¸­æ–­ç±»å‹æœ‰ï¼š</p><table><thead><tr><th>typ</th><th>è¯´æ˜</th><th>channel</th></tr></thead><tbody><tr><td><code>StdOutInterrupt</code></td><td>è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º</td><td>æ”¾å…¥è¯è¾“å‡ºçš„ä¸œè¥¿</td></tr><tr><td><code>StdInInterrupt</code></td><td>ä»æ ‡å‡†è¾“å…¥è·å–è¾“å…¥</td><td>ä¸€ä¸ªç©º chanï¼Œæ ‡å‡†è¾“å…¥ä¼šå†™ä¸œè¥¿è¿›å»</td></tr><tr><td><code>NewPipeInterrupt</code></td><td>æ–°å»ºä¸€ä¸ª Pipe è®¾å¤‡</td><td>æ”¾å…¥ pipeID å’Œ pipeBufferSize</td></tr><tr><td><code>GetPipeInterrupt</code></td><td>è·å–ä¸€ä¸ª Pipe è®¾å¤‡</td><td>æ”¾å…¥ pipeID</td></tr></tbody></table><p>å…³äº Pipe åé¢å†è¯¦ç»†ä»‹ç»ã€‚</p><p>ä½¿ç”¨æ ‡å‡†è¾“å…¥æ—¶ï¼Œéœ€è¦æ³¨æ„ï¼ŒæŠŠ chan æ”¾åˆ° sham çº¿ç¨‹çš„å†…å­˜ä¸­ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ä¸€ä¸ª go å˜é‡ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">shamOS.CreateProcess(<span class="string">&quot;processIn&quot;</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="function"><span class="keyword">func</span><span class="params">(contextual *Contextual)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    mem := &amp;contextual.Process.Memory[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> contextual.PC &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        in := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;, <span class="number">1</span>)</span><br><span class="line">        <span class="comment">// in ä¼šåœ¨å¤šä¸ªå‘¨æœŸä¸­è¢«ä½¿ç”¨ï¼Œéœ€è¦æ”¾å…¥å†…å­˜</span></span><br><span class="line">        mem.Content = <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;&#123;<span class="string">&quot;in&quot;</span>: in&#125;</span><br><span class="line">        contextual.OS.InterruptRequest(contextual.Process.Thread, </span><br><span class="line">                                       StdInInterrupt, in)</span><br><span class="line">        <span class="keyword">return</span> StatusRunning</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        in := mem.Content.(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;)[<span class="string">&quot;in&quot;</span>]</span><br><span class="line"></span><br><span class="line">        content := &lt;-in</span><br><span class="line">        log.WithField(<span class="string">&quot;content&quot;</span>, content).Debug(<span class="string">&quot;got content&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> StatusDone</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> StatusDone</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="å˜é‡ä½¿ç”¨"><a href="#å˜é‡ä½¿ç”¨" class="headerlink" title="å˜é‡ä½¿ç”¨"></a>å˜é‡ä½¿ç”¨</h3><p>ç¨‹åºä¸­å½“ç„¶æ˜¯éœ€è¦ä½¿ç”¨å˜é‡çš„ã€‚ä½†ä»åˆšæ‰çš„æ ‡å‡†è¾“å‡ºç¨‹åºå¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨ sham çš„å†…å­˜æä¸ºéº»çƒ¦ï¼è€Œé‚£äº›ä»å†…å­˜è¯»å†™å˜é‡çš„æ“ä½œéå¸¸å¥—è·¯åŒ–ï¼Œæ‰€ä»¥æˆ‘å°è£…äº†ä¸€ä¸ª <code>VarPool</code> æ¥æ–¹ä¾¿å˜é‡è¯»å†™ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">contextual.InitVarPool()  <span class="comment">// åˆå§‹åŒ–å˜é‡æ± </span></span><br><span class="line">contextual.SetVar(<span class="string">&quot;varName&quot;</span>, something)  <span class="comment">// æ”¾å…¥ï¼ˆæ–°å»ºæˆ–æ›´æ–°ï¼‰å˜é‡</span></span><br><span class="line">something := contextual.GetVar(<span class="string">&quot;varName&quot;</span>)  <span class="comment">// è¯»å–å˜é‡ï¼Œå¦‚æœä¸å­˜åœ¨ä¼šå¾—åˆ° nil</span></span><br><span class="line">something, ok := contextual.TryGetVar(<span class="string">&quot;varName&quot;</span>)  <span class="comment">// è¯»å–å˜é‡ï¼ŒokæŒ‡ä½¿å˜é‡æ˜¯å¦å­˜åœ¨</span></span><br></pre></td></tr></table></figure><p>E.g.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">shamOS.CreateProcess(<span class="string">&quot;useVarPool&quot;</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="function"><span class="keyword">func</span><span class="params">(contextual *Contextual)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> contextual.PC == <span class="number">0</span>:</span><br><span class="line">        contextual.InitVarPool()</span><br><span class="line">        </span><br><span class="line">        contextual.SetVar(<span class="string">&quot;chOutput&quot;</span>, <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> StatusRunning</span><br><span class="line">    <span class="keyword">case</span> contextual.PC &lt;= <span class="number">3</span>:</span><br><span class="line">        contextual.SetVar(<span class="string">&quot;num&quot;</span>, contextual.PC*contextual.PC)</span><br><span class="line"></span><br><span class="line">        chOut := contextual.GetVar(<span class="string">&quot;chOutput&quot;</span>).(<span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">        </span><br><span class="line">        chOut &lt;- fmt.Sprintln(contextual.GetVar(<span class="string">&quot;num&quot;</span>), chOut)</span><br><span class="line">        contextual.OS.InterruptRequest(contextual.Process.Thread, StdOutInterrupt, chOut)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> StatusRunning</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> StatusDone</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="æ¡ä»¶-å¾ªç¯"><a href="#æ¡ä»¶-å¾ªç¯" class="headerlink" title="æ¡ä»¶/å¾ªç¯"></a>æ¡ä»¶/å¾ªç¯</h3><p>æ¡ä»¶ã€å¾ªç¯è¿™é‡Œåšçš„ä¸å¤ªå¥½ï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚éœ€è¦å¤§å®¶æ‰‹åŠ¨ç»´æŠ¤é¢å¤–çš„ç¨‹åºè®¡æ•°å™¨ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> PipeProduct = <span class="string">&quot;pipe_product&quot;</span></span><br><span class="line"></span><br><span class="line">shamOS.CreateProcess(<span class="string">&quot;producer&quot;</span>, <span class="number">10</span>, <span class="number">100</span>, <span class="function"><span class="keyword">func</span><span class="params">(contextual *Contextual)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> contextual.PC &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        contextual.InitVarPool()</span><br><span class="line">        contextual.SetVar(<span class="string">&quot;chOutput&quot;</span>, <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> StatusRunning</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        pipeArgs := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;, <span class="number">2</span>)</span><br><span class="line">        pipeArgs &lt;- PipeProduct <span class="comment">// pipeId</span></span><br><span class="line">        pipeArgs &lt;- <span class="number">3</span>           <span class="comment">// pipeBufferSize</span></span><br><span class="line">        contextual.OS.InterruptRequest(contextual.Process.Thread, </span><br><span class="line">                                       NewPipeInterrupt, pipeArgs)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> StatusRunning</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">if</span> contextual.PC &gt; <span class="number">30</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> StatusDone</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        _, ok := contextual.TryGetVar(<span class="string">&quot;dpc&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> !ok &#123;</span><br><span class="line">            contextual.SetVar(<span class="string">&quot;dpc&quot;</span>, <span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        dpc := contextual.GetVar(<span class="string">&quot;dpc&quot;</span>).(<span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> dpc &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            product := contextual.PC</span><br><span class="line"></span><br><span class="line">            contextual.SetVar(<span class="string">&quot;product&quot;</span>, product)</span><br><span class="line"></span><br><span class="line">            contextual.SetVar(<span class="string">&quot;dpc&quot;</span>, <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> StatusRunning</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            pipe := <span class="keyword">interface</span>&#123;&#125;(</span><br><span class="line">                contextual.Process.Devices[PipeProduct]).(*Pipe)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> pipe.Inputable() &#123;</span><br><span class="line">                product := contextual.GetVar(<span class="string">&quot;product&quot;</span>)</span><br><span class="line"></span><br><span class="line">                pipe.Input() &lt;- product</span><br><span class="line"></span><br><span class="line">                contextual.SetVar(<span class="string">&quot;dpc&quot;</span>, <span class="number">0</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> StatusReady <span class="comment">// yield</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> StatusRunning</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç æ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ä¸­çš„ç”Ÿäº§è€…çº¿ç¨‹ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ª <code>dpc</code> å˜é‡å®ç°äº†ç±»ä¼¼äº <code>JMP</code> æŒ‡ä»¤çš„è·³è½¬åŠŸèƒ½ã€‚</p><p>è¿™æ®µä»£ç ä¸­å…³äº Pipe ä¸å¤ªå¥½ç†è§£ï¼Œæ‰€ä»¥ä¸‹é¢ä»‹ç» Pipeã€‚</p><h3 id="è¿›ç¨‹é€šä¿¡-Pipe"><a href="#è¿›ç¨‹é€šä¿¡-Pipe" class="headerlink" title="è¿›ç¨‹é€šä¿¡: Pipe"></a>è¿›ç¨‹é€šä¿¡: Pipe</h3><p>Pipe æ˜¯ Sham ä¸­çš„ä¸€ç§ç‰¹æ®Š IO è®¾å¤‡ï¼Œå®ƒæ˜¯å¯¹ Golang chan çš„å°è£…ï¼Œå®ƒæä¾›äº† Sham è¿›ç¨‹é—´é€šä¿¡çš„èƒ½åŠ›ã€‚</p><p>åˆ›å»º Pipeï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pipeArgs := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;, <span class="number">2</span>)</span><br><span class="line">pipeArgs &lt;- <span class="string">&quot;pipeID&quot;</span>  <span class="comment">// pipeId</span></span><br><span class="line">pipeArgs &lt;- <span class="number">3</span>         <span class="comment">// pipeBufferSize</span></span><br><span class="line">contextual.OS.InterruptRequest(contextual.Process.Thread, </span><br><span class="line">                               NewPipeInterrupt, pipeArgs)</span><br></pre></td></tr></table></figure><p>å…¶ä»–è¿›ç¨‹è·å– Pipeï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pipeArgs := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;, <span class="number">2</span>)</span><br><span class="line">pipeArgs &lt;- <span class="string">&quot;pipeID&quot;</span> <span class="comment">// pipeId</span></span><br><span class="line"></span><br><span class="line">contextual.OS.InterruptRequest(contextual.Process.Thread, </span><br><span class="line">                               GetPipeInterrupt, pipeArgs)</span><br></pre></td></tr></table></figure><p><code>NewPipeInterrupt</code> å’Œ <code>GetPipeInterrupt</code> ä¸­æ–­è¯·æ±‚è¢«æˆåŠŸå¤„ç†ä¹‹åï¼Œæ“ä½œç³»ç»Ÿä¼šæŠŠæ–°å»ºçš„/è·å–åˆ°çš„ Pipe åˆ†é…ç»™è¿›ç¨‹ï¼Œé€šè¿‡ contextual å¯ä»¥è·å–ï¼š<code>contextual.Process.Devices[&quot;pipeID&quot;]</code>ã€‚æˆ‘ä»¬ä¼šè·å–åˆ°ä¸€ä¸ª Device ç±»å‹çš„ä¸œè¥¿ï¼Œä¸ºäº†å…·ä½“ä½¿ç”¨æ—¶æ–¹ä¾¿ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå®ƒè½¬åŒ–ä¸º *Pipe ç±»å‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pipe := <span class="keyword">interface</span>&#123;&#125;(contextual.Process.Devices[PipeProduct]).(*Pipe)</span><br></pre></td></tr></table></figure><p>åœ¨è¯»å†™ Pipe çš„æ—¶å€™éœ€è¦æ³¨æ„è¾¹ç•Œæ¡ä»¶ï¼Œä¸å¯è¯»æ—¶å¼ºè¡Œå»è¯»ä¼šé€ æˆæ­»é”ã€‚</p><p>å†™ï¼šåœ¨ <code>pipe.Inputable()</code> æ—¶ <code>pipe.Input() &lt;- something</code>ï¼Œå¦åˆ™è¯´æ˜é˜»å¡ï¼Œä¸»åŠ¨è®©å‡º CPUï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> pipe.Inputable() &#123;</span><br><span class="line">    pipe.Input() &lt;- contextual.GetVar(<span class="string">&quot;product&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> StatusReady <span class="comment">// yield</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯»ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œæ£€æµ‹â€”è¯»å–â€”å¦åˆ™è®©å‡º CPUï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> pipe.Outputable() &#123;</span><br><span class="line">    contextual.SetVar(<span class="string">&quot;product&quot;</span>, &lt;-pipe.Output())</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> StatusReady <span class="comment">// yield</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ–‡ç« ç»“æŸä¹‹å‰"><a href="#æ–‡ç« ç»“æŸä¹‹å‰" class="headerlink" title="æ–‡ç« ç»“æŸä¹‹å‰"></a>æ–‡ç« ç»“æŸä¹‹å‰</h2><p>æ— è®ºæ‚¨æ˜¯æŠ€æœ¯æ¯”æˆ‘å¼ºçš„å¤§ä½¬ï¼Œæˆ–æ˜¯åœ¨æŸä¸€æ–¹é¢æ¯”æˆ‘ç¨å¼±çš„åŒå­¦ï¼Œçœ‹åˆ°è¿™é‡Œå¯èƒ½éƒ½ä¼šéª‚ä¸€å£°â€”â€”â€œä»€ä¹ˆä¸œè¥¿ï¼Ÿâ€</p><p>ä¸ºäº†å›ç­”æ‚¨çš„ç–‘é—®ï¼Œæˆ‘æƒ³é‡è¿°æˆ‘å¯¹ Sham çš„å®šä¹‰ï¼š</p><blockquote><p><a href="https://github.com/cdfmlr/sham">cdfmlr/sham</a> ï¼ˆsham æ„ä¸ºï¼šéª—å±€ã€è™šå‡äº‹ç‰©ï¼‰ï¼šä¸€ä¸ªæ‹¥æœ‰æ ‡å‡†è¾“å…¥è¾“å‡ºä¸è¿›ç¨‹é—´é€šä¿¡çš„ã€åŸºäºæ—¶é—´ç‰‡è½®è½¬è°ƒåº¦çš„å¤šé“ç¨‹åºè¿è¡Œå™¨ã€‚</p></blockquote><p>è¿™æ˜¯æˆ‘åœ¨å­¦ä¹ æ“ä½œç³»ç»Ÿæ—¶çš„ä¸ªäººå¨±ä¹ä½œå“ã€‚å®ƒçš„åŠŸèƒ½ã€æ•´ä½“è®¾è®¡ã€ä»£ç ç»†èŠ‚éƒ½åšçš„å¾ˆå·®ï¼Œå› ä¸ºå®ƒæœ€åˆçš„è®¾è®¡ï¼Œä»…æ˜¯ä¸ºäº†å¼€ç©ç¬‘å†™å‡ºçš„ 200 ä½™ä¸ªå­—ç¬¦ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gkrbyvn0lkj30u0145gx2.jpg" alt="æˆªå±2020-11-16 21.23.28"></p><p>å¦‚æœæ‚¨å–œæ¬¢è¿™ä¸ªé¡¹ç›®ï¼Œæ¬¢è¿ Starã€Fork å’Œ PRã€‚å¦‚æœæ‚¨ä¸å–œæ¬¢è¿™ä¸œè¥¿ï¼Œæˆ–æœ‰ä»»ä½•çœ‹æ³•ã€ç–‘é—®ã€æ„è§æˆ–å»ºè®®ï¼Œä¹Ÿæ¬¢è¿ Issueï¼Œæœ›ä¸åèµæ•™ä¸ºæ„Ÿï¼</p><hr><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">shamOS := NewOS()</span><br><span class="line">shamOS.Scheduler = FCFSScheduler&#123;&#125;</span><br><span class="line">shamOS.ReadyProcs = []*Process&#123;&#125;</span><br><span class="line"></span><br><span class="line">shamOS.CreateProcess(<span class="string">&quot;SeeYou&quot;</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="function"><span class="keyword">func</span><span class="params">(contextual *Contextual)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    eof := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;, <span class="number">1</span>)</span><br><span class="line">    eof &lt;- <span class="string">&quot;By CDFMLR \n 2020.11.16&quot;</span></span><br><span class="line">    contextual.OS.InterruptRequest(contextual.Process.Thread, </span><br><span class="line">                                   StdOutInterrupt, eof)</span><br><span class="line">    <span class="keyword">return</span> StatusDone</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">shamOS.Boot()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Python ä»£ç è½¬æµç¨‹å›¾</title>
      <link href="/2020/10/24/blog/PyFlowchart/"/>
      <url>/2020/10/24/blog/PyFlowchart/</url>
      
        <content type="html"><![CDATA[<h1 id="Python-ä»£ç è½¬æµç¨‹å›¾"><a href="#Python-ä»£ç è½¬æµç¨‹å›¾" class="headerlink" title="Python ä»£ç è½¬æµç¨‹å›¾"></a>Python ä»£ç è½¬æµç¨‹å›¾</h1><p>åœ¨è®¾è®¡ç¨‹åºæ—¶ï¼Œç±»å›¾ã€æµç¨‹å›¾éƒ½æ˜¯å¾ˆæœ‰ç”¨çš„å·¥å…·ï¼Œæˆ‘ä»¬æœ‰å¾ˆå¤šå·¥å…·æ¥ç»˜åˆ¶è¿™äº›å›¾çº¸ï¼Œç”šè‡³è¿˜èƒ½ç”¨å®ƒä»¬ç”Ÿæˆæœ€åŸºæœ¬çš„æ¡†æ¶ä»£ç ã€‚ä¹Ÿæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æŠŠå·²ç»å†™å¥½çš„ä»£ç åå‘è½¬æˆç±»å›¾ã€æµç¨‹å›¾ï¼Œæ¯”å¦‚<del>å†™ä½œä¸š</del>å’Œåˆ«äººåˆ†äº«è®¾è®¡çš„æ—¶å€™ã€‚</p><p>ä»£ç è½¬ç±»å›¾ä¹Ÿæœ‰æŒºå¤šå·¥å…·çš„ï¼ŒVS Codeã€IntelliJ IDEA è¿™äº›å¸¸ç”¨çš„ IDE éƒ½å¯ä»¥è£…æ’ä»¶æ¥å®Œæˆè¿™ä¸€å·¥ä½œã€‚è€Œå¦‚æœä½ åšå¾®è½¯å®¶çš„å¼€å‘ï¼ŒVisual Studio å¯é€‰å®‰è£…çš„â€œç±»è®¾è®¡å™¨â€ï¼Œæ›´æ˜¯å¼ºåˆ°ä¸åƒè¯ï¼Œè½»æ¾åŠæ‰“æˆ‘è§è¿‡çš„å…¶ä»–ä»»ä½•åŒç±»å·¥å…·ï¼Œå°±è¿™ä¸€ç‚¹æ¥è¯´ï¼Œ VS å¯¹å¾—èµ·ã€Œå®‡å®™ç¬¬ä¸€ IDEã€çš„ç§°å·ã€‚</p><p>ç„¶è€Œï¼Œä»£ç è½¬æµç¨‹å›¾ï¼Œç›¸å¯¹æ¥è¯´ï¼Œè¿™ä¸ªéœ€æ±‚å°‘ä¸€äº›ï¼Œå·¥å…·ä¹Ÿæ²¡é‚£ä¹ˆä¸°å¯Œã€‚æœ€è¿‘æˆ‘çªç„¶éœ€è¦æŠŠä¸€äº› Python ä»£ç è½¬æˆæµç¨‹å›¾ï¼ŒGoogle ç¿»äº†ä¸¤é¡µï¼ŒGitHub æœäº†å‡ ä¸ªé¡¹ç›®ï¼Œå‘ç°ç°æœ‰çš„å®ç°éƒ½ä¸å¤ªè¡Œï¼šè¦ä¹ˆç”¨çš„æŠ€æœ¯å¤ªæ€ªï¼ˆé‚£äº›ç”¨ã€Œæ­£åˆ™è¡¨è¾¾å¼ã€æ­£é¢ä¸Šçš„å¯éœ‡æ’¼äº†æˆ‘ä¸€ä¸‹åˆï¼‰ï¼Œè¦ä¹ˆè·‘ä¸èµ·æ¥ï¼ˆä¾èµ–æ¡ä»¶è‹›åˆ»ï¼Œæ¯”å¦‚æŸäº›é¡¹ç›®ç”¨äº†å¯¹ macOS ä¸å¤ªå‹å¥½çš„ PyGameï¼‰ï¼Œè¦ä¹ˆè·‘å‡ºæ¥å¤ªä¸‘ï¼ˆå‡Œä¹±çš„çº¿æ¡ã€å¥‡æ€ªçš„é¢œè‰²ï¼Œä¸æ˜¯æ–°ä¸‘é£ï¼Œæ˜¯ä¸‘åˆ°æŠ½é£ï¼‰ã€‚ å½“æˆ‘çœ‹åˆ°æŸé«˜èµé¡¹ç›® <a href="https://github.com/Vatsha/code_to_flowchart">Vatsha/code_to_flowchart</a> ç”šè‡³é›†åˆäº†ä¸Šè¿°ä¸‰å¤§â€œä¼˜ç‚¹â€æ—¶ï¼Œï¼Œï¼Œæˆ‘é€‰æ‹©äº†è‡ªå·±åŠ¨æ‰‹æ’¸ä¸€ä¸ª python to flowchart çš„å·¥å…·ã€‚</p><p>å½“ç„¶ï¼Œæˆ‘ä¸æ˜¯å–· <a href="https://github.com/Vatsha/code_to_flowchart">Vatsha/code_to_flowchart</a>ï¼Œåªæ˜¯å…¶ä¸€äº›ç»†èŠ‚çœŸçš„æ¬ ä¼˜ï¼Œæœ‰å¾ˆå¤§çš„æ”¹è¿›ç©ºé—´ã€‚ä½†ä¸å¾—ä¸è¯´ï¼Œä»–çš„è®¾è®¡ç®€å•æœ‰æ•ˆ ï¼Œç”¨ PyGame åšå¯è§†åŒ–ä¹Ÿå¾ˆæœ‰æ–°æ„ã€‚å…¶å®ï¼Œæˆ‘åœ¨åšè‡ªå·±çš„å®ç°æ—¶ä¹Ÿå¤§é‡å‚è€ƒäº†è¿™ä¸ªé¡¹ç›®ã€‚</p><hr><p>æˆ‘çš„è§£å†³æ–¹æ¡ˆ <a href="https://github.com/cdfmlr/pyflowchart">PyFlowchart</a> åŸºäºå¤§åé¼é¼çš„ flowchart.jsã€‚</p><p>ï¼ˆæœ¬æ¥æˆ‘æ˜¯å–åå«åš PyFlow çš„ï¼Œä¸Šä¼  PyPi çš„æ—¶å€™å‘ç°é‡åäº†ğŸ¤¦â€â™‚ï¸ã€‚æ‰€ä»¥æ”¹æˆäº† PyFlowchartï¼‰</p><h2 id="flowchart-js"><a href="#flowchart-js" class="headerlink" title="flowchart.js"></a>flowchart.js</h2><p>å¦‚æœä½ ä½¿ç”¨ Typoraï¼Œå¯èƒ½çŸ¥é“åœ¨ Typora ä¸­ç”¨  ```flow å¯ä»¥ç”¨ä¸€ç§ç®€å•çš„æ–‡æœ¬è¯­è¨€æ¥å†™æµç¨‹å›¾ï¼Œæ ¹æ® <a href="https://support.typora.io/Draw-Diagrams-With-Markdown/#flowcharts">Typora çš„æ–‡æ¡£</a>ï¼Œè¿™ä¸ªåŠŸèƒ½æ¥è‡ªå¼€æºçš„ <a href="https://github.com/adrai/flowchart.js">flowchart.js</a>ã€‚</p><p>æˆ‘çš„æ–¹æ¡ˆå°±æ˜¯æŠŠ Python ä»£ç è½¬åŒ–æˆè¿™ç§ flowchart è¯­è¨€ï¼Œç„¶åä½ å°±å¯ä»¥å€ŸåŠ©  <a href="http://flowchart.js.org/">flowchart.js.org</a>ã€<a href="https://www.typora.io/">Typora</a>ã€ <a href="https://github.com/francoislaberge/diagrams/#flowchart">francoislaberge/diagrams</a> ç­‰ç­‰å·¥å…·æ¥ç”Ÿæˆæµç¨‹å›¾äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">st&#x3D;&gt;start: Start</span><br><span class="line">op&#x3D;&gt;operation: Your Operation</span><br><span class="line">cond&#x3D;&gt;condition: Yes or No?</span><br><span class="line">e&#x3D;&gt;end</span><br><span class="line"></span><br><span class="line">st-&gt;op-&gt;cond</span><br><span class="line">cond(yes)-&gt;e</span><br><span class="line">cond(no)-&gt;op</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk07vvnullj30uo0luaa3.jpg" alt="flowchart"></p><h2 id="PyFlowchart"><a href="#PyFlowchart" class="headerlink" title="PyFlowchart"></a>PyFlowchart</h2><p>ä¸‹é¢ç®€è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨æˆ‘å®ç°çš„ PyFlowchartï¼Œæ›´è¯¦ç»†çš„è¯´æ˜è¯·çœ‹é¡¹ç›®çš„ <a href="https://github.com/cdfmlr/pyflowchart/blob/master/README.md">README</a>ã€‚</p><p>å®‰è£… PyFlowchartï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip3 install pyflowchart</span><br></pre></td></tr></table></figure><p>å†™ä¸€ä¸ª <code>simple.py</code> æ–‡ä»¶ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">if</span> a:</span><br><span class="line">        print(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">            print(<span class="string">&quot;b&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br></pre></td></tr></table></figure><p>è¿è¡Œ PyFlowchartï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python3 -m pyflowchart simple.py</span><br></pre></td></tr></table></figure><p>å®ƒä¼šè¾“å‡º flowchart ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">st4439920016&#x3D;&gt;start: start foo</span><br><span class="line">io4439920208&#x3D;&gt;inputoutput: input: a, b</span><br><span class="line">cond4439920592&#x3D;&gt;condition: if a</span><br><span class="line">sub4439974736&#x3D;&gt;subroutine: print(&#39;a&#39;)</span><br><span class="line">io4439974672&#x3D;&gt;inputoutput: output:  (a + b)</span><br><span class="line">e4439974352&#x3D;&gt;end: end function return</span><br><span class="line">cond4439974224&#x3D;&gt;operation: print(&#39;b&#39;) while  i in range(3)</span><br><span class="line"></span><br><span class="line">st4439920016-&gt;io4439920208</span><br><span class="line">io4439920208-&gt;cond4439920592</span><br><span class="line">cond4439920592(yes)-&gt;sub4439974736</span><br><span class="line">sub4439974736-&gt;io4439974672</span><br><span class="line">io4439974672-&gt;e4439974352</span><br><span class="line">cond4439920592(no)-&gt;cond4439974224</span><br><span class="line">cond4439974224-&gt;io4439974672</span><br></pre></td></tr></table></figure><p>è®¿é—® <a href="http://flowchart.js.org/">flowchart.js.org</a>ï¼ŒæŠŠä¸Šé¢ç”Ÿæˆçš„ä»£ç ç²˜è´´åˆ°æ–‡æœ¬æ¡†é‡Œï¼Œå³è¾¹å°±ä¼šè‡ªåŠ¨ç”Ÿæˆæµç¨‹å›¾äº†ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk083edrrgj312j0sc4d2.jpg" alt="flowchart.js.org æˆªå›¾ï¼Œå·¦è¾¹çš„è¾“å…¥æ¡†é‡Œç²˜è´´äº†ç”Ÿæˆçš„ä»£ç ï¼Œå³è¾¹æ˜¯ç”»å‡ºçš„æµç¨‹å›¾"></p><p>å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥æŠŠè¿™äº›ä»£ç æ”¾åˆ° Typora çš„ flow ä»£ç å—é‡Œï¼Œä¹Ÿä¼šè‡ªåŠ¨ç”Ÿæˆæµç¨‹å›¾ã€‚å¦‚æœä½ å–œæ¬¢ä½¿ç”¨å‘½ä»¤è¡Œï¼Œä¹Ÿå¯ä»¥ç”¨ <a href="https://github.com/francoislaberge/diagrams/#flowchart">francoislaberge/diagrams</a> æ¥ç”Ÿæˆæµç¨‹å›¾ã€‚</p><p>å¦‚æœç”Ÿæˆçš„æµç¨‹å›¾æœ‰è®©äººä¸æ»¡æ„çš„åœ°æ–¹ï¼ˆæ¯”å¦‚ï¼Œçº¿æ¡é‡å ï¼‰æˆ–è€…ä½ å–œæ¬¢æŒ‡å®šæ ·å¼ï¼Œå‚è€ƒ <a href="http://flowchart.js.org/">flowchart.js.org</a>ï¼Œæ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸‹ç”Ÿæˆçš„ flowchart å°±å¯ä»¥äº†ï¼Œéå¸¸æ–¹ä¾¿ã€‚</p><h2 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">st&#x3D;&gt;start: start PyFlowchart</span><br><span class="line">in&#x3D;&gt;inputoutput: input python source code</span><br><span class="line">sub1&#x3D;&gt;subroutine: code to ast</span><br><span class="line">sub2&#x3D;&gt;subroutine: ast to node graph</span><br><span class="line">sub3&#x3D;&gt;subroutine: node graph to flowchart</span><br><span class="line">out&#x3D;&gt;inputoutput: output flowchart</span><br><span class="line">e&#x3D;&gt;end: end</span><br><span class="line"></span><br><span class="line">st-&gt;in-&gt;sub1(right)-&gt;sub2(right)-&gt;sub3-&gt;out-&gt;e</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0bxkyis0j31k00u0tb8.jpg" alt="å®ç°åŸç†æµç¨‹å›¾"></p><p>PyFlowchart åˆ©ç”¨ Python å†…ç½®çš„ <a href="https://docs.python.org/zh-cn/3/library/ast.html">ast</a> åŒ…ï¼ŒæŠŠä»£ç è½¬åŒ–æˆ ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ï¼Œç„¶åæŠŠ AST è½¬åŒ–æˆè‡ªå·±å®šä¹‰çš„ Node ç»„æˆçš„å›¾ï¼Œæ¯ä¸ª Node å¯¹åº”ä¸€ä¸ª flowchart ä¸­çš„ nodeï¼Œéå†è¿™ä¸ªå›¾å°±å¯ä»¥å¾—åˆ°æµç¨‹å›¾äº†ã€‚</p><p>å…³äº ast åŒ…ï¼Œå¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://pycoders-weekly-chinese.readthedocs.io/en/latest/issue3/static-modification-of-python-with-python-the-ast-module.html">AST æ¨¡å—ï¼šç”¨ Python ä¿®æ”¹ Python ä»£ç </a>ï¼Œè™½ç„¶å¾ˆè€ï¼Œä½†ååˆ†ç®€å•æ˜“æ‡‚ã€‚æ€»è€Œè¨€ä¹‹ï¼Œåˆ©ç”¨ ast åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸€æ®µ Python ä»£ç è½¬åŒ–ä¸ºä¸€ä¸ªæ•°æ®ç»“æ„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> ast</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>expr = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"><span class="meta">... </span>def add(a, b):</span></span><br><span class="line"><span class="string"><span class="meta">... </span>    return a + b</span></span><br><span class="line"><span class="string"><span class="meta">... </span>&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>expr_ast = ast.parse(expr)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>expr_ast</span><br><span class="line">&lt;_ast.Module <span class="built_in">object</span> at <span class="number">0x10c773e10</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ast.dump(expr_ast)</span><br><span class="line"><span class="comment"># p.s. è¿™é‡Œæ‰‹åŠ¨åšäº†æ ¼å¼åŒ–</span></span><br><span class="line">Module(body=[FunctionDef(name=<span class="string">&#x27;add&#x27;</span>,</span><br><span class="line">  args=arguments(</span><br><span class="line">    args=[</span><br><span class="line">      arg(arg=<span class="string">&#x27;a&#x27;</span>, annotation=<span class="literal">None</span>),</span><br><span class="line">      arg(arg=<span class="string">&#x27;b&#x27;</span>, annotation=<span class="literal">None</span>)],</span><br><span class="line">    vararg=<span class="literal">None</span>, kwonlyargs=[], kw_defaults=[], kwarg=<span class="literal">None</span>, defaults=[]),</span><br><span class="line">  body=[Return(value=BinOp(</span><br><span class="line">    left=Name(<span class="built_in">id</span>=<span class="string">&#x27;a&#x27;</span>, ctx=Load()),</span><br><span class="line">    op=Add(),</span><br><span class="line">    right=Name(<span class="built_in">id</span>=<span class="string">&#x27;b&#x27;</span>, ctx=Load())))],</span><br><span class="line">  decorator_list=[],</span><br><span class="line">  returns=<span class="literal">None</span>)])</span><br></pre></td></tr></table></figure><p>å­¦ä¼šäº†è¿™ä¸ªä¸œè¥¿ï¼Œæ¥ä¸‹æ¥çš„å·¥ä½œå°±æ˜¯æŠŠè¿™ä¸ª expr_ast (_ast.Module å¯¹è±¡) ç¿»è¯‘æˆæµç¨‹å›¾äº†ã€‚æˆ‘ä»¬ç”¨é¢å‘å¯¹è±¡æ¥çš„æ–¹æ³•æ¥å®ç°ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk0b5o486pj31hz0u042n.jpg" alt="pyflowchart.node"></p><p><code>Node</code> æ˜¯æœ€æœ€åŸºç¡€çš„ç±»ï¼Œè¡¨ç¤ºæµç¨‹å›¾ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå…¶ä»–ä¸€åˆ‡éƒ½ç»§æ‰¿è‡ªå®ƒã€‚Node æœ‰èŠ‚ç‚¹ç±»å‹ã€åç§°ã€å†…å®¹ç­‰å±æ€§ï¼Œæä¾›çš„ <code>fc_definition()</code>ã€<code>fc_connection()</code> æ–¹æ³•å¯ä»¥æŠŠè‡ªå·±è½¬åŒ–ä¸º flowchart è¯­è¨€çš„å­—ç¬¦ä¸²ã€‚å¦å¤–çš„ <code>__visited</code> å’Œ <code>_traverse()</code> æ˜¯ç”¨æ¥éå†å›¾çš„ã€‚ä¸ flowchart ä¸­çš„ node types å¯¹åº”ï¼Œæˆ‘ä»¬å®ç°äº†å„ç§ Node çš„å­ç±»ï¼šStartNodeã€EndNodeã€OperationNodeâ€¦â€¦</p><p><code>NodesGroup</code> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ Nodeï¼Œå®ƒè‡ªå·±ä¸ä¼šå‡ºç°åœ¨ç”Ÿæˆçš„ flowchart ä¸­ï¼Œä½†å®ƒå¯ä»¥åŒ…å«ä¸€äº›å…¶ä»– Nodeã€‚è¿™ä¸ªè®¾è®¡æ˜¯å—åˆ° Android çš„ Viewã€ViewGroup çš„å¯å‘ï¼Œæœ‰äº†è¿™ä¸ª NodesGroupï¼Œif è¯­å¥ã€for / while å¾ªç¯è¿™æ ·æœ‰åµŒå¥—çš„ body çš„æƒ…å†µå°±å¾ˆå®¹æ˜“å¤„ç†äº†ã€‚</p><p><code>AstNode</code> è¡¨ç¤ºä¸€ä¸ªä» AST å¯¹è±¡å¾—åˆ°çš„ Nodeã€‚æ„é€  AstNodeï¼Œå°±æ˜¯æŠŠæŸä¸ª AST å¯¹è±¡ç¿»è¯‘æˆä¸€ä¸ª Nodeï¼ˆä¹Ÿå¯ä»¥æ˜¯ NodesGroupï¼‰ã€‚å…¶å­ç±»å°±å’Œå„ç§ ast å¯¹è±¡å¯¹åº”ï¼ˆä¹Ÿå°±å’Œ Python çš„å„ç§è¯­å¥å¯¹åº”ï¼‰ï¼š Ifã€Loopã€Return â€¦â€¦.</p><p><code>Flowchart</code> ä»£è¡¨ä¸€å¼ æµç¨‹å›¾ã€‚æµç¨‹å›¾å°±æ˜¯ä¸€å †è¿åœ¨ä¸€èµ·çš„èŠ‚ç‚¹å˜›ï¼Œæ‰€ä»¥ Flowchart æ˜¯ NodesGroup çš„å­ç±»ã€‚åœ¨å…¶ <code>from_code()</code> ä¸­æ–¹æ³•ä¸­ï¼Œå®ç°äº†ç”¨ ast åŒ…è§£æ Python ä»£ç ï¼Œå¾—åˆ° ast å¯¹è±¡çš„å·¥ä½œã€‚åœ¨ <code>flowchart()</code> æ–¹æ³•ä¸­ï¼Œéå†å›¾ï¼Œæ‹¿åˆ°æ‰€æœ‰èŠ‚ç‚¹çš„ flowchart è¡¨ç¤ºï¼Œæ±‡æ€»æˆä¸€å¼ å®Œæ•´çš„ flowchart æµç¨‹å›¾ã€‚ </p><p>å…¶å®è¿™ä¸ªä¸œè¥¿å¾ˆç®€å•ï¼Œæ›´å…·ä½“çš„å®ç°çœ‹æºç å°±å¾ˆå¥½ç†è§£äº†ï¼Œåœ¨æ­¤ä¸åšèµ˜è¿°ã€‚æ€»ç»“ä¸€ä¸‹ï¼š</p><ul><li>Flowchart ä¸­åˆ©ç”¨ ast åŒ…å®ç°äº† code to astï¼›</li><li>AstNode åŠå…¶å­ç±»å®ç°äº† ast to node graphï¼›</li><li>Node åŠå…¶å­ç±»å®ç°äº† node graph to flowchartã€‚</li></ul><p>é™„ä¸Šé¡¹ç›®åœ°å€ä¸å®Œæ•´å®ç°çš„ç±»å›¾ï¼š</p><ul><li><a href="https://github.com/cdfmlr/pyflowchart/">https://github.com/cdfmlr/pyflowchart/</a></li></ul><p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk09oeitndj33xl0u0wx7.jpg" alt="pyflowchart"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">by(<span class="string">&#x27;CDFMLR&#x27;</span>, <span class="string">&#x27;2020.10.24&#x27;</span>)</span><br><span class="line"><span class="comment"># ğŸ‰</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gccç¼–è¯‘æ—¶ä¼˜åŒ–</title>
      <link href="/2020/10/15/bullshit/a1_add_100a3_way1/"/>
      <url>/2020/10/15/bullshit/a1_add_100a3_way1/</url>
      
        <content type="html"><![CDATA[<h1 id="èƒ¡è¨€ä¹±è¯­ä¹‹gccä¼˜åŒ–"><a href="#èƒ¡è¨€ä¹±è¯­ä¹‹gccä¼˜åŒ–" class="headerlink" title="èƒ¡è¨€ä¹±è¯­ä¹‹gccä¼˜åŒ–"></a>èƒ¡è¨€ä¹±è¯­ä¹‹gccä¼˜åŒ–</h1><p>æœ¬æ–‡ä¸ºä¸šä½™è’Ÿè’»å°è¯•åˆ†æä¸€æ®µç®€å•çš„ C ä»£ç åœ¨ gcc <code>-O0</code>ã€<code>-O1</code>ã€<code>-O2</code> ä¸‹çš„ä¼˜åŒ–æƒ…å†µã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">______________</span><br><span class="line">&lt; å¤§ä½¬é©±æ•£ï¼ï¼ &gt;</span><br><span class="line"> --------------</span><br><span class="line">        \   ^__^</span><br><span class="line">         \  (oo)\_______</span><br><span class="line">            (__)\       )\&#x2F;\</span><br><span class="line">                ||----w |</span><br><span class="line">                ||     ||</span><br></pre></td></tr></table></figure><p>åšæ•°å€¼åˆ†æçš„å®éªŒï¼Œå†™äº†ç‚¹ C ä»£ç ï¼Œæµ®ç‚¹æ•°æ€§è´¨çš„å®éªŒï¼Œå¾ˆæ— èŠã€‚æ‰€ä»¥æ¥å°è¯•ç”¨ä¸åŒä¼˜åŒ–ç­‰çº§ï¼Œç”Ÿæˆæ±‡ç¼–ä»£ç ç©ç©ã€‚</p><ul><li><code>a1.c</code></li></ul><p>åŸå§‹ C ä»£ç ï¼Œå°† 100ä¸ª a3 é€ä¸ªåŠ åˆ° a1 ä¸Šï¼Œè¿”å› a1ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">a1_add_100a3_way1</span><span class="params">(<span class="keyword">float</span> a1, <span class="keyword">float</span> a3)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">        a1 += a3;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>gcc-9 -O0 -S a1.c</code></li></ul><p>ç”¨ 0 çº§ä¼˜åŒ–ï¼Œç¼–è¯‘æˆæ±‡ç¼–ï¼Œç›¸å½“å¿ å®åœ°ã€Œç›´è¯‘ã€ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">_a1_add_100a3_way1:</span><br><span class="line">LFB2:</span><br><span class="line">pushq%rbp</span><br><span class="line">LCFI3:</span><br><span class="line">movq%rsp, %rbp</span><br><span class="line">LCFI4:</span><br><span class="line">movss%xmm0, -20(%rbp)</span><br><span class="line">movss%xmm1, -24(%rbp)</span><br><span class="line">movl$0, -4(%rbp)</span><br><span class="line">jmpL3</span><br><span class="line">L4:</span><br><span class="line">movss-20(%rbp), %xmm0</span><br><span class="line">addss-24(%rbp), %xmm0</span><br><span class="line">movss%xmm0, -20(%rbp) </span><br><span class="line">addl$1, -4(%rbp)</span><br><span class="line">L3:</span><br><span class="line">cmpl$99, -4(%rbp)</span><br><span class="line">jleL4</span><br><span class="line">movss-20(%rbp), %xmm0</span><br><span class="line">popq%rbp</span><br><span class="line">LCFI5:</span><br><span class="line">ret</span><br></pre></td></tr></table></figure><ul><li><code>gcc-9 -O1 -S a1.c</code></li></ul><p>ç”¨ 1 çº§ä¼˜åŒ–ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">_a1_add_100a3_way1:</span><br><span class="line">LFB2:</span><br><span class="line">movl$100, %eax</span><br><span class="line">L4:</span><br><span class="line">addss%xmm1, %xmm0</span><br><span class="line">subl$1, %eax</span><br><span class="line">jneL4</span><br><span class="line">ret</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç¨‹åºç®€å•å˜›ï¼ŒO1 å·²ç»ä¼˜åŒ–çš„ç›¸å½“å‡ºè‰²äº†ï¼Œå„ç§ä¸´æ—¶éå†èƒ½ç çš„å…¨ç äº†ã€‚æ‰‹å†™æ±‡ç¼–ä¹Ÿå°±è¿™æ°´å¹³äº†ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå®ƒæŠŠ i ä» 0 åŠ åˆ° <code>&lt; 100</code>ï¼ˆå³ <code>== 99</code>ï¼‰çš„åˆ¤æ–­æ”¹æˆäº†ä» 100 å‡åˆ° 0ï¼Œç›´æ¥ä½¿ç”¨å‡æ³•è®¾ç½®çš„ ZFï¼Œé¿å…äº†ä¸€æ¬¡ cmplï¼Œå¾ˆåˆºæ¿€ã€‚</p><ul><li><code>gcc-9 -O2 -S a1.c</code></li></ul><p>ç”¨ 2 çº§ä¼˜åŒ–ï¼Œç¼–è¯‘æˆæ±‡ç¼–ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">_a1_add_100a3_way1:</span><br><span class="line">LFB2:</span><br><span class="line">movl$100, %eax</span><br><span class="line">.p2align 4,,10</span><br><span class="line">.p2align 3</span><br><span class="line">L4:</span><br><span class="line">subl$1, %eax</span><br><span class="line">addss%xmm1, %xmm0</span><br><span class="line">jneL4</span><br><span class="line">ret</span><br></pre></td></tr></table></figure><p>å’Œ 1 çº§ä¼˜åŒ–æ¯”ï¼Œæ„Ÿè§‰å‡ ä¹æ²¡æœ‰æå‡ã€‚ä½†æˆ‘æœ‰ä¸ªä¸ç¡®å®šçš„<strong>çŒœæƒ³</strong>ï¼š</p><p>O2 ç¼–è¯‘æŠŠ subl æåˆ° addss å‰è¿ç®—ï¼Œè¿™æ ·åˆ° jneã€Œå–æŒ‡ã€æ—¶ï¼Œsubl å·²ç»åˆ°äº†ã€Œæ‰§è¡Œã€ï¼Œç”¨ä¸€ä¸ª bubble å°±å¯ä»¥é¿å…æµæ°´çº¿å†’é™©ã€‚ è€Œ O1 çš„ç‰ˆæœ¬é‡Œï¼Œjne ç´§éš sublï¼Œjne  è¾¾åˆ°ã€Œå–æŒ‡ã€æ—¶ï¼Œsubl è¿˜åœ¨ã€Œè¯‘ç ã€é˜¶æ®µï¼Œéœ€è¦æ›´å¤šçš„ bubble æˆ–è€…å…¶ä»–æ–¹å¼æ¥å¤„ç†è¿™é‡Œçš„æµæ°´çº¿å†’é™©ï¼Œä»£ä»·ç¨å¾®å¤§äº†ä¸€ç‚¹ç‚¹ğŸ¤ã€‚ï¼ˆæµæ°´çº¿å­¦çš„å¹¶ä¸å¥½ï¼Œæˆ‘ä¸ä¿è¯è¿™ä¸ªåˆ†ææ­£ç¡®ã€æœ‰æ„ä¹‰ï¼‰</p><h1 id="å…è´£å£°æ˜"><a href="#å…è´£å£°æ˜" class="headerlink" title="å…è´£å£°æ˜"></a>å…è´£å£°æ˜</h1><p>è¿™æ˜¯ä¸€ç¯‡åœ¨æ¡Œé¢ä¸Šæ‰¾åˆ°çš„æ„ä¹‰ä¸æ˜çš„æ–‡ç« ã€‚æˆ‘äºè¿‡å»çš„æŸå¤©å¶ç„¶å†™ä¸‹äº†è¿™äº›ä¸œè¥¿ï¼Œçœ‹ä¸Šå»å¾ˆå‰å®³ï¼Œæ‰€ä»¥åˆ†äº«ä¸€ä¸‹ï¼ˆä½†ä¸çŸ¥é“å†…å®¹æ˜¯å¦æ­£ç¡®ã€æœ‰æ•ˆï¼‰ã€‚</p><blockquote><p>ã€Œèƒ¡è¨€ä¹±è¯­ã€(Bullshit) ç³»åˆ—æ–‡ç« ï¼ˆåŒ…æ‹¬ä½†ä¸é™äºç›¸å…³çš„æ±‰å­—ã€æ‹¼éŸ³ã€æ‹‰ä¸å­—æ¯ã€æ—¥è¯­å‡åã€é˜¿æ‹‰ä¼¯å­—æ¯ã€å•è¯ã€å¥å­å›¾ç‰‡ã€å½±åƒã€å½•éŸ³ï¼Œä»¥åŠå‰è¿°ä¹‹å„ç§éšæ„ç»„åˆç­‰ç­‰ï¼‰å‡ä¸ºæœ¬äººéšæ„æ•²å‡»é”®ç›˜æ‰€å‡ºã€‚ç”¨äºæ£€æµ‹æœ¬äººç”µè„‘é”®ç›˜å½•å…¥ã€å±å¹•æ˜¾ç¤ºçš„æœºæ¢°ã€å…‰ç”µæ€§èƒ½ï¼Œå¹¶ä¸ä»£è¡¨æœ¬äººå±€éƒ¨æˆ–å…¨éƒ¨åŒæ„ã€æ”¯æŒæˆ–è€…åå¯¹å…¶ä¸­çš„ä»»ä½•å†…å®¹åŠè§‚ç‚¹ã€‚</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> Bullshit </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python gRPC ä¸è·¨è¯­è¨€ gRPC è°ƒç”¨</title>
      <link href="/2020/09/19/blog/gRPC-with-Python-and-Golang/"/>
      <url>/2020/09/19/blog/gRPC-with-Python-and-Golang/</url>
      
        <content type="html"><![CDATA[<h1 id="Python-gRPC-ä¸è·¨è¯­è¨€-gRPC-è°ƒç”¨"><a href="#Python-gRPC-ä¸è·¨è¯­è¨€-gRPC-è°ƒç”¨" class="headerlink" title="Python gRPC ä¸è·¨è¯­è¨€ gRPC è°ƒç”¨"></a>Python gRPC ä¸è·¨è¯­è¨€ gRPC è°ƒç”¨</h1><p>æœ¬æ–‡æ˜¯æˆ‘ä¸Šä¸€ç¯‡æ–‡ç« ã€Š <a href="https://blog.csdn.net/u012419550/article/details/108672965">Go å¾®æœåŠ¡åŸºç¡€ï¼šProtobuf &amp; gRPC</a>ã€‹çš„å»¶ä¼¸ï¼Œåœ¨å¼€å§‹æœ¬æ–‡å‰ï¼Œå»ºè®®å…ˆçœ‹ä¸€çœ‹é‚£ç¯‡æ–‡ç« ã€‚</p><p>åœ¨ã€Š <a href="https://blog.csdn.net/u012419550/article/details/108672965">Go å¾®æœåŠ¡åŸºç¡€ï¼šProtobuf &amp; gRPC</a>ã€‹ä¸€æ–‡ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† protobuf çš„åŸºç¡€ã€‚éšåå®šä¹‰äº†ä¸€ä¸ª userinfo proto ä½œä¸ºæ¥å£ï¼Œå®ç°äº†ä¸€å¥— Golang ç‰ˆæœ¬çš„æœåŠ¡ç«¯ã€å®¢æˆ·ç«¯ã€‚</p><p>è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ç»§ç»­ä½¿ç”¨é‚£ä¸ª userinfo proto ä½œä¸ºæ¥å£ï¼Œå»å®ç°ä¸€å¥— Python ç‰ˆæœ¬çš„æœåŠ¡ç«¯ã€å®¢æˆ·ç«¯ï¼Œåœ¨å®ä¾‹ä¸­å…¥é—¨ Python gRPC ä½¿ç”¨ã€‚ç„¶åï¼Œæˆ‘ä»¬åšä¸€ä¸ªæœ‰æ„æ€çš„å°è¯• â€”â€” Golang ä¸ Python ç‰ˆæœ¬å®¢æˆ·ç«¯ã€æœåŠ¡ç«¯çš„è·¨è¯­è¨€è°ƒç”¨ã€‚</p><p>[TOC]</p><h2 id="Python-gRPC-å…¥é—¨"><a href="#Python-gRPC-å…¥é—¨" class="headerlink" title="Python gRPC å…¥é—¨"></a>Python gRPC å…¥é—¨</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬äº†è§£ä¸€ä¸‹å¦‚ä½•é…ç½® Python çš„ gRPC ç¯å¢ƒï¼Œå¦‚ä½•æŠŠ proto æ–‡ä»¶ç¼–è¯‘å‡º Python æ¥å£ï¼Œå¦‚ä½•å®ç°æœåŠ¡ç«¯ã€å®¢æˆ·ç«¯ã€‚</p><h3 id="å®‰è£…-gRPC-Python"><a href="#å®‰è£…-gRPC-Python" class="headerlink" title="å®‰è£… gRPC Python"></a>å®‰è£… gRPC Python</h3><p>å®‰è£… gRPC Python ç»„ä»¶ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip3 install grpcio</span><br><span class="line">pip3 install grpcio-tools</span><br></pre></td></tr></table></figure><h3 id="ç¼–å†™-proto-ç”Ÿæˆæ¥å£"><a href="#ç¼–å†™-proto-ç”Ÿæˆæ¥å£" class="headerlink" title="ç¼–å†™ proto ç”Ÿæˆæ¥å£"></a>ç¼–å†™ proto ç”Ÿæˆæ¥å£</h3><p>ç¼–å†™ proto æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥å¤åˆ¶ã€Š <a href="https://blog.csdn.net/u012419550/article/details/108672965">Go å¾®æœåŠ¡åŸºç¡€ï¼šProtobuf &amp; gRPC</a>ã€‹ä¸€æ–‡ä¸­çš„ protoï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> proto;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨æˆ·ä¿¡æ¯è¯·æ±‚å‚æ•°</span></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">UserRequest</span> </span>&#123;</span><br><span class="line">  <span class="built_in">string</span> name = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨æˆ·ä¿¡æ¯è¯·æ±‚å“åº”</span></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">UserResponse</span> </span>&#123;</span><br><span class="line">  <span class="built_in">int32</span> id = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">string</span> name = <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">int32</span> age = <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">repeated</span> <span class="built_in">string</span> hobby = <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨æˆ·ä¿¡æ¯æ¥å£</span></span><br><span class="line"><span class="class"><span class="keyword">service</span> <span class="title">UserInfo</span> </span>&#123;</span><br><span class="line">  <span class="comment">// è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œè¯·æ±‚å‚æ•°ä¸º UserRequestï¼Œè¿”å›å“åº”ä¸º UserResponse</span></span><br><span class="line">  <span class="function"><span class="keyword">rpc</span> GetUserInfo (UserRequest) <span class="keyword">returns</span> (UserResponse) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ã€‚æ³¨æ„æ˜¯ä½¿ç”¨ <code>grpc_tools.protoc</code> è¿™ä¸ª Python ä¸“ç”¨çš„ç¼–è¯‘å™¨ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ <code>protoc</code> å“¦ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m grpc_tools.protoc  -I . --python_out=. --grpc_python_out=. ./userinfo.proto</span><br></pre></td></tr></table></figure><p>ä¼šç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼š</p><ul><li><code>userinfo_pb2.py</code>ï¼šè¯·æ±‚ã€å“åº”æ•°æ®ç»“æ„çš„å®šä¹‰çš„ç±»ï¼šï¼ˆproto æ–‡ä»¶ä¸­çš„ messageï¼‰<ul><li><code>UserRequest</code></li><li><code>UserResponse</code></li></ul></li><li><code>userinfo_pb2_grpc.py</code>ï¼šæœåŠ¡ç«¯ã€å®¢æˆ·ç«¯çš„å®šä¹‰çš„ç±»ï¼šï¼ˆproto æ–‡ä»¶ä¸­çš„ serviceï¼‰<ul><li><code>UserInfoServicer</code>ï¼šæœåŠ¡ç«¯</li><li><code>UserInfoStub</code>ï¼šå®¢æˆ·ç«¯</li></ul></li></ul><blockquote><p>æ³¨ï¼šè¿™é‡Œæ–‡ä»¶åé‡Œçš„ <code>pb2</code> å’Œ protobuf è¯­æ³•çš„ç‰ˆæœ¬ï¼ˆ<code>syntax = &quot;proto3&quot;</code>ï¼‰æ²¡å…³ç³»ã€‚è¿™ä¸ª pb2 åªæ˜¯è¡¨ç¤ºæ˜¯ç”¨çš„ Protocol Buffers Python API ç‰ˆæœ¬ä¸º 2ã€‚</p></blockquote><h3 id="æœåŠ¡ç«¯å®ç°"><a href="#æœåŠ¡ç«¯å®ç°" class="headerlink" title="æœåŠ¡ç«¯å®ç°"></a>æœåŠ¡ç«¯å®ç°</h3><p>æŸ¥çœ‹ <code>userinfo_pb2_grpc.py</code> é‡Œç”Ÿæˆçš„ä»£ç å¯ä»¥çŸ¥é“ï¼ŒPython gRPC çš„æœåŠ¡å®ç°æ˜¯å†™ä¸€ä¸ªå­ç±»å»ç»§æ‰¿ proto ç¼–è¯‘ç”Ÿæˆçš„ <code>userinfo_pb2_grpc.UserInfoServicer</code> ï¼Œåœ¨å­ç±»ä¸­å®ç° RPC çš„å…·ä½“æœåŠ¡å¤„ç†æ–¹æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> concurrent <span class="keyword">import</span> futures</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> grpc</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> userinfo_pb2</span><br><span class="line"><span class="keyword">import</span> userinfo_pb2_grpc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfoServicer</span>(<span class="params">userinfo_pb2_grpc.UserInfoServicer</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;UserInfoServicer å…·ä½“å®ç° userinfo_pb2_grpc.UserInfoServicerï¼Œå¤„ç† RPC æœåŠ¡</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GetUserInfo</span>(<span class="params">self, request, context</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œè¯·æ±‚å‚æ•°ä¸º UserRequestï¼Œè¿”å›å“åº”ä¸º UserResponse</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        name = request.name</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Fake query</span></span><br><span class="line">        <span class="keyword">if</span> name == <span class="string">&quot;foo&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> userinfo_pb2.UserResponse(<span class="built_in">id</span>=<span class="number">1</span>, name=<span class="string">&quot;foo&quot;</span>, age=<span class="number">12</span>, hobby=[<span class="string">&quot;eating&quot;</span>, <span class="string">&quot;sleep&quot;</span>])</span><br><span class="line">        <span class="keyword">raise</span> KeyError(<span class="string">f&quot;unknown user: name = <span class="subst">&#123;name&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">serve</span>():</span></span><br><span class="line">    server = grpc.server(futures.ThreadPoolExecutor(max_workers=<span class="number">10</span>))</span><br><span class="line">    userinfo_pb2_grpc.add_UserInfoServicer_to_server(UserInfoServicer(), server)</span><br><span class="line">    server.add_insecure_port(<span class="string">&#x27;[::]:50051&#x27;</span>)</span><br><span class="line">    server.start()</span><br><span class="line">    server.wait_for_termination()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    serve()</span><br></pre></td></tr></table></figure><h3 id="å®¢æˆ·ç«¯å®ç°"><a href="#å®¢æˆ·ç«¯å®ç°" class="headerlink" title="å®¢æˆ·ç«¯å®ç°"></a>å®¢æˆ·ç«¯å®ç°</h3><p>å®¢æˆ·ç«¯å¾ˆå¥½ç†è§£ï¼Œç½‘ç»œè¿æ¥å¾—åˆ°ä¸€ä¸ª channelï¼Œæ‹¿ channel å»å®ä¾‹åŒ–ä¸€ä¸ª stubï¼Œé€šè¿‡ stub è°ƒç”¨ RPC å‡½æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> grpc</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> userinfo_pb2</span><br><span class="line"><span class="keyword">import</span> userinfo_pb2_grpc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span>():</span></span><br><span class="line">    <span class="keyword">with</span> grpc.insecure_channel(<span class="string">&#x27;localhost:50051&#x27;</span>) <span class="keyword">as</span> channel:</span><br><span class="line">        stub = userinfo_pb2_grpc.UserInfoStub(channel)</span><br><span class="line"></span><br><span class="line">        req = userinfo_pb2.UserRequest(name=<span class="string">&quot;foo&quot;</span>)</span><br><span class="line">        resp = stub.GetUserInfo(req)</span><br><span class="line"></span><br><span class="line">        print(resp)</span><br><span class="line">        print(<span class="built_in">type</span>(resp.name), <span class="built_in">type</span>(resp.<span class="built_in">id</span>))</span><br><span class="line">        print(<span class="built_in">type</span>(resp.hobby), resp.hobby, <span class="built_in">list</span>(resp.hobby))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    run()</span><br></pre></td></tr></table></figure><h3 id="è¿è¡Œæµ‹è¯•"><a href="#è¿è¡Œæµ‹è¯•" class="headerlink" title="è¿è¡Œæµ‹è¯•"></a>è¿è¡Œæµ‹è¯•</h3><p>å…ˆè¿è¡ŒæœåŠ¡ç«¯ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python3 server.py</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿è¡Œ <code>python3 sever.py</code> æœ‰å¦‚ä¸‹æŠ¥é”™ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AttributeError: module <span class="string">&#x27;google.protobuf.descriptor&#x27;</span> has no attribute <span class="string">&#x27;_internal_create_key&#x27;</span></span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹ <code>protoc --version</code> å’Œ <code>pip3 show protobuf</code>ã€‚æˆ‘è¿™é‡Œçš„é—®é¢˜æ˜¯ pip çš„ protobuf å¤ªè€äº†ï¼Œæ›´æ–°ä¸€ä¸‹å°±è¡Œï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip3 install -upgrade protobuf -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure><p>å†è¿è¡Œå®¢æˆ·ç«¯ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Another terminal</span></span><br><span class="line">$ python3 client.py</span><br><span class="line">id: 1</span><br><span class="line">name: <span class="string">&quot;foo&quot;</span></span><br><span class="line">age: 12</span><br><span class="line">hobby: <span class="string">&quot;eating&quot;</span></span><br><span class="line">hobby: <span class="string">&quot;sleep&quot;</span></span><br><span class="line"></span><br><span class="line">&lt;class <span class="string">&#x27;str&#x27;</span>&gt; &lt;class <span class="string">&#x27;int&#x27;</span>&gt;</span><br><span class="line">&lt;class <span class="string">&#x27;google.protobuf.pyext._message.RepeatedScalarContainer&#x27;</span>&gt; [<span class="string">&#x27;eating&#x27;</span>, <span class="string">&#x27;sleep&#x27;</span>] [<span class="string">&#x27;eating&#x27;</span>, <span class="string">&#x27;sleep&#x27;</span>]</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå“åº”è¿”å›çš„ UserResponse é‡Œéƒ½æ˜¯ä¸€èˆ¬çš„æ•°æ®æ ¼å¼ï¼Œä½† repeat çš„æ•°æ®å¹¶ä¸æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„ list ä»€ä¹ˆçš„ï¼Œä½†å¯ä»¥æ‰‹åŠ¨è½¬è¿‡å»ã€‚</p><p>å¦‚æœæˆ‘ä»¬è¯·æ±‚ä¸€ä¸ª name é <code>&quot;foo&quot;</code> çš„è°ƒç”¨ï¼ŒæœåŠ¡ç«¯çš„å¤„ç†æ˜¯ <code>raise KeyError(f&quot;unknown user: name = &#123;name&#125;&quot;)</code>ï¼Œè¿™é‡Œå®¢æˆ·ç«¯å°±ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> grpc</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> userinfo_pb2</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> userinfo_pb2_grpc</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>channel = grpc.insecure_channel(<span class="string">&#x27;localhost:50051&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>stub = userinfo_pb2_grpc.UserInfoStub(channel)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>req = userinfo_pb2.UserRequest(name=<span class="string">&quot;bar&quot;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>resp = stub.GetUserInfo(req)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">&quot;/usr/local/lib/python3/site-packages/grpc/_channel.py&quot;</span>, line <span class="number">826</span>, <span class="keyword">in</span> __call__</span><br><span class="line">    <span class="keyword">return</span> _end_unary_response_blocking(state, call, <span class="literal">False</span>, <span class="literal">None</span>)</span><br><span class="line">  File <span class="string">&quot;/usr/local/lib/python3/site-packages/grpc/_channel.py&quot;</span>, line <span class="number">729</span>, <span class="keyword">in</span> _end_unary_response_blocking</span><br><span class="line">    <span class="keyword">raise</span> _InactiveRpcError(state)</span><br><span class="line">grpc._channel._InactiveRpcError: &lt;_InactiveRpcError of RPC that terminated <span class="keyword">with</span>:</span><br><span class="line">        status = StatusCode.UNKNOWN</span><br><span class="line">        details = <span class="string">&quot;Exception calling application: &#x27;unknown user: name = bar&#x27;&quot;</span></span><br><span class="line">        debug_error_string = <span class="string">&quot;&#123;&quot;</span>created<span class="string">&quot;:&quot;</span>@<span class="number">1600520567.121816000</span><span class="string">&quot;,&quot;</span>description<span class="string">&quot;:&quot;</span>Error received <span class="keyword">from</span> peer ipv6:[::<span class="number">1</span>]:<span class="number">50051</span><span class="string">&quot;,&quot;</span>file<span class="string">&quot;:&quot;</span>src/core/lib/surface/call.cc<span class="string">&quot;,&quot;</span>file_line<span class="string">&quot;:1062,&quot;</span>grpc_message<span class="string">&quot;:&quot;</span>Exception calling application: <span class="string">&#x27;unknown user: name = bar&#x27;</span><span class="string">&quot;,&quot;</span>grpc_status<span class="string">&quot;:2&#125;&quot;</span></span><br></pre></td></tr></table></figure><h2 id="è·¨è¯­è¨€-gRPC"><a href="#è·¨è¯­è¨€-gRPC" class="headerlink" title="è·¨è¯­è¨€ gRPC"></a>è·¨è¯­è¨€ gRPC</h2><p>ä¸€ç›´è¯´ gRPC è·¨è¯­è¨€ï¼Œä½†æˆ‘ä»¬ä¸€ç›´è·‘çš„æœåŠ¡ç«¯ã€å®¢æˆ·ç«¯åŒä¸€ç§è¯­è¨€çš„ã€‚æˆ‘ä»¬å·²ç»å­¦ä¹ äº† Golang å’Œ Python ä¸¤ç§è¯­è¨€çš„ gRPCï¼Œç°åœ¨å°è¯•è·¨è¯­è¨€å»è°ƒç”¨å®ƒä»¬ã€‚</p><p>äº‹å®ä¸Šï¼Œä½¿ç”¨ä¸€æ ·çš„ proto ä½œä¸ºåŸºç¡€ï¼Œå³ä½¿æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä½¿ç”¨ä¸åŒè¯­è¨€å®ç°ï¼Œä¸ç”¨åšä»»ä½•å¤„ç†å°±å¯ä»¥äº’ç›¸è°ƒç”¨ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬åˆšæ‰ç”¨ Python å®ç°çš„ gRPC æœåŠ¡ç«¯ã€å®¢æˆ·ç«¯ï¼Œå’Œä¸Šä¸€ç¯‡æ–‡ç« ã€Š <a href="https://blog.csdn.net/u012419550/article/details/108672965">Go å¾®æœåŠ¡åŸºç¡€ï¼šProtobuf &amp; gRPC</a>ã€‹ä¸­ç”¨ Go è¯­è¨€å®ç°çš„ gRPC æœåŠ¡ç«¯ã€å®¢æˆ·ç«¯ï¼Œéƒ½æ˜¯åŸºäºåŒä¸€ä¸ª proto æ–‡ä»¶çš„ã€‚</p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬ä¸ç”¨åŠ¨ä»»ä½•å…·ä½“ä»£ç å°±å¯ä»¥éšæ„ç»„åˆä½¿ç”¨ Golangã€Python çš„æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ã€‚</p><h3 id="Python-è°ƒç”¨-Golang"><a href="#Python-è°ƒç”¨-Golang" class="headerlink" title="Python è°ƒç”¨ Golang"></a>Python è°ƒç”¨ Golang</h3><p>ç¬¬ä¸€ä¸ªå°è¯•æ˜¯ Python å®¢æˆ·ç«¯è°ƒç”¨ Golang å®ç°çš„æœåŠ¡ç«¯ã€‚</p><p>ä½¿ç”¨ä¸Šä¸€ç¯‡æ–‡ç« ã€Š <a href="https://blog.csdn.net/u012419550/article/details/108672965">Go å¾®æœåŠ¡åŸºç¡€ï¼šProtobuf &amp; gRPC</a>ã€‹ä¸­å®ç°çš„ <code>server/main.go</code>  ä½œä¸ºæœåŠ¡ç«¯ï¼Œä½¿ç”¨æœ¬æ–‡å‰é¢éƒ¨åˆ†å®ç°çš„ userinfo çš„ <code>client.py</code> ä½œä¸ºå®¢æˆ·ç«¯ã€‚</p><p>æœåŠ¡ç«¯ä¸€è¡Œä»£ç éƒ½ä¸æ”¹ï¼Œç›´æ¥è·‘èµ·æ¥ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go run server/main.go</span><br></pre></td></tr></table></figure><p>æŠŠ <code>client.py</code> ä¸­çš„ç«¯å£æ”¹æˆåŒ¹é…æœåŠ¡ç«¯çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span>():</span></span><br><span class="line">    <span class="keyword">with</span> grpc.insecure_channel(<span class="string">&#x27;localhost:8080&#x27;</span>) <span class="keyword">as</span> channel:</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure><p>è¿è¡Œå®¢æˆ·ç«¯ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ python3 /Users/c/Desktop/grpcpy/client.py</span><br><span class="line">id: 1</span><br><span class="line">name: <span class="string">&quot;foo&quot;</span></span><br><span class="line">age: 12</span><br><span class="line">hobby: <span class="string">&quot;eating&quot;</span></span><br><span class="line">hobby: <span class="string">&quot;sleep&quot;</span></span><br></pre></td></tr></table></figure><p>è·¨è¯­è¨€è°ƒç”¨æˆåŠŸï¼Œä¸€åˆ‡æ­£ç¡®ï¼</p><p>å¦‚æœä½ å°è¯•é”™è¯¯è°ƒç”¨ï¼Œå¾—åˆ°çš„æ˜¯å’Œåˆšæ‰ä½¿ç”¨ Python æœåŠ¡ç«¯ç›¸åŒçš„é”™è¯¯ã€‚ </p><h3 id="Golang-è°ƒç”¨-Python"><a href="#Golang-è°ƒç”¨-Python" class="headerlink" title="Golang è°ƒç”¨ Python"></a>Golang è°ƒç”¨ Python</h3><p>åè¿‡æ¥ï¼Œä½¿ç”¨ Golang è°ƒç”¨ Pythonã€‚</p><p>é™¤äº†åè°ƒä¸€ä¸‹ç«¯å£ï¼Œè¿˜æ˜¯ä¸éœ€è¦åšä»»ä½•æ”¹åŠ¨ï¼ç›´æ¥è·‘èµ·æ¥ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python3 server.py</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go run client/main.go</span><br><span class="line">resp: &amp;proto.UserResponse&#123;state:impl.MessageState&#123;NoUnkeyedLiterals:pragma.NoUnkeyedLiterals&#123;&#125;, DoNotCompare:pragma.DoNotCompare&#123;&#125;, DoNotCopy:pragma.DoNotCopy&#123;&#125;, atomicMessageInfo:(*impl.MessageInfo)(0xc000186638)&#125;, sizeCache:0, unknownFields:[]uint8(nil), Id:1, Name:<span class="string">&quot;foo&quot;</span>, Age:12, Hobby:[]string&#123;<span class="string">&quot;eating&quot;</span>, <span class="string">&quot;sleep&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨æˆåŠŸã€‚</p><hr><p>è¿™ç§è·¨è¯­è¨€è°ƒç”¨ç®€å•åœ°ä¼¼ä¹æœ‰äº›ä¸å¯æ€è®®ï¼Œä½†è¿™ç§å¼ºå¤§çš„ç®€å•æ­£æ˜¯æˆ‘ä»¬ä½¿ç”¨ gRPC çš„ç†ç”±ã€‚</p><h1 id="å†™åœ¨æœ€åï¼šè’Ÿè’»çš„æŠ±æ€¨"><a href="#å†™åœ¨æœ€åï¼šè’Ÿè’»çš„æŠ±æ€¨" class="headerlink" title="å†™åœ¨æœ€åï¼šè’Ÿè’»çš„æŠ±æ€¨"></a>å†™åœ¨æœ€åï¼šè’Ÿè’»çš„æŠ±æ€¨</h1><p>åˆåˆ°äº†è¿™ä¸ªå«äººå—ä¸äº†çš„å­£èŠ‚ï¼</p><p>è’Ÿè’»åœ¨è¢«è¤¥ä¸­èœ·ç¼©ç€ã€é¢¤æŠ–ç€ã€‚è€³æœºä¸­æ·¡æ·¡çš„è€æ­ŒåŒ–èº«åˆ©åˆƒï¼Œå¤ºå¿ƒè€Œå…¥ï¼ŒåˆåŒ–èº«é£“é£ï¼Œç¿»èµ·ç‰‡ç‰‡å‡Œä¹±çš„å›å¿†ã€‚ä¸‰åˆ†ç¾å¥½ã€ä¸ƒåˆ†è‹¦æ¶©ä»è’Ÿè’»çœ¼å‰é£˜è¿‡ã€‚</p><p>ä¸çŸ¥é“æ˜¯è¿·ç¦»çš„æ¢¦å¢ƒè¿˜æ˜¯è‰æ·¡çš„ç°å®ä¸­ï¼Œè’Ÿè’»å†ä¹Ÿå—ä¸äº†è¿™å¿ƒç—›çš„å­£èŠ‚ã€ç—›è‹¦çš„æ­Œæ›²å’Œè‹¦éš¾çš„å›å¿†ã€‚æŠ±èµ·åˆ»æ»¡å¹´å²çš„è€å‰ä»–ã€‚è°ƒå¼¦ï¼Œå˜è°ƒï¼Œè½»è½»å¥å“ã€‚</p><p>ä¸€æ ·çš„ç´è°±ï¼Œä¸€æ ·çš„å­¤ç‹¬ï¼Œä¸åœåœ°é‡å¤åˆé‡å¤ï¼Œå¼¹å‡ºäº†æ–°æ„Ÿè§¦â€”â€”</p><p>å®ƒå‘œå’½çš„å£°å“ï¼Œæ˜¯å†…å¿ƒçš„æ—‹å¾‹ï¼Œæ˜¯é—å¿˜çš„èŠ‚å¥ï¼Œæ˜¯å›å¿†çš„å­£èŠ‚ï¼Œæ˜¯å³å°†åˆ°æ¥çš„â€”â€”é›ªè—æ›´å¤šå›å¿†çš„å†¬å¤©ã€‚</p><hr><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">by(<span class="string">&quot;CDFMLR&quot;</span>, <span class="string">&quot;2020-09-19&quot;</span>)</span><br><span class="line"><span class="comment"># See you.ğŸ¸</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go å¾®æœåŠ¡åŸºç¡€ï¼šProtobuf &amp; gRPC</title>
      <link href="/2020/09/15/blog/Golang-Protobuf-and-gRPC/"/>
      <url>/2020/09/15/blog/Golang-Protobuf-and-gRPC/</url>
      
        <content type="html"><![CDATA[<h1 id="Go-å¾®æœåŠ¡åŸºç¡€ï¼šProtobuf-amp-gRPC"><a href="#Go-å¾®æœåŠ¡åŸºç¡€ï¼šProtobuf-amp-gRPC" class="headerlink" title="Go å¾®æœåŠ¡åŸºç¡€ï¼šProtobuf &amp; gRPC"></a>Go å¾®æœåŠ¡åŸºç¡€ï¼šProtobuf &amp; gRPC</h1><p>è¿™ç¯‡æ–‡ç« å†™çš„ç¨å¾®æœ‰ç‚¹ä¹±ï¼Œå› ä¸ºå†™ä½œè¿‡ç¨‹ä¸­æ€è·¯æœ‰å¤§æ–­æµã€‚</p><p>æœ¬æ–‡å†æ—¶å¾ˆå¤šå¤©ï¼ŒæœŸé—´æˆ‘çš„ä¸¤å¤§ä¸»è¦å¼€å‘ç¯å¢ƒ â€”â€” Python å’Œ Golang éƒ½ç‚¸äº†ï¼Œé¡ºä¾¿ï¼ŒåŒ…ç®¡ç†å·¥å…· Homebrew ä¹Ÿå‡ºäº†ç‚¹å°é—®é¢˜ï¼ˆå…¨éƒ½æ˜¯å› ä¸ºä¸€æ¡æ²¡ç»è¿‡æ·±æ€çš„é”™è¯¯çš„ <code>brew upgrade</code> å‘½ä»¤ï¼‰ã€‚å°è¯•æ‰‹åŠ¨ä¿®å¤ï¼Œæäº†ä¸€å¤©ï¼Œæ— æœã€‚æ²¡åŠæ³• Time Machine æ¢å¤äº†ä¸€ä¸‹ï¼Œç”±äºæœ€è¿‘å‡ å¤©éƒ½æ²¡å¤‡ä»½ğŸ˜­ï¼ŒS/L å¤§æ³•ä¸å¤ªçµï¼Œå®ƒä¸€ä¸‹å­ç»™æˆ‘å›åˆ°äº†åå¤©å‰ã€‚å„ç§æ‰‹åŠ¨æ£€æŸ¥ã€æ¸…ç†ã€git pullï¼ŒåˆèŠ±è´¹äº†ä¸€å¤©ã€‚ã€‚ã€‚</p><p>ä¸è¿‡è¿™äº›æ€ä¹ˆæ ·éƒ½æ— æ‰€è°“å•¦ï¼Œæˆ‘æƒ³è¯´çš„æ˜¯ï¼Œå¤§å®¶åœ¨æ•²å›è½¦å‰è¿˜æ˜¯è¦ä¸‰æ€ï¼Œå°¤å…¶æ˜¯ä½¿ç”¨ç®¡ç†å‘˜æƒé™æ—¶ã€‚è¿˜æœ‰å¤‡ä»½ä¸è¦å¿˜å•Šï¼Œå†å¿™ä¹Ÿè¦è®°å¾—åšå¤‡ä»½å“¦ã€‚</p><hr><p><del>æˆ‘ä»¬å¼€é—¨è§å±±</del>ï¼ŒåºŸè¯ç»“æŸï¼è¿™ç¯‡æ–‡ç« å‰åŠéƒ¨åˆ†ä»‹ç»äº† Protocol Buffers çš„å®‰è£…ä½¿ç”¨å’ŒåŸºæœ¬è¯­æ³•ã€‚ååŠéƒ¨åˆ†åŸºäº Golangï¼Œé€šè¿‡ä¸€ä¸ªå®ä¾‹ï¼Œä»‹ç» Protobuf ä¸ gRPC çš„ä½¿ç”¨ã€‚</p><p>[TOC]</p><h2 id="Protobuf"><a href="#Protobuf" class="headerlink" title="Protobuf"></a>Protobuf</h2><blockquote><p><a href="https://developers.google.com/protocol-buffers">Protocol Buffers</a> æ˜¯ä¸€ç§åºåˆ—åŒ–æ•°æ®ç»“æ„çš„åè®®ã€‚å¯¹äºé€è¿‡ç®¡é“æˆ–å­˜å‚¨æ•°æ®è¿›è¡Œé€šä¿¡çš„ç¨‹åºå¼€å‘ä¸Šæ˜¯å¾ˆæœ‰ç”¨çš„ã€‚è¿™ä¸ªæ–¹æ³•åŒ…å«ä¸€ä¸ªæ¥å£æè¿°è¯­è¨€ï¼Œæè¿°ä¸€äº›æ•°æ®ç»“æ„ï¼Œå¹¶æä¾›ç¨‹åºå·¥å…·æ ¹æ®è¿™äº›æè¿°äº§ç”Ÿä»£ç ï¼Œç”¨äºå°†è¿™äº›æ•°æ®ç»“æ„äº§ç”Ÿæˆ–è§£ææ•°æ®æµã€‚</p><p>â€”â€”  <a href="https://zh.wikipedia.org/zh-cn/Protocol_Buffers">WikiPedia</a></p></blockquote><p>æ€»è€Œè¨€ä¹‹ï¼Œ <a href="https://developers.google.com/protocol-buffers">Protocol Buffers</a>ï¼Œç®€ç§° Protobufï¼Œ æ˜¯ä¸€ç§æ•°æ®æè¿°è¯­è¨€ï¼ˆå’Œ XMLã€JSON è¿™äº›ç±»ä¼¼ï¼‰ã€‚Protobuf é…å¥—çš„å·¥å…·å¯ä»¥è‡ªåŠ¨ç”Ÿæˆå°†å„ç§è¯­è¨€ä¸­çš„æ•°æ®ç»“æ„åºåˆ—åŒ–ä¸º Protobuf è¡¨ç¤ºï¼Œç„¶åååºåˆ—åŒ–åˆ°ä»»æ„æ”¯æŒçš„è¯­è¨€ä¸­ã€‚</p><p>åœ¨ RPC ä¸­ï¼Œè·¨è¯­è¨€çš„æ•°æ®ç¼–ç ã€è§£ç æ˜¯ä¸ªé—®é¢˜ï¼Œ Protobuf æ˜¯ä¸€ç§æ¯”è¾ƒé«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚gRPC å°±æ˜¯åŸºäº Protobuf çš„ä¸€å¥— RPC æ¡†æ¶ã€‚</p><h3 id="å®‰è£…-Protobuf"><a href="#å®‰è£…-Protobuf" class="headerlink" title="å®‰è£… Protobuf"></a>å®‰è£… Protobuf</h3><p>åœ¨ macOS ä¸Šï¼Œä½¿ç”¨  homebrew å¯ä»¥å¿«é€Ÿå®‰è£… protobufã€‚ <code>brew</code> ç»å¯¹æ˜¯æˆ‘è§è¿‡æœ€çœäº‹çš„åŒ…ç®¡ç†ï¼Œå¿½ç•¥å›½å†…ä¼—æ‰€å‘¨çŸ¥çš„åŸå› å¸¦æ¥çš„ä¸€äº›å°é—®é¢˜ï¼Œå‡ ä¹æ»¡è¶³äº†ä¸€åˆ‡æ—¥å¸¸å®‰è£…éœ€è¦ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ brew install protobuf</span><br><span class="line">...</span><br><span class="line">$ protoc --version</span><br><span class="line">libprotoc 3.13.0</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦åœ¨ Golang ä¸­ä½¿ç”¨ protobufï¼Œéœ€è¦æŠŠ ptotobuf â€œç¼–è¯‘â€æˆ Golangï¼Œéœ€è¦å®‰è£…  protoc-gen-go å·¥å…·æ¥åšè¿™ä»¶äº‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go install google.golang.org/protobuf/cmd/protoc-gen-go</span><br></pre></td></tr></table></figure><p>ä¸‹é¢å…ˆå°è¯•ä½¿ç”¨å®ƒå®Œæˆä¸€æ¬¡ HelloWorldï¼Œåé¢å†ä»‹ç» Protobuf çš„åŸºæœ¬è¯­æ³•å‘€ã€‚</p><h3 id="ä½¿ç”¨-Protobuf"><a href="#ä½¿ç”¨-Protobuf" class="headerlink" title="ä½¿ç”¨ Protobuf"></a>ä½¿ç”¨ Protobuf</h3><p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ª <code>hello.proto</code> æ–‡ä»¶ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim hello.proto</span><br></pre></td></tr></table></figure><p>å†™å…¥å¦‚ä¸‹ Protocol Buffers ä»£ç ï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">syntax =  <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> hello;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">  <span class="built_in">string</span> world = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">int32</span> meaningless_count = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ï¼Œç”Ÿæˆ Golang ä»£ç ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ protoc --go_out=. hello.proto</span><br></pre></td></tr></table></figure><p><code>go_out</code> å‘Šè¯‰ protoc ç¼–è¯‘å™¨åŠ è½½ protoc-gen-go å·¥å…·æ¥ç”Ÿæˆä»£ç ï¼ŒæŠŠç”Ÿæˆä»£ç æ”¾åˆ°å½“å‰ç›®å½•ã€‚å¿½ç•¥æ‰“å°çš„ WARNINGï¼Œ<code>protoc</code> åœ¨å½“å‰è·¯å¾„ä¸‹ç”Ÿæˆäº†ä¸€ä¸ª <code>hello.pb.go</code> çš„æ–‡ä»¶ã€‚é‡Œé¢æœ‰å¾ˆå¤šå†…å®¹ï¼ŒåŒ…æ‹¬ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Code generated by protoc-gen-go. DO NOT EDIT.</span></span><br><span class="line"><span class="comment">// versions:</span></span><br><span class="line"><span class="comment">// protoc-gen-go v1.25.0</span></span><br><span class="line"><span class="comment">// protoc        v3.13.0</span></span><br><span class="line"><span class="comment">// source: hello.proto</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> hello</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Hello <span class="keyword">struct</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    World            <span class="keyword">string</span> <span class="string">`protobuf:&quot;bytes,1,opt,name=world,proto3&quot; json:&quot;world,omitempty&quot;`</span></span><br><span class="line">    MeaninglessCount <span class="keyword">int32</span>  <span class="string">`protobuf:&quot;varint,2,opt,name=meaningless_count,json=meaninglessCount,proto3&quot; json:&quot;meaningless_count,omitempty&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(x *Hello)</span> <span class="title">Reset</span><span class="params">()</span></span> &#123;...&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(x *Hello)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;...&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*Hello)</span> <span class="title">ProtoMessage</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(x *Hello)</span> <span class="title">ProtoReflect</span><span class="params">()</span> <span class="title">protoreflect</span>.<span class="title">Message</span></span> &#123;...&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*Hello)</span> <span class="title">Descriptor</span><span class="params">()</span> <span class="params">([]<span class="keyword">byte</span>, []<span class="keyword">int</span>)</span></span> &#123;...&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(x *Hello)</span> <span class="title">GetWorld</span><span class="params">()</span> <span class="title">string</span></span> &#123;...&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(x *Hello)</span> <span class="title">GetMeaninglessCount</span><span class="params">()</span> <span class="title">int32</span></span> &#123;...&#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æŠ½å‡ºæ¥çš„è¿™äº›ä»£ç æˆ‘ä»¬éƒ½å¾ˆç†Ÿæ‚‰äº†ï¼Œå®ƒæŠŠ proto æ–‡ä»¶ä¸­å†™çš„ <code>message</code> ç¿»è¯‘æˆäº† golang çš„ç»“æ„ä½“ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½ç›´æ¥åœ¨ Go ä¸­ä½¿ç”¨è¿™ä¸ªç»“æ„äº†ã€‚</p><p>åœ¨ç¼–è¯‘æ—¶ï¼Œä½ ä¹Ÿå¯ä»¥ç¼–è¯‘æˆå…¶ä»–è¯­è¨€çš„ï¼Œç”¨ <code>--&lt;lang&gt;_out</code> æŒ‡å®šä¸€ä¸ªè¾“å‡ºç›®å½•å°±è¡Œäº†ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ protoc --java_out=. --cpp_out=. hello.proto</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥ç”Ÿæˆå„ç§è¯­è¨€çš„ä»£ç çœ‹çœ‹ï¼ŒGo ç”Ÿæˆçš„ä»£ç ç»å¯¹æ˜¯æœ€ç®€æ´ã€æœ€çœ‹å¾—æ‡‚çš„ï¼ˆä¹‹ä¸€ï¼‰ã€‚</p><h3 id="Protobuf-è¯­æ³•"><a href="#Protobuf-è¯­æ³•" class="headerlink" title="Protobuf è¯­æ³•"></a>Protobuf è¯­æ³•</h3><p>æˆ‘ä»¬æŠŠ Protocol Buffers ä»£ç å†™åœ¨ <code>.proto</code> æ–‡ä»¶ä¸­ã€‚</p><h4 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h4><p>Protobuf çš„æ³¨é‡Šè¿˜æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„ C/C++ é£æ ¼ï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™æ˜¯æ³¨é‡Š</span></span><br><span class="line"><span class="comment">/* è¿™ä¹Ÿæ˜¯æ³¨é‡Š */</span></span><br></pre></td></tr></table></figure><h4 id="è¯­æ³•ç‰ˆæœ¬"><a href="#è¯­æ³•ç‰ˆæœ¬" class="headerlink" title="è¯­æ³•ç‰ˆæœ¬"></a>è¯­æ³•ç‰ˆæœ¬</h4><p><code>.proto</code> çš„ç¬¬ä¸€è¡Œä¼šæŒ‡æ˜æ‰€ç”¨çš„è¯­æ³•ç‰ˆæœ¬ï¼Œæˆ‘ä»¬ç°åœ¨ç”¨çš„æ˜¯ proto3 ç‰ˆæœ¬ï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="å¯¼å…¥"><a href="#å¯¼å…¥" class="headerlink" title="å¯¼å…¥"></a>å¯¼å…¥</h4><p>Protocol Buffers æ–‡ä»¶ä¹Ÿå¯ä»¥å¯¼å…¥å…¶ä»–æ–‡ä»¶ä¸­çš„å†…å®¹ï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;project/others.proto&quot;</span></span><br></pre></td></tr></table></figure><h4 id="åŒ…å£°æ˜"><a href="#åŒ…å£°æ˜" class="headerlink" title="åŒ…å£°æ˜"></a>åŒ…å£°æ˜</h4><p>Protocol Buffers ä½¿ç”¨ <code>package</code> å…³é”®å­—æ¥å£°æ˜åŒ…ï¼ˆå¯é€‰ï¼‰ï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> foo.bar;</span><br></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦æŒ‡å®šåœ¨ä¸åŒè¯­è¨€ä¸­çš„åç§°ï¼Œå¯ä»¥ä½¿ç”¨ <code>option</code>ï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">option</span> java_package = <span class="string">&quot;com.example.foo&quot;</span>;</span><br></pre></td></tr></table></figure><h4 id="æ¶ˆæ¯"><a href="#æ¶ˆæ¯" class="headerlink" title="æ¶ˆæ¯"></a>æ¶ˆæ¯</h4><p>ç”¨ <code>message</code> å…³é”®å­—æ¥å®šä¹‰æ¶ˆæ¯ã€‚æ¶ˆæ¯ï¼Œå°±æ˜¯ RPC ä¸­å®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯ç©¿çš„å‚æ•°ä»¥åŠæœåŠ¡ç«¯ç»™å®¢æˆ·ç«¯è¿”å›çš„ç»“æœã€‚ä½¿ç”¨ <code>message MsgName &#123;...&#125;</code> çš„è¯­æ³•æ¥å£°æ˜ï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">SongServerRequest</span> </span>&#123;</span><br><span class="line">  <span class="built_in">string</span> song_name = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Message çš„åç§°ä¸€èˆ¬ç”¨<strong>é©¼å³°å‘½å</strong>ã€‚message çš„å†…å®¹æ˜¯ä¸€äº›ä¸ªã€Œå­—æ®µã€ã€‚</p><h4 id="å­—æ®µ"><a href="#å­—æ®µ" class="headerlink" title="å­—æ®µ"></a>å­—æ®µ</h4><p>å­—æ®µçš„æ ¼å¼ä¸ºï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="keyword">repeated</span>&#125; &lt;type&gt; &lt;field_name&gt; = &lt;fieldNumber&gt; &#123; [ fieldOptions ] &#125;;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡ŒèŠ±æ‹¬å·ä¸­çš„å†…å®¹æ˜¯å¯é€‰çš„ï¼Œå°–æ‹¬å·ä¸­çš„å†…å®¹æ˜¯éœ€è¦æ›¿æ¢çš„ï¼Œåé¢çš„ <code>[ fieldOptions ]</code> æ–¹æ‹¬å·æ˜¯protobuf è¯­æ³•çš„ä¸€éƒ¨åˆ†ã€‚</p></blockquote><p>å»æ‰æ‰€æœ‰å¯é€‰éƒ¨åˆ†ï¼Œä¸€ä¸ªæœ€åŸºæœ¬çš„å­—æ®µå†™ä½œ <code>type field_name = fieldNumber</code>ï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> song_name = <span class="number">1</span>;</span><br></pre></td></tr></table></figure><ul><li><code>type</code> å¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯å­—æ®µçš„æ•°æ®ç±»å‹ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»ã€‚</li><li><code>field_name</code> æ˜¯å­—æ®µåç§°ï¼Œé‡‡ç”¨<strong>ä¸‹åˆ’çº¿å‘½å</strong>ã€‚</li><li><code>fieldNumber</code> æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå­—æ®µçš„ç¼–å·ã€‚</li></ul><p>ä¸€ä¸ª message çš„æ¯ä¸ªå­—æ®µéƒ½è¦è¿™ä¸ªå”¯ä¸€ç¼–å·ã€‚å»ºè®®ä¸€æ¬¡å†™å¥½åæ°¸è¿œä¹Ÿä¸è¦æ”¹è¿™ä¸ªç¼–å·ï¼Œå› ä¸ºè¿™ä¸ªç¼–å·æ˜¯ç”¨äºä»¥æ¶ˆæ¯äºŒè¿›åˆ¶æ ¼å¼æ ‡è¯†å­—æ®µçš„ã€‚éœ€è¦æ³¨æ„ä¸€ç‚¹æ˜¯ï¼Œæœ€å¥½æŠŠå‡ºç°é¢‘ç¹çš„æ¶ˆæ¯å…ƒç´ ä½¿ç”¨ç¼–å· 1~15ï¼ˆåªéœ€ä¸€å­—èŠ‚ç¼–ç ï¼‰ï¼Œæ›´å¤§çš„æ•°å­—å°±éœ€è¦æ›´å¤šç©ºé—´äº†ï¼Œå¯ç”¨çš„å–å€¼èŒƒå›´æ˜¯ <code>[1, 19000) U (20000, 2^29)</code>ï¼ˆä¸­é—´æŒ–æ‰çš„æ˜¯ protocol buffers ä¿ç•™çš„ ï¼‰</p><h4 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h4><p>protobuf æ”¯æŒçš„åŸºæœ¬ç±»å‹æœ‰ï¼š</p><table><thead><tr><th>ç±»å‹</th><th>proto</th><th>å¯¹åº” go ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>å­—èŠ‚æ•°ç»„</td><td><code>bytes</code></td><td><code>[]byte</code></td><td>é•¿åº¦ä¸è¶…è¿‡ <code>2^32</code></td></tr><tr><td>å­—ç¬¦ä¸²</td><td><code>string</code></td><td><code>string</code></td><td></td></tr><tr><td>å¸ƒå°”ç±»å‹</td><td><code>bool</code></td><td><code>bool</code></td><td></td></tr><tr><td>æ•´æ•°</td><td><code>int32</code>ï¼Œ<code>int64</code></td><td><code>int32</code>ï¼Œ<code>int64</code></td><td>å˜é•¿ç¼–ç ï¼Œå¯¹è´Ÿæ•°ç¼–ç æ•ˆç‡ä½</td></tr><tr><td>æ— ç¬¦å·æ•´æ•°</td><td><code>uint32</code>ï¼Œ<code>uint64</code></td><td><code>uint32</code>ï¼Œ<code>uint64</code></td><td>å˜é•¿ç¼–ç </td></tr><tr><td>æœ‰ç¬¦å·æ•´æ•°</td><td><code>sint32</code>ï¼Œ<code>sint64</code></td><td><code>int32</code>ï¼Œ<code>int64</code></td><td>å˜é•¿ç¼–ç ï¼Œå¯¹è´Ÿæ•°ç¼–ç æ¯” <code>int32/64</code> é«˜æ•ˆ</td></tr><tr><td>å®šé•¿æ•´æ•°</td><td><code>fixed32</code>ï¼Œ<code>fixed64</code></td><td><code>int32</code>ï¼Œ<code>int64</code></td><td>å›ºå®šç©ºé—´ï¼Œå®šé•¿ç¼–ç ï¼Œé€‚åˆå¤§æ•°</td></tr><tr><td>å®šé•¿æœ‰ç¬¦å·æ•´æ•°</td><td><code>sfixed32</code>ï¼Œ<code>sfixed64</code></td><td><code>int32</code>ï¼Œ<code>int64</code></td><td>å®šé•¿ç¼–ç </td></tr><tr><td>æµ®ç‚¹æ•°</td><td><code>float</code>ï¼Œ<code>double</code></td><td><code>float32</code>ï¼Œ<code>float64</code></td><td></td></tr></tbody></table><p>æ­¤å¤–ï¼Œè¿˜æœ‰å‡ ä¸ªå¤åˆç±»å‹ï¼š</p><p><strong>repeated</strong></p><p><code>repeated</code> å¯ä»¥ç”¨æ¥è¡¨ç¤ºå¯å˜æ•°ç»„ï¼Œä¹Ÿå°±ç›¸å½“äº Golang çš„åˆ‡ç‰‡ç±»å‹ã€‚</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">repeated</span> <span class="built_in">string</span> hobby = <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ hobby å°±å¯ä»¥æœ‰å¥½å¤šä¸ªå€¼ï¼Œç¼–è¯‘æˆ Golang å¯ä»¥çœ‹åˆ°å®ƒå°±æ˜¯ä¸€ä¸ª <code>[]string</code>ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hobby []<span class="keyword">string</span> <span class="string">`protobuf:&quot;bytes,1,rep,name=hobby,proto3&quot; json:&quot;hobby,omitempty&quot;`</span></span><br></pre></td></tr></table></figure><p><strong>map</strong></p><p><code>map</code> æ˜¯é”®å€¼å¯¹ç±»å‹ï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map&lt;<span class="built_in">string</span>, <span class="built_in">int64</span>&gt; something = <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p><strong>enum</strong></p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">EnumNotAllowingAlias</span> </span>&#123;</span><br><span class="line">  UNKNOWN2 = <span class="number">0</span>;</span><br><span class="line">  STARTED2 = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>reserved</strong></p><p>reserved ç”¨æ¥æŒ‡æ˜æ­¤ message ä¸ä½¿ç”¨ï¼ˆä¿ç•™ï¼‰æŸäº›å­—æ®µã€‚é€šè¿‡ç¼–ç æˆ–å­—æ®µåæ¥è®¾ç½®ä¿ç•™ï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">AllNormalypes</span> </span>&#123;</span><br><span class="line">  reserved <span class="number">2</span>, <span class="number">4</span> to <span class="number">6</span>;</span><br><span class="line">  reserved <span class="string">&quot;field14&quot;</span>, <span class="string">&quot;field11&quot;</span>;</span><br><span class="line">  <span class="built_in">double</span> field1 = <span class="number">1</span>;</span><br><span class="line">  <span class="comment">// float field2 = 2;</span></span><br><span class="line">  <span class="built_in">int32</span> field3 = <span class="number">3</span>;</span><br><span class="line">  <span class="comment">// int64 field4 = 4;</span></span><br><span class="line">  <span class="comment">// uint32 field5 = 5;</span></span><br><span class="line">  <span class="comment">// uint64 field6 = 6;</span></span><br><span class="line">  <span class="built_in">sint32</span> field7 = <span class="number">7</span>;</span><br><span class="line">  <span class="built_in">sint64</span> field8 = <span class="number">8</span>;</span><br><span class="line">  <span class="built_in">fixed32</span> field9 = <span class="number">9</span>;</span><br><span class="line">  <span class="built_in">fixed64</span> field10 = <span class="number">10</span>;</span><br><span class="line">  <span class="comment">// sfixed32 field11 = 11;</span></span><br><span class="line">  <span class="built_in">sfixed64</span> field12 = <span class="number">12</span>;</span><br><span class="line">  <span class="built_in">bool</span> field13 = <span class="number">13</span>;</span><br><span class="line">  <span class="comment">// string field14 = 14;</span></span><br><span class="line">  <span class="built_in">bytes</span> field15 = <span class="number">15</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å£°æ˜ä¿ç•™çš„å­—æ®µå°±ä¸èƒ½å†å®šä¹‰ï¼Œå¦åˆ™ç¼–è¯‘ä¼šå‡ºé”™ã€‚</p><p><strong>message</strong></p><p>ä¸€ä¸ª message å¯ä»¥ä½œä¸ºå¦ä¸€ä¸ª message çš„å­—æ®µå‡ºç°ï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">SomeOtherMessage</span> </span>&#123;</span><br><span class="line">  SearchResponse.Result result = <span class="number">1</span>;</span><br><span class="line">  <span class="class"><span class="keyword">message</span> <span class="title">Result</span> </span>&#123;</span><br><span class="line">    <span class="built_in">string</span> url = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">string</span> title = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">repeated</span> <span class="built_in">string</span> snippets = <span class="number">3</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æœåŠ¡"><a href="#æœåŠ¡" class="headerlink" title="æœåŠ¡"></a>æœåŠ¡</h4><p>æˆ‘ä»¬å¸¸æŠŠ Proto Buffers  ç”¨åœ¨ RPC é‡Œå˜›ï¼Œæ‰€ä»¥ Proto Buffers  æ˜¯å¯ä»¥ç›´æ¥å®šä¹‰ RPC æœåŠ¡æ¥å£çš„ã€‚è¿™ä¸ªæ¥å£å¯ä»¥ç›´æ¥ç”¨ gRPC å»å®ç°ï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">service</span> <span class="title">SearchService</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">rpc</span> Search (SearchRequest) <span class="keyword">returns</span> (SearchResponse)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘æ—¶ Proto Buffers ä¼šæ ¹æ®é€‰æ‹©çš„è¯­è¨€ç”ŸæˆæœåŠ¡æ¥å£ä»£ç å’Œå­˜æ ¹ï¼ˆStubï¼‰ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œä»‹ç»å¦‚ä½•åœ¨ gRPC ä¸­ä½¿ç”¨ Ptotobufã€‚</p><h2 id="gRPC-with-Golang"><a href="#gRPC-with-Golang" class="headerlink" title="gRPC with Golang"></a>gRPC with Golang</h2><p>ä»€ä¹ˆæ˜¯ gRPCï¼Ÿå®˜ç½‘ä¸Šå®ƒç»™è‡ªå·±ä¸‹çš„å®šä¹‰æ˜¯ A high-performance, open source universal RPC framework â€”â€” ä¸€ä¸ªé«˜æ€§èƒ½çš„å¼€æºé€šç”¨ RPC æ¡†æ¶ã€‚</p><p>gRPC åœ¨é€šä¿¡çš„è¿‡ç¨‹ä¸­ä½¿ç”¨ Protobufã€‚æ‰€ä»¥å®ƒåŸºæœ¬ä¸Š Protobuf æ”¯æŒçš„è¯­è¨€ gRPC éƒ½æ”¯æŒï¼ŒGoã€C++ã€Javaã€Python è¿™äº›æˆ‘ä»¬å¸¸ç”¨çš„åç«¯è¯­è¨€éƒ½å¯ä»¥ç”¨ gRPCï¼Œè€Œä¸”æ˜¯å¯ä»¥è·¨è¯­è¨€è°ƒç”¨ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç€çœ¼äº Golangï¼Œé€šè¿‡ä¸€ä¸ªç®€å•å®ä¾‹ï¼Œçœ‹çœ‹ gRPC å¦‚ä½•ä½¿ç”¨ã€‚</p><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯åšä¸€ä¸ªå¤„ç†ç”¨æˆ·ä¿¡æ¯çš„ RPC å®ä¾‹ã€‚å®¢æˆ·ç«¯é€šè¿‡ç»™å®šç”¨æˆ·åï¼Œä»æœåŠ¡ç«¯æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ã€‚</p><p>æœ€ç»ˆå®ç°çš„é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">grpc</span><br><span class="line">â”œâ”€â”€ client</span><br><span class="line">â”‚Â Â  â””â”€â”€ main.go</span><br><span class="line">â”œâ”€â”€ go.mod</span><br><span class="line">â”œâ”€â”€ go.sum</span><br><span class="line">â”œâ”€â”€ proto</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ user.pb.go</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ user.proto</span><br><span class="line">â”‚Â Â  â””â”€â”€ user_grpc.pb.go</span><br><span class="line">â””â”€â”€ server</span><br><span class="line">    â””â”€â”€ main.go</span><br></pre></td></tr></table></figure><ul><li>proto ç›®å½•é‡Œæˆ‘ä»¬å†™ <code>user.proto</code> æ¥å®šä¹‰ RPC æœåŠ¡æ¥å£ã€‚</li><li>server å®ç°ä¸€ä¸ª gRPC æœåŠ¡ç«¯ã€‚</li><li>client å®ç°å®¢æˆ·ç«¯ã€‚</li></ul><p>åœ¨é¡¹ç›®æ ¹ç›®å½• grpc ç›®å½•ä¸‹åˆå§‹åŒ–äº†ä¸€ä¸ª go æ¨¡å—ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go mod init grpc.learn</span><br></pre></td></tr></table></figure><p>å®‰è£… gRPC çš„ Go åŒ…ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">go</span> get goole.golang.org/grpc</span><br></pre></td></tr></table></figure><h3 id="Protobuf-ç¼–å†™"><a href="#Protobuf-ç¼–å†™" class="headerlink" title="Protobuf ç¼–å†™"></a>Protobuf ç¼–å†™</h3><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> proto;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨æˆ·ä¿¡æ¯è¯·æ±‚å‚æ•°</span></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">UserRequest</span> </span>&#123;</span><br><span class="line">  <span class="built_in">string</span> name = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨æˆ·ä¿¡æ¯è¯·æ±‚å“åº”</span></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">UserResponse</span> </span>&#123;</span><br><span class="line">  <span class="built_in">int32</span> id = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">string</span> name = <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">int32</span> age = <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">repeated</span> <span class="built_in">string</span> hobby = <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨æˆ·ä¿¡æ¯æ¥å£</span></span><br><span class="line"><span class="class"><span class="keyword">service</span> <span class="title">UserInfo</span> </span>&#123;</span><br><span class="line">  <span class="comment">// è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œè¯·æ±‚å‚æ•°ä¸º UserRequestï¼Œè¿”å›å“åº”ä¸º UserResponse</span></span><br><span class="line">  <span class="function"><span class="keyword">rpc</span> GetUserInfo (UserRequest) <span class="keyword">returns</span> (UserResponse) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Protobuf-ç¼–è¯‘"><a href="#Protobuf-ç¼–è¯‘" class="headerlink" title="Protobuf ç¼–è¯‘"></a>Protobuf ç¼–è¯‘</h3><p>è¿™é‡Œæˆ‘é‡åˆ°ä¸€ä¸ªå‘ï¼Œ ç½‘ä¸Šçš„èµ„æ–™ä¸€èˆ¬éƒ½æ˜¯æ•™ç”¨ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc --go_out=plugins=grpc:. user.proto</span><br></pre></td></tr></table></figure><p>ä½†ç°åœ¨ï¼ˆ2020.08.18ï¼‰è¿™ä¸ªä¸è¡Œäº†ï¼Œä¼šæŠ¥é”™ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--go_out: protoc-gen-go: plugins are not supported; use <span class="string">&#x27;protoc --go-grpc_out=...&#x27;</span> to generate gRPC</span><br></pre></td></tr></table></figure><p>æˆ‘æŸ¥äº† <a href="https://grpc.io/docs/languages/go/quickstart/#regenerate-grpc-code">gRPC å®˜ç½‘çš„æœ‰å…³æ–‡æ¡£</a>ï¼Œä»¥åŠæœ‰å…³çš„ GitHub <a href="https://github.com/grpc/grpc.io/issues/298">gRPC Issue 298</a>ã€<a href="https://github.com/golang/protobuf/issues/1070">Protobuf Issue 1070</a> ç­‰ç­‰ä¸€äº›ä¸œè¥¿ã€‚æ€»è€Œè¨€ä¹‹ï¼ŒProtobuf ç”Ÿæˆ gRPC ä»£ç çš„å·¥å…·æœ€è¿‘æœ‰äº›å˜åŒ–ï¼Œç›®å‰ä½¿ç”¨ protoc ç”Ÿæˆ Golang çš„ gRPC ä»£ç ï¼Œéœ€è¦å®‰è£…ä¸€ä¸ªé¢å¤–çš„åŒ…ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go install google.golang.org/grpc/cmd/protoc-gen-go-grpc</span><br></pre></td></tr></table></figure><p>ç„¶åï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> proto</span><br><span class="line">$ protoc -I . --go_out=. --go-grpc_out=. ./user.proto</span><br></pre></td></tr></table></figure><p>å¿½ç•¥è¾“å‡ºçš„ <code> Missing &#39;go_package&#39; option</code> WARNINGã€‚å°±å¯ä»¥çœ‹åˆ°ç”Ÿæˆçš„æ¥å£æ–‡ä»¶äº†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">proto/</span><br><span class="line">â”œâ”€â”€ user.pb.<span class="keyword">go</span></span><br><span class="line">â”œâ”€â”€ user.proto</span><br><span class="line">â””â”€â”€ user_grpc.pb.<span class="keyword">go</span></span><br></pre></td></tr></table></figure><ul><li><code>--go_out</code> ç”Ÿæˆçš„  <code>user.pb.go</code> ä¸­å®šä¹‰äº† message åœ¨ golang ä¸­çš„ç»“æ„ä½“ï¼Œä»¥åŠå…¶ç¼–ç è§£ç ã€‚</li><li><code>--go-rpc_out</code> ç”Ÿæˆçš„ <code>user_grpc.pb.go</code> é‡Œé¢æ˜¯ service åœ¨ golang ä¸­çš„ gRPC æœåŠ¡ã€å®¢æˆ·ç«¯æ¥å£ã€‚</li></ul><h3 id="æœåŠ¡ç«¯å®ç°"><a href="#æœåŠ¡ç«¯å®ç°" class="headerlink" title="æœåŠ¡ç«¯å®ç°"></a>æœåŠ¡ç«¯å®ç°</h3><p>æŸ¥çœ‹ <code>user_grpc.pb.go</code> ä¸­çš„ä»£ç ï¼Œå‘ç°é‡Œé¢å®šä¹‰æœ‰è¿™äº›ä¸œè¥¿ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserInfoService is the service API for UserInfo service.</span></span><br><span class="line"><span class="comment">// Fields should be assigned to their respective handler implementations only before</span></span><br><span class="line"><span class="comment">// RegisterUserInfoService is called.  Any unassigned fields will result in the</span></span><br><span class="line"><span class="comment">// handler for that method returning an Unimplemented error.</span></span><br><span class="line"><span class="keyword">type</span> UserInfoService <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œè¯·æ±‚å‚æ•°ä¸º UserRequestï¼Œè¿”å›å“åº”ä¸º UserResponse</span></span><br><span class="line">GetUserInfo <span class="function"><span class="keyword">func</span><span class="params">(context.Context, *UserRequest)</span> <span class="params">(*UserResponse, error)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// RegisterUserInfoService registers a service implementation with a gRPC server.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">RegisterUserInfoService</span><span class="params">(s grpc.ServiceRegistrar, srv *UserInfoService)</span></span> &#123;...&#125;</span><br></pre></td></tr></table></figure><p>é æˆ‘å…­çº§é«˜è¾¾ 410 åˆ†çš„æƒŠäººè‹±è¯­å®åŠ›ï¼Œä¿¡è¾¾é›…åœ°ç¿»è¯‘ä¸€ä¸‹ï¼š</p><ul><li><code>UserInfoService</code> æ˜¯ UserInfo æœåŠ¡çš„æœåŠ¡ç«¯æ¥å£ã€‚åœ¨è°ƒç”¨ <code>RegisterUserInfoService</code> ä¹‹å‰ï¼Œ åº”è¯¥å°†å„ç§æœåŠ¡åŠŸèƒ½çš„å…·ä½“å®ç°èµ‹ç»™ <code>UserInfoService</code> çš„å¯¹åº”å­—æ®µã€‚</li><li><code>RegisterUserInfoService</code> åœ¨ gRPC æœåŠ¡å™¨å®ä¾‹ä¸Šæ³¨å†Œä¸€ä¸ª <code>UserInfoService</code> å®ä¾‹ã€‚</li></ul><p>æ–°å»ºä¸€ä¸ª <code>server/main.go</code>ï¼Œåœ¨é‡Œé¢ç¼–å†™å…·ä½“çš„æœåŠ¡ç«¯ä»£ç ã€‚é¦–å…ˆè¦å¯¼å…¥ protobuf çš„æ¥å£ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;grpc.learn/proto&quot;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘æŠŠæ‰€æœ‰ä»£ç éƒ½æ”¾åˆ°ä¸€ä¸ªå« <code>grpc.learn</code> çš„ <code>go module</code> é‡Œäº†ï¼Œæ‰€ä»¥è¿™æ ·å»å– proto å­åŒ…ï¼ˆå³åˆšæ‰å†™çš„ proto æ–‡ä»¶ç”Ÿæˆä»£ç çš„åŒ…ï¼‰ã€‚</p><p>ä½ å»çœ‹ gRPC çš„å®˜æ–¹ä¾‹å­ï¼Œé‡Œé¢è¿˜ä¼šæœ‰ç»™è¿™ä¸ª protobuf æ¥å£çš„åŒ…å–ä¸ªåå­—ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">pb <span class="string">&quot;google.golang.org/grpc/examples/helloworld/helloworld&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘æ²¡å–åå­—ï¼Œæ²¡å…³ç³»ï¼Œè¿™ä¸é‡è¦ã€‚</p><p>åœ¨ <code>UserInfoService</code> ä¸­ <code>GetUserInfo</code> å­—æ®µæ˜¯å‡½æ•°ç±»å‹çš„ã€‚æ‰€ä»¥å¯ä»¥æŠŠä¸€ä¸ªç¬¦åˆå£°æ˜çš„å‡½æ•°èµ‹ç»™ <code>UserInfoService</code> å®ä¾‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// getUserInfo å®ç°å…·ä½“çš„è·å–ç”¨æˆ·ä¿¡æ¯çš„é€»è¾‘</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getUserInfo</span><span class="params">(ctx context.Context, request *proto.UserRequest)</span> <span class="params">(response *proto.UserResponse, err error)</span></span> &#123;</span><br><span class="line">name := request.Name</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;GetUserInfo: name =&quot;</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Fake query</span></span><br><span class="line"><span class="keyword">if</span> name == <span class="string">&quot;foo&quot;</span> &#123;</span><br><span class="line">response = &amp;proto.UserResponse&#123;</span><br><span class="line">Id:    <span class="number">1</span>,</span><br><span class="line">Name:  <span class="string">&quot;foo&quot;</span>,</span><br><span class="line">Age:   <span class="number">12</span>,</span><br><span class="line">Hobby: []<span class="keyword">string</span>&#123;<span class="string">&quot;eating&quot;</span>, <span class="string">&quot;sleep&quot;</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> response, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> response, fmt.Errorf(<span class="string">&quot;unknown user: name=%s&quot;</span>, name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ä¾‹åŒ–ä¸€ä¸ª UserInfoService</span></span><br><span class="line"><span class="keyword">var</span> userInfoService = proto.UserInfoService&#123;</span><br><span class="line">GetUserInfo: getUserInfo,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><details><summary>Tipsï¼šGolang å‡½æ•°ä¸å‡½æ•°ç±»å‹ ï¼ˆç»™ Go è¯­è¨€åˆå­¦è€…ï¼‰</summary><p>Golang ä¸­å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œä»»ä½•å¯ä»¥ä½¿ç”¨å…¶ä»–ç±»å‹å¯¹è±¡çš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨å‡½æ•°ã€‚</p><p>Golang ä¹Ÿæ”¯æŒå‡½æ•°ç±»å‹ï¼Œå³å°†ç›¸åŒå£°æ˜(å‚æ•°æ¥æ”¶ç›¸åŒä¸ªæ•°ã€ç±»å‹ï¼Œè¿”å›ç›¸åŒä¸ªæ•°ã€ç±»å‹)çš„å‡½æ•°çœ‹ä½œä¸€ä¸ªç±»å‹çš„ï¼Œå¯ä»¥ç”¨ type ç»™å‡½æ•°ç±»å‹å–åå­—ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Operation æ˜¯è®¡ç®—çš„æŠ½è±¡</span></span><br><span class="line"><span class="keyword">type</span> Operation <span class="function"><span class="keyword">func</span><span class="params">(Number1, Number2 <span class="keyword">float64</span>)</span> <span class="title">float64</span></span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æŠŠå„ç§æ¥æ”¶ä¸¤ä¸ª float64 å‚æ•°ã€è¿”å› float64 çš„å‡½æ•°éƒ½çœ‹ä½œæ˜¯ Operation çš„<strong>å®ä¾‹</strong>ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(Number1, Number2 <span class="keyword">float64</span>)</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> Number1 + Number2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sub</span><span class="params">(Number1, Number2 <span class="keyword">float64</span>)</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> Number1 - Number2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Add å’Œ Sub éƒ½æ»¡è¶³äº†å£°æ˜ <code>func(Number1, Number2 float64) float64</code>ï¼Œæ‰€ä»¥éƒ½æ˜¯ Operation å‡½æ•°ç±»å‹çš„å®ä¾‹ã€‚å‡½æ•°ç±»å‹çš„å®ä¾‹æ˜¯å…·ä½“å¯è°ƒç”¨çš„å‡½æ•°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> oper Operation</span><br><span class="line">oper = Add</span><br><span class="line">oper(<span class="number">1.0</span>, <span class="number">1.0</span>) <span class="comment">// ç›¸å½“äºè°ƒç”¨ Add(1.0, 1.0)</span></span><br></pre></td></tr></table></figure><p>å›åˆ° gRPCï¼Œæˆ‘ä»¬çš„ GetUserInfo æ˜¯ä¸€ä¸ª <code>func(context.Context, *UserRequest) (*UserResponse, error)</code> å‡½æ•°ç±»å‹çš„å­—æ®µï¼ˆåªæ˜¯æ²¡æœ‰ç»™è¿™ä¸ªå‡½æ•°ç±»å‹å–åå­—ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä»»ä½•æ»¡è¶³äº†è¿™ä¸ªå£°æ˜çš„å‡½æ•°èµ‹å€¼ç»™å®ƒã€‚è¿™é‡Œæˆ‘ä»¬æŠŠå…·ä½“å®ç° <code>getUserInfo</code> èµ‹ç»™ <code>GetUserInfo</code>ã€‚åœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨ <code>GetUserInfo(...)</code> æ—¶ï¼Œå°±ç›¸å½“äºä½¿ç”¨äº† <code>getUserInfo(...)</code>ã€‚</p></details><hr><p>åœ¨ main å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®ä¾‹åŒ–å¹¶å¼€å¯æœåŠ¡ã€‚é¦–å…ˆéœ€è¦å®ä¾‹åŒ–ä¸€ä¸ª grpc æœåŠ¡ï¼Œç„¶åæŠŠæˆ‘ä»¬çš„ UserInfo æœåŠ¡å®ä¾‹æ³¨å†Œä¸Šã€‚æ¥ä¸‹æ¥ï¼Œç›‘å¬ TCP ç½‘ç»œï¼Œåœ¨ç›‘å¬ä¸Šå¯åŠ¨ gRPC æœåŠ¡ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// å®ä¾‹åŒ– gRPCï¼Œæ³¨å†ŒæœåŠ¡</span></span><br><span class="line">s := grpc.NewServer()</span><br><span class="line">proto.RegisterUserInfoService(s, &amp;userInfoService)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬ç½‘ç»œ</span></span><br><span class="line">address := <span class="string">&quot;localhost:8080&quot;</span></span><br><span class="line">listener, err := net.Listen(<span class="string">&quot;tcp&quot;</span>, address)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(<span class="string">&quot;Listening tcp:&quot;</span>, address)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯åŠ¨ gRPC æœåŠ¡</span></span><br><span class="line">err = s.Serve(listener)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®¢æˆ·ç«¯å®ç°"><a href="#å®¢æˆ·ç«¯å®ç°" class="headerlink" title="å®¢æˆ·ç«¯å®ç°"></a>å®¢æˆ·ç«¯å®ç°</h3><p>å®¢æˆ·ç«¯çš„å®ç°ä¸Šï¼Œå’Œ<a href="https://blog.csdn.net/u012419550/article/details/108555316">æˆ‘ä¸Šä¸€ç¯‡æ–‡ç« </a>å†™çš„ç”¨ <code>net/rpc</code> å…¶å®å·®åˆ«ä¸å¤§ã€‚</p><p>é¦–å…ˆæ˜¯è¿æ¥ç½‘ç»œï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">address := <span class="string">&quot;localhost:8080&quot;</span></span><br><span class="line">clientConn, err := grpc.Dial(address, grpc.WithInsecure())</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Dial error:&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> clientConn.Close()</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨ gRPC çš„ <code>ClientConn</code>ï¼Œå®ä¾‹åŒ–ä¸€ä¸ªå®¢æˆ·ç«¯ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client := proto.NewUserInfoClient(clientConn)</span><br></pre></td></tr></table></figure><p>ï¼ˆè¿™é‡Œçš„ proto è¿˜æ˜¯ä¹‹å‰ protoc ç”Ÿæˆä»£ç çš„é‚£ä¸ªåŒ…ï¼‰</p><p>ç„¶åå°±å¯ä»¥è°ƒç”¨æœåŠ¡äº†ï¼Œè¯·æ±‚å‚æ•°æ˜¯ context å’Œä¸€ä¸ª UserRequest å®ä¾‹çš„æŒ‡é’ˆï¼Œè¿”å› UserResponse å’Œ errorï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">req := &amp;proto.UserRequest&#123;Name: <span class="string">&quot;foo&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">resp, err := client.GetUserInfo(context.Background(), req)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;GetUserInfo error:&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">&quot;resp: %#v&quot;</span>, resp)</span><br></pre></td></tr></table></figure><hr><p>ä»¥ä¸Šä»‹ç»çš„å†…å®¹éƒ½ä½¿ç”¨äº†æœ€æ–°çš„ç‰ˆæœ¬ï¼Œç›¸æ¯”äº Google æœç´¢ <code>go gRPC æ•™ç¨‹</code> ç»“æœæ¯”è¾ƒé å‰çš„å‡ ç¯‡ä¸­æ–‡æ–‡ç« ï¼Œè¿™é‡Œä»‹ç»çš„æ–¹æ³•ä» protobuf ç¼–è¯‘åˆ°æœåŠ¡ç«¯å®ç°ä¸Šéƒ½æœ‰ä¸€å®šåŒºåˆ«ã€‚æ–°æ—§ API å„æœ‰ç‰¹è‰²ï¼Œä½†æˆ‘è§‰å¾—éƒ½è¿˜æ˜¯å¾ˆå¥½ç”¨çš„ï¼Œéƒ½æŒºé¡ºæ‰‹ã€‚</p><p>P.S. æˆ‘çš„ç¯å¢ƒæ˜¯ <code>macOS Catalina</code>ï¼Œ <code>go 1.12</code>ï¼Œ<code>libprotoc 3.13.0</code>ï¼Œ<code>protoc-gen-go v1.25.0</code>ï¼Œ<code>protoc-gen-go-grpc v0.0.0-20200917190803-0f7e218c2cf4</code>ã€‚</p><p>å®Œæ•´çš„ä»£ç æˆ‘è¿˜æ˜¯æ”¾åˆ°äº† Gist ä¸­ï¼Œéœ€è¦çš„è¯å¯ä»¥è‡ªå–ï¼š</p><ul><li><a href="https://gist.github.com/cdfmlr/95186d2db5e3c510b324e6ad47a76c9b">https://gist.github.com/cdfmlr/95186d2db5e3c510b324e6ad47a76c9b</a></li></ul><script src="https://gist.github.com/cdfmlr/95186d2db5e3c510b324e6ad47a76c9b.js"></script><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">By(<span class="string">&quot;CDFMLR&quot;</span>, <span class="string">&quot;2020-09-18&quot;</span>)</span><br><span class="line">log.Println(<span class="string">&quot;çœ‹çœ‹ä»Šå¤©çš„æ—¥æœŸï¼Œå†çœ‹çœ‹è¿‘æœŸè¯¸äº‹ï¼Œæˆ‘ä»¬çš„å¼€å‘è€…è¿˜æ˜¯è¦æ›´åŠªåŠ›å•Šã€‚&quot;</span>)</span><br><span class="line"><span class="comment">// See you.ğŸ’ª</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go RPC è¿œç¨‹è¿‡ç¨‹è°ƒç”¨</title>
      <link href="/2020/09/09/blog/Golang-RPC_Intro/"/>
      <url>/2020/09/09/blog/Golang-RPC_Intro/</url>
      
        <content type="html"><![CDATA[<h1 id="Go-RPC-è¿œç¨‹è¿‡ç¨‹è°ƒç”¨"><a href="#Go-RPC-è¿œç¨‹è¿‡ç¨‹è°ƒç”¨" class="headerlink" title="Go RPC è¿œç¨‹è¿‡ç¨‹è°ƒç”¨"></a>Go RPC è¿œç¨‹è¿‡ç¨‹è°ƒç”¨</h1><p>ä»Šå¤©æ¥å­¦ä¹  Go è¯­è¨€çš„<em>è¿œç¨‹è¿‡ç¨‹è°ƒç”¨</em> RPCï¼ˆ Remote Procedure Callï¼‰ã€‚</p><blockquote><p>åœ¨åˆ†å¸ƒå¼è®¡ç®—ï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ˜¯ä¸€ä¸ªè®¡ç®—æœºé€šä¿¡åè®®ã€‚è¯¥åè®®å…è®¸è¿è¡Œäºä¸€å°è®¡ç®—æœºçš„ç¨‹åºè°ƒç”¨å¦ä¸€ä¸ªåœ°å€ç©ºé—´çš„å­ç¨‹åºï¼Œè€Œç¨‹åºå‘˜å°±åƒè°ƒç”¨æœ¬åœ°ç¨‹åºä¸€æ ·ï¼Œæ— éœ€é¢å¤–åœ°ä¸ºè¿™ä¸ªäº¤äº’ä½œç”¨ç¼–ç¨‹ã€‚RPCæ˜¯ä¸€ç§æœåŠ¡å™¨-å®¢æˆ·ç«¯æ¨¡å¼ï¼Œç»å…¸å®ç°æ˜¯ä¸€ä¸ªé€šè¿‡å‘é€è¯·æ±‚-æ¥å—å›åº”è¿›è¡Œä¿¡æ¯äº¤äº’çš„ç³»ç»Ÿã€‚</p><p>From WikiPedia</p></blockquote><p>RPC å¯ä»¥è®©å®¢æˆ·ç«¯ç›¸å¯¹ç›´æ¥åœ°è®¿é—®æœåŠ¡ç«¯çš„å‡½æ•°ï¼Œè¿™é‡Œè¯´çš„ã€Œç›¸å¯¹ç›´æ¥ã€è¡¨ç¤ºæˆ‘ä»¬ä¸éœ€è¦åœ¨æœåŠ¡ç«¯è‡ªå·±å†™ä¸€äº›æ¯”å¦‚ web æœåŠ¡çš„ä¸œè¥¿æ¥æä¾›æ¥å£ï¼Œå¹¶ä¸”åœ¨ä¸¤ç«¯æ‰‹åŠ¨åšå„ç§æ•°æ®çš„ç¼–ç ã€è§£ç ã€‚</p><p>æœ¬æ–‡åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†ä»‹ç» Golang æ ‡å‡†åº“çš„ <code>net/rpc</code>ï¼Œç¬¬äºŒéƒ¨åˆ†åŠ¨æ‰‹å®ç°ä¸€ä¸ªç©å…·ç‰ˆ PRC æ¡†æ¶æ¥åŠ æ·±ç†è§£ã€‚</p><p>[TOC]</p><h2 id="Part0-net-rpc"><a href="#Part0-net-rpc" class="headerlink" title="Part0. net/rpc"></a>Part0. net/rpc</h2><blockquote><p>è¿™ä¸€éƒ¨åˆ†å‚è€ƒ <a href="https://chai2010.cn/advanced-go-programming-book/ch4-rpc/ch4-01-rpc-intro.html">ã€ŠGoè¯­è¨€é«˜çº§ç¼–ç¨‹ã€‹4.1 RPCå…¥é—¨</a>ã€‚æœªå°½ä¹‹å¤„å¯ç§»æ­¥é˜…è¯»åŸæ–‡ã€‚</p></blockquote><p>Go æ ‡å‡†åº“çš„ <code>net/rpc</code> å®ç°äº†åŸºæœ¬çš„ RPCï¼Œå®ƒä½¿ç”¨ä¸€ç§ Go è¯­è¨€ç‰¹æœ‰çš„ Gob ç¼–ç æ–¹å¼ï¼Œæ‰€ä»¥æœåŠ¡ç«¯ã€å®¢æˆ·ç«¯éƒ½å¿…é¡»ä½¿ç”¨ Golangï¼Œä¸èƒ½è·¨è¯­è¨€è°ƒç”¨ã€‚</p><p>å¯¹äºæœåŠ¡ç«¯ï¼Œ <code>net/rpc</code> è¦æ±‚ç”¨ä¸€ä¸ªå¯¼å‡ºçš„ç»“æ„ä½“æ¥è¡¨ç¤º RPC æœåŠ¡ï¼Œè¿™ä¸ªç»“æ„ä½“ä¸­æ‰€æœ‰ç¬¦åˆç‰¹å®šè¦æ±‚çš„æ–¹æ³•å°±æ˜¯æä¾›ç»™å®¢æˆ·ç«¯è®¿é—®çš„ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> T <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *T)</span> <span class="title">MethodName</span><span class="params">(argType T1, replyType *T2)</span> <span class="title">error</span></span></span><br></pre></td></tr></table></figure><ul><li>ç»“æ„ä½“æ˜¯å¯¼å‡ºçš„ã€‚</li><li>æ–¹æ³•æ˜¯å¯¼å‡ºçš„ã€‚</li><li>æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œéƒ½æ˜¯å¯¼å‡ºçš„ç±»å‹ï¼ˆæˆ–è€…å†…ç½®ç±»å‹ï¼‰ã€‚</li><li>æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯æŒ‡é’ˆã€‚</li><li>æ–¹æ³•çš„è¿”å›å€¼æ˜¯ errorã€‚</li></ul><p>æœåŠ¡ç«¯é€šè¿‡ <code>rpc.Dial</code>ï¼ˆå¯¹ TCP æœåŠ¡ï¼‰è¿æ¥æœåŠ¡ç«¯ï¼Œç„¶åç”¨ä½¿ç”¨ Call è°ƒç”¨ RPC æœåŠ¡ä¸­çš„æ–¹æ³•ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpc.Call(<span class="string">&quot;T.MethodName&quot;</span>, argType T1, replyType *T2)</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œç”¨ <code>net/rpc</code> å®ç°ä¸€ä¸ª Hello Worldã€‚</p><h3 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h3><p><strong>æœåŠ¡ç«¯</strong></p><p>é¦–å…ˆæ„å»ºä¸€ä¸ª <code>HelloService</code> æ¥è¡¨ç¤ºæä¾›çš„æœåŠ¡ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.go</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// HelloService is a RPC service for helloWorld</span></span><br><span class="line"><span class="keyword">type</span> HelloService <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hello say hello to request</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *HelloService)</span> <span class="title">Hello</span><span class="params">(request <span class="keyword">string</span>, reply *<span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">*reply = <span class="string">&quot;Hello, &quot;</span> + request</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ³¨å†Œå¹¶å¼€å¯ RPC æœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäº HTTP æœåŠ¡ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.go</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span> <span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// ç”¨å°†ç»™å®¢æˆ·ç«¯è®¿é—®çš„åå­—å’ŒHelloServiceå®ä¾‹æ³¨å†Œ RPC æœåŠ¡</span></span><br><span class="line">rpc.RegisterName(<span class="string">&quot;HelloService&quot;</span>, <span class="built_in">new</span>(HelloService))</span><br><span class="line"></span><br><span class="line"><span class="comment">// HTTP æœåŠ¡</span></span><br><span class="line">rpc.HandleHTTP()</span><br><span class="line">err := http.ListenAndServe(<span class="string">&quot;:1234&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(<span class="string">&quot;Http Listen and Serve:&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ TCP æœåŠ¡ï¼Œæ›¿æ¢ä¸Šé¢çš„ç¬¬ 8ï½12 è¡Œä»£ç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TCP æœåŠ¡</span></span><br><span class="line">listener, err := net.Listen(<span class="string">&quot;tcp&quot;</span>, <span class="string">&quot;:1234&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(<span class="string">&quot;ListenTCP error:&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">conn, err := listener.Accept()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(<span class="string">&quot;Accept error:&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rpc.ServeConn(conn)</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œè¿™é‡ŒæœåŠ¡ç«¯åª Accept ä¸€ä¸ªè¯·æ±‚ï¼Œåœ¨å®¢æˆ·ç«¯è¯·æ±‚è¿‡åå°±ä¼šè‡ªåŠ¨å…³é—­ã€‚å¦‚æœéœ€è¦ä¸€ç›´ä¿æŒå¤„ç†ï¼Œå¯ä»¥æŠŠååŠéƒ¨åˆ†ä»£ç æ¢æˆï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">    conn, err := listener.Accept()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(<span class="string">&quot;Accept error:&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> rpc.ServeConn(conn)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å®¢æˆ·ç«¯</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;net/rpc&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// HTTP</span></span><br><span class="line"><span class="comment">// client, err := rpc.DialHTTP(&quot;tcp&quot;, &quot;localhost:1234&quot;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//TCP</span></span><br><span class="line">client, err := rpc.Dial(<span class="string">&quot;tcp&quot;</span>, <span class="string">&quot;localhost:1234&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(<span class="string">&quot;dialing:&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> reply <span class="keyword">string</span></span><br><span class="line">err = client.Call(<span class="string">&quot;HelloService.Hello&quot;</span>, <span class="string">&quot;world&quot;</span>, &amp;reply)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(reply)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆå¯åŠ¨æœåŠ¡ç«¯ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go run helloworld/server/server.go</span><br></pre></td></tr></table></figure><p>åœ¨å¦ä¸€ä¸ªç»ˆç«¯è°ƒç”¨å®¢æˆ·ç«¯ï¼Œå³å¯å¾—åˆ°ç»“æœï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go run helloworld/client/client.go</span><br><span class="line">Hello, world</span><br></pre></td></tr></table></figure><h3 id="æ›´è§„èŒƒçš„-RPC-æ¥å£"><a href="#æ›´è§„èŒƒçš„-RPC-æ¥å£" class="headerlink" title="æ›´è§„èŒƒçš„ RPC æ¥å£"></a>æ›´è§„èŒƒçš„ RPC æ¥å£</h3><p>ä¹‹å‰çš„ä»£ç æœåŠ¡ç«¯ã€å®¢æˆ·ç«¯çš„æ³¨å†Œã€è°ƒç”¨ RPC æœåŠ¡éƒ½æ˜¯å†™æ­»çš„ã€‚æ‰€æœ‰çš„å·¥ä½œéƒ½æ”¾åˆ°äº†ä¸€å—ï¼Œç›¸å½“ä¸åˆ©äºç»´æŠ¤ï¼Œéœ€è¦è€ƒè™‘é‡æ„ HelloService æœåŠ¡å’Œå®¢æˆ·ç«¯å®ç°ã€‚</p><p><strong>æœåŠ¡ç«¯</strong></p><p>é¦–å…ˆï¼Œç”¨ä¸€ä¸ª interface æŠ½è±¡æœåŠ¡æ¥å£ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HelloServiceName is the name of HelloService</span></span><br><span class="line"><span class="keyword">const</span> HelloServiceName = <span class="string">&quot;HelloService&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// HelloServiceInterface is a interface for HelloService</span></span><br><span class="line"><span class="keyword">type</span> HelloServiceInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">Hello(request <span class="keyword">string</span>, reply *<span class="keyword">string</span>) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// RegisterHelloService register the RPC service on svc</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">RegisterHelloService</span><span class="params">(svc HelloServiceInterface)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> rpc.RegisterName(HelloServiceName, svc)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å®ä¾‹åŒ–æœåŠ¡æ—¶ï¼Œæ³¨å†Œç”¨ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RegisterHelloService(<span class="built_in">new</span>(HelloService))</span><br></pre></td></tr></table></figure><p>å…¶ä½™çš„å…·ä½“æœåŠ¡å®ç°æ²¡æœ‰æ”¹å˜ã€‚</p><p><strong>å®¢æˆ·ç«¯</strong></p><p>åœ¨å®¢æˆ·ç«¯ï¼Œè€ƒè™‘å°† RPC ç»†èŠ‚å°è£…åˆ°ä¸€ä¸ªå®¢æˆ·ç«¯å¯¹è±¡ <code>HelloServiceClient</code> ä¸­ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HelloServiceClient is a client for HelloService</span></span><br><span class="line"><span class="keyword">type</span> HelloServiceClient <span class="keyword">struct</span> &#123;</span><br><span class="line">*rpc.Client</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _ HelloServiceInterface = (*HelloServiceClient)(<span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// DialHelloService dial HelloService</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">DialHelloService</span><span class="params">(network, address <span class="keyword">string</span>)</span> <span class="params">(*HelloServiceClient, error)</span></span> &#123;</span><br><span class="line">c, err := rpc.Dial(network, address)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span> , err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> &amp;HelloServiceClient&#123;Client: c&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hello calls HelloService.Hello</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *HelloServiceClient)</span> <span class="title">Hello</span><span class="params">(request <span class="keyword">string</span>, reply *<span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> p.Client.Call(HelloServiceName + <span class="string">&quot;.Hello&quot;</span>, request, reply)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“è°ƒç”¨æ—¶ï¼Œå°±ä¸ç”¨å»æš´éœ²å¤„ç† RPC çš„ç»†èŠ‚äº†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">client, err := DialHelloService(<span class="string">&quot;tcp&quot;</span>, <span class="string">&quot;localhost:1234&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Fatal(<span class="string">&quot;dialing:&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> reply <span class="keyword">string</span></span><br><span class="line">err = client.Hello(<span class="string">&quot;world&quot;</span>, &amp;reply)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(reply)</span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><p>è¿ç”¨ä¸Šé¢çš„å†…å®¹ï¼Œåšä¸€ä¸ªç®€å•çš„è®¡ç®—å™¨ RPC æœåŠ¡ã€‚é¡¹ç›®ç›®å½•å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">calc&#x2F;</span><br><span class="line">â”œâ”€â”€ calcrpc.go</span><br><span class="line">â”œâ”€â”€ client</span><br><span class="line">â”‚   â””â”€â”€ client.go</span><br><span class="line">â””â”€â”€ server</span><br><span class="line">    â”œâ”€â”€ calc.go</span><br><span class="line">    â””â”€â”€ server.go</span><br></pre></td></tr></table></figure><p>é¦–å…ˆå†™ä¸€ä¸ª <code>calcrpc.go</code> å®šä¹‰æœåŠ¡ç«¯/å®¢æˆ·ç«¯é€šç”¨çš„ RPC æ¥å£ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> calc</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;net/rpc&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ServiceName è®¡ç®—å™¨æœåŠ¡å</span></span><br><span class="line"><span class="keyword">const</span> ServiceName = <span class="string">&quot;CalcService&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ServiceInterface è®¡ç®—å™¨æœåŠ¡æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> ServiceInterface <span class="keyword">interface</span> &#123;</span><br><span class="line"><span class="comment">// CalcTwoNumber å¯¹ä¸¤ä¸ªæ•°è¿›è¡Œè¿ç®—</span></span><br><span class="line">CalcTwoNumber(request Calc, reply *<span class="keyword">float64</span>)  error</span><br><span class="line"><span class="comment">// GetOperators è·å–æ‰€æœ‰æ”¯æŒçš„è¿ç®—</span></span><br><span class="line">GetOperators(request <span class="keyword">struct</span>&#123;&#125;, reply *[]<span class="keyword">string</span>)  error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// RegisterCalcService register the RPC service on svc</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">RegisterCalcService</span><span class="params">(svc ServiceInterface)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> rpc.RegisterName(ServiceName, svc)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Calc å®šä¹‰è®¡ç®—å™¨å¯¹è±¡ï¼ŒåŒ…æ‹¬ä¸¤ä¸ªè¿ç®—æ•°</span></span><br><span class="line"><span class="keyword">type</span> Calc <span class="keyword">struct</span> &#123;</span><br><span class="line">Number1 <span class="keyword">float64</span></span><br><span class="line">Number2 <span class="keyword">float64</span></span><br><span class="line">Operator <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå†™æœåŠ¡ç«¯å®ç°ï¼Œåœ¨ <code>calc.go</code> ä¸­å†™ä¸€ä¸ªå¸¸è§„çš„è®¡ç®—å™¨æŠ½è±¡å®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç®€å•è®¡ç®—å™¨å®ç°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;errors&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æŠ½è±¡çš„è®¡ç®—å‡½æ•°ç±»å‹ */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Operation æ˜¯è®¡ç®—çš„æŠ½è±¡</span></span><br><span class="line"><span class="keyword">type</span> Operation <span class="function"><span class="keyword">func</span><span class="params">(Number1, Number2 <span class="keyword">float64</span>)</span> <span class="title">float64</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* åŠ å‡ä¹˜é™¤çš„å…·ä½“ Operation å®ç° */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Add æ˜¯åŠ æ³•çš„ Operation å®ç°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(Number1, Number2 <span class="keyword">float64</span>)</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> Number1 + Number2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Sub æ˜¯å‡æ³•çš„ Operation å®ç°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sub</span><span class="params">(Number1, Number2 <span class="keyword">float64</span>)</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> Number1 - Number2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Mul æ˜¯ä¹˜æ³•çš„ Operation å®ç°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Mul</span><span class="params">(Number1, Number2 <span class="keyword">float64</span>)</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> Number1 * Number2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Div æ˜¯é™¤æ³•çš„ Operation å®ç°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Div</span><span class="params">(Number1, Number2 <span class="keyword">float64</span>)</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> Number1 / Number2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* å·¥å‚ */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Operators æ³¨å†Œæ‰€æœ‰æ”¯æŒçš„è¿ç®—</span></span><br><span class="line"><span class="keyword">var</span> Operators = <span class="keyword">map</span>[<span class="keyword">string</span>]Operation &#123;</span><br><span class="line"><span class="string">&quot;+&quot;</span>: Add,</span><br><span class="line"><span class="string">&quot;-&quot;</span>: Sub,</span><br><span class="line"><span class="string">&quot;*&quot;</span>: Mul,</span><br><span class="line"><span class="string">&quot;/&quot;</span>: Div,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CreateOperation é€šè¿‡ string è¡¨ç¤ºçš„ operator è·å–é€‚åˆçš„ Operation å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CreateOperation</span><span class="params">(operator <span class="keyword">string</span>)</span> <span class="params">(Operation, error)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> oper Operation</span><br><span class="line"><span class="keyword">if</span> oper, ok := Operators[operator]; ok &#123;</span><br><span class="line"><span class="keyword">return</span> oper, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> oper, errors.New(<span class="string">&quot;Illegal Operator&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ˜¯ RPC æœåŠ¡çš„å®ç°ï¼Œåœ¨ <code>server.go</code> ä¸­ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;gorpctest/calc&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line"><span class="string">&quot;net/rpc&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* RPC æœåŠ¡å®ç° */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// CalcService æ˜¯è®¡ç®—å™¨ RPC æœåŠ¡çš„å®ç°</span></span><br><span class="line"><span class="keyword">type</span> CalcService <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CalcTwoNumber å¯¹ä¸¤ä¸ªæ•°è¿›è¡ŒåŠ å‡ä¹˜é™¤è¿ç®—</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *CalcService)</span> <span class="title">CalcTwoNumber</span><span class="params">(request calc.Calc, reply *<span class="keyword">float64</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">oper, err := CreateOperation(request.Operator)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">*reply = oper(request.Number1, request.Number2)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetOperators è·å–æ‰€æœ‰æ”¯æŒçš„è¿ç®—</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *CalcService)</span> <span class="title">GetOperators</span><span class="params">(request <span class="keyword">struct</span>&#123;&#125;, reply *[]<span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">opers := <span class="built_in">make</span>([]<span class="keyword">string</span>, <span class="number">0</span>, <span class="built_in">len</span>(Operators))</span><br><span class="line"><span class="keyword">for</span> key := <span class="keyword">range</span> Operators &#123;</span><br><span class="line">opers = <span class="built_in">append</span>(opers, key)</span><br><span class="line">&#125;</span><br><span class="line">*reply = opers</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* è¿è¡Œ RPC æœåŠ¡ */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">calc.RegisterCalcService(<span class="built_in">new</span>(CalcService))</span><br><span class="line">rpc.HandleHTTP()</span><br><span class="line">http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯å®¢æˆ·ç«¯å®ç°ï¼Œåœ¨ <code>client.go</code> ä¸­ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;gorpctest/calc&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;net/rpc&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* å®šä¹‰å®¢æˆ·ç«¯å®ç° */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// CalcClient is a client for CalcService</span></span><br><span class="line"><span class="keyword">type</span> CalcClient <span class="keyword">struct</span> &#123;</span><br><span class="line">*rpc.Client</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _ calc.ServiceInterface = (*CalcClient)(<span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// DialCalcService dial CalcService</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">DialCalcService</span><span class="params">(network, address <span class="keyword">string</span>)</span> <span class="params">(*CalcClient, error)</span></span> &#123;</span><br><span class="line">c, err := rpc.DialHTTP(network, address)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span> , err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> &amp;CalcClient&#123;Client: c&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CalcTwoNumber å¯¹ä¸¤ä¸ªæ•°è¿›è¡Œè¿ç®—</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *CalcClient)</span> <span class="title">CalcTwoNumber</span><span class="params">(request calc.Calc, reply *<span class="keyword">float64</span>)</span>  <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> c.Client.Call(calc.ServiceName + <span class="string">&quot;.CalcTwoNumber&quot;</span>, request, reply)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetOperators è·å–æ‰€æœ‰æ”¯æŒçš„è¿ç®—</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *CalcClient)</span> <span class="title">GetOperators</span><span class="params">(request <span class="keyword">struct</span>&#123;&#125;, reply *[]<span class="keyword">string</span>)</span>  <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> c.Client.Call(calc.ServiceName + <span class="string">&quot;.GetOperators&quot;</span>, request, reply)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ä½¿ç”¨å®¢æˆ·ç«¯è°ƒç”¨ RPC æœåŠ¡ */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span> <span class="params">()</span></span> &#123;</span><br><span class="line">client, err := DialCalcService(<span class="string">&quot;tcp&quot;</span>, <span class="string">&quot;localhost:8080&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(<span class="string">&quot;Err Dial Client:&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Test GetOperators</span></span><br><span class="line"><span class="keyword">var</span> opers []<span class="keyword">string</span></span><br><span class="line">err = client.GetOperators(<span class="keyword">struct</span>&#123;&#125;&#123;&#125;, &amp;opers)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Println(err)</span><br><span class="line">&#125;</span><br><span class="line">log.Println(opers)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Test CalcTwoNumber</span></span><br><span class="line">testAdd := calc.Calc &#123;</span><br><span class="line">Number1: <span class="number">2.0</span>,</span><br><span class="line">Number2: <span class="number">3.14</span>,</span><br><span class="line">Operator: <span class="string">&quot;+&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> result <span class="keyword">float64</span></span><br><span class="line">client.CalcTwoNumber(testAdd, &amp;result)</span><br><span class="line">log.Println(result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="net-rpc-jsonrpc"><a href="#net-rpc-jsonrpc" class="headerlink" title="net/rpc/jsonrpc"></a>net/rpc/jsonrpc</h3><p><code>net/rpc</code> å…è®¸ RPC æ•°æ®æ‰“åŒ…æ—¶é€šè¿‡æ’ä»¶å®ç°è‡ªå®šä¹‰çš„ç¼–ç å’Œè§£ç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœåŠ¡æ®µçš„ç¼–ç </span></span><br><span class="line">rpc.ServeCodec(SomeServerCodec(conn)) <span class="comment">// SomeServerCodec æ˜¯ä¸ªç¼–ç å™¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯çš„è§£ç </span></span><br><span class="line">conn, _ := net.Dial(<span class="string">&quot;tcp&quot;</span>, <span class="string">&quot;localhost:1234&quot;</span>)</span><br><span class="line">client := rpc.NewClientWithCodec(SomeClientCodec(conn)) <span class="comment">// SomeClientCodec æ˜¯ä¸ªè§£ç å™¨</span></span><br></pre></td></tr></table></figure><p><code>net/rpc/jsonrpc</code> å°±æ˜¯è¿™æ ·çš„ä¸€ç§å®ç°ï¼Œå®ƒä½¿ç”¨  JSON è€Œä¸æ˜¯ Gob ç¼–ç ï¼Œå¯ä»¥ç”¨æ¥åšè·¨è¯­è¨€ RPCã€‚åœ¨çœŸå®çš„ä½¿ç”¨ä¸­ï¼Œ<code>net/rpc/jsonrpc</code> åœ¨å†…éƒ¨å°è£…äº†ä¸Šé¢æåˆ°çš„ç¼–ç ã€è§£ç å®ç°ï¼Œæä¾›å¤§è‡´ä¸Šå’Œ <code>net/rpc</code> ç›¸åŒçš„ APIã€‚</p><p>æœåŠ¡ç«¯åœ¨ä¹‹å‰çš„ Hello World åŸºç¡€ä¸Šï¼Œåªéœ€è¦æ”¹åŠ¨ main çš„æœ€åä¸€è¡Œä»£ç ï¼ˆä¸ç®— <code>&#125;</code>ï¼‰å³å¯å˜ä¸ºä½¿ç”¨ JSON RPCï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Instead of `go rpc.ServeConn(conn)`</span></span><br><span class="line"><span class="keyword">go</span> jsonrpc.ServeConn(conn)</span><br></pre></td></tr></table></figure><blockquote><p><code>jsonrpc.ServeConn</code> çš„å®ç°æ˜¯ <code>rpc.ServeCodec(jsonrpc.NewServerCodec(conn))</code></p></blockquote><p>åœ¨è°ƒç”¨æ—¶ï¼Œå°† <code>DialHelloService</code> ä¸­è¿æ¥æœåŠ¡çš„ä»£ç æ”¹ä¸€æ”¹å°±å¯ä»¥ä½¿ç”¨äº†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Instead of `c, err := rpc.Dial(network, address)`</span></span><br><span class="line">c, err := jsonrpc.Dial(network, address)</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œä¹Ÿå¯ä»¥ç”¨ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conn, _ := net.Dial(<span class="string">&quot;tcp&quot;</span>, <span class="string">&quot;localhost:1234&quot;</span>)</span><br><span class="line">client := rpc.NewClientWithCodec(jsonrpc.NewClientCodec(conn))</span><br></pre></td></tr></table></figure><p>è¿™æ ·å¼€çš„æœåŠ¡æ˜¯åŸºäº TCP çš„ã€‚æˆ‘ä»¬å¯ä»¥å…³é—­æœåŠ¡ç«¯ç¨‹åºï¼Œè¿è¡Œ <code>nc -l 1234</code> å¯åŠ¨ä¸€ä¸ª TCP æœåŠ¡ï¼Œç„¶åå†æ¬¡è¿è¡Œå®¢æˆ·ç«¯ç¨‹åºï¼Œnc ä¼šè¾“å‡ºå®¢æˆ·ç«¯è¯·æ±‚çš„å†…å®¹ï¼š</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ nc -l 1234</span><br><span class="line">&#123;<span class="string">&quot;method&quot;</span>:<span class="string">&quot;HelloService.Hello&quot;</span>,<span class="string">&quot;params&quot;</span>:[<span class="string">&quot;world&quot;</span>],<span class="string">&quot;id&quot;</span>:0&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¯·æ±‚ä½“æ˜¯ JSON æ•°æ®ã€‚åè¿‡æ¥ï¼Œæ¨¡ä»¿è¿™ä¸ªè¯·æ±‚ä½“ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å‘æ­£åœ¨è¿è¡Œçš„å®¢æˆ·ç«¯å‘é€æ¨¡æ‹Ÿè¯·æ±‚ï¼ŒæŸ¥çœ‹å“åº”ä½“ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> -e <span class="string">&#x27;&#123;&quot;method&quot;:&quot;HelloService.Hello&quot;,&quot;params&quot;:[&quot;JSON-RPC&quot;],&quot;id&quot;:1&#125;&#x27;</span> | nc localhost 1234</span><br><span class="line">&#123;<span class="string">&quot;id&quot;</span>:1,<span class="string">&quot;result&quot;</span>:<span class="string">&quot;Hello, JSON-RPC&quot;</span>,<span class="string">&quot;error&quot;</span>:null&#125;</span><br></pre></td></tr></table></figure><p>æ€»ç»“ä¸€ä¸‹ï¼Œè¯·æ±‚ã€å“åº”çš„ç»“æ„ä½“å¤§æ¦‚ä¸ºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Request <span class="keyword">struct</span> &#123;</span><br><span class="line">    Method <span class="keyword">string</span>           <span class="string">`json:&quot;method&quot;`</span></span><br><span class="line">    Params *json.RawMessage <span class="string">`json:&quot;params&quot;`</span></span><br><span class="line">    Id     *json.RawMessage <span class="string">`json:&quot;id&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Response <span class="keyword">struct</span> &#123;</span><br><span class="line">    Id     <span class="keyword">uint64</span>           <span class="string">`json:&quot;id&quot;`</span></span><br><span class="line">    Result *json.RawMessage <span class="string">`json:&quot;result&quot;`</span></span><br><span class="line">    Error  <span class="keyword">interface</span>&#123;&#125;      <span class="string">`json:&quot;error&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆå…¶å®çœŸæ­£çš„å®ç°ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¯·æ±‚ã€å“åº”å®šä¹‰æ˜¯ç•¥æœ‰åŒºåˆ«çš„ï¼‰</p><p>ä½¿ç”¨å…¶ä»–è¯­è¨€ï¼Œåªè¦éµå¾ªè¿™æ ·çš„è¯·æ±‚/å“åº”ç»“æ„ï¼Œå°±å¯ä»¥å’Œ Go çš„ RPC æœåŠ¡è¿›è¡Œé€šä¿¡äº†ã€‚</p><h3 id="JSON-RPC-in-HTTP"><a href="#JSON-RPC-in-HTTP" class="headerlink" title="JSON-RPC in HTTP"></a>JSON-RPC in HTTP</h3><p>åˆšæ‰çš„å®ç°æ˜¯åŸºäº TCP çš„ï¼Œæœ‰æ—¶å€™ä¸æ–¹ä¾¿ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯èƒ½æ›´å¸Œæœ›ä½¿ç”¨ç†Ÿæ‚‰çš„ HTTP åè®®ã€‚</p><p><code>net/rpc</code> çš„ RPC æœåŠ¡æ˜¯å»ºç«‹åœ¨æŠ½è±¡çš„ <code>io.ReadWriteCloser</code> æ¥å£ä¹‹ä¸Šçš„ï¼ˆconnï¼‰ï¼Œæ‰€ä»¥ç•¥ä½œæ”¹å˜ï¼Œå°±å¯ä»¥å°† RPC æ¶è®¾åœ¨ä¸åŒçš„é€šè®¯åè®®ä¹‹ä¸Šã€‚è¿™é‡Œæˆ‘ä»¬å°†å°è¯•å°† <code>net/rpc/jsonrpc</code> æ¶è®¾åˆ° HTTP æœåŠ¡ä¸Šï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">RegisterHelloService(<span class="built_in">new</span>(HelloService))</span><br><span class="line"></span><br><span class="line"><span class="comment">// HTTP æœåŠ¡</span></span><br><span class="line">http.HandleFunc(<span class="string">&quot;/jsonrpc&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> conn io.ReadWriteCloser = <span class="keyword">struct</span> &#123;</span><br><span class="line">io.Writer</span><br><span class="line">io.ReadCloser</span><br><span class="line">&#125; &#123;</span><br><span class="line">ReadCloser: r.Body,</span><br><span class="line">Writer: w,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rpc.ServeRequest(jsonrpc.NewServerCodec(conn))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">http.ListenAndServe(<span class="string">&quot;:1234&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥é€šè¿‡ HTTP å¾ˆæ–¹ä¾¿åœ°ä»ä¸åŒçš„è¯­è¨€ä¸­è®¿é—® RPC æœåŠ¡äº†ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST http://localhost:1234/jsonrpc  --data <span class="string">&#x27;&#123;&quot;method&quot;:&quot;HelloService.Hello&quot;,&quot;params&quot;:[&quot;world&quot;],&quot;id&quot;:0&#125;&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;id&quot;</span>:0,<span class="string">&quot;result&quot;</span>:<span class="string">&quot;Hello, world&quot;</span>,<span class="string">&quot;error&quot;</span>:null&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œè¿™é‡Œæœ‰ä¸ªé—®é¢˜æ˜¯ï¼Œä¸æ–¹ä¾¿ä½¿ç”¨ Go å†™å®¢æˆ·ç«¯ï¼Œä½ éœ€è¦è‡ªå·±å»æ„å»ºä¸€ä¸ªå®¢æˆ·ç«¯å®ç°ï¼Œæ¥å®Œæˆè¯·æ±‚çš„ç¼–ç ã€å‘é€ä»¥åŠå“åº”çš„è§£ç ã€ç»‘å®šğŸ˜‚ã€‚æˆ–è€…ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ª JSON-RPC çš„åº“ã€‚</p><h2 id="Part1-ç®€å•-RPC-çš„å®ç°"><a href="#Part1-ç®€å•-RPC-çš„å®ç°" class="headerlink" title="Part1. ç®€å• RPC çš„å®ç°"></a>Part1. ç®€å• RPC çš„å®ç°</h2><blockquote><p>è¿™ä¸€éƒ¨åˆ†å‚è€ƒ <a href="https://www.bilibili.com/video/BV137411H7t9?p=9">ã€Šä»0å¼€å§‹å­¦ä¹ å¾®æœåŠ¡æ¡†æ¶ã€‹ P9~P14  RPC</a>ã€‚æœªå°½ä¹‹å¤„å¯ç§»æ­¥å­¦ä¹ åŸè§†é¢‘ã€‚</p></blockquote><p>ä¸ºäº†åŠ æ·±ç†è§£ï¼Œæˆ‘ä»¬æ‰‹å†™ä¸€ä¸ªç®€å•çš„ RPC æœåŠ¡ï¼Œä»è‡ªå®šä¹‰åè®®åˆ°ç¼–ç ã€è§£ç ï¼Œå†åˆ° RPC æœåŠ¡ç«¯ã€å®¢æˆ·ç«¯å®ç°ã€‚</p><p>æˆ‘ä»¬å†™ä¸€ä¸ª <code>package rpc</code> æ¥å®ç°è¿™ä¸œè¥¿ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;rpc</span><br><span class="line">â”œâ”€â”€ client.go</span><br><span class="line">â”œâ”€â”€ codec.go</span><br><span class="line">â”œâ”€â”€ server.go</span><br><span class="line">â””â”€â”€ session.go</span><br><span class="line">(çœç•¥äº†æµ‹è¯•æ–‡ä»¶)</span><br></pre></td></tr></table></figure><h3 id="ç½‘ç»œé€šä¿¡"><a href="#ç½‘ç»œé€šä¿¡" class="headerlink" title="ç½‘ç»œé€šä¿¡"></a>ç½‘ç»œé€šä¿¡</h3><p>æˆ‘ä»¬åŸºäº TCP é€šä¿¡ï¼Œä½¿ç”¨å¦‚ä¸‹è‡ªå®šä¹‰çš„åè®®è¿›è¡Œé€šä¿¡ï¼š</p><table><thead><tr><th><strong>ç½‘ç»œå­—èŠ‚æµ</strong></th><th>Header</th><th>Data</th></tr></thead><tbody><tr><td>å¤§å°</td><td><code>uint32</code>ï¼ˆå®šé•¿ï¼š4å­—èŠ‚ï¼‰</td><td><code>[]byte</code>ï¼ˆé•¿åº¦ç”±HeaderæŒ‡æ˜ï¼‰</td></tr><tr><td>è¯´æ˜</td><td>Data çš„é•¿åº¦ä¿¡æ¯</td><td>å…·ä½“æ•°æ®</td></tr></tbody></table><p>æˆ‘ä»¬é€šè¿‡ä¸€ä¸ª <code>Session</code> ç»“æ„ä½“å®ç°è¿™ä¸ªåŸºæœ¬çš„åè®®ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// session.go PART 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Session æ˜¯ RPC é€šä¿¡çš„ä¸€ä¸ªä¼šè¯è¿æ¥</span></span><br><span class="line"><span class="keyword">type</span> Session <span class="keyword">struct</span> &#123;</span><br><span class="line">conn net.Conn</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewSession ä»ç½‘ç»œè¿æ¥æ–°å»ºä¸€ä¸ª Session</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewSession</span><span class="params">(conn net.Conn)</span> *<span class="title">Session</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> &amp;Session&#123;conn: conn&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹åçš„ RPC é€šä¿¡å°±é€šè¿‡ <code>Session</code>  æ¥å¯¹ TCP è¿æ¥è¿›è¡Œæ•°æ®è¯»å†™æ“ä½œï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// session.go PART 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Write å‘ Session ä¸­å†™æ•°æ®</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Session)</span> <span class="title">Write</span><span class="params">(data []<span class="keyword">byte</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">buf := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">4</span>+<span class="built_in">len</span>(data))</span><br><span class="line"><span class="comment">// Header</span></span><br><span class="line">binary.BigEndian.PutUint32(buf[:<span class="number">4</span>], <span class="keyword">uint32</span>(<span class="built_in">len</span>(data)))</span><br><span class="line"><span class="comment">// Data</span></span><br><span class="line"><span class="built_in">copy</span>(buf[<span class="number">4</span>:], data)</span><br><span class="line"></span><br><span class="line">_, err := s.conn.Write(buf)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Read ä» Session ä¸­è¯»æ•°æ®</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Session)</span> <span class="title">Read</span><span class="params">()</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span> &#123;</span><br><span class="line"><span class="comment">// è¯»å– Headerï¼Œè·å– Data é•¿åº¦ä¿¡æ¯</span></span><br><span class="line">header := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">4</span>)</span><br><span class="line"><span class="keyword">if</span> _, err := io.ReadFull(s.conn, header); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line">dataLen := binary.BigEndian.Uint32(header)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‰ç…§ dataLen è¯»å– Data</span></span><br><span class="line">data := <span class="built_in">make</span>([]<span class="keyword">byte</span>, dataLen)</span><br><span class="line"><span class="keyword">if</span> _, err := io.ReadFull(s.conn, data); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> data, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¼–ç è§£ç "><a href="#ç¼–ç è§£ç " class="headerlink" title="ç¼–ç è§£ç "></a>ç¼–ç è§£ç </h3><p>åœ¨ RPC çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æŒ‰ç…§ä¸€å®šçš„æ ¼å¼ä¼ é€’å‡½æ•°çš„å‚æ•°ä¸ç»“æœã€‚æˆ‘ä»¬å¯ä»¥å®šä¹‰å¦‚ä¸‹ <code>RPCData</code> æ¥æ ¼å¼åŒ– RPC é€šä¿¡çš„å†…å®¹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// codec.go PART 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// RPCData å®šä¹‰ RPC é€šä¿¡çš„æ•°æ®æ ¼å¼</span></span><br><span class="line"><span class="keyword">type</span> RPCData <span class="keyword">struct</span> &#123;</span><br><span class="line">Func <span class="keyword">string</span>        <span class="comment">// è®¿é—®çš„å‡½æ•°</span></span><br><span class="line">Args []<span class="keyword">interface</span>&#123;&#125; <span class="comment">// å‡½æ•°çš„å‚æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ•´ä¸ª RPC ä¸­ï¼Œæ‰€æœ‰ç½‘ç»œé€šä¿¡éƒ½åˆ©ç”¨ <code>Session</code> å¯¹ <code>RPCData</code> ç¼–ç æˆçš„ <code>[]byte</code> è¿›è¡Œä¼ è¾“ã€‚è¦æŠŠ <code>RPCData</code> åœ¨ä¸€ç«¯ç¼–ç æˆå­—èŠ‚ï¼Œå¹¶åœ¨å¦ä¸€ç«¯è§£ç ä¼šåŸæœ¬çš„ Go æ•°æ®ç±»å‹ï¼Œå¯ä»¥åˆ©ç”¨ <code>encoding/gob</code>ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// codec.go PART 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// encode å°† RPCData ç¼–ç </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">encode</span><span class="params">(data RPCData)</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> buf bytes.Buffer</span><br><span class="line">encoder := gob.NewEncoder(&amp;buf)</span><br><span class="line"><span class="keyword">if</span> err := encoder.Encode(data); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> buf.Bytes(), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// decode å°†æ•°æ®è§£ç ä¸º RPCData</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">decode</span><span class="params">(data []<span class="keyword">byte</span>)</span> <span class="params">(RPCData, error)</span></span> &#123;</span><br><span class="line">buf := bytes.NewBuffer(data)</span><br><span class="line">decoder := gob.NewDecoder(buf)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> rpcData RPCData</span><br><span class="line">err := decoder.Decode(&amp;rpcData)</span><br><span class="line"><span class="keyword">return</span> rpcData, err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰äº†ç½‘ç»œé€šä¿¡çš„æ–¹æ¡ˆä»¥åŠç¼–ç è§£ç çš„æ–¹å¼ï¼Œå°±å¯ä»¥å¼€å§‹æ„å»º RPC æœåŠ¡çš„æœåŠ¡ç«¯æ¡†æ¶ä»¥åŠå®¢æˆ·ç«¯å®ç°äº†ã€‚</p><h3 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h3><p>RPC æœåŠ¡ç«¯çš„æ ¸å¿ƒæ˜¯ï¼Œç»´æŠ¤ä¸€ä¸ªå‡½æ•°ååˆ°æœ¬åœ°å‡½æ•°çš„æ˜ å°„ã€‚å®ç°è¿™ä¸ªæ˜ å°„ï¼Œå¹¶å¼€å¯ä¸€ä¸ªç½‘ç»œæœåŠ¡ï¼Œå°±å¯ä»¥æ”¯æŒå®¢æˆ·ç«¯é€šè¿‡ç»™å®šå‡½æ•°åå’Œå‚æ•°å³å¯è°ƒç”¨æœåŠ¡ç«¯å‡½æ•°çš„æ“ä½œäº†ã€‚</p><p>è¿™é‡Œå¯ä»¥ç®€å•åœ°æŠŠæœåŠ¡å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.go PART 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Server æ˜¯ç®€å•çš„ RPC æœåŠ¡</span></span><br><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span> &#123;</span><br><span class="line">funcs <span class="keyword">map</span>[<span class="keyword">string</span>]reflect.Value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewServer</span><span class="params">()</span> *<span class="title">Server</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> &amp;Server&#123;funcs: <span class="keyword">map</span>[<span class="keyword">string</span>]reflect.Value&#123;&#125;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡åå°„æœºåˆ¶ï¼Œæ¥å®ç° funs çš„æ˜ å°„ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.go PART 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Register æ³¨å†Œç»‘å®šè¦ RPC æœåŠ¡çš„å‡½æ•°</span></span><br><span class="line"><span class="comment">// å°†å‡½æ•°åä¸å‡½æ•°å¯¹åº”èµ·æ¥</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Server)</span> <span class="title">Register</span><span class="params">(name <span class="keyword">string</span>, function <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line"><span class="comment">// å·²å­˜åœ¨åˆ™è·³è¿‡</span></span><br><span class="line"><span class="keyword">if</span> _, ok := s.funcs[name]; ok &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">fVal := reflect.ValueOf(function)</span><br><span class="line">s.funcs[name] = fVal</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ˜¯å¼€å¯ç½‘ç»œæœåŠ¡ï¼Œç›‘å¬  TCP è¿æ¥ï¼Œå¯¹è®¿é—®è¿›è¡ŒæœåŠ¡ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.go PART 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ListenAndServe ç›‘å¬ addressï¼Œè¿è¡Œ RPC æœåŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Server)</span> <span class="title">ListenAndServe</span><span class="params">(address <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">listener, err := net.Listen(<span class="string">&quot;tcp&quot;</span>, address)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">conn, err := listener.Accept()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Println(<span class="string">&quot;accept error:&quot;</span>, err)</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">s.handleConn(conn)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“å¯¹è¿æ¥çš„å¤„ç†åœ¨ <code>handleConn</code> ä¸­å®Œæˆã€‚å¯¹ conn åˆ›å»ºä¸€ä¸ª RPC ä¼šè¯ï¼Œè§£ç è¯·æ±‚ä½“ï¼Œå¾—åˆ°å®¢æˆ·ç«¯å¸Œæœ›è¯·æ±‚çš„å‡½æ•°å’Œå‚æ•°ã€‚è°ƒç”¨æœ¬åœ°å‡½æ•°å®Œæˆå·¥ä½œï¼Œå°†è¿”å›å€¼ç¼–ç ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.go PART 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// handleConn å¤„ç† RPC æœåŠ¡çš„ conn è¯·æ±‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Server)</span> <span class="title">handleConn</span><span class="params">(conn net.Conn)</span></span> &#123;</span><br><span class="line"><span class="comment">// åˆ›å»ºä¼šè¯</span></span><br><span class="line">srvSession := NewSession(conn)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯»å–ã€è§£ç æ•°æ®</span></span><br><span class="line">data, err := srvSession.Read()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Println(<span class="string">&quot;session read error:&quot;</span>, err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">requestRPCData, err := decode(data)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Println(<span class="string">&quot;data decode error:&quot;</span>, err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å‡½æ•°</span></span><br><span class="line">f, ok := s.funcs[requestRPCData.Func]</span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;unexpected rpc call: function %s not exist&quot;</span>, requestRPCData.Func)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å‚æ•°</span></span><br><span class="line">inArgs := <span class="built_in">make</span>([]reflect.Value, <span class="number">0</span>, <span class="built_in">len</span>(requestRPCData.Args))</span><br><span class="line"><span class="keyword">for</span> _, arg := <span class="keyword">range</span> requestRPCData.Args &#123;</span><br><span class="line">inArgs = <span class="built_in">append</span>(inArgs, reflect.ValueOf(arg))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åå°„è°ƒç”¨æ–¹æ³•</span></span><br><span class="line">returnValues := f.Call(inArgs)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„é€ ç»“æœ</span></span><br><span class="line">outArgs := <span class="built_in">make</span>([]<span class="keyword">interface</span>&#123;&#125;, <span class="number">0</span>, <span class="built_in">len</span>(returnValues))</span><br><span class="line"><span class="keyword">for</span> _, ret := <span class="keyword">range</span> returnValues &#123;</span><br><span class="line">outArgs = <span class="built_in">append</span>(outArgs, ret.Interface())</span><br><span class="line">&#125;</span><br><span class="line">replyRPCData := RPCData&#123;</span><br><span class="line">Func: requestRPCData.Func,</span><br><span class="line">Args: outArgs,</span><br><span class="line">&#125;</span><br><span class="line">replyEncoded, err := encode(replyRPCData)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Println(<span class="string">&quot;reply encode error:&quot;</span>, err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†™å…¥ç»“æœ</span></span><br><span class="line">err = srvSession.Write(replyEncoded)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Println(<span class="string">&quot;reply write error:&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h3><p>RPC å®¢æˆ·ç«¯çš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œåƒè°ƒç”¨æœ¬åœ°å‡½æ•°ä¸€æ ·å»è°ƒç”¨è¿œç¨‹çš„å‡½æ•°ã€‚è¦è°ƒç”¨çš„å‡½æ•°å¹¶ä¸æ˜¯åœ¨æœ¬åœ°å®ç°çš„ï¼Œä½†æˆ‘ä»¬å¸Œæœ›è®©å®ƒåƒæœ¬åœ°å‡½æ•°ä¸€æ ·å·¥ä½œã€‚åå°„æœºåˆ¶å¯ä»¥æä¾›è¿™ç§â€œæ¬ºéª—è‡ªå·±â€çš„ç‰¹æ€§ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬å†™å‡ºå®¢æˆ·ç«¯ç»“æ„ï¼Œå…¶å®å°±æ˜¯å¯¹ä¸€ä¸ªç½‘ç»œè¿æ¥çš„åŒ…è£…ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// client.go PART 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Client æ˜¯ RPC çš„å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="keyword">type</span> Client <span class="keyword">struct</span> &#123;</span><br><span class="line">conn net.Conn</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewClient</span><span class="params">(conn net.Conn)</span> *<span class="title">Client</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> &amp;Client&#123;conn: conn&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå®ç°ä¸€ä¸ª <code>Call</code> æ–¹æ³•ï¼ŒæŠŠåŸåˆ›çš„å‡½æ•°é€šè¿‡ RPC å¸¦åˆ°æœ¬åœ°æ¥ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// client.go PART 1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Client)</span> <span class="title">Call</span><span class="params">(name <span class="keyword">string</span>, funcPtr <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line"><span class="comment">// åå°„åˆå§‹åŒ– funcPtr å‡½æ•°åŸå‹</span></span><br><span class="line">fn := reflect.ValueOf(funcPtr).Elem()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// RPC è°ƒç”¨è¿œç¨‹çš„å‡½æ•°</span></span><br><span class="line">f := <span class="function"><span class="keyword">func</span><span class="params">(args []reflect.Value)</span> []<span class="title">reflect</span>.<span class="title">Value</span></span> &#123;</span><br><span class="line"><span class="comment">// å‚æ•°</span></span><br><span class="line">inArgs := <span class="built_in">make</span>([]<span class="keyword">interface</span>&#123;&#125;, <span class="number">0</span>, <span class="built_in">len</span>(args))</span><br><span class="line"><span class="keyword">for</span> _, arg := <span class="keyword">range</span> args &#123;</span><br><span class="line">inArgs = <span class="built_in">append</span>(inArgs, arg.Interface())</span><br><span class="line">&#125;</span><br><span class="line">        </span><br><span class="line"><span class="comment">// è¿æ¥æœåŠ¡</span></span><br><span class="line">cliSession := NewSession(c.conn)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯·æ±‚</span></span><br><span class="line">requestRPCData := RPCData&#123;</span><br><span class="line">Func: name,</span><br><span class="line">Args: inArgs,</span><br><span class="line">&#125;</span><br><span class="line">requestEncoded, err := encode(requestRPCData)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> err := cliSession.Write(requestEncoded); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å“åº”</span></span><br><span class="line">response, err := cliSession.Read()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">respRPCData, err := decode(response)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">outArgs := <span class="built_in">make</span>([]reflect.Value, <span class="number">0</span>, <span class="built_in">len</span>(respRPCData.Args))</span><br><span class="line"><span class="keyword">for</span> i, arg := <span class="keyword">range</span> respRPCData.Args &#123;</span><br><span class="line"><span class="keyword">if</span> arg == <span class="literal">nil</span> &#123;</span><br><span class="line">outArgs = <span class="built_in">append</span>(outArgs, reflect.Zero(fn.Type().Out(i)))</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">outArgs = <span class="built_in">append</span>(outArgs, reflect.ValueOf(arg))</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è¿”å›è¿œç¨‹å‡½æ•°çš„è¿”å›å€¼</span></span><br><span class="line"><span class="keyword">return</span> outArgs</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°† RPC è°ƒç”¨å‡½æ•°èµ‹ç»™ fn</span></span><br><span class="line">v := reflect.MakeFunc(fn.Type(), f)</span><br><span class="line">fn.Set(v)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œ<code>name</code> ä¸º RPC æœåŠ¡ç«¯æä¾›çš„å‡½æ•°åï¼Œ<code>funcPtr</code> æ˜¯è¦è°ƒç”¨çš„å‡½æ•°çš„åŸå‹ã€‚è¯¥å‡½æ•°è¿è¡Œçš„ç»“æœæ˜¯å°†ä¸€ä¸ªã€Œå°è£…äº† RPC è°ƒç”¨è¿œç¨‹å‡½æ•°çš„å‡½æ•°ã€â€œèµ‹ç»™â€ <code>funcPtr</code>ï¼Œè®© <code>funcPtr</code> ä»ä¸€ä¸ªç©ºæœ‰å…¶è¡¨çš„åŸå‹å˜æˆä¸€ä¸ªå¯è°ƒç”¨çš„çœŸå®å‡½æ•°ï¼Œè°ƒç”¨å®ƒå°±ç­‰äºé€šè¿‡ RPC è°ƒç”¨æœåŠ¡ç«¯ç›¸åº”çš„å‡½æ•°ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨æœåŠ¡ç«¯å®ç°å¹¶æ³¨å†Œäº†å‡½æ•°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">queryUser</span><span class="params">(uid <span class="keyword">int</span>)</span> <span class="params">(User, error)</span></span> &#123;</span><br><span class="line">... <span class="comment">// queryUser çš„å…·ä½“å®ç°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸€ä¸ª queryUser å‡½æ•°çš„åŸå‹æ¥è·å¾—å…¶èƒ½åŠ›ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> query <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">int</span>)</span> <span class="params">(User, error)</span> // <span class="title">query</span> æ˜¯ <span class="title">queryUser</span> çš„åŸå‹</span></span><br><span class="line">client.Call(<span class="string">&quot;queryUser&quot;</span>, &amp;query) <span class="comment">// â€œæ‹¿åˆ°â€è¿œç¨‹çš„ queryUser å‡½æ•°</span></span><br><span class="line">u, err := query(<span class="number">1</span>) <span class="comment">// åƒè°ƒç”¨æœ¬åœ°å‡½æ•°ä¸€æ ·å»ä½¿ç”¨æ¥è‡ªè¿œç¨‹çš„å‡½æ•°</span></span><br></pre></td></tr></table></figure><p>å¦‚æœå¯¹åå°„ä¸å¤ªç†Ÿæ‚‰ï¼Œéš¾ä»¥ç†è§£ä»£ç å®ç°çš„è¯ï¼Œè¿™é‡Œå¯èƒ½æœ‰ç‚¹è¿·ã€‚å†æ¥çœ‹ä¸€ä¸ªå…·ä½“è°ƒç”¨çš„ä¾‹å­å§ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rpc_test.go</span></span><br><span class="line"><span class="keyword">package</span> rpc</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;encoding/gob&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;net&quot;</span></span><br><span class="line"><span class="string">&quot;testing&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// User  æµ‹è¯•ç”¨çš„ç”¨æˆ·ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">Name <span class="keyword">string</span></span><br><span class="line">Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// queryUser æ¨¡æ‹ŸæŸ¥è¯¢ç”¨æˆ·çš„æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">queryUser</span><span class="params">(uid <span class="keyword">int</span>)</span> <span class="params">(User, error)</span></span> &#123;</span><br><span class="line"><span class="comment">// Fake data</span></span><br><span class="line">user := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]User)</span><br><span class="line">user[<span class="number">0</span>] = User&#123;Name: <span class="string">&quot;Foo&quot;</span>, Age: <span class="number">12</span>&#125;</span><br><span class="line">user[<span class="number">1</span>] = User&#123;Name: <span class="string">&quot;Bar&quot;</span>, Age: <span class="number">13</span>&#125;</span><br><span class="line">user[<span class="number">2</span>] = User&#123;Name: <span class="string">&quot;Joe&quot;</span>, Age: <span class="number">14</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Fake query</span></span><br><span class="line"><span class="keyword">if</span> u, ok := user[uid]; ok &#123;</span><br><span class="line"><span class="keyword">return</span> u, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> User&#123;&#125;, fmt.Errorf(<span class="string">&quot;user wiht id %d is not exist&quot;</span>, uid)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestRPC</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">gob.Register(User&#123;&#125;) <span class="comment">// gob ç¼–ç è¦æ³¨å†Œä¸€ä¸‹æ‰èƒ½ç¼–ç ç»“æ„ä½“</span></span><br><span class="line"></span><br><span class="line">addr := <span class="string">&quot;:8080&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æœåŠ¡ç«¯</span></span><br><span class="line">srv := NewServer()</span><br><span class="line">srv.Register(<span class="string">&quot;queryUser&quot;</span>, queryUser)</span><br><span class="line"><span class="keyword">go</span> srv.ListenAndServe(addr)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯</span></span><br><span class="line">conn, err := net.Dial(<span class="string">&quot;tcp&quot;</span>, addr)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">t.Error(err)</span><br><span class="line">&#125;</span><br><span class="line">cli := NewClient(conn)</span><br><span class="line"><span class="keyword">var</span> query <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">int</span>)</span> <span class="params">(User, error)</span></span></span><br><span class="line">cli.Call(<span class="string">&quot;queryUser&quot;</span>, &amp;query)</span><br><span class="line"></span><br><span class="line">u, err := query(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">t.Error(err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(u)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>TestRPC</code> ä¸­æ¨¡æ‹Ÿäº†æœåŠ¡ç«¯ä»¥åŠå®¢æˆ·ç«¯è°ƒç”¨ RPC æœåŠ¡ã€‚</p><p>è‡³æ­¤ï¼Œä¸€ä¸ªå®Œæ•´çš„ç©å…·ç‰ˆ RPC å°±å®Œæˆäº†ï¼Œè‡ªå·±æ¥å†™è¿™ä¸œè¥¿è¿˜æ˜¯æŒºæœ‰æ„æ€ã€‚å®Œæ•´çš„ä»£ç æˆ‘æ”¾åˆ°äº†è¿™ä¸ª Gist é‡Œ <a href="https://gist.github.com/cdfmlr/a1e275959eb06e5335fcafb7285eb82f">cdfmlr/toy-rpc-golang</a>ï¼š</p><ul><li><a href="https://gist.github.com/cdfmlr/a1e275959eb06e5335fcafb7285eb82f">https://gist.github.com/cdfmlr/a1e275959eb06e5335fcafb7285eb82f</a></li></ul><script src="https://gist.github.com/cdfmlr/a1e275959eb06e5335fcafb7285eb82f.js"></script><hr><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">By(<span class="string">&quot;CDFMLR&quot;</span>, <span class="string">&quot;2020-09-12&quot;</span>)</span><br><span class="line"><span class="comment">// See you.ğŸ’ª</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ginå…¥é—¨</title>
      <link href="/2020/09/03/blog/Gin_quick_start/"/>
      <url>/2020/09/03/blog/Gin_quick_start/</url>
      
        <content type="html"><![CDATA[<h1 id="Gin-å…¥é—¨"><a href="#Gin-å…¥é—¨" class="headerlink" title="Gin å…¥é—¨"></a>Gin å…¥é—¨</h1><p>ç”¨ Go å¥½ä¹…äº†ï¼Œä¹Ÿå†™äº†å¥½å‡ ä¸ªå° Web æœåŠ¡ï¼ŒåŸºæœ¬éƒ½æ˜¯åœ¨ç”¨æ ‡å‡†åº“çš„ <code>net/http</code> + <code>database/sql</code>ï¼Œå…¶å®å¼€å‘éš¾åº¦ã€æ€§èƒ½éƒ½è¿˜ä¸é”™å•¦ã€‚å†™çš„å¤šäº†è¿˜æ˜¯è§‰å¾—ç”¨æ ‡å‡†åº“æœ‰äº›éƒ¨åˆ†ä»£ç é‡å¤æ€§è¿˜æ˜¯å¾ˆé«˜çš„ï¼Œæ…¢æ…¢åœ°è‡ªå·±æ€»ç»“å‡ºä¸€äº›é€šç”¨çš„â€œæ¡†æ¶â€ï¼Œä½†ä¸æˆç†Ÿï¼Œé—®é¢˜å¾ˆå¤šã€‚æ‰€ä»¥å¼€å§‹å­¦ä¸€äº›æˆç†Ÿçš„æ¡†æ¶ï¼Œä¹‹å‰æˆ‘å¼€å§‹ç”¨ Gorm ç®€åŒ–æ•°æ®åº“è¿™æ–¹é¢çš„æµç¨‹ï¼Œè¿™æ¬¡æ˜¯è€ƒè™‘å­¦ä¸€ä¸ª Web æ¡†æ¶å•¦â€”â€” Gin è¶³å¤Ÿç®€æ´ï¼Œä½¿ç”¨çš„ä¹Ÿæ¯”è¾ƒå¹¿æ³›ï¼Œæ‰€ä»¥å°±å®ƒäº†ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><ol><li>ä¸‹è½½å®‰è£… Gin åŒ…ï¼š</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go get -u github.com/gin-gonic/gin</span><br></pre></td></tr></table></figure><ol start="2"><li>åœ¨ä»£ç ä¸­å¯¼å…¥ï¼š</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>(å¯é€‰)å¦‚æœè¦ä½¿ç”¨è¯¸å¦‚ <code>http.StatusOK</code> çš„å¸¸é‡ï¼Œè¿˜è¦å¯¼å…¥ <code>net/http</code></li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;net/http&quot;</span></span><br></pre></td></tr></table></figure><h2 id="èµ·æ­¥"><a href="#èµ·æ­¥" class="headerlink" title="èµ·æ­¥"></a>èµ·æ­¥</h2><p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ <code>example.go</code>ï¼Œæ¥ä¸‹æ¥çš„ä»£ç å°±å†™åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ touch example.go</span><br></pre></td></tr></table></figure><p>ç¼–è¾‘æ–‡ä»¶ï¼Œå†™ä»£ç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">r := gin.Default() <span class="comment">// r æ˜¯ router çš„æ„æ€</span></span><br><span class="line">r.GET(<span class="string">&quot;/ping&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line"><span class="string">&quot;message&quot;</span>: <span class="string">&quot;pong&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">r.Run() <span class="comment">// listen and serve on 0.0.0.0:8080</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œå®ƒï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go run example.go</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥åœ¨æµè§ˆå™¨é‡Œè®¿é—® <code> 0.0.0.0:8080/ping</code> äº†ã€‚å¯ä»¥çœ‹åˆ°è¿”å›çš„ pongï¼Œä»¥åŠç»ˆç«¯è¾“å‡ºçš„ç²¾ç¾æ—¥å¿—ã€‚</p><hr><p>åœ¨è¿™ä¸ª Ping-Pong ç¨‹åºé‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>gin.Default</code> æ¥ç”Ÿæˆä¸€ä¸ªæ¡†æ¶çš„å®ä¾‹ï¼ˆç§°ä¸º Engineï¼‰ã€‚Default ç”Ÿæˆçš„ Engine é‡ŒåŒ…æ‹¬äº†é»˜è®¤çš„ Logger å’Œ Recovery ä¸­é—´ä»¶ã€‚Engine â€œç»§æ‰¿â€äº† RouterGroupï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å¾€é‡Œé¢æ·»åŠ è·¯ç”±ï¼š</p><p><code>r.GET(&#39;/url&#39;, handlerFunc)</code> å£°æ˜ä¸€ä¸ªè·¯ç”±ã€‚GET è®¿é—® URL è§¦å‘ handlerFunc å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ï¼ˆå±äºå‡½æ•°ç±»å‹<code>type HandlerFunc func(*Context)</code>ï¼‰å“åº”è¯·æ±‚ï¼Œè¿™é‡Œç”¨<code>c.JSON</code> è¿”å›ä¸€ä¸ª <code>application/json</code>  çš„å“åº”ã€‚</p><p><code>r.Run()</code> è®© Engine è·‘èµ·æ¥ï¼Œé»˜è®¤çš„æœåŠ¡åœ°å€æ˜¯ <code>:8080</code>ï¼Œå¯ä»¥ç”¨ <code>r.Run(&quot;:9999&quot;)</code> æ¥è‡ªå®šä¹‰ã€‚</p><h2 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h2><p>Ping-Pong ç¨‹åºçš„ä¾‹å­é‡Œï¼Œå·²ç»å±•ç°äº†å›ºå®šè·¯å¾„ã€æ— å‚æ•°çš„ GET è¯·æ±‚è·¯ç”±ã€‚é™¤äº† <code>r.GET</code>ï¼Œè¿˜å¯ä»¥åœ¨ <code>r.</code> åé¢ä½¿ç”¨ <code>POST</code>, <code>PUT</code>, <code>PATCH</code>, <code>DELETE</code>, <code>OPTIONS</code> ä»¥åŠ <code>Any</code> æ¥æ·»åŠ å„ç§è¯·æ±‚ç±»å‹çš„è·¯ç”±ã€‚</p><h3 id="è·¯å¾„å‚æ•°"><a href="#è·¯å¾„å‚æ•°" class="headerlink" title="è·¯å¾„å‚æ•°"></a>è·¯å¾„å‚æ•°</h3><p>è·¯å¾„å‚æ•°å¯ä»¥å®ç°åŠ¨æ€è·¯ç”±ã€‚</p><ul><li><code>/user/:name</code> åŒ¹é… <code>/user/xxx</code></li></ul><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹ä¸åŒçš„ç”¨æˆ·è®¿é—® <code>/user/foo</code>ã€<code>/user/bar</code>ã€‚åˆ™å¯ä»¥ä½¿ç”¨ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">&quot;/user/:name&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    name := c.Param(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">    c.String(http.StatusOK, <span class="string">&quot;Hello, %s&quot;</span>, name)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ curl 0.0.0.0:8080/user/foobar</span><br><span class="line">Hello, foobar</span><br><span class="line">$ curl 0.0.0.0:8080/user/foobar/</span><br><span class="line">&lt;a href=<span class="string">&quot;/user/foobar&quot;</span>&gt;Moved Permanently&lt;/a&gt;.</span><br><span class="line">$ curl 0.0.0.0:8080/user/</span><br><span class="line">404 page not found</span><br></pre></td></tr></table></figure><ul><li><code>/user/:name/*action</code>  åŒ¹é… <code>/user/xxx/</code> ä»¥åŠ <code>/user/xxx/yyy/...</code>;</li></ul><p>è¦åŒ¹é… <code>/user/:name/...</code>ï¼Œä½¿ç”¨å¦‚ä¸‹ç©æ³•ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">&quot;/user/:name/*action&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    name := c.Param(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">    action := c.Param(<span class="string">&quot;action&quot;</span>)</span><br><span class="line">    message := name + <span class="string">&quot; is &quot;</span> + action</span><br><span class="line">    c.String(http.StatusOK, message)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ curl 0.0.0.0:8080/user/foobar/</span><br><span class="line">foobar is /</span><br><span class="line">$ curl 0.0.0.0:8080/user/foobar/doing/something</span><br><span class="line">foobar is /doing/something</span><br></pre></td></tr></table></figure><blockquote><p>P.S. For each matched request Context will hold the route </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">router.POST(<span class="string">&quot;/user/:name/*action&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        c.FullPath() == <span class="string">&quot;/user/:name/*action&quot;</span> <span class="comment">// true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></blockquote><h3 id="é‡å®šå‘"><a href="#é‡å®šå‘" class="headerlink" title="é‡å®šå‘"></a>é‡å®šå‘</h3><ul><li>å¤–éƒ¨çš„é‡å®šå‘ï¼Œä½¿ç”¨ Redirect é€šçŸ¥æµè§ˆå™¨å»é‡å®šå‘ï¼š</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GET ç”¨ 301 Moved Permanently</span></span><br><span class="line">r.GET(<span class="string">&quot;/tobaidu&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.Redirect(http.StatusMovedPermanently, <span class="string">&quot;https://www.baidu.com&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// POST ç”¨ 302 Found</span></span><br><span class="line">r.POST(<span class="string">&quot;toping&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.Redirect(http.StatusFound, <span class="string">&quot;/ping&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ curl -i <span class="string">&#x27;0.0.0.0:8080/tobaidu&#x27;</span></span><br><span class="line">HTTP/1.1 301 Moved Permanently</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Location: https://www.baidu.com</span><br><span class="line">Date: Fri, 04 Sep 2020 13:23:35 GMT</span><br><span class="line">Content-Length: 56</span><br><span class="line"></span><br><span class="line">&lt;a href=<span class="string">&quot;https://www.baidu.com&quot;</span>&gt;Moved Permanently&lt;/a&gt;.</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ curl -i <span class="string">&#x27;0.0.0.0:8080/toping&#x27;</span> -X POST</span><br><span class="line">HTTP/1.1 302 Found</span><br><span class="line">Location: /ping</span><br><span class="line">Date: Fri, 04 Sep 2020 13:23:56 GMT</span><br><span class="line">Content-Length: 0</span><br></pre></td></tr></table></figure><ul><li>å†…éƒ¨çš„é‡å®šå‘ï¼ŒæŠŠè¯·æ±‚çš„ Path ç¡¬æ”¹äº†ç„¶åé‡æ–°å¤„ç†ï¼š</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">&quot;/test&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.Request.URL.Path = <span class="string">&quot;/test2&quot;</span></span><br><span class="line">    r.HandleContext(c)</span><br><span class="line">&#125;)</span><br><span class="line">r.GET(<span class="string">&quot;/test2&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;hello&quot;</span>: <span class="string">&quot;world&quot;</span>&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ curl -i <span class="string">&#x27;0.0.0.0:8080/test&#x27;</span></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json; charset=utf-8</span><br><span class="line">Date: Fri, 04 Sep 2020 13:24:41 GMT</span><br><span class="line">Content-Length: 17</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&quot;hello&quot;</span>:<span class="string">&quot;world&quot;</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="è·¯ç”±åˆ†ç»„"><a href="#è·¯ç”±åˆ†ç»„" class="headerlink" title="è·¯ç”±åˆ†ç»„"></a>è·¯ç”±åˆ†ç»„</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">defaultHandler := <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">        <span class="string">&quot;endpoint&quot;</span>: c.FullPath(),</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">v1 := r.Group(<span class="string">&quot;/v1&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    v1.GET(<span class="string">&quot;/hello&quot;</span>, defaultHandler)</span><br><span class="line">    v1.POST(<span class="string">&quot;/login&quot;</span>, defaultHandler)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">v2 := r.Group(<span class="string">&quot;/v2&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    v2.GET(<span class="string">&quot;/hello&quot;</span>, defaultHandler)</span><br><span class="line">    v2.POST(<span class="string">&quot;/login&quot;</span>, defaultHandler)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>P.S. è¿™é‡Œçš„å¤§æ‹¬å·æ˜¯ä»£è¡¨æŠŠå…¶ä¸­çš„å†…å®¹çœ‹ä½œä¸€ä¸ªå•ç‹¬çš„è¯­å¥å—ï¼ˆç‹¬ç«‹çš„ä½œç”¨åŸŸï¼‰ã€‚</p></blockquote><p>Gin ä¼šè‡ªåŠ¨ç»™åˆ†ç»„çš„è·¯ç”±å˜æˆ <code>/v1/...</code> è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET    &#x2F;v1&#x2F;hello</span><br><span class="line">POST   &#x2F;v1&#x2F;login</span><br><span class="line">GET    &#x2F;v2&#x2F;hello</span><br><span class="line">POST   &#x2F;v2&#x2F;login</span><br></pre></td></tr></table></figure><p>è°ƒç”¨æµ‹è¯•ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ curl <span class="string">&#x27;0.0.0.0:8080/v1/hello&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;endpoint&quot;</span>:<span class="string">&quot;/v1/hello&quot;</span>&#125;</span><br><span class="line">$ curl -X POST <span class="string">&#x27;0.0.0.0:8080/v2/login&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;endpoint&quot;</span>:<span class="string">&quot;/v2/login&quot;</span>&#125;</span><br></pre></td></tr></table></figure><h2 id="è¯·æ±‚å†…å®¹"><a href="#è¯·æ±‚å†…å®¹" class="headerlink" title="è¯·æ±‚å†…å®¹"></a>è¯·æ±‚å†…å®¹</h2><h3 id="Querystring-å‚æ•°"><a href="#Querystring-å‚æ•°" class="headerlink" title="Querystring å‚æ•°"></a>Querystring å‚æ•°</h3><p>GET è¯·æ±‚ä¸­ï¼Œæˆ‘ä»¬å¸¸ç”¨ Querystring å³ <code>http://example.com/welcome?firstname=Jane&amp;lastname=Doe</code> çš„è¿™ç§æŸ¥è¯¢æ–¹å¼ã€‚</p><p>ä½¿ç”¨ <code>context.Query()</code> æ¥è·å–å‚æ•°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">&quot;/welcome&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    firstname := c.DefaultQuery(<span class="string">&quot;firstname&quot;</span>, <span class="string">&quot;Guest&quot;</span>)</span><br><span class="line">    lastname := c.Query(<span class="string">&quot;lastname&quot;</span>)</span><br><span class="line">    <span class="comment">// shortcut for c.Request.URL.Query().Get(&quot;lastname&quot;)</span></span><br><span class="line">    c.String(http.StatusOK, <span class="string">&quot;Hello, %s %s&quot;</span>, firstname, lastname)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ curl <span class="string">&#x27;0.0.0.0:8080/welcome?firstname=Jane&#x27;</span></span><br><span class="line">Hello, Jane </span><br><span class="line">$ curl <span class="string">&#x27;0.0.0.0:8080/welcome?lastname=Doe&#x27;</span></span><br><span class="line">Hello, Guest Doe</span><br><span class="line">$ curl <span class="string">&#x27;0.0.0.0:8080/welcome?firstname=Jane&amp;lastname=Doe&#x27;</span></span><br><span class="line">Hello, Jane Doe</span><br></pre></td></tr></table></figure><h3 id="POST-Form-å‚æ•°"><a href="#POST-Form-å‚æ•°" class="headerlink" title="POST Form å‚æ•°"></a>POST Form å‚æ•°</h3><p>å¯¹äº POST ç­‰è¯·æ±‚æ–¹å¼ï¼Œæˆ‘ä»¬å¸¸ç”¨ Multipart/Urlencoded Form æ¥ä¼ é€’å‚æ•°ä¿¡æ¯ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">r.POST(<span class="string">&quot;/form_post&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    message := c.PostForm(<span class="string">&quot;message&quot;</span>)</span><br><span class="line">    nick := c.DefaultPostForm(<span class="string">&quot;nick&quot;</span>, <span class="string">&quot;anonymous&quot;</span>)</span><br><span class="line"></span><br><span class="line">    c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line">        <span class="string">&quot;status&quot;</span>:  <span class="string">&quot;posted&quot;</span>,</span><br><span class="line">        <span class="string">&quot;message&quot;</span>: message,</span><br><span class="line">        <span class="string">&quot;nick&quot;</span>:    nick,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ curl <span class="string">&#x27;0.0.0.0:8080/form_post&#x27;</span> -X POST</span><br><span class="line">&#123;<span class="string">&quot;message&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;nick&quot;</span>:<span class="string">&quot;anonymous&quot;</span>,<span class="string">&quot;status&quot;</span>:<span class="string">&quot;posted&quot;</span>&#125;</span><br><span class="line">$ curl <span class="string">&#x27;0.0.0.0:8080/form_post&#x27;</span> -X POST -d <span class="string">&#x27;message=hello&amp;nick=Foobar&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;message&quot;</span>:<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;nick&quot;</span>:<span class="string">&quot;Foobar&quot;</span>,<span class="string">&quot;status&quot;</span>:<span class="string">&quot;posted&quot;</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="Map-ä½œä¸ºå‚æ•°"><a href="#Map-ä½œä¸ºå‚æ•°" class="headerlink" title="Map ä½œä¸ºå‚æ•°"></a>Map ä½œä¸ºå‚æ•°</h3><p>å¯¹äºä½¿ç”¨ Map ä½œä¸ºå‚æ•°çš„æƒ…å†µï¼Œå¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;post?ids[a]&#x3D;1234&amp;ids[b]&#x3D;hello HTTP&#x2F;1.1</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">names[first]&#x3D;thinkerou&amp;names[second]&#x3D;tianou</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>QueryMap</code> å’Œ <code>PostFormMap</code> æ¥è·å–ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">r.POST(<span class="string">&quot;/post&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span>&#123;</span><br><span class="line">    ids := c.QueryMap(<span class="string">&quot;ids&quot;</span>)</span><br><span class="line">    names := c.PostFormMap(<span class="string">&quot;names&quot;</span>)</span><br><span class="line">    c.String(http.StatusOK, <span class="string">&quot;ids: %v; names: %v&quot;</span>,  ids, names)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl -g <span class="string">&#x27;http://0.0.0.0:8080/post?ids[a]=1234&amp;ids[b]=hello&#x27;</span> -X POST -d <span class="string">&#x27;names[first]=thinkerou&amp;names[second]=tianou&#x27;</span></span><br><span class="line">ids: map[a:1234 b:hello]; names: map[first:thinkerou second:tianou]</span><br></pre></td></tr></table></figure><h3 id="ä¸Šä¼ æ–‡ä»¶"><a href="#ä¸Šä¼ æ–‡ä»¶" class="headerlink" title="ä¸Šä¼ æ–‡ä»¶"></a>ä¸Šä¼ æ–‡ä»¶</h3><p>åœ¨ä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™ï¼Œå¦‚æœéœ€è¦ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªè¾ƒä½çš„ multipart forms å†…å­˜é™åˆ¶ï¼ˆé»˜è®¤æ˜¯ 32 MiBï¼‰ã€‚</p><p>æ³¨æ„ï¼Œè¿™ä¸ªåªæ˜¯é™åˆ¶åœ¨ä¸Šä¼ æ—¶ç¨‹åºå¯ä»¥ä½¿ç”¨çš„å†…å­˜ï¼Œå¹¶ä¸æ˜¯é™åˆ¶ä¸Šä¼ æ–‡ä»¶çš„å¤§å°ï¼See <a href="https://stackoverflow.com/questions/56143325/gin-web-framework-limit-upload-file-size-not-working">Stackoverflow: gin web framework limit upload file size not working</a>.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r := gin.Default()</span><br><span class="line">r.MaxMultipartMemory = <span class="number">8</span> &lt;&lt; <span class="number">20</span>  <span class="comment">// 8 MiB</span></span><br></pre></td></tr></table></figure><h4 id="å•ä¸ªæ–‡ä»¶"><a href="#å•ä¸ªæ–‡ä»¶" class="headerlink" title="å•ä¸ªæ–‡ä»¶"></a>å•ä¸ªæ–‡ä»¶</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">r.POST(<span class="string">&quot;/upload/single&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    file, err := c.FormFile(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        c.String(http.StatusBadRequest, <span class="string">&quot;get form err: %s&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    filename := filepath.Base(file.Filename)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err := c.SaveUploadedFile(file, filepath.Join(<span class="string">&quot;./upload&quot;</span>, filename)); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        c.String(http.StatusBadRequest, <span class="string">&quot;upload file err: %s&quot;</span>, err.Error())</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    c.String(http.StatusOK, <span class="string">&quot;File %s uploaded successfully&quot;</span>, filename)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>âš ï¸æ³¨æ„ï¼Œä¸è¦ç›´æ¥ç”¨ <code>file.Filename</code>ï¼Œè¯¦è§ <a href="https://github.com/gin-gonic/gin/issues/1693">Gin Issue #1693</a>ã€‚</p><p>ä½¿ç”¨ curl æµ‹è¯•ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X POST <span class="string">&#x27;0.0.0.0:8080/upload/single&#x27;</span> \</span><br><span class="line">-F <span class="string">&quot;file=@/Users/c/Desktop/test.png&quot;</span> \</span><br><span class="line">-H <span class="string">&quot;Content-Type: multipart/form-data&quot;</span></span><br><span class="line">File test.png uploaded successfully</span><br></pre></td></tr></table></figure><h4 id="å¤šä¸ªæ–‡ä»¶"><a href="#å¤šä¸ªæ–‡ä»¶" class="headerlink" title="å¤šä¸ªæ–‡ä»¶"></a>å¤šä¸ªæ–‡ä»¶</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">r.POST(<span class="string">&quot;/upload/multiple&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    form, _ := c.MultipartForm()</span><br><span class="line">    files := form.File[<span class="string">&quot;upload[]&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, file := <span class="keyword">range</span> files &#123;</span><br><span class="line">        filename := filepath.Base(file.Filename)</span><br><span class="line">        c.SaveUploadedFile(file, filepath.Join(<span class="string">&quot;./upload&quot;</span>, filename))</span><br><span class="line">        log.Println(<span class="string">&quot;upload: &quot;</span>, filename)</span><br><span class="line">    &#125;</span><br><span class="line">    c.String(http.StatusOK, <span class="string">&quot;%d files uploaded!&quot;</span>, <span class="built_in">len</span>(files))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å¼‚å¸¸å¤„ç†å‚è€ƒâ€œå•ä¸ªæ–‡ä»¶â€éƒ¨åˆ†çš„ä»£ç ï¼Œè¿™é‡Œç•¥äº†ã€‚</p><p>æµ‹è¯•ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ curl <span class="string">&#x27;0.0.0.0:8080/upload/multiple&#x27;</span> -X POST \</span><br><span class="line">-F <span class="string">&quot;upload[]=@/Users/c/Desktop/test1.png&quot;</span> \</span><br><span class="line">-F <span class="string">&quot;upload[]=@/Users/c/Desktop/test2.png&quot;</span> \</span><br><span class="line">-H <span class="string">&quot;Content-Type: multipart/form-data&quot;</span></span><br><span class="line">2 files uploaded!</span><br></pre></td></tr></table></figure><h2 id="å“åº”æ¸²æŸ“"><a href="#å“åº”æ¸²æŸ“" class="headerlink" title="å“åº”æ¸²æŸ“"></a>å“åº”æ¸²æŸ“</h2><h3 id="JSON-XML-YAML"><a href="#JSON-XML-YAML" class="headerlink" title="JSON, XML, YAML"></a>JSON, XML, YAML</h3><p>å‰é¢æˆ‘ä»¬å·²ç»ç”¨è¿‡å¥½å‡ æ¬¡ JSON äº†ã€‚XMLã€YAML å’Œ JSON å¾ˆç±»ä¼¼ï¼Œè°ƒç”¨å¯¹åº”çš„æ–¹æ³•ï¼Œä¼ å…¥çŠ¶æ€ç ä»¥åŠç»“æœä¿¡æ¯çš„ç»“æ„ä½“å³å¯å†™å…¥å“åº”ï¼š</p><ul><li>JSONï¼š<code>func (c *Context) JSON(code int, obj interface&#123;&#125;)</code></li><li>XMLï¼š<code>func (c *Context) XML(code int, obj interface&#123;&#125;)</code></li><li>YAMLï¼š<code>func (c *Context) YAML(code int, obj interface&#123;&#125;)</code></li></ul><p>å¯¹äºä¸€èˆ¬ç®€å•çš„å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨ <code>gin.H</code> æ¥è¡¨ç¤ºæ•°æ®ã€‚<code>gin.H</code> æ˜¯ <code> map[string]interface&#123;&#125;</code> çš„ç®€å†™ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">&quot;/someJSON&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;hey&quot;</span>, <span class="string">&quot;status&quot;</span>: http.StatusOK&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">r.GET(<span class="string">&quot;/someXML&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.XML(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;hey&quot;</span>, <span class="string">&quot;status&quot;</span>: http.StatusOK&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">r.GET(<span class="string">&quot;/someYAML&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.YAML(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;hey&quot;</span>, <span class="string">&quot;status&quot;</span>: http.StatusOK&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å¯¹äºå¤æ‚çš„æƒ…å†µï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>struct</code> ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">&quot;/moreJSON&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> msg <span class="keyword">struct</span> &#123;</span><br><span class="line">        Name    <span class="keyword">string</span> <span class="string">`json:&quot;user&quot;`</span></span><br><span class="line">        Message <span class="keyword">string</span></span><br><span class="line">        Number  <span class="keyword">int</span></span><br><span class="line">    &#125;</span><br><span class="line">    msg.Name = <span class="string">&quot;Lena&quot;</span></span><br><span class="line">    msg.Message = <span class="string">&quot;hey&quot;</span></span><br><span class="line">    msg.Number = <span class="number">123</span></span><br><span class="line">    <span class="comment">// Note that msg.Name becomes &quot;user&quot; in the JSON</span></span><br><span class="line">    <span class="comment">// Will output  :   &#123;&quot;user&quot;: &quot;Lena&quot;, &quot;Message&quot;: &quot;hey&quot;, &quot;Number&quot;: 123&#125;</span></span><br><span class="line">    c.JSON(http.StatusOK, msg)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å¯¹äº JSONï¼ŒGin è¿˜æä¾›å„ç§éœ€æ±‚çš„ <a href="https://github.com/gin-gonic/gin#securejson">SecureJSON</a>ï¼Œ<a href="https://github.com/gin-gonic/gin#jsonp">JSONP</a>ï¼Œ<a href="https://github.com/gin-gonic/gin#asciijson">AsciiJSON</a>ï¼Œ<a href="https://github.com/gin-gonic/gin#purejson">PureJSON</a>ã€‚</p><h3 id="ProtoBuf"><a href="#ProtoBuf" class="headerlink" title="ProtoBuf"></a>ProtoBuf</h3><p>Gin è¿˜å¯ä»¥ç›´æ¥æ¸²æŸ“ ProtoBufï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">&quot;/someProtoBuf&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    reps := []<span class="keyword">int64</span>&#123;<span class="keyword">int64</span>(<span class="number">1</span>), <span class="keyword">int64</span>(<span class="number">2</span>)&#125;</span><br><span class="line">    label := <span class="string">&quot;test&quot;</span></span><br><span class="line">    <span class="comment">// The specific definition of protobuf is written in the testdata/protoexample file.</span></span><br><span class="line">    data := &amp;protoexample.Test&#123;</span><br><span class="line">        Label: &amp;label,</span><br><span class="line">        Reps:  reps,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Note that data becomes binary data in the response</span></span><br><span class="line">    <span class="comment">// Will output protoexample.Test protobuf serialized data</span></span><br><span class="line">    c.ProtoBuf(http.StatusOK, data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h3><p>è¯»å–æ¨¡ç‰ˆ HTML æ–‡ä»¶ï¼š</p><ul><li> <code>func (engine *Engine) LoadHTMLGlob(pattern string)</code></li><li><code>func (engine *Engine) LoadHTMLFiles(files ...string)</code></li></ul><p>æ¸²æŸ“ HTMLï¼Œå†™å…¥å“åº”ï¼š</p><ul><li><code>func (c *Context) HTML(code int, name string, obj interface&#123;&#125;)</code> å…¶ä¸­ name æ˜¯æ¨¡ç‰ˆæ–‡ä»¶è·¯å¾„ï¼Œobj æ˜¯è¦å¡«å……çš„æ•°æ®ã€‚</li></ul><p>é»˜è®¤æ¸²æŸ“ç”¨çš„æ˜¯å’Œæ ‡å‡†åº“ä¸€æ ·çš„æ¨¡ç‰ˆï¼Œè¯¦è§ <a href="https://golang.org/pkg/text/template/">text/template</a> å’Œ <a href="https://golang.org/pkg/html/template/">html/template</a>ã€‚</p><p>E.g.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">router := gin.Default()</span><br><span class="line">router.LoadHTMLGlob(<span class="string">&quot;templates/*&quot;</span>)</span><br><span class="line"><span class="comment">//router.LoadHTMLFiles(&quot;templates/template1.html&quot;, &quot;templates/template2.html&quot;)</span></span><br><span class="line">router.GET(<span class="string">&quot;/index&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.HTML(http.StatusOK, <span class="string">&quot;index.tmpl&quot;</span>, gin.H&#123;</span><br><span class="line"><span class="string">&quot;title&quot;</span>: <span class="string">&quot;Main website&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>templates/index.tmpl</code>:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">&#123;&#123; .title &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿˜æœ‰å¥½å¤šé«˜çº§ç”¨æ³•ï¼Œæˆ‘ä¸å¤ªç”¨è¿™ä¸œè¥¿ï¼Œå»çœ‹æ–‡æ¡£å§ï¼š<a href="https://github.com/gin-gonic/gin#html-rendering">gin#html-rendering</a>ã€‚</p><h2 id="æ–‡ä»¶æœåŠ¡"><a href="#æ–‡ä»¶æœåŠ¡" class="headerlink" title="æ–‡ä»¶æœåŠ¡"></a>æ–‡ä»¶æœåŠ¡</h2><h3 id="é™æ€æ–‡ä»¶æœåŠ¡"><a href="#é™æ€æ–‡ä»¶æœåŠ¡" class="headerlink" title="é™æ€æ–‡ä»¶æœåŠ¡"></a>é™æ€æ–‡ä»¶æœåŠ¡</h3><p>Serving static files</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">router := gin.Default()</span><br><span class="line">    </span><br><span class="line">router.Static(<span class="string">&quot;/assets&quot;</span>, <span class="string">&quot;./assets&quot;</span>)</span><br><span class="line">router.StaticFS(<span class="string">&quot;/more_static&quot;</span>, http.Dir(<span class="string">&quot;my_file_system&quot;</span>))</span><br><span class="line">router.StaticFile(<span class="string">&quot;/favicon.ico&quot;</span>, <span class="string">&quot;./resources/favicon.ico&quot;</span>)</span><br><span class="line"></span><br><span class="line">router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>Static(relativePath, root string)</code>ï¼šåœ¨ root è·¯å¾„å¤„å¼€é™æ€æ–‡ä»¶æœåŠ¡ã€‚</li><li><code>StaticFS(relativePath string, fs http.FileSystem)</code>ï¼šç±»ä¼¼ <code>Static()</code>ï¼Œä½†å¯ä»¥ç”¨ <code>http.FileSystem</code>ã€‚</li><li><code>StaticFile(relativePath, filepath string)</code>ï¼šæ³¨å†ŒæœåŠ¡å•ä¸ªæ–‡ä»¶ã€‚</li></ul><h3 id="æ–‡ä»¶æ•°æ®æœåŠ¡"><a href="#æ–‡ä»¶æ•°æ®æœåŠ¡" class="headerlink" title="æ–‡ä»¶æ•°æ®æœåŠ¡"></a>æ–‡ä»¶æ•°æ®æœåŠ¡</h3><p>Serving data from fileï¼Œå°±æ˜¯æŠŠæ–‡ä»¶å†™å…¥å“åº”å•¦ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">router := gin.Default()</span><br><span class="line"></span><br><span class="line">router.GET(<span class="string">&quot;/local/file&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.File(<span class="string">&quot;local/file.go&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fs http.FileSystem = <span class="comment">// ...</span></span><br><span class="line">router.GET(<span class="string">&quot;/fs/file&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.FileFromFS(<span class="string">&quot;fs/file.go&quot;</span>, fs)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç”¨-Reader-æ•°æ®å“åº”"><a href="#ç”¨-Reader-æ•°æ®å“åº”" class="headerlink" title="ç”¨ Reader æ•°æ®å“åº”"></a>ç”¨ Reader æ•°æ®å“åº”</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">router := gin.Default()</span><br><span class="line">router.GET(<span class="string">&quot;/someDataFromReader&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">response, err := http.Get(<span class="string">&quot;https://raw.githubusercontent.com/gin-gonic/logo/master/color.png&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> || response.StatusCode != http.StatusOK &#123;</span><br><span class="line">c.Status(http.StatusServiceUnavailable)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">reader := response.Body</span><br><span class="line">contentLength := response.ContentLength</span><br><span class="line">contentType := response.Header.Get(<span class="string">&quot;Content-Type&quot;</span>)</span><br><span class="line"></span><br><span class="line">extraHeaders := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;</span><br><span class="line"><span class="string">&quot;Content-Disposition&quot;</span>: <span class="string">`attachment; filename=&quot;gopher.png&quot;`</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c.DataFromReader(http.StatusOK, contentLength, contentType, reader, extraHeaders)</span><br><span class="line">&#125;)</span><br><span class="line">router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¨¡å‹ç»‘å®š"><a href="#æ¨¡å‹ç»‘å®š" class="headerlink" title="æ¨¡å‹ç»‘å®š"></a>æ¨¡å‹ç»‘å®š</h2><p>æ—¥å¸¸çš„å¼€å‘ä¸­ï¼ŒæŠŠè¯·æ±‚ä½“ä¸­çš„å†…å®¹æ”¾åˆ°ä¸€ä¸ªç»“æ„ä½“é‡Œï¼Œå¹¶éªŒè¯ç»™çš„ä¿¡æ¯æ˜¯å¦å®Œæ•´æ˜¯å¾ˆå¸¸ç”¨çš„åŠŸèƒ½ã€‚Gin æä¾›æ¨¡å‹ç»‘å®š(model binding)æ¥å®Œæˆè¿™ä¸€åŠŸèƒ½ã€‚æ¨¡å‹ç»‘å®šå¯ä»¥æŠŠ Form å€¼ã€JSONã€XMLã€YAML å½¢å¼çš„æ•°æ®ç»‘å®šåˆ° Go çš„ç»“æ„ä½“ã€‚</p><p>Gin æä¾›ä¸¤å¥—ç»‘å®šçš„æ–¹æ³•ï¼š<code>Bind</code> å’Œ <code>ShouldBind</code>ã€‚<code>Bind</code> åœ¨ç»‘å®šå‡ºé”™æ—¶æŠŠ 400 aborted å†™å…¥å“åº”ï¼ˆ<code>c.AbortWithError(400, err).SetType(ErrorTypeBind)</code>ï¼‰ã€‚<code>ShouldBind</code> åœ¨ç»‘å®šå¤±è´¥æ—¶è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å»å¤„ç†é”™è¯¯ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Login <span class="keyword">struct</span> &#123;</span><br><span class="line">User <span class="keyword">string</span> <span class="string">`form:&quot;user&quot; json:&quot;user&quot; xml:&quot;user&quot; binding:&quot;required&quot;`</span></span><br><span class="line">Password <span class="keyword">string</span> <span class="string">`form:&quot;password&quot; json:&quot;password&quot; xml:&quot;password&quot; binding:&quot;required&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">router := gin.Default()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Example for binding JSON:</span></span><br><span class="line"><span class="comment">//     &#123;&quot;user&quot;: &quot;manu&quot;, &quot;password&quot;: &quot;123&quot;&#125;</span></span><br><span class="line">router.POST(<span class="string">&quot;/loginJSON&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> json Login</span><br><span class="line"><span class="keyword">if</span> err := c.ShouldBindJSON(&amp;json); err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> json.User != <span class="string">&quot;manu&quot;</span> || json.Password != <span class="string">&quot;123&quot;</span> &#123;</span><br><span class="line">c.JSON(http.StatusUnauthorized, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;unauthorized&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;you are logged in&quot;</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Example for binding XML:</span></span><br><span class="line"><span class="comment">//     &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="comment">//     &lt;root&gt;</span></span><br><span class="line"><span class="comment">//         &lt;user&gt;manu&lt;/user&gt;</span></span><br><span class="line"><span class="comment">//         &lt;password&gt;123&lt;/password&gt;</span></span><br><span class="line"><span class="comment">//     &lt;/root&gt;</span></span><br><span class="line">router.POST(<span class="string">&quot;/loginXML&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> xml Login</span><br><span class="line"><span class="keyword">if</span> err := c.ShouldBindXML(&amp;xml); err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> xml.User != <span class="string">&quot;manu&quot;</span> || xml.Password != <span class="string">&quot;123&quot;</span> &#123;</span><br><span class="line">c.JSON(http.StatusUnauthorized, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;unauthorized&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;you are logged in&quot;</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Example for binding a HTML form:</span></span><br><span class="line"><span class="comment">//     user=manu&amp;password=123</span></span><br><span class="line">router.POST(<span class="string">&quot;/loginForm&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> form Login</span><br><span class="line"><span class="comment">// This will infer what binder to use depending on the content-type header.</span></span><br><span class="line"><span class="keyword">if</span> err := c.ShouldBind(&amp;form); err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> form.User != <span class="string">&quot;manu&quot;</span> || form.Password != <span class="string">&quot;123&quot;</span> &#123;</span><br><span class="line">c.JSON(http.StatusUnauthorized, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;unauthorized&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;you are logged in&quot;</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ curl -v -X POST \</span><br><span class="line">  http://localhost:8080/loginJSON \</span><br><span class="line">  -H <span class="string">&#x27;content-type: application/json&#x27;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123; &quot;user&quot;: &quot;manu&quot; &#125;&#x27;</span></span><br><span class="line">&gt; POST /loginJSON HTTP/1.1</span><br><span class="line">&gt; Host: localhost:8080</span><br><span class="line">&gt; User-Agent: curl/7.64.1</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt; content-type: application/json</span><br><span class="line">&gt; Content-Length: 18</span><br><span class="line">&gt; </span><br><span class="line">* upload completely sent off: 18 out of 18 bytes</span><br><span class="line">&lt; HTTP/1.1 400 Bad Request</span><br><span class="line">&lt; Content-Type: application/json; charset=utf-8</span><br><span class="line">&lt; Date: Sun, 06 Sep 2020 13:04:57 GMT</span><br><span class="line">&lt; Content-Length: 100</span><br><span class="line">&lt; </span><br><span class="line">&#123;<span class="string">&quot;error&quot;</span>:<span class="string">&quot;Key: &#x27;Login.Password&#x27; Error:Field validation for &#x27;Password&#x27; failed on the &#x27;required&#x27; tag&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„åœ¨ <code>/loginForm</code> é‡Œé¢ç”¨äº† <code>ShouldBind</code>ï¼Œè¿™ä¸ªä¼šè‡ªåŠ¨é€šè¿‡ content-type æ¥åˆ¤æ–­ä½ è¯·æ±‚ç”¨çš„æ˜¯ Formã€JSONã€XMLã€YAML çš„å“ªä¸€ç§ï¼Œç„¶åç”¨å¯¹åº”çš„ <code>ShouldBindXXXX</code> æŠŠè¯·æ±‚çš„å†…å®¹ç»‘å®šåˆ°ç»“æ„ä½“ã€‚</p><p>åœ¨ç»“æ„ä½“çš„å®šä¹‰ä¸­ï¼Œè¦ä½¿ç”¨ tag æ¥æŒ‡å®šå­—æ®µåœ¨å„ç§éœ€è¦çš„ æ ¼å¼ä¸­çš„åå­—ï¼Œå¹¶ä¸”åˆ¶å®šæ˜¯å¦å¿…é¡»ç»‘å®šï¼š</p><ul><li><code>binding:&quot;required&quot;</code> åˆ™å¿…é¡»ç»‘å®šï¼Œå¦‚æœè¯·æ±‚ä¸­æ²¡æœ‰å¯¹åº”çš„é¡¹åˆ™è¿”å›é”™è¯¯ã€‚</li><li><code>binding:&quot;-&quot;</code>ï¼šå¯é€‰ï¼Œè¯·æ±‚ä¸­æ²¡æœ‰ä¸ä¼šæŠ¥é”™ã€‚</li></ul><p>Gin æ˜¯ä½¿ç”¨ <code>github.com/go-playground/validator/v10</code>  æ¥å®ŒæˆéªŒè¯çš„ã€‚è¿™ä¸ªåŒ…æä¾›æ›´å¤æ‚çš„éªŒè¯åŠŸèƒ½ï¼š</p><blockquote><p>(Emmmmï¼Œå­¦ä¸åŠ¨äº†ï¼Œä½†æ„Ÿè§‰è¿™ä¸ªç‰¹åˆ«æœ‰ç”¨ï¼Œä»æ–‡æ¡£ç›´æ¥æŠ„ä¸‹æ¥äº†)</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin/binding&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/go-playground/validator/v10&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Booking contains binded and validated data.</span></span><br><span class="line"><span class="keyword">type</span> Booking <span class="keyword">struct</span> &#123;</span><br><span class="line">CheckIn  time.Time <span class="string">`form:&quot;check_in&quot; binding:&quot;required,bookabledate&quot; time_format:&quot;2006-01-02&quot;`</span></span><br><span class="line">CheckOut time.Time <span class="string">`form:&quot;check_out&quot; binding:&quot;required,gtfield=CheckIn&quot; time_format:&quot;2006-01-02&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bookableDate validator.Func = <span class="function"><span class="keyword">func</span><span class="params">(fl validator.FieldLevel)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">date, ok := fl.Field().Interface().(time.Time)</span><br><span class="line"><span class="keyword">if</span> ok &#123;</span><br><span class="line">today := time.Now()</span><br><span class="line"><span class="keyword">if</span> today.After(date) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">route := gin.Default()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> v, ok := binding.Validator.Engine().(*validator.Validate); ok &#123;</span><br><span class="line">v.RegisterValidation(<span class="string">&quot;bookabledate&quot;</span>, bookableDate)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">route.GET(<span class="string">&quot;/bookable&quot;</span>, getBookable)</span><br><span class="line">route.Run(<span class="string">&quot;:8085&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getBookable</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> b Booking</span><br><span class="line"><span class="keyword">if</span> err := c.ShouldBindWith(&amp;b, binding.Query); err == <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Booking dates are valid!&quot;</span>&#125;)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ curl <span class="string">&quot;localhost:8085/bookable?check_in=2030-04-16&amp;check_out=2030-04-17&quot;</span></span><br><span class="line">&#123;<span class="string">&quot;message&quot;</span>:<span class="string">&quot;Booking dates are valid!&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">$ curl <span class="string">&quot;localhost:8085/bookable?check_in=2030-03-10&amp;check_out=2030-03-09&quot;</span></span><br><span class="line">&#123;<span class="string">&quot;error&quot;</span>:<span class="string">&quot;Key: &#x27;Booking.CheckOut&#x27; Error:Field validation for &#x27;CheckOut&#x27; failed on the &#x27;gtfield&#x27; tag&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">$ curl <span class="string">&quot;localhost:8085/bookable?check_in=2000-03-09&amp;check_out=2000-03-10&quot;</span></span><br><span class="line">&#123;<span class="string">&quot;error&quot;</span>:<span class="string">&quot;Key: &#x27;Booking.CheckIn&#x27; Error:Field validation for &#x27;CheckIn&#x27; failed on the &#x27;bookabledate&#x27; tag&quot;</span>&#125;%    </span><br></pre></td></tr></table></figure><p>Gin è¿˜æä¾›å¾ˆå¤šå…¶ä»–çš„å…³äºç»‘å®šçš„åŠŸèƒ½ï¼Œæ¯”å¦‚è·¯å¾„å‚æ•°çš„ç»‘å®šã€ä¸Šä¼ æ–‡ä»¶çš„ç»‘å®šã€HTML å¤é€‰æ¡†çš„ç»‘å®šç­‰ç­‰ã€‚è¯¦ç»†çš„çœ‹æ–‡æ¡£å§ï¼š<a href="https://github.com/gin-gonic/gin#model-binding-and-validation">gin#model-binding-and-validation</a>ã€‚</p><h2 id="ä¸­é—´ä»¶"><a href="#ä¸­é—´ä»¶" class="headerlink" title="ä¸­é—´ä»¶"></a>ä¸­é—´ä»¶</h2><p>ä¹‹å‰æˆ‘ä»¬éƒ½æ˜¯ç”¨ <code>r = gin.Default()</code> æ¥å®ä¾‹åŒ– Gin çš„ï¼Œè¿™æ ·æå‡ºæ¥çš„ r æ˜¯è‡ªå¸¦ Logger å’Œ Recovery ä¸­é—´ä»¶çš„ï¼Œè¦åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ï¼Œæ²¡æœ‰ä¸­é—´ä»¶çš„å®ä¾‹ï¼Œä½¿ç”¨ <code>New</code> æ¥æ›¿æ¢ <code>Default</code>ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r := gin.New()</span><br></pre></td></tr></table></figure><p>é€šè¿‡ <code>r.Use(ä¸­é—´ä»¶())</code> æ¥æ·»åŠ ä¸­é—´ä»¶ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// Creates a router without any middleware by default</span></span><br><span class="line">r := gin.New()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Global middleware</span></span><br><span class="line"><span class="comment">// Logger middleware will write the logs to gin.DefaultWriter even if you set with GIN_MODE=release.</span></span><br><span class="line"><span class="comment">// By default gin.DefaultWriter = os.Stdout</span></span><br><span class="line">r.Use(gin.Logger())</span><br><span class="line"></span><br><span class="line"><span class="comment">// Recovery middleware recovers from any panics and writes a 500 if there was one.</span></span><br><span class="line">r.Use(gin.Recovery())</span><br><span class="line"></span><br><span class="line"><span class="comment">// Per route middleware, you can add as many as you desire.</span></span><br><span class="line">r.GET(<span class="string">&quot;/benchmark&quot;</span>, MyBenchLogger(), benchEndpoint)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Authorization group</span></span><br><span class="line"><span class="comment">// authorized := r.Group(&quot;/&quot;, AuthRequired())</span></span><br><span class="line"><span class="comment">// exactly the same as:</span></span><br><span class="line">authorized := r.Group(<span class="string">&quot;/&quot;</span>)</span><br><span class="line"><span class="comment">// per group middleware! in this case we use the custom created</span></span><br><span class="line"><span class="comment">// AuthRequired() middleware just in the &quot;authorized&quot; group.</span></span><br><span class="line">authorized.Use(AuthRequired())</span><br><span class="line">&#123;</span><br><span class="line">authorized.POST(<span class="string">&quot;/login&quot;</span>, loginEndpoint)</span><br><span class="line">authorized.POST(<span class="string">&quot;/submit&quot;</span>, submitEndpoint)</span><br><span class="line">authorized.POST(<span class="string">&quot;/read&quot;</span>, readEndpoint)</span><br><span class="line"></span><br><span class="line"><span class="comment">// nested group</span></span><br><span class="line">testing := authorized.Group(<span class="string">&quot;testing&quot;</span>)</span><br><span class="line">testing.GET(<span class="string">&quot;/analytics&quot;</span>, analyticsEndpoint)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Listen and serve on 0.0.0.0:8080</span></span><br><span class="line">r.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€‚ã€‚ã€‚</p><p>å†™ä¸åŠ¨äº†ï¼Œäº†è§£æ›´å¤š Gin è¯·åˆ° <a href="https://github.com/gin-gonic/gin">gin çš„ readme</a>ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Golang </tag>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonæ·±åº¦å­¦ä¹ ä¹‹GAN</title>
      <link href="/2020/08/24/DeepLearningWithPython/Deep-Learning%20with-Python-ch8_5/"/>
      <url>/2020/08/24/DeepLearningWithPython/Deep-Learning%20with-Python-ch8_5/</url>
      
        <content type="html"><![CDATA[<h1 id="Deep-Learning-with-Python"><a href="#Deep-Learning-with-Python" class="headerlink" title="Deep Learning with Python"></a>Deep Learning with Python</h1><p>è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘å­¦ä¹ ã€ŠDeep Learning with Pythonã€‹(ç¬¬äºŒç‰ˆï¼ŒFranÃ§ois Chollet è‘—) æ—¶å†™çš„ç³»åˆ—ç¬”è®°ä¹‹ä¸€ã€‚æ–‡ç« çš„å†…å®¹æ˜¯ä»  Jupyter notebooks è½¬æˆ Markdown çš„ï¼Œä½ å¯ä»¥å» <a href="https://github.com/cdfmlr/Deep-Learning-with-Python-Notebooks">GitHub</a> æˆ– <a href="https://gitee.com/cdfmlr/Deep-Learning-with-Python-Notebooks">Gitee</a> æ‰¾åˆ°åŸå§‹çš„ <code>.ipynb</code> ç¬”è®°æœ¬ã€‚</p><p>ä½ å¯ä»¥å»<a href="https://livebook.manning.com/book/deep-learning-with-python">è¿™ä¸ªç½‘ç«™åœ¨çº¿é˜…è¯»è¿™æœ¬ä¹¦çš„æ­£ç‰ˆåŸæ–‡</a>(è‹±æ–‡)ã€‚è¿™æœ¬ä¹¦çš„ä½œè€…ä¹Ÿç»™å‡ºäº†é…å¥—çš„ <a href="https://github.com/fchollet/deep-learning-with-python-notebooks">Jupyter notebooks</a>ã€‚</p><p>æœ¬æ–‡ä¸º <strong>ç¬¬8ç«   ç”Ÿæˆå¼æ·±åº¦å­¦ä¹ </strong> (Chapter 8. <em>Generative deep learning</em>) çš„ç¬”è®°ä¹‹ä¸€ã€‚</p><p>[TOC]</p><h2 id="8-5-Introduction-to-generative-adversarial-networks"><a href="#8-5-Introduction-to-generative-adversarial-networks" class="headerlink" title="8.5 Introduction to generative adversarial networks"></a>8.5 Introduction to generative adversarial networks</h2><blockquote><p>ç”Ÿæˆå¼å¯¹æŠ—ç½‘ç»œç®€ä»‹</p></blockquote><p>GANï¼Œä¸­æ–‡æ˜¯<del>æ·¦</del>ï¼Œé”™äº†ï¼Œç”Ÿæˆå¼å¯¹æŠ—ç½‘ç»œ(Generative Adversarial Network)ã€‚å’Œ VAE ä¸€æ ·ï¼Œæ˜¯ç”¨æ¥å­¦ä¹ å›¾åƒçš„æ½œåœ¨ç©ºé—´çš„ã€‚è¿™ä¸œè¥¿å¯ä»¥ä½¿ç”Ÿæˆå›¾åƒä¸çœŸå®å›¾åƒâ€œåœ¨ç»Ÿè®¡ä¸Šâ€åˆ«æ— äºŒè‡´ï¼Œè¯´äººè¯å°±æ˜¯ï¼Œç”Ÿæˆçš„å›¾åƒç›¸å½“é€¼çœŸã€‚ä½†ä¸ VAE ä¸åŒï¼ŒGAN çš„æ½œåœ¨ç©ºé—´æ— æ³•ä¿è¯å…·æœ‰æœ‰æ„ä¹‰çš„ç»“æ„ï¼Œå¹¶ä¸”æ˜¯ä¸è¿ç»­çš„ã€‚</p><p>GAN ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p><ul><li>ç”Ÿæˆå™¨ç½‘ç»œ(generator network)ï¼šè¾“å…¥ä¸€ä¸ªéšæœºå‘é‡(æ½œåœ¨ç©ºé—´ä¸­çš„ä¸€ä¸ªéšæœºç‚¹)ï¼Œå¹¶å°†å…¶è§£ç ä¸ºå›¾åƒã€‚</li><li>åˆ¤åˆ«å™¨ç½‘ç»œ(discriminator network)ï¼šè¾“å…¥ä¸€å¼ å›¾åƒ(çœŸå®çš„æˆ–ç”Ÿæˆå™¨ç”»çš„)ï¼Œé¢„æµ‹è¯¥å›¾åƒæ˜¯çœŸå®çš„è¿˜æ˜¯ç”±ç”Ÿæˆå™¨ç½‘ç»œåˆ›å»ºçš„ã€‚ï¼ˆåˆ¤åˆ«å™¨ç½‘ç»œä¹Ÿå«ã€Œå¯¹æ‰‹ã€ï¼Œadversaryï¼‰</li></ul><p>è®­ç»ƒ GAN çš„ç›®çš„æ˜¯ä½¿ã€Œç”Ÿæˆå™¨ç½‘ç»œã€èƒ½å¤Ÿæ¬ºéª—ã€Œåˆ¤åˆ«å™¨ç½‘ç»œã€ã€‚</p><p>ç›´è§‚ç†è§£ GAN æ˜¯ä¸€ä¸ªå¾ˆåŠ±å¿—çš„æ•…äº‹ï¼šå°±æ˜¯è¯´æœ‰ä¸¤ä¸ªäººï¼Œä¸€ä¸ªä¼ªé€ è€…ï¼Œä¸€ä¸ªé‰´å®šå¸ˆã€‚ä¼ªé€ è€…ä»¿é€ å¤§å¸ˆçš„ç”»ï¼Œç„¶åæŠŠè‡ªå·±çš„ä»¿åˆ¶å“æ··åœ¨çœŸè¿¹é‡Œäº¤ç»™é‰´å®šå¸ˆé‰´å®šï¼Œé‰´å®šå¸ˆè¯„ä¼°æ¯ä¸€å¹…ç”»çš„çœŸä¼ªï¼Œä¸€æ ·çœ‹ç©¿äº†å“ªäº›æ˜¯ä¼ªé€ çš„ã€‚å¥½å¿ƒçš„é‰´å®šå¸ˆåé¦ˆäº†ä¼ªé€ è€…ï¼Œå‘Šè¯‰ä»–çœŸè¿¹æœ‰å“ªäº›ç‰¹å¾ã€‚ä¼ªé€ è€…æ ¹æ®é‰´å®šå¸ˆçš„æ„è§ï¼Œä¸€æ­¥æ­¥æå‡è‡ªå·±çš„ä»¿é€ èƒ½åŠ›ã€‚ä¸¤äººä¸åŒå…¶çƒ¦åœ°é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œä¼ªé€ è€…å˜å¾—è¶Šæ¥è¶Šæ“…é•¿å¤åˆ¶å¤§å¸ˆçš„ç”»ï¼Œé‰´å®šå¸ˆä¹Ÿè¶Šæ¥è¶Šæ“…é•¿æ‰¾å‡ºå‡ç”»ã€‚åˆ°æœ€åï¼Œä¼ªé€ è€…é€ å‡ºäº†ä¸€æ‰¹é‰´å®šå¸ˆä¹Ÿæ— å¯æŒ‘å‰”çš„â€œä»¿åˆ¶æ­£å“â€ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghva0rve82j31ec0tcthm.jpg" alt="ç”Ÿæˆå™¨å°†éšæœºæ½œåœ¨å‘é‡è½¬æ¢æˆå›¾åƒï¼Œåˆ¤åˆ«å™¨è¯•å›¾åˆ†è¾¨çœŸå®å›¾åƒä¸ç”Ÿæˆå›¾åƒã€‚ç”Ÿæˆå™¨çš„è®­ç»ƒæ˜¯ä¸ºäº†æ¬ºéª—åˆ¤åˆ«å™¨"></p><p>GAN çš„è®­ç»ƒæ–¹å¼å¾ˆç‰¹æ®Šï¼Œå®ƒçš„ä¼˜åŒ–æœ€å°å€¼æ˜¯ä¸å›ºå®šçš„ã€‚æˆ‘ä»¬é€šå¸¸çš„ã€Œæ¢¯åº¦ä¸‹é™ã€æ˜¯æ²¿ç€é™æ€çš„æŸå¤±åœ°å½¢æ»šä¸‹å±±ï¼Œä½† GAN è®­ç»ƒæ—¶æ¯ä¸‹å±±ä¸€æ­¥éƒ½ä¼šå¯¹æ•´ä¸ªåœ°å½¢é€ æˆæ”¹å˜ã€‚å®ƒæ˜¯ä¸€ä¸ªåŠ¨æ€ç³»ç»Ÿï¼Œå…¶æœ€ä¼˜åŒ–è¿‡ç¨‹æ˜¯ä¸¤è‚¡åŠ›é‡ä¹‹é—´çš„å¹³è¡¡ã€‚æ‰€ä»¥ï¼ŒGAN å¾ˆéš¾è®­ç»ƒã€‚æƒ³è¦è®© GAN æ­£å¸¸è¿è¡Œï¼Œéœ€è¦è¿›è¡Œå¤§é‡çš„æ¨¡å‹æ„å»ºã€è¶…å‚æ•°è°ƒèŠ‚å·¥ä½œã€‚</p><h3 id="æ·±åº¦å·ç§¯ç”Ÿæˆå¼å¯¹æŠ—ç½‘ç»œ"><a href="#æ·±åº¦å·ç§¯ç”Ÿæˆå¼å¯¹æŠ—ç½‘ç»œ" class="headerlink" title="æ·±åº¦å·ç§¯ç”Ÿæˆå¼å¯¹æŠ—ç½‘ç»œ"></a>æ·±åº¦å·ç§¯ç”Ÿæˆå¼å¯¹æŠ—ç½‘ç»œ</h3><p>æˆ‘ä»¬æ¥å°è¯•ç”¨ Keras å®ç°æœ€æœ€æœ€ç®€å•çš„ GANã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šåšä¸€ä¸ª<strong>æ·±åº¦å·ç§¯ç”Ÿæˆå¼å¯¹æŠ—ç½‘ç»œ</strong>ï¼ˆdeep convolutional GANï¼ŒDCGANï¼‰ï¼Œè¿™ç§ä¸œè¥¿çš„ç”Ÿæˆå™¨å’Œåˆ¤åˆ«å™¨éƒ½æ˜¯æ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œã€‚</p><p>æˆ‘ä»¬å°†ç”¨ CIFAR10 æ•°æ®é›†ä¸­â€œfrogâ€ç±»åˆ«çš„å›¾åƒè®­ç»ƒ DCGANã€‚è¿™ä¸ªæ•°æ®é›†åŒ…å« 50000 å¼  32Ã—32 çš„ RGB å›¾åƒï¼Œè¿™äº›å›¾åƒå±äº 10 ä¸ªç±»åˆ«(æ¯ä¸ªç±»åˆ« 5000 å¼ å›¾åƒ)ã€‚</p><h4 id="å®ç°æµç¨‹"><a href="#å®ç°æµç¨‹" class="headerlink" title="å®ç°æµç¨‹"></a>å®ç°æµç¨‹</h4><ol><li><code>generator</code> ç½‘ç»œå°†å½¢çŠ¶ä¸º <code>(latent_dim,)</code> çš„å‘é‡æ˜ å°„åˆ°å½¢çŠ¶ä¸º <code>(32, 32, 3)</code> çš„å›¾åƒã€‚</li><li><code>discriminator</code> ç½‘ç»œå°†å½¢çŠ¶ä¸º <code>(32, 32, 3)</code> çš„å›¾åƒæ˜ å°„åˆ°ä¸€ä¸ªäºŒè¿›åˆ¶å¾—åˆ†(a binary score)ï¼Œç”¨äºè¯„ä¼°å›¾åƒä¸ºçœŸçš„æ¦‚ç‡ã€‚</li><li><code>gan</code> ç½‘ç»œå°† <code>generator</code> å’Œ <code>discriminator</code> è¿æ¥åœ¨ä¸€èµ·: <code>gan(x) = discriminator(generator(x))</code>ã€‚è¿™ä¸ªç½‘ç»œæ˜¯å°†æ½œåœ¨å‘é‡æ˜ å°„åˆ°åˆ¤åˆ«å™¨çš„è¯„ä¼°ç»“æœã€‚</li><li>ä½¿ç”¨å¸¦æœ‰ <code>&quot;real&quot;</code> æˆ– <code>&quot;fake&quot;</code> æ ‡ç­¾çš„çœŸå‡å›¾åƒæ ·æœ¬æ¥è®­ç»ƒåˆ¤åˆ«å™¨ï¼Œç”¨å¸¸è§„è®­ç»ƒæ™®é€šçš„å›¾åƒåˆ†ç±»æ¨¡å‹çš„æ–¹æ³•ã€‚</li><li>ä¸ºäº†è®­ç»ƒç”Ÿæˆå™¨ï¼Œä½¿ç”¨ <code>gan</code> æ¨¡å‹çš„æŸå¤±ç›¸å¯¹äºç”Ÿæˆå™¨æƒé‡çš„æ¢¯åº¦ã€‚åœ¨æ¯ä¸€æ­¥éƒ½è¦å‘ã€Œè®©åˆ¤åˆ«å™¨æ›´æœ‰å¯èƒ½å°†ç”Ÿæˆå™¨è§£ç çš„å›¾åƒåˆ’åˆ†ä¸ºâ€œçœŸâ€ã€ç§»åŠ¨ç”Ÿæˆå™¨çš„æƒé‡ï¼Œå³è®­ç»ƒç”Ÿæˆå™¨æ¥æ¬ºéª—åˆ¤åˆ«å™¨ã€‚</li></ol><h4 id="å®ç”¨æŠ€å·§"><a href="#å®ç”¨æŠ€å·§" class="headerlink" title="å®ç”¨æŠ€å·§"></a>å®ç”¨æŠ€å·§</h4><p>è®­ç»ƒå’Œè°ƒèŠ‚ GAN çš„è¿‡ç¨‹éå¸¸å›°éš¾ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦è®°ä½ä¸€äº›å‰äººæ€»ç»“å‡ºçš„å®ç”¨æŠ€å·§ã€‚è¿™äº›æŠ€å·§ä¸€èˆ¬å¾ˆæœ‰ç”¨ï¼Œä½†å¹¶ä¸èƒ½é€‚ç”¨äºæ‰€æœ‰æƒ…å†µã€‚è¿™äº›ä¸œè¥¿éƒ½æ²¡æœ‰ç†è®ºä¾æ®ï¼Œéƒ½æ˜¯ç„å­¦ï¼Œæ‰€ä»¥ä¸è§£é‡Šç›´æ¥å†™ç»“è®ºï¼š</p><ul><li>ä½¿ç”¨ tanh ä½œä¸ºç”Ÿæˆå™¨æœ€åä¸€å±‚çš„æ¿€æ´»ï¼Œè€Œä¸ç”¨ sigmoidã€‚</li><li>ä½¿ç”¨æ­£æ€åˆ†å¸ƒ(é«˜æ–¯åˆ†å¸ƒ)å¯¹æ½œåœ¨ç©ºé—´ä¸­çš„ç‚¹è¿›è¡Œé‡‡æ ·ï¼Œè€Œä¸ç”¨å‡åŒ€åˆ†å¸ƒã€‚</li><li>éšæœºæ€§èƒ½å¤Ÿæé«˜ç¨³å¥æ€§ã€‚GAN è®­ç»ƒæ—¶å¯èƒ½ä»¥å„ç§æ–¹å¼â€œå¡ä½â€(è¾¾åˆ°é”™è¯¯çš„åŠ¨æ€å¹³è¡¡)ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å¼•å…¥éšæœºæ€§æœ‰åŠ©äºé˜²æ­¢å‡ºç°è¿™ç§æƒ…å†µï¼Œå¼•å…¥éšæœºæ€§çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š<ol><li>åœ¨åˆ¤åˆ«å™¨ä¸­ä½¿ç”¨ dropout;</li><li>å‘åˆ¤åˆ«å™¨çš„æ ‡ç­¾æ·»åŠ éšæœºå™ªå£°;</li></ol></li><li>ç¨€ç–çš„æ¢¯åº¦ä¼šå¦¨ç¢ GAN çš„è®­ç»ƒã€‚ã€Œæœ€å¤§æ± åŒ–è¿ç®—ã€å’Œ ã€ŒReLU æ¿€æ´»ã€å¯èƒ½å¯¼è‡´æ¢¯åº¦ç¨€ç–ï¼Œæ‰€ä»¥æ¨èï¼š<ol><li>ä½¿ç”¨ã€Œæ­¥è¿›å·ç§¯ã€ä»£æ›¿ã€Œæœ€å¤§æ± åŒ–ã€æ¥è¿›è¡Œä¸‹é‡‡æ ·;</li><li>ä½¿ç”¨ LeakyReLU å±‚æ¥ä»£æ›¿ ReLU æ¿€æ´»;</li></ol></li><li>åœ¨ç”Ÿæˆçš„å›¾åƒä¸­ï¼Œå¸¸ä¼šè§åˆ°æ£‹ç›˜çŠ¶ä¼ªå½±ï¼Œè¿™æ˜¯ç”±äºç”Ÿæˆå™¨ä¸­åƒç´ ç©ºé—´è¦†ç›–ä¸å‡åŒ€ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•æ˜¯ï¼šæ¯å½“åœ¨ç”Ÿæˆå™¨å’Œåˆ¤åˆ«å™¨ä¸­éƒ½ä½¿ç”¨æ­¥è¿› Conv2DTranpose æˆ– Conv2D æ—¶ï¼Œå†…æ ¸å¤§å°è¦èƒ½å¤Ÿè¢«æ­¥å¹…æ•´é™¤ã€‚</li></ul><p>ç”±äºæ­¥å¹…å¤§å°å’Œå†…æ ¸å¤§å°ä¸åŒ¹é…è€Œå¯¼è‡´çš„æ£‹ç›˜çŠ¶ä¼ªå½±ç¤ºä¾‹å›¾:</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghvayd7ipwj31560ggazl.jpg" alt="ç”±äºæ­¥å¹…å¤§å°å’Œå†…æ ¸å¤§å°ä¸åŒ¹é…è€Œå¯¼è‡´çš„æ£‹ç›˜çŠ¶ä¼ªå½±"></p><h4 id="ç”Ÿæˆå™¨çš„å®ç°"><a href="#ç”Ÿæˆå™¨çš„å®ç°" class="headerlink" title="ç”Ÿæˆå™¨çš„å®ç°"></a>ç”Ÿæˆå™¨çš„å®ç°</h4><p>å¼€å§‹æ„å»ºå¹´è½»äººçš„ç¬¬ä¸€ä¸ª GAN äº†ï¼ï¼</p><p>é¦–å…ˆå¼€å‘ generator æ¨¡å‹ï¼šå°†æ¥è‡ªæ½œåœ¨ç©ºé—´çš„å‘é‡è½¬æ¢ä¸ºä¸€å¼ å€™é€‰å›¾åƒã€‚</p><p>ä¸ºäº†é¿å…è®­ç»ƒæ—¶â€œå¡ä½â€ï¼Œåœ¨åˆ¤åˆ«å™¨å’Œç”Ÿæˆå™¨ä¸­éƒ½ä½¿ç”¨ dropoutã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GAN ç”Ÿæˆå™¨ç½‘ç»œ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow <span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">height = <span class="number">32</span></span><br><span class="line">width = <span class="number">32</span></span><br><span class="line">channels = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">latent_dim = <span class="number">32</span></span><br><span class="line"></span><br><span class="line">generator_input = keras.Input(shape=(latent_dim,))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†è¾“å…¥è½¬æ¢ä¸ºå¤§å°ä¸º 16Ã—16 çš„ 128 ä¸ªé€šé“çš„ç‰¹å¾å›¾</span></span><br><span class="line">x = layers.Dense(<span class="number">128</span> * <span class="number">16</span> * <span class="number">16</span>)(generator_input)</span><br><span class="line">x = layers.LeakyReLU()(x)</span><br><span class="line">x = layers.Reshape((<span class="number">16</span>, <span class="number">16</span>, <span class="number">128</span>))(x)</span><br><span class="line"></span><br><span class="line">x = layers.Conv2D(<span class="number">256</span>, <span class="number">5</span>, padding=<span class="string">&#x27;same&#x27;</span>)(x)</span><br><span class="line">x = layers.LeakyReLU()(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸Šé‡‡æ ·ä¸º 32Ã—32</span></span><br><span class="line">x = layers.Conv2DTranspose(<span class="number">256</span>, <span class="number">4</span>, strides=<span class="number">2</span>, padding=<span class="string">&#x27;same&#x27;</span>)(x)</span><br><span class="line">x = layers.LeakyReLU()(x)</span><br><span class="line"></span><br><span class="line">x = layers.Conv2D(<span class="number">256</span>, <span class="number">5</span>, padding=<span class="string">&#x27;same&#x27;</span>)(x)</span><br><span class="line">x = layers.LeakyReLU()(x)</span><br><span class="line">x = layers.Conv2D(<span class="number">256</span>, <span class="number">5</span>, padding=<span class="string">&#x27;same&#x27;</span>)(x)</span><br><span class="line">x = layers.LeakyReLU()(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆå¤§å°ä¸º 32Ã—32 çš„ç‰¹å¾å›¾(CIFAR10 å›¾åƒçš„å½¢çŠ¶)</span></span><br><span class="line">x = layers.Conv2D(channels, <span class="number">7</span>, activation=<span class="string">&#x27;tanh&#x27;</span>, padding=<span class="string">&#x27;same&#x27;</span>)(x)</span><br><span class="line"></span><br><span class="line">generator = keras.models.Model(generator_input, x)</span><br><span class="line">generator.summary()</span><br></pre></td></tr></table></figure><pre><code>Model: &quot;functional_1&quot;_________________________________________________________________Layer (type)                 Output Shape              Param #   =================================================================input_1 (InputLayer)         [(None, 32)]              0         _________________________________________________________________dense (Dense)                (None, 32768)             1081344   _________________________________________________________________leaky_re_lu (LeakyReLU)      (None, 32768)             0         _________________________________________________________________reshape (Reshape)            (None, 16, 16, 128)       0         _________________________________________________________________conv2d (Conv2D)              (None, 16, 16, 256)       819456    _________________________________________________________________leaky_re_lu_1 (LeakyReLU)    (None, 16, 16, 256)       0         _________________________________________________________________conv2d_transpose (Conv2DTran (None, 32, 32, 256)       1048832   _________________________________________________________________leaky_re_lu_2 (LeakyReLU)    (None, 32, 32, 256)       0         _________________________________________________________________conv2d_1 (Conv2D)            (None, 32, 32, 256)       1638656   _________________________________________________________________leaky_re_lu_3 (LeakyReLU)    (None, 32, 32, 256)       0         _________________________________________________________________conv2d_2 (Conv2D)            (None, 32, 32, 256)       1638656   _________________________________________________________________leaky_re_lu_4 (LeakyReLU)    (None, 32, 32, 256)       0         _________________________________________________________________conv2d_3 (Conv2D)            (None, 32, 32, 3)         37635     =================================================================Total params: 6,264,579Trainable params: 6,264,579Non-trainable params: 0_________________________________________________________________</code></pre><h4 id="åˆ¤åˆ«å™¨çš„å®ç°"><a href="#åˆ¤åˆ«å™¨çš„å®ç°" class="headerlink" title="åˆ¤åˆ«å™¨çš„å®ç°"></a>åˆ¤åˆ«å™¨çš„å®ç°</h4><p>æ¥ä¸‹æ¥ï¼Œå¼€å‘ discriminator æ¨¡å‹ï¼Œè¾“å…¥ä¸€å¼ å›¾åƒ(çœŸå®çš„æˆ–åˆæˆçš„)ï¼Œå°†å…¶åˆ’åˆ†ä¸ºã€ŒçœŸã€ï¼ˆæ¥è‡ªè®­ç»ƒé›†çš„çœŸå®å›¾åƒï¼‰æˆ–ã€Œå‡ã€ï¼ˆç”Ÿæˆå™¨ç”»çš„å›¾åƒï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GAN åˆ¤åˆ«å™¨ç½‘ç»œ</span></span><br><span class="line"></span><br><span class="line">discriminator_input = layers.Input(shape=(height, width, channels))</span><br><span class="line"></span><br><span class="line">x = layers.Conv2D(<span class="number">128</span>, <span class="number">3</span>)(discriminator_input)</span><br><span class="line">x = layers.LeakyReLU()(x)</span><br><span class="line"></span><br><span class="line">x = layers.Conv2D(<span class="number">128</span>, <span class="number">4</span>, strides=<span class="number">2</span>)(x)</span><br><span class="line">x = layers.LeakyReLU()(x)</span><br><span class="line"></span><br><span class="line">x = layers.Conv2D(<span class="number">128</span>, <span class="number">4</span>, strides=<span class="number">2</span>)(x)</span><br><span class="line">x = layers.LeakyReLU()(x)</span><br><span class="line"></span><br><span class="line">x = layers.Conv2D(<span class="number">128</span>, <span class="number">4</span>, strides=<span class="number">2</span>)(x)</span><br><span class="line">x = layers.LeakyReLU()(x)</span><br><span class="line"></span><br><span class="line">x = layers.Flatten()(x)</span><br><span class="line">x = layers.Dropout(<span class="number">0.4</span>)(x)</span><br><span class="line"></span><br><span class="line">x = layers.Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>)(x)</span><br><span class="line"></span><br><span class="line">discriminator = keras.models.Model(discriminator_input, x)</span><br><span class="line">discriminator.summary()</span><br><span class="line"></span><br><span class="line">discriminator_optimizer = keras.optimizers.RMSprop(</span><br><span class="line">    lr=<span class="number">0.0008</span>,</span><br><span class="line">    clipvalue=<span class="number">1.0</span>,</span><br><span class="line">    decay=<span class="number">1e-8</span>)</span><br><span class="line"></span><br><span class="line">discriminator.<span class="built_in">compile</span>(optimizer=discriminator_optimizer,</span><br><span class="line">                      loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>)</span><br></pre></td></tr></table></figure><pre><code>Model: &quot;functional_3&quot;_________________________________________________________________Layer (type)                 Output Shape              Param #   =================================================================input_2 (InputLayer)         [(None, 32, 32, 3)]       0         _________________________________________________________________conv2d_4 (Conv2D)            (None, 30, 30, 128)       3584      _________________________________________________________________leaky_re_lu_5 (LeakyReLU)    (None, 30, 30, 128)       0         _________________________________________________________________conv2d_5 (Conv2D)            (None, 14, 14, 128)       262272    _________________________________________________________________leaky_re_lu_6 (LeakyReLU)    (None, 14, 14, 128)       0         _________________________________________________________________conv2d_6 (Conv2D)            (None, 6, 6, 128)         262272    _________________________________________________________________leaky_re_lu_7 (LeakyReLU)    (None, 6, 6, 128)         0         _________________________________________________________________conv2d_7 (Conv2D)            (None, 2, 2, 128)         262272    _________________________________________________________________leaky_re_lu_8 (LeakyReLU)    (None, 2, 2, 128)         0         _________________________________________________________________flatten (Flatten)            (None, 512)               0         _________________________________________________________________dropout (Dropout)            (None, 512)               0         _________________________________________________________________dense_1 (Dense)              (None, 1)                 513       =================================================================Total params: 790,913Trainable params: 790,913Non-trainable params: 0_________________________________________________________________</code></pre><h4 id="å¯¹æŠ—ç½‘ç»œ"><a href="#å¯¹æŠ—ç½‘ç»œ" class="headerlink" title="å¯¹æŠ—ç½‘ç»œ"></a>å¯¹æŠ—ç½‘ç»œ</h4><p>æœ€åï¼Œè®¾ç½® GANï¼Œå°†ç”Ÿæˆå™¨å’Œåˆ¤åˆ«å™¨è¿æ¥åœ¨ä¸€èµ·ï¼Œå°†æ½œåœ¨ç©ºé—´çš„ç‚¹è½¬æ¢ä¸ºä¸€ä¸ªçœŸæˆ–å‡çš„åˆ†ç±»åˆ¤æ–­ã€‚</p><p>è¿™ä¸ªæ¨¡å‹è®­ç»ƒæ—¶ï¼Œéœ€è¦å°†ã€Œåˆ¤åˆ«å™¨ã€å†»ç»“(ä½¿ä¹‹ä¸å¯è¢«è®­ç»ƒ)ï¼Œåªè®©ã€Œç”Ÿæˆå™¨ã€å‘ã€Œæé«˜æ¬ºéª—åˆ¤åˆ«å™¨çš„èƒ½åŠ›ã€çš„æ–¹å‘ç§»åŠ¨ã€‚</p><p>è®­ç»ƒ gan æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„å…¨éƒ¨éƒ½æ˜¯â€œçœŸå®å›¾åƒâ€çš„æ ‡ç­¾ï¼Œæ‰€ä»¥å¦‚æœåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å¯ä»¥å¯¹ã€Œåˆ¤åˆ«å™¨ã€çš„æƒé‡è¿›è¡Œæ›´æ–°ï¼Œè®­ç»ƒä¼šä½¿å¾—åˆ¤åˆ«å™¨å§‹ç»ˆé¢„æµ‹â€œçœŸâ€ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¹æŠ—ç½‘ç»œ</span></span><br><span class="line"></span><br><span class="line">discriminator.trainable = <span class="literal">False</span>    <span class="comment"># è¿™ä¸ªåªä¼šä½œç”¨äº gan</span></span><br><span class="line"></span><br><span class="line">gan_input = keras.Input(shape=(latent_dim,))</span><br><span class="line">gan_output = discriminator(generator(gan_input))</span><br><span class="line">gan = keras.models.Model(gan_input, gan_output)</span><br><span class="line"></span><br><span class="line">gan_optimizer = keras.optimizers.RMSprop(</span><br><span class="line">    lr=<span class="number">0.0004</span>,</span><br><span class="line">    clipvalue=<span class="number">1.0</span>,</span><br><span class="line">    decay=<span class="number">1e-8</span>)</span><br><span class="line">gan.<span class="built_in">compile</span>(optimizer=gan_optimizer,</span><br><span class="line">            loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="è®­ç»ƒ-DCGAN"><a href="#è®­ç»ƒ-DCGAN" class="headerlink" title="è®­ç»ƒ DCGAN"></a>è®­ç»ƒ DCGAN</h4><p>è®­ç»ƒå¾ªç¯çš„æµç¨‹å¦‚ä¸‹:</p><ol><li>ä»æ½œåœ¨ç©ºé—´ä¸­æŠ½å–éšæœºçš„ç‚¹(éšæœºå™ªå£°)ã€‚</li><li>æŠŠè¿™ä¸ªéšæœºå™ªå£°ç»™ generator ç”Ÿæˆå›¾åƒã€‚</li><li>å°†ç”Ÿæˆå›¾åƒä¸çœŸå®å›¾åƒæ··åˆã€‚</li><li>ä½¿ç”¨è¿™äº›æ··åˆåçš„å›¾åƒä»¥åŠç›¸åº”çš„æ ‡ç­¾(çœŸå®å›¾åƒä¸ºâ€œçœŸâ€ï¼Œç”Ÿæˆå›¾åƒä¸ºâ€œå‡â€)æ¥è®­ç»ƒ discriminatorã€‚</li><li>åœ¨æ½œåœ¨ç©ºé—´ä¸­éšæœºæŠ½å–æ–°çš„ç‚¹ã€‚</li><li>ä½¿ç”¨è¿™äº›éšæœºå‘é‡ä»¥åŠå…¨éƒ¨æ˜¯ã€ŒçœŸå®å›¾åƒã€çš„æ ‡ç­¾æ¥è®­ç»ƒganã€‚</li></ol><p>å…·ä½“çš„ä»£ç å®ç°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GAN çš„è®­ç»ƒã€</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.preprocessing <span class="keyword">import</span> image</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å…¥ CIFAR10 æ•°æ®</span></span><br><span class="line">(x_train, y_train), (_, _) = keras.datasets.cifar10.load_data()</span><br><span class="line"><span class="comment"># é€‰å‡ºé’è›™ğŸ¸çš„å›¾ç‰‡</span></span><br><span class="line">x_train = x_train[y_train.flatten() == <span class="number">6</span>]</span><br><span class="line"></span><br><span class="line">x_train = x_train.reshape(</span><br><span class="line">    (x_train.shape[<span class="number">0</span>],) + (height, width, channels)</span><br><span class="line">).astype(<span class="string">&#x27;float32&#x27;</span>) / <span class="number">255.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">iterations = <span class="number">10000</span></span><br><span class="line">batch_size = <span class="number">20</span></span><br><span class="line">save_dir = <span class="string">&#x27;gan_save&#x27;</span></span><br><span class="line"></span><br><span class="line">start = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> step <span class="keyword">in</span> <span class="built_in">range</span>(iterations+<span class="number">1</span>):</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># éšæœºé‡‡æ ·æ½œåœ¨ç‚¹</span></span><br><span class="line">    random_latent_vectors = np.random.normal(size=(batch_size, latent_dim))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ç”Ÿæˆå›¾åƒ</span></span><br><span class="line">    generated_images = generator.predict(random_latent_vectors)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># é€‰å–çœŸå®å›¾åƒ</span></span><br><span class="line">    stop = start + batch_size</span><br><span class="line">    real_images = x_train[start: stop]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># åˆå¹¶ç”Ÿæˆã€çœŸå®å›¾åƒï¼Œç»™å‡ºæ ‡ç­¾</span></span><br><span class="line">    combined_images = np.concatenate([generated_images, real_images])</span><br><span class="line">    labels = np.concatenate([np.ones((batch_size, <span class="number">1</span>)),</span><br><span class="line">                             np.zeros((batch_size, <span class="number">1</span>))])</span><br><span class="line">    labels += <span class="number">0.05</span> * np.random.random(labels.shape)  <span class="comment"># å‘æ ‡ç­¾ä¸­æ·»åŠ éšæœºå™ªå£°</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è®­ç»ƒåˆ¤åˆ«å™¨</span></span><br><span class="line">    d_loss = discriminator.train_on_batch(combined_images, labels)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># éšæœºé‡‡æ ·æ½œåœ¨ç‚¹</span></span><br><span class="line">    random_latent_vectors = np.random.normal(size=(batch_size, latent_dim))</span><br><span class="line">    </span><br><span class="line">    misleading_targets = np.zeros((batch_size, <span class="number">1</span>))  <span class="comment"># è°ç§°å…¨éƒ¨éƒ½æ˜¯çœŸå®å›¾ç‰‡</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># é€šè¿‡ gan æ¨¡å‹è®­ç»ƒç”Ÿæˆå™¨</span></span><br><span class="line">    a_loss = gan.train_on_batch(random_latent_vectors, misleading_targets)</span><br><span class="line">    </span><br><span class="line">    end_time = time.time()</span><br><span class="line">    </span><br><span class="line">    start += batch_size</span><br><span class="line">    <span class="keyword">if</span> start &gt; <span class="built_in">len</span>(x_train) - batch_size:</span><br><span class="line">        start = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> step % <span class="number">50</span> == <span class="number">0</span>:</span><br><span class="line">        gan.save_weights(<span class="string">&#x27;gan.h5&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        print(<span class="string">f&#x27;step <span class="subst">&#123;step&#125;</span>: discriminator loss: <span class="subst">&#123;d_loss&#125;</span>, adversarial loss: <span class="subst">&#123;a_loss&#125;</span>&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        img = image.array_to_img(generated_images[<span class="number">0</span>] * <span class="number">255.</span>, scale=<span class="literal">False</span>)</span><br><span class="line">        img.save(os.path.join(save_dir, <span class="string">f&#x27;generated_frog_<span class="subst">&#123;step&#125;</span>.png&#x27;</span>))</span><br><span class="line">        </span><br><span class="line">        img = image.array_to_img(real_images[<span class="number">0</span>] * <span class="number">255.</span>, scale=<span class="literal">False</span>)</span><br><span class="line">        img.save(os.path.join(save_dir, <span class="string">f&#x27;real_frog_<span class="subst">&#123;step&#125;</span>.png&#x27;</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        time_cost = end_time - start_time</span><br><span class="line">        time_eta = time_cost * (iterations - step)</span><br><span class="line">        print(<span class="string">f&#x27;<span class="subst">&#123;step&#125;</span>/<span class="subst">&#123;iterations&#125;</span>: <span class="subst">&#123;time_cost:<span class="number">.2</span>f&#125;</span>s - ETA: <span class="subst">&#123;time_eta:<span class="number">.0</span>f&#125;</span>s&#x27;</span>, end=<span class="string">&#x27;\r&#x27;</span>)</span><br><span class="line">        </span><br></pre></td></tr></table></figure><pre><code>step 0: discriminator loss: 0.6944685578346252, adversarial loss: 0.7566524744033813...step 500: discriminator loss: 0.7020201683044434, adversarial loss: 0.7446410059928894...step 1000: discriminator loss: 0.7096449136734009, adversarial loss: 0.752526581287384</code></pre><p>æœ€åè¾“å‡ºçš„å›¾åƒï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gi27n2ulptj300w00w0si.jpg" alt="æœ€åè¾“å‡ºçš„å›¾åƒ"></p><p>æ•ˆæœç›¸å½“å·®ã€‚è¿™ä¸ªä¸œè¥¿è®­ç»ƒæ¶ˆè€—å¤ªå¤§äº†ï¼Œåˆæ˜¯ CPU åŠé€€ï¼Œæˆ‘åªè·‘äº† 1000 è½®ï¼Œè¿˜å¤ªå°‘äº†ã€‚ã€‚ã€‚ä¸æ„§ä¸ºå…¨ä¹¦æœ€åä¸€é¢˜ï¼Œå‹è½´ï¼Œè¿™å°é’è›™å›¾æˆ‘ä¸è¦äº†ã€‚ğŸ˜‚</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> Deep Learning with Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
            <tag> Deep Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonæ·±åº¦å­¦ä¹ ä¹‹VAE</title>
      <link href="/2020/08/23/DeepLearningWithPython/Deep-Learning%20with-Python-ch8_4/"/>
      <url>/2020/08/23/DeepLearningWithPython/Deep-Learning%20with-Python-ch8_4/</url>
      
        <content type="html"><![CDATA[<h1 id="Deep-Learning-with-Python"><a href="#Deep-Learning-with-Python" class="headerlink" title="Deep Learning with Python"></a>Deep Learning with Python</h1><p>è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘å­¦ä¹ ã€ŠDeep Learning with Pythonã€‹(ç¬¬äºŒç‰ˆï¼ŒFranÃ§ois Chollet è‘—) æ—¶å†™çš„ç³»åˆ—ç¬”è®°ä¹‹ä¸€ã€‚æ–‡ç« çš„å†…å®¹æ˜¯ä»  Jupyter notebooks è½¬æˆ Markdown çš„ï¼Œä½ å¯ä»¥å» <a href="https://github.com/cdfmlr/Deep-Learning-with-Python-Notebooks">GitHub</a> æˆ– <a href="https://gitee.com/cdfmlr/Deep-Learning-with-Python-Notebooks">Gitee</a> æ‰¾åˆ°åŸå§‹çš„ <code>.ipynb</code> ç¬”è®°æœ¬ã€‚</p><p>ä½ å¯ä»¥å»<a href="https://livebook.manning.com/book/deep-learning-with-python">è¿™ä¸ªç½‘ç«™åœ¨çº¿é˜…è¯»è¿™æœ¬ä¹¦çš„æ­£ç‰ˆåŸæ–‡</a>(è‹±æ–‡)ã€‚è¿™æœ¬ä¹¦çš„ä½œè€…ä¹Ÿç»™å‡ºäº†é…å¥—çš„ <a href="https://github.com/fchollet/deep-learning-with-python-notebooks">Jupyter notebooks</a>ã€‚</p><p>æœ¬æ–‡ä¸º <strong>ç¬¬8ç«   ç”Ÿæˆå¼æ·±åº¦å­¦ä¹ </strong> (Chapter 8. <em>Generative deep learning</em>) çš„ç¬”è®°ä¹‹ä¸€ã€‚</p><p>[TOC]</p><h2 id="8-4-Generating-images-with-variational-autoencoders"><a href="#8-4-Generating-images-with-variational-autoencoders" class="headerlink" title="8.4 Generating images with variational autoencoders"></a>8.4 Generating images with variational autoencoders</h2><blockquote><p>ç”¨å˜åˆ†è‡ªç¼–ç å™¨ç”Ÿæˆå›¾åƒ</p></blockquote><p>å‰ä¸¤ç¯‡ä»‹ç»çš„ DeepDream å’Œ Neural Style Transfer éƒ½åªæ˜¯æœ‰é™åœ°â€œä¿®æ”¹â€ç°æœ‰ä½œå“ã€‚è€Œä¸‹é¢æˆ‘ä»¬è¦ä»‹ç»åœ° GAN å’Œ VAE åˆ™æ˜¯æ›´åŠ å¯Œæœ‰åˆ›é€ æ€§çš„ï¼Œè¿™ä¸¤ç§æŠ€æœ¯éƒ½æ˜¯ä»å›¾åƒçš„æ½œåœ¨ç©ºé—´ä¸­é‡‡æ ·ï¼Œå¹¶åˆ›å»ºå…¨æ–°å›¾åƒæˆ–ç¼–è¾‘ç°æœ‰å›¾åƒã€‚</p><ul><li>VAEï¼šå˜åˆ†è‡ªç¼–ç å™¨(Variational AutoEncoder)</li><li>GANï¼šç”Ÿæˆå¼å¯¹æŠ—ç½‘ç»œ(Generative Adversarial Network)</li></ul><h3 id="ä»æ½œåœ¨ç©ºé—´é‡‡æ ·"><a href="#ä»æ½œåœ¨ç©ºé—´é‡‡æ ·" class="headerlink" title="ä»æ½œåœ¨ç©ºé—´é‡‡æ ·"></a>ä»æ½œåœ¨ç©ºé—´é‡‡æ ·</h3><p>æ½œåœ¨ç©ºé—´(latent space)æ˜¯ä¸€ä¸ªå‘é‡ç©ºé—´ï¼Œå…¶ä¸­ä»»æ„ç‚¹éƒ½å¯ä»¥è¢«æ˜ å°„ä¸ºä¸€å¼ é€¼çœŸçš„å›¾åƒã€‚è€Œå®ç°è¿™ç§æ˜ å°„(æ½œåœ¨ç‚¹-&gt;å›¾åƒ)çš„æ¨¡å—å°±æ˜¯ GAN çš„ generatorï¼Œæˆ–è€… VAE çš„ decoderã€‚</p><p>GANã€VAE ç”Ÿæˆå›¾åƒçš„å…³é”®å°±åœ¨äºæ‰¾åˆ°ä¸€ä¸ªä½ç»´çš„ã€Œè¡¨ç¤ºæ½œåœ¨ç©ºé—´ã€(latent space of representations)ã€‚ä¸€æ—¦æ‰¾åˆ°è¿™æ ·çš„æ½œåœ¨ç©ºé—´ï¼Œä»ä¸­é‡‡æ ·ï¼Œæ˜ å°„åˆ°å›¾åƒç©ºé—´ï¼Œå°±å¯ä»¥ç”Ÿæˆå…¨æ–°çš„å›¾åƒã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghut6hcq7kj317g0qyti6.jpg" alt="å­¦ä¹ å›¾åƒçš„æ½œåœ¨å‘é‡ç©ºé—´ï¼Œå¹¶åˆ©ç”¨è¿™ä¸ªç©ºé—´æ¥é‡‡æ ·æ–°å›¾åƒ"></p><p>GAN å’Œ VAE å­¦ä¹ çš„æ½œåœ¨ç©ºé—´æœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼š</p><ul><li>VAE å–„äºå­¦ä¹ å…·æœ‰è‰¯å¥½ç»“æ„çš„æ½œåœ¨ç©ºé—´ï¼Œå…¶ä¸­çš„ç‰¹å®šæ–¹å‘å¯ä»¥ç¼–ç (è¡¨ç¤º)æ•°æ®ä¸­ä¸€ä¸ªæœ‰æ„ä¹‰çš„å˜åŒ–çš„è½´ã€‚</li><li>GAN ç”Ÿæˆçš„å›¾åƒå¯ä»¥éå¸¸é€¼çœŸï¼Œä½†æ½œåœ¨ç©ºé—´ç¼ºä¹è‰¯å¥½çš„ç»“æ„ã€æ²¡æœ‰è¶³å¤Ÿçš„è¿ç»­æ€§ã€‚</li></ul><h3 id="æ¦‚å¿µå‘é‡"><a href="#æ¦‚å¿µå‘é‡" class="headerlink" title="æ¦‚å¿µå‘é‡"></a>æ¦‚å¿µå‘é‡</h3><p>æ¦‚å¿µå‘é‡(concept vector)ï¼šç»™å®šä¸€ä¸ªè¡¨ç¤ºçš„æ½œåœ¨ç©ºé—´æˆ–ä¸€ä¸ªåµŒå…¥ç©ºé—´ï¼Œç©ºé—´ä¸­çš„ç‰¹å®šæ–¹å‘å¯èƒ½è¡¨ç¤ºåŸå§‹æ•°æ®ä¸­æœ‰æ„ä¹‰çš„å˜åŒ–è½´ã€‚ä¾‹å¦‚å¯¹äºå›¾åƒï¼Œäººè„¸å›¾åƒçš„æ½œåœ¨ç©ºé—´ä¸­å¯èƒ½å­˜åœ¨ä¸€ä¸ªä»£è¡¨ã€Œå¾®ç¬‘ã€è¿™ä¸ªæ¦‚å¿µçš„å‘é‡(ç§°ä¸ºå¾®ç¬‘å‘é‡ï¼Œsmile vector)ï¼šå¯¹äºä»£è¡¨æŸå¼ äººè„¸çš„æ½œåœ¨ç‚¹ zï¼Œz+s å°±æ˜¯åŒä¸€å¼ äººè„¸é¢å¸¦å¾®ç¬‘çš„è¡¨ç¤ºã€‚</p><p>æ‰¾åˆ°äº†è¿™æ ·çš„ä¸€äº›æ¦‚å¿µå‘é‡ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨è¿™ç§æ–¹æ³•æ¥ç¼–è¾‘å›¾åƒäº†ï¼šå°†å›¾åƒæŠ•å°„åˆ°æ½œåœ¨ç©ºé—´ï¼Œå’Œæ¦‚å¿µå‘é‡åšè¿ç®—æ¥ç§»åŠ¨å…¶è¡¨ç¤ºï¼Œç„¶åå†è§£ç åˆ°å›¾åƒç©ºé—´ï¼Œå°±å¯ä»¥æ”¹å˜å›¾åƒä¸­çš„æŸä¸€æ¦‚å¿µäº†â€”â€”æ¯”å¦‚å¾®ç¬‘ç¨‹åº¦ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghuynp3pb9j31880kux67.jpg" alt="å¾®ç¬‘å‘é‡"></p><h3 id="å˜åˆ†è‡ªç¼–ç å™¨"><a href="#å˜åˆ†è‡ªç¼–ç å™¨" class="headerlink" title="å˜åˆ†è‡ªç¼–ç å™¨"></a>å˜åˆ†è‡ªç¼–ç å™¨</h3><p>è‡ªç¼–ç å™¨æ˜¯ä¸€ç§ç½‘ç»œç±»å‹ï¼Œæ¥æ”¶ä¸€å¼ å›¾åƒï¼Œé€šè¿‡ encoder æ¨¡å—å°†å…¶æ˜ å°„åˆ°ã€Œæ½œåœ¨ç©ºé—´ã€ï¼Œç„¶åå†é€šè¿‡ decoder æ¨¡å—å°†å…¶è§£ç æˆä¸åŸå§‹å›¾åƒå°ºå¯¸ç›¸åŒçš„è¾“å‡ºã€‚è¿™ä¸œè¥¿è®­ç»ƒæ—¶çš„ç›®æ ‡æ˜¯ä½¿è¾“å‡ºå’Œè¾“å…¥ç›¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠè¾“å…¥ã€è¾“å‡ºç”¨åŒä¸€å¼ å›¾ç‰‡ã€‚æ‰€ä»¥è‡ªç¼–ç å™¨å­¦ä¹ çš„æ˜¯å¯¹åŸå§‹è¾“å…¥è¿›è¡Œé‡æ–°æ„å»ºã€‚</p><p>é€šè¿‡å¯¹ç¼–ç (ç¼–ç å™¨çš„è¾“å‡º)æ–½åŠ é™åˆ¶ï¼Œå¯ä»¥è®©è‡ªç¼–ç å™¨å­¦åˆ°æœ‰ç”¨çš„æ•°æ®æ½œåœ¨è¡¨ç¤ºã€‚æ¯”å¦‚é™åˆ¶ç¼–ç è¦ä½ç»´å¹¶ä¸”æ˜¯ç¨€ç–çš„ï¼Œè¿™æ ·ç¼–ç å™¨å°±å¯ä»¥å°†è¾“å…¥æ•°æ®å‹ç¼©ä¸ºæ›´å°‘äºŒè¿›åˆ¶ä½çš„ä¿¡æ¯ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghuz8fj78aj31ao0dwtbk.jpg" alt="è‡ªç¼–ç å™¨:å°†è¾“å…¥xæ˜ å°„ä¸ºå‹ç¼©è¡¨ç¤ºï¼Œç„¶åå†å°†å…¶è§£ç ä¸ºxâ€™"></p><p>å˜åˆ†è‡ªç¼–ç å™¨ VAEï¼Œæ˜¯ä¸€ç§ç°ä»£åŒ–çš„è‡ªç¼–ç å™¨ã€‚å®ƒæ˜¯ä¸€ç§ç”Ÿæˆå¼æ¨¡å‹ï¼Œç‰¹åˆ«åšåˆ©ç”¨æ¦‚å¿µå‘é‡è¿›è¡Œå›¾åƒç¼–è¾‘çš„ä»»åŠ¡ã€‚æ¯”èµ·ç»å…¸è‡ªç¼–ç å™¨ï¼ŒVAE å¯ä»¥å­¦ä¹ æ›´è¿ç»­çš„ã€é«˜åº¦ç»“æ„åŒ–çš„æ½œåœ¨ç©ºé—´ã€‚</p><p>VAE ä¸æ˜¯å°†è¾“å…¥å›¾åƒå‹ç¼©æˆæ½œåœ¨ç©ºé—´ä¸­çš„å›ºå®šç¼–ç ï¼Œè€Œæ˜¯å°†å›¾åƒè½¬æ¢ä¸ºç»Ÿè®¡åˆ†å¸ƒçš„å‚æ•°â€”â€”å¹³å‡å€¼å’Œæ–¹å·®ã€‚VAE è§£ç çš„æ—¶å€™åˆ©ç”¨å¹³å‡å€¼å’Œæ–¹å·®ï¼Œä»åˆ†å¸ƒä¸­éšæœºé‡‡æ ·ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶å°†è¿™ä¸ªå…ƒç´ è§£ç åˆ°åŸå§‹è¾“å…¥ã€‚æ‰€ä»¥ VAE çš„ç¼–ç /è§£ç è¿‡ç¨‹æ˜¯æœ‰ä¸€å®šçš„éšæœºæ€§çš„ã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹çš„éšæœºæ€§æé«˜äº† VAE æ½œåœ¨ç©ºé—´çš„ç¨³å¥æ€§ï¼šVAE éœ€ä¿è¯æ½œåœ¨ç©ºé—´é‡‡æ ·çš„æ¯ä¸ªç‚¹éƒ½èƒ½è§£ç ä¸ºæœ‰æ•ˆçš„è¾“å‡ºï¼Œè¿™è¿«ä½¿æ½œåœ¨ç©ºé—´çš„ä»»ä½•ä½ç½®éƒ½å¯¹åº”æœ‰æ„ä¹‰çš„è¡¨ç¤ºã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghuzfuik3jj31bi0piah3.jpg" alt="VAE å°†ä¸€å¼ å›¾åƒæ˜ å°„ä¸ºä¸¤ä¸ªå‘é‡ z_mean å’Œ z_log_varï¼ŒäºŒè€…å®šä¹‰äº†æ½œåœ¨ ç©ºé—´ä¸­çš„ä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒï¼Œç”¨äºé‡‡æ ·ä¸€ä¸ªæ½œåœ¨ç‚¹å¹¶å¯¹å…¶è¿›è¡Œè§£ç "></p><p>ä¸Šå›¾å±•ç°äº† VAE çš„å·¥ä½œåŸç†ï¼š</p><ol><li>Encoder æ¨¡å—å°†è¾“å…¥æ ·æœ¬ <code>input_img</code> è½¬æ¢ä¸ºè¡¨ç¤ºæ½œåœ¨ç©ºé—´ä¸­çš„å‚æ•° <code>z_mean</code> å’Œ <code>z_log_variance</code>;</li><li>ä»è¿™ä¸ªæ½œåœ¨æ­£æ€åˆ†å¸ƒä¸­éšæœºé‡‡æ ·ä¸€ä¸ªç‚¹ z: <code>z = z_mean + exp(z_log_variance) * epsilon</code>ï¼Œå…¶ä¸­ epsilon æ˜¯å–å€¼å¾ˆå°çš„éšæœºå¼ é‡;</li><li>Decoder æ¨¡å—å°†è¿™ä¸ªæ½œåœ¨ç‚¹æ˜ å°„å›åŸå§‹è¾“å…¥å›¾åƒã€‚</li></ol><p>epsilon æ˜¯éšæœºçš„ï¼Œæ‰€ä»¥éœ€è¦ä¸ input_img ç¼–ç çš„æ½œåœ¨ä½ç½®(z-mean)é è¿‘çš„æ¯ä¸ªç‚¹éƒ½èƒ½è¢«è§£ç ä¸ºä¸ input_img ç±»ä¼¼çš„å›¾åƒï¼Œè¿™ä¸ªæ€§è´¨è¿«ä½¿æ½œåœ¨ç©ºé—´èƒ½å¤Ÿè¿ç»­åœ°æœ‰æ„ä¹‰ï¼šæ½œåœ¨ç©ºé—´ä¸­ä»»æ„ä¸¤ä¸ªç›¸é‚»çš„ç‚¹éƒ½ä¼šè¢«è§£ç ä¸ºé«˜åº¦ç›¸ä¼¼çš„å›¾åƒã€‚è¿ç»­æ€§ä»¥åŠæ½œåœ¨ç©ºé—´çš„ä½ç»´åº¦ï¼Œåˆè¿«ä½¿æ½œåœ¨ç©ºé—´ä¸­çš„æ¯ä¸ªæ–¹å‘éƒ½è¡¨ç¤ºæ•°æ®ä¸­ä¸€ä¸ªæœ‰æ„ä¹‰çš„å˜åŒ–è½´ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡æ¦‚å¿µå‘é‡æ¥è¿›è¡Œæ“ä½œã€‚</p><p>ç”¨ Keras å®ç° VAE çš„ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">z_mean, z_log_variance = encoder(input_img)</span><br><span class="line">z = z_mean + exp(z_log_variance) * epsilon</span><br><span class="line">reconstructed_img = decoder(z)</span><br><span class="line">model = Model(input_img, reconstruced_img)</span><br></pre></td></tr></table></figure><p>è®­ç»ƒ VAE éœ€è¦ä¸¤ä¸ªæŸå¤±å‡½æ•°ï¼š</p><ul><li>é‡æ„æŸå¤±(reconstruction loss)ï¼šä½¿è§£ç åçš„æ ·æœ¬åŒ¹é…åˆå§‹è¾“å…¥;</li><li>æ­£åˆ™åŒ–æŸå¤±(regularization loss)ï¼šä½¿æ½œåœ¨ç©ºé—´å…·æœ‰è‰¯å¥½ç»“æ„ï¼ˆè¿ç»­æ€§ã€æ¦‚å¿µå‘é‡å¯ç”¨æ€§ï¼‰ï¼ŒåŒæ—¶ä¹Ÿé™ä½åœ¨è®­ç»ƒæ•°æ®ä¸Šçš„è¿‡æ‹Ÿåˆ;</li></ul><p>æˆ‘ä»¬å…·ä½“å®ç°ç¼–ç å™¨(encoder)ç½‘ç»œï¼šé€šè¿‡ä¸€ä¸ªå·ç§¯ç¥ç»ç½‘ç»œï¼Œå°†è¾“å…¥å›¾åƒ x æ˜ å°„ä¸ºä¸¤ä¸ªå‘é‡ z_mean å’Œ z_log_varã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸ä½¿ç”¨åŠæ—¶æ‰§è¡Œæ¨¡å¼</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">tf.compat.v1.disable_eager_execution()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># VAE ç¼–ç å™¨ç½‘ç»œ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow <span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> backend <span class="keyword">as</span> K</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Model</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">img_shape = (<span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>)</span><br><span class="line">batch_size = <span class="number">16</span></span><br><span class="line">latent_dim = <span class="number">2</span>    <span class="comment"># æ½œåœ¨ç©ºé—´çš„ç»´åº¦ï¼š2Då¹³é¢</span></span><br><span class="line"></span><br><span class="line">input_img = keras.Input(shape=img_shape)</span><br><span class="line">x = layers.Conv2D(<span class="number">32</span>, <span class="number">3</span>, padding=<span class="string">&#x27;same&#x27;</span>, activation=<span class="string">&#x27;relu&#x27;</span>)(input_img)</span><br><span class="line">x = layers.Conv2D(<span class="number">64</span>, <span class="number">3</span>, padding=<span class="string">&#x27;same&#x27;</span>, activation=<span class="string">&#x27;relu&#x27;</span>, strides=(<span class="number">2</span>, <span class="number">2</span>))(x)</span><br><span class="line">x = layers.Conv2D(<span class="number">64</span>, <span class="number">3</span>, padding=<span class="string">&#x27;same&#x27;</span>, activation=<span class="string">&#x27;relu&#x27;</span>)(x)</span><br><span class="line">x = layers.Conv2D(<span class="number">64</span>, <span class="number">3</span>, padding=<span class="string">&#x27;same&#x27;</span>, activation=<span class="string">&#x27;relu&#x27;</span>)(x)</span><br><span class="line"></span><br><span class="line">shape_before_flattening = K.int_shape(x)</span><br><span class="line"></span><br><span class="line">x = layers.Flatten()(x)</span><br><span class="line">x = layers.Dense(<span class="number">32</span>, activation=<span class="string">&#x27;relu&#x27;</span>)(x)</span><br><span class="line"></span><br><span class="line">z_mean = layers.Dense(latent_dim)(x)</span><br><span class="line">z_log_var = layers.Dense(latent_dim)(x)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥çš„ä»£ç å°†ä½¿ç”¨ z_mean å’Œ z_log_var æ¥ç”Ÿæˆï¼ˆé‡‡æ ·ï¼‰ä¸€ä¸ªæ½œåœ¨ç©ºé—´ç‚¹ zã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ½œåœ¨ç©ºé—´é‡‡æ ·çš„å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sampling</span>(<span class="params">args</span>):</span></span><br><span class="line">    z_mean, z_log_var = args</span><br><span class="line">    epsilon = K.random_normal(shape=(K.shape(z_mean)[<span class="number">0</span>], latent_dim),</span><br><span class="line">                              mean=<span class="number">0.</span>,</span><br><span class="line">                              stddev=<span class="number">1.</span>)</span><br><span class="line">    <span class="keyword">return</span> z_mean + K.exp(z_log_var) * epsilon</span><br><span class="line"></span><br><span class="line">z = layers.Lambda(sampling)([z_mean, z_log_var])    <span class="comment"># å°è£…ä¸ºå±‚</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯è§£ç å™¨çš„å®ç°ï¼šå°†å‘é‡ z çš„å°ºå¯¸è°ƒæ•´ä¸ºå›¾åƒå¤§å°ï¼Œç„¶åä½¿ç”¨å‡ ä¸ªå·ç§¯å±‚æ¥å¾—åˆ°æœ€ç»ˆçš„å›¾åƒè¾“å‡ºã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># VAE è§£ç å™¨ç½‘ç»œ</span></span><br><span class="line"></span><br><span class="line">decoder_input = layers.Input(K.int_shape(z)[<span class="number">1</span>:])</span><br><span class="line">x = layers.Dense(np.prod(shape_before_flattening[<span class="number">1</span>:]),</span><br><span class="line">                 activation=<span class="string">&#x27;relu&#x27;</span>)(decoder_input)</span><br><span class="line">x = layers.Reshape(shape_before_flattening[<span class="number">1</span>:])(x)</span><br><span class="line">x = layers.Conv2DTranspose(<span class="number">32</span>, <span class="number">3</span>,</span><br><span class="line">                           padding=<span class="string">&#x27;same&#x27;</span>,</span><br><span class="line">                           activation=<span class="string">&#x27;relu&#x27;</span>,</span><br><span class="line">                           strides=(<span class="number">2</span>, <span class="number">2</span>))(x)</span><br><span class="line">x = layers.Conv2D(<span class="number">1</span>, <span class="number">3</span>,</span><br><span class="line">                  padding=<span class="string">&#x27;same&#x27;</span>,</span><br><span class="line">                  activation=<span class="string">&#x27;sigmoid&#x27;</span>)(x)</span><br><span class="line"></span><br><span class="line">decoder = Model(decoder_input, x)</span><br><span class="line"></span><br><span class="line">z_decoded = decoder(z)</span><br></pre></td></tr></table></figure><p>VAE è¦ç”¨ä¸¤ä¸ªæŸå¤±ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥å†™æˆ <code>loss(input, target)</code>ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰å±‚ï¼Œåœ¨å…¶ä¸­ä½¿ç”¨å†…ç½®çš„ <code>add_loss</code> æ–¹æ³•æ¥åˆ›å»ºéœ€è¦çš„æŸå¤±ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”¨äºè®¡ç®— VAE æŸå¤±çš„è‡ªå®šä¹‰å±‚</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomVariationalLayer</span>(<span class="params">keras.layers.Layer</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">vae_loss</span>(<span class="params">self, x, z_decoded</span>):</span></span><br><span class="line">        x = K.flatten(x)</span><br><span class="line">        z_decoded = K.flatten(z_decoded)</span><br><span class="line">        </span><br><span class="line">        xent_loss = keras.metrics.binary_crossentropy(x, z_decoded)</span><br><span class="line">        kl_loss = -<span class="number">5e-4</span> * K.mean(</span><br><span class="line">            <span class="number">1</span> + z_log_var - K.square(z_mean) - K.exp(z_log_var),</span><br><span class="line">            axis=-<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> K.mean(xent_loss + kl_loss)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">call</span>(<span class="params">self, inputs</span>):</span></span><br><span class="line">        x = inputs[<span class="number">0</span>]</span><br><span class="line">        z_decoded = inputs[<span class="number">1</span>]</span><br><span class="line">        </span><br><span class="line">        loss = self.vae_loss(x, z_decoded)</span><br><span class="line">        self.add_loss(loss, inputs=inputs)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    </span><br><span class="line">y = CustomVariationalLayer()([input_img, z_decoded])</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œå°†æ¨¡å‹å®ä¾‹åŒ–å¹¶å¼€å§‹è®­ç»ƒã€‚ç”±äºæˆ‘ä»¬çš„æŸå¤±ä»¥åŠåŒ…å«åœ¨è‡ªå®šä¹‰å±‚é‡Œé¢äº†ï¼Œæ‰€ä»¥ç¼–è¯‘æ—¶æ— é¡»æŒ‡å®šå¤–éƒ¨æŸå¤±(<code>loss=None</code>)ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸éœ€è¦å¤–éƒ¨æŒ‡å®šçš„ç›®æ ‡æ•°æ®(<code>y=None</code>)ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ç”¨ MNIST å»è®­ç»ƒå®ƒï¼Œä¹Ÿå°±æ˜¯ç”Ÿæˆæ‰‹å†™æ•°å­—çš„æ½œåœ¨ç©ºé—´ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.datasets <span class="keyword">import</span> mnist</span><br><span class="line"></span><br><span class="line">vae = Model(input_img, y)</span><br><span class="line">vae.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>, loss=<span class="literal">None</span>)</span><br><span class="line">vae.summary()</span><br><span class="line"></span><br><span class="line">(x_train, _), (x_test, y_test) = mnist.load_data()</span><br><span class="line"></span><br><span class="line">x_train = x_train.astype(<span class="string">&#x27;float32&#x27;</span>) / <span class="number">255.</span></span><br><span class="line">x_train = x_train.reshape(x_train.shape + (<span class="number">1</span>,))</span><br><span class="line"></span><br><span class="line">x_test = x_test.astype(<span class="string">&#x27;float32&#x27;</span>) / <span class="number">255.</span></span><br><span class="line">x_test = x_test.reshape(x_test.shape + (<span class="number">1</span>,))</span><br><span class="line"></span><br><span class="line">vae.fit(x=x_train, y=<span class="literal">None</span>,</span><br><span class="line">        shuffle=<span class="literal">True</span>,</span><br><span class="line">        epochs=<span class="number">10</span>,</span><br><span class="line">        batch_size=batch_size,</span><br><span class="line">        validation_data=(x_test, <span class="literal">None</span>))</span><br></pre></td></tr></table></figure><pre><code>WARNING:tensorflow:Output custom_variational_layer_1 missing from loss dictionary. We assume this was done on purpose. The fit and evaluate APIs will not be expecting any data to be passed to custom_variational_layer_1.Model: &quot;functional_7&quot;__________________________________________________________________________________________________Layer (type)                    Output Shape         Param #     Connected to                     ==================================================================================================input_1 (InputLayer)            [(None, 28, 28, 1)]  0                                            __________________________________________________________________________________________________conv2d_5 (Conv2D)               (None, 28, 28, 32)   320         input_1[0][0]                    __________________________________________________________________________________________________conv2d_6 (Conv2D)               (None, 14, 14, 64)   18496       conv2d_5[0][0]                   __________________________________________________________________________________________________conv2d_7 (Conv2D)               (None, 14, 14, 64)   36928       conv2d_6[0][0]                   __________________________________________________________________________________________________conv2d_8 (Conv2D)               (None, 14, 14, 64)   36928       conv2d_7[0][0]                   __________________________________________________________________________________________________flatten_1 (Flatten)             (None, 12544)        0           conv2d_8[0][0]                   __________________________________________________________________________________________________dense_4 (Dense)                 (None, 32)           401440      flatten_1[0][0]                  __________________________________________________________________________________________________dense_5 (Dense)                 (None, 2)            66          dense_4[0][0]                    __________________________________________________________________________________________________dense_6 (Dense)                 (None, 2)            66          dense_4[0][0]                    __________________________________________________________________________________________________lambda_1 (Lambda)               (None, 2)            0           dense_5[0][0]                                                                                     dense_6[0][0]                    __________________________________________________________________________________________________functional_5 (Functional)       (None, 28, 28, 1)    56385       lambda_1[0][0]                   __________________________________________________________________________________________________custom_variational_layer_1 (Cus (None, 28, 28, 1)    0           input_1[0][0]                                                                                     functional_5[0][0]               ==================================================================================================Total params: 550,629Trainable params: 550,629Non-trainable params: 0__________________________________________________________________________________________________Train on 60000 samples, validate on 10000 samplesEpoch 1/1060000/60000 [==============================] - 219s 4ms/sample - loss: 0.2173 - val_loss: 0.2016...Epoch 10/1060000/60000 [==============================] - 234s 4ms/sample - loss: 0.1840 - val_loss: 0.1826</code></pre><p>è®­ç»ƒå¥½æ¨¡å‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ decoder å°†ä»»æ„æ½œåœ¨ç©ºé—´ä¸­çš„å‘é‡è½¬æ¢ä¸ºå›¾åƒã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»æ½œåœ¨ç©ºé—´ä¸­é‡‡æ ·ä¸€ç»„ç‚¹ï¼Œè§£ç ä¸ºå›¾åƒ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> scipy.stats <span class="keyword">import</span> norm</span><br><span class="line"></span><br><span class="line">n = <span class="number">15</span>    <span class="comment"># æ˜¾ç¤º 15x15ä¸ªæ•°</span></span><br><span class="line">digit_size = <span class="number">28</span></span><br><span class="line">figure = np.zeros((digit_size * n, digit_size * n))</span><br><span class="line"></span><br><span class="line">grid_x = norm.ppf(np.linspace(<span class="number">0.05</span>, <span class="number">0.95</span>, n))  <span class="comment"># ppf å‡½æ•°å¯¹çº¿æ€§åˆ†éš”çš„åæ ‡è¿›è¡Œå˜æ¢ï¼Œä»¥ç”Ÿæˆæ½œåœ¨å˜é‡ z çš„å€¼</span></span><br><span class="line">grid_y = norm.ppf(np.linspace(<span class="number">0.05</span>, <span class="number">0.95</span>, n))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, yi <span class="keyword">in</span> <span class="built_in">enumerate</span>(grid_x):</span><br><span class="line">    <span class="keyword">for</span> j, xi <span class="keyword">in</span> <span class="built_in">enumerate</span>(grid_y):</span><br><span class="line">        z_simple = np.array([[xi, yi]])</span><br><span class="line">        z_simple = np.tile(z_simple, batch_size).reshape(batch_size, <span class="number">2</span>)</span><br><span class="line">        x_decoded = decoder.predict(z_simple, batch_size=batch_size)</span><br><span class="line">        digit = x_decoded[<span class="number">0</span>].reshape(digit_size, digit_size)</span><br><span class="line">        figure[i * digit_size: (i + <span class="number">1</span>) * digit_size,</span><br><span class="line">               j * digit_size: (j + <span class="number">1</span>) * digit_size] = digit</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>, <span class="number">10</span>))</span><br><span class="line">plt.imshow(figure, cmap=<span class="string">&#x27;Greys_r&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gi0w0g9euhj30gb0g2dib.jpg" alt="png"></p><p>ä¹¦ä¸Šåˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¹¶æ²¡æœ‰æ·±å…¥å†™ä¹‹å‰æåˆ°çš„æ¦‚å¿µå‘é‡çš„åº”ç”¨ğŸ˜‚ï¼Œå¥½é—æ†¾å•Šã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> Deep Learning with Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
            <tag> Deep Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonæ·±åº¦å­¦ä¹ ä¹‹ç¥ç»é£æ ¼è¿ç§»</title>
      <link href="/2020/08/22/DeepLearningWithPython/Deep-Learning%20with-Python-ch8_3/"/>
      <url>/2020/08/22/DeepLearningWithPython/Deep-Learning%20with-Python-ch8_3/</url>
      
        <content type="html"><![CDATA[<h1 id="Deep-Learning-with-Python"><a href="#Deep-Learning-with-Python" class="headerlink" title="Deep Learning with Python"></a>Deep Learning with Python</h1><p>è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘å­¦ä¹ ã€ŠDeep Learning with Pythonã€‹(ç¬¬äºŒç‰ˆï¼ŒFranÃ§ois Chollet è‘—) æ—¶å†™çš„ç³»åˆ—ç¬”è®°ä¹‹ä¸€ã€‚æ–‡ç« çš„å†…å®¹æ˜¯ä»  Jupyter notebooks è½¬æˆ Markdown çš„ï¼Œä½ å¯ä»¥å» <a href="https://github.com/cdfmlr/Deep-Learning-with-Python-Notebooks">GitHub</a> æˆ– <a href="https://gitee.com/cdfmlr/Deep-Learning-with-Python-Notebooks">Gitee</a> æ‰¾åˆ°åŸå§‹çš„ <code>.ipynb</code> ç¬”è®°æœ¬ã€‚</p><p>ä½ å¯ä»¥å»<a href="https://livebook.manning.com/book/deep-learning-with-python">è¿™ä¸ªç½‘ç«™åœ¨çº¿é˜…è¯»è¿™æœ¬ä¹¦çš„æ­£ç‰ˆåŸæ–‡</a>(è‹±æ–‡)ã€‚è¿™æœ¬ä¹¦çš„ä½œè€…ä¹Ÿç»™å‡ºäº†é…å¥—çš„ <a href="https://github.com/fchollet/deep-learning-with-python-notebooks">Jupyter notebooks</a>ã€‚</p><p>æœ¬æ–‡ä¸º <strong>ç¬¬8ç«   ç”Ÿæˆå¼æ·±åº¦å­¦ä¹ </strong> (Chapter 8. <em>Generative deep learning</em>) çš„ç¬”è®°ä¹‹ä¸€ã€‚</p><p>[TOC]</p><h2 id="8-3-Neural-style-transfer"><a href="#8-3-Neural-style-transfer" class="headerlink" title="8.3 Neural style transfer"></a>8.3 Neural style transfer</h2><blockquote><p>ç¥ç»é£æ ¼è¿ç§»</p></blockquote><p>ç¥ç»é£æ ¼è¿ç§»(neural style transfer)ï¼ŒåŸºäºæ·±åº¦å­¦ä¹ çš„ç¥ç»ç½‘ç»œï¼Œå°†å‚è€ƒå›¾åƒçš„é£æ ¼åº”ç”¨äºç›®æ ‡å›¾åƒï¼ŒåŒæ—¶ä¿ç•™ç›®æ ‡å›¾åƒçš„å†…å®¹ï¼Œåˆ›é€ å‡ºæ–°çš„å›¾åƒã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghsqybmpeij314y0cgarv.jpg" alt="ä¸€ä¸ªé£æ ¼è¿ç§»çš„ç¤ºä¾‹"></p><p>ç¥ç»é£æ ¼è¿ç§»çš„æ€æƒ³å¾ˆç®€å•ï¼šå®šä¹‰ä¸€ä¸ªæŸå¤±å‡½æ•°æ¥æŒ‡å®šè¦å®ç°çš„ç›®æ ‡ï¼Œç„¶åå°†è¿™ä¸ªæŸå¤±æœ€å°åŒ–ã€‚è¿™é‡Œçš„ç›®æ ‡å°±æ˜¯ä¿å­˜åŸå§‹å›¾åƒçš„å†…å®¹ï¼ŒåŒæ—¶é‡‡ç”¨å‚è€ƒå›¾åƒçš„é£æ ¼ã€‚</p><p>å‡è®¾æœ‰å‡½æ•° content å’Œ style åˆ†åˆ«å¯ä»¥è®¡ç®—å‡ºè¾“å…¥å›¾åƒçš„å†…å®¹å’Œé£æ ¼ï¼Œä»¥åŠæœ‰èŒƒå¼å‡½æ•° distanceï¼Œåˆ™ç¥ç»é£æ ¼è¿ç§»çš„æŸå¤±å¯ä»¥è¡¨è¾¾ä¸ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">loss = distance(content(original_image) - content(generated_image)) +</span><br><span class="line">       distance(style(reference_image) - style(generated_image))</span><br></pre></td></tr></table></figure><p>äº‹å®ä¸Šï¼Œåˆ©ç”¨æ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œï¼Œæ˜¯å¯ä»¥ä»æ•°å­¦ä¸Šå®šä¹‰ style å’Œ content å‡½æ•°çš„ã€‚</p><h4 id="æŸå¤±å®šä¹‰"><a href="#æŸå¤±å®šä¹‰" class="headerlink" title="æŸå¤±å®šä¹‰"></a>æŸå¤±å®šä¹‰</h4><ol><li><strong>å†…å®¹æŸå¤±</strong></li></ol><p>å·ç§¯ç¥ç»ç½‘ç»œé åº•éƒ¨ï¼ˆå‰é¢ï¼‰çš„å±‚æ¿€æ´»åŒ…å«å…³äºå›¾åƒçš„å±€éƒ¨ä¿¡æ¯ï¼Œé è¿‘é¡¶éƒ¨ï¼ˆåé¢ï¼‰çš„å±‚åˆ™åŒ…å«æ›´åŠ å…¨å±€ã€æŠ½è±¡çš„ä¿¡æ¯ã€‚å†…å®¹å°±æ˜¯å›¾åƒçš„å…¨å±€ã€æŠ½è±¡çš„ä¿¡æ¯ï¼Œæ‰€ä»¥å¯ä»¥ç”¨å·ç§¯ç¥ç»ç½‘ç»œé é¡¶éƒ¨çš„å±‚æ¿€æ´»æ¥è¡¨ç¤ºå›¾åƒçš„å†…å®¹ã€‚</p><p>å› æ­¤ï¼Œç»™å®šä¸€ä¸ªé¢„è®­ç»ƒçš„å·ç§¯ç¥ç»ç½‘ç»œï¼Œé€‰å®šä¸€ä¸ªé é¡¶éƒ¨çš„å±‚ï¼Œå†…å®¹æŸå¤±å¯ä»¥ä½¿ç”¨ã€Œè¯¥å±‚åœ¨ç›®æ ‡å›¾åƒä¸Šçš„æ¿€æ´»ã€å’Œã€Œè¯¥å±‚åœ¨ç”Ÿæˆå›¾åƒä¸Šçš„æ¿€æ´»ã€ä¹‹é—´çš„ L2 èŒƒæ•°ã€‚</p><ol start="2"><li><strong>é£æ ¼æŸå¤±</strong></li></ol><p>ä¸åŒäºå†…å®¹åªç”¨ä¸€ä¸ªå±‚å³å¯è¡¨è¾¾ï¼Œé£æ ¼éœ€è¦å¤šä¸ªå±‚æ‰èƒ½å®šä¹‰ã€‚é£æ ¼æ˜¯å¤šç§æ–¹é¢çš„ï¼Œæ¯”å¦‚ç¬”è§¦ã€çº¿æ¡ã€çº¹ç†ã€é¢œè‰²ç­‰ç­‰ï¼Œè¿™äº›å†…å®¹ä¼šå‡ºç°åœ¨ä¸åŒçš„æŠ½è±¡ç¨‹åº¦ä¸Šã€‚æ‰€ä»¥é£æ ¼çš„è¡¨è¾¾å°±éœ€è¦æ•æ‰æ‰€æœ‰ç©ºé—´å°ºåº¦ä¸Šæå–çš„å¤–è§‚ï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨å•ä¸€å°ºåº¦ä¸Šã€‚</p><p>åœ¨è¿™ç§æ€æƒ³ä¸‹ï¼Œé£æ ¼æŸå¤±çš„è¡¨è¾¾ï¼Œå¯ä»¥å€ŸåŠ©äºå±‚æ¿€æ´»çš„ Gram çŸ©é˜µã€‚è¿™ä¸ª Gram çŸ©é˜µå°±æ˜¯æŸä¸€å±‚çš„å„ä¸ªç‰¹å¾å›¾çš„å†…ç§¯ï¼Œè¡¨è¾¾äº†å±‚çš„ç‰¹å¾é—´ç›¸äº’å…³ç³»(correlation)çš„æ˜ å°„ï¼Œå®ƒå°±å¯¹åº”äºè¿™ä¸ªå°ºåº¦ä¸Šæ‰¾åˆ°çš„çº¹ç†(texture)çš„å¤–è§‚ã€‚è€Œåœ¨ä¸åŒçš„å±‚æ¿€æ´»å†…ä¿å­˜ç›¸ä¼¼çš„å†…éƒ¨ç›¸äº’å…³ç³»ï¼Œå°±å¯ä»¥è®¤ä¸ºæ˜¯â€œé£æ ¼â€äº†ã€‚</p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ç”Ÿæˆå›¾åƒå’Œé£æ ¼å‚è€ƒå›¾åƒåœ¨ä¸åŒå±‚ä¸Šä¿æŒçš„çº¹ç†ï¼Œæ¥å®šä¹‰é£æ ¼æŸå¤±äº†ã€‚</p><h4 id="ç¥ç»é£æ ¼è¿ç§»çš„-Keras-å®ç°"><a href="#ç¥ç»é£æ ¼è¿ç§»çš„-Keras-å®ç°" class="headerlink" title="ç¥ç»é£æ ¼è¿ç§»çš„ Keras å®ç°"></a>ç¥ç»é£æ ¼è¿ç§»çš„ Keras å®ç°</h4><p>ç¥ç»é£æ ¼è¿ç§»å¯ä»¥ç”¨ä»»ä½•é¢„è®­ç»ƒå·ç§¯ç¥ç»ç½‘ç»œæ¥å®ç°ï¼Œè¿™é‡Œé€‰ç”¨ VGG19ã€‚</p><p>ç¥ç»é£æ ¼è¿ç§»çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>åˆ›å»ºä¸€ä¸ªç½‘ç»œï¼ŒåŒæ—¶è®¡ç®—é£æ ¼å‚è€ƒå›¾åƒã€ç›®æ ‡å›¾åƒå’Œç”Ÿæˆå›¾åƒçš„ VGG19 å±‚æ¿€æ´»;</li><li>ä½¿ç”¨è¿™ä¸‰å¼ å›¾åƒä¸Šè®¡ç®—çš„å±‚æ¿€æ´»æ¥å®šä¹‰ä¹‹å‰æ‰€è¿°çš„æŸå¤±å‡½æ•°;</li><li>æ¢¯åº¦ä¸‹é™æ¥å°†è¿™ä¸ªæŸå¤±å‡½æ•°æœ€å°åŒ–ã€‚</li></ol><p>åœ¨å¼€å§‹æ„å»ºç½‘ç»œå‰ï¼Œå…ˆå®šä¹‰é£æ ¼å‚è€ƒå›¾åƒå’Œç›®æ ‡å›¾åƒçš„è·¯å¾„ã€‚å¦‚æœå›¾åƒå°ºå¯¸å·®å¼‚å¾ˆå¤§ï¼Œé£æ ¼è¿ç§»ä¼šæ¯”è¾ƒå›°éš¾ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è¿˜ç»Ÿä¸€å®šä¹‰ä¸€ä¸‹å°ºå¯¸ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸ä½¿ç”¨åŠæ—¶æ‰§è¡Œæ¨¡å¼</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">tf.compat.v1.disable_eager_execution()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰åˆå§‹å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.preprocessing.image <span class="keyword">import</span> load_img, img_to_array</span><br><span class="line"></span><br><span class="line">target_image_path = <span class="string">&#x27;img/portrait.jpg&#x27;</span></span><br><span class="line">style_referencce_image_path = <span class="string">&#x27;img/transfer_style_reference.jpg&#x27;</span></span><br><span class="line"></span><br><span class="line">width, height = load_img(target_image_path).size</span><br><span class="line">img_height = <span class="number">400</span></span><br><span class="line">img_width = width * img_height // height</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå›¾ç‰‡æˆ‘é€‰æ‹©äº†ï¼š</p><ul><li>transfer_style_reference: æ–‡æ£®ç‰¹Â·æ¢µé«˜ã€Šéº¦ç”°é‡Œçš„ä¸æŸæ ‘ã€‹ï¼ˆ<em>A Wheatfield, with Cypresses</em>ï¼‰ï¼Œ1889å¹´ï¼Œæ”¶è—äºçº½çº¦å¤§éƒ½ä¼šåšç‰©é¦†ã€‚</li><li>portrait: ä¿ç½—Â·é«˜æ›´ã€Šä¸åˆ—å¡”å°¼ç‰§äººã€‹(<em>The Swineherd, Brittany</em>)ï¼Œ1888å¹´ï¼Œæ”¶è—äºç¾å›½åŠ å·æ´›æ‰çŸ¶éƒ¡ç«‹ç¾æœ¯é¦†ã€‚</li></ul><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghtv5qecwtj31g20n1u0x.jpg" alt="éº¦ç”°é‡Œçš„ä¸æŸæ ‘ä¸ä¸åˆ—å¡”å°¼ç‰§äºº"></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›è¾…åŠ©å‡½æ•°ï¼Œç”¨äºå›¾åƒçš„åŠ è½½ã€å¤„ç†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¾…åŠ©å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.applications <span class="keyword">import</span> vgg19</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">preprocess_image</span>(<span class="params">image_path</span>):</span></span><br><span class="line">    img = load_img(image_path, target_size=(img_height, img_width))</span><br><span class="line">    img = img_to_array(img)</span><br><span class="line">    img = np.expand_dims(img, axis=<span class="number">0</span>)</span><br><span class="line">    img = vgg19.preprocess_input(img)</span><br><span class="line">    <span class="keyword">return</span> img</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">deprocess_image</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="comment"># vgg19.preprocess_input ä¼šå‡å»ImageNetçš„å¹³å‡åƒç´ å€¼ï¼Œä½¿å…¶ä¸­å¿ƒä¸º0ã€‚è¿™é‡Œåšé€†æ“ä½œï¼š</span></span><br><span class="line">    x[:, :, <span class="number">0</span>] += <span class="number">103.939</span></span><br><span class="line">    x[:, :, <span class="number">1</span>] += <span class="number">116.779</span></span><br><span class="line">    x[:, :, <span class="number">2</span>] += <span class="number">123.680</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># BGR -&gt; RGB</span></span><br><span class="line">    x = x[:, :, ::-<span class="number">1</span>]</span><br><span class="line">    x = np.clip(x, <span class="number">0</span>, <span class="number">255</span>).astype(<span class="string">&#x27;uint8&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ„å»º VGG19 ç½‘ç»œï¼šæ¥æ”¶ä¸‰å¼ å›¾åƒçš„ batch ä½œä¸ºè¾“å…¥ï¼Œä¸‰å¼ å›¾åƒåˆ†åˆ«æ˜¯é£æ ¼å‚è€ƒå›¾åƒã€ ç›®æ ‡å›¾åƒçš„ constant å’Œä¸€ä¸ªç”¨äºä¿å­˜ç”Ÿæˆå›¾åƒçš„ placeholderã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> backend <span class="keyword">as</span> K</span><br><span class="line"></span><br><span class="line">target_image = K.constant(preprocess_image(target_image_path))</span><br><span class="line">style_reference_image = K.constant(preprocess_image(style_referencce_image_path))</span><br><span class="line">combination_image = K.placeholder((<span class="number">1</span>, img_height, img_width, <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">input_tensor = K.concatenate([target_image,</span><br><span class="line">                              style_reference_image,</span><br><span class="line">                              combination_image], axis=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">model = vgg19.VGG19(input_tensor=input_tensor,</span><br><span class="line">                    weights=<span class="string">&#x27;imagenet&#x27;</span>,</span><br><span class="line">                    include_top=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;Model loaded.&#x27;</span>)</span><br></pre></td></tr></table></figure><pre><code>Model loaded.</code></pre><p>å®šä¹‰å†…å®¹æŸå¤±ï¼Œä¿è¯ç›®æ ‡å›¾åƒå’Œç”Ÿæˆå›¾åƒåœ¨ç½‘ç»œé¡¶å±‚çš„ç»“æœç›¸ä¼¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å†…å®¹æŸå¤±</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">content_loss</span>(<span class="params">base, combination</span>):</span></span><br><span class="line">    <span class="keyword">return</span> K.<span class="built_in">sum</span>(K.square(combination - base))</span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯é£æ ¼æŸå¤±ï¼Œè®¡ç®—è¾“å…¥çŸ©é˜µçš„ Gram çŸ©é˜µï¼Œå€ŸåŠ©ç”¨ Gram çŸ©é˜µè®¡ç®—é£æ ¼æŸå¤±ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é£æ ¼æŸå¤±</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gram_matrix</span>(<span class="params">x</span>):</span></span><br><span class="line">    features = K.batch_flatten(K.permute_dimensions(x, (<span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>)))</span><br><span class="line">    gram = K.dot(features, K.transpose(features))</span><br><span class="line">    <span class="keyword">return</span> gram</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">style_loss</span>(<span class="params">style, combination</span>):</span></span><br><span class="line">    S = gram_matrix(style)</span><br><span class="line">    C = gram_matrix(combination)</span><br><span class="line">    channels = <span class="number">3</span></span><br><span class="line">    size = img_height * img_width</span><br><span class="line">    <span class="keyword">return</span> K.<span class="built_in">sum</span>(K.square(S - C)) / (<span class="number">4.0</span> * (channels ** <span class="number">2</span>) * (size ** <span class="number">2</span>))</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬å†é¢å¤–å®šä¹‰ä¸€ä¸ªã€Œæ€»å˜å·®æŸå¤±ã€(total variation loss)ï¼Œä¿ƒä½¿ç”Ÿæˆå›¾åƒå…·æœ‰ç©ºé—´è¿ç»­æ€§ï¼Œé¿å…ç»“æœè¿‡åº¦åƒç´ åŒ–ï¼Œç›¸å½“äºä¸€ä¸ªæ­£åˆ™åŒ–ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ€»å˜å·®æŸå¤±</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">total_variation_loss</span>(<span class="params">x</span>):</span></span><br><span class="line">    a = K.square(</span><br><span class="line">        x[:, :img_height - <span class="number">1</span>, :img_width - <span class="number">1</span>, :] - </span><br><span class="line">        x[:, <span class="number">1</span>:, :img_width - <span class="number">1</span>, :])</span><br><span class="line">    b = K.square(</span><br><span class="line">        x[:, :img_height - <span class="number">1</span>, :img_width - <span class="number">1</span>, :] - </span><br><span class="line">        x[:, :img_height - <span class="number">1</span>, <span class="number">1</span>:, :])</span><br><span class="line">    <span class="keyword">return</span> K.<span class="built_in">sum</span>(K.<span class="built_in">pow</span>(a + b, <span class="number">1.25</span>))</span><br></pre></td></tr></table></figure><p>ç°åœ¨è€ƒè™‘å…·ä½“çš„æŸå¤±è®¡ç®—ï¼šåœ¨è®¡ç®—å†…å®¹æŸå¤±æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé é¡¶éƒ¨çš„å±‚ï¼›å¯¹äºé£æ ¼æŸå¤±ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ç³»åˆ—å±‚ï¼Œæ—¢åŒ…æ‹¬é¡¶å±‚ä¹ŸåŒ…æ‹¬åº•å±‚ï¼›æœ€åè¿˜éœ€è¦æ·»åŠ æ€»å˜å·®æŸå¤±ã€‚æœ€ç»ˆçš„æŸå¤±å°±æ˜¯è¿™ä¸‰ç±»æŸå¤±çš„åŠ æƒå¹³å‡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰éœ€è¦æœ€å°åŒ–çš„æœ€ç»ˆæŸå¤±</span></span><br><span class="line"></span><br><span class="line">outputs_dict = &#123;layer.name: layer.output <span class="keyword">for</span> layer <span class="keyword">in</span> model.layers&#125;</span><br><span class="line"></span><br><span class="line">content_layer = <span class="string">&#x27;block5_conv2&#x27;</span></span><br><span class="line">style_layers = [<span class="string">f&#x27;block<span class="subst">&#123;i&#125;</span>_conv1&#x27;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">6</span>)]</span><br><span class="line"></span><br><span class="line">total_variation_weight = <span class="number">1e-4</span></span><br><span class="line">style_weight = <span class="number">1.0</span></span><br><span class="line">content_weight = <span class="number">0.025</span>  <span class="comment"># content_weightè¶Šå¤§ï¼Œç›®æ ‡å†…å®¹æ›´å®¹æ˜“åœ¨ç”Ÿæˆå›¾åƒä¸­è¶Šå®¹æ˜“è¯†åˆ«</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å†…å®¹æŸå¤±</span></span><br><span class="line">loss = K.variable(<span class="number">0.</span>)</span><br><span class="line">layer_features = outputs_dict[content_layer]</span><br><span class="line">target_image_features = layer_features[<span class="number">0</span>, :, :, :]</span><br><span class="line">combination_features = layer_features[<span class="number">2</span>, :, :, :]</span><br><span class="line">loss = loss + content_weight * content_loss(target_image_features, combination_features)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é£æ ¼æŸå¤±</span></span><br><span class="line"><span class="keyword">for</span> layer_name <span class="keyword">in</span> style_layers:</span><br><span class="line">    layer_features = outputs_dict[layer_name]</span><br><span class="line">    style_reference_features = layer_features[<span class="number">1</span>, :, :, :]</span><br><span class="line">    combination_features = layer_features[<span class="number">2</span>, :, :, :]</span><br><span class="line">    sl = style_loss(style_reference_features, combination_features)</span><br><span class="line">    loss = loss + (style_weight / <span class="built_in">len</span>(style_layers)) * sl</span><br><span class="line">    </span><br><span class="line"><span class="comment"># æ€»å˜å·®æŸå¤±</span></span><br><span class="line">loss = loss + total_variation_weight * total_variation_loss(combination_image)</span><br></pre></td></tr></table></figure><p>æœ€åå°±æ˜¯æ¢¯åº¦ä¸‹é™è¿‡ç¨‹äº†ã€‚è¿™é‡Œè°ƒç”¨ scipyï¼Œç”¨ <code>L-BFGS</code> ç®—æ³•è¿›è¡Œæœ€ä¼˜åŒ–ã€‚</p><p>ä¸ºäº†å¿«é€Ÿè®¡ç®—ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª Evaluator ç±»ï¼ŒåŒæ—¶è®¡ç®—æŸå¤±å€¼å’Œæ¢¯åº¦å€¼ï¼Œåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ä¼šè¿”å›æŸå¤±å€¼ï¼ŒåŒæ—¶ç¼“å­˜æ¢¯åº¦å€¼ç”¨äºä¸‹ä¸€æ¬¡è°ƒç”¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®æ¢¯åº¦ä¸‹é™è¿‡ç¨‹</span></span><br><span class="line"></span><br><span class="line">grads = K.gradients(loss, combination_image)[<span class="number">0</span>]</span><br><span class="line">fetch_loss_and_grads = K.function([combination_image], [loss, grads])</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Evaluator</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.loss_value = <span class="literal">None</span></span><br><span class="line">        self.grads_values = <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loss</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        <span class="keyword">assert</span> self.loss_value <span class="keyword">is</span> <span class="literal">None</span></span><br><span class="line">        x = x.reshape((<span class="number">1</span>, img_height, img_width, <span class="number">3</span>))</span><br><span class="line">        outs = fetch_loss_and_grads([x])</span><br><span class="line">        loss_value = outs[<span class="number">0</span>]</span><br><span class="line">        grad_values = outs[<span class="number">1</span>].flatten().astype(<span class="string">&#x27;float64&#x27;</span>)</span><br><span class="line">        self.loss_value = loss_value</span><br><span class="line">        self.grads_values = grad_values</span><br><span class="line">        <span class="keyword">return</span> self.loss_value</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">grads</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        <span class="keyword">assert</span> self.loss_value <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br><span class="line">        grad_values = np.copy(self.grads_values)</span><br><span class="line">        self.loss_value = <span class="literal">None</span></span><br><span class="line">        self.grad_values = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> grad_values</span><br><span class="line">        </span><br><span class="line">evaluator = Evaluator()</span><br></pre></td></tr></table></figure><p>æœ€åçš„æœ€åï¼Œè°ƒç”¨ SciPy çš„ L-BFGS ç®—æ³•æ¥è¿è¡Œæ¢¯åº¦ä¸Šå‡è¿‡ç¨‹ï¼Œæ¯ä¸€æ¬¡è¿­ä»£(20 æ­¥æ¢¯åº¦ä¸Šå‡)åéƒ½ä¿å­˜å½“å‰çš„ç”Ÿæˆå›¾åƒï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scipy.optimize <span class="keyword">import</span> fmin_l_bfgs_b</span><br><span class="line"><span class="keyword">from</span> imageio <span class="keyword">import</span> imsave</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">iterations = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">result_fname</span>(<span class="params">iteration</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&#x27;results/result_at_iteration_<span class="subst">&#123;iteration&#125;</span>.png&#x27;</span></span><br><span class="line"></span><br><span class="line">x = preprocess_image(target_image_path)</span><br><span class="line">x = x.flatten()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(iterations):</span><br><span class="line">    print(<span class="string">&#x27;Start of iteration&#x27;</span>, i)</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    </span><br><span class="line">    x, min_val, info = fmin_l_bfgs_b(evaluator.loss,</span><br><span class="line">                                     x,</span><br><span class="line">                                     fprime=evaluator.grads,</span><br><span class="line">                                     maxfun=<span class="number">20</span>)</span><br><span class="line">    print(<span class="string">&#x27;  Current loss value:&#x27;</span>, min_val)</span><br><span class="line">    </span><br><span class="line">    img = x.copy().reshape((img_height, img_width, <span class="number">3</span>))</span><br><span class="line">    img = deprocess_image(img)</span><br><span class="line">    fname = result_fname(i)</span><br><span class="line">    imsave(fname, img)</span><br><span class="line">    print(<span class="string">&#x27;  Image saved as&#x27;</span>, fname)</span><br><span class="line">    </span><br><span class="line">    end_time = time.time()</span><br><span class="line">    print(<span class="string">f&#x27;  Iteration <span class="subst">&#123;i&#125;</span> completed in <span class="subst">&#123;end_time - start_time&#125;</span> s&#x27;</span>)</span><br></pre></td></tr></table></figure><pre><code>Start of iteration 0  Current loss value: 442468450.0  Image saved as results/result_at_iteration_0.png  Iteration 0 completed in 177.57321500778198 s...Start of iteration 19  Current loss value: 44762796.0  Image saved as results/result_at_iteration_19.png  Iteration 19 completed in 177.95070385932922 s</code></pre><p>æŠŠç»“æœå’ŒåŸå›¾æ”¾åœ¨ä¸€èµ·æ¯”è¾ƒä¸€ä¸‹ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghu38838haj317h0u0b2b.jpg" alt="ç»“æœ1"></p><p>å†çœ‹ä¸€ä¸ªä¾‹å­ï¼šé£æ ¼å‚è€ƒè¿˜æ˜¯ç”¨æ¢µé«˜çš„ã€Šéº¦ç”°é‡Œçš„ä¸æŸæ ‘ã€‹ï¼Œå†…å®¹ç”¨ç±³å‹’çš„ã€Šæ‹¾ç©—è€…ã€‹(Des glaneusesï¼Œ1857å¹´ï¼Œå·´é»å¥¥å¡ç¾æœ¯é¦†)ã€‚æ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ï¼Œæ¢µé«˜æœ¬äººç”»è¿‡ä¸€å¹…éƒ¨åˆ†æ¨¡ä»¿ã€Šæ‹¾ç©—è€…ã€‹çš„ã€Šå¤•é˜³ä¸‹ä¸¤ä½å†œå¦‡å¼€æ˜ç§¯é›ªè¦†ç›–çš„ç”°åœ°ã€‹(Zwei grabende BÃ¤uerinnen auf schneebedecktem Feld)ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghu6d9c19jj30vr0u0u0x.jpg" alt="ç»“æœ2"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„æœºå™¨åªæ˜¯ç®€å•ç²—æš´çš„é£æ ¼è¿ç§»ï¼Œè€Œå¤§å¸ˆæœ¬äººä¼šåœ¨æ¨¡ä»¿ä¸­å†åˆ›ä½œã€‚</p><p>æœ€åï¼Œè¡¥å……ä¸€ç‚¹ã€‚è¿™ä¸ªé£æ ¼è¿ç§»ç®—æ³•çš„è¿è¡Œæ¯”è¾ƒæ…¢ï¼Œä½†è¶³å¤Ÿç®€å•ã€‚è¦å®ç°å¿«é€Ÿé£æ ¼è¿ç§»ï¼Œå¯ä»¥è€ƒè™‘ï¼šé¦–å…ˆåˆ©ç”¨è¿™é‡Œä»‹ç»çš„æ–¹æ³•ï¼Œå›ºå®šä¸€å¼ é£æ ¼å‚è€ƒå›¾åƒï¼Œç»™ä¸åŒçš„å†…å®¹å›¾åƒï¼Œç”Ÿæˆä¸€å¤§å †ã€Œè¾“å…¥-è¾“å‡ºã€è®­ç»ƒæ ·ä¾‹ï¼Œæ‹¿è¿™äº›ã€Œè¾“å…¥-è¾“å‡ºã€å»è®­ç»ƒä¸€ä¸ªç®€å•çš„å·ç§¯ç¥ç»ç½‘ç»œæ¥å­¦ä¹ è¿™ä¸ªç‰¹å®šé£æ ¼çš„å˜æ¢(è¾“å…¥-&gt;è¾“å‡º)ã€‚å®Œæˆä¹‹åï¼Œå¯¹ä¸€å¼ å›¾åƒè¿›è¡Œç‰¹å®šé£æ ¼çš„è¿ç§»å°±éå¸¸å¿«äº†ï¼Œåšä¸€æ¬¡å‰å‘ä¼ é€’å°±å®Œæˆäº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> Deep Learning with Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
            <tag> Deep Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonæ·±åº¦å­¦ä¹ ä¹‹DeepDream</title>
      <link href="/2020/08/21/DeepLearningWithPython/Deep-Learning%20with-Python-ch8_2/"/>
      <url>/2020/08/21/DeepLearningWithPython/Deep-Learning%20with-Python-ch8_2/</url>
      
        <content type="html"><![CDATA[<h1 id="Deep-Learning-with-Python"><a href="#Deep-Learning-with-Python" class="headerlink" title="Deep Learning with Python"></a>Deep Learning with Python</h1><p>è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘å­¦ä¹ ã€ŠDeep Learning with Pythonã€‹(ç¬¬äºŒç‰ˆï¼ŒFranÃ§ois Chollet è‘—) æ—¶å†™çš„ç³»åˆ—ç¬”è®°ä¹‹ä¸€ã€‚æ–‡ç« çš„å†…å®¹æ˜¯ä»  Jupyter notebooks è½¬æˆ Markdown çš„ï¼Œä½ å¯ä»¥å» <a href="https://github.com/cdfmlr/Deep-Learning-with-Python-Notebooks">GitHub</a> æˆ– <a href="https://gitee.com/cdfmlr/Deep-Learning-with-Python-Notebooks">Gitee</a> æ‰¾åˆ°åŸå§‹çš„ <code>.ipynb</code> ç¬”è®°æœ¬ã€‚</p><p>ä½ å¯ä»¥å»<a href="https://livebook.manning.com/book/deep-learning-with-python">è¿™ä¸ªç½‘ç«™åœ¨çº¿é˜…è¯»è¿™æœ¬ä¹¦çš„æ­£ç‰ˆåŸæ–‡</a>(è‹±æ–‡)ã€‚è¿™æœ¬ä¹¦çš„ä½œè€…ä¹Ÿç»™å‡ºäº†é…å¥—çš„ <a href="https://github.com/fchollet/deep-learning-with-python-notebooks">Jupyter notebooks</a>ã€‚</p><p>æœ¬æ–‡ä¸º <strong>ç¬¬8ç«   ç”Ÿæˆå¼æ·±åº¦å­¦ä¹ </strong> (Chapter 8. <em>Generative deep learning</em>) çš„ç¬”è®°ä¹‹ä¸€ã€‚</p><p>[TOC]</p><h2 id="8-2-DeepDream"><a href="#8-2-DeepDream" class="headerlink" title="8.2 DeepDream"></a>8.2 DeepDream</h2><blockquote><p>DeepDream</p></blockquote><p>DeepDream æ˜¯ä¸€ç§è®©æœºå™¨ä¿®æ”¹å›¾åƒæŠ€æœ¯ï¼Œå®ƒåˆ©ç”¨å·ç§¯ç¥ç»ç½‘ç»œï¼Œå¯ä»¥ä½œå‡ºå¾ˆè¿·å¹»çš„å›¾åƒï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghqnj1501xj313t0u0e84.jpg" alt="DeepDream è¾“å‡ºå›¾åƒç¤ºä¾‹"></p><p>ç”±äº DeepDream ç”¨çš„ CNN æ˜¯åœ¨ ImageNet ä¸Šè®­ç»ƒçš„ï¼Œè€Œ ImageNet é‡Œæœ‰å¤§é‡çš„åŠ¨ç‰©å›¾ç‰‡ï¼Œæ‰€ä»¥ï¼ŒDeepDream ç”Ÿæˆçš„å›¾åƒé‡Œæœ‰å¾ˆå¤šåŠ¨ç‰©ã€åŠ¨ç‰©çš„ä¸€éƒ¨åˆ†çš„ä¼ªå½±ã€‚</p><p>DeepDream ä½¿ç”¨çš„ç®—æ³•ä¸å·ç§¯ç¥ç»ç½‘ç»œè¿‡æ»¤å™¨å¯è§†åŒ–æŠ€æœ¯å¾ˆç±»ä¼¼ã€‚å›å¿†ä¸€ä¸‹ï¼Œå·ç§¯ç¥ç»ç½‘ç»œè¿‡æ»¤å™¨å¯è§†åŒ–æ‰€åšçš„æ“ä½œæ˜¯ï¼šåå‘è¿è¡Œå·ç§¯ç¥ç»ç½‘ç»œï¼Œä»ä¸€å¼ å¸¦éšæœºå™ªç‚¹çš„ç©ºç™½å›¾åƒè¾“å…¥ï¼Œåšæ¢¯åº¦ä¸Šå‡ï¼Œä½¿æŸè¿‡æ»¤å™¨æ¿€æ´»æœ€å¤§åŒ–ã€‚</p><p>DeepDream  ä¸è¿‡æ»¤å™¨å¯è§†åŒ–çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼š</p><ul><li>åœ¨ DeepDream ä¸­ï¼Œæˆ‘ä»¬å°è¯•å°†æ‰€æœ‰å±‚çš„æ¿€æ´»æœ€å¤§åŒ–ï¼Œè€Œä¸åªæ˜¯æŸä¸€å±‚ï¼Œè¿™æ ·ï¼Œä¼šæœ‰å¤§é‡çš„å¯è§†åŒ–ç‰¹å¾æ··åˆåœ¨ä¸€èµ·â€”â€”ç”Ÿæˆæ›´åŠ è¿·å¹»çš„å›¾åƒã€‚</li><li>ä»ä¸€å¼ ç°æœ‰çš„å›¾åƒå¼€å§‹ï¼Œè€Œä¸æ˜¯ä»éšæœºå™ªç‚¹çš„è¾“å…¥å¼€å§‹ï¼Œè¿™æ ·ç”Ÿæˆçš„å›¾åƒä¸­ä¼šåŒ…å«è¾“å…¥å›¾åƒä¸­å·²å­˜åœ¨çš„è§†è§‰æ¨¡å¼ï¼Œå¹¶ä»¥å°†å…¶ä¸­çš„ä¸€äº›å…ƒç´ æ‰­æ›²â€”â€”ç”Ÿæˆæ›´åŠ è¿·å¹»çš„å›¾åƒã€‚</li><li>è¾“å…¥å›¾åƒä¼šåœ¨ä¸åŒçš„å°ºåº¦ä¸Šè¿›è¡Œå¤„ç†â€”â€”è¿™äº›å°ºåº¦ç§°ä¸ºã€Œå…«åº¦ã€(octave)ï¼Œè¿™å¯ä»¥æé«˜è¾“å‡ºçš„è´¨é‡ã€‚ </li></ul><h3 id="ç”¨-Keras-å®ç°-DeepDream"><a href="#ç”¨-Keras-å®ç°-DeepDream" class="headerlink" title="ç”¨ Keras å®ç° DeepDream"></a>ç”¨ Keras å®ç° DeepDream</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦é€‰å®šä¸€ä¸ªåœ¨ ImageNet ä¸Šé¢„è®­ç»ƒçš„å·ç§¯ç¥ç»ç½‘ç»œï¼šVGG16ã€Inceptionã€ResNet50 ç­‰ç­‰éƒ½å¯ä»¥ã€‚å®è·µè¯æ˜ï¼ŒInception å¯ä»¥ç”Ÿæˆçš„æ¯”è¾ƒå¥½ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ Keras å†…ç½®çš„ Inception V3 æ¨¡å‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸ä½¿ç”¨åŠæ—¶æ‰§è¡Œæ¨¡å¼</span></span><br><span class="line"><span class="comment"># See https://github.com/tensorflow/tensorflow/issues/33135</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">tf.compat.v1.disable_eager_execution()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŠ è½½é¢„è®­ç»ƒçš„ Inception V3 æ¨¡å‹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.applications <span class="keyword">import</span> inception_v3</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> backend <span class="keyword">as</span> K</span><br><span class="line"></span><br><span class="line">K.set_learning_phase(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">model = inception_v3.InceptionV3(weights=<span class="string">&#x27;imagenet&#x27;</span>, include_top=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><pre><code>WARNING:tensorflow:From &lt;ipython-input-3-aa9be14f7cc2&gt;:6: set_learning_phase (from tensorflow.python.keras.backend) is deprecated and will be removed after 2020-10-11.Instructions for updating:Simply pass a True/False value to the `training` argument of the `__call__` method of your layer or model.</code></pre><p>æ¥ä¸‹æ¥å®šä¹‰æŸå¤±â€”â€”éœ€è¦ç”¨æ¢¯åº¦ä¸Šå‡æœ€å¤§åŒ–çš„é‡ã€‚DeepDream ä¸­ï¼Œæˆ‘ä»¬è¦åŒæ—¶å°†å¤šä¸ªå±‚çš„æ‰€æœ‰è¿‡æ»¤å™¨æ¿€æ´»æœ€å¤§åŒ–ã€‚å…·ä½“çš„å®ç°æ˜¯ï¼šå¯¹ä¸€ç»„é è¿‘é¡¶éƒ¨çš„å±‚æ¿€æ´»çš„ L2 èŒƒæ•°è¿›è¡ŒåŠ æƒæ±‚å’Œï¼Œç„¶åæ±‚å‡ºè¿™ä¸ªå€¼çš„æœ€å¤§åŒ–ã€‚å±‚çš„é€‰æ‹©ã€ä»¥åŠæƒé‡åˆ†é…å¯¹ç”Ÿæˆçš„ç»“æœå½±å“å¾ˆå¤§ï¼š</p><ul><li>é è¿‘åº•éƒ¨çš„å±‚ä¼šç”ŸæˆåŸºæœ¬çš„å‡ ä½•å›¾æ¡ˆï¼›</li><li>é è¿‘é¡¶éƒ¨çš„å±‚ä¼šç”Ÿæˆèƒ½å¤Ÿçœ‹å‡ºæŸäº›ç‰©å“çš„å›¾åƒï¼ˆImageNet ä¸­çš„å›¾æ¡ˆï¼Œæ¯”å¦‚é¸Ÿæˆ–ç‹—ï¼‰</li></ul><p>è¿™é‡Œå°±éšä¾¿é€‰å‡ ä¸ªäº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¾“å‡º Inception V3 æ¨¡å‹çš„ç»“æ„ï¼Œåœ¨å…¶ä¸­é€‰æ‹©å±‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">tf.keras.utils.plot_model(model)</span><br></pre></td></tr></table></figure><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghy7jy9nmhj30u05oz4qq.jpg" alt="png" style="zoom:5%;" /><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DeepDream é…ç½®</span></span><br><span class="line"></span><br><span class="line">layer_contributions = &#123;</span><br><span class="line">    <span class="string">&#x27;mixed4&#x27;</span>: <span class="number">0.0</span>,</span><br><span class="line">    <span class="string">&#x27;mixed5&#x27;</span>: <span class="number">3.0</span>,</span><br><span class="line">    <span class="string">&#x27;mixed6&#x27;</span>: <span class="number">2.0</span>,</span><br><span class="line">    <span class="string">&#x27;mixed7&#x27;</span>: <span class="number">1.5</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ±‚å¯¹äºè¿™äº›è¢«é€‰ä¸­å±‚çš„æŸå¤±ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰éœ€è¦æœ€å¤§åŒ–çš„æŸå¤±</span></span><br><span class="line"></span><br><span class="line">layer_dict = <span class="built_in">dict</span>([(layer.name, layer) <span class="keyword">for</span> layer <span class="keyword">in</span> model.layers])</span><br><span class="line"></span><br><span class="line">loss = K.variable(<span class="number">0.</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> layer_name <span class="keyword">in</span> layer_contributions:</span><br><span class="line">    coeff = layer_contributions[layer_name]</span><br><span class="line">    activation = layer_dict[layer_name].output</span><br><span class="line">    </span><br><span class="line">    scaling = K.prod(K.cast(K.shape(activation), <span class="string">&#x27;float32&#x27;</span>))</span><br><span class="line">    <span class="comment"># loss += coeff * K.sum(K.square(activation[:, 2: -2, :])) / scaling</span></span><br><span class="line">    <span class="comment"># åº”è¯¥ç”¨ä¸‹é¢çš„ä»£ç ğŸ‘‡ã€‚å‚è€ƒï¼šhttps://github.com/fchollet/deep-learning-with-python-notebooks/issues/43</span></span><br><span class="line">    loss = loss + coeff * K.<span class="built_in">sum</span>(K.square(activation[:, <span class="number">2</span>: -<span class="number">2</span>, :])) / scaling</span><br></pre></td></tr></table></figure><p>å¯¹æŸå¤±åšæ¢¯åº¦ä¸Šå‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¢¯åº¦ä¸Šå‡è¿‡ç¨‹</span></span><br><span class="line"></span><br><span class="line">dream = model.<span class="built_in">input</span></span><br><span class="line"></span><br><span class="line">grads = K.gradients(loss, dream)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">grads /= K.maximum(K.mean(K.<span class="built_in">abs</span>(grads)), <span class="number">1e-7</span>)</span><br><span class="line"></span><br><span class="line">outputs = [loss, grads]</span><br><span class="line">fetch_loss_and_grads = K.function([dream], outputs)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">eval_loss_and_grads</span>(<span class="params">x</span>):</span></span><br><span class="line">    outs = fetch_loss_and_grads([x])</span><br><span class="line">    loss_value = outs[<span class="number">0</span>]</span><br><span class="line">    grad_values = outs[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> loss_value, grad_values</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gradient_ascent</span>(<span class="params">x, iterations, step, max_loss=<span class="literal">None</span></span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(iterations):</span><br><span class="line">        loss_value, grad_values = eval_loss_and_grads(x)</span><br><span class="line">        <span class="keyword">if</span> max_loss <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> loss_value &gt; max_loss:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        print(<span class="string">f&#x27;   loss value at <span class="subst">&#123;i&#125;</span>: <span class="subst">&#123;loss_value&#125;</span>&#x27;</span>)</span><br><span class="line">        x += step * grad_values</span><br><span class="line">    <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œå®ç° DeepDream ç®—æ³•ï¼šå…ˆå®šä¹‰ä¸€ä¸ªå°ºåº¦(scalesï¼Œä¹Ÿå«åšå…«åº¦ï¼Œoctaves)åˆ—è¡¨ï¼Œé‡Œé¢åŒ…å«è¦å¤„ç†çš„å›¾åƒã€‚åä¸€ä¸ªå°ºåº¦çš„å›¾åƒæ¯”å‰ä¸€ä¸ªæ”¾å¤§ä¸€å®šçš„å€æ•°ã€‚DeepDream è¦æŒ‰ç…§è¿™ä¸ªåˆ—è¡¨ä»æœ€å°åˆ°æœ€å¤§ï¼Œåœ¨å½“å‰å°ºåº¦è¿è¡Œæ¢¯åº¦ä¸Šå‡ï¼Œç„¶åå°†å¾—åˆ°çš„å›¾åƒæ”¾å¤§ã€‚æ”¾å¤§ä¹‹åï¼Œå›¾åƒä¼šå˜å¾—æ¨¡ç³Šï¼Œæ‰€ä»¥è¿˜è¦å°†ä¸¢å¤±çš„ç»†èŠ‚é‡æ–°æ³¨å…¥åˆ°å›¾åƒä¸­ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghrruc28b5j31o40u0nly.jpg" alt="DeepDream è¿‡ç¨‹:ç©ºé—´å¤„ç†å°ºåº¦çš„è¿ç»­æ”¾å¤§(å…«åº¦)ä¸æ”¾å¤§æ—¶é‡æ–°æ³¨å…¥ç»†èŠ‚"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¾…åŠ©å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scipy</span><br><span class="line"><span class="keyword">import</span> imageio</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.preprocessing <span class="keyword">import</span> image</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">resize_img</span>(<span class="params">img, size</span>):</span></span><br><span class="line">    img = np.copy(img)</span><br><span class="line">    factors = (<span class="number">1</span>, </span><br><span class="line">               <span class="built_in">float</span>(size[<span class="number">0</span>]) / img.shape[<span class="number">1</span>], </span><br><span class="line">               <span class="built_in">float</span>(size[<span class="number">1</span>]) / img.shape[<span class="number">2</span>], </span><br><span class="line">               <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> scipy.ndimage.zoom(img, factors, order=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_img</span>(<span class="params">img, fname</span>):</span></span><br><span class="line">    pil_img = deprocess_image(np.copy(img))</span><br><span class="line">    <span class="comment"># scipy.misc.imsave(fname, pil_img)</span></span><br><span class="line">    imageio.imsave(fname, pil_img)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">preprocess_image</span>(<span class="params">image_path</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    ç”¨äºæ‰“å¼€å›¾åƒï¼Œæ”¹å˜å›¾åƒå¤§å°ï¼Œå¹¶å°†å›¾åƒæ ¼å¼è½¬æ¢ä¸º Inception V3 æ¨¡å‹èƒ½å¤Ÿå¤„ç†çš„å¼ é‡</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    img = image.load_img(image_path)</span><br><span class="line">    img = image.img_to_array(img)</span><br><span class="line">    img = np.expand_dims(img, axis=<span class="number">0</span>)</span><br><span class="line">    img = inception_v3.preprocess_input(img)</span><br><span class="line">    <span class="keyword">return</span> img</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">deprocess_image</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    å°†ä¸€ä¸ªå¼ é‡è½¬æ¢ä¸ºæœ‰æ•ˆå›¾åƒ</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> K.image_data_format() == <span class="string">&#x27;channels_first&#x27;</span>:</span><br><span class="line">        x = x.reshape((<span class="number">3</span>, x.shape[<span class="number">2</span>], x.shape[<span class="number">3</span>]))</span><br><span class="line">        x = x.transpose((<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        x = x.reshape((x.shape[<span class="number">1</span>], x.shape[<span class="number">2</span>], <span class="number">3</span>))</span><br><span class="line">        </span><br><span class="line">    x /= <span class="number">2.</span></span><br><span class="line">    x += <span class="number">0.5</span></span><br><span class="line">    x *= <span class="number">255.</span></span><br><span class="line">    x = np.clip(x, <span class="number">0</span>, <span class="number">255</span>).astype(<span class="string">&#x27;uint8&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨å¤šä¸ªè¿ç»­å°ºåº¦ä¸Šè¿è¡Œæ¢¯åº¦ä¸Šå‡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">step = <span class="number">0.01</span>     <span class="comment"># æ¢¯åº¦ä¸Šå‡çš„æ­¥é•¿</span></span><br><span class="line">num_octave = <span class="number">3</span>  <span class="comment"># å°ºåº¦ä¸ªæ•°</span></span><br><span class="line">octave_scale = <span class="number">1.4</span> <span class="comment"># ä¸¤ä¸ªå°ºåº¦çš„å¤§å°æ¯”ä¾‹</span></span><br><span class="line">iterations = <span class="number">20</span> <span class="comment"># åœ¨æ¯ä¸ªå°ºåº¦ä¸Šè¿è¡Œæ¢¯åº¦ä¸Šå‡çš„æ­¥æ•°</span></span><br><span class="line"></span><br><span class="line">max_loss = <span class="number">10.</span>  <span class="comment"># æŸå¤±ä¸Šå‡çš„å¤ªå¤§æ—¶ä¸­æ­¢æ¢¯åº¦ä¸Šå‡ï¼Œä»¥å…å¾—åˆ°ä¸‘é™‹çš„ä¼ªå½±</span></span><br><span class="line"></span><br><span class="line">base_image_path = <span class="string">&#x27;./img.png&#x27;</span></span><br><span class="line"></span><br><span class="line">img = preprocess_image(base_image_path)</span><br><span class="line"></span><br><span class="line">original_shape = img.shape[<span class="number">1</span>:<span class="number">3</span>]</span><br><span class="line">successive_shapes = [original_shape]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, num_octave):</span><br><span class="line">    shape = <span class="built_in">tuple</span>([dim // (octave_scale ** i)</span><br><span class="line">                  <span class="keyword">for</span> dim <span class="keyword">in</span> original_shape])</span><br><span class="line">    successive_shapes.append(shape)</span><br><span class="line">successive_shapes = successive_shapes[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">original_img = np.copy(img)</span><br><span class="line">shrunk_original_img = resize_img(img, successive_shapes[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> shape <span class="keyword">in</span> successive_shapes:</span><br><span class="line">    print(<span class="string">&#x27;Processing image shape&#x27;</span>, shape)</span><br><span class="line">    img = resize_img(img, shape)</span><br><span class="line">    img = gradient_ascent(img,</span><br><span class="line">                          iterations=iterations,</span><br><span class="line">                          step=step,</span><br><span class="line">                          max_loss=max_loss)</span><br><span class="line">    upscaled_shrunk_original_img = resize_img(shrunk_original_img, shape)</span><br><span class="line">    same_size_original = resize_img(original_img, shape)</span><br><span class="line">    lost_detail = same_size_original - upscaled_shrunk_original_img</span><br><span class="line">    </span><br><span class="line">    img += lost_detail</span><br><span class="line">    shrunk_original_img = resize_img(original_img, shape)</span><br><span class="line">    save_img(img, fname=<span class="string">f&#x27;dream_at_scale_<span class="subst">&#123;shape&#125;</span>.png&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">save_img(img, fname=<span class="string">&#x27;final_dream.png&#x27;</span>)</span><br></pre></td></tr></table></figure><pre><code>Processing image shape (510.0, 510.0)   loss value at 0: 0.7559041976928711   loss value at 1: 0.8942177295684814   ...   loss value at 18: 6.890047073364258   loss value at 19: 7.1789984703063965Processing image shape (714.0, 714.0)   loss value at 0: 1.6531521081924438   loss value at 1: 2.5666146278381348   ...   loss value at 18: 9.60411548614502   loss value at 19: 9.890054702758789Processing image shape (1000, 1000)   loss value at 0: 1.6969424486160278   loss value at 1: 2.754427909851074   ...   loss value at 17: 9.593267440795898   loss value at 18: 9.928627014160156</code></pre><p>ç»“æœï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghso9lpohzj31aq0li7wi.jpg" alt="DeepDreamç»“æœ"></p><p>å¯ä»¥çœ‹åˆ° DeepDream åœ¨ final_dream å›¾ç‰‡é‡Œï¼Œç”»ä¸Šäº†å‡ åªç‹—ğŸ¶ã€‚</p><p>æ³¨ï¼šç”±äº Inception V3 åŸå§‹è®­ç»ƒçš„å°ºå¯¸çš„ç¼˜æ•…ï¼Œè¿™é‡Œå®ç°çš„ DeepDream å®ç°åœ¨å°ºå¯¸ä»‹äº 300Ã—300 å’Œ 400Ã—400 ä¹‹é—´çš„å›¾åƒä¸Šèƒ½å¤Ÿå¾—åˆ°æ›´å¥½çš„ç»“æœï¼Œä¸è¿‡è¿™ä¸æ˜¯ä¸¥æ ¼çš„é™åˆ¶ï¼Œä»»ä½•å°ºå¯¸çš„éƒ½æ˜¯å¯ä»¥çš„ã€‚</p><hr><p>æ³¨ï¼šä½¿ç”¨ TensorfFlow 2 çš„ eager æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“åœ°å®ç°ä¸€ä¸ªæ›´å¥½çš„ DeepDreamï¼Œè¯¦è§<a href="https://github.com/tensorflow/docs/blob/master/site/en/tutorials/generative/deepdream.ipynb">è¿™ç¯‡ TensorFlow çš„å®˜æ–¹æ•™ç¨‹</a>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> Deep Learning with Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
            <tag> Deep Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonæ·±åº¦å­¦ä¹ ä¹‹LSTMæ–‡æœ¬ç”Ÿæˆ</title>
      <link href="/2020/08/20/DeepLearningWithPython/Deep-Learning%20with-Python-ch8_1/"/>
      <url>/2020/08/20/DeepLearningWithPython/Deep-Learning%20with-Python-ch8_1/</url>
      
        <content type="html"><![CDATA[<h1 id="Deep-Learning-with-Python"><a href="#Deep-Learning-with-Python" class="headerlink" title="Deep Learning with Python"></a>Deep Learning with Python</h1><p>è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘å­¦ä¹ ã€ŠDeep Learning with Pythonã€‹(ç¬¬äºŒç‰ˆï¼ŒFranÃ§ois Chollet è‘—) æ—¶å†™çš„ç³»åˆ—ç¬”è®°ä¹‹ä¸€ã€‚æ–‡ç« çš„å†…å®¹æ˜¯ä»  Jupyter notebooks è½¬æˆ Markdown çš„ï¼Œä½ å¯ä»¥å» <a href="https://github.com/cdfmlr/Deep-Learning-with-Python-Notebooks">GitHub</a> æˆ– <a href="https://gitee.com/cdfmlr/Deep-Learning-with-Python-Notebooks">Gitee</a> æ‰¾åˆ°åŸå§‹çš„ <code>.ipynb</code> ç¬”è®°æœ¬ã€‚</p><p>ä½ å¯ä»¥å»<a href="https://livebook.manning.com/book/deep-learning-with-python">è¿™ä¸ªç½‘ç«™åœ¨çº¿é˜…è¯»è¿™æœ¬ä¹¦çš„æ­£ç‰ˆåŸæ–‡</a>(è‹±æ–‡)ã€‚è¿™æœ¬ä¹¦çš„ä½œè€…ä¹Ÿç»™å‡ºäº†é…å¥—çš„ <a href="https://github.com/fchollet/deep-learning-with-python-notebooks">Jupyter notebooks</a>ã€‚</p><p>æœ¬æ–‡ä¸º <strong>ç¬¬8ç«   ç”Ÿæˆå¼æ·±åº¦å­¦ä¹ </strong> (Chapter 8. <em>Generative deep learning</em>) çš„ç¬”è®°ä¹‹ä¸€ã€‚</p><p>[TOC]</p><h2 id="8-1-Text-generation-with-LSTM"><a href="#8-1-Text-generation-with-LSTM" class="headerlink" title="8.1 Text generation with LSTM"></a>8.1 Text generation with LSTM</h2><blockquote><p>ä½¿ç”¨ LSTM ç”Ÿæˆæ–‡æœ¬</p></blockquote><p>ä»¥å‰æœ‰äººè¯´è¿‡ï¼šâ€œgenerating sequential data is the closest computers get to dreamingâ€ï¼Œè®©è®¡ç®—æœºç”Ÿæˆåºåˆ—æ˜¯å¾ˆæœ‰é­…åŠ›çš„äº‹æƒ…ã€‚æˆ‘ä»¬å°†ä»¥æ–‡æœ¬ç”Ÿæˆä¸ºä¾‹ï¼Œæ¢è®¨å¦‚ä½•å°†å¾ªç¯ç¥ç»ç½‘ç»œç”¨äºç”Ÿæˆåºåˆ—æ•°æ®ã€‚è¿™é¡¹æŠ€æœ¯ä¹Ÿå¯ä»¥ç”¨äºéŸ³ä¹çš„ç”Ÿæˆã€è¯­éŸ³åˆæˆã€èŠå¤©æœºå™¨äººå¯¹è¯ç”Ÿæˆã€ç”šè‡³æ˜¯ç”µå½±å‰§æœ¬çš„ç¼–å†™ç­‰ç­‰ã€‚</p><p>å…¶å®ï¼Œæˆ‘ä»¬ç°åœ¨ç†ŸçŸ¥çš„ LSTM ç®—æ³•ï¼Œæœ€æ—©è¢«å¼€å‘å‡ºæ¥çš„æ—¶å€™ï¼Œå°±æ˜¯ç”¨äºé€å­—ç¬¦åœ°ç”Ÿæˆæ–‡æœ¬çš„ã€‚</p><h3 id="åºåˆ—æ•°æ®çš„ç”Ÿæˆ"><a href="#åºåˆ—æ•°æ®çš„ç”Ÿæˆ" class="headerlink" title="åºåˆ—æ•°æ®çš„ç”Ÿæˆ"></a>åºåˆ—æ•°æ®çš„ç”Ÿæˆ</h3><p>ç”¨æ·±åº¦å­¦ä¹ ç”Ÿæˆåºåˆ—çš„é€šç”¨æ–¹æ³•ï¼Œå°±æ˜¯è®­ç»ƒä¸€ä¸ªç½‘ç»œ(ä¸€èˆ¬ç”¨ RNN æˆ– CNN)ï¼Œè¾“å…¥å‰é¢çš„ Tokenï¼Œé¢„æµ‹åºåˆ—ä¸­æ¥ä¸‹æ¥çš„ Tokenã€‚</p><p>è¯´çš„æœ¯è¯­åŒ–ä¸€äº›ï¼šç»™å®šå‰é¢çš„ Tokenï¼Œèƒ½å¤Ÿå¯¹ä¸‹ä¸€ä¸ª Token çš„æ¦‚ç‡è¿›è¡Œå»ºæ¨¡çš„ç½‘ç»œå«ä½œã€Œè¯­è¨€æ¨¡å‹(language model)ã€ã€‚è¯­è¨€æ¨¡å‹èƒ½å¤Ÿæ•æ‰åˆ°è¯­è¨€çš„ç»Ÿè®¡ç»“æ„ â€”â€”ã€Œæ½œåœ¨ç©ºé—´(latent space)ã€ã€‚è®­ç»ƒå¥½ä¸€ä¸ªè¯­è¨€æ¨¡å‹ï¼Œè¾“å…¥åˆå§‹æ–‡æœ¬å­—ç¬¦ä¸²ï¼ˆç§°ä¸ºã€Œæ¡ä»¶æ•°æ®ã€ï¼Œconditioning dataï¼‰ï¼Œä»è¯­è¨€æ¨¡å‹ä¸­é‡‡æ ·ï¼Œå°±å¯ä»¥ç”Ÿæˆæ–° Tokenï¼ŒæŠŠæ–°çš„ Token åŠ å…¥æ¡ä»¶æ•°æ®ä¸­ï¼Œå†æ¬¡è¾“å…¥ï¼Œé‡å¤è¿™ä¸ªè¿‡ç¨‹å°±å¯ä»¥ç”Ÿæˆå‡ºä»»æ„é•¿åº¦çš„åºåˆ—ã€‚</p><p>æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„ä¾‹å­å¼€å§‹ï¼šç”¨ä¸€ä¸ª LSTM å±‚ï¼Œè¾“å…¥æ–‡æœ¬è¯­æ–™çš„ N ä¸ªå­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œè®­ç»ƒæ¨¡å‹æ¥ç”Ÿæˆç¬¬ N+1 ä¸ªå­—ç¬¦ã€‚æ¨¡å‹çš„è¾“å‡ºæ˜¯åš softmaxï¼Œåœ¨æ‰€æœ‰å¯èƒ½çš„å­—ç¬¦ä¸Šï¼Œå¾—åˆ°ä¸‹ä¸€ä¸ªå­—ç¬¦çš„æ¦‚ç‡åˆ†å¸ƒã€‚è¿™ä¸ªæ¨¡å‹å«ä½œã€Œå­—ç¬¦çº§çš„ç¥ç»è¯­è¨€æ¨¡å‹ã€(character-level neural language model)ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghq58v9qd6j319c0ka41y.jpg" alt="ä½¿ç”¨è¯­è¨€æ¨¡å‹é€ä¸ªå­—ç¬¦ç”Ÿæˆæ–‡æœ¬çš„è¿‡ç¨‹"></p><h3 id="é‡‡æ ·ç­–ç•¥"><a href="#é‡‡æ ·ç­–ç•¥" class="headerlink" title="é‡‡æ ·ç­–ç•¥"></a>é‡‡æ ·ç­–ç•¥</h3><p>ä½¿ç”¨å­—ç¬¦çº§çš„ç¥ç»è¯­è¨€æ¨¡å‹ç”Ÿæˆæ–‡æœ¬æ—¶ï¼Œæœ€é‡è¦çš„é—®é¢˜æ˜¯å¦‚ä½•é€‰æ‹©ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚è¿™é‡Œæœ‰å‡ å¼ å¸¸ç”¨æ–¹æ³•ï¼š</p><ul><li>è´ªå©ªé‡‡æ ·(greedy sampling)ï¼šå§‹ç»ˆé€‰æ‹©å¯èƒ½æ€§æœ€å¤§çš„ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚è¿™ä¸ªæ–¹æ³•å¾ˆå¯èƒ½å¾—åˆ°é‡å¤çš„ã€å¯é¢„æµ‹çš„å­—ç¬¦ä¸²ï¼Œè€Œä¸”å¯èƒ½æ„æ€ä¸è¿è´¯ã€‚ï¼ˆè¾“å…¥æ³•è”æƒ³ï¼‰</li><li>çº¯éšæœºé‡‡æ ·ï¼šä»å‡åŒ€æ¦‚ç‡åˆ†å¸ƒä¸­æŠ½å–ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œå…¶ä¸­æ¯ä¸ªå­—ç¬¦çš„æ¦‚ç‡ç›¸åŒã€‚è¿™æ ·éšæœºæ€§å¤ªé«˜ï¼Œå‡ ä¹ä¸ä¼šç”Ÿæˆå‡ºæœ‰è¶£çš„å†…å®¹ã€‚ï¼ˆå°±æ˜¯èƒ¡ä¹±è¾“å‡ºå­—ç¬¦çš„ç»„åˆï¼‰</li><li>éšæœºé‡‡æ ·(stochastic sampling)ï¼šæ ¹æ®è¯­è¨€æ¨¡å‹çš„ç»“æœï¼Œå¦‚æœä¸‹ä¸€ä¸ªå­—ç¬¦æ˜¯ e çš„æ¦‚ç‡ä¸º 0.3ï¼Œé‚£ä¹ˆä½ ä¼šæœ‰ 30% çš„æ¦‚ç‡é€‰æ‹©å®ƒã€‚æœ‰ä¸€ç‚¹çš„éšæœºæ€§ï¼Œè®©ç”Ÿæˆçš„å†…å®¹æ›´<del>éšæ„</del>å¯Œæœ‰å˜åŒ–ï¼Œä½†åˆä¸æ˜¯å®Œå…¨éšæœºï¼Œè¾“å‡ºå¯ä»¥æ¯”è¾ƒæœ‰æ„æ€ã€‚</li></ul><p>éšæœºé‡‡æ ·çœ‹ä¸Šå»å¾ˆå¥½ï¼Œå¾ˆæœ‰åˆ›é€ æ€§ï¼Œä½†æœ‰ä¸ªé—®é¢˜æ˜¯æ— æ³•æ§åˆ¶éšæœºæ€§çš„å¤§å°ï¼šéšæœºæ€§è¶Šå¤§ï¼Œå¯èƒ½å¯Œæœ‰åˆ›é€ æ€§ï¼Œä½†å¯èƒ½èƒ¡ä¹±è¾“å‡ºï¼›éšæœºæ€§è¶Šå°ï¼Œå¯èƒ½æ›´æ¥è¿‘çœŸå®è¯å¥ï¼Œä½†å¤ªæ­»æ¿ã€å¯é¢„æµ‹ã€‚</p><p>ä¸ºäº†åœ¨é‡‡æ ·è¿‡ç¨‹ä¸­æ§åˆ¶éšæœºæ€§çš„å¤§å°ï¼Œå¼•å…¥ä¸€ä¸ªå‚æ•°ï¼šã€Œsoftmax æ¸©åº¦ã€(softmax temperature)ï¼Œç”¨äºè¡¨ç¤ºé‡‡æ ·æ¦‚ç‡åˆ†å¸ƒçš„ç†µï¼Œå³è¡¨ç¤ºæ‰€é€‰æ‹©çš„ä¸‹ä¸€ä¸ªå­—ç¬¦ä¼šæœ‰å¤šä¹ˆå‡ºäººæ„æ–™æˆ–å¤šä¹ˆå¯é¢„æµ‹ï¼š</p><ul><li>æ›´é«˜çš„æ¸©åº¦ï¼šç†µæ›´å¤§çš„é‡‡æ ·åˆ†å¸ƒï¼Œä¼šç”Ÿæˆæ›´åŠ å‡ºäººæ„æ–™ã€æ›´åŠ æ— ç»“æ„çš„æ•°æ®ï¼›</li><li>æ›´ä½çš„æ¸©åº¦ï¼šå¯¹åº”æ›´å°çš„éšæœºæ€§ï¼Œä¼šç”Ÿæˆæ›´åŠ å¯é¢„æµ‹çš„æ•°æ®ã€‚</li></ul><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghq692zm1nj316f0u0k9r.jpg" alt="å¯¹åŒä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒè¿›è¡Œä¸åŒçš„é‡æ–°åŠ æƒï¼šæ›´ä½çš„æ¸©åº¦=æ›´ç¡®å®šï¼Œæ›´é«˜çš„æ¸©åº¦=æ›´éšæœº"></p><p>å…·ä½“çš„å®ç°æ˜¯ï¼Œç»™å®š temperature å€¼ï¼Œå¯¹æ¨¡å‹çš„ softmax è¾“å‡ºé‡æ–°åŠ æƒï¼Œå¾—åˆ°æ–°çš„æ¦‚ç‡åˆ†å¸ƒï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rewight_distribution</span>(<span class="params">original_distributon, temperature=<span class="number">0.5</span></span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    å¯¹äºä¸åŒçš„ softmax æ¸©åº¦ï¼Œå¯¹æ¦‚ç‡åˆ†å¸ƒè¿›è¡Œé‡æ–°åŠ æƒ</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    distribution = np.log(original_distribution) / temperature</span><br><span class="line">    distribution = np.exp(distribution)</span><br><span class="line">    <span class="keyword">return</span> distribution / np.<span class="built_in">sum</span>(distribution)</span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦çº§-LSTM-æ–‡æœ¬ç”Ÿæˆå®ç°"><a href="#å­—ç¬¦çº§-LSTM-æ–‡æœ¬ç”Ÿæˆå®ç°" class="headerlink" title="å­—ç¬¦çº§ LSTM æ–‡æœ¬ç”Ÿæˆå®ç°"></a>å­—ç¬¦çº§ LSTM æ–‡æœ¬ç”Ÿæˆå®ç°</h3><p>ç†è®ºå°±ä¸Šé¢é‚£äº›äº†ï¼Œç°åœ¨ï¼Œæˆ‘ä»¬è¦ç”¨ Keras æ¥å®ç°å­—ç¬¦çº§çš„ LSTM æ–‡æœ¬ç”Ÿæˆäº†ã€‚</p><h4 id="æ•°æ®å‡†å¤‡"><a href="#æ•°æ®å‡†å¤‡" class="headerlink" title="æ•°æ®å‡†å¤‡"></a>æ•°æ®å‡†å¤‡</h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å¤§é‡çš„æ–‡æœ¬æ•°æ®(è¯­æ–™ï¼Œcorpus)æ¥è®­ç»ƒè¯­è¨€æ¨¡å‹ã€‚å¯ä»¥å»æ‰¾è¶³å¤Ÿå¤§çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡æœ¬æ–‡ä»¶ï¼šç»´åŸºç™¾ç§‘ã€å„ç§ä¹¦ç±ç­‰éƒ½å¯ã€‚è¿™é‡Œæˆ‘ä»¬é€‰æ‹©ç”¨ä¸€äº›å°¼é‡‡çš„ä½œå“ï¼ˆè‹±æ–‡è¯‘æœ¬ï¼‰ï¼Œè¿™æ ·æˆ‘ä»¬å­¦ä¹ å‡ºæ¥çš„è¯­è¨€æ¨¡å‹å°†æ˜¯æœ‰å°¼é‡‡çš„å†™ä½œé£æ ¼å’Œä¸»é¢˜çš„ã€‚ï¼ˆæ’ï¼šæˆ‘ï¼Œæˆ‘ä»¥å‰è‡ªå·±å†™é‡ç”Ÿæ¨¡å‹ç©ï¼Œéƒ½æ˜¯ç”¨é²è¿…ğŸ˜‚ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹è½½è¯­æ–™ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºå…¨å°å†™</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow <span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">path = keras.utils.get_file(</span><br><span class="line">    <span class="string">&#x27;nietzsche.txt&#x27;</span>, </span><br><span class="line">    origin=<span class="string">&#x27;https://s3.amazonaws.com/text-datasets/nietzsche.txt&#x27;</span>)</span><br><span class="line">text = <span class="built_in">open</span>(path).read().lower()</span><br><span class="line">print(<span class="string">&#x27;Corpus length:&#x27;</span>, <span class="built_in">len</span>(text))</span><br></pre></td></tr></table></figure><pre><code>/usr/local/Cellar/python/3.7.6_1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/importlib/_bootstrap.py:219: RuntimeWarning: numpy.ufunc size changed, may indicate binary incompatibility. Expected 192 from C header, got 216 from PyObject  return f(*args, **kwds)/usr/local/Cellar/python/3.7.6_1/Frameworks/Python.framework/Versions/3.7/lib/python3.7/importlib/_bootstrap.py:219: RuntimeWarning: numpy.ufunc size changed, may indicate binary incompatibility. Expected 192 from C header, got 216 from PyObject  return f(*args, **kwds)Downloading data from https://s3.amazonaws.com/text-datasets/nietzsche.txt606208/600901 [==============================] - 430s 709us/stepCorpus length: 600893</code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦æŠŠæ–‡æœ¬åšæˆæ•°æ® (å‘é‡åŒ–)ï¼šä» text é‡Œæå–é•¿åº¦ä¸º <code>maxlen</code> çš„åºåˆ—(åºåˆ—ä¹‹é—´å­˜åœ¨éƒ¨åˆ†é‡å )ï¼Œè¿›è¡Œ one-hot ç¼–ç ï¼Œç„¶åæ‰“åŒ…æˆ <code>(sequences, maxlen, unique_characters)</code> å½¢çŠ¶çš„ã€‚åŒæ—¶ï¼Œè¿˜éœ€è¦å‡†å¤‡æ•°ç»„ <code>y</code>ï¼ŒåŒ…å«å¯¹åº”çš„ç›®æ ‡ï¼Œå³åœ¨æ¯ä¸€ä¸ªæ‰€æå–çš„åºåˆ—ä¹‹åå‡ºç°çš„å­—ç¬¦(ä¹Ÿæ˜¯ one-hot ç¼–ç çš„)ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†å­—ç¬¦åºåˆ—å‘é‡åŒ–</span></span><br><span class="line"></span><br><span class="line">maxlen = <span class="number">60</span>     <span class="comment"># æ¯ä¸ªåºåˆ—çš„é•¿åº¦</span></span><br><span class="line">step = <span class="number">3</span>        <span class="comment"># æ¯ 3 ä¸ªå­—ç¬¦é‡‡æ ·ä¸€ä¸ªæ–°åºåˆ—</span></span><br><span class="line">sentences = []  <span class="comment"># ä¿å­˜æ‰€æå–çš„åºåˆ—</span></span><br><span class="line">next_chars = [] <span class="comment"># sentences çš„ä¸‹ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(text) - maxlen, step):</span><br><span class="line">    sentences.append(text[i: i+maxlen])</span><br><span class="line">    next_chars.append(text[i+maxlen])</span><br><span class="line">print(<span class="string">&#x27;Number of sequences:&#x27;</span>, <span class="built_in">len</span>(sentences))</span><br><span class="line"></span><br><span class="line">chars = <span class="built_in">sorted</span>(<span class="built_in">list</span>(<span class="built_in">set</span>(text)))</span><br><span class="line">char_indices = <span class="built_in">dict</span>((char, chars.index(char)) <span class="keyword">for</span> char <span class="keyword">in</span> chars)</span><br><span class="line"><span class="comment"># æ’ï¼šä¸Šé¢è¿™ä¸¤è¡Œä»£ç  6</span></span><br><span class="line">print(<span class="string">&#x27;Unique characters:&#x27;</span>, <span class="built_in">len</span>(chars))</span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;Vectorization...&#x27;</span>)</span><br><span class="line"></span><br><span class="line">x = np.zeros((<span class="built_in">len</span>(sentences), maxlen, <span class="built_in">len</span>(chars)), dtype=np.<span class="built_in">bool</span>)</span><br><span class="line">y = np.zeros((<span class="built_in">len</span>(sentences), <span class="built_in">len</span>(chars)), dtype=np.<span class="built_in">bool</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, sentence <span class="keyword">in</span> <span class="built_in">enumerate</span>(sentences):</span><br><span class="line">    <span class="keyword">for</span> t, char <span class="keyword">in</span> <span class="built_in">enumerate</span>(sentence):</span><br><span class="line">        x[i, t, char_indices[char]] = <span class="number">1</span></span><br><span class="line">    y[i, char_indices[next_chars[i]]] = <span class="number">1</span></span><br></pre></td></tr></table></figure><pre><code>Number of sequences: 200278Unique characters: 57Vectorization...</code></pre><h4 id="æ„å»ºç½‘ç»œ"><a href="#æ„å»ºç½‘ç»œ" class="headerlink" title="æ„å»ºç½‘ç»œ"></a>æ„å»ºç½‘ç»œ</h4><p>æˆ‘ä»¬è¦ç”¨åˆ°çš„ç½‘ç»œå…¶å®å¾ˆç®€å•ï¼Œä¸€ä¸ª LSTM å±‚ + ä¸€ä¸ª softmax æ¿€æ´»çš„ Dense å±‚å°±å¯ä»¥äº†ã€‚å…¶å®å¹¶ä¸ä¸€å®šè¦ç”¨ LSTMï¼Œç”¨ä¸€ç»´å·ç§¯å±‚ä¹Ÿæ˜¯å¯ä»¥ç”Ÿæˆåºåˆ—çš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”¨äºé¢„æµ‹ä¸‹ä¸€ä¸ªå­—ç¬¦çš„å•å±‚ LSTM æ¨¡å‹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> LSTM, Dense</span><br><span class="line"></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(LSTM(<span class="number">128</span>, input_shape=(maxlen, <span class="built_in">len</span>(chars))))</span><br><span class="line">model.add(Dense(<span class="built_in">len</span>(chars), activation=<span class="string">&#x27;softmax&#x27;</span>))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¨¡å‹ç¼–è¯‘é…ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> optimizers</span><br><span class="line"></span><br><span class="line">optimizer = optimizers.RMSprop(lr=<span class="number">0.01</span>)</span><br><span class="line">model.<span class="built_in">compile</span>(loss=<span class="string">&#x27;categorical_crossentropy&#x27;</span>,</span><br><span class="line">              optimizer=optimizer)</span><br></pre></td></tr></table></figure><h4 id="è®­ç»ƒè¯­è¨€æ¨¡å‹å¹¶ä»ä¸­é‡‡æ ·"><a href="#è®­ç»ƒè¯­è¨€æ¨¡å‹å¹¶ä»ä¸­é‡‡æ ·" class="headerlink" title="è®­ç»ƒè¯­è¨€æ¨¡å‹å¹¶ä»ä¸­é‡‡æ ·"></a>è®­ç»ƒè¯­è¨€æ¨¡å‹å¹¶ä»ä¸­é‡‡æ ·</h4><p>ç»™å®šä¸€ä¸ªè¯­è¨€æ¨¡å‹å’Œä¸€ä¸ªç§å­æ–‡æœ¬ç‰‡æ®µï¼Œå°±å¯ä»¥é€šè¿‡é‡å¤ä»¥ä¸‹æ“ä½œæ¥ç”Ÿæˆæ–°çš„æ–‡æœ¬ï¼š</p><ol><li>ç»™å®šç›®å‰å·²æœ‰æ–‡æœ¬ï¼Œä»æ¨¡å‹ä¸­å¾—åˆ°ä¸‹ä¸€ä¸ªå­—ç¬¦çš„æ¦‚ç‡åˆ†å¸ƒï¼›</li><li>æ ¹æ®æŸä¸ªæ¸©åº¦å¯¹åˆ†å¸ƒè¿›è¡Œé‡æ–°åŠ æƒï¼›</li><li>æ ¹æ®é‡æ–°åŠ æƒåçš„åˆ†å¸ƒå¯¹ä¸‹ä¸€ä¸ªå­—ç¬¦è¿›è¡Œéšæœºé‡‡æ ·ï¼›</li><li>å°†æ–°å­—ç¬¦æ·»åŠ åˆ°æ–‡æœ¬æœ«å°¾ã€‚</li></ol><p>åœ¨è®­ç»ƒæ¨¡å‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæŠŠã€Œé‡‡æ ·å‡½æ•°ã€å†™äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sample</span>(<span class="params">preds, temperature=<span class="number">1.0</span></span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    å¯¹æ¨¡å‹å¾—åˆ°çš„åŸå§‹æ¦‚ç‡åˆ†å¸ƒé‡æ–°åŠ æƒï¼Œå¹¶ä»ä¸­æŠ½å–ä¸€ä¸ªå­—ç¬¦ç´¢å¼•</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    preds = np.asarray(preds).astype(<span class="string">&#x27;float64&#x27;</span>)</span><br><span class="line">    preds = np.log(preds) / temperature</span><br><span class="line">    exp_preds = np.exp(preds)</span><br><span class="line">    preds = exp_preds / np.<span class="built_in">sum</span>(exp_preds)</span><br><span class="line">    probas = np.random.multinomial(<span class="number">1</span>, preds, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> np.argmax(probas)</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œå†æ¥è®­ç»ƒå¹¶ç”Ÿæˆæ–‡æœ¬ã€‚æˆ‘ä»¬åœ¨æ¯è½®å®Œæˆåéƒ½ä½¿ç”¨ä¸€ç³»åˆ—ä¸åŒçš„æ¸©åº¦å€¼æ¥ç”Ÿæˆæ–‡æœ¬ï¼Œè¿™æ ·å°±å¯ä»¥çœ‹åˆ°ï¼Œéšç€æ¨¡å‹æ”¶æ•›ï¼Œç”Ÿæˆçš„æ–‡æœ¬å¦‚ä½•å˜åŒ–ï¼Œä»¥åŠæ¸©åº¦å¯¹é‡‡æ ·ç­–ç•¥çš„å½±å“ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–‡æœ¬ç”Ÿæˆå¾ªç¯</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">60</span>):    <span class="comment"># è®­ç»ƒ 60 ä¸ªè½®æ¬¡</span></span><br><span class="line">    print(<span class="string">f&#x27;ğŸ‘‰\033[1;35m epoch <span class="subst">&#123;epoch&#125;</span> \033[0m&#x27;</span>)    <span class="comment"># print(&#x27;epoch&#x27;, epoch)</span></span><br><span class="line">    </span><br><span class="line">    model.fit(x, y,</span><br><span class="line">              batch_size=<span class="number">128</span>,</span><br><span class="line">              epochs=<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    start_index = random.randint(<span class="number">0</span>, <span class="built_in">len</span>(text) - maxlen - <span class="number">1</span>)</span><br><span class="line">    generated_text = text[start_index: start_index + maxlen]</span><br><span class="line">    print(<span class="string">f&#x27;  ğŸ“– Generating with seed: &quot;\033[1;32;43m<span class="subst">&#123;generated_text&#125;</span>\033[0m&quot;&#x27;</span>)    <span class="comment"># print(f&#x27; Generating with seed: &quot;&#123;generated_text&#125;&quot;&#x27;)</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> temperature <span class="keyword">in</span> [<span class="number">0.2</span>, <span class="number">0.5</span>, <span class="number">1.0</span>, <span class="number">1.2</span>]:</span><br><span class="line">        print(<span class="string">f&#x27;\n   \033[1;36m ğŸŒ¡ï¸ temperature: <span class="subst">&#123;temperature&#125;</span>\033[0m&#x27;</span>)    <span class="comment"># print(&#x27;\n  temperature:&#x27;, temperature)</span></span><br><span class="line">        print(generated_text, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">400</span>):    <span class="comment"># ç”Ÿæˆ 400 ä¸ªå­—ç¬¦</span></span><br><span class="line">            <span class="comment"># one-hot ç¼–ç ç›®å‰æœ‰çš„æ–‡æœ¬</span></span><br><span class="line">            sampled = np.zeros((<span class="number">1</span>, maxlen, <span class="built_in">len</span>(chars)))</span><br><span class="line">            <span class="keyword">for</span> t, char <span class="keyword">in</span> <span class="built_in">enumerate</span>(generated_text):</span><br><span class="line">                sampled[<span class="number">0</span>, t, char_indices[char]] = <span class="number">1</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># é¢„æµ‹ï¼Œé‡‡æ ·ï¼Œç”Ÿæˆä¸‹ä¸€å­—ç¬¦</span></span><br><span class="line">            preds = model.predict(sampled, verbose=<span class="number">0</span>)[<span class="number">0</span>]</span><br><span class="line">            next_index = sample(preds, temperature)</span><br><span class="line">            next_char = chars[next_index]</span><br><span class="line">            print(next_char, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            </span><br><span class="line">            generated_text = generated_text[<span class="number">1</span>:] + next_char</span><br><span class="line">            </span><br><span class="line">    print(<span class="string">&#x27;\n&#x27;</span> + <span class="string">&#x27;-&#x27;</span> * <span class="number">20</span>)</span><br></pre></td></tr></table></figure><pre><code>ğŸ‘‰ epoch 1 1565/1565 [==============================] - 170s 108ms/step - loss: 1.4089  ğŸ“– Generating with seed: &quot;ary!--will at least be entitled to demand in return thatpsy&quot;    ğŸŒ¡ï¸ temperature: 0.2ary!--will at least be entitled to demand in return thatpsychological senses of the the most comprehensed that is a sense of a perhaps the experience of the heart the present that the profound that the experience of the exploition and present that is a self and the present that is a more of the senses of a more and the sense of a more art and the the exploition and self-contempt of a perhaps the superiom and perhaps the contempt of the superiom and all th    ğŸŒ¡ï¸ temperature: 0.5superiom and perhaps the contempt of the superiom and all the instance and plays place of comprehensed and so in morals and all the auther to present mettoral of the senses and fellines to have the conceive that thepossibility of the expendeness, the hasters as how to really expendened andall that the forenies; and all the most consequently comes that the most constanter to constantering only all the expearated the expendeness is in the delight and one w    ğŸŒ¡ï¸ temperature: 1.0l the expearated the expendeness is in the delight and one would be persists more and world, others which in the utility of the fellowsamong and deceeth, virtuery, mode. onesoul the most conterrites and ly under that conservate to mapt of the own toweration here old taste inilt, the &quot;frew-wellto openhanss&quot;--and the way could easily hamint; becoming being, thrien himself, very deteruence who usked slaver and own scientification, of the eever,&quot; wandundou    ğŸŒ¡ï¸ temperature: 1.2ed slaver and own scientification, of the eever,&quot; wandundoupible &quot;befost suldeces.&quot; it weim even astreated drwadged,owing parits, word of hister&quot;enocest.-sychea, that that words in the savery: y allverowed&quot;, when and liqksis felling, them soperation of clentousand blendiers.the pleasrvation humiturring, likeford of feit-rum. i must &quot;nrightenmy,&quot; beneveral man.&quot; the goods-the cerses is christrantss and lightence--not man goemin love,frro-akem.y tix--------------------...ğŸ‘‰ epoch 30 1565/1565 [==============================] - 452s 289ms/step - loss: 1.2692  ğŸ“– Generating with seed: &quot;y system of morals, is that it is along constraint. in orde&quot;    ğŸŒ¡ï¸ temperature: 0.2y system of morals, is that it is along constraint. in order to be stronger and according to the same the standand, as a men and sanctity, and all the sense of the strength to the sense of the strong the striving of the strong the striving of the sense of the same this consequently and something and in a man with the sense of the sense of the same the strong of the same the sense of the strength to the sense of the same the artist the strong more and the     ğŸŒ¡ï¸ temperature: 0.5to the sense of the same the artist the strong more and the intellectually in the called bet of the more of such as something of standand, the experience and profound, and in the delusions of the morality of the propeted and the more of a good and one has a sorts of the constitute in the same the religionin the same the human condition, the old proper all this taste which seeming and the standand, and are to the person of the strength and the latten more     ğŸŒ¡ï¸ temperature: 1.0, and are to the person of the strength and the latten more matter, fith, niquet of nature of rove seemsion and proxible is itself, it has final &quot;genion&quot; in coptent,and un so larmor, romant.bicident, with which fur one remain echo ofcalled in this acqueis forceek of consciate convoled,asceticiliesinvaluable demardinatid.          he in respons himons, which, a engliches bad hope feels these see,fermines &quot;only he will&quot;n--as stapty pullens of bad a    ğŸŒ¡ï¸ temperature: 1.2se see,fermines &quot;only he will&quot;n--as stapty pullens of bad adaval inexcepning at the unvery in all, whose in--that is a power be many trainitg prtunce--by the crueled him is everynoble,as he society of thissneke viged, has to telless all juscallers. we megnant cominghik, as gray illow and of holy este, &quot;the knowing&quot; how videly upon the adventive. there is discived and it attine to jesubuc&#39;--the .=--whatliveda! iapower, profoundc: of himself, it is lie--------------------...ğŸ‘‰ epoch 59 1565/1565 [==============================] - 173s 110ms/step - loss: 1.2279  ğŸ“– Generating with seed: &quot;inward self-contempt, seek to get out ofthe business, no ma&quot;    ğŸŒ¡ï¸ temperature: 0.2inward self-contempt, seek to get out ofthe business, no may be only and the ascetiably sense of the real and the sense of the more sense of the community of the moral and profound the way there is the sense of the most contempt of the spirit in a perceive, and the interpreting the sense of the world as it is the soul is the artist of the sense and the world as in the entirecomplication of the world as it is the strong of the most profound to the world a    ğŸŒ¡ï¸ temperature: 0.5orld as it is the strong of the most profound to the world as the self nowadays to me that all the artifure in the mother of significance of the roman and we are this from the strength of existing and faith enthurable to the discover of the contrain toreligious were and self-grades the world with the way to the present think there are also all the plato-pit firels made a weart for the person of the rank on a way of the ethical prombates, to reason of the     ğŸŒ¡ï¸ temperature: 1.0he rank on a way of the ethical prombates, to reason of the mortand: that pureon good lack as has refree, in a herore proposition ispronouncethe last the reasonably book of will calued and vexeme, and no means mentary honour pertimate our new, conversations. it is thatthe sense ciertably with our distins of the remare of counter that german &quot;miswome centurially instinct&quot; in course,. hsyaulity he in their minds and matter of mystimalsing of itplupetin    ğŸŒ¡ï¸ temperature: 1.2y he in their minds and matter of mystimalsing of itplupeting.t his asserated approysely to special,are devial.; the finerevingsin orieicalous also mistakeng time, a :     thisbenurion andeuropean voightryands centuries: it problem as place into the errords for triubtly etsibints, vetter after distrinitionn, where it lacking sole .=-vow accorded.12u borany utmansishe and diffire being savest hiscardij(l qualition. neeked upon thisessentially, his --------------------</code></pre><p> åˆ©ç”¨æ›´å¤šçš„æ•°æ®è®­ç»ƒæ›´å¤§çš„æ¨¡å‹ï¼Œè®­ç»ƒæ—¶é—´æ›´é•¿ï¼Œç”Ÿæˆçš„æ ·æœ¬ä¼šæ›´è¿è´¯ã€æ›´çœŸå®ã€‚ä½†æ˜¯ï¼Œè¿™æ ·ç”Ÿæˆçš„æ–‡æœ¬å¹¶æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚æœºå™¨æ‰€åšçš„ä»…ä»…æ˜¯ä»ç»Ÿè®¡æ¨¡å‹ä¸­å¯¹æ•°æ®è¿›è¡Œé‡‡æ ·ï¼Œå®ƒå¹¶æ²¡æœ‰ç†è§£äººç±»çš„è¯­è¨€ï¼Œä¹Ÿä¸çŸ¥é“è‡ªå·±åœ¨è¯´ä»€ä¹ˆã€‚</p><h3 id="é™„ï¼šåŸºäºè¯åµŒå…¥çš„æ–‡æœ¬ç”Ÿæˆ"><a href="#é™„ï¼šåŸºäºè¯åµŒå…¥çš„æ–‡æœ¬ç”Ÿæˆ" class="headerlink" title="é™„ï¼šåŸºäºè¯åµŒå…¥çš„æ–‡æœ¬ç”Ÿæˆ"></a>é™„ï¼šåŸºäºè¯åµŒå…¥çš„æ–‡æœ¬ç”Ÿæˆ</h3><p>å¦‚æœè¦ç”Ÿæˆä¸­æ–‡æ–‡æœ¬ï¼Œæˆ‘ä»¬çš„æ±‰å­—å¤ªå¤šäº†ï¼Œé€å­—ç¬¦å»åšæˆ‘è®¤ä¸ºä¸æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚æ‰€ä»¥å¯ä»¥è€ƒè™‘åŸºäºè¯åµŒå…¥æ¥ç”Ÿæˆæ–‡æœ¬ã€‚åœ¨ä¹‹å‰çš„å­—ç¬¦çº§ LSTM æ–‡æœ¬ç”Ÿæˆçš„åŸºç¡€ä¸Šï¼Œå°†ç¼–ç /è§£ç æ–¹å¼ç¨ä½œä¿®æ”¹ã€æ·»åŠ  Embedding å±‚å³å¯å®ç°ä¸€ä¸ªåˆçº§çš„åŸºäºè¯åµŒå…¥çš„æ–‡æœ¬ç”Ÿæˆï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> optimizers</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> tensorflow <span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jieba    <span class="comment"># ä½¿ç”¨ jieba åšä¸­æ–‡åˆ†è¯</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">os.environ[<span class="string">&quot;TF_CPP_MIN_LOG_LEVEL&quot;</span>] = <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å…¥æ–‡æœ¬</span></span><br><span class="line"></span><br><span class="line">path = <span class="string">&#x27;~/Desktop/txt_zh_cn.txt&#x27;</span></span><br><span class="line">text = <span class="built_in">open</span>(path).read().lower()</span><br><span class="line">print(<span class="string">&#x27;Corpus length:&#x27;</span>, <span class="built_in">len</span>(text))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ–‡æœ¬åºåˆ—å‘é‡åŒ–</span></span><br><span class="line"></span><br><span class="line">maxlen = <span class="number">60</span>     <span class="comment"># æ¯ä¸ªåºåˆ—çš„é•¿åº¦</span></span><br><span class="line">step = <span class="number">3</span>        <span class="comment"># æ¯ 3 ä¸ª token é‡‡æ ·ä¸€ä¸ªæ–°åºåˆ—</span></span><br><span class="line">sentences = []  <span class="comment"># ä¿å­˜æ‰€æå–çš„åºåˆ—</span></span><br><span class="line">next_tokens = []  <span class="comment"># sentences çš„ä¸‹ä¸€ä¸ª token</span></span><br><span class="line"></span><br><span class="line">token_text = <span class="built_in">list</span>(jieba.cut(text))</span><br><span class="line"></span><br><span class="line">tokens = <span class="built_in">list</span>(<span class="built_in">set</span>(token_text))</span><br><span class="line">tokens_indices = &#123;token: tokens.index(token) <span class="keyword">for</span> token <span class="keyword">in</span> tokens&#125;</span><br><span class="line">print(<span class="string">&#x27;Number of tokens:&#x27;</span>, <span class="built_in">len</span>(tokens))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(token_text) - maxlen, step):</span><br><span class="line">    sentences.append(</span><br><span class="line">        <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> t: tokens_indices[t], token_text[i: i+maxlen])))</span><br><span class="line">    next_tokens.append(tokens_indices[token_text[i+maxlen]])</span><br><span class="line">print(<span class="string">&#x27;Number of sequences:&#x27;</span>, <span class="built_in">len</span>(sentences))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†ç›®æ ‡ one-hot ç¼–ç </span></span><br><span class="line">next_tokens_one_hot = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> next_tokens:</span><br><span class="line">    y = np.zeros((<span class="built_in">len</span>(tokens),), dtype=np.<span class="built_in">bool</span>)</span><br><span class="line">    y[i] = <span class="number">1</span></span><br><span class="line">    next_tokens_one_hot.append(y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åšæˆæ•°æ®é›†</span></span><br><span class="line">dataset = tf.data.Dataset.from_tensor_slices((sentences, next_tokens_one_hot))</span><br><span class="line">dataset = dataset.shuffle(buffer_size=<span class="number">4096</span>)</span><br><span class="line">dataset = dataset.batch(<span class="number">128</span>)</span><br><span class="line">dataset = dataset.prefetch(buffer_size=tf.data.experimental.AUTOTUNE)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºã€ç¼–è¯‘æ¨¡å‹</span></span><br><span class="line"></span><br><span class="line">model = models.Sequential([</span><br><span class="line">    layers.Embedding(<span class="built_in">len</span>(tokens), <span class="number">256</span>),</span><br><span class="line">    layers.LSTM(<span class="number">256</span>),</span><br><span class="line">    layers.Dense(<span class="built_in">len</span>(tokens), activation=<span class="string">&#x27;softmax&#x27;</span>)</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">optimizer = optimizers.RMSprop(lr=<span class="number">0.1</span>)</span><br><span class="line">model.<span class="built_in">compile</span>(loss=<span class="string">&#x27;categorical_crossentropy&#x27;</span>,</span><br><span class="line">              optimizer=optimizer)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡‡æ ·å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sample</span>(<span class="params">preds, temperature=<span class="number">1.0</span></span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    å¯¹æ¨¡å‹å¾—åˆ°çš„åŸå§‹æ¦‚ç‡åˆ†å¸ƒé‡æ–°åŠ æƒï¼Œå¹¶ä»ä¸­æŠ½å–ä¸€ä¸ª token ç´¢å¼•</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    preds = np.asarray(preds).astype(<span class="string">&#x27;float64&#x27;</span>)</span><br><span class="line">    preds = np.log(preds) / temperature</span><br><span class="line">    exp_preds = np.exp(preds)</span><br><span class="line">    preds = exp_preds / np.<span class="built_in">sum</span>(exp_preds)</span><br><span class="line">    probas = np.random.multinomial(<span class="number">1</span>, preds, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> np.argmax(probas)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®­ç»ƒæ¨¡å‹</span></span><br><span class="line"></span><br><span class="line">callbacks_list = [</span><br><span class="line">    keras.callbacks.ModelCheckpoint(  <span class="comment"># åœ¨æ¯è½®å®Œæˆåä¿å­˜æƒé‡</span></span><br><span class="line">        filepath=<span class="string">&#x27;text_gen.h5&#x27;</span>,</span><br><span class="line">        monitor=<span class="string">&#x27;loss&#x27;</span>,</span><br><span class="line">        save_best_only=<span class="literal">True</span>,</span><br><span class="line">    ),</span><br><span class="line">    keras.callbacks.ReduceLROnPlateau(  <span class="comment"># ä¸å†æ”¹å–„æ—¶é™ä½å­¦ä¹ ç‡</span></span><br><span class="line">        monitor=<span class="string">&#x27;loss&#x27;</span>,</span><br><span class="line">        factor=<span class="number">0.5</span>,</span><br><span class="line">        patience=<span class="number">1</span>,</span><br><span class="line">    ),</span><br><span class="line">    keras.callbacks.EarlyStopping(  <span class="comment"># ä¸å†æ”¹å–„æ—¶ä¸­æ–­è®­ç»ƒ</span></span><br><span class="line">        monitor=<span class="string">&#x27;loss&#x27;</span>,</span><br><span class="line">        patience=<span class="number">3</span>,</span><br><span class="line">    ),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">model.fit(dataset, epochs=<span class="number">30</span>, callbacks=callbacks_list)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–‡æœ¬ç”Ÿæˆ</span></span><br><span class="line"></span><br><span class="line">start_index = random.randint(<span class="number">0</span>, <span class="built_in">len</span>(text) - maxlen - <span class="number">1</span>)</span><br><span class="line">generated_text = text[start_index: start_index + maxlen]</span><br><span class="line">print(<span class="string">f&#x27; ğŸ“– Generating with seed: &quot;<span class="subst">&#123;generated_text&#125;</span>&quot;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> temperature <span class="keyword">in</span> [<span class="number">0.2</span>, <span class="number">0.5</span>, <span class="number">1.0</span>, <span class="number">1.2</span>]:</span><br><span class="line">    print(<span class="string">&#x27;\n  ğŸŒ¡ï¸ temperature:&#x27;</span>, temperature)</span><br><span class="line">    print(generated_text, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):    <span class="comment"># ç”Ÿæˆ 100 ä¸ª token</span></span><br><span class="line">        <span class="comment"># ç¼–ç å½“å‰æ–‡æœ¬</span></span><br><span class="line">        text_cut = jieba.cut(generated_text)</span><br><span class="line">        sampled = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> text_cut:</span><br><span class="line">            <span class="keyword">if</span> i <span class="keyword">in</span> tokens_indices:</span><br><span class="line">                sampled.append(tokens_indices[i])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                sampled.append(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># é¢„æµ‹ï¼Œé‡‡æ ·ï¼Œç”Ÿæˆä¸‹ä¸€ä¸ª token</span></span><br><span class="line">        preds = model.predict(sampled, verbose=<span class="number">0</span>)[<span class="number">0</span>]</span><br><span class="line">        next_index = sample(preds, temperature)</span><br><span class="line">        next_token = tokens[next_index]</span><br><span class="line">        print(next_token, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        generated_text = generated_text[<span class="number">1</span>:] + next_token</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æˆ‘ç”¨ä¸€äº›é²è¿…çš„æ–‡ç« å»è®­ç»ƒï¼Œå¾—åˆ°çš„ç»“æœå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p><blockquote><p>å¿˜å´ä¸€æ ·ï¼Œä½³ä½œæœ‰äº›è¿™å°±â€¦â€¦åœ¨æœªåº„ä¸€é˜µï¼Œä½†æ¸¸è¡—æ­£æ˜¯å€’ä¸å¦‚æ˜¯å‡ å¹´æ”»å‡»ç½¢ä¸€å †å»å†çš„æ˜¯æœ‰æ€•å°±å‡†çš„è¯æ˜¯æœªåº„æŒ‡ä¹Ÿæ·»æœªåº„ä¸æœ½å¤§å®¶ï¼™è½¬ï¼•ï¼Œå…¬å…±æœªåº„ä»–çš„ä»–äº†è™½ç„¶è¿˜æˆäº†ï¼Œä½†è±†ç§ä»–å¥³äººæ˜¯æœªåº„å¾ˆçš„çªœçš„å¯»ä¹Ÿçš„å¹¶æˆ‘â€”æ°´ç”Ÿæ˜¯ä½†æ”¶æ­£æ˜¯æœ¬ä½†å¤ªçˆ·ä¸¤ä¸ªè¦äº”æ˜¯å‡ ä¹å¤ªçˆ·ç»ˆäºç¡¬è¾«å­</p></blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™äº›å¥å­éƒ½è¯´ä¸é€šï¼Œçœ‹ç€å¾ˆéš¾å—ã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜å¯ä»¥æŠŠåˆ† token çš„æ–¹æ³•æ”¹ä¸€æ”¹ï¼Œä¸æ˜¯åˆ†è¯ï¼Œè€Œæ˜¯å»åˆ†å¥å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">text = text.replace(<span class="string">&#x27;ï¼Œ&#x27;</span>, <span class="string">&#x27; ï¼Œ&#x27;</span>).replace(<span class="string">&#x27;ã€‚&#x27;</span>, <span class="string">&#x27; ã€‚&#x27;</span>).replace(<span class="string">&#x27;ï¼Ÿ&#x27;</span>, <span class="string">&#x27; ï¼Ÿ&#x27;</span>).replace(<span class="string">&#x27;ï¼š&#x27;</span>, <span class="string">&#x27; ï¼š&#x27;</span>)</span><br><span class="line">token_text = tf.keras.preprocessing.text.text_to_word_sequence(text, split=<span class="string">&#x27; &#x27;</span>)</span><br></pre></td></tr></table></figure><p>å…¶ä»–çš„åœ°æ–¹åŸºæœ¬ä¸å˜ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥å¾—åˆ°æ¯”è¾ƒæœ‰æ„æ€çš„æ–‡æœ¬ã€‚æ¯”å¦‚è¿™æ˜¯æˆ‘ç”¨ä¸€äº›ä½™ç§‹é›¨çš„æ–‡ç« å»è®­ç»ƒçš„ç»“æœï¼š</p><blockquote><p>å‡ ä¸ªçŸ­è¡£äººç‰©ä¹Ÿå’Œä»–åŒååœ¨ä¸€å¤„è¿™è½¦ç«‹åˆ»èµ°åŠ¨äº†ï¼Œè´å£³å¤©æ°”è¿˜æ—©ï¼ŒèµŠäº†ä¸¤ç¢—é…’æ²¡æœ‰åƒè¿‡äººçš„å­©å­ï¼Œç±³è¦é’±ä¹°è¿™ä¸€ç‚¹ç²—æµ…äº‹æƒ…éƒ½ä¸çŸ¥é“â€¦â€¦å¤©æ°”è¿˜æ—©ä¸å¦¨äº‹ä¹ˆä»–â€¦â€¦å…¨å±‹å­éƒ½å¾ˆé™è¿™æ—¶çº¢é¼»å­è€æ‹±çš„å°æ›²ï¼Œè€Œä¸”åˆç ´è´¹äº†äºŒååƒçš„èµé’±ï¼Œä»–ä¸€å®šé¡»åœ¨å¤œé‡Œçš„åäºŒç‚¹é’Ÿæ‰å›å®¶ã€‚</p></blockquote><hr><p>By(â€œCDFMLRâ€, â€œ2020-08-20â€);</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> Deep Learning with Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
            <tag> Deep Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonæ·±åº¦å­¦ä¹ ä¹‹æ¨¡å‹ä¼˜åŒ–</title>
      <link href="/2020/08/19/DeepLearningWithPython/Deep-Learning%20with-Python-ch7_3/"/>
      <url>/2020/08/19/DeepLearningWithPython/Deep-Learning%20with-Python-ch7_3/</url>
      
        <content type="html"><![CDATA[<h1 id="Deep-Learning-with-Python"><a href="#Deep-Learning-with-Python" class="headerlink" title="Deep Learning with Python"></a>Deep Learning with Python</h1><p>è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘å­¦ä¹ ã€ŠDeep Learning with Pythonã€‹(ç¬¬äºŒç‰ˆï¼ŒFranÃ§ois Chollet è‘—) æ—¶å†™çš„ç³»åˆ—ç¬”è®°ä¹‹ä¸€ã€‚æ–‡ç« çš„å†…å®¹æ˜¯ä»  Jupyter notebooks è½¬æˆ Markdown çš„ï¼Œä½ å¯ä»¥å» <a href="https://github.com/cdfmlr/Deep-Learning-with-Python-Notebooks">GitHub</a> æˆ– <a href="https://gitee.com/cdfmlr/Deep-Learning-with-Python-Notebooks">Gitee</a> æ‰¾åˆ°åŸå§‹çš„ <code>.ipynb</code> ç¬”è®°æœ¬ã€‚</p><p>ä½ å¯ä»¥å»<a href="https://livebook.manning.com/book/deep-learning-with-python">è¿™ä¸ªç½‘ç«™åœ¨çº¿é˜…è¯»è¿™æœ¬ä¹¦çš„æ­£ç‰ˆåŸæ–‡</a>(è‹±æ–‡)ã€‚è¿™æœ¬ä¹¦çš„ä½œè€…ä¹Ÿç»™å‡ºäº†é…å¥—çš„ <a href="https://github.com/fchollet/deep-learning-with-python-notebooks">Jupyter notebooks</a>ã€‚</p><p>æœ¬æ–‡ä¸º <strong>ç¬¬7ç«   é«˜çº§çš„æ·±åº¦å­¦ä¹ æœ€ä½³å®è·µ</strong> (Chapter 7. <em>Advanced deep-learning best practices</em>) çš„ç¬”è®°ä¹‹ä¸€ã€‚</p><p>[TOC]</p><h2 id="7-3-Getting-the-most-out-of-your-models"><a href="#7-3-Getting-the-most-out-of-your-models" class="headerlink" title="7.3 Getting the most out of your models"></a>7.3 Getting the most out of your models</h2><blockquote><p>è®©æ¨¡å‹æ€§èƒ½å‘æŒ¥åˆ°æè‡´</p></blockquote><p>å¦‚æœä½ åªæ˜¯æƒ³æå‡ºä¸ªè¿˜ä¸é”™çš„æ¨¡å‹ï¼Œæ— è„‘éšä¾¿å°è¯•å„ç§ç½‘ç»œæ¶æ„åŸºæœ¬å°±å¯ä»¥äº†ã€‚ä½†å¦‚æœä½ è¦å¼€å‘å‡ºæ€§èƒ½å“è¶Šã€åšåˆ°æè‡´çš„æ¨¡å‹ï¼Œä½ å°±éœ€è¦è€ƒè™‘ä¸€ä¸‹åæ–‡ç»™å‡ºçš„æŠ€å·§ã€‚</p><h3 id="é«˜çº§æ¶æ„æ¨¡å¼"><a href="#é«˜çº§æ¶æ„æ¨¡å¼" class="headerlink" title="é«˜çº§æ¶æ„æ¨¡å¼"></a>é«˜çº§æ¶æ„æ¨¡å¼</h3><p>æƒ³è¦æ„æ¶å“è¶Šçš„æ¨¡å‹ï¼Œä½ åº”è¯¥è®¤è¯†ã€Œæ®‹å·®è¿æ¥ã€ã€ã€Œæ ‡å‡†åŒ–ã€å’Œã€Œæ·±åº¦å¯åˆ†ç¦»å·ç§¯ã€è¿™å‡ ä¸ªå¸¸ç”¨çš„â€œè®¾è®¡æ¨¡å¼â€ã€‚</p><h4 id="æ®‹å·®è¿æ¥"><a href="#æ®‹å·®è¿æ¥" class="headerlink" title="æ®‹å·®è¿æ¥"></a>æ®‹å·®è¿æ¥</h4><blockquote><p>æ³¨ï¼šè¿™ä¸€æ®µæ˜¯åœ¨ 7.1 é‡Œå†™çš„ï¼Œè¿™é‡Œåªæ˜¯å¤åˆ¶è¿‡æ¥è®©è¿™ä¸€éƒ¨åˆ†æ›´åŠ å®Œæ•´ã€‚</p></blockquote><p>æ®‹å·®è¿æ¥(residual connection) æ˜¯ä¸€ç§ç°åœ¨å¾ˆå¸¸ç”¨çš„ç»„ä»¶ï¼Œå®ƒè§£å†³äº†å¤§è§„æ¨¡æ·±åº¦å­¦ä¹ æ¨¡å‹æ¢¯åº¦æ¶ˆå¤±å’Œè¡¨ç¤ºç“¶é¢ˆé—®é¢˜ã€‚é€šå¸¸ï¼Œå‘ä»»ä½•å¤šäº 10 å±‚çš„æ¨¡å‹ä¸­æ·»åŠ æ®‹å·®è¿æ¥ï¼Œéƒ½å¯èƒ½ä¼šæœ‰æ‰€å¸®åŠ©ã€‚</p><ul><li>æ¢¯åº¦æ¶ˆå¤±ï¼šå°±æ˜¯ç»è¿‡çš„å±‚å¤šäº†ï¼Œä¹‹å‰å­¦åˆ°çš„è¡¨ç¤ºå˜å¾—æ¨¡ç³Šï¼Œç”šè‡³å®Œå…¨ä¸¢å¤±ï¼Œå¯¼è‡´ç½‘ç»œæ— æ³•è®­ç»ƒã€‚</li><li>è¡¨ç¤ºç“¶é¢ˆï¼šå †å èµ·æ¥å±‚ï¼Œåä¸€å±‚åªèƒ½è®¿é—®åˆ°å‰ä¸€å±‚å­¦åˆ°çš„ä¸œè¥¿ã€‚å¦‚æœæŸä¸€å±‚å¤ªå°ï¼ˆæ¿€æ´»ä¸­èƒ½å¤Ÿå¡å…¥çš„ä¿¡æ¯å°‘ï¼‰å°±æŠŠä¿¡æ¯å¡ä¸‹æ¥ï¼Œå‡ºç°ç“¶é¢ˆäº†ã€‚</li></ul><p>æ®‹å·®è¿æ¥æ˜¯è®©å‰é¢æŸå±‚çš„è¾“å‡ºä½œä¸ºåé¢æŸå±‚çš„è¾“å…¥ï¼ˆåœ¨ç½‘ç»œä¸­åˆ›é€ æ·å¾„ï¼‰ã€‚å‰é¢å±‚çš„è¾“å‡ºå¹¶æ²¡æœ‰ä¸åé¢å±‚çš„æ¿€æ´»è¿æ¥åœ¨ä¸€èµ·ï¼Œè€Œæ˜¯ä¸åé¢å±‚çš„æ¿€æ´»ç›¸åŠ ï¼ˆè‹¥å½¢çŠ¶ä¸åŒï¼Œç”¨çº¿æ€§å˜æ¢å°†å‰é¢å±‚çš„æ¿€æ´»æ”¹å˜æˆç›®æ ‡å½¢çŠ¶ï¼‰ã€‚</p><blockquote><p>æ³¨ï¼šçº¿æ€§å˜æ¢å¯ä»¥ç”¨ä¸å¸¦æ¿€æ´»çš„ Dense å±‚ï¼Œæˆ–ç€åœ¨ CNN ä¸­ç”¨ä¸å¸¦æ¿€æ´» 1Ã—1 å·ç§¯ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> keras <span class="keyword">import</span> layers</span><br><span class="line"></span><br><span class="line">x = ...</span><br><span class="line"></span><br><span class="line">y = layers.Conv2D(<span class="number">128</span>, <span class="number">3</span>, activation=<span class="string">&#x27;relu&#x27;</span>, padding=<span class="string">&#x27;same&#x27;</span>)(x)</span><br><span class="line">y = layers.Conv2D(<span class="number">128</span>, <span class="number">3</span>, activation=<span class="string">&#x27;relu&#x27;</span>, padding=<span class="string">&#x27;same&#x27;</span>)(y)</span><br><span class="line">y = layers.MaxPooling2D(<span class="number">2</span>, strides=<span class="number">2</span>)(y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å½¢çŠ¶ä¸åŒï¼Œè¦åšçº¿æ€§å˜æ¢ï¼š</span></span><br><span class="line">residual = layers.Conv2D(<span class="number">128</span>, <span class="number">1</span>, strides=<span class="number">2</span>, padding=<span class="string">&#x27;same&#x27;</span>)(x)  <span class="comment"># ä½¿ç”¨ 1Ã—1 å·ç§¯ï¼Œå°† x çº¿æ€§ä¸‹é‡‡æ ·ä¸ºä¸ y å…·æœ‰ç›¸åŒçš„å½¢çŠ¶</span></span><br><span class="line"></span><br><span class="line">y = layers.add([y, residual])</span><br></pre></td></tr></table></figure><h4 id="æ ‡å‡†åŒ–"><a href="#æ ‡å‡†åŒ–" class="headerlink" title="æ ‡å‡†åŒ–"></a>æ ‡å‡†åŒ–</h4><p>æ ‡å‡†åŒ–(normalization)ï¼Œç”¨äºè®©æ¨¡å‹çœ‹åˆ°çš„ä¸åŒæ ·æœ¬å½¼æ­¤ä¹‹é—´æ›´åŠ ç›¸ä¼¼ï¼Œæœ‰åŠ©äºæ¨¡å‹çš„ä¼˜åŒ–å’Œæ³›åŒ–ã€‚</p><p>æœ€å¸¸è§çš„æ•°æ®æ ‡å‡†åŒ–ï¼Œå°±æ˜¯ä½¿æ•°æ®å‡å€¼ä¸º 0ã€æ–¹å·®ä¸º 1ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">normalized_data = (data - np.mean(data, axis=...)) / np.std(data, axis=...)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éƒ½çŸ¥é“åœ¨å°†æ•°æ®è¾“å…¥æ¨¡å‹ä¹‹å‰å¯¹æ•°æ®åšæ ‡å‡†åŒ–ã€‚ä½†åœ¨ç½‘ç»œçš„æ¯ä¸€æ¬¡å˜æ¢ä¹‹åï¼Œæˆ‘ä»¬ä¹Ÿåº”è¯¥è€ƒè™‘æ•°æ®æ ‡å‡†åŒ–ã€‚æ¯ä¸€å±‚è¾“å‡ºä¹‹åï¼Œå¯èƒ½ä¹‹å‰çš„æ ‡å‡†åŒ–å°±è¢«ç ´åäº†ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘è¿™ä¸ªé—®é¢˜ã€‚</p><p><strong>æ‰¹æ ‡å‡†åŒ–</strong>(batch normalization)å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ç§æ–¹æ³•ï¼šè®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œå®ƒä¼šåœ¨å†…éƒ¨ä¿å­˜å·²è¯»å–æ¯æ‰¹æ•°æ®å‡å€¼å’Œæ–¹å·®çš„æŒ‡æ•°ç§»åŠ¨å¹³å‡å€¼ã€‚å› æ­¤ï¼Œè®­ç»ƒè¿‡ç¨‹ä¸­å‡å€¼å’Œæ–¹å·®éšæ—¶é—´å‘ç”Ÿå˜åŒ–ï¼Œæ‰¹æ ‡å‡†åŒ–ä¹Ÿå¯ä»¥é€‚åº”æ€§åœ°å°†æ•°æ®æ ‡å‡†åŒ–ã€‚è¿™ä¸ªæ–¹æ³•æœ‰åŠ©äºæ¢¯åº¦ä¼ æ’­ï¼Œå…è®¸æ›´æ·±çš„ç½‘ç»œï¼ˆç±»ä¼¼äºæ®‹å·®è¿æ¥ï¼‰ã€‚</p><p>Keras ä¸­æ‰¹æ ‡å‡†åŒ–ç”¨ <code>BatchNormalization</code> å±‚å®ç°ï¼Œé€šå¸¸åœ¨å·ç§¯å±‚æˆ–å¯†é›†è¿æ¥å±‚ä¹‹åä½¿ç”¨:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Conv</span></span><br><span class="line">conv_model.add(layers.Conv2D(<span class="number">32</span>, <span class="number">3</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">conv_model.add(layers.BatchNormalization())</span><br><span class="line"></span><br><span class="line"><span class="comment"># Dense</span></span><br><span class="line">dense_model.add(layers.Dense(<span class="number">32</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">dense_model.add(layers.BatchNormalization())</span><br></pre></td></tr></table></figure><p>BatchNormalization å±‚æ¥æ”¶ä¸€ä¸ª axis å‚æ•°ï¼Œå®ƒæŒ‡å®šåº”è¯¥å¯¹å“ªä¸ªç‰¹å¾è½´åšæ ‡å‡†åŒ–ï¼Œé»˜è®¤å€¼æ˜¯ -1ã€‚å¯¹äº Keras é»˜è®¤çš„ Denseã€Conv1Dã€RNN å’Œ Conv2D è¿™ä¸ªéƒ½æ˜¯å¯¹çš„ã€‚ä½†å¯¹äº <code>data_format</code> è®¾ä¸º <code>&quot;channels_first&quot;</code> çš„ Conv2Dï¼Œç‰¹å¾è½´æ˜¯ 1ï¼Œæ‰€ä»¥éœ€è¦è®¾ç½® <code>axis=1</code>ã€‚</p><h4 id="æ·±åº¦å¯åˆ†ç¦»å·ç§¯"><a href="#æ·±åº¦å¯åˆ†ç¦»å·ç§¯" class="headerlink" title="æ·±åº¦å¯åˆ†ç¦»å·ç§¯"></a>æ·±åº¦å¯åˆ†ç¦»å·ç§¯</h4><p>æ·±åº¦å¯åˆ†ç¦»å·ç§¯å±‚(depthwise separable convolution)ï¼Œåœ¨ Keras ä¸­å«å†™ä½œ <code>SeparableConv2D</code>ï¼Œä½œç”¨å’Œæ™®é€šçš„ Conv2D æ˜¯ä¸€æ ·çš„ã€‚ä½† SeparableConv2D æ¯” Conv2D æ›´è½»é‡ã€è®­ç»ƒæ›´å¿«ã€ç²¾åº¦æ›´é«˜ã€‚</p><p>SeparableConv2D å±‚å¯¹è¾“å…¥çš„æ¯ä¸ªé€šé“åˆ†åˆ«æ‰§è¡Œç©ºé—´å·ç§¯ï¼Œç„¶åé€šè¿‡é€ç‚¹å·ç§¯(1Ã—1 å·ç§¯)æ•´åˆè¾“å‡ºç»“æœã€‚è¿™ä¹ˆåšå°±å°†ç©ºé—´ç‰¹å¾å­¦ä¹ å’Œé€šé“ç‰¹å¾å­¦ä¹ åˆ†å¼€äº†ï¼Œå¾€å¾€èƒ½å¤Ÿä½¿ç”¨æ›´å°‘çš„æ•°æ®å­¦åˆ°æ›´å¥½çš„è¡¨ç¤ºã€‚ï¼ˆè¿™å’Œä»¥å‰æè¿‡çš„ Xception æ¨¡å‹å¾ˆç±»ä¼¼ã€‚äº‹å®ä¸Šï¼Œæ·±åº¦å¯åˆ†ç¦»å·ç§¯æ˜¯ Xception æ¶æ„çš„åŸºç¡€ï¼‰</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghpi4ytqqvj318a0koadm.jpg" alt="æ·±åº¦å¯åˆ†ç¦»å·ç§¯: æ·±åº¦å·ç§¯ + é€ç‚¹å·ç§¯"></p><p>å¯¹äºæ•°æ®æ¯”è¾ƒå°‘çš„æ•°æ®ï¼Œä»å¤´å¼€å§‹è®­ç»ƒçš„ç”»ï¼Œè¿™ä¸ªä¸œè¥¿å¾ˆæœ‰ç”¨ï¼Œä¾‹å¦‚ä¸‹é¢æ˜¯ä¸ªå›¾åƒåˆ†ç±»ä»»åŠ¡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Sequential, Model</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"></span><br><span class="line">height = <span class="number">64</span></span><br><span class="line">width = <span class="number">64</span></span><br><span class="line">channels = <span class="number">3</span></span><br><span class="line">num_classes = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(layers.SeparableConv2D(<span class="number">32</span>, <span class="number">3</span>, </span><br><span class="line">                                 activation=<span class="string">&#x27;relu&#x27;</span>, </span><br><span class="line">                                 input_shape=(height, width, channels,)))</span><br><span class="line">model.add(layers.SeparableConv2D(<span class="number">64</span>, <span class="number">3</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.MaxPooling2D(<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">model.add(layers.SeparableConv2D(<span class="number">64</span>, <span class="number">3</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.SeparableConv2D(<span class="number">128</span>, <span class="number">3</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.MaxPooling2D(<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">model.add(layers.SeparableConv2D(<span class="number">64</span>, <span class="number">3</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.SeparableConv2D(<span class="number">128</span>, <span class="number">3</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.GlobalAveragePooling2D())</span><br><span class="line"></span><br><span class="line">model.add(layers.Dense(<span class="number">32</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.Dense(num_classes, activation=<span class="string">&#x27;softmax&#x27;</span>))</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>, loss=<span class="string">&#x27;categorical_crossentropy&#x27;</span>)</span><br></pre></td></tr></table></figure><p>å¯¹äºæ›´å¤§å‹çš„ä»»åŠ¡æ—¶ï¼Œä¸Š Xception å°±æ›´å¥½äº†ã€‚</p><h3 id="è¶…å‚æ•°ä¼˜åŒ–"><a href="#è¶…å‚æ•°ä¼˜åŒ–" class="headerlink" title="è¶…å‚æ•°ä¼˜åŒ–"></a>è¶…å‚æ•°ä¼˜åŒ–</h3><p>é™¤äº†ä½¿ç”¨é«˜çº§æ¶æ„æ¨¡å¼ï¼Œè¶…å‚æ•°ä¼˜åŒ–ä¹Ÿæ˜¯ä¸ªå€¼å¾—ä¸€æçš„å·¥ä½œã€‚æˆ‘ä»¬å†™æ¨¡å‹çš„æ—¶å€™éœ€è¦å†³å®šå¾ˆå¤šè¶…å‚æ•°ï¼š</p><p>æ¨¡å‹ä¸­å †å å¤šå°‘å±‚ï¼Œæ¯å±‚åŒ…å«å¤šå°‘ä¸ªå•å…ƒï¼Œç”¨ä»€ä¹ˆæ¿€æ´»å‡½æ•°â€¦â€¦</p><p>è°ƒèŠ‚è¿™äº›è¶…å‚æ•°å¹¶æ²¡æœ‰å›ºå®šçš„è§„åˆ™ï¼Œä¸»è¦æ˜¯é ç›´è§‰å’Œåå¤å®éªŒã€‚è¿™ç§åå¤å®éªŒï¼Œå¯èƒ½æ€§å¤ªå¤šï¼Œå„ç§è¶…å‚æ•°çš„ç»„åˆï¼Œå¤ªå¤æ‚äº†ã€‚ä¸€å¤©åˆ°æ™šè°ƒè¶…å‚æ•°å°±ä¸æ˜¯äººå¹²çš„äº‹ï¼Œè¿™ç§äº‹æƒ…è¿˜æ˜¯ç»™æœºå™¨è‡ªå·±å»åšæ¯”è¾ƒå¥½ã€‚æ‰€ä»¥æˆ‘ä»¬è¦æŒ‡å®šä¸€ä¸ªå¯ä»¥ç¨‹åºåŒ–çš„è¶…å‚æ•°è°ƒèŠ‚æµç¨‹ï¼š</p><ol><li>é€‰æ‹©ä¸€ç»„è¶…å‚æ•°</li><li>æ„å»ºç›¸åº”çš„æ¨¡å‹</li><li>å°†æ¨¡å‹åœ¨å°æ‰¹é‡æ•°æ®ä¸Šæ‹Ÿåˆã€éªŒè¯æ€§èƒ½</li><li>é€‰æ‹©è¦å°è¯•çš„ä¸‹ä¸€ç»„è¶…å‚æ•°</li><li>é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼ˆ2ï½4ï¼‰</li><li>é€‰å‡ºä¸Šé¢å®éªŒä¸­çš„æœ€ä½³è¶…å‚æ•°</li></ol><p>è¿™ä¸ªè¿‡ç¨‹çš„å…³é”®åœ¨äºï¼Œç»™å®šå¤šç»„å¯é€‰çš„è¶…å‚æ•°ï¼Œåˆ©ç”¨ã€Œå†å²éªŒè¯æ€§èƒ½ã€æ¥è‡ªåŠ¨é€‰æ‹©ä¸‹ä¸€ç»„éœ€è¦è¯„ä¼°çš„è¶…å‚æ•°ã€‚å¯ä»¥ç”¨ã€Œç®€å•éšæœºæœç´¢ã€ã€ã€Œè´å¶æ–¯ä¼˜åŒ–ã€ã€ã€Œé—ä¼ ç®—æ³•ã€ç­‰ç®—æ³•å®Œæˆè¿™ä¸ªå·¥ä½œã€‚</p><p>æ›´æ–°è¶…å‚æ•°å…¶å®æ˜¯å¾ˆéš¾çš„ï¼Œæ¯æ¬¡å°è¯•çš„è®¡ç®—ä»£ä»·å¤ªå¤§ï¼Œæ¯æ¬¡éƒ½è¦ä»å¤´è®­ç»ƒä¸€æ¬¡ï¼›è€Œä¸”è¶…å‚æ•°æ˜¯ä¸è¿ç»­ã€ä¸å¯å¾®çš„ï¼Œä¸èƒ½ç”¨æ¢¯åº¦ä¸‹é™ä¹‹ç±»çš„ç®—æ³•ã€‚</p><p>æ‰€ä»¥ï¼Œå…¶å®è‡ªåŠ¨çš„è¶…å‚æ•°ä¼˜åŒ–ç°åœ¨è¿˜ä¸æˆç†Ÿï¼Œå¯ç”¨çš„å·¥å…·ååˆ†æœ‰é™ã€‚ä¸è¿‡è¿˜æ˜¯æœ‰å¥½äº›åº“å¯ä»¥ç”¨æ¥è‡ªåŠ¨è°ƒèŠ‚ Keras çš„è¶…å‚æ•°çš„:</p><ul><li><a href="https://github.com/maxpumperla/hyperas">Hyperas</a>ï¼Œè¿™ä¸ªåº“æ¯”è¾ƒè€ç‰Œï¼Œä¹Ÿæ˜¯ä¹¦ä¸Šæåˆ°çš„ï¼Œä½†æˆªæ­¢ 2020 å¹´ 8 æœˆï¼Œå·²ç»å¥½å‡ ä¸ªæœˆæ²¡æäº¤äº†ï¼›</li><li><a href="https://github.com/keras-team/keras-tuner">Keras Tuner</a> ï¼Œè¿™ä¸ªåº“æ¯”è¾ƒæ–°ï¼Œæ˜¯æˆ‘å‰å‡ å¤©çœ‹åˆ°çš„ï¼ŒStar æ•°å·²ç»å’Œ Hyperas æŒå¹³äº†ã€‚</li><li>â€¦</li></ul><p><strong>æ³¨æ„</strong>ï¼šè‡ªåŠ¨è¶…å‚æ•°çš„è°ƒèŠ‚ï¼Œæœ¬è´¨ä¸Šæ˜¯åœ¨éªŒè¯æ•°æ®ä¸Šè®­ç»ƒè¶…å‚æ•°ã€‚åœ¨åšå¤§è§„æ¨¡è¶…å‚æ•°è‡ªåŠ¨ä¼˜åŒ–æ—¶ï¼Œä¸€å®šè¦æ³¨æ„ï¼ŒéªŒè¯é›†è¿‡æ‹Ÿåˆçš„é—®é¢˜ï¼</p><h3 id="æ¨¡å‹é›†æˆ"><a href="#æ¨¡å‹é›†æˆ" class="headerlink" title="æ¨¡å‹é›†æˆ"></a>æ¨¡å‹é›†æˆ</h3><p>æ¨¡å‹é›†æˆ(model ensembling)ï¼Œä¹Ÿæ˜¯ä¸€ç§å¾ˆå¼ºå¤§çš„æŠ€æœ¯ã€‚æ¨¡å‹é›†æˆï¼Œæ˜¯æŒ‡å°†ä¸€ç³»åˆ—ä¸åŒæ¨¡å‹çš„é¢„æµ‹ç»“æœæ±‡é›†åˆ°ä¸€èµ·ï¼Œä»è€Œå¾—åˆ°æ›´å¥½çš„é¢„æµ‹ç»“æœã€‚</p><p>å¯¹äºåŒä¸€ä¸ªé—®é¢˜ï¼Œä¸åŒçš„æ¨¡å‹ï¼Œè™½ç„¶å¯èƒ½éƒ½èƒ½æ¯”è¾ƒå¥½çš„è§£å†³é—®é¢˜ï¼Œä½†æ­£å¦‚ç›²äººæ‘¸è±¡ï¼Œå¯èƒ½æ¯ä¸ªæ¨¡å‹éƒ½å¾—åˆ°äº†æ•°æ®çœŸç›¸çš„ä¸€éƒ¨åˆ†ï¼Œä½†ä¸æ˜¯å…¨éƒ¨çœŸç›¸ã€‚å°†å„ç§è§‚ç‚¹æ±‡é›†åœ¨ä¸€èµ·ï¼Œå°±å¯èƒ½å¾—åˆ°å¯¹æ•°æ®æ›´åŠ å‡†ç¡®çš„æè¿°ã€‚åœ¨è¿™ç§æƒ³æ³•ä¸‹ï¼Œå¯ä»¥è¯´ï¼Œå°†å¾ˆå¤šæ¨¡å‹é›†æˆåˆ°ä¸€èµ·ï¼Œå¿…ç„¶å¯ä»¥æ‰“è´¥ä»»ä½•å•ä¸ªæ¨¡å‹ã€‚</p><p>å¯¹äºæ¨¡å‹é›†æˆï¼Œä½¿ç”¨çš„æ¨¡å‹çš„å¤šæ ·æ€§ååˆ†é‡è¦ã€‚Diversity is strength. ç”¨æ¥é›†æˆçš„æ¨¡å‹åº”è¯¥å°½å¯èƒ½å¥½ï¼ŒåŒæ—¶å°½å¯èƒ½ä¸åŒã€‚ç›¸åŒçš„ç½‘ç»œï¼Œä½¿ç”¨ä¸åŒçš„éšæœºåˆå§‹åŒ–å¤šæ¬¡ç‹¬ç«‹è®­ç»ƒï¼Œç„¶åé›†æˆï¼Œè¿™æ ·æ„ä¹‰å°±ä¸å¤§äº†ã€‚æ›´å¥½çš„åšæ³•åº”è¯¥æ˜¯ä½¿ç”¨æ¶æ„éå¸¸ä¸åŒçš„æ¨¡å‹å»é›†æˆï¼Œè¿™æ ·å„ä¸ªæ¨¡å‹çš„åå·®åœ¨ä¸åŒæ–¹å‘ä¸Šï¼Œé›†æˆè®©åå·®ä¼šå½¼æ­¤æŠµæ¶ˆï¼Œç»“æœæ‰ä¼šæ›´åŠ ç¨³å®šã€å‡†ç¡®ã€‚</p><p>ä»¥åˆ†ç±»é—®é¢˜ä¸ºä¾‹ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬æœ‰äº†ä¸€äº›ä¸åŒçš„æ¨¡å‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">preds_a = model_a.predict(x_val)</span><br><span class="line">preds_b = model_b.predict(x_val)</span><br><span class="line">preds_c = model_c.predict(x_val)</span><br><span class="line">preds_d = model_d.predict(x_val)</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç”¨å¤šç§ä¸åŒçš„æ–¹æ³•æ¥é›†æˆå®ƒä»¬ï¼Œæœ€ç®€å•çš„åŠæ³•æ˜¯ï¼Œå–å¹³å‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">final_preds = <span class="number">0.25</span> * (preds_a + preds_b + preds_c + preds_d)</span><br></pre></td></tr></table></figure><p>ç”±äºæ¯ä¸€ä¸ªæ¨¡å‹çš„æ€§èƒ½ä¼šæœ‰å·®è·ï¼Œæ‰€ä»¥æ›´å¥½çš„åŠæ³•æ˜¯åŠ æƒå¹³å‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">final_preds = <span class="number">0.5</span> * preds_a + <span class="number">0.25</span> * preds_b + <span class="number">0.1</span> * preds_c + <span class="number">0.15</span> * preds_d</span><br></pre></td></tr></table></figure><p>å…¶ä¸­çš„æƒé‡ï¼Œå¯ä»¥ä½¿ç”¨åŸºäºç»éªŒç»™å‡ºã€ä½¿ç”¨éšæœºæœç´¢æˆ–è€…å…¶ä»–ä¼˜åŒ–ç®—æ³•å¾—åˆ°ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> Deep Learning with Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
            <tag> Deep Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonæ·±åº¦å­¦ä¹ ä¹‹Keraså›è°ƒå‡½æ•°ä¸TensorBoard</title>
      <link href="/2020/08/18/DeepLearningWithPython/Deep-Learning%20with-Python-ch7_2/"/>
      <url>/2020/08/18/DeepLearningWithPython/Deep-Learning%20with-Python-ch7_2/</url>
      
        <content type="html"><![CDATA[<h1 id="Deep-Learning-with-Python"><a href="#Deep-Learning-with-Python" class="headerlink" title="Deep Learning with Python"></a>Deep Learning with Python</h1><p>è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘å­¦ä¹ ã€ŠDeep Learning with Pythonã€‹(ç¬¬äºŒç‰ˆï¼ŒFranÃ§ois Chollet è‘—) æ—¶å†™çš„ç³»åˆ—ç¬”è®°ä¹‹ä¸€ã€‚æ–‡ç« çš„å†…å®¹æ˜¯ä»  Jupyter notebooks è½¬æˆ Markdown çš„ï¼Œä½ å¯ä»¥å» <a href="https://github.com/cdfmlr/Deep-Learning-with-Python-Notebooks">GitHub</a> æˆ– <a href="https://gitee.com/cdfmlr/Deep-Learning-with-Python-Notebooks">Gitee</a> æ‰¾åˆ°åŸå§‹çš„ <code>.ipynb</code> ç¬”è®°æœ¬ã€‚</p><p>ä½ å¯ä»¥å»<a href="https://livebook.manning.com/book/deep-learning-with-python">è¿™ä¸ªç½‘ç«™åœ¨çº¿é˜…è¯»è¿™æœ¬ä¹¦çš„æ­£ç‰ˆåŸæ–‡</a>(è‹±æ–‡)ã€‚è¿™æœ¬ä¹¦çš„ä½œè€…ä¹Ÿç»™å‡ºäº†é…å¥—çš„ <a href="https://github.com/fchollet/deep-learning-with-python-notebooks">Jupyter notebooks</a>ã€‚</p><p>æœ¬æ–‡ä¸º <strong>ç¬¬7ç«   é«˜çº§çš„æ·±åº¦å­¦ä¹ æœ€ä½³å®è·µ</strong> (Chapter 7. <em>Advanced deep-learning best practices</em>) çš„ç¬”è®°ä¹‹ä¸€ã€‚</p><p>[TOC]</p><h2 id="7-2-Inspecting-and-monitoring-deep-learning-models-using-Keras-callbacks-and-TensorBoard"><a href="#7-2-Inspecting-and-monitoring-deep-learning-models-using-Keras-callbacks-and-TensorBoard" class="headerlink" title="7.2 Inspecting and monitoring deep-learning models using Keras callbacks and TensorBoard"></a>7.2 Inspecting and monitoring deep-learning models using Keras callbacks and TensorBoard</h2><blockquote><p>ä½¿ç”¨ Keras å›è°ƒå‡½æ•°å’Œ TensorBoard æ¥æ£€æŸ¥å¹¶ç›‘æ§æ·±åº¦å­¦ä¹ æ¨¡å‹</p></blockquote><p>ç”¨ model.fit() å¼€å¯ä¸€ä¸ªå¤æ‚çš„è®­ç»ƒä»»åŠ¡åï¼Œæˆ‘ä»¬å°±åªèƒ½å¹²ç­‰ç€ï¼Œåœ¨ç»“æŸå‰éƒ½ä¸çŸ¥é“å®ƒæœ‰æ²¡æœ‰æ­£ç¡®å·¥ä½œï¼Œä¹Ÿæ— æ³•æ§åˆ¶å®ƒï¼Œå¥½ä¼¼æŠ›å‡ºäº†ä¸€æ¶çº¸é£æœºï¼Œä»»å®ƒéšé£å»å¾€ä¸ç¡®å®šçš„è¿œæ–¹ã€‚æ¯”èµ·è¿™æ ·ä¸å—æ§åˆ¶çš„çº¸é£æœºï¼Œæˆ–è®¸æˆ‘ä»¬æ›´å¸Œæœ›è¦ä¸€å°æ™ºèƒ½çš„æ— äººæœºï¼Œå¯ä»¥æ„ŸçŸ¥ç¯å¢ƒï¼Œå°†æ•°æ®å‘å›ç»™æˆ‘ä»¬ï¼Œå¹¶åŸºäºå½“å‰çŠ¶æ€è‡ªä¸»èˆªè¡Œã€‚ Keras çš„å›è°ƒå‡½æ•°ä¸ TensorBoard è¿™æ ·çš„å·¥å…·å°±å¯ä»¥å¸®æˆ‘ä»¬æŠŠâ€œçº¸é£æœºâ€æ”¹é€ æˆâ€œæ™ºèƒ½çš„æ— äººæœºâ€ã€‚</p><h3 id="è®­ç»ƒä¸­å°†å›è°ƒå‡½æ•°ä½œç”¨äºæ¨¡å‹"><a href="#è®­ç»ƒä¸­å°†å›è°ƒå‡½æ•°ä½œç”¨äºæ¨¡å‹" class="headerlink" title="è®­ç»ƒä¸­å°†å›è°ƒå‡½æ•°ä½œç”¨äºæ¨¡å‹"></a>è®­ç»ƒä¸­å°†å›è°ƒå‡½æ•°ä½œç”¨äºæ¨¡å‹</h3><p>æˆ‘ä»¬åœ¨è®­ç»ƒæ¨¡å‹çš„æ—¶å€™ï¼Œä¸€å¼€å§‹æ˜¯ä¸çŸ¥é“è¦è·‘å¤šå°‘è½®çš„ï¼Œæˆ‘ä»¬åªèƒ½è®©å®ƒè·‘è¶³å¤Ÿå¤šçš„è½®æ¬¡ï¼Œç„¶åæ‰‹åŠ¨æ‰¾å‡ºä¸€ä¸ªæœ€ä½³çš„è½®æ¬¡æ•°ï¼Œé‡æ–°ç”¨è¿™ä¸ªæœ€ä½³è½®æ¬¡æ•°å»è®­ç»ƒæ¨¡å‹ï¼Œè¿™æ ·ç›¸å½“è€—æ—¶ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬æ›´å¸Œæœ›å½“æ¨¡å‹è§‚æµ‹åˆ°éªŒè¯æŸå¤±ä¸å†æ”¹å–„æ—¶å°±è‡ªåŠ¨åœæ­¢è®­ç»ƒã€‚</p><p>è¿™ç§æ“ä½œå°±å¯ä»¥ç”¨ Keras å›è°ƒå‡½æ•°ï¼ˆcallbackï¼‰å®Œæˆï¼šKeras æä¾›äº†å¾ˆå¤šæœ‰ç”¨çš„ callbackï¼Œæ”¾åœ¨ <code>keras.callbacks</code> é‡Œï¼Œè‡ªåŠ¨åœæ­¢è®­ç»ƒåªæ˜¯å…¶ä¸­ä¸€ç§ç”¨æ³•ã€‚</p><p>Callback ä¼šåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­çš„ä¸åŒæ—¶é—´ç‚¹è¢«æ¨¡å‹è°ƒç”¨ï¼Œå®ƒå¯ä»¥è®¿é—®æ¨¡å‹çš„çŠ¶æ€ï¼Œå¹¶å¯ä»¥é‡‡å–ä¸€äº›è¡ŒåŠ¨ï¼Œä¾‹å¦‚ï¼š</p><ul><li>æ¨¡å‹æ£€æŸ¥ç‚¹ï¼šåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­çš„ä¸åŒæ—¶é—´ç‚¹ä¿å­˜æ¨¡å‹çš„å½“å‰æƒé‡</li><li>æå‰ç»ˆæ­¢ï¼šéªŒè¯æŸå¤±ä¸å†æ”¹å–„æ—¶ä¸­æ–­è®­ç»ƒ</li><li>åŠ¨æ€è°ƒèŠ‚å‚æ•°å€¼ï¼šä¾‹å¦‚åŠ¨æ€è°ƒæ•´ä¼˜åŒ–å™¨çš„å­¦ä¹ ç‡</li><li>è®°å½•è®­ç»ƒæŒ‡æ ‡å’ŒéªŒè¯æŒ‡æ ‡ï¼šç”¨è¿™äº›æŒ‡æ ‡å°±å¯ä»¥å°†æ¨¡å‹å­¦åˆ°çš„è¡¨ç¤ºå¯è§†åŒ–</li><li>â€¦</li></ul><h4 id="ä½¿ç”¨-callback"><a href="#ä½¿ç”¨-callback" class="headerlink" title="ä½¿ç”¨ callback"></a>ä½¿ç”¨ callback</h4><p>Keras å†…ç½®äº†è®¸å¤šæœ‰ç”¨çš„ callbackï¼Œä¾‹å¦‚ï¼š</p><ul><li><code>ModelCheckpoint</code>ï¼šåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¿å­˜è®­ç»ƒåˆ°æŸäº›çŠ¶æ€çš„æ¨¡å‹ã€‚å¯ä»¥ç”¨æ¥æŒç»­ä¸æ–­åœ°ä¿å­˜æ¨¡å‹ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©æ€§åœ°ä¿å­˜ç›®å‰çš„æœ€ä½³æ¨¡å‹ï¼›</li><li><code>EarlyStopping</code>ï¼šç›‘æ§çš„ç›®æ ‡æŒ‡æ ‡ï¼Œå¦‚æœåœ¨è®¾å®šçš„è½®æ•°å†…ä¸å†æ”¹å–„ï¼Œåˆ™ä¸­æ–­è®­ç»ƒï¼›</li><li><code>ReduceLROnPlateau</code>ï¼šåœ¨éªŒè¯æŸå¤±ä¸å†æ”¹å–„æ—¶ï¼ˆé‡åˆ°loss plateauï¼‰ï¼Œé™ä½å­¦ä¹ ç‡ã€‚</li></ul><p>è¿™äº› callback çš„ä½¿ç”¨ä¹Ÿå¾ˆç®€å•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow <span class="keyword">import</span> keras</span><br><span class="line"></span><br><span class="line">callbacks_list = [</span><br><span class="line">    <span class="comment"># åœ¨æ¯è½®å®Œæˆåä¿å­˜æƒé‡</span></span><br><span class="line">    keras.callbacks.ModelCheckpoint(</span><br><span class="line">        filepath=<span class="string">&#x27;my_model.h5&#x27;</span>,  <span class="comment"># ä¿å­˜æ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line">        monitor=<span class="string">&#x27;val_loss&#x27;</span>,      <span class="comment"># monitorï¼šè¦éªŒè¯çš„æŒ‡æ ‡</span></span><br><span class="line">        save_best_only=<span class="literal">True</span>,     <span class="comment"># åªä¿å­˜è®© monitor æŒ‡æ ‡æœ€å¥½çš„æ¨¡å‹ï¼ˆå¦‚æœ monitor æ²¡æœ‰æ”¹å–„ï¼Œå°±ä¸ä¿å­˜ï¼‰</span></span><br><span class="line">    ),</span><br><span class="line">    <span class="comment"># ä¸å†æ”¹å–„æ—¶ä¸­æ–­è®­ç»ƒ</span></span><br><span class="line">    keras.callbacks.EarlyStopping(</span><br><span class="line">        monitor=<span class="string">&#x27;acc&#x27;</span>,           <span class="comment"># è¦éªŒè¯çš„æŒ‡æ ‡</span></span><br><span class="line">        patience=<span class="number">10</span>,             <span class="comment"># å¦‚æœ monitor åœ¨å¤šäº patience è½®å†…ï¼ˆæ¯”å¦‚è¿™é‡Œå°±æ˜¯10+1=11è½®ï¼‰æ²¡æœ‰æ”¹å–„ï¼Œåˆ™ä¸­æ–­è®­ç»ƒ</span></span><br><span class="line">    ),</span><br><span class="line">    <span class="comment"># ä¸å†æ”¹å–„æ—¶é™ä½å­¦ä¹ ç‡</span></span><br><span class="line">    keras.callbacks.ReduceLROnPlateau(</span><br><span class="line">        monitor=<span class="string">&#x27;val_loss&#x27;</span>,    <span class="comment"># è¦éªŒè¯çš„æŒ‡æ ‡</span></span><br><span class="line">        factor=<span class="number">0.1</span>,            <span class="comment"># è§¦å‘æ—¶ï¼šå­¦ä¹ ç‡ *= factor</span></span><br><span class="line">        patience=<span class="number">5</span>,            <span class="comment"># monitor åœ¨ patience è½®å†…æ²¡æœ‰æ”¹å–„ï¼Œåˆ™è§¦å‘é™ä½å­¦ä¹ ç‡</span></span><br><span class="line">    ),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>, </span><br><span class="line">              loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>, </span><br><span class="line">              metrics=[<span class="string">&#x27;acc&#x27;</span>])    <span class="comment"># åœ¨ callback é‡Œç”¨åˆ°äº† acc åšæŒ‡æ ‡ï¼Œæ‰€ä»¥è¿™é‡Œçš„ metrics é‡Œè¦æœ‰ acc</span></span><br><span class="line"></span><br><span class="line">model.fit(x, y, </span><br><span class="line">          epochs=<span class="number">10</span>, </span><br><span class="line">          batch_size=<span class="number">32</span>, </span><br><span class="line">          callbacks=callbacks_list,     <span class="comment"># è®­ç»ƒæ—¶ä½¿ç”¨è¿™äº›å›è°ƒ</span></span><br><span class="line">          validation_data=(x_val, y_val))  <span class="comment"># callback é‡Œç”¨åˆ°äº† valï¼Œæ‰€ä»¥è¿™é‡Œå¿…é¡»æœ‰ val</span></span><br></pre></td></tr></table></figure><h4 id="ç¼–å†™è‡ªå·±çš„å›è°ƒå‡½æ•°"><a href="#ç¼–å†™è‡ªå·±çš„å›è°ƒå‡½æ•°" class="headerlink" title="ç¼–å†™è‡ªå·±çš„å›è°ƒå‡½æ•°"></a>ç¼–å†™è‡ªå·±çš„å›è°ƒå‡½æ•°</h4><p>é™¤äº†ä½¿ç”¨ Keras å†…ç½®çš„å›è°ƒï¼Œè¿˜å¯ä»¥è‡ªå·±å†™ callback æ¥å®Œæˆå†…ç½®æ²¡æœ‰çš„æ“ä½œã€‚</p><p>è‡ªå·±å†™å›è°ƒé€šè¿‡åˆ›å»º <code>keras.callbacks.Callback</code> çš„å­ç±»æ¥å®ç°ã€‚å’Œå†™æ¸¸æˆè„šæœ¬å¾ˆç±»ä¼¼ï¼Œåœ¨è¿™ä¸ªå­ç±»ä¸­å®ç°ä¸€äº›æ–¹æ³•ï¼Œç„¶åè¿™äº›æ–¹æ³•å°±ä¼šåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­çš„ç‰¹å®šæ—¶é—´ç‚¹è¢«è°ƒç”¨ï¼š</p><table><thead><tr><th>æ–¹æ³•</th><th>è¢«è°ƒç”¨çš„æ—¶é—´</th></tr></thead><tbody><tr><td>on_epoch_begin</td><td>åœ¨æ¯è½®å¼€å§‹æ—¶è¢«è°ƒç”¨</td></tr><tr><td>on_epoch_end</td><td>åœ¨æ¯è½®ç»“æŸæ—¶è¢«è°ƒç”¨</td></tr><tr><td></td><td></td></tr><tr><td>on_batch_begin</td><td>åœ¨å¤„ç†æ¯ä¸ªæ‰¹é‡ä¹‹å‰è¢«è°ƒç”¨</td></tr><tr><td>on_batch_end</td><td>åœ¨å¤„ç†æ¯ä¸ªæ‰¹é‡ä¹‹åè¢«è°ƒç”¨</td></tr><tr><td></td><td></td></tr><tr><td>on_train_begin</td><td>åœ¨è®­ç»ƒå¼€å§‹æ—¶è¢«è°ƒç”¨</td></tr><tr><td>on_train_end</td><td>åœ¨è®­ç»ƒç»“æŸæ—¶è¢«è°ƒç”¨</td></tr></tbody></table><p>è¿™äº›æ–¹æ³•æ¥å—ä¸€ä¸ª logs å‚æ•°ï¼ˆdictç±»å‹çš„ï¼‰ï¼Œé‡Œé¢åŒ…å«å‰ä¸€ä¸ªepoch æˆ– batch æˆ– train çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬è®­ç»ƒæŒ‡æ ‡ã€éªŒè¯æŒ‡æ ‡ä¹‹ç±»çš„ã€‚</p><p>åœ¨è¿™äº›æ–¹æ³•ä¸­ï¼Œè¿˜å¯ä»¥è®¿é—®ï¼š</p><ul><li><code>self.model</code>: è°ƒç”¨å›è°ƒçš„æ¨¡å‹å®ä¾‹;</li><li><code>self.validation_data</code>: fit ä¼ å…¥çš„éªŒè¯æ•°æ®;</li></ul><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰å›è°ƒå‡½æ•°ï¼Œåœ¨æ¯è½®ç»“æŸåå°†æ¨¡å‹æ¯å±‚å¯¹éªŒè¯é›†çš„ç¬¬ä¸€ä¸ªæ ·æœ¬çš„æ¿€æ´»è®¡ç®—å€¼ä¿å­˜ä¸‹æ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow <span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ActivationLogger</span>(<span class="params">keras.callbacks.Callback</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_model</span>(<span class="params">self, model</span>):</span>  <span class="comment"># åœ¨è®­ç»ƒä¹‹å‰ç”±çˆ¶æ¨¡å‹è°ƒç”¨ï¼Œå‘Šè¯‰å›è°ƒå‡½æ•°æ˜¯å“ªä¸ªæ¨¡å‹åœ¨è°ƒç”¨å®ƒ</span></span><br><span class="line">        self.model = model</span><br><span class="line">        layer_outputs = [layer.output <span class="keyword">for</span> layer <span class="keyword">in</span> model.layers]</span><br><span class="line">        self.activations_model = keras.models.Model(model.<span class="built_in">input</span>, layer_outputs)  <span class="comment"># æ¨¡å‹å®ä¾‹ï¼Œè¿”å›æ¯å±‚çš„æ¿€æ´»</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">on_epoch_end</span>(<span class="params">self, epoch, logs=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="keyword">if</span> self.validation_data <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;Requires validation_data.&#x27;</span>)</span><br><span class="line">        validation_sample = self.validation_data[<span class="number">0</span>][<span class="number">0</span>:<span class="number">1</span>]</span><br><span class="line">        activations = self.activations_model.predict(validation_sample)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">f&#x27;activations_at_epoch_<span class="subst">&#123;epoch&#125;</span>.npz&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            np.savez(f, activations)</span><br></pre></td></tr></table></figure><h3 id="TensorBoard-ç®€ä»‹-TensorFlow-çš„å¯è§†åŒ–æ¡†æ¶"><a href="#TensorBoard-ç®€ä»‹-TensorFlow-çš„å¯è§†åŒ–æ¡†æ¶" class="headerlink" title="TensorBoard ç®€ä»‹: TensorFlow çš„å¯è§†åŒ–æ¡†æ¶"></a>TensorBoard ç®€ä»‹: TensorFlow çš„å¯è§†åŒ–æ¡†æ¶</h3><p>ä¸ºäº†åšå‡ºæ›´å¥½æ¨¡å‹ï¼Œé™¤äº†æ€è€ƒæ„æ¶ã€ç¼–å†™ä»£ç ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è·å–å…³äºæ¨¡å‹çš„ä¿¡æ¯ã€äº†è§£è®­ç»ƒè¿‡ç¨‹ä¸­æ¨¡å‹å†…éƒ¨æ­£åœ¨å‘ç”Ÿä»€ä¹ˆï¼Œå¹¶ç”¨è¿™äº›ä¿¡æ¯æ¥çŸ¥é“æˆ‘ä»¬å†æ€è€ƒã€å†ä¼˜åŒ–æ¨¡å‹ã€‚</p><p>æ€è€ƒæ˜¯åœ¨ä½ çš„è„‘å­é‡Œå®Œæˆçš„ï¼Œç¼–å†™æ¨¡å‹çš„ä»£ç å¯ä»¥ç”¨ Keras API è½»æ¾å®ç°ï¼Œè€Œäº†è§£æ¨¡å‹å¯ä»¥å€Ÿç”¨ TensorBoardã€‚TensorBoard æ˜¯å†…ç½®äº TensorFlow ä¸­çš„åŸºäºæµè§ˆå™¨çš„å¯è§†åŒ–å·¥å…·ï¼Œå®ƒèƒ½åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è®©ä½ å¯è§†åŒ–åœ°ç›‘æ§æ¨¡å‹å†…éƒ¨å‘ç”Ÿçš„ä¸€åˆ‡ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghp9tjfuzcj312g0d6acp.jpg" alt="å–å¾—è¿›å±•çš„å¾ªç¯"></p><p>TensorBoard ä¸»è¦æœ‰ä¸€ä¸‹å‡ ä¸ªä½œç”¨ï¼š</p><ul><li>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä»¥å¯è§†åŒ–çš„æ–¹å¼ç›‘æ§æŒ‡æ ‡</li><li>å°†æ¨¡å‹æ¶æ„å¯è§†åŒ–</li><li>å°†æ¿€æ´»å’Œæ¢¯åº¦çš„ç›´æ–¹å›¾å¯è§†åŒ–</li><li>ä»¥ä¸‰ç»´çš„å½¢å¼ç ”ç©¶åµŒå…¥</li></ul><p>æˆ‘ä»¬åœ¨ IMDB æƒ…æ„Ÿåˆ†æä»»åŠ¡ä¸Šè®­ç»ƒä¸€ä¸ªä¸€ç»´å·ç§¯ç¥ç»ç½‘ç»œï¼Œæ¥æ¼”ç¤º TensorBoard çš„ä½¿ç”¨:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow <span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.datasets <span class="keyword">import</span> imdb</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.preprocessing <span class="keyword">import</span> sequence</span><br><span class="line"></span><br><span class="line">max_features = <span class="number">2000</span></span><br><span class="line">max_len = <span class="number">500</span></span><br><span class="line"></span><br><span class="line">(x_train, y_train), (x_test, y_test) = imdb.load_data(num_words=max_features)</span><br><span class="line">x_train = sequence.pad_sequences(x_train, maxlen=max_len)</span><br><span class="line">x_test = sequence.pad_sequences(x_test, maxlen=max_len)</span><br><span class="line"></span><br><span class="line">model = keras.models.Sequential()</span><br><span class="line">model.add(layers.Embedding(max_features, <span class="number">128</span>,</span><br><span class="line">                           input_length=max_len,</span><br><span class="line">                           name=<span class="string">&#x27;embed&#x27;</span>))</span><br><span class="line">model.add(layers.Conv1D(<span class="number">32</span>, <span class="number">7</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.MaxPool1D(<span class="number">5</span>))</span><br><span class="line">model.add(layers.Conv1D(<span class="number">32</span>, <span class="number">7</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.GlobalMaxPooling1D())</span><br><span class="line"></span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">model.summary()</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>,</span><br><span class="line">              loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>,</span><br><span class="line">              metrics=[<span class="string">&#x27;acc&#x27;</span>])</span><br></pre></td></tr></table></figure><pre><code>Model: &quot;sequential&quot;_________________________________________________________________Layer (type)                 Output Shape              Param #   =================================================================embed (Embedding)            (None, 500, 128)          256000    _________________________________________________________________conv1d (Conv1D)              (None, 494, 32)           28704     _________________________________________________________________max_pooling1d (MaxPooling1D) (None, 98, 32)            0         _________________________________________________________________conv1d_1 (Conv1D)            (None, 92, 32)            7200      _________________________________________________________________global_max_pooling1d (Global (None, 32)                0         _________________________________________________________________dense (Dense)                (None, 1)                 33        =================================================================Total params: 291,937Trainable params: 291,937Non-trainable params: 0_________________________________________________________________</code></pre><p>è¦ä½¿ç”¨ TensorBoardï¼Œåœ¨å¼€å§‹è®­ç»ƒä¹‹å‰è¿˜éœ€è¦åšä¸€äº›å‡†å¤‡ã€‚é¦–å…ˆï¼Œä¸º TensorBoard éœ€è¦çš„æ—¥å¿—æ–‡ä»¶åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œå¹¶å¼€å¯ TensorBoard çš„æœåŠ¡ã€‚åœ¨ shell é‡Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkdir my_log_dir</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…ï¼Œåœ¨ Jupyter Notebook ä¸­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%mkdir my_log_dir</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œå®ä¾‹åŒ–ä¸€ä¸ª TensorBoard å›è°ƒå‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">tensorboard_callback = tf.keras.callbacks.TensorBoard(</span><br><span class="line">    log_dir=<span class="string">&#x27;my_log_dir&#x27;</span>,  <span class="comment"># æ—¥å¿—æ–‡ä»¶çš„å‚¨å­˜ä½ç½®</span></span><br><span class="line">    histogram_freq=<span class="number">1</span>,      <span class="comment"># æ¯ histogram_freq è½®ä¹‹åè®°å½•æ¿€æ´»ç›´æ–¹å›¾</span></span><br><span class="line">    embeddings_freq=<span class="number">1</span>,     <span class="comment"># æ¯ histogram_freq è½®ä¹‹åè®°å½•è¯åµŒå…¥</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œåœ¨è®­ç»ƒæ—¶ä½¿ç”¨è¿™ä¸ªå›è°ƒå°±å¯ä»¥äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">history = model.fit(x_train, y_train, </span><br><span class="line">                    epochs=<span class="number">20</span>, </span><br><span class="line">                    batch_size=<span class="number">128</span>, </span><br><span class="line">                    validation_split=<span class="number">0.2</span>, </span><br><span class="line">                    callbacks=[tensorboard_callback])</span><br></pre></td></tr></table></figure><pre><code>Epoch 1/20157/157 [==============================] - 25s 156ms/step - loss: 0.6376 - acc: 0.6424 - val_loss: 0.7053 - val_acc: 0.7210Epoch 2/20157/157 [==============================] - 24s 152ms/step - loss: 0.4426 - acc: 0.8489 - val_loss: 0.5328 - val_acc: 0.8378Epoch 3/20157/157 [==============================] - 25s 161ms/step - loss: 0.3988 - acc: 0.8807 - val_loss: 0.4488 - val_acc: 0.8688Epoch 4/20157/157 [==============================] - 24s 155ms/step - loss: 0.3680 - acc: 0.8965 - val_loss: 0.5022 - val_acc: 0.8714Epoch 5/20157/157 [==============================] - 25s 162ms/step - loss: 0.3123 - acc: 0.9168 - val_loss: 0.4771 - val_acc: 0.8688Epoch 6/20157/157 [==============================] - 25s 162ms/step - loss: 0.2550 - acc: 0.9387 - val_loss: 0.7022 - val_acc: 0.8640Epoch 7/20157/157 [==============================] - 24s 156ms/step - loss: 0.2419 - acc: 0.9470 - val_loss: 0.7245 - val_acc: 0.8758Epoch 8/20157/157 [==============================] - 27s 170ms/step - loss: 0.1864 - acc: 0.9671 - val_loss: 0.8042 - val_acc: 0.8718Epoch 9/20157/157 [==============================] - 30s 189ms/step - loss: 0.1548 - acc: 0.9776 - val_loss: 0.9950 - val_acc: 0.8490Epoch 10/20157/157 [==============================] - 36s 228ms/step - loss: 0.1361 - acc: 0.9844 - val_loss: 0.8995 - val_acc: 0.8714Epoch 11/20157/157 [==============================] - 35s 220ms/step - loss: 0.1297 - acc: 0.9858 - val_loss: 0.9611 - val_acc: 0.8694Epoch 12/20157/157 [==============================] - 33s 210ms/step - loss: 0.1184 - acc: 0.9884 - val_loss: 1.0366 - val_acc: 0.8706Epoch 13/20157/157 [==============================] - 29s 187ms/step - loss: 0.1156 - acc: 0.9877 - val_loss: 1.0596 - val_acc: 0.8700Epoch 14/20157/157 [==============================] - 30s 191ms/step - loss: 0.1101 - acc: 0.9894 - val_loss: 1.1298 - val_acc: 0.8566Epoch 15/20157/157 [==============================] - 25s 162ms/step - loss: 0.1098 - acc: 0.9903 - val_loss: 1.1452 - val_acc: 0.8652Epoch 16/20157/157 [==============================] - 26s 166ms/step - loss: 0.1058 - acc: 0.9909 - val_loss: 1.1963 - val_acc: 0.8692Epoch 17/20157/157 [==============================] - 26s 165ms/step - loss: 0.1119 - acc: 0.9903 - val_loss: 1.2531 - val_acc: 0.8686Epoch 18/20157/157 [==============================] - 30s 190ms/step - loss: 0.1058 - acc: 0.9914 - val_loss: 1.2296 - val_acc: 0.8678Epoch 19/20157/157 [==============================] - 25s 161ms/step - loss: 0.1056 - acc: 0.9916 - val_loss: 1.2272 - val_acc: 0.8666Epoch 20/20157/157 [==============================] - 25s 160ms/step - loss: 0.1086 - acc: 0.9904 - val_loss: 1.2287 - val_acc: 0.8682</code></pre><p>å¼€å§‹è®­ç»ƒä¹‹åï¼Œå°±å¯ä»¥å¼€å¯ TensorBoard æœåŠ¡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> tensorboard --logdir=my_log_dir</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…åœ¨ Jupyter Notebook é‡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%load_ext tensorboard</span><br><span class="line">%tensorboard --logdir=my_log_dir</span><br></pre></td></tr></table></figure><p>ç°åœ¨å°±å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ <code>http://localhost:6006</code> æ¥æŸ¥çœ‹ TensorBoard çš„å¯è§†åŒ–æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹äº†ã€‚</p><ul><li>Scalars æ ‡ç­¾é¡µä¸­ï¼Œå¯ä»¥çœ‹åˆ°è®­ç»ƒè¿‡ç¨‹ä¸­ç²¾åº¦ã€æŸå¤±çš„å˜åŒ–æ›²çº¿ï¼Œå’Œæˆ‘ä»¬ä¹‹å‰æ¯æ¬¡è®­ç»ƒå®Œä¹‹åç”¨ plt ç”»çš„æ˜¯åŒæ ·çš„å†…å®¹ï¼Œä¸è¿‡åœ¨  TensorBoard é‡Œä½ å¯ä»¥éšæ—¶åˆ·æ–°å»çœ‹ï¼Œä¸ç”¨ç­‰åˆ°è®­ç»ƒå®Œæˆï¼›</li><li>Graph æ ‡ç­¾é¡µä¸­ï¼Œæ˜¾ç¤ºçš„æ˜¯ Keras æ¨¡å‹èƒŒåçš„åº•å±‚ TensorFlow è¿ç®—å›¾çš„å¯è§†åŒ–ï¼Œè¿™ä¸ªåº•å±‚è¿ç®—å›¾æ¯”æˆ‘ä»¬çš„ Keras æ¨¡å‹å¤æ‚ï¼Œè¿™å°±æ˜¯ Keras ä¸ºæˆ‘ä»¬ç®€åŒ–çš„å·¥ä½œï¼ŒKeras è®©æˆ‘ä»¬ä¸å»æ¥è§¦é‚£äº›å¤æ‚çš„ä¸œè¥¿ï¼Œè®©å·¥ä½œæµç¨‹å˜å¾—éå¸¸ç®€å•ï¼›å¦‚æœä½ æƒ³çœ‹ Keras æ¨¡å‹æœ¬èº«çš„å›¾è¡¨ç¤ºï¼Œå¯ä»¥ç”¨ <code>keras.utils.plot_model</code>ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">tf.keras.utils.plot_model(model, show_shapes=<span class="literal">True</span>, to_file=<span class="string">&#x27;model.png&#x27;</span>)</span><br><span class="line"><span class="comment"># show_shapes=True å¯ä»¥æŠŠå„å±‚çš„è¾“å…¥è¾“å‡ºå¼ é‡å½¢çŠ¶æ˜¾ç¤ºå‡ºæ¥</span></span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghurzd5lj0j30fd0jzq4p.jpg" alt="png"></p><ul><li>Histograms æ ‡ç­¾é¡µä¸­ï¼Œæœ‰æ¯å±‚çš„æ¿€æ´»å€¼ç›´æ–¹å›¾ï¼›</li><li>Projector æ ‡ç­¾é¡µä¸­ï¼Œæœ‰æˆ‘ä»¬çš„è¯è¡¨ä¸­ 2000 ä¸ªå•è¯çš„è¯åµŒå…¥ç©ºé—´å…³ç³»ã€‚è¿™æ˜¯ç”± Embedding å±‚å­¦ä¹ åˆ°çš„ 128 ç»´çš„åµŒå…¥ç©ºé—´ç”¨ PCA ä¹‹ç±»çš„ç®—æ³•é™åˆ° 2 ç»´æˆ–è€… 3 ç»´åå¾—åˆ°çš„â€œæŠ•å½±â€å½±åƒã€‚å¦‚æœä½ å¯¹é‡Œé¢æ¯ä¸ªç‚¹çš„æ„ä¹‰æ„Ÿå…´è¶£ï¼Œå¯ä»¥ç‚¹å‡»æŸä¸ªç‚¹ï¼ŒæŸ¥çœ‹å…¶ç¼–å·ï¼Œç„¶åç”¨ä¸‹é¢çš„ä»£ç è¿˜åŸå‡ºå•è¯æ¥çœ‹çœ‹ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">index_word = &#123;v: k <span class="keyword">for</span> k, v <span class="keyword">in</span> imdb.get_word_index().items()&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_word_of_index</span>(<span class="params">idx</span>):</span>  <span class="comment"># idx è¾“å…¥çœ‹åˆ°çš„è¯ç¼–å·</span></span><br><span class="line">    print(index_word[idx])</span><br><span class="line"></span><br><span class="line">show_word_of_index(<span class="number">123</span>)</span><br></pre></td></tr></table></figure><pre><code>ever</code></pre>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> Deep Learning with Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
            <tag> Deep Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonæ·±åº¦å­¦ä¹ ä¹‹Keraså‡½æ•°å¼API</title>
      <link href="/2020/08/17/DeepLearningWithPython/Deep-Learning%20with-Python-ch7_1/"/>
      <url>/2020/08/17/DeepLearningWithPython/Deep-Learning%20with-Python-ch7_1/</url>
      
        <content type="html"><![CDATA[<h1 id="Deep-Learning-with-Python"><a href="#Deep-Learning-with-Python" class="headerlink" title="Deep Learning with Python"></a>Deep Learning with Python</h1><p>è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘å­¦ä¹ ã€ŠDeep Learning with Pythonã€‹(ç¬¬äºŒç‰ˆï¼ŒFranÃ§ois Chollet è‘—) æ—¶å†™çš„ç³»åˆ—ç¬”è®°ä¹‹ä¸€ã€‚æ–‡ç« çš„å†…å®¹æ˜¯ä»  Jupyter notebooks è½¬æˆ Markdown çš„ï¼Œä½ å¯ä»¥å» <a href="https://github.com/cdfmlr/Deep-Learning-with-Python-Notebooks">GitHub</a> æˆ– <a href="https://gitee.com/cdfmlr/Deep-Learning-with-Python-Notebooks">Gitee</a> æ‰¾åˆ°åŸå§‹çš„ <code>.ipynb</code> ç¬”è®°æœ¬ã€‚</p><p>ä½ å¯ä»¥å»<a href="https://livebook.manning.com/book/deep-learning-with-python">è¿™ä¸ªç½‘ç«™åœ¨çº¿é˜…è¯»è¿™æœ¬ä¹¦çš„æ­£ç‰ˆåŸæ–‡</a>(è‹±æ–‡)ã€‚è¿™æœ¬ä¹¦çš„ä½œè€…ä¹Ÿç»™å‡ºäº†é…å¥—çš„ <a href="https://github.com/fchollet/deep-learning-with-python-notebooks">Jupyter notebooks</a>ã€‚</p><p>æœ¬æ–‡ä¸º <strong>ç¬¬7ç«   é«˜çº§çš„æ·±åº¦å­¦ä¹ æœ€ä½³å®è·µ</strong> (Chapter 7. <em>Advanced deep-learning best practices</em>) çš„ç¬”è®°ä¹‹ä¸€ã€‚</p><p>[TOC]</p><h2 id="7-1-Going-beyond-the-Sequential-model-the-Keras-functional-API"><a href="#7-1-Going-beyond-the-Sequential-model-the-Keras-functional-API" class="headerlink" title="7.1 Going beyond the Sequential model: the Keras functional API"></a>7.1 Going beyond the Sequential model: the Keras functional API</h2><blockquote><p>ä¸ç”¨ Sequential æ¨¡å‹çš„è§£å†³æ–¹æ¡ˆï¼šKeras å‡½æ•°å¼ API</p></blockquote><p>æˆ‘ä»¬ä¹‹å‰ç”¨çš„ Sequential æ¨¡å‹æ˜¯æœ€åŸºç¡€ã€ä½†å¸¸ç”¨çš„ä¸€ç§æ¨¡å‹ï¼Œå®ƒåªæœ‰ä¸€ä¸ªè¾“å…¥å’Œä¸€ä¸ªè¾“å‡ºï¼Œæ•´ä¸ªç½‘ç»œç”±å±‚çº¿æ€§å †å è€Œæˆã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghntkt18rxj30co0hi0tn.jpg" alt="Sequential æ¨¡å‹:å±‚çš„çº¿æ€§å †å "></p><p>ä½†æ˜¯ï¼Œæœ‰æ—¶æˆ‘ä»¬çš„ç½‘ç»œéœ€è¦å¤šä¸ªè¾“å…¥ã€‚æ¯”å¦‚é¢„æµ‹è¡£æœä»·æ ¼ï¼Œè¾“å…¥å•†å“ä¿¡æ¯ã€æ–‡æœ¬æè¿°ã€å›¾ç‰‡ï¼Œè¿™ä¸‰ç±»ä¿¡æ¯åº”è¯¥åˆ†åˆ«ç”¨ Denseã€RNNã€CNN å¤„ç†ï¼Œæå–å‡ºä¿¡æ¯åç”¨ä¸€ä¸ªåˆå¹¶æ¨¡å—æŠŠæ‰€æœ‰å„ç§ä¿¡æ¯ç»¼åˆèµ·æ¥æœ€ç»ˆé¢„æµ‹ä»·æ ¼ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghntomauikj30vo0c03zu.jpg" alt="ä¸€ä¸ªå¤šè¾“å…¥æ¨¡å‹"></p><p>ä¹Ÿæœ‰æ—¶ï¼Œæˆ‘ä»¬çš„ç½‘ç»œéœ€è¦å¤šä¸ªè¾“å‡ºï¼ˆå¤šä¸ªå¤´ï¼‰ã€‚æ¯”å¦‚è¾“å…¥ä¸€ä¸ªå°è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›å¾—åˆ°å°è¯´çš„åˆ†ç±»ï¼Œå¹¶æ¨æµ‹å†™ä½œæ—¶é—´ã€‚è¿™ä¸ªé—®é¢˜åº”è¯¥ä½¿ç”¨ä¸€ä¸ªå…±ç”¨çš„æ¨¡å—å»å¤„ç†æ–‡æœ¬ï¼Œæå–ä¿¡æ¯ï¼Œç„¶ååˆ†åˆ«äº¤ç»™å°è¯´åˆ†ç±»å™¨ã€æ—¥æœŸå›å½’å™¨å»é¢„æµ‹åˆ†ç±»ã€å†™ä½œæ—¶é—´ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghntrygsgsj30oq0jstak.jpg" alt="ä¸€ä¸ªå¤šè¾“å‡º(æˆ–å¤šå¤´)æ¨¡å‹"></p><p>è¿˜æœ‰æ—¶ï¼Œæœ‰äº›å¤æ‚çš„ç½‘ç»œä¼šä½¿ç”¨éçº¿æ€§çš„ç½‘ç»œæ‹“æ‰‘ç»“æ„ã€‚æ¯”å¦‚ä¸€ç§å« Inception çš„ä¸œè¥¿ï¼Œè¾“å…¥ä¼šè¢«å¤šä¸ªå¹¶è¡Œçš„å·ç§¯åˆ†æ”¯å¤„ç†ï¼Œç„¶åå°†è¿™äº›åˆ†æ”¯çš„è¾“å‡ºåˆå¹¶ä¸ºå•ä¸ªå¼ é‡ï¼›è¿˜æœ‰ç§å« residual connection ï¼ˆæ®‹å·®è¿æ¥ï¼‰çš„æ–¹æ³•ï¼Œå°†å‰é¢çš„è¾“å‡ºå¼ é‡ä¸åé¢çš„è¾“å‡ºå¼ é‡ç›¸åŠ ï¼Œä»è€Œå°†å‰é¢çš„è¡¨ç¤ºé‡æ–°æ³¨å…¥ä¸‹æ¸¸æ•°æ®æµä¸­ï¼Œé˜²æ­¢ä¿¡æ¯å¤„ç†æµç¨‹ä¸­çš„ä¿¡æ¯æŸå¤±ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghntzbsxzoj31880miaic.jpg" alt="Inception æ¨¡å—:å±‚ç»„æˆçš„å­å›¾ï¼Œå…·æœ‰å¤šä¸ªå¹¶è¡Œå·ç§¯åˆ†æ”¯ï¼›æ®‹å·®è¿æ¥:é€šè¿‡ç‰¹å¾å›¾ç›¸åŠ å°†å‰é¢çš„ä¿¡æ¯é‡æ–°æ³¨å…¥ä¸‹æ¸¸æ•°æ®"></p><p>è¿™äº›ç½‘ç»œéƒ½æ˜¯å›¾çŠ¶(graph-like)çš„ï¼Œæ˜¯ä¸ªç½‘ç»œç»“æ„ï¼Œè€Œä¸æ˜¯ Sequential é‚£æ ·çš„çº¿æ€§å †å ã€‚è¦åœ¨ Keras ä¸­å®ç°è¿™ç§å¤æ‚çš„æ¨¡å‹ï¼Œå°±éœ€è¦ä½¿ç”¨ Keras çš„å‡½æ•°å¼ APIã€‚</p><h3 id="å‡½æ•°å¼-API"><a href="#å‡½æ•°å¼-API" class="headerlink" title="å‡½æ•°å¼ API"></a>å‡½æ•°å¼ API</h3><p>Keras çš„å‡½æ•°å¼ API æŠŠå±‚å½“ä½œå‡½æ•°æ¥ä½¿ç”¨ï¼Œæ¥æ”¶å¼ é‡å¹¶è¿”å›å¼ é‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> Input, layers</span><br><span class="line"></span><br><span class="line">input_tensor = Input(shape=(<span class="number">32</span>, ))    <span class="comment"># è¾“å…¥å¼ é‡</span></span><br><span class="line">dense = layers.Dense(<span class="number">32</span>, activation=<span class="string">&#x27;relu&#x27;</span>)    <span class="comment"># å±‚å‡½æ•°</span></span><br><span class="line">output_tensor = dense(input_tensor)   <span class="comment"># è¾“å‡ºå¼ é‡ </span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥ç”¨å‡½æ•°å¼ API æ„å»ºä¸€ä¸ªç®€å•ç½‘ç»œï¼Œå’Œ Sequential åšæ¯”è¾ƒï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sequential æ¨¡å‹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"></span><br><span class="line">seq_model = Sequential()</span><br><span class="line">seq_model.add(layers.Dense(<span class="number">32</span>, activation=<span class="string">&#x27;relu&#x27;</span>, input_shape=(<span class="number">64</span>, )))</span><br><span class="line">seq_model.add(layers.Dense(<span class="number">32</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">seq_model.add(layers.Dense(<span class="number">10</span>, activation=<span class="string">&#x27;softmax&#x27;</span>))</span><br><span class="line"></span><br><span class="line">seq_model.summary()</span><br></pre></td></tr></table></figure><pre><code>Model: &quot;sequential&quot;_________________________________________________________________Layer (type)                 Output Shape              Param #   =================================================================dense_1 (Dense)              (None, 32)                2080      _________________________________________________________________dense_2 (Dense)              (None, 32)                1056      _________________________________________________________________dense_3 (Dense)              (None, 10)                330       =================================================================Total params: 3,466Trainable params: 3,466Non-trainable params: 0_________________________________________________________________</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‡½æ•°å¼ API æ¨¡å‹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Model</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> Input</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"></span><br><span class="line">input_tensor = Input(shape=(<span class="number">64</span>, ))</span><br><span class="line">x = layers.Dense(<span class="number">32</span>, activation=<span class="string">&#x27;relu&#x27;</span>)(input_tensor)</span><br><span class="line">x = layers.Dense(<span class="number">32</span>, activation=<span class="string">&#x27;relu&#x27;</span>)(x)</span><br><span class="line">output_tensor = layers.Dense(<span class="number">10</span>, activation=<span class="string">&#x27;softmax&#x27;</span>)(x)</span><br><span class="line"></span><br><span class="line">func_model = Model(input_tensor, output_tensor)</span><br><span class="line"></span><br><span class="line">func_model.summary()</span><br></pre></td></tr></table></figure><pre><code>Model: &quot;functional_1&quot;_________________________________________________________________Layer (type)                 Output Shape              Param #   =================================================================input_2 (InputLayer)         [(None, 64)]              0         _________________________________________________________________dense_4 (Dense)              (None, 32)                2080      _________________________________________________________________dense_5 (Dense)              (None, 32)                1056      _________________________________________________________________dense_6 (Dense)              (None, 10)                330       =================================================================Total params: 3,466Trainable params: 3,466Non-trainable params: 0_________________________________________________________________</code></pre><p>Model å¯¹è±¡å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œåªéœ€ç»™å‡ºè¾“å…¥å¼ é‡å’Œè¾“å…¥å¼ é‡å˜æ¢(ç»è¿‡å„ç§å±‚)å¾—åˆ°çš„è¾“å‡ºå¼ é‡ã€‚Keras ä¼šåœ¨è‡ªåŠ¨æ‰¾å‡ºä» input_tensor åˆ° output_tensor æ‰€åŒ…å«çš„æ¯ä¸€å±‚ï¼Œå¹¶å°†è¿™äº›å±‚ç»„åˆæˆä¸€ä¸ªå›¾çŠ¶çš„æ•°æ®ç»“æ„â€”â€”ä¸€ä¸ª Modelã€‚</p><p>æ³¨æ„ï¼Œoutput_tensor å¿…é¡»æ˜¯ç”±å¯¹åº”çš„ input_tensor å˜æ¢å¾—åˆ°çš„ã€‚å¦‚æœç”¨ä¸ç›¸å…³çš„è¾“å…¥å¼ é‡å’Œè¾“å‡ºå¼ é‡æ¥æ„å»º Modelï¼Œä¼šçˆ† Graph disconnected çš„ ValueError (ä¹¦ä¸Šå†™çš„ keras æ˜¯ RuntimeErrorï¼Œtf.keras æ˜¯ ValueError)ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>unrelated_input = Input(shape=(<span class="number">32</span>,))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bad_model = Model(unrelated_input, output_tensor)</span><br><span class="line"><span class="meta">... </span><span class="comment"># Traceback</span></span><br><span class="line">ValueError: Graph disconnected: cannot obtain value <span class="keyword">for</span> tensor Tensor(<span class="string">&quot;input_2:0&quot;</span>, shape=(<span class="literal">None</span>, <span class="number">64</span>), dtype=float32) at layer <span class="string">&quot;dense_4&quot;</span>. The following previous layers were accessed without issue: []</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ— æ³•ä»æŒ‡å®šçš„è¾“å…¥è¿æ¥åˆ°è¾“å‡ºå½¢æˆä¸€å¼ å›¾ï¼ˆGraphï¼Œé‚£ç§æ•°æ®ç»“æ„ï¼Œç½‘ç»œçš„é‚£ç§ï¼‰å•¦ã€‚</p><p>å¯¹è¿™ç§å‡½æ•°å¼ API æ„å»ºçš„ç½‘ç»œï¼Œç¼–è¯‘ã€è®­ç»ƒæˆ–è¯„ä¼°éƒ½å’Œ Sequential ç›¸åŒã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼–è¯‘</span></span><br><span class="line">func_model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>, loss=<span class="string">&#x27;categorical_crossentropy&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># éšæœºè®­ç»ƒæ•°æ®</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">x_train = np.random.random((<span class="number">1000</span>, <span class="number">64</span>))</span><br><span class="line">y_train = np.random.random((<span class="number">1000</span>, <span class="number">10</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®­ç»ƒ</span></span><br><span class="line">func_model.fit(x_train, y_train, epochs=<span class="number">10</span>, batch_size=<span class="number">128</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯„ä¼°</span></span><br><span class="line">score = func_model.evaluate(x_train, y_train)</span><br></pre></td></tr></table></figure><pre><code>Epoch 1/108/8 [==============================] - 0s 1ms/step - loss: 33.5245Epoch 2/108/8 [==============================] - 0s 1ms/step - loss: 38.1499Epoch 3/108/8 [==============================] - 0s 2ms/step - loss: 42.0662Epoch 4/108/8 [==============================] - 0s 1ms/step - loss: 46.1707Epoch 5/108/8 [==============================] - 0s 813us/step - loss: 50.6095Epoch 6/108/8 [==============================] - 0s 1ms/step - loss: 54.8778Epoch 7/108/8 [==============================] - 0s 1ms/step - loss: 59.6547Epoch 8/108/8 [==============================] - 0s 1ms/step - loss: 64.5255Epoch 9/108/8 [==============================] - 0s 1ms/step - loss: 69.2659Epoch 10/108/8 [==============================] - 0s 685us/step - loss: 74.570732/32 [==============================] - 0s 617us/step - loss: 78.1296</code></pre><h3 id="å¤šè¾“å…¥æ¨¡å‹"><a href="#å¤šè¾“å…¥æ¨¡å‹" class="headerlink" title="å¤šè¾“å…¥æ¨¡å‹"></a>å¤šè¾“å…¥æ¨¡å‹</h3><p>å‡½æ•°å¼ API å¯ç”¨äºæ„å»ºå…·æœ‰å¤šä¸ªè¾“å…¥çš„æ¨¡å‹ã€‚å¤šä¸ªè¾“å…¥çš„æ¨¡å‹ï¼Œé€šå¸¸ä¼šåœ¨æŸä¸ªç‚¹æŠŠä¸åŒåˆ†æ”¯ç”¨ä¸€ä¸ªå¯ä»¥ç»„åˆå¼ é‡çš„å±‚åˆå¹¶èµ·æ¥ã€‚ç»„åˆå¼ é‡ï¼Œå¯ä»¥ç”¨ç›¸åŠ ã€è¿æ¥ç­‰ï¼Œåœ¨ keras ä¸­æä¾›äº†è¯¸å¦‚ <code>keras.layers.add</code>ã€<code>keras.layers.concatenate</code> ç­‰çš„å±‚æ¥å®Œæˆè¿™äº›æ“ä½œã€‚</p><p>çœ‹ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œåšä¸€ä¸ªé—®ç­”æ¨¡å‹ã€‚å…¸å‹çš„é—®ç­”æ¨¡å‹è¦ä½¿ç”¨ä¸¤ä¸ªè¾“å…¥ï¼š</p><ul><li>é—®é¢˜æ–‡æœ¬</li><li>æä¾›ç”¨äºå›ç­”é—®é¢˜çš„ä¿¡æ¯æ–‡æœ¬(æ¯”å¦‚ç›¸å…³çš„æ–°é—»æ–‡ç« )</li></ul><p>æ¨¡å‹è¦ç”Ÿæˆï¼ˆè¾“å‡ºï¼‰ä¸€ä¸ªå›ç­”ã€‚æœ€ç®€å•çš„æƒ…å†µæ˜¯åªå›ç­”ä¸€ä¸ªè¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é¢å‘æŸäº›é¢„å®šä¹‰çš„è¯è¡¨ï¼ŒæŠŠè¾“å‡ºåš softmax å¾—åˆ°ç»“æœã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghnvld5q4aj310q0imq4k.jpg" alt="é—®ç­”æ¨¡å‹"></p><p>ç”¨å‡½æ•°å¼ API æ¥å®ç°è¿™ä¸ªæ¨¡å‹ï¼Œæˆ‘ä»¬å…ˆæ„å»ºä¸¤ä¸ªç‹¬ç«‹åˆ†æ”¯ï¼Œå°† reference text å’Œ question åˆ†åˆ«è¡¨ç¤ºæˆå‘é‡ï¼Œç„¶åè¿æ¥è¿™ä¸¤ä¸ªå‘é‡ï¼Œåœ¨è¿æ¥å®Œæˆç­‰åˆ°çš„è¡¨ç¤ºä¸Šæ·»åŠ ä¸€ä¸ª softmax åˆ†ç±»å™¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Model</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> Input</span><br><span class="line"></span><br><span class="line">text_vocabulary_size = <span class="number">10000</span></span><br><span class="line">question_vocabulary_size = <span class="number">10000</span></span><br><span class="line">answer_vocabulary_size = <span class="number">500</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‚è€ƒ</span></span><br><span class="line">text_input = Input(shape=(<span class="literal">None</span>, ), dtype=<span class="string">&#x27;int32&#x27;</span>, name=<span class="string">&#x27;text&#x27;</span>)</span><br><span class="line">embedded_text = layers.Embedding(text_vocabulary_size, <span class="number">64</span>)(text_input)</span><br><span class="line">encoded_text = layers.LSTM(<span class="number">32</span>)(embedded_text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é—®é¢˜</span></span><br><span class="line">question_input = Input(shape=(<span class="literal">None</span>, ), dtype=<span class="string">&#x27;int32&#x27;</span>, name=<span class="string">&#x27;question&#x27;</span>)</span><br><span class="line">embedded_question = layers.Embedding(question_vocabulary_size, <span class="number">32</span>)(question_input)</span><br><span class="line">encoded_question = layers.LSTM(<span class="number">16</span>)(embedded_question)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå¹¶å‚è€ƒã€é—®é¢˜åˆ†æ”¯</span></span><br><span class="line">concatenated = layers.concatenate([encoded_text, encoded_question], axis=-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é¡¶å±‚åˆ†ç±»å™¨</span></span><br><span class="line">answer = layers.Dense(anser_vocabulary_size, activation=<span class="string">&#x27;softmax&#x27;</span>)(concatenated)</span><br><span class="line"></span><br><span class="line">model = Model([text_input, question_input], answer, name=<span class="string">&#x27;QA&#x27;</span>)</span><br><span class="line"></span><br><span class="line">model.summary()</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>, </span><br><span class="line">              loss=<span class="string">&#x27;categorical_crossentropy&#x27;</span>, </span><br><span class="line">              metrics=[<span class="string">&#x27;acc&#x27;</span>])</span><br></pre></td></tr></table></figure><pre><code>Model: &quot;QA&quot;__________________________________________________________________________________________________Layer (type)                    Output Shape         Param #     Connected to                     ==================================================================================================text (InputLayer)               [(None, None)]       0                                            __________________________________________________________________________________________________question (InputLayer)           [(None, None)]       0                                            __________________________________________________________________________________________________embedding_13 (Embedding)        (None, None, 64)     640000      text[0][0]                       __________________________________________________________________________________________________embedding_14 (Embedding)        (None, None, 32)     320000      question[0][0]                   __________________________________________________________________________________________________lstm_13 (LSTM)                  (None, 32)           12416       embedding_13[0][0]               __________________________________________________________________________________________________lstm_14 (LSTM)                  (None, 16)           3136        embedding_14[0][0]               __________________________________________________________________________________________________concatenate_6 (Concatenate)     (None, 48)           0           lstm_13[0][0]                                                                                     lstm_14[0][0]                    __________________________________________________________________________________________________dense_13 (Dense)                (None, 500)          24500       concatenate_6[0][0]              ==================================================================================================Total params: 1,000,052Trainable params: 1,000,052Non-trainable params: 0__________________________________________________________________________________________________</code></pre><p>åœ¨è®­ç»ƒè¿™ç§å¤šè¾“å…¥æ¨¡å‹çš„æ—¶å€™ï¼Œå¯ä»¥ä¼ è¾“å…¥ç»„æˆçš„åˆ—è¡¨ï¼Œå¯¹äºæŒ‡å®šäº† name çš„ input ä¹Ÿå¯ä»¥ä¼ ä¸€ä¸ªå­—å…¸ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">num_samples = <span class="number">1000</span></span><br><span class="line">max_length = <span class="number">100</span></span><br><span class="line"></span><br><span class="line">text = np.random.randint(<span class="number">1</span>, text_vocabulary_size, </span><br><span class="line">                         size=(num_samples, max_length))</span><br><span class="line">question = np.random.randint(<span class="number">1</span>, question_vocabulary_size, </span><br><span class="line">                             size=(num_samples, max_length))</span><br><span class="line">answers = np.random.randint(<span class="number">0</span>, <span class="number">1</span>, </span><br><span class="line">                            size=(num_samples, answer_vocabulary_size)) <span class="comment"># one-hot ç¼–ç çš„</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•1. ä¼ åˆ—è¡¨</span></span><br><span class="line">model.fit([text, question], answers, epochs=<span class="number">2</span>, batch_size=<span class="number">128</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•2. ä¼ å­—å…¸</span></span><br><span class="line">model.fit(&#123;<span class="string">&#x27;text&#x27;</span>: text, <span class="string">&#x27;question&#x27;</span>: question&#125;, answers, epochs=<span class="number">2</span>, batch_size=<span class="number">128</span>)</span><br></pre></td></tr></table></figure><pre><code>Epoch 1/28/8 [==============================] - 0s 54ms/step - loss: 0.0000e+00 - acc: 0.0000e+00Epoch 2/28/8 [==============================] - 0s 57ms/step - loss: 0.0000e+00 - acc: 0.0000e+00Epoch 1/28/8 [==============================] - 0s 53ms/step - loss: 0.0000e+00 - acc: 0.0000e+00Epoch 2/28/8 [==============================] - 0s 54ms/step - loss: 0.0000e+00 - acc: 0.0000e+00&lt;tensorflow.python.keras.callbacks.History at 0x13e55f9d0&gt;</code></pre><h3 id="å¤šè¾“å‡ºæ¨¡å‹"><a href="#å¤šè¾“å‡ºæ¨¡å‹" class="headerlink" title="å¤šè¾“å‡ºæ¨¡å‹"></a>å¤šè¾“å‡ºæ¨¡å‹</h3><p>ç”¨å‡½æ•°å¼ API æ¥æ„å»ºå…·æœ‰å¤šä¸ªè¾“å‡º(å¤šå¤´)çš„æ¨¡å‹ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦åšä¸€ä¸ªè¯•å›¾åŒæ—¶é¢„æµ‹æ•°æ®çš„ä¸åŒæ€§è´¨çš„ç½‘ç»œï¼šè¾“å…¥æŸäººçš„ä¸€äº›ç¤¾äº¤åª’ä½“å‘å¸–ï¼Œå°è¯•é¢„æµ‹è¯¥äººçš„å¹´é¾„ã€æ€§åˆ«å’Œæ”¶å…¥æ°´å¹³å±æ€§ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gho2fgeqwrj30q40bit9u.jpg" alt="å…·æœ‰ä¸‰ä¸ªå¤´çš„ç¤¾äº¤åª’ä½“æ¨¡å‹"></p><p>å…·ä½“çš„å®ç°å¾ˆç®€å•ï¼Œåœ¨æœ€ååˆ†åˆ«å†™ 3 ä¸ªä¸åŒçš„è¾“å‡ºå°±è¡Œäº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> Conv1D, MaxPooling1D, GlobalMaxPool1D, Dense</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> Input</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Model</span><br><span class="line"></span><br><span class="line">vocabulary_size = <span class="number">50000</span></span><br><span class="line">num_income_groups = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">posts_input = Input(shape=(<span class="literal">None</span>,), dtype=<span class="string">&#x27;int32&#x27;</span>, name=<span class="string">&#x27;posts&#x27;</span>)</span><br><span class="line">embedded_post = layers.Embedding(<span class="number">256</span>, vocabulary_size)(posts_input)</span><br><span class="line">x = Conv1D(<span class="number">128</span>, <span class="number">5</span>, activation=<span class="string">&#x27;relu&#x27;</span>)(embedded_post)</span><br><span class="line">x = MaxPooling1D(<span class="number">5</span>)(x)</span><br><span class="line">x = Conv1D(<span class="number">256</span>, <span class="number">5</span>, activation=<span class="string">&quot;relu&quot;</span>)(x)</span><br><span class="line">x = Conv1D(<span class="number">256</span>, <span class="number">5</span>, activation=<span class="string">&quot;relu&quot;</span>)(x)</span><br><span class="line">x = MaxPooling1D(<span class="number">5</span>)(x)</span><br><span class="line">x = Conv1D(<span class="number">256</span>, <span class="number">5</span>, activation=<span class="string">&quot;relu&quot;</span>)(x)</span><br><span class="line">x = Conv1D(<span class="number">256</span>, <span class="number">5</span>, activation=<span class="string">&quot;relu&quot;</span>)(x)</span><br><span class="line">x = GlobalMaxPool1D()(x)</span><br><span class="line">x = Dense(<span class="number">128</span>, activation=<span class="string">&#x27;relu&#x27;</span>)(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰å¤šä¸ªå¤´ï¼ˆè¾“å‡ºï¼‰</span></span><br><span class="line">age_prediction = Dense(<span class="number">1</span>, name=<span class="string">&#x27;age&#x27;</span>)(x)</span><br><span class="line">income_prediction = Dense(num_income_groups, activation=<span class="string">&#x27;softmax&#x27;</span>, name=<span class="string">&#x27;income&#x27;</span>)(x)</span><br><span class="line">gender_prediction = Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>, name=<span class="string">&#x27;gender&#x27;</span>)(x)</span><br><span class="line"></span><br><span class="line">model = Model(posts_input, [age_prediction, income_prediction, gender_prediction])</span><br><span class="line"></span><br><span class="line">model.summary()</span><br></pre></td></tr></table></figure><pre><code>Model: &quot;functional_6&quot;__________________________________________________________________________________________________Layer (type)                    Output Shape         Param #     Connected to                     ==================================================================================================posts (InputLayer)              [(None, None)]       0                                            __________________________________________________________________________________________________embedding_15 (Embedding)        (None, None, 50000)  12800000    posts[0][0]                      __________________________________________________________________________________________________conv1d (Conv1D)                 (None, None, 128)    32000128    embedding_15[0][0]               __________________________________________________________________________________________________max_pooling1d (MaxPooling1D)    (None, None, 128)    0           conv1d[0][0]                     __________________________________________________________________________________________________conv1d_1 (Conv1D)               (None, None, 256)    164096      max_pooling1d[0][0]              __________________________________________________________________________________________________conv1d_2 (Conv1D)               (None, None, 256)    327936      conv1d_1[0][0]                   __________________________________________________________________________________________________max_pooling1d_1 (MaxPooling1D)  (None, None, 256)    0           conv1d_2[0][0]                   __________________________________________________________________________________________________conv1d_3 (Conv1D)               (None, None, 256)    327936      max_pooling1d_1[0][0]            __________________________________________________________________________________________________conv1d_4 (Conv1D)               (None, None, 256)    327936      conv1d_3[0][0]                   __________________________________________________________________________________________________global_max_pooling1d (GlobalMax (None, 256)          0           conv1d_4[0][0]                   __________________________________________________________________________________________________dense_14 (Dense)                (None, 128)          32896       global_max_pooling1d[0][0]       __________________________________________________________________________________________________age (Dense)                     (None, 1)            129         dense_14[0][0]                   __________________________________________________________________________________________________income (Dense)                  (None, 10)           1290        dense_14[0][0]                   __________________________________________________________________________________________________gender (Dense)                  (None, 1)            129         dense_14[0][0]                   ==================================================================================================Total params: 45,982,476Trainable params: 45,982,476Non-trainable params: 0__________________________________________________________________________________________________</code></pre><p><strong>å¤šå¤´æ¨¡å‹çš„ç¼–è¯‘</strong></p><p>åœ¨ç¼–è¯‘è¿™ç§æ¨¡å‹çš„æ—¶å€™ï¼Œç”±äºæ˜¯æœ‰ä¸åŒçš„ç›®æ ‡ï¼Œæ‰€ä»¥è¦æ³¨æ„éœ€è¦å¯¹ç½‘ç»œçš„å„ä¸ªå¤´æŒ‡å®šä¸åŒçš„æŸå¤±å‡½æ•°ã€‚</p><p>ä½†æ¢¯åº¦ä¸‹é™çš„ä½œç”¨åªèƒ½æ˜¯å°†ä¸€ä¸ªæ ‡é‡æœ€å°åŒ–ï¼Œæ‰€ä»¥åœ¨ Keras ä¸­ï¼Œç¼–è¯‘æ—¶ä¸ºä¸åŒè¾“å‡ºæŒ‡å®šçš„ä¸åŒæŸå¤±ï¼Œåˆ°äº†è®­ç»ƒä¸­ï¼Œä¼šè¢«ç›¸åŠ å¾—åˆ°ä¸€ä¸ªå…¨å±€æŸå¤±ï¼Œè®­ç»ƒè¿‡ç¨‹å°±æ˜¯å°†è¿™ä¸ªå…¨å±€æŸå¤±æœ€å°åŒ–ã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæŸå¤±è´¡çŒ®ä¸¥é‡ä¸å¹³è¡¡ï¼Œæ¨¡å‹å°±ä¼šä¼˜å…ˆå»ä¼˜åŒ–æŸå¤±æ•°å€¼æœ€å¤§çš„ä»»åŠ¡ï¼Œè€Œä¸è€ƒè™‘å…¶ä»–ä»»åŠ¡ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä¸ºä¸åŒçš„æŸå¤±åŠ æƒã€‚ä¾‹å¦‚ mse çš„æŸå¤±å€¼é€šå¸¸æ˜¯ 3~5ï¼Œbinary_crossentropy çš„æŸå¤±å€¼é€šå¸¸ä½è‡³ 0.1ï¼Œä¸ºäº†å¹³è¡¡æŸå¤±è´¡çŒ®ï¼Œæˆ‘ä»¬å¯ä»¥è®© binary_crossentropy çš„æƒé‡å– 10ã€mse æŸå¤±çš„æƒé‡å– 0.5ã€‚</p><p>å¤šä¸ªæŸå¤±ä»¥åŠåŠ æƒçš„æŒ‡å®šéƒ½æ˜¯ä½¿ç”¨åˆ—è¡¨æˆ–å­—å…¸æ¥å®Œæˆï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>,</span><br><span class="line">              loss=[<span class="string">&#x27;mse&#x27;</span>, <span class="string">&#x27;categorical_crossentropy&#x27;</span>, <span class="string">&#x27;binary_crossentropy&#x27;</span>],</span><br><span class="line">              loss_weights=[<span class="number">0.25</span>, <span class="number">1.</span>, <span class="number">10.</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…å¦‚æœæœ‰å¯¹è¾“å‡ºå±‚å‘½åçš„è¯ï¼Œå¯ä»¥ç”¨å­—å…¸ï¼š</span></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>,</span><br><span class="line">              loss=&#123;<span class="string">&#x27;age&#x27;</span>: <span class="string">&#x27;mse&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;income&#x27;</span>: <span class="string">&#x27;categorical_crossentropy&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;gender&#x27;</span>: <span class="string">&#x27;binary_crossentropy&#x27;</span>&#125;,</span><br><span class="line">              loss_weights=&#123;<span class="string">&#x27;age&#x27;</span>: <span class="number">0.25</span>,</span><br><span class="line">                            <span class="string">&#x27;income&#x27;</span>: <span class="number">1.</span>,</span><br><span class="line">                            <span class="string">&#x27;gender&#x27;</span>: <span class="number">10.</span>&#125;)</span><br></pre></td></tr></table></figure><p><strong>å¤šå¤´æ¨¡å‹çš„è®­ç»ƒ</strong></p><p>è®­ç»ƒè¿™ç§æ¨¡å‹çš„æ—¶å€™ï¼ŒæŠŠç›®æ ‡è¾“å‡ºç”¨åˆ—è¡¨æˆ–å­—å…¸ä¼ é€’å°±å¥½äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">model.fit(posts, [age_targets, income_targets, gender_targets],</span><br><span class="line">          epochs=<span class="number">10</span>, batch_size=<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># or</span></span><br><span class="line"></span><br><span class="line">model.fit(posts, &#123;<span class="string">&#x27;age&#x27;</span>: age_targets,</span><br><span class="line">                  <span class="string">&#x27;income&#x27;</span>: income_targets,</span><br><span class="line">                  <span class="string">&#x27;gender&#x27;</span>: gender_targets&#125;,</span><br><span class="line">          epochs=<span class="number">10</span>, batch_size=<span class="number">64</span>)</span><br></pre></td></tr></table></figure><h3 id="å±‚çš„æœ‰å‘æ— ç¯å›¾"><a href="#å±‚çš„æœ‰å‘æ— ç¯å›¾" class="headerlink" title="å±‚çš„æœ‰å‘æ— ç¯å›¾"></a>å±‚çš„æœ‰å‘æ— ç¯å›¾</h3><p>åˆ©ç”¨å‡½æ•°å¼ APIï¼Œé™¤äº†æ„å»ºå¤šè¾“å…¥å’Œå¤šè¾“å‡ºçš„æ¨¡å‹ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å®ç°å…·æœ‰å¤æ‚çš„å†…éƒ¨æ‹“æ‰‘ç»“æ„çš„ç½‘ç»œã€‚</p><p>å®é™…ä¸Š Keras ä¸­çš„ç¥ç»ç½‘ç»œå¯ä»¥æ˜¯ç”±å±‚ç»„æˆçš„ä»»æ„æœ‰å‘æ— ç¯å›¾ã€‚æ¯”è¾ƒè‘—åçš„å›¾ç»“æ„çš„ç»„ä»¶æœ‰ Inception æ¨¡å—å’Œæ®‹å·®è¿æ¥ã€‚</p><h4 id="Inception-æ¨¡å—"><a href="#Inception-æ¨¡å—" class="headerlink" title="Inception æ¨¡å—"></a>Inception æ¨¡å—</h4><p>Inception æ˜¯æ¨¡å—çš„å †å ï¼Œå…¶ä¸­çš„æ¯ä¸ªæ¨¡å—çœ‹èµ·æ¥åƒæ˜¯å°å‹çš„ç‹¬ç«‹ç½‘ç»œï¼Œè¿™äº›æ¨¡å—è¢«åˆ†ä¸ºå¤šä¸ªå¹¶è¡Œåˆ†æ”¯ï¼Œæœ€åå°†æ‰€å¾—åˆ°çš„ç‰¹å¾è¿æ¥åˆ°ä¸€èµ·ã€‚è¿™ç§æ“ä½œå¯ä»¥è®©ç½‘ç»œåˆ†åˆ«å­¦ä¹ å›¾ç‰‡çš„ç©ºé—´ç‰¹å¾å’Œé€é€šé“çš„ç‰¹å¾ï¼Œè¿™æ ·ä¼šæ¯”ç”¨ä¸€ä¸ªç½‘ç»œå»åŒæ—¶å­¦ä¹ è¿™äº›ç‰¹å¾æ›´åŠ æœ‰æ•ˆã€‚</p><p>ä¸‹å›¾æ˜¯ä¸€ä¸ªç®€åŒ–çš„ Inception V3 æ¨¡å—ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gho3zlsj9bj31200j6act.jpg" alt="Inception æ¨¡å—"></p><blockquote><p>æ³¨ï¼šè¿™é‡Œç”¨çš„ 1x1 çš„å·ç§¯ï¼Œå«ä½œé€ç‚¹å·ç§¯(pointwise convolution)ï¼Œæ˜¯ Inception æ¨¡å—çš„ç‰¹è‰²ã€‚<br>å®ƒä¸€æ¬¡åªæŸ¥çœ‹ä¸€ä¸ªåƒç´ ï¼Œè®¡ç®—å¾—åˆ°çš„ç‰¹å¾å°±èƒ½å¤Ÿå°†è¾“å…¥çš„å„é€šé“ä¸­çš„ä¿¡æ¯æ··åˆåœ¨ä¸€èµ·ï¼Œä½†åˆä¸ä¼šæ··å…¥ç©ºé—´ä¿¡æ¯ã€‚<br>è¿™æ ·å°±å®ç°äº†åŒºåˆ†å¼€é€šé“ç‰¹å¾å­¦ä¹ å’Œç©ºé—´ç‰¹å¾å­¦ä¹ ã€‚</p></blockquote><p>ç”¨å‡½æ•°å¼ API å¯ä»¥å®ç°å®ƒï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"></span><br><span class="line">x = Input(shape=(<span class="literal">None</span>, <span class="literal">None</span>, <span class="number">3</span>))    <span class="comment"># RGB å›¾ç‰‡</span></span><br><span class="line"></span><br><span class="line">branch_a = layers.Conv2D(<span class="number">128</span>, <span class="number">1</span>, activation=<span class="string">&#x27;relu&#x27;</span>, strides=<span class="number">2</span>, padding=<span class="string">&#x27;same&#x27;</span>)(x)</span><br><span class="line"></span><br><span class="line">branch_b = layers.Conv2D(<span class="number">128</span>, <span class="number">1</span>, activation=<span class="string">&#x27;relu&#x27;</span>, padding=<span class="string">&#x27;same&#x27;</span>)(x)</span><br><span class="line">branch_b = layers.Conv2D(<span class="number">128</span>, <span class="number">3</span>, activation=<span class="string">&#x27;relu&#x27;</span>, strides=<span class="number">2</span>, padding=<span class="string">&#x27;same&#x27;</span>)(branch_b)</span><br><span class="line"></span><br><span class="line">branch_c = layers.AveragePooling2D(<span class="number">3</span>, strides=<span class="number">2</span>, padding=<span class="string">&#x27;same&#x27;</span>)(x)</span><br><span class="line">branch_c = layers.Conv2D(<span class="number">128</span>, <span class="number">3</span>, activation=<span class="string">&#x27;relu&#x27;</span>, padding=<span class="string">&#x27;same&#x27;</span>)(branch_c)</span><br><span class="line"></span><br><span class="line">branch_d = layers.Conv2D(<span class="number">128</span>, <span class="number">1</span>, activation=<span class="string">&#x27;relu&#x27;</span>, padding=<span class="string">&#x27;same&#x27;</span>)(x)</span><br><span class="line">branch_d = layers.Conv2D(<span class="number">128</span>, <span class="number">3</span>, activation=<span class="string">&#x27;relu&#x27;</span>, padding=<span class="string">&#x27;same&#x27;</span>)(branch_d)</span><br><span class="line">branch_d = layers.Conv2D(<span class="number">128</span>, <span class="number">3</span>, activation=<span class="string">&#x27;relu&#x27;</span>, strides=<span class="number">2</span>, padding=<span class="string">&#x27;same&#x27;</span>)(branch_d)</span><br><span class="line"></span><br><span class="line">output = layers.concatenate([branch_a, branch_b, branch_c, branch_d], axis=-<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>å…¶å®ï¼ŒKeras å†…ç½®äº†å®Œæ•´çš„ Inception V3 æ¶æ„ã€‚å¯ä»¥é€šè¿‡ <code>keras.applications.inception_v3.InceptionV3</code> å»è°ƒç”¨ã€‚</p><p>ä¸ Inception ç›¸å…³çš„ï¼Œè¿˜æœ‰ä¸€ä¸ªå«åš <strong>Xception</strong> çš„ä¸œè¥¿ã€‚Xception è¿™ä¸ªè¯æ˜¯ extreme inceptionï¼ˆæç«¯ Inceptionï¼‰çš„æ„æ€ï¼Œå®ƒæ˜¯ä¸€ç§æ¯”è¾ƒæç«¯çš„ Inceptionï¼Œå®ƒå°†é€šé“ç‰¹å¾å­¦ä¹ ä¸ç©ºé—´ç‰¹å¾å­¦ä¹ å®Œå…¨åˆ†ç¦»å¼€ã€‚Xception çš„å‚æ•°ä¸ªæ•°ä¸ Inception V3 å¤§è‡´ç›¸åŒï¼Œä½†å®ƒå¯¹å‚æ•°çš„ä½¿ç”¨æ•ˆç‡æ›´é«˜ï¼Œæ‰€ä»¥åœ¨å¤§è§„æ¨¡æ•°æ®é›†ä¸Šçš„è¿è¡Œæ€§èƒ½æ›´å¥½ã€ç²¾åº¦æ›´é«˜ã€‚</p><h4 id="æ®‹å·®è¿æ¥"><a href="#æ®‹å·®è¿æ¥" class="headerlink" title="æ®‹å·®è¿æ¥"></a>æ®‹å·®è¿æ¥</h4><p>æ®‹å·®è¿æ¥(residual connection) æ˜¯ä¸€ç§ç°åœ¨å¾ˆå¸¸ç”¨çš„ç»„ä»¶ï¼Œå®ƒè§£å†³äº†å¤§è§„æ¨¡æ·±åº¦å­¦ä¹ æ¨¡å‹æ¢¯åº¦æ¶ˆå¤±å’Œè¡¨ç¤ºç“¶é¢ˆé—®é¢˜ã€‚é€šå¸¸ï¼Œå‘ä»»ä½•å¤šäº 10 å±‚çš„æ¨¡å‹ä¸­æ·»åŠ æ®‹å·®è¿æ¥ï¼Œéƒ½å¯èƒ½ä¼šæœ‰æ‰€å¸®åŠ©ã€‚</p><ul><li>æ¢¯åº¦æ¶ˆå¤±ï¼šå°±æ˜¯ç»è¿‡çš„å±‚å¤šäº†ï¼Œä¹‹å‰å­¦åˆ°çš„è¡¨ç¤ºå˜å¾—æ¨¡ç³Šï¼Œç”šè‡³å®Œå…¨ä¸¢å¤±ï¼Œå¯¼è‡´ç½‘ç»œæ— æ³•è®­ç»ƒã€‚</li><li>è¡¨ç¤ºç“¶é¢ˆï¼šå †å èµ·æ¥å±‚ï¼Œåä¸€å±‚åªèƒ½è®¿é—®åˆ°å‰ä¸€å±‚å­¦åˆ°çš„ä¸œè¥¿ã€‚å¦‚æœæŸä¸€å±‚å¤ªå°ï¼ˆæ¿€æ´»ä¸­èƒ½å¤Ÿå¡å…¥çš„ä¿¡æ¯å°‘ï¼‰å°±æŠŠä¿¡æ¯å¡ä¸‹æ¥ï¼Œå‡ºç°ç“¶é¢ˆäº†ã€‚</li></ul><p>æ®‹å·®è¿æ¥æ˜¯è®©å‰é¢æŸå±‚çš„è¾“å‡ºä½œä¸ºåé¢æŸå±‚çš„è¾“å…¥ï¼ˆåœ¨ç½‘ç»œä¸­åˆ›é€ æ·å¾„ï¼‰ã€‚å‰é¢å±‚çš„è¾“å‡ºå¹¶æ²¡æœ‰ä¸åé¢å±‚çš„æ¿€æ´»è¿æ¥åœ¨ä¸€èµ·ï¼Œè€Œæ˜¯ä¸åé¢å±‚çš„æ¿€æ´»ç›¸åŠ ï¼ˆè‹¥å½¢çŠ¶ä¸åŒï¼Œç”¨çº¿æ€§å˜æ¢å°†å‰é¢å±‚çš„æ¿€æ´»æ”¹å˜æˆç›®æ ‡å½¢çŠ¶ï¼‰ã€‚</p><blockquote><p>æ³¨ï¼šçº¿æ€§å˜æ¢å¯ä»¥ç”¨ä¸å¸¦æ¿€æ´»çš„ Dense å±‚ï¼Œæˆ–ç€åœ¨ CNN ä¸­ç”¨ä¸å¸¦æ¿€æ´» 1Ã—1 å·ç§¯ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> keras <span class="keyword">import</span> layers</span><br><span class="line"></span><br><span class="line">x = ...</span><br><span class="line"></span><br><span class="line">y = layers.Conv2D(<span class="number">128</span>, <span class="number">3</span>, activation=<span class="string">&#x27;relu&#x27;</span>, padding=<span class="string">&#x27;same&#x27;</span>)(x)</span><br><span class="line">y = layers.Conv2D(<span class="number">128</span>, <span class="number">3</span>, activation=<span class="string">&#x27;relu&#x27;</span>, padding=<span class="string">&#x27;same&#x27;</span>)(y)</span><br><span class="line">y = layers.MaxPooling2D(<span class="number">2</span>, strides=<span class="number">2</span>)(y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å½¢çŠ¶ä¸åŒï¼Œè¦åšçº¿æ€§å˜æ¢ï¼š</span></span><br><span class="line">residual = layers.Conv2D(<span class="number">128</span>, <span class="number">1</span>, strides=<span class="number">2</span>, padding=<span class="string">&#x27;same&#x27;</span>)(x)  <span class="comment"># ä½¿ç”¨ 1Ã—1 å·ç§¯ï¼Œå°† x çº¿æ€§ä¸‹é‡‡æ ·ä¸ºä¸ y å…·æœ‰ç›¸åŒçš„å½¢çŠ¶</span></span><br><span class="line"></span><br><span class="line">y = layers.add([y, residual])</span><br></pre></td></tr></table></figure><h4 id="å…±äº«å±‚æƒé‡"><a href="#å…±äº«å±‚æƒé‡" class="headerlink" title="å…±äº«å±‚æƒé‡"></a>å…±äº«å±‚æƒé‡</h4><p>ä½¿ç”¨å‡½æ•°å¼ APIï¼Œè¿˜æœ‰ä¸€ç§æ“ä½œæ˜¯<strong>å¤šæ¬¡ä½¿ç”¨ä¸€ä¸ªå±‚å®ä¾‹</strong>ã€‚å¯¹åŒä¸€ä¸ªå±‚å®ä¾‹è°ƒç”¨å¤šæ¬¡ï¼Œåˆ™å¯ä»¥é‡å¤ä½¿ç”¨ç›¸åŒçš„æƒé‡ã€‚åˆ©ç”¨è¿™ç§ç‰¹æ€§ï¼Œå¯ä»¥æ„å»ºå‡ºå…·æœ‰å…±äº«åˆ†æ”¯çš„æ¨¡å‹ï¼Œå³å‡ ä¸ªåˆ†æ”¯å…¨éƒ½å…±äº«ç›¸åŒçš„çŸ¥è¯†å¹¶æ‰§è¡Œç›¸åŒçš„è¿ç®—ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬æƒ³è¦è¯„ä¼°ä¸¤ä¸ªå¥å­ä¹‹é—´çš„è¯­ä¹‰ç›¸ä¼¼åº¦ã€‚è¿™ä¸ªæ¨¡å‹æœ‰è¾“å…¥ä¸¤ä¸ªå¥å­ï¼Œè¾“å‡ºä¸€ä¸ªèŒƒå›´åœ¨ 0~1 çš„åˆ†æ•°ï¼Œå€¼è¶Šå¤§åˆ™å¥æ„è¶Šç›¸ä¼¼ã€‚</p><p>åœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œä¸¤ä¸ªè¾“å…¥å¥å­æ˜¯å¯ä»¥äº’æ¢çš„ï¼ˆå¥å­ A ç›¸å¯¹äº B çš„ç›¸ä¼¼åº¦ç­‰äº B ç›¸å¯¹äº A çš„ç›¸ä¼¼åº¦ï¼‰ã€‚å› æ­¤ï¼Œä¸åº”è¯¥å­¦ä¹ ä¸¤ä¸ªå•ç‹¬çš„æ¨¡å‹æ¥åˆ†åˆ«å¤„ç†ä¸¤ä¸ªè¾“å…¥å¥å­ã€‚è€Œåº”è¯¥ç”¨ä¸€ä¸ª LSTM å±‚æ¥å¤„ç†ä¸¤ä¸ªå¥å­ã€‚è¿™ä¸ª LSTM å±‚çš„è¡¨ç¤º(æƒé‡)æ˜¯åŒæ—¶ä»ä¸¤ä¸ªè¾“å…¥å­¦ä¹ æ¥çš„ã€‚è¿™ç§æ¨¡å‹ç§°ä¸ºè¿ä½“ LSTM (Siamese LSTM)æˆ–å…±äº« LSTM (shared LSTM)ã€‚</p><p>è¿™æ ·çš„æ¨¡å‹ä½¿ç”¨ Keras å‡½æ•°å¼ API ä¸­çš„å±‚å…±äº«å®ç°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> Input</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Model</span><br><span class="line"></span><br><span class="line">lstm = layers.LSTM(<span class="number">32</span>)  <span class="comment"># åªç¤ºä¾‹åŒ–ä¸€ä¸ª LSTM</span></span><br><span class="line"></span><br><span class="line">left_input = Input(shape=(<span class="literal">None</span>, <span class="number">128</span>))</span><br><span class="line">left_output = lstm(left_input)</span><br><span class="line"></span><br><span class="line">right_input = Input(shape=(<span class="literal">None</span>, <span class="number">128</span>))</span><br><span class="line">right_output = lstm(right_input)</span><br><span class="line"></span><br><span class="line">merged = layers.concatenate([left_output, right_output], axis=-<span class="number">1</span>)</span><br><span class="line">predictions = layers.Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>)(merged)</span><br><span class="line"></span><br><span class="line">model = Model([left_input, right_input], predictions)</span><br><span class="line"></span><br><span class="line">model.summary()</span><br></pre></td></tr></table></figure><pre><code>Model: &quot;functional_8&quot;__________________________________________________________________________________________________Layer (type)                    Output Shape         Param #     Connected to                     ==================================================================================================input_13 (InputLayer)           [(None, None, 128)]  0                                            __________________________________________________________________________________________________input_14 (InputLayer)           [(None, None, 128)]  0                                            __________________________________________________________________________________________________lstm_15 (LSTM)                  (None, 32)           20608       input_13[0][0]                                                                                    input_14[0][0]                   __________________________________________________________________________________________________concatenate_13 (Concatenate)    (None, 64)           0           lstm_15[0][0]                                                                                     lstm_15[1][0]                    __________________________________________________________________________________________________dense_15 (Dense)                (None, 1)            65          concatenate_13[0][0]             ==================================================================================================Total params: 20,673Trainable params: 20,673Non-trainable params: 0__________________________________________________________________________________________________</code></pre><h4 id="å°†æ¨¡å‹ä½œä¸ºå±‚"><a href="#å°†æ¨¡å‹ä½œä¸ºå±‚" class="headerlink" title="å°†æ¨¡å‹ä½œä¸ºå±‚"></a>å°†æ¨¡å‹ä½œä¸ºå±‚</h4><p>åœ¨ Keras ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ¨¡å‹å½“ä½œå±‚ä½¿ç”¨ï¼ˆæŠŠæ¨¡å‹ç°è±¡ä¸ºä¸€ä¸ªå¤§çš„å±‚ï¼‰ï¼ŒSequential ç±»å’Œ Model ç±»éƒ½å¯ä»¥å½“å±‚ç”¨ã€‚ç›´æ¥åƒå±‚ä¸€æ ·å»å‡½æ•°å¼åœ°è°ƒç”¨å°±è¡Œäº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">y = model(x)</span><br><span class="line">y1, y2 = model_with_multi_inputs_and_outputs([x1, x2])</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¤„ç†åŒæ‘„åƒå¤´ä½œä¸ºè¾“å…¥çš„è§†è§‰æ¨¡å‹ï¼ˆè¿™ç§æ¨¡å‹å¯ä»¥æ„ŸçŸ¥æ·±åº¦ï¼‰ã€‚æˆ‘ä»¬ä¸€ä¸ªç”¨ applications.Xception æ¨¡å‹ä½œä¸ºå±‚ï¼Œå¹¶ä½¿ç”¨å‰é¢çš„å…±äº«å±‚çš„æ–¹æ³•æ¥å®ç°è¿™ä¸ªç½‘ç»œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> Input</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> applications</span><br><span class="line"></span><br><span class="line">xception_base = applications.Xception(weights=<span class="literal">None</span>, include_top=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">left_input = Input(shape=(<span class="number">250</span>, <span class="number">250</span>, <span class="number">3</span>))</span><br><span class="line">right_input = Input(shape=(<span class="number">250</span>, <span class="number">250</span>, <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">left_features = xception_base(left_input)</span><br><span class="line">right_input = xception_base(right_input)</span><br><span class="line"></span><br><span class="line">merged_features = layers.concatenate([left_features, right_input], axis=-<span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">By(<span class="string">&quot;CDFMLR&quot;</span>, <span class="string">&quot;2020-08-17&quot;</span>);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> Deep Learning with Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
            <tag> Deep Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonæ·±åº¦å­¦ä¹ ä¹‹ç”¨å·ç§¯ç¥ç»ç½‘ç»œå¤„ç†åºåˆ—</title>
      <link href="/2020/08/14/DeepLearningWithPython/Deep-Learning%20with-Python-ch6_4/"/>
      <url>/2020/08/14/DeepLearningWithPython/Deep-Learning%20with-Python-ch6_4/</url>
      
        <content type="html"><![CDATA[<h1 id="Deep-Learning-with-Python"><a href="#Deep-Learning-with-Python" class="headerlink" title="Deep Learning with Python"></a>Deep Learning with Python</h1><p>è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘å­¦ä¹ ã€ŠDeep Learning with Pythonã€‹(ç¬¬äºŒç‰ˆï¼ŒFranÃ§ois Chollet è‘—) æ—¶å†™çš„ç³»åˆ—ç¬”è®°ä¹‹ä¸€ã€‚æ–‡ç« çš„å†…å®¹æ˜¯ä»  Jupyter notebooks è½¬æˆ Markdown çš„ï¼Œä½ å¯ä»¥å» <a href="https://github.com/cdfmlr/Deep-Learning-with-Python-Notebooks">GitHub</a> æˆ– <a href="https://gitee.com/cdfmlr/Deep-Learning-with-Python-Notebooks">Gitee</a> æ‰¾åˆ°åŸå§‹çš„ <code>.ipynb</code> ç¬”è®°æœ¬ã€‚</p><p>ä½ å¯ä»¥å»<a href="https://livebook.manning.com/book/deep-learning-with-python">è¿™ä¸ªç½‘ç«™åœ¨çº¿é˜…è¯»è¿™æœ¬ä¹¦çš„æ­£ç‰ˆåŸæ–‡</a>(è‹±æ–‡)ã€‚è¿™æœ¬ä¹¦çš„ä½œè€…ä¹Ÿç»™å‡ºäº†é…å¥—çš„ <a href="https://github.com/fchollet/deep-learning-with-python-notebooks">Jupyter notebooks</a>ã€‚</p><p>æœ¬æ–‡ä¸º <strong>ç¬¬6ç«   æ·±åº¦å­¦ä¹ ç”¨äºæ–‡æœ¬å’Œåºåˆ—</strong> (Chapter 6. <em>Deep learning for text and sequences</em>) çš„ç¬”è®°ã€‚</p><p>[TOC]</p><h2 id="6-4-Sequence-processing-with-convnets"><a href="#6-4-Sequence-processing-with-convnets" class="headerlink" title="6.4 Sequence processing with convnets"></a>6.4 Sequence processing with convnets</h2><blockquote><p>ç”¨å·ç§¯ç¥ç»ç½‘ç»œå¤„ç†åºåˆ—</p></blockquote><p>å·ç§¯ç¥ç»ç½‘ç»œå¯ä»¥æœ‰æ•ˆåˆ©ç”¨æ•°æ®ï¼Œæå–å±€éƒ¨ç‰¹å¾ï¼Œå°†è¡¨ç¤ºæ¨¡å—åŒ–ã€‚ç”±äºè¿™ç§ç‰¹æ•ˆï¼ŒCNN ä¸ä½†å–„äºå¤„ç†è®¡ç®—æœºæ—¶é—´é—®é¢˜ï¼Œä¹Ÿå¯ä»¥é«˜æ•ˆå¤„ç†åºåˆ—é—®é¢˜ï¼Œåœ¨æœ‰äº›åºåˆ—é—®é¢˜ä¸Šï¼ŒCNN çš„æ•ˆæœã€æ•ˆç‡ç”šè‡³å¯ä»¥è¶…è¿‡ RNNã€‚</p><p>ä¸åŒäºå¤„ç†å›¾åƒç”¨çš„äºŒç»´ Conv2Dï¼Œæ—¶é—´åºåˆ—æ˜¯ä¸€ç»´çš„ï¼Œæ‰€ä»¥è¦ç”¨ä¸€ç»´å·ç§¯ç¥ç»ç½‘ç»œæ¥å¤„ç†ã€‚</p><h3 id="åºåˆ—æ•°æ®çš„ä¸€ç»´å·ç§¯ã€æ± åŒ–"><a href="#åºåˆ—æ•°æ®çš„ä¸€ç»´å·ç§¯ã€æ± åŒ–" class="headerlink" title="åºåˆ—æ•°æ®çš„ä¸€ç»´å·ç§¯ã€æ± åŒ–"></a>åºåˆ—æ•°æ®çš„ä¸€ç»´å·ç§¯ã€æ± åŒ–</h3><p>å’ŒäºŒç»´çš„å·ç§¯ç±»ä¼¼ï¼Œä¸€ç»´å·ç§¯ä»åºåˆ—ä¸­æå–å±€éƒ¨çš„ç‰‡æ®µï¼ˆå­åºåˆ—ï¼‰ï¼Œç„¶åå¯¹æ¯ä¸ªç‰‡æ®µåšç›¸åŒçš„å˜æ¢ã€‚ä¸€ç»´çš„å·ç§¯çª—å£æ˜¯æ—¶é—´è½´ä¸Šçš„ä¸€ç»´çª—å£ã€‚è¯¥è¿ç®—çš„æ€§è´¨å¯ä»¥ä¿è¯ï¼Œåœ¨å‰é¢æŸä¸ªä½ç½®å­¦åˆ°çš„æ¨¡å¼ç¨åå¯ä»¥åœ¨å…¶ä»–ä½ç½®è¢«è¯†å‡ºæ¥ï¼ˆå…·æœ‰æ—¶é—´å¹³ç§»ä¸å˜æ€§ï¼‰ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghmwvss1ibj317a0msn02.jpg" alt="ä¸€ç»´å·ç§¯ç¥ç»ç½‘ç»œçš„å·¥ä½œåŸç†:æ¯ä¸ªè¾“å‡ºæ—¶é—´æ­¥éƒ½æ˜¯åˆ©ç”¨è¾“å…¥åºåˆ—åœ¨æ—¶é—´ç»´åº¦ä¸Šçš„ä¸€å°æ®µå¾—åˆ°çš„"></p><p>ä¸€ç»´çš„æ± åŒ–è¿ç®—ï¼Œä¹Ÿå’ŒäºŒç»´æ± åŒ–è¿ç®—ç±»ä¼¼ï¼šä»è¾“å…¥ä¸­æå–ä¸€ç»´ç‰‡æ®µï¼Œè¾“å‡ºå…¶ä¸­çš„æœ€å¤§å€¼(æœ€å¤§æ± åŒ–)æˆ–å¹³å‡å€¼(å¹³å‡æ± åŒ–)ã€‚è¯¥è¿ç®—ä¹Ÿæ˜¯ç”¨æ¥é™ä½æ•°æ®çš„é•¿åº¦çš„(åšå­é‡‡æ ·)ã€‚</p><h3 id="å®ç°ä¸€ç»´å·ç§¯ç¥ç»ç½‘ç»œ"><a href="#å®ç°ä¸€ç»´å·ç§¯ç¥ç»ç½‘ç»œ" class="headerlink" title="å®ç°ä¸€ç»´å·ç§¯ç¥ç»ç½‘ç»œ"></a>å®ç°ä¸€ç»´å·ç§¯ç¥ç»ç½‘ç»œ</h3><p>åœ¨ Keras ä¸­ï¼Œä¸€ç»´å·ç§¯ç¥ç»ç½‘ç»œç”¨ Conv1D å±‚æ¥è¡¨ç¤ºã€‚ç”¨æ³•å’Œ Conv2D å¾ˆç±»ä¼¼ï¼Œå®ƒæ¥æ”¶å½¢çŠ¶ä¸º <code>(samples, time, features)</code> çš„è¾“å…¥ï¼Œè¿”å›è¿˜æ˜¯è¿™ä¸ªå½¢çŠ¶çš„ã€‚æ³¨æ„ï¼Œå®ƒçš„çª—å£æ˜¯åœ¨ time ä¸Šçš„ï¼Œå³è¾“å…¥çš„ç¬¬äºŒä¸ªè½´ã€‚Conv2D é‡Œæˆ‘ä»¬çš„çª—å£ä¸€èˆ¬ç”¨ 3x3ã€5x5 è¿™æ ·çš„ï¼Œå¯¹åº”çš„ Conv1D é‡Œï¼Œæˆ‘ä»¬ä¸€èˆ¬å– 7 æˆ– 9 çš„çª—å£å¤§å°ã€‚</p><p>å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½å°† Conv1D å±‚å’Œ MaxPooling1D å±‚å †å åœ¨ä¸€èµ·ï¼Œåœ¨æ‰€æœ‰å·ç§¯æ± åŒ–å †å çš„æœ€åï¼Œå†ç”¨ä¸€ä¸ªå…¨å±€æ± åŒ–è¿ç®—æˆ–å±•å¹³çš„æ“ä½œã€‚</p><p>è¿˜æ˜¯ä»¥ IMDB ä¸ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.datasets <span class="keyword">import</span> imdb</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.preprocessing <span class="keyword">import</span> sequence</span><br><span class="line"></span><br><span class="line">max_features = <span class="number">10000</span></span><br><span class="line">max_len = <span class="number">500</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;Loading data...&#x27;</span>)</span><br><span class="line">(x_train, y_train), (x_test, y_test) = imdb.load_data(num_words=max_features)</span><br><span class="line">print(<span class="built_in">len</span>(x_train), <span class="string">&#x27;train sequences&#x27;</span>)</span><br><span class="line">print(<span class="built_in">len</span>(x_test), <span class="string">&#x27;test sequences&#x27;</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;Pad sequences (samples x time)&#x27;</span>)</span><br><span class="line">x_train = sequence.pad_sequences(x_train, maxlen=max_len)</span><br><span class="line">x_test = sequence.pad_sequences(x_test, maxlen=max_len)</span><br><span class="line">print(<span class="string">&#x27;x_train shape:&#x27;</span>, x_train.shape)</span><br><span class="line">print(<span class="string">&#x27;x_test shape:&#x27;</span>, x_test.shape)</span><br></pre></td></tr></table></figure><pre><code>Loading data...25000 train sequences25000 test sequencesPad sequences (samples x time)x_train shape: (25000, 500)x_test shape: (25000, 500)</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»˜åˆ¶å†å²</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_acc_and_loss</span>(<span class="params">history</span>):</span></span><br><span class="line"></span><br><span class="line">    epochs = <span class="built_in">range</span>(<span class="built_in">len</span>(history.history[<span class="string">&#x27;loss&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        acc = history.history[<span class="string">&#x27;acc&#x27;</span>]</span><br><span class="line">        val_acc = history.history[<span class="string">&#x27;val_acc&#x27;</span>]</span><br><span class="line">        </span><br><span class="line">        plt.plot(epochs, acc, <span class="string">&#x27;bo-&#x27;</span>, label=<span class="string">&#x27;Training acc&#x27;</span>)</span><br><span class="line">        plt.plot(epochs, val_acc, <span class="string">&#x27;rs-&#x27;</span>, label=<span class="string">&#x27;Validation acc&#x27;</span>)</span><br><span class="line">        plt.title(<span class="string">&#x27;Training and validation accuracy&#x27;</span>)</span><br><span class="line">        plt.legend()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">&#x27;No acc. Skip&#x27;</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        plt.figure()</span><br><span class="line"></span><br><span class="line">    loss = history.history[<span class="string">&#x27;loss&#x27;</span>]</span><br><span class="line">    val_loss = history.history[<span class="string">&#x27;val_loss&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    plt.plot(epochs, loss, <span class="string">&#x27;bo-&#x27;</span>, label=<span class="string">&#x27;Training loss&#x27;</span>)</span><br><span class="line">    plt.plot(epochs, val_loss, <span class="string">&#x27;rs-&#x27;</span>, label=<span class="string">&#x27;Validation loss&#x27;</span>)</span><br><span class="line">    plt.title(<span class="string">&#x27;Training and validation loss&#x27;</span>)</span><br><span class="line">    plt.legend()</span><br><span class="line"></span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨ IMDB ä¸Šè®­ç»ƒå¹¶è¯„ä¼°ä¸€ä¸ªç®€å•çš„ä¸€ç»´å·ç§¯ç¥ç»ç½‘ç»œ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.optimizers <span class="keyword">import</span> RMSprop</span><br><span class="line"></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(layers.Embedding(max_features, <span class="number">128</span>, input_length=max_len))</span><br><span class="line"></span><br><span class="line">model.add(layers.Conv1D(<span class="number">32</span>, <span class="number">7</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.MaxPooling1D(<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line">model.add(layers.Conv1D(<span class="number">32</span>, <span class="number">7</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.GlobalMaxPooling1D())</span><br><span class="line"></span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">model.summary()</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=RMSprop(lr=<span class="number">1e-4</span>),</span><br><span class="line">              loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>,</span><br><span class="line">              metrics=[<span class="string">&#x27;acc&#x27;</span>])</span><br><span class="line">history = model.fit(x_train, y_train,</span><br><span class="line">                    epochs=<span class="number">10</span>,</span><br><span class="line">                    batch_size=<span class="number">128</span>,</span><br><span class="line">                    validation_split=<span class="number">0.2</span>)</span><br><span class="line"></span><br><span class="line">plot_acc_and_loss(history)</span><br></pre></td></tr></table></figure><pre><code>Model: &quot;sequential&quot;_________________________________________________________________Layer (type)                 Output Shape              Param #   =================================================================embedding (Embedding)        (None, 500, 128)          1280000   _________________________________________________________________conv1d (Conv1D)              (None, 494, 32)           28704     _________________________________________________________________max_pooling1d (MaxPooling1D) (None, 98, 32)            0         _________________________________________________________________conv1d_1 (Conv1D)            (None, 92, 32)            7200      _________________________________________________________________global_max_pooling1d (Global (None, 32)                0         _________________________________________________________________dense (Dense)                (None, 1)                 33        =================================================================Total params: 1,315,937Trainable params: 1,315,937Non-trainable params: 0_________________________________________________________________Epoch 1/10157/157 [==============================] - 30s 188ms/step - loss: 0.9049 - acc: 0.5124 - val_loss: 0.6875 - val_acc: 0.5566Epoch 2/10157/157 [==============================] - 28s 178ms/step - loss: 0.6724 - acc: 0.6433 - val_loss: 0.6699 - val_acc: 0.6394...Epoch 9/10157/157 [==============================] - 27s 174ms/step - loss: 0.2445 - acc: 0.9171 - val_loss: 0.4238 - val_acc: 0.8666Epoch 10/10157/157 [==============================] - 27s 170ms/step - loss: 0.2211 - acc: 0.9277 - val_loss: 0.4305 - val_acc: 0.8746</code></pre><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghq3bm3j93j30af07c3yq.jpg" alt="png"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghq3bkuud0j30af07c0sy.jpg" alt="png"></p><p>è™½ç„¶ç»“æœç•¥æ¯” RNN å·®ï¼Œä½†è¿˜æ˜¯æŒºä¸é”™çš„ï¼Œè€Œä¸”è®­ç»ƒèµ·æ¥æ¯” LSTM å¿«ã€‚</p><h3 id="ç»“åˆ-CNN-å’Œ-RNN-å¤„ç†é•¿åºåˆ—"><a href="#ç»“åˆ-CNN-å’Œ-RNN-å¤„ç†é•¿åºåˆ—" class="headerlink" title="ç»“åˆ CNN å’Œ RNN å¤„ç†é•¿åºåˆ—"></a>ç»“åˆ CNN å’Œ RNN å¤„ç†é•¿åºåˆ—</h3><p>ä¸€ç»´å·ç§¯ç¥ç»ç½‘ç»œæ˜¯æŠŠåºåˆ—åˆ†æˆç‰‡æ®µå»å­¦ä¹ çš„ï¼Œå¯¹æ—¶é—´é¡ºåºä¸æ•æ„Ÿã€‚æ‰€ä»¥å¯¹äºé‚£äº›åºåˆ—çš„é¡ºåºå½±å“é‡å¤§çš„é—®é¢˜æ¥è¯´ï¼ŒCNN è¡¨ç°çš„è¿œä¸å¦‚ RNNã€‚ä¾‹å¦‚ï¼Œè€¶æ‹¿æ•°æ®é›†(æ°”æ¸©é¢„æµ‹)é—®é¢˜ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‡†å¤‡æ•°æ®</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">data_dir = <span class="string">&quot;/Volumes/WD/Files/dataset/jena_climate&quot;</span></span><br><span class="line">fname = os.path.join(data_dir, <span class="string">&#x27;jena_climate_2009_2016.csv&#x27;</span>)</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(fname)</span><br><span class="line">data = f.read()</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line">lines = data.split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">header = lines[<span class="number">0</span>].split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">lines = lines[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">float_data = np.zeros((<span class="built_in">len</span>(lines), <span class="built_in">len</span>(header) - <span class="number">1</span>))</span><br><span class="line"><span class="keyword">for</span> i, line <span class="keyword">in</span> <span class="built_in">enumerate</span>(lines):</span><br><span class="line">    values = [<span class="built_in">float</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> line.split(<span class="string">&#x27;,&#x27;</span>)[<span class="number">1</span>:]]</span><br><span class="line">    float_data[i, :] = values</span><br><span class="line">    </span><br><span class="line">mean = float_data[:<span class="number">200000</span>].mean(axis=<span class="number">0</span>)</span><br><span class="line">float_data -= mean</span><br><span class="line">std = float_data[:<span class="number">200000</span>].std(axis=<span class="number">0</span>)</span><br><span class="line">float_data /= std</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generator</span>(<span class="params">data, lookback, delay, min_index, max_index,</span></span></span><br><span class="line"><span class="function"><span class="params">              shuffle=<span class="literal">False</span>, batch_size=<span class="number">128</span>, step=<span class="number">6</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> max_index <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        max_index = <span class="built_in">len</span>(data) - delay - <span class="number">1</span></span><br><span class="line">    i = min_index + lookback</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">if</span> shuffle:</span><br><span class="line">            rows = np.random.randint(</span><br><span class="line">                min_index + lookback, max_index, size=batch_size)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> i + batch_size &gt;= max_index:</span><br><span class="line">                i = min_index + lookback</span><br><span class="line">            rows = np.arange(i, <span class="built_in">min</span>(i + batch_size, max_index))</span><br><span class="line">            i += <span class="built_in">len</span>(rows)</span><br><span class="line"></span><br><span class="line">        samples = np.zeros((<span class="built_in">len</span>(rows),</span><br><span class="line">                           lookback // step,</span><br><span class="line">                           data.shape[-<span class="number">1</span>]))</span><br><span class="line">        targets = np.zeros((<span class="built_in">len</span>(rows),))</span><br><span class="line">        <span class="keyword">for</span> j, row <span class="keyword">in</span> <span class="built_in">enumerate</span>(rows):</span><br><span class="line">            indices = <span class="built_in">range</span>(rows[j] - lookback, rows[j], step)</span><br><span class="line">            samples[j] = data[indices]</span><br><span class="line">            targets[j] = data[rows[j] + delay][<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">yield</span> samples, targets</span><br><span class="line">        </span><br><span class="line">lookback = <span class="number">1440</span></span><br><span class="line">step = <span class="number">6</span></span><br><span class="line">delay = <span class="number">144</span></span><br><span class="line">batch_size = <span class="number">128</span></span><br><span class="line"></span><br><span class="line">train_gen = generator(float_data,</span><br><span class="line">                      lookback=lookback,</span><br><span class="line">                      delay=delay,</span><br><span class="line">                      min_index=<span class="number">0</span>,</span><br><span class="line">                      max_index=<span class="number">200000</span>,</span><br><span class="line">                      shuffle=<span class="literal">True</span>,</span><br><span class="line">                      step=step, </span><br><span class="line">                      batch_size=batch_size)</span><br><span class="line">val_gen = generator(float_data,</span><br><span class="line">                    lookback=lookback,</span><br><span class="line">                    delay=delay,</span><br><span class="line">                    min_index=<span class="number">200001</span>,</span><br><span class="line">                    max_index=<span class="number">300000</span>,</span><br><span class="line">                    step=step,</span><br><span class="line">                    batch_size=batch_size)</span><br><span class="line">test_gen = generator(float_data,</span><br><span class="line">                     lookback=lookback,</span><br><span class="line">                     delay=delay,</span><br><span class="line">                     min_index=<span class="number">300001</span>,</span><br><span class="line">                     max_index=<span class="literal">None</span>,</span><br><span class="line">                     step=step,</span><br><span class="line">                     batch_size=batch_size)</span><br><span class="line"></span><br><span class="line">val_steps = (<span class="number">300000</span> - <span class="number">200001</span> - lookback) // batch_size</span><br><span class="line"></span><br><span class="line">test_steps = (<span class="built_in">len</span>(float_data) - <span class="number">300001</span> - lookback) // batch_size</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨è€¶æ‹¿æ•°æ®é›†ä¸Šè®­ç»ƒå¹¶è¯„ä¼°ä¸€ä¸ªç®€å•çš„ä¸€ç»´å·ç§¯ç¥ç»ç½‘ç»œ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.optimizers <span class="keyword">import</span> RMSprop</span><br><span class="line"></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(layers.Conv1D(<span class="number">32</span>, <span class="number">5</span>, activation=<span class="string">&#x27;relu&#x27;</span>,</span><br><span class="line">                        input_shape=(<span class="literal">None</span>, float_data.shape[-<span class="number">1</span>])))</span><br><span class="line">model.add(layers.MaxPooling1D(<span class="number">3</span>))</span><br><span class="line">model.add(layers.Conv1D(<span class="number">32</span>, <span class="number">5</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.MaxPooling1D(<span class="number">3</span>))</span><br><span class="line">model.add(layers.Conv1D(<span class="number">32</span>, <span class="number">5</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.GlobalMaxPooling1D())</span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=RMSprop(), loss=<span class="string">&#x27;mae&#x27;</span>)</span><br><span class="line">history = model.fit_generator(train_gen,</span><br><span class="line">                              steps_per_epoch=<span class="number">500</span>,</span><br><span class="line">                              epochs=<span class="number">20</span>,</span><br><span class="line">                              validation_data=val_gen,</span><br><span class="line">                              validation_steps=val_steps)</span><br><span class="line"></span><br><span class="line">plot_acc_and_loss(history)</span><br></pre></td></tr></table></figure><pre><code>WARNING:tensorflow:From &lt;ipython-input-6-02e34f317812&gt;:22: Model.fit_generator (from tensorflow.python.keras.engine.training) is deprecated and will be removed in a future version.Instructions for updating:Please use Model.fit, which supports generators.Epoch 1/20500/500 [==============================] - 27s 54ms/step - loss: 0.4144 - val_loss: 0.4308Epoch 2/20500/500 [==============================] - 26s 52ms/step - loss: 0.3620 - val_loss: 0.4306...Epoch 19/20500/500 [==============================] - 22s 43ms/step - loss: 0.2450 - val_loss: 0.4603Epoch 20/20500/500 [==============================] - 21s 41ms/step - loss: 0.2453 - val_loss: 0.4721</code></pre><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghq3bl7gimj30al07caac.jpg" alt="png"></p><p>è¿™è¿˜ä¸å¦‚å’±ç”¨çš„é‚£ä¸ªå¸¸è¯†æ³•å‘¢ï¼Œå¯è§é¡ºåºä¿¡æ¯å¯¹è¿™ä¸ªé—®é¢˜è¿˜æ˜¯éå¸¸å…³é”®çš„ã€‚ä¸ºäº†å­¦åˆ°é¡ºåºä¸Šçš„ä¿¡æ¯ï¼ŒåŒæ—¶ä¿æŒå·ç§¯ç¥ç»ç½‘ç»œçš„é€Ÿåº¦å’Œè½»é‡ï¼Œæˆ‘ä»¬å¯ä»¥ç»“åˆä½¿ç”¨ CNN å’Œ RNNã€‚</p><p>æˆ‘ä»¬å¯ä»¥åœ¨ RNN å‰é¢ä½¿ç”¨ Conv1Dã€‚å¯¹äºéå¸¸é•¿çš„åºåˆ— (æ¯”å¦‚åŒ…å«ä¸Šåƒä¸ªæ—¶é—´æ­¥)ï¼Œç›´æ¥ç”¨ RNN å¤„ç†èµ·æ¥å¤ªæ…¢ã€ç”šè‡³æ— æ³•å¤„ç†ã€‚åœ¨ RNN å‰é¢åŠ ä¸Šä¸€äº› Conv1D å°±å¯ä»¥æŠŠè¿‡é•¿çš„è¾“å…¥åºåˆ—è½¬æ¢(ä¸‹é‡‡æ ·)ä¸ºç”±é«˜çº§ç‰¹å¾ç»„æˆçš„æ›´çŸ­åºåˆ—ï¼Œç„¶åå†ç”¨ RNN å»å¤„ç†æœ‰å¯ä»¥å­¦åˆ°é¡ºåºæ•æ„Ÿçš„ä¿¡æ¯ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghmy56fkp4j30ji0ncgni.jpg" alt="ç»“åˆä¸€ç»´ CNN å’Œ RNN æ¥å¤„ç†é•¿åºåˆ—"></p><p>æˆ‘ä»¬ç”¨è¿™ç§æ–¹æ³•å†åšä¸€æ¬¡æ°”æ¸©é¢„æµ‹é—®é¢˜ï¼Œç”±äºè¿™ç§æ–¹æ³•å¯ä»¥å­¦ä¹ æ›´é•¿çš„åºåˆ—ï¼Œæˆ‘ä»¬å¯ä»¥è®©ç½‘ç»œæŸ¥çœ‹æ›´æ—©çš„æ•°æ®(å¢å¤§æ•°æ®ç”Ÿæˆå™¨çš„ lookback å‚æ•°)ï¼Œä¹Ÿå¯ä»¥è®©ç½‘ç»œæŸ¥çœ‹åˆ†è¾¨ç‡æ›´é«˜çš„æ—¶é—´åºåˆ—ï¼ˆå‡å°ç”Ÿæˆå™¨çš„ step å‚æ•°ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">step = <span class="number">3</span>  <span class="comment"># 30 åˆ†é’Ÿä¸€æ­¥ï¼Œæ¯”ä»¥å‰ç¼©çŸ­äº†ä¸€åŠ</span></span><br><span class="line">lookback = <span class="number">720</span></span><br><span class="line">delay = <span class="number">144</span></span><br><span class="line"></span><br><span class="line">train_gen = generator(float_data,</span><br><span class="line">                      lookback=lookback,</span><br><span class="line">                      delay=delay,</span><br><span class="line">                      min_index=<span class="number">0</span>,</span><br><span class="line">                      max_index=<span class="number">200000</span>,</span><br><span class="line">                      shuffle=<span class="literal">True</span>,</span><br><span class="line">                      step=step)</span><br><span class="line"></span><br><span class="line">val_gen = generator(float_data,</span><br><span class="line">                    lookback=lookback,</span><br><span class="line">                    delay=delay,</span><br><span class="line">                    min_index=<span class="number">200001</span>,</span><br><span class="line">                    max_index=<span class="number">300000</span>,</span><br><span class="line">                    step=step)</span><br><span class="line"></span><br><span class="line">test_gen = generator(float_data,</span><br><span class="line">                     lookback=lookback,</span><br><span class="line">                     delay=delay,</span><br><span class="line">                     min_index=<span class="number">300001</span>,</span><br><span class="line">                     max_index=<span class="literal">None</span>,</span><br><span class="line">                     step=step)</span><br><span class="line"></span><br><span class="line">val_steps = (<span class="number">300000</span> - <span class="number">200001</span> - lookback) // <span class="number">128</span></span><br><span class="line">test_steps = (<span class="built_in">len</span>(float_data) - <span class="number">300001</span> - lookback) // <span class="number">128</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”¨ Conv1D + GRU</span></span><br><span class="line"></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(layers.Conv1D(<span class="number">32</span>, <span class="number">5</span>, activation=<span class="string">&#x27;relu&#x27;</span>,</span><br><span class="line">                        input_shape=(<span class="literal">None</span>, float_data.shape[-<span class="number">1</span>])))</span><br><span class="line">model.add(layers.MaxPooling1D(<span class="number">3</span>))</span><br><span class="line">model.add(layers.Conv1D(<span class="number">32</span>, <span class="number">5</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.GRU(<span class="number">32</span>, dropout=<span class="number">0.1</span>, recurrent_dropout=<span class="number">0.5</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">model.summary()</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=RMSprop(), loss=<span class="string">&#x27;mae&#x27;</span>)</span><br><span class="line">history = model.fit_generator(train_gen,</span><br><span class="line">                              steps_per_epoch=<span class="number">500</span>,</span><br><span class="line">                              epochs=<span class="number">20</span>,</span><br><span class="line">                              validation_data=val_gen,</span><br><span class="line">                              validation_steps=val_steps)</span><br><span class="line"></span><br><span class="line">plot_acc_and_loss(history)</span><br></pre></td></tr></table></figure><pre><code>Model: &quot;sequential_2&quot;_________________________________________________________________Layer (type)                 Output Shape              Param #   =================================================================conv1d_5 (Conv1D)            (None, None, 32)          2272      _________________________________________________________________max_pooling1d_3 (MaxPooling1 (None, None, 32)          0         _________________________________________________________________conv1d_6 (Conv1D)            (None, None, 32)          5152      _________________________________________________________________gru (GRU)                    (None, 32)                6336      _________________________________________________________________dense_2 (Dense)              (None, 1)                 33        =================================================================Total params: 13,793Trainable params: 13,793Non-trainable params: 0_________________________________________________________________Epoch 1/20500/500 [==============================] - 49s 97ms/step - loss: 0.3301 - val_loss: 0.3056Epoch 2/20500/500 [==============================] - 47s 95ms/step - loss: 0.2950 - val_loss: 0.2750...Epoch 19/20500/500 [==============================] - 53s 106ms/step - loss: 0.2029 - val_loss: 0.3107Epoch 20/20500/500 [==============================] - 53s 106ms/step - loss: 0.2011 - val_loss: 0.3112</code></pre><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghq3blng5dj30al07c3yt.jpg" alt="png"></p><p>ä»éªŒè¯æŸå¤±æ¥çœ‹ï¼Œè¿™ç§æ¶æ„çš„æ•ˆæœä¸å¦‚åªç”¨æ­£åˆ™åŒ– GRUï¼Œä½†é€Ÿåº¦è¦å¿«å¾ˆå¤šã€‚å®ƒæŸ¥çœ‹äº†ä¸¤å€çš„æ•°æ®é‡ï¼Œåœ¨æœ¬ä¾‹ä¸­å¯èƒ½ä¸æ˜¯éå¸¸æœ‰ç”¨ï¼Œä½†å¯¹äºå…¶ä»–æ•°æ®é›†å¯èƒ½éå¸¸é‡è¦ã€‚</p><hr><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">By(<span class="string">&quot;CDFMLR&quot;</span>, <span class="string">&quot;2020-08-14&quot;</span>);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> Deep Learning with Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
            <tag> Deep Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonæ·±åº¦å­¦ä¹ ä¹‹å¾ªç¯ç¥ç»ç½‘ç»œçš„é«˜çº§ç”¨æ³•</title>
      <link href="/2020/08/13/DeepLearningWithPython/Deep-Learning%20with-Python-ch6_3/"/>
      <url>/2020/08/13/DeepLearningWithPython/Deep-Learning%20with-Python-ch6_3/</url>
      
        <content type="html"><![CDATA[<h1 id="Deep-Learning-with-Python"><a href="#Deep-Learning-with-Python" class="headerlink" title="Deep Learning with Python"></a>Deep Learning with Python</h1><p>è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘å­¦ä¹ ã€ŠDeep Learning with Pythonã€‹(ç¬¬äºŒç‰ˆï¼ŒFranÃ§ois Chollet è‘—) æ—¶å†™çš„ç³»åˆ—ç¬”è®°ä¹‹ä¸€ã€‚æ–‡ç« çš„å†…å®¹æ˜¯ä»  Jupyter notebooks è½¬æˆ Markdown çš„ï¼Œä½ å¯ä»¥å» <a href="https://github.com/cdfmlr/Deep-Learning-with-Python-Notebooks">GitHub</a> æˆ– <a href="https://gitee.com/cdfmlr/Deep-Learning-with-Python-Notebooks">Gitee</a> æ‰¾åˆ°åŸå§‹çš„ <code>.ipynb</code> ç¬”è®°æœ¬ã€‚</p><p>ä½ å¯ä»¥å»<a href="https://livebook.manning.com/book/deep-learning-with-python">è¿™ä¸ªç½‘ç«™åœ¨çº¿é˜…è¯»è¿™æœ¬ä¹¦çš„æ­£ç‰ˆåŸæ–‡</a>(è‹±æ–‡)ã€‚è¿™æœ¬ä¹¦çš„ä½œè€…ä¹Ÿç»™å‡ºäº†é…å¥—çš„ <a href="https://github.com/fchollet/deep-learning-with-python-notebooks">Jupyter notebooks</a>ã€‚</p><p>æœ¬æ–‡ä¸º <strong>ç¬¬6ç«   æ·±åº¦å­¦ä¹ ç”¨äºæ–‡æœ¬å’Œåºåˆ—</strong> (Chapter 6. <em>Deep learning for text and sequences</em>) çš„ç¬”è®°ã€‚</p><p>[TOC]</p><h2 id="6-3-Advanced-usage-of-recurrent-neural-networks"><a href="#6-3-Advanced-usage-of-recurrent-neural-networks" class="headerlink" title="6.3 Advanced usage of recurrent neural networks"></a>6.3 Advanced usage of recurrent neural networks</h2><blockquote><p>å¾ªç¯ç¥ç»ç½‘ç»œçš„é«˜çº§ç”¨æ³•</p></blockquote><p>ä»Šå›ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®ä¾‹ï¼Œæ¥äº†è§£å¾ªç¯ç¥ç»ç½‘ç»œçš„å‡ ä¸ªæŠ€å·§ï¼šå¾ªç¯ dropoutï¼Œ å †å å¾ªç¯å±‚ï¼ŒåŒå‘å¾ªç¯å±‚ã€‚</p><h3 id="æ¸©åº¦é¢„æµ‹é—®é¢˜"><a href="#æ¸©åº¦é¢„æµ‹é—®é¢˜" class="headerlink" title="æ¸©åº¦é¢„æµ‹é—®é¢˜"></a>æ¸©åº¦é¢„æµ‹é—®é¢˜</h3><p>æˆ‘ä»¬å°†ä½¿ç”¨æŸæ°”è±¡ç«™è®°å½•çš„å¤©æ°”æ—¶é—´åºåˆ—æ•°æ®é›†ï¼ˆè€¶æ‹¿æ•°æ®é›†ï¼‰ï¼Œåœ¨è¿™ä¸ªæ•°æ®é›†ä¸­ï¼Œæœ‰æ¯ 10 åˆ†é’Ÿè®°å½•çš„ 14 ä¸ªé‡(æ¯”å¦‚æ°”æ¸©ã€æ°”å‹ã€æ¹¿åº¦ã€é£å‘ç­‰)ï¼Œè¿™ä¸ªæ•°æ®é›†é‡Œæœ‰å¥½å¤šå¹´çš„è®°å½•ï¼Œè¿™é‡Œæˆ‘ä»¬åªé€‰ç”¨ 2009â€”2016 å¹´çš„ã€‚ç”¨è¿™ä¸ªæ•°æ®é›†æ¥æ„å»ºæ¨¡å‹ï¼Œæœ€åç›®æ ‡æ˜¯è¾“å…¥æœ€è¿‘çš„ä¸€äº›æ•°æ®(å‡ å¤©çš„æ•°æ®ç‚¹)ï¼Œé¢„æµ‹æœªæ¥ 24 å°æ—¶çš„æ°”æ¸©ã€‚</p><p>é¦–å…ˆï¼Œä¸‹è½½å¹¶è§£å‹è¿™ä¸ªæ•°æ®é›†ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/Somewhere</span><br><span class="line">mkdir jena_climate</span><br><span class="line"><span class="built_in">cd</span> jena_climate</span><br><span class="line">wget https://s3.amazonaws.com/keras-datasets/jena_climate_2009_2016.csv.zip</span><br><span class="line">unzip jena_climate_2009_2016.csv.zip</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹æ•°æ®:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">data_dir = <span class="string">&quot;/Volumes/WD/Files/dataset/jena_climate&quot;</span></span><br><span class="line">fname = os.path.join(data_dir, <span class="string">&#x27;jena_climate_2009_2016.csv&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(fname) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read()</span><br><span class="line"></span><br><span class="line">lines = data.split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">header = lines[<span class="number">0</span>].split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">lines = lines[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">print(header)</span><br><span class="line">print(<span class="built_in">len</span>(lines))</span><br><span class="line">print(lines[<span class="number">0</span>])</span><br></pre></td></tr></table></figure><pre><code>[&#39;&quot;Date Time&quot;&#39;, &#39;&quot;p (mbar)&quot;&#39;, &#39;&quot;T (degC)&quot;&#39;, &#39;&quot;Tpot (K)&quot;&#39;, &#39;&quot;Tdew (degC)&quot;&#39;, &#39;&quot;rh (%)&quot;&#39;, &#39;&quot;VPmax (mbar)&quot;&#39;, &#39;&quot;VPact (mbar)&quot;&#39;, &#39;&quot;VPdef (mbar)&quot;&#39;, &#39;&quot;sh (g/kg)&quot;&#39;, &#39;&quot;H2OC (mmol/mol)&quot;&#39;, &#39;&quot;rho (g/m**3)&quot;&#39;, &#39;&quot;wv (m/s)&quot;&#39;, &#39;&quot;max. wv (m/s)&quot;&#39;, &#39;&quot;wd (deg)&quot;&#39;]42055101.01.2009 00:10:00,996.52,-8.02,265.40,-8.90,93.30,3.33,3.11,0.22,1.94,3.12,1307.75,1.03,1.75,152.30</code></pre><p>æŠŠæ•°æ®æ”¾åˆ° Numpy æ•°ç»„ä¸­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">float_data = np.zeros((<span class="built_in">len</span>(lines), <span class="built_in">len</span>(header)-<span class="number">1</span>))</span><br><span class="line"><span class="keyword">for</span> i, line <span class="keyword">in</span> <span class="built_in">enumerate</span>(lines):</span><br><span class="line">    values = [<span class="built_in">float</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> line.split(<span class="string">&#x27;,&#x27;</span>)[<span class="number">1</span>:]]</span><br><span class="line">    float_data[i, :] = values</span><br><span class="line">    </span><br><span class="line">print(float_data.shape)</span><br></pre></td></tr></table></figure><pre><code>(420551, 14)</code></pre><p>æˆ‘ä»¬æŠŠæ°”æ¸©çš„å˜åŒ–ç”»å‡ºæ¥ï¼Œå‘¨æœŸæ€§å¾ˆæ˜æ˜¾ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">temp = float_data[:, <span class="number">1</span>]</span><br><span class="line">plt.plot(<span class="built_in">range</span>(<span class="built_in">len</span>(temp)), temp)</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghp1fpz4dlj30ak070jru.jpg" alt="png"></p><p>å†çœ‹çœ‹å‰ 10 å¤©çš„æ•°æ®ï¼ˆæ•°æ® 10 åˆ†é’Ÿè®°ä¸€æ¡ï¼Œæ‰€ä»¥ 1 å¤©æ˜¯ 144 æ¡ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.plot(<span class="built_in">range</span>(<span class="number">1440</span>), temp[: <span class="number">1440</span>])</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghp1fpi8mwj30ak070aaa.jpg" alt="png"></p><p>è¿™ä¸ªå›¾å¯ä»¥çœ‹å‡ºæ˜¯ä¸ªå†¬å¤©çš„ï¼Œæ¯å¤©çš„æ°”æ¸©å˜åŒ–ä¹Ÿæ˜¯æœ‰å‘¨æœŸæ€§çš„ï¼ˆåé¢å‡ å¤©æ¯”è¾ƒæ˜æ˜¾ï¼‰ã€‚</p><p>æ¥ä¸‹æ¥å°±è¦å¼€å§‹å°è¯•åšé¢„æµ‹æ¨¡å‹çš„å·¥ä½œäº†ã€‚é¦–å…ˆæ˜ç¡®ä¸€ä¸‹æˆ‘ä»¬çš„é—®é¢˜ï¼šç»™å®šè¿‡å» <code>lookback</code> ä¸ªæ—¶é—´æ­¥(10åˆ†é’Ÿä¸€ä¸ª)ï¼Œæˆ‘ä»¬æ²¡ <code>steps</code> æ­¥é‡‡æ ·ä¸€æ¬¡ï¼Œè®©ä½ å»é¢„æµ‹æœªæ¥ <code>delay</code> æ—¶é—´æ­¥çš„æ°”æ¸©ï¼š</p><ul><li><code>lookback = 720</code>: è¿‡å»5å¤©çš„è§‚å¯Ÿæ•°æ®</li><li><code>steps = 6</code>: æ¯å°æ—¶é‡‡æ ·ä¸€æ¬¡è§‚å¯Ÿæ•°æ®</li><li><code>delay = 144</code>: ç›®æ ‡æ˜¯æœªæ¥24å°æ—¶</li></ul><h4 id="æ•°æ®å‡†å¤‡"><a href="#æ•°æ®å‡†å¤‡" class="headerlink" title="æ•°æ®å‡†å¤‡"></a>æ•°æ®å‡†å¤‡</h4><ol><li>æ•°æ®æ ‡å‡†åŒ–ï¼šè®©å„ç§ç‰¹å¾åœ¨æ•°é‡ä¸Šå·®è·ä¸å¤§</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ•°æ®æ ‡å‡†åŒ–</span></span><br><span class="line"></span><br><span class="line">mean = float_data[:<span class="number">200000</span>].mean(axis=<span class="number">0</span>)</span><br><span class="line">float_data -= mean</span><br><span class="line">std = float_data[:<span class="number">200000</span>].std(axis=<span class="number">0</span>)</span><br><span class="line">float_data /= std</span><br></pre></td></tr></table></figure><ol start="2"><li>æŠŠæ•°æ®æ”¾åˆ°ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œyield å‡º <code>(samples, targets)</code>ï¼Œsamples æ˜¯è¾“å…¥çš„æ•°æ®æ‰¹ï¼Œtargets æ˜¯å¯¹åº”çš„ç›®æ ‡æ¸©åº¦æ•°ç»„ã€‚</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿæˆæ—¶é—´åºåˆ—æ ·æœ¬åŠå…¶ç›®æ ‡çš„ç”Ÿæˆå™¨</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generator</span>(<span class="params">data,     <span class="comment"># åŸå§‹æ•°æ®</span></span></span></span><br><span class="line"><span class="function"><span class="params">              lookback, <span class="comment"># è¾“å…¥æ•°æ®åŒ…æ‹¬è¿‡å»å¤šå°‘ä¸ªæ—¶é—´æ­¥</span></span></span></span><br><span class="line"><span class="function"><span class="params">              delay,    <span class="comment"># ç›®æ ‡æ˜¯æœªæ¥çš„å¤šå°‘ä¸ªæ—¶é—´æ­¥</span></span></span></span><br><span class="line"><span class="function"><span class="params">              min_index, max_index,  <span class="comment"># æŒ‡å®šä» data çš„é‚£ä¸ªéƒ¨åˆ†æŠ½å–</span></span></span></span><br><span class="line"><span class="function"><span class="params">              shuffle=<span class="literal">False</span>,   <span class="comment"># æ‰“ä¹±æ ·æœ¬ or æŒ‰é¡ºåºæŠ½å–</span></span></span></span><br><span class="line"><span class="function"><span class="params">              batch_size=<span class="number">128</span>,  <span class="comment"># æ¯æ‰¹çš„æ ·æœ¬æ•°</span></span></span></span><br><span class="line"><span class="function"><span class="params">              step=<span class="number">6</span></span>):</span>         <span class="comment"># æ•°æ®é‡‡æ ·çš„å‘¨æœŸ</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> max_index <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        max_index = <span class="built_in">len</span>(data) - delay - <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    i = min_index + lookback</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> shuffle:</span><br><span class="line">            rows = np.random.randint(min_index + lookback, max_index, size=batch_size)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> i + batch_size &gt;= max_index:</span><br><span class="line">                i = min_index + lookback</span><br><span class="line">            rows = np.arange(i, <span class="built_in">min</span>(i + batch_size, max_index))</span><br><span class="line">            i += <span class="built_in">len</span>(rows)</span><br><span class="line">            </span><br><span class="line">        samples = np.zeros((<span class="built_in">len</span>(rows), lookback // step, data.shape[-<span class="number">1</span>]))</span><br><span class="line">        targets = np.zeros((<span class="built_in">len</span>(rows), ))</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> j, row <span class="keyword">in</span> <span class="built_in">enumerate</span>(rows):</span><br><span class="line">            indices = <span class="built_in">range</span>(rows[j] - lookback, rows[j], step)</span><br><span class="line">            samples[j] = data[indices]</span><br><span class="line">            targets[j] = data[rows[j] + delay][<span class="number">1</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">yield</span> samples, targets</span><br></pre></td></tr></table></figure><p>è°ƒç”¨è¿™ä¸ªç”Ÿæˆå™¨ï¼Œå®ä¾‹åŒ–è®­ç»ƒé›†ç”Ÿæˆå™¨ã€éªŒè¯é›†ç”Ÿæˆå™¨ã€æµ‹è¯•é›†ç”Ÿæˆå™¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‡†å¤‡è®­ç»ƒç”Ÿæˆå™¨ã€éªŒè¯ç”Ÿæˆå™¨å’Œæµ‹è¯•ç”Ÿæˆå™¨</span></span><br><span class="line"></span><br><span class="line">lookback = <span class="number">1440</span></span><br><span class="line">step = <span class="number">6</span></span><br><span class="line">delay = <span class="number">144</span></span><br><span class="line">batch_size = <span class="number">128</span></span><br><span class="line"></span><br><span class="line">train_gen = generator(float_data, </span><br><span class="line">                      lookback=lookback, </span><br><span class="line">                      delay=delay, </span><br><span class="line">                      min_index=<span class="number">0</span>, </span><br><span class="line">                      max_index=<span class="number">200000</span>, </span><br><span class="line">                      shuffle=<span class="literal">True</span>, </span><br><span class="line">                      step=step, </span><br><span class="line">                      batch_size=batch_size)</span><br><span class="line"></span><br><span class="line">val_gen = generator(float_data, </span><br><span class="line">                    lookback=lookback, </span><br><span class="line">                    delay=delay, </span><br><span class="line">                    min_index=<span class="number">200001</span>, </span><br><span class="line">                    max_index=<span class="number">300000</span>, </span><br><span class="line">                    step=step, </span><br><span class="line">                    batch_size=batch_size)</span><br><span class="line"></span><br><span class="line">test_gen = generator(float_data, </span><br><span class="line">                     lookback=lookback, </span><br><span class="line">                     delay=delay, </span><br><span class="line">                     min_index=<span class="number">300001</span>, </span><br><span class="line">                     max_index=<span class="literal">None</span>, </span><br><span class="line">                     step=step, </span><br><span class="line">                     batch_size=batch_size)</span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯å’Œæµ‹è¯•éœ€è¦æŠ½å–å¤šå°‘æ¬¡ï¼š</span></span><br><span class="line">val_steps = (<span class="number">300000</span> - <span class="number">200001</span> - lookback)  // batch_size</span><br><span class="line">test_steps = (<span class="built_in">len</span>(float_data) - <span class="number">300001</span> - lookback)  // batch_size</span><br></pre></td></tr></table></figure><h4 id="ä¸€ç§å¸¸è¯†çš„ã€éæœºå™¨å­¦ä¹ çš„åŸºå‡†æ–¹æ³•"><a href="#ä¸€ç§å¸¸è¯†çš„ã€éæœºå™¨å­¦ä¹ çš„åŸºå‡†æ–¹æ³•" class="headerlink" title="ä¸€ç§å¸¸è¯†çš„ã€éæœºå™¨å­¦ä¹ çš„åŸºå‡†æ–¹æ³•"></a>ä¸€ç§å¸¸è¯†çš„ã€éæœºå™¨å­¦ä¹ çš„åŸºå‡†æ–¹æ³•</h4><p>æˆ‘ä»¬å‡è®¾æ¸©åº¦çš„æ—¶é—´åºåˆ—æ˜¯è¿ç»­çš„ï¼Œå¹¶ä¸”æ¯å¤©çš„æ¸©åº¦æ˜¯å‘¨æœŸæ€§å˜åŒ–çš„ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å¤§èƒ†å‡è®¾æœªæ¥ 24 å°æ—¶çš„æ¸©åº¦ç­‰äºå½“å‰çš„æ¸©åº¦ã€‚</p><p>æˆ‘ä»¬å°±ä»¥æ­¤åŸºäºå¸¸è¯†çš„éæœºå™¨å­¦ä¹ æ–¹æ³•ä½œä¸ºåŸºå‡†ï¼Œç”¨å¹³å‡ç»å¯¹è¯¯å·®(MAE)ä¸ºæŒ‡æ ‡æ¥è¯„ä¼°è¡¡é‡å®ƒï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mae = np.mean(np.<span class="built_in">abs</span>(preds - targets))</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹‹ååšçš„æœºå™¨å­¦ä¹ æ¨¡å‹åº”è¯¥è¶…è¿‡è¿™ä¸ªåŸºå‡†ï¼Œæ‰èƒ½è¯´æ˜æœºå™¨å­¦ä¹ æ˜¯æœ‰æ•ˆçš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¡ç®—åŸºäºå¸¸è¯†çš„åŸºå‡†æ–¹æ³•çš„ MAE</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">evaluate_naive_method</span>():</span></span><br><span class="line">    batch_maes = []</span><br><span class="line">    <span class="keyword">for</span> step <span class="keyword">in</span> <span class="built_in">range</span>(val_steps):</span><br><span class="line">        samples, targets = <span class="built_in">next</span>(val_gen)</span><br><span class="line">        preds = samples[:, -<span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">        mae = np.mean(np.<span class="built_in">abs</span>(preds - targets))</span><br><span class="line">        batch_maes.append(mae)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> np.mean(batch_maes)</span><br><span class="line">    </span><br><span class="line">mae = evaluate_naive_method()</span><br><span class="line">celsius_mae = mae * std[<span class="number">1</span>]</span><br><span class="line">print(<span class="string">f&#x27;mae=<span class="subst">&#123;mae&#125;</span>, æ¸©åº¦çš„å¹³å‡ç»å¯¹è¯¯å·®=<span class="subst">&#123;celsius_mae&#125;</span>Â°C&#x27;</span>)</span><br></pre></td></tr></table></figure><pre><code>mae=0.2897359729905486, æ¸©åº¦çš„å¹³å‡ç»å¯¹è¯¯å·®=2.564887434980494Â°C</code></pre><p>è¿™ä¸ªè¯¯å·®è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥çš„ç›®æ ‡å°±æ˜¯ç”¨æ·±åº¦å­¦ä¹ çš„æ–¹æ³•æ¥è¶…è¿‡è¿™ä¸ªåŸºå‡†ã€‚</p><h4 id="æœºå™¨å­¦ä¹ åŸºå‡†æ–¹æ³•"><a href="#æœºå™¨å­¦ä¹ åŸºå‡†æ–¹æ³•" class="headerlink" title="æœºå™¨å­¦ä¹ åŸºå‡†æ–¹æ³•"></a>æœºå™¨å­¦ä¹ åŸºå‡†æ–¹æ³•</h4><p>åœ¨ç”¨å¤æ‚çš„ã€è®¡ç®—ä»£ä»·é«˜çš„ç½‘ç»œ(æ¯”å¦‚ RNN)ä¹‹å‰ï¼Œæœ€å¥½å…ˆå°è¯•ä¸€ä¸‹ç®€å•çš„æ¨¡å‹èƒ½å¦è§£å†³é—®é¢˜ã€‚</p><p>æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å…ˆç”¨ä¸€ä¸ªç®€å•çš„å…¨è¿æ¥ç½‘ç»œæ¥å°è¯•å¤„ç†å¤©æ°”é¢„æµ‹é—®é¢˜ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># plot_acc_and_loss: ç»˜åˆ¶è®­ç»ƒå†å²çš„å®ç”¨å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_acc_and_loss</span>(<span class="params">history</span>):</span></span><br><span class="line"></span><br><span class="line">    epochs = <span class="built_in">range</span>(<span class="built_in">len</span>(history.history[<span class="string">&#x27;loss&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        acc = history.history[<span class="string">&#x27;acc&#x27;</span>]</span><br><span class="line">        val_acc = history.history[<span class="string">&#x27;val_acc&#x27;</span>]</span><br><span class="line">        </span><br><span class="line">        plt.plot(epochs, acc, <span class="string">&#x27;bo-&#x27;</span>, label=<span class="string">&#x27;Training acc&#x27;</span>)</span><br><span class="line">        plt.plot(epochs, val_acc, <span class="string">&#x27;rs-&#x27;</span>, label=<span class="string">&#x27;Validation acc&#x27;</span>)</span><br><span class="line">        plt.title(<span class="string">&#x27;Training and validation accuracy&#x27;</span>)</span><br><span class="line">        plt.legend()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">&#x27;No acc. Skip&#x27;</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        plt.figure()</span><br><span class="line"></span><br><span class="line">    loss = history.history[<span class="string">&#x27;loss&#x27;</span>]</span><br><span class="line">    val_loss = history.history[<span class="string">&#x27;val_loss&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    plt.plot(epochs, loss, <span class="string">&#x27;bo-&#x27;</span>, label=<span class="string">&#x27;Training loss&#x27;</span>)</span><br><span class="line">    plt.plot(epochs, val_loss, <span class="string">&#x27;rs-&#x27;</span>, label=<span class="string">&#x27;Validation loss&#x27;</span>)</span><br><span class="line">    plt.title(<span class="string">&#x27;Training and validation loss&#x27;</span>)</span><br><span class="line">    plt.legend()</span><br><span class="line"></span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.optimizers <span class="keyword">import</span> RMSprop</span><br><span class="line"></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(layers.Flatten(input_shape=(lookback // step, float_data.shape[-<span class="number">1</span>])))</span><br><span class="line">model.add(layers.Dense(<span class="number">32</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=RMSprop(), loss=<span class="string">&#x27;mae&#x27;</span>)</span><br><span class="line">history = model.fit_generator(train_gen, </span><br><span class="line">                              steps_per_epoch=<span class="number">500</span>, </span><br><span class="line">                              epochs=<span class="number">20</span>, </span><br><span class="line">                              validation_data=val_gen, </span><br><span class="line">                              validation_steps=val_steps)</span><br><span class="line"></span><br><span class="line">plot_acc_and_loss(history)</span><br></pre></td></tr></table></figure><pre><code>Epoch 1/20500/500 [==============================] - 10s 20ms/step - loss: 1.7705 - val_loss: 1.0356Epoch 2/20500/500 [==============================] - 11s 21ms/step - loss: 0.5680 - val_loss: 0.3472...Epoch 19/20500/500 [==============================] - 10s 21ms/step - loss: 0.2027 - val_loss: 0.3235Epoch 20/20500/500 [==============================] - 11s 22ms/step - loss: 0.2001 - val_loss: 0.3275</code></pre><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghp1fw74h7j30af07cglx.jpg" alt="png"></p><p>è™½ç„¶è¿™ä¸ªç»“æœé‡Œæœ‰ä¸€éƒ¨åˆ†è¶…è¿‡äº†ä¸æœºå™¨å­¦ä¹ çš„åŸºå‡†æ–¹æ³•ï¼Œä½†ä¸å¤Ÿå¯é ã€‚äº‹å®ä¸Šï¼Œè¦è¶…è¶ŠåŸºäºå°è¯•çš„åŸºå‡†æ–¹æ³•æ˜¯ä¸å®¹æ˜“çš„ï¼Œæˆ‘ä»¬çš„å°è¯•ä¸­åŒ…å«äº†å¾ˆå¤šæœºå™¨éš¾ä»¥å­¦åˆ°çš„æœ‰ç”¨çš„ä¿¡æ¯ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¯¹è¿™ç§ç”¨ç®€å•é«˜æ•ˆè§£çš„é—®é¢˜æ¥è¯´ï¼Œé™¤éæˆ‘ä»¬ç¡¬ç¼–ç è®©æ¨¡å‹å»ä½¿ç”¨è¿™ç§ç®€å•æ–¹æ³•ï¼Œå¦åˆ™é æœºå™¨å»å­¦ä¹ å‚æ•°æ˜¯å¾ˆéš¾æ‰¾åˆ°è¿™ä¸ªç®€å•æ¨¡å‹å¹¶è¿›ä¸€æ­¥æ”¹è¿›çš„ã€‚</p><h4 id="å¾ªç¯ç½‘ç»œåŸºå‡†æ–¹æ³•"><a href="#å¾ªç¯ç½‘ç»œåŸºå‡†æ–¹æ³•" class="headerlink" title="å¾ªç¯ç½‘ç»œåŸºå‡†æ–¹æ³•"></a>å¾ªç¯ç½‘ç»œåŸºå‡†æ–¹æ³•</h4><p>åˆšæ‰çš„å…¨è¿æ¥ç½‘ç»œä¸€å¼€å§‹å°±ç”¨ä¸€ä¸ª Flatten æŠŠæ—¶é—´åºåˆ—å±•å¹³äº†ï¼Œæ‰€ä»¥é‚£ä¸ªæ¨¡å‹å®é™…ä¸Šæ˜¯æ²¡æœ‰è€ƒè™‘ã€æ—¶é—´ã€çš„æ¦‚å¿µçš„ã€‚è¦åˆ©ç”¨èµ·æ—¶é—´çš„é¡ºåºï¼Œæˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨å¾ªç¯ç½‘ç»œã€‚è¿™æ¬¡ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ GRU å±‚è€Œä¸æ˜¯ LSTMï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®­ç»ƒå¹¶è¯„ä¼°ä¸€ä¸ªåŸºäº GRU çš„æ¨¡å‹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.optimizers <span class="keyword">import</span> RMSprop</span><br><span class="line"></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(layers.GRU(<span class="number">32</span>, input_shape=(<span class="literal">None</span>, float_data.shape[-<span class="number">1</span>])))</span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=RMSprop(), loss=<span class="string">&#x27;mae&#x27;</span>)</span><br><span class="line">history = model.fit_generator(train_gen, </span><br><span class="line">                              steps_per_epoch=<span class="number">500</span>, </span><br><span class="line">                              epochs=<span class="number">20</span>, </span><br><span class="line">                              validation_data=val_gen, </span><br><span class="line">                              validation_steps=val_steps)</span><br><span class="line"></span><br><span class="line">plot_acc_and_loss(history)</span><br></pre></td></tr></table></figure><pre><code>Epoch 1/20500/500 [==============================] - 58s 116ms/step - loss: 0.3069 - val_loss: 0.2687Epoch 2/20500/500 [==============================] - 56s 113ms/step - loss: 0.2850 - val_loss: 0.2692...Epoch 19/20500/500 [==============================] - 62s 124ms/step - loss: 0.2090 - val_loss: 0.2971Epoch 20/20500/500 [==============================] - 64s 128ms/step - loss: 0.2039 - val_loss: 0.2995</code></pre><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghp1fqpvawj30al07cq38.jpg" alt="png"></p><p>åœ¨å¼€å§‹è¿‡æ‹Ÿåˆä¹‹å‰ï¼Œæœ€å¥½çš„ç»“æœçš„æ¸©åº¦è¯¯å·®æ˜¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="number">0.2624</span> * std[<span class="number">1</span>], <span class="string">&#x27;Â°C&#x27;</span>)</span><br></pre></td></tr></table></figure><pre><code>2.3228957591704926 Â°C</code></pre><p>æ¯”ä¸€å¼€å§‹çš„å¸¸è¯†æ¨¡å‹ä¼˜ç§€äº†ã€‚ä½†æˆ‘ä»¬çœ‹åˆ°ï¼Œåé¢è¿‡æ‹Ÿåˆäº†ï¼Œåœ¨ RNN é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¾ªç¯ dropout æ¥å¯¹æŠ—è¿‡æ‹Ÿåˆã€‚</p><h3 id="å¾ªç¯-dropout"><a href="#å¾ªç¯-dropout" class="headerlink" title="å¾ªç¯ dropout"></a>å¾ªç¯ dropout</h3><p>æˆ‘ä»¬åœ¨å‰é¦ˆç½‘ç»œé‡Œé¢ä½¿ç”¨ dropoutï¼Œå°±æ˜¯å°†æŸä¸€å±‚çš„è¾“å…¥å•å…ƒéšæœºå¾—è®¾ä¸º0ã€‚ä½†åœ¨ RNNs é‡Œæ²¡æœ‰é‚£ä¹ˆç®€å•ï¼Œåœ¨å¾ªç¯å±‚ä¹‹å‰ä½¿ç”¨ dropout åªä¼šé˜»ç¢å­¦ä¹ ï¼Œè€Œå¯¹ç»“æœæ²¡æœ‰å¸®åŠ©ï¼Œæ‰€ä»¥è¦åœ¨å¾ªç¯å±‚ä¸­ä½¿ç”¨ droputã€‚</p><p>åœ¨å¾ªç¯å±‚ä¸­ä½¿ç”¨ dropout å¿…é¡»å¯¹æ¯ä¸ª timestep ä½¿ç”¨ç›¸åŒçš„ maskï¼ˆæ©ç ï¼Œå³èˆå¼ƒå•å…ƒï¼‰ï¼Œæ©ç ä¸èƒ½éš timestep çš„æ”¹å˜è€Œæœ‰æ‰€ä¸åŒã€‚åŒæ—¶ï¼Œå¯¹äº LSTMã€GRU ç­‰å¾ªç¯å±‚ï¼Œè¿˜è¦å°†ä¸€ä¸ªä¸éšæ—¶é—´æ”¹å˜çš„ã€å¾ªç¯ dropout æ©ç ã€ä½œç”¨äºå±‚çš„å†…éƒ¨å¾ªç¯æ¿€æ´»ã€‚Keras çš„ å¾ªç¯å±‚ä¸­éƒ½å†…ç½®äº†è¿™ä¸¤ç§ dropout çš„å®ç°ï¼Œåªéœ€é€šè¿‡å‚æ•° <code>dropout</code> å’Œ <code>recurrent_dropout</code> æŒ‡å®š dropout çš„æ¯”ä¾‹å³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®­ç»ƒå¹¶è¯„ä¼°ä¸€ä¸ªä½¿ç”¨ dropout æ­£åˆ™åŒ–çš„åŸºäº GRU çš„æ¨¡å‹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.optimizers <span class="keyword">import</span> RMSprop</span><br><span class="line"></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(layers.GRU(<span class="number">32</span>, </span><br><span class="line">                     dropout=<span class="number">0.4</span>, </span><br><span class="line">                     recurrent_dropout=<span class="number">0.4</span>, </span><br><span class="line">                     input_shape=(<span class="literal">None</span>, float_data.shape[-<span class="number">1</span>])))</span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=RMSprop(), loss=<span class="string">&#x27;mae&#x27;</span>)</span><br><span class="line">history = model.fit_generator(train_gen, </span><br><span class="line">                              steps_per_epoch=<span class="number">500</span>, </span><br><span class="line">                              epochs=<span class="number">40</span>,    <span class="comment"># ä½¿ç”¨äº† dropout çš„ç½‘ç»œéœ€è¦æ›´é•¿çš„æ—¶é—´æ‰èƒ½æ”¶æ•›</span></span><br><span class="line">                              validation_data=val_gen, </span><br><span class="line">                              validation_steps=val_steps)</span><br><span class="line"></span><br><span class="line">plot_acc_and_loss(history)</span><br></pre></td></tr></table></figure><pre><code>Epoch 1/40500/500 [==============================] - 101s 202ms/step - loss: 0.3491 - val_loss: 0.2865Epoch 2/40500/500 [==============================] - 90s 180ms/step - loss: 0.3200 - val_loss: 0.2826...Epoch 39/40500/500 [==============================] - 98s 196ms/step - loss: 0.2510 - val_loss: 0.3111Epoch 40/40500/500 [==============================] - 101s 202ms/step - loss: 0.2517 - val_loss: 0.3115</code></pre><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghp1frgpbwj30al07caae.jpg" alt="png"></p><p>è¿™ä¸ªåšå‡ºæ¥æ²¡æœ‰ä¹¦ä¸Šå¥½ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚</p><h3 id="å¾ªç¯å±‚çš„å †å "><a href="#å¾ªç¯å±‚çš„å †å " class="headerlink" title="å¾ªç¯å±‚çš„å †å "></a>å¾ªç¯å±‚çš„å †å </h3><p>è§£å†³äº†è¿‡æ‹Ÿåˆçš„é—®é¢˜ï¼Œç°åœ¨è¦è¿›ä¸€æ­¥æé«˜ç²¾åº¦ã€‚åˆšæ‰åªç”¨äº†ä¸€ä¸ªå¾ªç¯å±‚ï¼Œå¯ä»¥è€ƒè™‘å†åŠ å‡ ä¸ªï¼Œå †å èµ·æ¥ï¼Œå¢åŠ ç½‘ç»œå®¹é‡ã€‚å®é™…ä¸Šï¼Œå¾ªç¯å±‚çš„å †å ä¸ç”¨å †çš„ç‰¹åˆ«å¤šï¼Œè°·æ­Œç¿»è¯‘ä¹Ÿåªç”¨äº†7ä¸ªè¶…å¤§çš„LSTMå±‚å †å åœ¨ä¸€èµ·ã€‚</p><p>åœ¨ Keras ä¸­å †å å¾ªç¯å±‚ï¼Œè®°å¾—ä¸­é—´å±‚åº”è¯¥è¿”å›å®Œæ•´çš„ 3D è¾“å‡ºåºåˆ—å¼ é‡ï¼Œä¸èƒ½åªè¿”å›æœ€åä¸€ä¸ªæ—¶é—´æ­¥çš„è¾“å‡º(è¿™ä¸ªè¡Œä¸ºæ˜¯é»˜è®¤çš„)ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.optimizers <span class="keyword">import</span> RMSprop</span><br><span class="line"></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(layers.GRU(<span class="number">32</span>,</span><br><span class="line">                     dropout=<span class="number">0.1</span>,</span><br><span class="line">                     recurrent_dropout=<span class="number">0.5</span>,</span><br><span class="line">                     return_sequences=<span class="literal">True</span>,  <span class="comment"># è¾“å‡ºå®Œæ•´è¾“å‡ºåºåˆ—</span></span><br><span class="line">                     input_shape=(<span class="literal">None</span>, float_data.shape[-<span class="number">1</span>])))</span><br><span class="line">model.add(layers.GRU(<span class="number">64</span>, activation=<span class="string">&#x27;relu&#x27;</span>,</span><br><span class="line">                     dropout=<span class="number">0.1</span>, </span><br><span class="line">                     recurrent_dropout=<span class="number">0.5</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=RMSprop(), loss=<span class="string">&#x27;mae&#x27;</span>)</span><br><span class="line">history = model.fit_generator(train_gen,</span><br><span class="line">                              steps_per_epoch=<span class="number">500</span>,</span><br><span class="line">                              epochs=<span class="number">40</span>,</span><br><span class="line">                              validation_data=val_gen,</span><br><span class="line">                              validation_steps=val_steps)</span><br><span class="line"></span><br><span class="line">plot_acc_and_loss(history)</span><br></pre></td></tr></table></figure><pre><code>Epoch 1/40500/500 [==============================] - 225s 450ms/step - loss: 0.3214 - val_loss: 0.2784Epoch 2/40500/500 [==============================] - 229s 459ms/step - loss: 0.3029 - val_loss: 0.2721...Epoch 39/40500/500 [==============================] - 229s 458ms/step - loss: 0.1840 - val_loss: 0.3365Epoch 40/40500/500 [==============================] - 219s 438ms/step - loss: 0.1839 - val_loss: 0.3343</code></pre><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghp1fv5uonj30al07cjrr.jpg" alt="png"></p><p>è¿™ä¸ªä¹Ÿå’Œä¹¦ä¸Šæœ‰æ‰€å·®è·ã€‚ä½†å¯ä»¥çœ‹å‡ºï¼Œå †å å¾ªç¯å±‚å¹¶æ²¡æœ‰å¸¦æ¥å¤ªå¤šçš„æ€§èƒ½æå‡ã€‚</p><h3 id="åŒå‘-RNN"><a href="#åŒå‘-RNN" class="headerlink" title="åŒå‘ RNN"></a>åŒå‘ RNN</h3><p>Bidirectional RNNs (åŒå‘å¾ªç¯ç½‘ç»œ) æ˜¯ RNN çš„å˜ç§ï¼Œæœ‰æ—¶å¯ä»¥æ¯” RNN æ€§èƒ½æ›´å¥½ï¼Œå°¤å…¶æ˜¯åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ä¸Šï¼ŒåŒå‘ RNN è¢«ç§°ä¸ºæ·±åº¦å­¦ä¹  NLP çš„ç‘å£«å†›é˜Ÿã€‚</p><p>RNN æ˜¯ä¾èµ–äºåºåˆ—çš„æ—¶é—´æˆ–è€…å…¶ä»–é¡ºåºçš„ï¼Œæ‰“ä¹±æˆ–åè½¬æ—¶é—´æ­¥ï¼ŒRNN ä»åºåˆ—ä¸­æå–çš„è¡¨ç¤ºå°±å®Œå…¨ä¸åŒäº†ã€‚åˆ©ç”¨äº† RNN å¯¹é¡ºåºçš„è¿™ç§æ•æ„Ÿæ€§ï¼ŒåŒå‘ RNN åŒ…å«ä¸¤ä¸ªæ™®é€š RNNï¼Œåˆ†åˆ«æ²¿æ­£åºå’Œé€†åºå¯¹è¾“å…¥åºåˆ—è¿›è¡Œå¤„ç†ï¼Œæœ€åå°†å®ƒä»¬å­¦åˆ°çš„è¡¨ç¤ºåˆåœ¨ä¸€èµ·ï¼Œè¿™æ ·å°±å¯èƒ½å­¦ä¹ åˆ°è¢«å•å‘ RNN å¿½ç•¥çš„æ¨¡å¼ã€‚</p><p>ä¹‹å‰ï¼Œæˆ‘ä»¬é»˜è®¤æŒ‰æ—¶é—´é¡ºåºå»è®­ç»ƒï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥è¯•è¯•é€†åºå»å¤„ç†ã€‚è¦é€†åºï¼Œåªéœ€åœ¨æ•°æ®ç”Ÿæˆå™¨æœ€åæ–¹å‘è¾“å‡ºå°±è¡Œäº† <code>yield samples[:, ::-1, :], targets)</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reverse_order_generator</span>(<span class="params">data, lookback, delay, min_index, max_index,</span></span></span><br><span class="line"><span class="function"><span class="params">                            shuffle=<span class="literal">False</span>, batch_size=<span class="number">128</span>, step=<span class="number">6</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> max_index <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        max_index = <span class="built_in">len</span>(data) - delay - <span class="number">1</span></span><br><span class="line">    i = min_index + lookback</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">if</span> shuffle:</span><br><span class="line">            rows = np.random.randint(</span><br><span class="line">                min_index + lookback, max_index, size=batch_size)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> i + batch_size &gt;= max_index:</span><br><span class="line">                i = min_index + lookback</span><br><span class="line">            rows = np.arange(i, <span class="built_in">min</span>(i + batch_size, max_index))</span><br><span class="line">            i += <span class="built_in">len</span>(rows)</span><br><span class="line"></span><br><span class="line">        samples = np.zeros((<span class="built_in">len</span>(rows),</span><br><span class="line">                           lookback // step,</span><br><span class="line">                           data.shape[-<span class="number">1</span>]))</span><br><span class="line">        targets = np.zeros((<span class="built_in">len</span>(rows),))</span><br><span class="line">        <span class="keyword">for</span> j, row <span class="keyword">in</span> <span class="built_in">enumerate</span>(rows):</span><br><span class="line">            indices = <span class="built_in">range</span>(rows[j] - lookback, rows[j], step)</span><br><span class="line">            samples[j] = data[indices]</span><br><span class="line">            targets[j] = data[rows[j] + delay][<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">yield</span> samples[:, ::-<span class="number">1</span>, :], targets</span><br><span class="line">        </span><br><span class="line">train_gen_reverse = reverse_order_generator(</span><br><span class="line">    float_data,</span><br><span class="line">    lookback=lookback,</span><br><span class="line">    delay=delay,</span><br><span class="line">    min_index=<span class="number">0</span>,</span><br><span class="line">    max_index=<span class="number">200000</span>,</span><br><span class="line">    shuffle=<span class="literal">True</span>,</span><br><span class="line">    step=step, </span><br><span class="line">    batch_size=batch_size)</span><br><span class="line"></span><br><span class="line">val_gen_reverse = reverse_order_generator(</span><br><span class="line">    float_data,</span><br><span class="line">    lookback=lookback,</span><br><span class="line">    delay=delay,</span><br><span class="line">    min_index=<span class="number">200001</span>,</span><br><span class="line">    max_index=<span class="number">300000</span>,</span><br><span class="line">    step=step,</span><br><span class="line">    batch_size=batch_size)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">model = Sequential()</span><br><span class="line">model.add(layers.GRU(<span class="number">32</span>, input_shape=(<span class="literal">None</span>, float_data.shape[-<span class="number">1</span>])))</span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=RMSprop(), loss=<span class="string">&#x27;mae&#x27;</span>)</span><br><span class="line">history = model.fit_generator(train_gen_reverse,</span><br><span class="line">                              steps_per_epoch=<span class="number">500</span>,</span><br><span class="line">                              epochs=<span class="number">20</span>,</span><br><span class="line">                              validation_data=val_gen_reverse,</span><br><span class="line">                              validation_steps=val_steps)</span><br><span class="line">plot_acc_and_loss(history)</span><br></pre></td></tr></table></figure><pre><code>Epoch 1/20500/500 [==============================] - 61s 121ms/step - loss: 0.4796 - val_loss: 0.4788Epoch 2/20500/500 [==============================] - 58s 117ms/step - loss: 0.4488 - val_loss: 0.4791...Epoch 19/20500/500 [==============================] - 57s 114ms/step - loss: 0.2202 - val_loss: 0.3657Epoch 20/20500/500 [==============================] - 57s 114ms/step - loss: 0.2165 - val_loss: 0.3560</code></pre><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghp1ftcyyej30al07cq38.jpg" alt="png"></p><p>è¿™ä¸ªæ•ˆæœå¹¶ä¸å¥½ã€‚æ˜¯è¿™æ ·çš„ï¼Œå¯¹äºæ°”æ¸©é¢„æµ‹ï¼Œå½“ç„¶æ˜¯è¿‘æœŸçš„æ•°æ®æ¯”è¾ƒæœ‰ç”¨ã€è€Œå¾ˆé•¿æ—¶é—´ä¹‹å‰çš„ä¿¡æ¯æ„ä¹‰ä¸å¤§ï¼Œå¾ªç¯å±‚éšç€ timesteps çš„å‰è¿›ä¼šä¸¢å¤±ä¸€äº›è€çš„ä¿¡æ¯ï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜ç”¨æ­£åºçš„ç»“æœæ¯”é€†åºçš„ç»“æœå¥½ã€‚</p><p>ä½†å¯¹äºæ–‡æœ¬ä¿¡æ¯çš„å¤„ç†ï¼Œä¸€ä¸ªå•è¯å¯¹ç†è§£å¥å­çš„é‡è¦æ€§é€šå¸¸å¹¶ä¸å–å†³äºå®ƒåœ¨å¥å­ä¸­çš„ä½ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè™½ç„¶å•è¯é¡ºåºå¯¹ç†è§£è¯­è¨€å¾ˆé‡è¦ï¼Œä½†ä½¿ç”¨å“ªç§é¡ºåºå¹¶ä¸é‡è¦ã€‚æ‰€ä»¥ï¼Œåœ¨å¤„ç†ä¸€äº›æ–‡æœ¬é—®é¢˜æ—¶ï¼Œæ­£åºå’Œé€†åºå¯èƒ½å¾—åˆ°å¾ˆç±»ä¼¼çš„ç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.datasets <span class="keyword">import</span> imdb</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.preprocessing <span class="keyword">import</span> sequence</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"></span><br><span class="line"><span class="comment"># Number of words to consider as features</span></span><br><span class="line">max_features = <span class="number">10000</span></span><br><span class="line"><span class="comment"># Cut texts after this number of words (among top max_features most common words)</span></span><br><span class="line">maxlen = <span class="number">500</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Load data</span></span><br><span class="line">(x_train, y_train), (x_test, y_test) = imdb.load_data(num_words=max_features)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Reverse sequences</span></span><br><span class="line">x_train = [x[::-<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> x_train]</span><br><span class="line">x_test = [x[::-<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> x_test]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Pad sequences</span></span><br><span class="line">x_train = sequence.pad_sequences(x_train, maxlen=maxlen)</span><br><span class="line">x_test = sequence.pad_sequences(x_test, maxlen=maxlen)</span><br><span class="line"></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(layers.Embedding(max_features, <span class="number">128</span>))</span><br><span class="line">model.add(layers.LSTM(<span class="number">32</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>))</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>,</span><br><span class="line">              loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>,</span><br><span class="line">              metrics=[<span class="string">&#x27;acc&#x27;</span>])</span><br><span class="line">history = model.fit(x_train, y_train,</span><br><span class="line">                    epochs=<span class="number">10</span>,</span><br><span class="line">                    batch_size=<span class="number">128</span>,</span><br><span class="line">                    validation_split=<span class="number">0.2</span>)</span><br><span class="line">plot_acc_and_loss(history)</span><br></pre></td></tr></table></figure><pre><code>Epoch 1/10157/157 [==============================] - 53s 339ms/step - loss: 0.4945 - acc: 0.7638 - val_loss: 0.4783 - val_acc: 0.8256Epoch 2/10157/157 [==============================] - 54s 345ms/step - loss: 0.3198 - acc: 0.8755 - val_loss: 0.5395 - val_acc: 0.7596...Epoch 9/10157/157 [==============================] - 54s 344ms/step - loss: 0.1241 - acc: 0.9590 - val_loss: 0.4496 - val_acc: 0.8566Epoch 10/10157/157 [==============================] - 55s 352ms/step - loss: 0.1178 - acc: 0.9600 - val_loss: 0.4134 - val_acc: 0.8720</code></pre><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghp1fo9r8jj30as07ct91.jpg" alt="png"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghp1fsgihij30af07c74j.jpg" alt="png"></p><p>è¿™ä¸ªé€†åºè®­ç»ƒçš„ IMDB ç»“æœå’Œæ­£åºçš„åŒºåˆ«ä¸å¤§ã€‚</p><p>å¦‚æœæˆ‘ä»¬æŠŠæ­£åºå’Œé€†åºç»“åˆèµ·æ¥ï¼Œä»ä¸åŒçš„è§†è§’å»æŸ¥çœ‹æ•°æ®ï¼Œç›¸äº’è¡¥å……è¢«å½¼æ­¤å¿½ç•¥çš„å†…å®¹ï¼Œå°±æœ‰å¯èƒ½æé«˜æ¨¡å‹çš„æ€§èƒ½ã€‚è¿™å°±æ˜¯åŒå‘ RNN è¦åšçš„äº‹ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghmsndu024j311s0jejtx.jpg" alt="åŒå‘ RNN å±‚çš„å·¥ä½œåŸç†"></p><p>åœ¨ Keras ä¸­ï¼Œä½¿ç”¨ Bidirectional å±‚æ¥å®ç°åŒå‘ RNNï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨ IMDB ä¸Šè®­ç»ƒå¹¶è¯„ä¼°ä¸€ä¸ªåŒå‘ LSTM</span></span><br><span class="line"></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(layers.Embedding(max_features, <span class="number">32</span>))</span><br><span class="line">model.add(layers.Bidirectional(layers.LSTM(<span class="number">32</span>)))</span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>))</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>, loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>, metrics=[<span class="string">&#x27;acc&#x27;</span>])</span><br><span class="line">history = model.fit(x_train, y_train, epochs=<span class="number">10</span>, batch_size=<span class="number">128</span>, validation_split=<span class="number">0.2</span>)</span><br><span class="line"></span><br><span class="line">plot_acc_and_loss(history)</span><br></pre></td></tr></table></figure><pre><code>Epoch 1/10157/157 [==============================] - 50s 317ms/step - loss: 0.5840 - acc: 0.6994 - val_loss: 0.4705 - val_acc: 0.7818Epoch 2/10157/157 [==============================] - 45s 285ms/step - loss: 0.3490 - acc: 0.8637 - val_loss: 0.4346 - val_acc: 0.7974...Epoch 9/10157/157 [==============================] - 45s 288ms/step - loss: 0.1411 - acc: 0.9537 - val_loss: 0.4225 - val_acc: 0.8778Epoch 10/10157/157 [==============================] - 45s 289ms/step - loss: 0.1249 - acc: 0.9589 - val_loss: 0.6158 - val_acc: 0.8424</code></pre><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghp1fuitdmj30al07cjro.jpg" alt="png"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghp1fvl6rsj30af07ct90.jpg" alt="png"></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°è¯•å°†åŒå‘ RNN çš„æ–¹æ³•åº”ç”¨äºæ¸©åº¦é¢„æµ‹ä»»åŠ¡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.optimizers <span class="keyword">import</span> RMSprop</span><br><span class="line"></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(layers.Bidirectional(</span><br><span class="line">    layers.GRU(<span class="number">32</span>), input_shape=(<span class="literal">None</span>, float_data.shape[-<span class="number">1</span>])))</span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=RMSprop(), loss=<span class="string">&#x27;mae&#x27;</span>)</span><br><span class="line">history = model.fit_generator(train_gen,</span><br><span class="line">                              steps_per_epoch=<span class="number">500</span>,</span><br><span class="line">                              epochs=<span class="number">40</span>,</span><br><span class="line">                              validation_data=val_gen,</span><br><span class="line">                              validation_steps=val_steps)</span><br><span class="line">plot_acc_and_loss(history)</span><br></pre></td></tr></table></figure><pre><code>Epoch 1/40500/500 [==============================] - 81s 163ms/step - loss: 0.3022 - val_loss: 0.2796Epoch 2/40500/500 [==============================] - 76s 151ms/step - loss: 0.2761 - val_loss: 0.2619...Epoch 39/40500/500 [==============================] - 76s 152ms/step - loss: 0.1338 - val_loss: 0.3413Epoch 40/40500/500 [==============================] - 76s 152ms/step - loss: 0.1322 - val_loss: 0.3445</code></pre><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghp1fp3nl0j30al07caae.jpg" alt="png"></p><h3 id="Going-even-further"><a href="#Going-even-further" class="headerlink" title="Going even further"></a>Going even further</h3><p>æ¥ä¸‹æ¥è¿˜å¯ä»¥é€šè¿‡å°è¯•ï¼Œæ›´è¿›ä¸€æ­¥æé«˜æ¨¡å‹çš„èƒ½åŠ›ï¼š</p><ul><li>å¢åŠ å±‚çš„å•å…ƒä¸ªæ•°</li><li>è°ƒèŠ‚ RMSprop çš„å­¦ä¹ ç‡</li><li>å°è¯•ç”¨ LSTM å±‚ä»£æ›¿ GRU å±‚</li><li>åœ¨å¾ªç¯å±‚ä¸Šé¢(åé¢)ä½¿ç”¨æ›´å¤§çš„å¯†é›†è¿æ¥å›å½’å™¨ï¼ˆæ›´å¤§çš„ Dense å±‚æˆ– Dense å±‚çš„å †å ï¼‰</li><li>åœ¨æµ‹è¯•é›†ä¸Šè¿è¡Œæ€§èƒ½æœ€ä½³çš„æ¨¡å‹ï¼Œé˜²æ­¢æ¨¡å‹å¯¹éªŒè¯é›†è¿‡æ‹Ÿåˆ</li></ul><p>æœ€åï¼Œæ¸©é¦¨æç¤ºï¼šä¸è¦ç”¨è¿™ä¸ªææ°”æ¸©é¢„æµ‹çš„æ–¹æ³•å»é¢„æµ‹è¯åˆ¸ä»·æ ¼å“¦ã€‚åœ¨å¸‚åœºä¸Šï¼Œè¿‡å»çš„è¡¨ç°å¹¶ä¸èƒ½å¾ˆå¥½åœ°é¢„æµ‹æœªæ¥çš„æ”¶ç›Šï¼šLooking in the rear-view mirror is a bad way to drive.</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> Deep Learning with Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
            <tag> Deep Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonæ·±åº¦å­¦ä¹ ä¹‹ç†è§£å¾ªç¯ç¥ç»ç½‘ç»œ</title>
      <link href="/2020/08/12/DeepLearningWithPython/Deep-Learning%20with-Python-ch6_2/"/>
      <url>/2020/08/12/DeepLearningWithPython/Deep-Learning%20with-Python-ch6_2/</url>
      
        <content type="html"><![CDATA[<h1 id="Deep-Learning-with-Python"><a href="#Deep-Learning-with-Python" class="headerlink" title="Deep Learning with Python"></a>Deep Learning with Python</h1><p>è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘å­¦ä¹ ã€ŠDeep Learning with Pythonã€‹(ç¬¬äºŒç‰ˆï¼ŒFranÃ§ois Chollet è‘—) æ—¶å†™çš„ç³»åˆ—ç¬”è®°ä¹‹ä¸€ã€‚æ–‡ç« çš„å†…å®¹æ˜¯ä»  Jupyter notebooks è½¬æˆ Markdown çš„ï¼Œä½ å¯ä»¥å» <a href="https://github.com/cdfmlr/Deep-Learning-with-Python-Notebooks">GitHub</a> æˆ– <a href="https://gitee.com/cdfmlr/Deep-Learning-with-Python-Notebooks">Gitee</a> æ‰¾åˆ°åŸå§‹çš„ <code>.ipynb</code> ç¬”è®°æœ¬ã€‚</p><p>ä½ å¯ä»¥å»<a href="https://livebook.manning.com/book/deep-learning-with-python">è¿™ä¸ªç½‘ç«™åœ¨çº¿é˜…è¯»è¿™æœ¬ä¹¦çš„æ­£ç‰ˆåŸæ–‡</a>(è‹±æ–‡)ã€‚è¿™æœ¬ä¹¦çš„ä½œè€…ä¹Ÿç»™å‡ºäº†é…å¥—çš„ <a href="https://github.com/fchollet/deep-learning-with-python-notebooks">Jupyter notebooks</a>ã€‚</p><p>æœ¬æ–‡ä¸º <strong>ç¬¬6ç«   æ·±åº¦å­¦ä¹ ç”¨äºæ–‡æœ¬å’Œåºåˆ—</strong> (Chapter 6. <em>Deep learning for text and sequences</em>) çš„ç¬”è®°ã€‚</p><p>[TOC]</p><h2 id="6-2-Understanding-recurrent-neural-networks"><a href="#6-2-Understanding-recurrent-neural-networks" class="headerlink" title="6.2 Understanding recurrent neural networks"></a>6.2 Understanding recurrent neural networks</h2><blockquote><p>ç†è§£å¾ªç¯ç¥ç»ç½‘ç»œ</p></blockquote><p>ä¹‹å‰æˆ‘ä»¬ç”¨çš„å…¨è¿æ¥ç½‘ç»œå’Œå·ç§¯ç¥ç»ç½‘ç»œéƒ½æœ‰æ˜¯è¢«å«åš feedforward networks (å‰é¦ˆç½‘ç»œ) çš„ã€‚è¿™ç§ç½‘ç»œæ˜¯æ— è®°å¿†çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬å•ç‹¬å¤„ç†æ¯ä¸ªè¾“å…¥ï¼Œåœ¨è¾“å…¥ä¸è¾“å…¥ä¹‹é—´æ²¡æœ‰ä¿å­˜ä»»ä½•çŠ¶æ€ã€‚åœ¨è¿™ç§ç½‘ç»œä¸­ï¼Œæˆ‘ä»¬è¦å¤„ç†æ—¶é—´/æ–‡æœ¬ç­‰åºåˆ—ï¼Œå°±å¿…é¡»æŠŠä¸€ä¸ªå®Œæ•´çš„åºåˆ—å¤„ç†æˆä¸€ä¸ªå¤§å¼ é‡ï¼Œæ•´ä¸ªçš„ä¼ åˆ°ç½‘ç»œä¸­ï¼Œè®©æ¨¡å‹ä¸€æ¬¡çœ‹å®Œæ•´ä¸ªåºåˆ—ã€‚</p><p>è¿™ä¸ªæ˜¾ç„¶å’Œæˆ‘ä»¬äººç±»é˜…è¯»ã€å­¦ä¹ æ–‡æœ¬ç­‰ä¿¡æ¯çš„æ–¹å¼æœ‰æ‰€åŒºåˆ«ã€‚æˆ‘ä»¬ä¸æ˜¯ä¸€çœ¼çœ‹å®Œæ•´æœ¬ä¹¦çš„ï¼Œæˆ‘ä»¬è¦ä¸€ä¸ªè¯ä¸€ä¸ªè¯åœ°çœ‹ï¼Œçœ¼ç›ä¸åœç§»åŠ¨è·å–æ–°çš„æ•°æ®çš„åŒæ—¶ï¼Œè®°ä½ä¹‹å‰çš„å†…å®¹ï¼Œå°†æ–°çš„ã€æ—§çš„å†…å®¹è”ç³»åœ¨ä¸€èµ·æ¥ç†è§£æ•´å¥è¯çš„æ„æ€ã€‚è¯´æŠ½è±¡ä¸€äº›ï¼Œæˆ‘ä»¬ä¼šä¿å­˜ä¸€ä¸ªå…³äºæ‰€å¤„ç†å†…å®¹çš„å†…éƒ¨æ¨¡å‹ï¼Œè¿™ä¸ªæ¨¡å‹æ ¹æ®è¿‡å»çš„ä¿¡æ¯æ„å»ºï¼Œå¹¶éšç€æ–°ä¿¡æ¯çš„è¿›å…¥è€Œä¸æ–­æ›´æ–°ã€‚æˆ‘ä»¬éƒ½æ˜¯ä»¥è¿™ç§æ¸è¿›çš„æ–¹å¼å¤„ç†ä¿¡æ¯çš„ã€‚</p><p>æŒ‰ç…§è¿™ç§æ€æƒ³ï¼Œæˆ‘ä»¬åˆå¾—åˆ°ä¸€ç§æ–°çš„æ¨¡å‹ï¼Œå«åš<strong>å¾ªç¯ç¥ç»ç½‘ç»œ</strong>(recurrent neural network, RNN)ï¼Œè¿™ç½‘ç»œä¼šéå†å¤„ç†æ‰€æœ‰åºåˆ—å…ƒç´ ï¼Œå¹¶ä¿å­˜ä¸€ä¸ªè®°å½•å·²æŸ¥çœ‹å†…å®¹ç›¸å…³ä¿¡æ¯çš„çŠ¶æ€(state)ã€‚è€Œåœ¨å¤„ç†ä¸‹ä¸€æ¡åºåˆ—ä¹‹æ—¶ï¼ŒRNN çŠ¶æ€ä¼šè¢«é‡ç½®ã€‚ä½¿ç”¨ RNN æ—¶ï¼Œæˆ‘ä»¬ä»å¯ä»¥å°†ä¸€ä¸ªåºåˆ—æ•´ä¸ªçš„è¾“å‡ºç½‘ç»œï¼Œä¸è¿‡åœ¨ç½‘ç»œå†…éƒ¨ï¼Œæ•°æ®ä¸å†æ˜¯ç›´æ¥è¢«æ•´ä¸ªå¤„ç†ï¼Œè€Œæ˜¯è‡ªåŠ¨å¯¹åºåˆ—å…ƒç´ è¿›è¡Œéå†ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghgvghuih9j30iy0ict9s.jpg" alt="å¾ªç¯ç½‘ç»œ:å¸¦æœ‰ç¯çš„ç½‘ç»œ"></p><p>ä¸ºäº†ç†è§£å¾ªç¯ç¥ç»ç½‘ç»œï¼Œæˆ‘ä»¬ç”¨ Numpy æ‰‹å†™ä¸€ä¸ªç©å…·ç‰ˆçš„ RNN å‰å‘ä¼ é€’ã€‚è€ƒè™‘å¤„ç†å½¢çŠ¶ä¸º <code>(timesteps, input_features)</code> çš„ä¸€æ¡åºåˆ—ï¼ŒRNN åœ¨ timesteps ä¸Šåšè¿­ä»£ï¼Œå°†å½“å‰ timestep çš„ input_features ä¸å‰ä¸€æ­¥å¾—åˆ°çš„çŠ¶æ€ç»“åˆç®—å‡ºè¿™ä¸€æ­¥çš„è¾“å‡ºï¼Œç„¶åå°†è¿™ä¸ªè¾“å‡ºä¿å­˜ä¸ºæ–°çš„çŠ¶æ€ä¾›ä¸‹ä¸€æ­¥ä½¿ç”¨ã€‚ç¬¬ä¸€æ­¥æ—¶ï¼Œæ²¡æœ‰çŠ¶æ€ï¼Œå› æ­¤å°†çŠ¶æ€åˆå§‹åŒ–ä¸ºä¸€ä¸ªå…¨é›¶å‘é‡ï¼Œç§°ä¸ºç½‘ç»œçš„åˆå§‹çŠ¶æ€ã€‚</p><p>ä¼ªä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">state_t = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> input_t <span class="keyword">in</span> input_sequence:</span><br><span class="line">    output_t = f(input_t, state_t)</span><br><span class="line">    state_t = output_t</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>f(...)</code> å…¶å®å’Œæˆ‘ä»¬çš„ Dense å±‚æ¯”è¾ƒç±»ä¼¼ï¼Œä½†è¿™é‡Œä¸ä»…å¤„ç†è¾“å‡ºï¼Œè¿˜è¦åŒæ—¶åŠ å…¥çŠ¶æ€çš„å½±å“ã€‚æ‰€ä»¥å®ƒå°±éœ€è¦åŒ…å« 3 ä¸ªå‚æ•°ï¼šåˆ†åˆ«ä½œç”¨ä¸è¾“å‡ºå’ŒçŠ¶æ€çš„çŸ©é˜µ Wã€Uï¼Œä»¥åŠåç§»å‘é‡ b:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">input_t, state_t</span>):</span></span><br><span class="line">    <span class="keyword">return</span> activation(</span><br><span class="line">        dot(W, input_t) + dot(U, state_t) + b</span><br><span class="line">    )</span><br></pre></td></tr></table></figure><p>ç”»ä¸ªå›¾æ¥è¡¨ç¤ºè¿™ä¸ªç¨‹åºï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghh2b81pn9j31520j276a.jpg" alt="ä¸€ä¸ªç®€å•çš„ RNNï¼Œæ²¿æ—¶é—´å±•å¼€"></p><p>ä¸‹é¢æŠŠå®ƒå†™æˆçœŸå®çš„ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰å„ç§ç»´åº¦å¤§å°</span></span><br><span class="line">timesteps = <span class="number">100</span></span><br><span class="line">input_features = <span class="number">32</span></span><br><span class="line">output_features = <span class="number">64</span></span><br><span class="line"></span><br><span class="line">inputs = np.random.random((timesteps, input_features))</span><br><span class="line"></span><br><span class="line">state_t = np.zeros((output_features))</span><br><span class="line"></span><br><span class="line">W = np.random.random((output_features, input_features))</span><br><span class="line">U = np.random.random((output_features, output_features))</span><br><span class="line">b = np.random.random((output_features))</span><br><span class="line"></span><br><span class="line">successive_outputs = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> input_t <span class="keyword">in</span> inputs:    <span class="comment"># input_t: (input_features, )</span></span><br><span class="line">    output_t = np.tanh(   <span class="comment"># output_t: (output_features, )</span></span><br><span class="line">        np.dot(W, input_t) + np.dot(U, state_t) + b</span><br><span class="line">    )</span><br><span class="line">    successive_outputs.append(output_t)</span><br><span class="line">    </span><br><span class="line">    state_t = output_t</span><br><span class="line">    </span><br><span class="line">final_output_sequence = np.stack(successive_outputs, axis=<span class="number">0</span>)  <span class="comment"># (timesteps, output_features)</span></span><br><span class="line"></span><br><span class="line">print(successive_outputs[-<span class="number">1</span>].shape)</span><br><span class="line">print(final_output_sequence.shape)</span><br><span class="line"></span><br></pre></td></tr></table></figure><pre><code>(64,)(100, 64)</code></pre><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æœ€ç»ˆè¾“å‡ºæ˜¯ä¸€ä¸ªå½¢çŠ¶ä¸º (timesteps, output_features) ï¼Œæ˜¯æ‰€æœ‰ timesteps çš„ç»“æœæ‹¼èµ·æ¥çš„ã€‚ä½†å®é™…ä¸Šï¼Œæˆ‘ä»¬ä¸€èˆ¬åªç”¨æœ€åä¸€ä¸ªç»“æœ <code>successive_outputs[-1]</code> å°±è¡Œäº†ï¼Œè¿™ä¸ªé‡Œé¢å·²ç»åŒ…å«äº†ä¹‹å‰æ‰€æœ‰æ­¥éª¤çš„ç»“æœï¼Œå³åŒ…å«äº†æ•´ä¸ªåºåˆ—çš„ä¿¡æ¯ã€‚</p><h3 id="Keras-ä¸­çš„å¾ªç¯å±‚"><a href="#Keras-ä¸­çš„å¾ªç¯å±‚" class="headerlink" title="Keras ä¸­çš„å¾ªç¯å±‚"></a>Keras ä¸­çš„å¾ªç¯å±‚</h3><p>æŠŠåˆšæ‰è¿™ä¸ªç©å…·ç‰ˆæœ¬å†åŠ å·¥ä¸€ä¸‹ï¼Œè®©å®ƒèƒ½æ¥æ”¶å½¢çŠ¶ä¸º <code>(batch_size, timesteps, input_features)</code> çš„è¾“å…¥ï¼Œæ‰¹é‡å»å¤„ç†ï¼Œå°±å¾—åˆ°äº† keras ä¸­çš„ <code>SimpleRNN</code> å±‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> SimpleRNN</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª SimpleRNN å±‚å’Œ keras ä¸­çš„å…¶ä»–å¾ªç¯å±‚éƒ½æœ‰ä¸¤ç§å¯é€‰çš„è¾“å‡ºæ¨¡å¼ï¼š</p><table><thead><tr><th>è¾“å‡ºå½¢çŠ¶</th><th>è¯´æ˜</th><th>ä½¿ç”¨</th></tr></thead><tbody><tr><td><code>(batch_size, timesteps, output_features)</code></td><td>è¾“å‡ºæ¯ä¸ª timestep è¾“å‡ºçš„å®Œæ•´åºåˆ—</td><td>return_sequences=True</td></tr><tr><td><code>(batch_size, output_features)</code></td><td>åªè¿”å›æ¯ä¸ªåºåˆ—çš„æœ€ç»ˆè¾“å‡º</td><td>return_sequences=False (é»˜è®¤)</td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åªè¿”å›æœ€åä¸€ä¸ªæ—¶é—´æ­¥çš„è¾“å‡º</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> Embedding, SimpleRNN</span><br><span class="line"></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(Embedding(<span class="number">10000</span>, <span class="number">32</span>))</span><br><span class="line">model.add(SimpleRNN(<span class="number">32</span>))</span><br><span class="line">model.summary()</span><br></pre></td></tr></table></figure><pre><code>Model: &quot;sequential&quot;_________________________________________________________________Layer (type)                 Output Shape              Param #   =================================================================embedding (Embedding)        (None, None, 32)          320000    _________________________________________________________________simple_rnn (SimpleRNN)       (None, 32)                2080      =================================================================Total params: 322,080Trainable params: 322,080Non-trainable params: 0_________________________________________________________________</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿”å›å®Œæ•´çš„çŠ¶æ€åºåˆ—</span></span><br><span class="line"></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(Embedding(<span class="number">10000</span>, <span class="number">32</span>))</span><br><span class="line">model.add(SimpleRNN(<span class="number">32</span>, return_sequences=<span class="literal">True</span>))</span><br><span class="line">model.summary()</span><br></pre></td></tr></table></figure><pre><code>Model: &quot;sequential_2&quot;_________________________________________________________________Layer (type)                 Output Shape              Param #   =================================================================embedding_2 (Embedding)      (None, None, 32)          320000    _________________________________________________________________simple_rnn_2 (SimpleRNN)     (None, None, 32)          2080      =================================================================Total params: 322,080Trainable params: 322,080Non-trainable params: 0_________________________________________________________________</code></pre><p>å¦‚æœæˆ‘ä»¬è¦å †å ä½¿ç”¨å¤šä¸ª RNN å±‚çš„æ—¶å€™ï¼Œä¸­é—´çš„å±‚å¿…é¡»è¿”å›å®Œæ•´çš„çŠ¶æ€åºåˆ—ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å †å å¤šä¸ª RNN å±‚ï¼Œä¸­é—´å±‚è¿”å›å®Œæ•´çš„çŠ¶æ€åºåˆ—</span></span><br><span class="line"></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(Embedding(<span class="number">10000</span>, <span class="number">32</span>))</span><br><span class="line">model.add(SimpleRNN(<span class="number">32</span>, return_sequences=<span class="literal">True</span>))</span><br><span class="line">model.add(SimpleRNN(<span class="number">32</span>, return_sequences=<span class="literal">True</span>))</span><br><span class="line">model.add(SimpleRNN(<span class="number">32</span>, return_sequences=<span class="literal">True</span>))</span><br><span class="line">model.add(SimpleRNN(<span class="number">32</span>))    <span class="comment"># æœ€åä¸€å±‚è¦æœ€åä¸€ä¸ªè¾“å‡ºå°±è¡Œäº†</span></span><br><span class="line">model.summary()</span><br></pre></td></tr></table></figure><pre><code>Model: &quot;sequential_3&quot;_________________________________________________________________Layer (type)                 Output Shape              Param #   =================================================================embedding_3 (Embedding)      (None, None, 32)          320000    _________________________________________________________________simple_rnn_3 (SimpleRNN)     (None, None, 32)          2080      _________________________________________________________________simple_rnn_4 (SimpleRNN)     (None, None, 32)          2080      _________________________________________________________________simple_rnn_5 (SimpleRNN)     (None, None, 32)          2080      _________________________________________________________________simple_rnn_6 (SimpleRNN)     (None, 32)                2080      =================================================================Total params: 328,320Trainable params: 328,320Non-trainable params: 0_________________________________________________________________</code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°è¯•ç”¨ RNN å†æ¬¡å¤„ç† IMDB é—®é¢˜ã€‚é¦–å…ˆï¼Œå‡†å¤‡æ•°æ®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‡†å¤‡ IMDB æ•°æ®</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.datasets <span class="keyword">import</span> imdb</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.preprocessing <span class="keyword">import</span> sequence</span><br><span class="line"></span><br><span class="line">max_features = <span class="number">10000</span></span><br><span class="line">maxlen = <span class="number">500</span></span><br><span class="line">batch_size = <span class="number">32</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;Loading data...&#x27;</span>)</span><br><span class="line">(input_train, y_train), (input_test, y_test) = imdb.load_data(num_words=max_features)</span><br><span class="line">print(<span class="built_in">len</span>(input_train), <span class="string">&#x27;train sequences&#x27;</span>)</span><br><span class="line">print(<span class="built_in">len</span>(input_test), <span class="string">&#x27;test sequences&#x27;</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;Pad sequences (samples x time)&#x27;</span>)</span><br><span class="line">input_train = sequence.pad_sequences(input_train, maxlen=maxlen)</span><br><span class="line">input_test = sequence.pad_sequences(input_test, maxlen=maxlen)</span><br><span class="line">print(<span class="string">&#x27;input_train shape:&#x27;</span>, input_train.shape)</span><br><span class="line">print(<span class="string">&#x27;input_train shape:&#x27;</span>, input_test.shape)</span><br><span class="line"></span><br></pre></td></tr></table></figure><pre><code>Loading data...25000 train sequences25000 test sequencesPad sequences (samples x time)input_train shape: (25000, 500)input_train shape: (25000, 500)</code></pre><p>æ„å»ºå¹¶è®­ç»ƒç½‘ç»œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”¨ Embedding å±‚å’Œ SimpleRNN å±‚æ¥è®­ç»ƒæ¨¡å‹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> Embedding, SimpleRNN, Dense</span><br><span class="line"></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(Embedding(max_features, <span class="number">32</span>))</span><br><span class="line">model.add(SimpleRNN(<span class="number">32</span>))</span><br><span class="line">model.add(Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>))</span><br><span class="line"></span><br><span class="line">model.summary()</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>, </span><br><span class="line">              loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>, </span><br><span class="line">              metrics=[<span class="string">&#x27;acc&#x27;</span>])</span><br><span class="line">history = model.fit(input_train, y_train, </span><br><span class="line">                    epochs=<span class="number">10</span>, </span><br><span class="line">                    batch_size=<span class="number">128</span>, </span><br><span class="line">                    validation_split=<span class="number">0.2</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><pre><code>Model: &quot;sequential_4&quot;_________________________________________________________________Layer (type)                 Output Shape              Param #   =================================================================embedding_4 (Embedding)      (None, None, 32)          320000    _________________________________________________________________simple_rnn_7 (SimpleRNN)     (None, 32)                2080      _________________________________________________________________dense (Dense)                (None, 1)                 33        =================================================================Total params: 322,113Trainable params: 322,113Non-trainable params: 0_________________________________________________________________Epoch 1/10157/157 [==============================] - 17s 107ms/step - loss: 0.6445 - acc: 0.6106 - val_loss: 0.6140 - val_acc: 0.6676Epoch 2/10157/157 [==============================] - 20s 129ms/step - loss: 0.4139 - acc: 0.8219 - val_loss: 0.4147 - val_acc: 0.8194Epoch 3/10157/157 [==============================] - 20s 124ms/step - loss: 0.3041 - acc: 0.8779 - val_loss: 0.4529 - val_acc: 0.8012Epoch 4/10157/157 [==============================] - 18s 115ms/step - loss: 0.2225 - acc: 0.9151 - val_loss: 0.3957 - val_acc: 0.8572Epoch 5/10157/157 [==============================] - 18s 115ms/step - loss: 0.1655 - acc: 0.9391 - val_loss: 0.4416 - val_acc: 0.8246Epoch 6/10157/157 [==============================] - 17s 111ms/step - loss: 0.1167 - acc: 0.9601 - val_loss: 0.4614 - val_acc: 0.8606Epoch 7/10157/157 [==============================] - 17s 109ms/step - loss: 0.0680 - acc: 0.9790 - val_loss: 0.4754 - val_acc: 0.8408Epoch 8/10157/157 [==============================] - 15s 95ms/step - loss: 0.0419 - acc: 0.9875 - val_loss: 0.5337 - val_acc: 0.8352Epoch 9/10157/157 [==============================] - 16s 99ms/step - loss: 0.0246 - acc: 0.9935 - val_loss: 0.5796 - val_acc: 0.8468Epoch 10/10157/157 [==============================] - 15s 96ms/step - loss: 0.0174 - acc: 0.9952 - val_loss: 0.7274 - val_acc: 0.7968</code></pre><p>ç»˜åˆ¶è®­ç»ƒè¿‡ç¨‹çœ‹çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»˜åˆ¶ç»“æœ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">acc = history.history[<span class="string">&#x27;acc&#x27;</span>]</span><br><span class="line">val_acc = history.history[<span class="string">&#x27;val_acc&#x27;</span>]</span><br><span class="line">loss = history.history[<span class="string">&#x27;loss&#x27;</span>]</span><br><span class="line">val_loss = history.history[<span class="string">&#x27;val_loss&#x27;</span>]</span><br><span class="line"></span><br><span class="line">epochs = <span class="built_in">range</span>(<span class="built_in">len</span>(acc))</span><br><span class="line"></span><br><span class="line">plt.plot(epochs, acc, <span class="string">&#x27;bo-&#x27;</span>, label=<span class="string">&#x27;Training acc&#x27;</span>)</span><br><span class="line">plt.plot(epochs, val_acc, <span class="string">&#x27;rs-&#x27;</span>, label=<span class="string">&#x27;Validation acc&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation accuracy&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">plt.figure()</span><br><span class="line"></span><br><span class="line">plt.plot(epochs, loss, <span class="string">&#x27;bo-&#x27;</span>, label=<span class="string">&#x27;Training loss&#x27;</span>)</span><br><span class="line">plt.plot(epochs, val_loss, <span class="string">&#x27;rs-&#x27;</span>, label=<span class="string">&#x27;Validation loss&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation loss&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghnskm7t47j30al07caac.jpg" alt="png"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghnskna7p7j30af07c74j.jpg" alt="png"></p><p>Emmmmï¼Œå…¶å®å§ï¼Œè¿™ä¸ªæ¨¡å‹çš„ç»“æœè¿˜æ²¡æœ‰ç¬¬ä¸‰ç« é‡Œé¢çš„ç”¨å‡ ä¸ªå…¨è¿æ¥å±‚å †å èµ·æ¥çš„æ¨¡å‹å¥½ã€‚åŸå› æœ‰å¥½å‡ ä¸ªï¼Œä¸€ä¸ªæ˜¯æˆ‘ä»¬è¿™é‡Œåªè€ƒè™‘äº†æ¯ä¸ªåºåˆ—çš„å‰ 500 ä¸ªå•è¯ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯ SimpleRNN å…¶å®å¹¶ä¸æ“…é•¿å¤„ç†å¾ˆé•¿çš„åºåˆ—ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¼šçœ‹å‡ ä¸ªèƒ½è¡¨ç°çš„æ›´å¥½çš„å¾ªç¯å±‚ã€‚</p><h4 id="LSTM-å±‚å’Œ-GRU-å±‚"><a href="#LSTM-å±‚å’Œ-GRU-å±‚" class="headerlink" title="LSTM å±‚å’Œ GRU å±‚"></a>LSTM å±‚å’Œ GRU å±‚</h4><p>åœ¨ Keras ä¸­çš„å¾ªç¯å±‚ï¼Œé™¤äº† SimpleRNNï¼Œè¿˜æœ‰æ›´â€œä¸simpleâ€ä¸€äº›çš„ LSTM å±‚å’Œ GRU å±‚ï¼Œåé¢è¿™ä¸¤ç§ä¼šæ›´å¸¸ç”¨ã€‚</p><p>SimpleRNN æ˜¯æœ‰ä¸€äº›é—®é¢˜çš„ï¼Œç†è®ºä¸Šï¼Œåœ¨éå†åˆ°æ—¶é—´æ­¥ t çš„æ—¶å€™ï¼Œå®ƒåº”è¯¥æ˜¯èƒ½ç•™å­˜ç€ä¹‹å‰è®¸å¤šæ­¥ä»¥æ¥è§è¿‡çš„ä¿¡æ¯çš„ï¼Œä½†å®é™…çš„åº”ç”¨ä¸­ï¼Œç”±äºæŸç§å«åš vanishing gradient problemï¼ˆæ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼‰çš„ç°è±¡ï¼Œå®ƒå¹¶ä¸èƒ½å­¦åˆ°è¿™ç§é•¿æœŸä¾èµ–ã€‚</p><p>æ¢¯åº¦æ¶ˆå¤±é—®é¢˜å…¶å®åœ¨å±‚æ•°æ¯”è¾ƒå¤šçš„å‰é¦ˆç½‘ç»œé‡Œé¢ä¹Ÿä¼šæœ‰å‘ç”Ÿï¼Œä¸»è¦è¡¨ç°å°±æ˜¯éšç€å±‚æ•°å¤šäº†ä¹‹åï¼Œç½‘ç»œæ— æ³•è®­ç»ƒäº†ã€‚LSTM å±‚å’Œ GRU å±‚å°±æ˜¯å¯¹æŠ—è¿™ç§é—®é¢˜è€Œç”Ÿçš„ã€‚</p><p><strong>LSTM</strong> å±‚æ˜¯åŸºäº LSTM (é•¿çŸ­æœŸè®°å¿†ï¼Œlong short-term memory) ç®—æ³•çš„ï¼Œè¿™ç®—æ³•å°±æ˜¯ä¸“é—¨ç ”ç©¶äº†å¤„ç†æ¢¯åº¦æ¶ˆå¤±é—®é¢˜çš„ã€‚å…¶å®å®ƒçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯è¦ä¿å­˜ä¿¡æ¯ä»¥ä¾¿åé¢ä½¿ç”¨ï¼Œé˜²æ­¢å‰é¢å¾—åˆ°çš„ä¿¡æ¯åœ¨åé¢çš„å¤„ç†ä¸­é€æ¸æ¶ˆå¤±ã€‚</p><p>LSTM åœ¨ SimpleRNN çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†ä¸€ç§è·¨è¶Šå¤šä¸ªæ—¶é—´æ­¥ä¼ é€’ä¿¡æ¯çš„æ–¹æ³•ã€‚è¿™ä¸ªæ–°æ–¹æ³•åšçš„äº‹æƒ…å°±åƒä¸€æ¡åœ¨åºåˆ—æ—è¾¹çš„è¾…åŠ©ä¼ é€å¸¦ï¼Œåºåˆ—ä¸­çš„ä¿¡æ¯å¯ä»¥åœ¨ä»»æ„ä½ç½®è·³ä¸Šä¼ é€å¸¦ï¼Œ ç„¶åè¢«ä¼ é€åˆ°æ›´æ™šçš„æ—¶é—´æ­¥ï¼Œå¹¶åœ¨éœ€è¦æ—¶åŸå°ä¸åŠ¨åœ°è·³å›æ¥ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghhebke5inj31p80rq78o.jpg" alt="å‰–æ LSTMï¼Œä» SimpleRNN åˆ° LSTM:æ·»åŠ ä¸€ä¸ªæºå¸¦è½¨é“"></p><p>è¿™é‡ŒæŠŠä¹‹å‰ SimpleRNN é‡Œé¢çš„æƒé‡ Wã€U é‡å‘½åä¸º Woã€Uo äº†ï¼ˆo è¡¨ç¤º outputï¼‰ã€‚ç„¶ååŠ äº†ä¸€ä¸ªâ€œæºå¸¦è½¨é“â€æ•°æ®æµï¼Œè¿™ä¸ªæºå¸¦è½¨é“å°±æ˜¯ç”¨æ¥æºå¸¦ä¿¡æ¯è·¨è¶Šæ—¶é—´æ­¥çš„ã€‚è¿™ä¸ªæºå¸¦è½¨é“ä¸Šé¢æ”¾ç€æ—¶é—´æ­¥ t çš„ ct ä¿¡æ¯ï¼ˆc è¡¨ç¤º carryï¼‰ï¼Œè¿™äº›ä¿¡æ¯å°†ä¸è¾“å…¥ã€çŠ¶æ€ä¸€èµ·è¿›è¡Œè¿ç®—ï¼Œè€Œå½±å“ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªæ—¶é—´æ­¥çš„çŠ¶æ€ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">output_t &#x3D; activation(dot(state_t, Uo) + dot(input_t, Wo) + dot(C_t, Vo) + bo)</span><br><span class="line"></span><br><span class="line">i_t &#x3D; activation(dot(state_t, Ui) + dot(input_t, Wi) + bi)</span><br><span class="line">f_t &#x3D; activation(dot(state_t, Uf) + dot(input_t, Wf) + bf)</span><br><span class="line">k_t &#x3D; activation(dot(state_t, Uk) + dot(input_t, Wk) + bk)</span><br><span class="line"></span><br><span class="line">c_t_next &#x3D; i_t * k_t + c_t * f_t</span><br></pre></td></tr></table></figure><p>å…³äº LSTM æ›´å¤šçš„ç»†èŠ‚ã€å†…éƒ¨å®ç°å°±ä¸ä»‹ç»äº†ã€‚å’±å®Œå…¨ä¸éœ€è¦ç†è§£å…³äº LSTM å•å…ƒçš„å…·ä½“æ¶æ„ï¼Œç†è§£è¿™ä¸œè¥¿å°±ä¸æ˜¯äººå¹²çš„äº‹ã€‚æˆ‘ä»¬åªéœ€è¦è®°ä½ LSTM å•å…ƒçš„ä½œç”¨: å…è®¸æŠŠè¿‡å»çš„ä¿¡æ¯ç¨åå†æ¬¡æ‹¿è¿›æ¥ç”¨ï¼Œä»è€Œå¯¹æŠ—æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚</p><p>(P.S. ä½œè€…è¯´è¿™é‡Œæ˜¯ç„å­¦ï¼Œä¿¡ä»–å°±è¡Œäº†ã€‚ğŸ¤ª Emmmï¼Œè¿™å¥æ˜¯æˆ‘èƒ¡ç¿»çš„ï¼ŒåŸè¯æ˜¯:â€œit may seem a bit arbitrary, but bear with me.â€)</p><p><strong>GRU</strong>ï¼ˆGated Recurrent Unit, é—¨æ§å¾ªç¯å•å…ƒï¼‰ï¼Œä¹¦ä¸Šæçš„æ¯”è¾ƒå°‘ï¼Œå‚è€ƒè¿™ç¯‡ ã€Š<a href="https://zhuanlan.zhihu.com/p/32481747">äººäººéƒ½èƒ½çœ‹æ‡‚çš„GRU</a>ã€‹ï¼Œè¯´ GRU å¤§æ¦‚æ˜¯ LSTM çš„ä¸€ç§å˜ç§å§ï¼ŒäºŒè€…åŸç†åŒºåˆ«ä¸å¤§ã€å®é™…æ•ˆæœä¸Šä¹Ÿå·®ä¸å¤šã€‚ä½† GRU æ¯” LSTM æ–°ä¸€äº›ï¼Œå®ƒåšäº†ä¸€äº›ç®€åŒ–ï¼Œæ›´å®¹æ˜“è®¡ç®—ä¸€äº›ï¼Œä½†ç›¸åº”è¡¨ç¤ºèƒ½åŠ›å¯èƒ½ç¨å·®ä¸€ç‚¹ç‚¹ã€‚</p><h4 id="Keras-ä¸­ä½¿ç”¨-LSTM"><a href="#Keras-ä¸­ä½¿ç”¨-LSTM" class="headerlink" title="Keras ä¸­ä½¿ç”¨ LSTM"></a>Keras ä¸­ä½¿ç”¨ LSTM</h4><p>æˆ‘ä»¬è¿˜æ˜¯ç»§ç»­ç”¨ä¹‹å‰å¤„ç†å¥½çš„çš„ IMDB æ•°æ®æ¥è·‘ä¸€ä¸ª LSTMï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> LSTM</span><br><span class="line"></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(Embedding(max_features, <span class="number">32</span>))</span><br><span class="line">model.add(LSTM(<span class="number">32</span>))</span><br><span class="line">model.add(Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>))</span><br><span class="line"></span><br><span class="line">model.summary()</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>, </span><br><span class="line">              loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>, </span><br><span class="line">              metrics=[<span class="string">&#x27;acc&#x27;</span>])</span><br><span class="line"></span><br><span class="line">history = model.fit(input_train, y_train, </span><br><span class="line">                    epochs=<span class="number">10</span>, </span><br><span class="line">                    batch_size=<span class="number">128</span>, </span><br><span class="line">                    validation_split=<span class="number">0.2</span>)</span><br></pre></td></tr></table></figure><pre><code>Model: &quot;sequential_5&quot;_________________________________________________________________Layer (type)                 Output Shape              Param #   =================================================================embedding_5 (Embedding)      (None, None, 32)          320000    _________________________________________________________________lstm (LSTM)                  (None, 32)                8320      _________________________________________________________________dense_1 (Dense)              (None, 1)                 33        =================================================================Total params: 328,353Trainable params: 328,353Non-trainable params: 0_________________________________________________________________Epoch 1/10157/157 [==============================] - 37s 236ms/step - loss: 0.5143 - acc: 0.7509 - val_loss: 0.3383 - val_acc: 0.8672Epoch 2/10157/157 [==============================] - 37s 235ms/step - loss: 0.3010 - acc: 0.8834 - val_loss: 0.2817 - val_acc: 0.8862Epoch 3/10157/157 [==============================] - 34s 215ms/step - loss: 0.2357 - acc: 0.9129 - val_loss: 0.2766 - val_acc: 0.8876Epoch 4/10157/157 [==============================] - 34s 215ms/step - loss: 0.2062 - acc: 0.9255 - val_loss: 0.4392 - val_acc: 0.8310Epoch 5/10157/157 [==============================] - 34s 215ms/step - loss: 0.1762 - acc: 0.9360 - val_loss: 0.3078 - val_acc: 0.8670Epoch 6/10157/157 [==============================] - 34s 215ms/step - loss: 0.1575 - acc: 0.9436 - val_loss: 0.3293 - val_acc: 0.8902Epoch 7/10157/157 [==============================] - 35s 222ms/step - loss: 0.1419 - acc: 0.9506 - val_loss: 0.2993 - val_acc: 0.8898Epoch 8/10157/157 [==============================] - 39s 246ms/step - loss: 0.1277 - acc: 0.9546 - val_loss: 0.4179 - val_acc: 0.8234Epoch 9/10157/157 [==============================] - 35s 225ms/step - loss: 0.1199 - acc: 0.9585 - val_loss: 0.4391 - val_acc: 0.8434Epoch 10/10157/157 [==============================] - 34s 217ms/step - loss: 0.1113 - acc: 0.9615 - val_loss: 0.4926 - val_acc: 0.8614</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»˜åˆ¶ç»“æœ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">acc = history.history[<span class="string">&#x27;acc&#x27;</span>]</span><br><span class="line">val_acc = history.history[<span class="string">&#x27;val_acc&#x27;</span>]</span><br><span class="line">loss = history.history[<span class="string">&#x27;loss&#x27;</span>]</span><br><span class="line">val_loss = history.history[<span class="string">&#x27;val_loss&#x27;</span>]</span><br><span class="line"></span><br><span class="line">epochs = <span class="built_in">range</span>(<span class="built_in">len</span>(acc))</span><br><span class="line"></span><br><span class="line">plt.plot(epochs, acc, <span class="string">&#x27;bo-&#x27;</span>, label=<span class="string">&#x27;Training acc&#x27;</span>)</span><br><span class="line">plt.plot(epochs, val_acc, <span class="string">&#x27;rs-&#x27;</span>, label=<span class="string">&#x27;Validation acc&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation accuracy&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">plt.figure()</span><br><span class="line"></span><br><span class="line">plt.plot(epochs, loss, <span class="string">&#x27;bo-&#x27;</span>, label=<span class="string">&#x27;Training loss&#x27;</span>)</span><br><span class="line">plt.plot(epochs, val_loss, <span class="string">&#x27;rs-&#x27;</span>, label=<span class="string">&#x27;Validation loss&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation loss&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghnsko5b0pj30al07cdg3.jpg" alt="png"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghnskmosogj30al07cdg5.jpg" alt="png"></p><p>æ¯” SimpleRNN å¥½å¤šäº†ã€‚ä½†ä¹Ÿæ²¡æ¯”ä»¥å‰é‚£ç§ç”¨å…¨è¿æ¥å±‚çš„ç½‘ç»œå¥½å¤šå°‘ï¼Œè€Œä¸”è¿˜æ¯”è¾ƒæ…¢(è®¡ç®—ä»£ä»·å¤§)ï¼Œå…¶å®ä¸»è¦æ˜¯ç”±äºæƒ…æ„Ÿåˆ†æè¿™æ ·çš„é—®é¢˜ï¼Œç”¨ LSTM å»åˆ†æå…¨å±€çš„é•¿æœŸæ€§ç»“æ„å¸®åŠ©å¹¶ä¸æ˜¯å¾ˆå¤§ï¼ŒLSTM æ“…é•¿çš„æ˜¯æ›´å¤æ‚çš„è‡ªç„¶è¯­è¨€å¤„ç†é—®é¢˜ï¼Œæ¯”å¦‚æœºå™¨ç¿»è¯‘ã€‚ç”¨å…¨è¿æ¥çš„æ–¹æ³•ï¼Œå…¶å®æ˜¯åšäº†çœ‹å‡ºç°äº†å“ªäº›è¯åŠå…¶å‡ºç°é¢‘ç‡ï¼Œè¿™ä¸ªå¯¹è¿™ç§ç®€å•é—®é¢˜è¿˜æ¯”è¾ƒæœ‰æ•ˆã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬å†è¯•è¯•ä¹¦ä¸Šæ²¡æçš„ GRUï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŠŠ LSTM æ”¹æˆç”¨ GRU</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> GRU</span><br><span class="line"></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(Embedding(max_features, <span class="number">32</span>))</span><br><span class="line">model.add(GRU(<span class="number">32</span>))</span><br><span class="line">model.add(Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>))</span><br><span class="line"></span><br><span class="line">model.summary()</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>, </span><br><span class="line">              loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>, </span><br><span class="line">              metrics=[<span class="string">&#x27;acc&#x27;</span>])</span><br><span class="line"></span><br><span class="line">history = model.fit(input_train, y_train, </span><br><span class="line">                    epochs=<span class="number">10</span>, </span><br><span class="line">                    batch_size=<span class="number">128</span>, </span><br><span class="line">                    validation_split=<span class="number">0.2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»˜åˆ¶ç»“æœ</span></span><br><span class="line"></span><br><span class="line">acc = history.history[<span class="string">&#x27;acc&#x27;</span>]</span><br><span class="line">val_acc = history.history[<span class="string">&#x27;val_acc&#x27;</span>]</span><br><span class="line">loss = history.history[<span class="string">&#x27;loss&#x27;</span>]</span><br><span class="line">val_loss = history.history[<span class="string">&#x27;val_loss&#x27;</span>]</span><br><span class="line"></span><br><span class="line">epochs = <span class="built_in">range</span>(<span class="built_in">len</span>(acc))</span><br><span class="line"></span><br><span class="line">plt.plot(epochs, acc, <span class="string">&#x27;bo-&#x27;</span>, label=<span class="string">&#x27;Training acc&#x27;</span>)</span><br><span class="line">plt.plot(epochs, val_acc, <span class="string">&#x27;rs-&#x27;</span>, label=<span class="string">&#x27;Validation acc&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation accuracy&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">plt.figure()</span><br><span class="line"></span><br><span class="line">plt.plot(epochs, loss, <span class="string">&#x27;bo-&#x27;</span>, label=<span class="string">&#x27;Training loss&#x27;</span>)</span><br><span class="line">plt.plot(epochs, val_loss, <span class="string">&#x27;rs-&#x27;</span>, label=<span class="string">&#x27;Validation loss&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation loss&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><pre><code>Model: &quot;sequential_6&quot;_________________________________________________________________Layer (type)                 Output Shape              Param #   =================================================================embedding_6 (Embedding)      (None, None, 32)          320000    _________________________________________________________________gru (GRU)                    (None, 32)                6336      _________________________________________________________________dense_2 (Dense)              (None, 1)                 33        =================================================================Total params: 326,369Trainable params: 326,369Non-trainable params: 0_________________________________________________________________Epoch 1/10157/157 [==============================] - 37s 238ms/step - loss: 0.5119 - acc: 0.7386 - val_loss: 0.3713 - val_acc: 0.8434Epoch 2/10157/157 [==============================] - 36s 232ms/step - loss: 0.2971 - acc: 0.8806 - val_loss: 0.3324 - val_acc: 0.8722Epoch 3/10157/157 [==============================] - 37s 235ms/step - loss: 0.2495 - acc: 0.9034 - val_loss: 0.3148 - val_acc: 0.8722Epoch 4/10157/157 [==============================] - 34s 217ms/step - loss: 0.2114 - acc: 0.9200 - val_loss: 0.3596 - val_acc: 0.8738Epoch 5/10157/157 [==============================] - 36s 231ms/step - loss: 0.1872 - acc: 0.9306 - val_loss: 0.5291 - val_acc: 0.8084Epoch 6/10157/157 [==============================] - 35s 226ms/step - loss: 0.1730 - acc: 0.9359 - val_loss: 0.3976 - val_acc: 0.8802Epoch 7/10157/157 [==============================] - 34s 217ms/step - loss: 0.1523 - acc: 0.9452 - val_loss: 0.4303 - val_acc: 0.8532Epoch 8/10157/157 [==============================] - 34s 217ms/step - loss: 0.1429 - acc: 0.9486 - val_loss: 0.4019 - val_acc: 0.8542Epoch 9/10157/157 [==============================] - 34s 217ms/step - loss: 0.1258 - acc: 0.9562 - val_loss: 0.3476 - val_acc: 0.8746Epoch 10/10157/157 [==============================] - 34s 216ms/step - loss: 0.1191 - acc: 0.9585 - val_loss: 0.3558 - val_acc: 0.8812</code></pre><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghnskl04gej30al07cjrn.jpg" alt="png"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghnsklsn9gj30af07cglv.jpg" alt="png"></p><p>æ‰€ä»¥è¯´ï¼Œç»“æœåŒºåˆ«ä¸å¤§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> Deep Learning with Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
            <tag> Deep Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonæ·±åº¦å­¦ä¹ ä¹‹å¤„ç†æ–‡æœ¬æ•°æ®</title>
      <link href="/2020/08/11/DeepLearningWithPython/Deep-Learning%20with-Python-ch6_1/"/>
      <url>/2020/08/11/DeepLearningWithPython/Deep-Learning%20with-Python-ch6_1/</url>
      
        <content type="html"><![CDATA[<h1 id="Deep-Learning-with-Python"><a href="#Deep-Learning-with-Python" class="headerlink" title="Deep Learning with Python"></a>Deep Learning with Python</h1><p>è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘å­¦ä¹ ã€ŠDeep Learning with Pythonã€‹(ç¬¬äºŒç‰ˆï¼ŒFranÃ§ois Chollet è‘—) æ—¶å†™çš„ç³»åˆ—ç¬”è®°ä¹‹ä¸€ã€‚æ–‡ç« çš„å†…å®¹æ˜¯ä»  Jupyter notebooks è½¬æˆ Markdown çš„ï¼Œä½ å¯ä»¥å» <a href="https://github.com/cdfmlr/Deep-Learning-with-Python-Notebooks">GitHub</a> æˆ– <a href="https://gitee.com/cdfmlr/Deep-Learning-with-Python-Notebooks">Gitee</a> æ‰¾åˆ°åŸå§‹çš„ <code>.ipynb</code> ç¬”è®°æœ¬ã€‚</p><p>ä½ å¯ä»¥å»<a href="https://livebook.manning.com/book/deep-learning-with-python">è¿™ä¸ªç½‘ç«™åœ¨çº¿é˜…è¯»è¿™æœ¬ä¹¦çš„æ­£ç‰ˆåŸæ–‡</a>(è‹±æ–‡)ã€‚è¿™æœ¬ä¹¦çš„ä½œè€…ä¹Ÿç»™å‡ºäº†é…å¥—çš„ <a href="https://github.com/fchollet/deep-learning-with-python-notebooks">Jupyter notebooks</a>ã€‚</p><p>æœ¬æ–‡ä¸º <strong>ç¬¬6ç«   æ·±åº¦å­¦ä¹ ç”¨äºæ–‡æœ¬å’Œåºåˆ—</strong> (Chapter 6. <em>Deep learning for text and sequences</em>) çš„ç¬”è®°ã€‚</p><p>[TOC]</p><h2 id="6-1-Working-with-text-data"><a href="#6-1-Working-with-text-data" class="headerlink" title="6.1  Working with text data"></a>6.1  Working with text data</h2><blockquote><p>å¤„ç†æ–‡æœ¬æ•°æ®</p></blockquote><p>è¦ç”¨æ·±åº¦å­¦ä¹ çš„ç¥ç»ç½‘ç»œå¤„ç†æ–‡æœ¬æ•°æ®ï¼Œå’Œå›¾ç‰‡ç±»ä¼¼ï¼Œä¹Ÿè¦æŠŠæ•°æ®å‘é‡åŒ–ï¼šæ–‡æœ¬ -&gt; æ•°å€¼å¼ é‡ã€‚</p><p>è¦åšè¿™ç§äº‹æƒ…å¯ä»¥æŠŠæ¯ä¸ªå•è¯å˜æˆå‘é‡ï¼Œä¹Ÿå¯ä»¥æŠŠå­—ç¬¦å˜æˆå‘é‡ï¼Œè¿˜å¯ä»¥æŠŠå¤šä¸ªè¿ç»­å•è¯æˆ–å­—ç¬¦(ç§°ä¸º <em>N-grams</em>)å˜æˆå‘é‡ã€‚</p><p>åæ­£ä¸ç®¡å¦‚ä½•åˆ’åˆ†ï¼Œæˆ‘ä»¬æŠŠæ–‡æœ¬æ‹†åˆ†å‡ºæ¥çš„å•å…ƒå«åš <em>tokens</em>ï¼ˆæ ‡è®°ï¼‰ï¼Œæ‹†åˆ†æ–‡æœ¬çš„è¿‡ç¨‹å«åš <em>tokenization</em>(åˆ†è¯)ã€‚</p><blockquote><p>æ³¨ï¼štoken çš„ä¸­æ–‡ç¿»è¯‘æ˜¯â€œæ ‡è®°â€ğŸ˜‚ã€‚è¿™äº›ç¿»è¯‘éƒ½æ€ªæ€ªçš„ï¼Œè™½ç„¶ token ç¡®å®æœ‰æ ‡è®°è¿™ä¸ªæ„æ€ï¼Œä½†æŠŠè¿™é‡Œçš„ token ç¿»è¯‘æˆæ ‡è®°å°±æ²¡å†…å‘³å„¿äº†ã€‚æˆ‘è§‰å¾— token æ˜¯é‚£ç§ä»¥ä¸€ä¸ªä¸œè¥¿ä»£è¡¨å¦ä¸€ä¸ªä¸œè¥¿æ¥ä½¿ç”¨çš„æ„æ€ï¼Œè¿™ç§ token æ˜¯ä¸€ç§æœ‰å®ä½“çš„ä¸œè¥¿ï¼Œæ¯”å¦‚ä»£é‡‘åˆ¸ã€‚â€œæ ‡è®°â€è¿™ä¸ªè¯åœ¨å­—å…¸ä¸Šä½œåè¯æ˜¯ã€Œèµ·æ ‡ç¤ºä½œç”¨çš„è®°å·ã€çš„æ„æ€ï¼Œè€Œæˆ‘è§‰å¾—è®°å·ä¸æ˜¯ä¸ªå¾ˆå®ä½“çš„ä¸œè¥¿ã€‚ä»£é‡‘åˆ¸ä¸æ˜¯ä¸€ç§è®°å·ã€ä¹Ÿå°±èƒ½è¯´æ˜¯æ ‡è®°ï¼ŒåŒæ ·çš„ï¼Œè¿™é‡Œçš„ token ä¹Ÿæ˜¯ä¸€ç§å®ä½“çš„ä¸œè¥¿ï¼Œæˆ‘è§‰å¾—ä¸èƒ½æŠŠå®ƒè¯´æˆæ˜¯â€œæ ‡è®°â€ã€‚æˆ‘ä¸èµåŒè¿™ç§è¯‘æ³•ï¼Œæ‰€ä»¥ä¸‹æ–‡æ‰€æœ‰æ¶‰åŠ token çš„åœ°æ–¹ç»Ÿä¸€å†™æˆ â€œtokenâ€ï¼Œä¸ç¿»è¯‘æˆâ€œæ ‡è®°â€ã€‚</p></blockquote><p>æ–‡æœ¬çš„å‘é‡åŒ–å°±æ˜¯å…ˆä½œåˆ†è¯ï¼Œç„¶åæŠŠç”Ÿæˆå‡ºæ¥çš„ token é€ä¸ªä¸æ•°å€¼å‘é‡å¯¹åº”èµ·æ¥ï¼Œæœ€åæ‹¿å¯¹åº”çš„æ•°å€¼å‘é‡åˆæˆä¸€ä¸ªè¡¨è¾¾äº†åŸæ–‡æœ¬çš„å¼ é‡ã€‚å…¶ä¸­ï¼Œæ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯å¦‚ä½•å»ºç«‹ token å’Œ æ•°å€¼å‘é‡ çš„è”ç³»ï¼Œä¸‹é¢ä»‹ç»ä¸¤ç§æè¿™ä¸ªçš„æ–¹æ³•ï¼šone-hot encoding(one-hotç¼–ç ) å’Œ token embedding(æ ‡è®°åµŒå…¥)ï¼Œå…¶ä¸­ token embedding ä¸€èˆ¬éƒ½ç”¨äºå•è¯ï¼Œå«ä½œè¯åµŒå…¥ã€Œword embeddingã€ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghek3mhp38j31320mg0v8.jpg" alt="æ–‡æœ¬çš„å‘é‡åŒ–ï¼šä»æ–‡æœ¬åˆ°tokenå†åˆ°å¼ é‡"></p><h3 id="n-grams-å’Œè¯è¢‹-bag-of-words"><a href="#n-grams-å’Œè¯è¢‹-bag-of-words" class="headerlink" title="n-grams å’Œè¯è¢‹(bag-of-words)"></a>n-grams å’Œè¯è¢‹(bag-of-words)</h3><p>n-gram æ˜¯èƒ½ä»ä¸€ä¸ªå¥å­ä¸­æå–å‡ºçš„ â‰¤N ä¸ªè¿ç»­å•è¯çš„é›†åˆã€‚ä¾‹å¦‚ï¼šã€ŒThe cat sat on the mat.ã€</p><p>è¿™ä¸ªå¥å­åˆ†è§£æˆ 2-gram æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;The&quot;, &quot;The cat&quot;, &quot;cat&quot;, &quot;cat sat&quot;, &quot;sat&quot;,</span><br><span class="line">  &quot;sat on&quot;, &quot;on&quot;, &quot;on the&quot;, &quot;the&quot;, &quot;the mat&quot;, &quot;mat&quot;&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé›†åˆè¢«å«åš bag-of-2-grams (äºŒå…ƒè¯­æ³•è¢‹)ã€‚</p><p>åˆ†è§£æˆ 3-gram æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;The&quot;, &quot;The cat&quot;, &quot;cat&quot;, &quot;cat sat&quot;, &quot;The cat sat&quot;,</span><br><span class="line">  &quot;sat&quot;, &quot;sat on&quot;, &quot;on&quot;, &quot;cat sat on&quot;, &quot;on the&quot;, &quot;the&quot;,</span><br><span class="line">  &quot;sat on the&quot;, &quot;the mat&quot;, &quot;mat&quot;, &quot;on the mat&quot;&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé›†åˆè¢«å«åš bag-of-3-grams (ä¸‰å…ƒè¯­æ³•è¢‹)ã€‚</p><p>æŠŠè¿™ä¸œè¥¿å«åšã€Œè¢‹ã€æ˜¯å› ä¸ºå®ƒåªæ˜¯ tokens ç»„æˆçš„é›†åˆï¼Œæ²¡æœ‰åŸæ¥æ–‡æœ¬çš„é¡ºåºå’Œæ„ä¹‰ã€‚æŠŠæ–‡æœ¬åˆ†æˆè¿™ç§è¢‹çš„åˆ†è¯æ–¹æ³•å«åšã€Œè¯è¢‹(bag-of-words)ã€ã€‚</p><p>ç”±äºè¯è¢‹æ˜¯ä¸ä¿å­˜é¡ºåºçš„ï¼ˆåˆ†å‡ºæ¥æ˜¯é›†åˆï¼Œä¸æ˜¯åºåˆ—ï¼‰ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸åœ¨æ·±åº¦å­¦ä¹ é‡Œé¢ç”¨ã€‚ä½†åœ¨è½»é‡çº§çš„æµ…å±‚æ–‡æœ¬å¤„ç†æ¨¡å‹é‡Œé¢ï¼Œn-gram å’Œè¯è¢‹è¿˜æ˜¯å¾ˆé‡è¦çš„æ–¹æ³•çš„ã€‚</p><h3 id="one-hot-ç¼–ç "><a href="#one-hot-ç¼–ç " class="headerlink" title="one-hot ç¼–ç "></a>one-hot ç¼–ç </h3><p>one-hot æ˜¯æ¯”è¾ƒåŸºæœ¬ã€å¸¸ç”¨çš„ã€‚å…¶åšæ³•æ˜¯å°†æ¯ä¸ª token ä¸ä¸€ä¸ªå”¯ä¸€æ•´æ•°ç´¢å¼•å…³è”ï¼Œ ç„¶åå°†æ•´æ•°ç´¢å¼• i è½¬æ¢ä¸ºé•¿åº¦ä¸º N çš„äºŒè¿›åˆ¶å‘é‡(N æ˜¯è¯è¡¨å¤§å°)ï¼Œè¿™ä¸ªå‘é‡åªæœ‰ç¬¬ i ä¸ªå…ƒç´ ä¸º 1ï¼Œå…¶ä½™å…ƒç´ éƒ½ä¸º 0ã€‚</p><p>ä¸‹é¢ç»™å‡ºä¸¤ä¸ªç©å…·ç‰ˆæœ¬çš„ one-hot ç¼–ç ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å•è¯çº§çš„ one-hot ç¼–ç </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">samples = [<span class="string">&#x27;The cat sat on the mat.&#x27;</span>, <span class="string">&#x27;The dog ate my homework.&#x27;</span>]</span><br><span class="line"></span><br><span class="line">token_index = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> sample <span class="keyword">in</span> samples:</span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> sample.split():</span><br><span class="line">        <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> token_index:</span><br><span class="line">            token_index[word] = <span class="built_in">len</span>(token_index) + <span class="number">1</span></span><br><span class="line">            </span><br><span class="line"><span class="comment"># å¯¹æ ·æœ¬è¿›è¡Œåˆ†è¯ã€‚åªè€ƒè™‘æ¯ä¸ªæ ·æœ¬å‰ max_length ä¸ªå•è¯</span></span><br><span class="line">max_length = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">results = np.zeros(shape=(<span class="built_in">len</span>(samples), </span><br><span class="line">                          max_length, </span><br><span class="line">                          <span class="built_in">max</span>(token_index.values()) + <span class="number">1</span>))</span><br><span class="line"><span class="keyword">for</span> i, sample <span class="keyword">in</span> <span class="built_in">enumerate</span>(samples):</span><br><span class="line">    <span class="keyword">for</span> j, word <span class="keyword">in</span> <span class="built_in">list</span>(<span class="built_in">enumerate</span>(sample.split()))[:max_length]:</span><br><span class="line">        index = token_index.get(word)</span><br><span class="line">        results[i, j, index] = <span class="number">1.</span></span><br><span class="line"></span><br><span class="line">print(results)</span><br></pre></td></tr></table></figure><pre><code>[[[0. 1. 0. 0. 0. 0. 0. 0. 0. 0. 0.]  [0. 0. 1. 0. 0. 0. 0. 0. 0. 0. 0.]  [0. 0. 0. 1. 0. 0. 0. 0. 0. 0. 0.]  [0. 0. 0. 0. 1. 0. 0. 0. 0. 0. 0.]  [0. 0. 0. 0. 0. 1. 0. 0. 0. 0. 0.]  [0. 0. 0. 0. 0. 0. 1. 0. 0. 0. 0.]  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]] [[0. 1. 0. 0. 0. 0. 0. 0. 0. 0. 0.]  [0. 0. 0. 0. 0. 0. 0. 1. 0. 0. 0.]  [0. 0. 0. 0. 0. 0. 0. 0. 1. 0. 0.]  [0. 0. 0. 0. 0. 0. 0. 0. 0. 1. 0.]  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 1.]  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]]]</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å­—ç¬¦çº§çš„ one-hot ç¼–ç </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">samples = [<span class="string">&#x27;The cat sat on the mat.&#x27;</span>, <span class="string">&#x27;The dog ate my homework.&#x27;</span>]</span><br><span class="line"></span><br><span class="line">characters = string.printable    <span class="comment"># æ‰€æœ‰å¯æ‰“å°çš„ ASCII å­—ç¬¦</span></span><br><span class="line">token_index = <span class="built_in">dict</span>(<span class="built_in">zip</span>(<span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(characters) + <span class="number">1</span>), characters))</span><br><span class="line"></span><br><span class="line">max_length = <span class="number">50</span></span><br><span class="line">results = np.zeros((<span class="built_in">len</span>(samples), max_length, <span class="built_in">max</span>(token_index.keys()) + <span class="number">1</span>))</span><br><span class="line"><span class="keyword">for</span> i, sample <span class="keyword">in</span> <span class="built_in">enumerate</span>(samples):</span><br><span class="line">    <span class="keyword">for</span> j, character <span class="keyword">in</span> <span class="built_in">enumerate</span>(sample):</span><br><span class="line">        index = token_index.get(character)</span><br><span class="line">        results[i, j, index] = <span class="number">1.</span></span><br><span class="line">        </span><br><span class="line">print(results)</span><br></pre></td></tr></table></figure><pre><code>[[[1. 1. 1. ... 1. 1. 1.]  [1. 1. 1. ... 1. 1. 1.]  [1. 1. 1. ... 1. 1. 1.]  ...  [0. 0. 0. ... 0. 0. 0.]  [0. 0. 0. ... 0. 0. 0.]  [0. 0. 0. ... 0. 0. 0.]] [[1. 1. 1. ... 1. 1. 1.]  [1. 1. 1. ... 1. 1. 1.]  [1. 1. 1. ... 1. 1. 1.]  ...  [0. 0. 0. ... 0. 0. 0.]  [0. 0. 0. ... 0. 0. 0.]  [0. 0. 0. ... 0. 0. 0.]]]</code></pre><p>Keras å†…ç½®äº†æ¯”åˆšæ‰å†™çš„è¿™ç§ç©å…·ç‰ˆæœ¬å¼ºå¤§å¾—å¤šçš„ one-hot ç¼–ç å·¥å…·ï¼Œåœ¨ç°å®ä½¿ç”¨ä¸­ï¼Œä½ åº”è¯¥ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œè€Œä¸æ˜¯ä½¿ç”¨åˆšæ‰çš„ç©å…·ç‰ˆæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.preprocessing.text <span class="keyword">import</span> Tokenizer</span><br><span class="line"></span><br><span class="line">samples = [<span class="string">&#x27;The cat sat on the mat.&#x27;</span>, <span class="string">&#x27;The dog ate my homework.&#x27;</span>]</span><br><span class="line"></span><br><span class="line">tokenizer = Tokenizer(num_words=<span class="number">1000</span>)    <span class="comment"># åªè€ƒè™‘å‰ 1000 ä¸ªæœ€å¸¸è§çš„å•è¯</span></span><br><span class="line">tokenizer.fit_on_texts(samples)</span><br><span class="line"></span><br><span class="line">sequences = tokenizer.texts_to_sequences(samples)    <span class="comment"># å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°ç´¢å¼•ç»„æˆçš„åˆ—è¡¨</span></span><br><span class="line">print(<span class="string">&#x27;sequences:&#x27;</span>, sequences)</span><br><span class="line"></span><br><span class="line">one_hot_results = tokenizer.texts_to_matrix(samples, mode=<span class="string">&#x27;binary&#x27;</span>)  <span class="comment"># ç›´æ¥å¾—åˆ° one-hot äºŒè¿›åˆ¶è¡¨ç¤º</span></span><br><span class="line"></span><br><span class="line">word_index = tokenizer.word_index    <span class="comment"># å•è¯ç´¢å¼•ï¼Œå°±æ˜¯è¯è¡¨å­—å…¸å•¦ï¼Œç”¨è¿™ä¸ªå°±å¯ä»¥è¿˜åŸæ•°æ®</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">f&#x27;one_hot_results: shape=<span class="subst">&#123;one_hot_results.shape&#125;</span>:\n&#x27;</span>, one_hot_results, )</span><br><span class="line">print(<span class="string">f&#x27;Found <span class="subst">&#123;<span class="built_in">len</span>(word_index)&#125;</span> unique tokens.&#x27;</span>, <span class="string">&#x27;word_index:&#x27;</span>, word_index)</span><br></pre></td></tr></table></figure><pre><code>sequences: [[1, 2, 3, 4, 1, 5], [1, 6, 7, 8, 9]]one_hot_results: shape=(2, 1000): [[0. 1. 1. ... 0. 0. 0.] [0. 1. 0. ... 0. 0. 0.]]Found 9 unique tokens. word_index: &#123;&#39;the&#39;: 1, &#39;cat&#39;: 2, &#39;sat&#39;: 3, &#39;on&#39;: 4, &#39;mat&#39;: 5, &#39;dog&#39;: 6, &#39;ate&#39;: 7, &#39;my&#39;: 8, &#39;homework&#39;: 9&#125;</code></pre><p>è¿™ç§ one-hot ç¼–ç è¿˜æœ‰ä¸€ç§ç®€å•çš„å˜ç§å«åš <em>one-hot hashing trick</em>ï¼ˆone-hot æ•£åˆ—æŠ€å·§ï¼‰ï¼Œè¿™ä¸ªæ–¹æ³•çš„æ€æƒ³æ˜¯ä¸å¯¹æ¯ä¸ª token å…³è”å”¯ä¸€çš„æ•´æ•°ç´¢å¼•ï¼Œè€Œæ˜¯ç”¨å“ˆå¸Œå‡½æ•°å»ä½œç”¨ï¼ŒæŠŠæ–‡æœ¬ç›´æ¥æ˜ å°„æˆä¸€ä¸ªå›ºå®šé•¿åº¦çš„å‘é‡ã€‚</p><p>ç”¨è¿™ç§æ–¹æ³•å¯ä»¥èŠ‚çœç»´æŠ¤å•è¯ç´¢å¼•çš„å†…å­˜å¼€é”€ï¼Œè¿˜å¯ä»¥å®ç°åœ¨çº¿ç¼–ç ï¼ˆæ¥ä¸€ä¸ªç¼–ç ä¸€ä¸ªï¼Œä¸å½±å“ä¹‹ã€ä¹‹åçš„ï¼‰ï¼›ä½†ä¹Ÿæœ‰ä¸€äº›å¼Šç«¯ï¼šå¯èƒ½å‡ºç°æ•£åˆ—å†²çªï¼Œç¼–ç åçš„æ•°æ®ä¹Ÿä¸èƒ½å¤Ÿè¿˜åŸã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨æ•£åˆ—æŠ€å·§çš„å•è¯çº§çš„ one-hot ç¼–ç ï¼Œç©å…·ç‰ˆæœ¬</span></span><br><span class="line"></span><br><span class="line">samples = [<span class="string">&#x27;The cat sat on the mat.&#x27;</span>, <span class="string">&#x27;The dog ate my homework.&#x27;</span>]</span><br><span class="line"></span><br><span class="line">dimensionality = <span class="number">1000</span>  <span class="comment"># å°†å•è¯ä¿å­˜ä¸ºé•¿åº¦ä¸º 1000 çš„å‘é‡ï¼Œå•è¯è¶Šå¤šè¿™ä¸ªå€¼å°±è¦è¶Šå¤§ï¼Œä¸ç„¶æ•£åˆ—å†²çªå¯èƒ½ä¼šåŠ å¤§</span></span><br><span class="line">max_length = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">results = np.zeros((<span class="built_in">len</span>(samples), max_length, dimensionality))</span><br><span class="line"><span class="keyword">for</span> i, sample <span class="keyword">in</span> <span class="built_in">enumerate</span>(samples):</span><br><span class="line">    <span class="keyword">for</span> j, word <span class="keyword">in</span> <span class="built_in">list</span>(<span class="built_in">enumerate</span>(sample.split()))[:max_length]:</span><br><span class="line">        index = <span class="built_in">abs</span>(<span class="built_in">hash</span>(word)) % dimensionality  <span class="comment"># å°†å•è¯æ•£åˆ—åˆ° 0~dimensionality èŒƒå›´å†…çš„ä¸€ä¸ªéšæœºæ•´æ•°ç´¢å¼•</span></span><br><span class="line">        results[i, j, index] = <span class="number">1.</span></span><br><span class="line"></span><br><span class="line">print(results.shape)</span><br><span class="line">print(results)</span><br></pre></td></tr></table></figure><pre><code>(2, 10, 1000)[[[0. 0. 0. ... 0. 0. 0.]  [0. 0. 0. ... 0. 0. 0.]  [0. 0. 0. ... 0. 0. 0.]  ...  [0. 0. 0. ... 0. 0. 0.]  [0. 0. 0. ... 0. 0. 0.]  [0. 0. 0. ... 0. 0. 0.]] [[0. 0. 0. ... 0. 0. 0.]  [0. 0. 0. ... 0. 0. 0.]  [0. 0. 0. ... 0. 0. 0.]  ...  [0. 0. 0. ... 0. 0. 0.]  [0. 0. 0. ... 0. 0. 0.]  [0. 0. 0. ... 0. 0. 0.]]]</code></pre><h3 id="è¯åµŒå…¥"><a href="#è¯åµŒå…¥" class="headerlink" title="è¯åµŒå…¥"></a>è¯åµŒå…¥</h3><p>ä»å‰é¢çš„ä¾‹å­ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ° one-hot çš„è¿™ç§ç¡¬ç¼–ç å¾—åˆ°çš„ç»“æœå‘é‡ååˆ†ç¨€ç–ï¼Œå¹¶ä¸”ç»´åº¦æ¯”è¾ƒé«˜ã€‚</p><p>è¯åµŒå…¥ï¼ˆword embeddingï¼‰æ˜¯å¦ä¸€ç§å°†å•è¯ä¸å‘é‡ç›¸å…³è”çš„å¸¸ç”¨æ–¹æ³•ã€‚è¿™ç§æ–¹æ³•å¯ä»¥å¾—åˆ°æ¯” one-hot æ›´åŠ å¯†é›†ã€ä½ç»´çš„ç¼–ç ã€‚è¯åµŒå…¥çš„ç»“æœæ˜¯è¦ä»æ•°æ®ä¸­å­¦ä¹ å¾—åˆ°çš„ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gheskpva1tj31fq0u0aeq.jpg" alt="one-hotç¼–ç ä¸è¯åµŒå…¥çš„åŒºåˆ«"></p><p>è¿ç”¨è¯åµŒå…¥æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><ol><li>åˆ©ç”¨ Embedding å±‚å­¦ä¹ è¯åµŒå…¥ï¼šåœ¨å®Œæˆç€æ‰‹è¿›è¡Œçš„ä¸»è¦ä»»åŠ¡(æ¯”å¦‚æ–‡æ¡£åˆ†ç±»æˆ–æƒ…æ„Ÿé¢„æµ‹)çš„åŒæ—¶å­¦ä¹ è¯åµŒå…¥ï¼šä¸€å¼€å§‹ä½¿ç”¨éšæœºçš„è¯å‘é‡ï¼Œç„¶åå¯¹è¯å‘é‡ç”¨ä¸å­¦ä¹ ç¥ç»ç½‘ç»œçš„æƒé‡ç›¸åŒçš„æ–¹æ³•è¿›è¡Œå­¦ä¹ ã€‚</li><li>åˆ©ç”¨é¢„è®­ç»ƒè¯åµŒå…¥(pretrained word embedding)ï¼šåœ¨ä¸åŒäºå¾…è§£å†³é—®é¢˜çš„æœºå™¨å­¦ä¹ ä»»åŠ¡ä¸Šé¢„è®­ç»ƒå¥½è¯åµŒå…¥ï¼Œç„¶åå°†å…¶åŠ è½½åˆ°æ¨¡å‹ä¸­ã€‚</li></ol><h4 id="åˆ©ç”¨-Embedding-å±‚å­¦ä¹ è¯åµŒå…¥"><a href="#åˆ©ç”¨-Embedding-å±‚å­¦ä¹ è¯åµŒå…¥" class="headerlink" title="åˆ©ç”¨ Embedding å±‚å­¦ä¹ è¯åµŒå…¥"></a>åˆ©ç”¨ Embedding å±‚å­¦ä¹ è¯åµŒå…¥</h4><p>ä¸€ä¸ªç†æƒ³çš„è¯åµŒå…¥ç©ºé—´åº”è¯¥æ˜¯å¯ä»¥æ¯”è¾ƒå®Œç¾åœ°æ˜ å°„äººç±»è¯­è¨€çš„ã€‚å®ƒæ˜¯æœ‰ç¬¦åˆç°å®çš„ç»“æ„çš„ï¼Œç›¸è¿‘çš„è¯åœ¨ç©ºé—´ä¸­å°±åº”è¯¥æ¯”è¾ƒæ¥è¿‘ï¼Œå¹¶ä¸”è¯åµŒå…¥ç©ºé—´ä¸­çš„æ–¹å‘ä¹Ÿæ˜¯è¦æœ‰æ„ä¹‰çš„ã€‚ä¾‹å¦‚ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ä¾‹å­ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghetlonkiij30i40lmmyf.jpg" alt="è¯åµŒå…¥ç©ºé—´çš„ç®€å•ç¤ºä¾‹"></p><p>åœ¨è¿™ä¸ªè¯åµŒå…¥ç©ºé—´ä¸­ï¼Œå® ç‰©éƒ½åœ¨é ä¸‹çš„ä½ç½®ï¼Œé‡ç”ŸåŠ¨ç‰©éƒ½åœ¨é ä¸Šçš„ä½ç½®ï¼Œæ‰€ä»¥ä¸€ä¸ªä»ä¸‹åˆ°ä¸Šæ–¹å‘çš„å‘é‡å°±åº”è¯¥æ˜¯è¡¨ç¤ºä»å® ç‰©åˆ°é‡ç”ŸåŠ¨ç‰©çš„ï¼Œè¿™ä¸ªå‘é‡ä» cat åˆ° tiger æˆ–è€… dog -&gt; wolfã€‚ç±»ä¼¼çš„ï¼Œä¸€ä¸ªä»å·¦åˆ°å³çš„å‘é‡å¯ä»¥è§£é‡Šä¸ºä»çŠ¬ç§‘åˆ°çŒ«ç§‘ï¼Œè¿™ä¸ªå‘é‡å¯ä»¥ä» dog åˆ° catï¼Œæˆ–è€…ä» wolf åˆ° tigerã€‚</p><p>å†å¤æ‚ä¸€ç‚¹çš„ï¼Œæ¯”å¦‚è¦è¡¨ç¤ºè¯çš„æ€§åˆ«å…³ç³»ï¼Œå°† king å‘é‡åŠ ä¸Š female å‘é‡ï¼Œåº”è¯¥å¾—åˆ°çš„æ˜¯ queen å‘é‡ï¼Œè¿˜æœ‰å¤æ•°å…³ç³»ï¼šking + plural == kingsâ€¦â€¦</p><p>æ‰€ä»¥è¯´ï¼Œè¦æœ‰ä¸€ä¸ªè¿™æ ·å®Œç¾çš„è¯åµŒå…¥ç©ºé—´æ˜¯å¾ˆéš¾çš„ï¼Œç°åœ¨è¿˜æ²¡æœ‰ã€‚ä½†åˆ©ç”¨æ·±åº¦å­¦ä¹ ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥å¾—åˆ°å¯¹äºç‰¹å®šé—®é¢˜æ¥è¯´æ¯”è¾ƒå¥½çš„è¯åµŒå…¥ç©ºé—´çš„ã€‚åœ¨ Keras ä½¿ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦è®©æ¨¡å‹å­¦ä¹ ä¸€ä¸ª Embedding å±‚çš„æƒé‡å°±å¯ä»¥å¾—åˆ°å¯¹å½“å‰ä»»åŠ¡çš„è¯åµŒå…¥ç©ºé—´ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> Embedding</span><br><span class="line"></span><br><span class="line">embedding_layer = Embedding(<span class="number">1000</span>, <span class="number">64</span>)  <span class="comment"># Embedding(å¯èƒ½çš„tokenä¸ªæ•°, åµŒå…¥çš„ç»´åº¦)</span></span><br></pre></td></tr></table></figure><p>Embedding å±‚å…¶å®å°±ç›¸å½“äºæ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå®ƒå°†ä¸€ä¸ªè¡¨ç¤ºç‰¹å®šå•è¯çš„æ•´æ•°ç´¢å¼•æ˜ å°„åˆ°ä¸€ä¸ªè¯å‘é‡ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gheu1p4zqdj316i046aau.jpg" alt="Embedding å±‚"></p><p>Embedding å±‚çš„è¾“å…¥æ˜¯å½¢çŠ¶ä¸º <code>(samples, sequence_length)</code> çš„äºŒç»´æ•´æ•°å¼ é‡ã€‚è¿™ä¸ªè¾“å…¥å¼ é‡ä¸­çš„ä¸€ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªä»£è¡¨ä¸€ä¸ªæ–‡æœ¬åºåˆ—çš„æ•´æ•°åºåˆ—ï¼Œåº”è¯¥ä¿æŒè¾“å…¥çš„æ‰€æœ‰åºåˆ—é•¿åº¦ç›¸åŒï¼Œè¾ƒçŸ­çš„åºåˆ—åº”è¯¥ç”¨ 0 å¡«å……ï¼Œè¾ƒé•¿çš„åºåˆ—åº”è¯¥è¢«æˆªæ–­ã€‚</p><p>Embedding å±‚çš„è¾“å‡ºæ˜¯å½¢çŠ¶ä¸º <code>(samples, sequence_length, embedding_dimensionality)</code> çš„ä¸‰ç»´æµ®ç‚¹æ•°å¼ é‡ã€‚è¿™ä¸ªè¾“å‡ºå°±å¯ä»¥ç”¨ RNN æˆ–è€… Conv1D å»å¤„ç†åšå…¶ä»–äº‹æƒ…äº†ã€‚</p><p>Embedding å±‚ä¸€å¼€å§‹ä¹Ÿæ˜¯è¢«éšæœºåˆå§‹åŒ–çš„ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œä¼šåˆ©ç”¨åå‘ä¼ æ’­æ¥é€æ¸è°ƒèŠ‚è¯å‘é‡ã€æ”¹å˜ç©ºé—´ç»“æ„ï¼Œä¸€æ­¥æ­¥æ¥è¿‘æˆ‘ä»¬ä¹‹å‰æåˆ°çš„é‚£ç§ç†æƒ³çš„çŠ¶æ€ã€‚</p><p>å®ä¾‹ï¼šç”¨ Embedding å±‚å¤„ç† IMDB ç”µå½±è¯„è®ºæƒ…æ„Ÿé¢„æµ‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŠ è½½ IMDB æ•°æ®ï¼Œå‡†å¤‡ç”¨äº Embedding å±‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.datasets <span class="keyword">import</span> imdb</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> preprocessing</span><br><span class="line"></span><br><span class="line">max_features = <span class="number">10000</span>    <span class="comment"># ä½œä¸ºç‰¹å¾çš„å•è¯ä¸ªæ•°</span></span><br><span class="line">maxlen = <span class="number">20</span>    <span class="comment"># åœ¨ maxlen ä¸ªç‰¹å¾å•è¯åæˆªæ–­æ–‡æœ¬</span></span><br><span class="line"></span><br><span class="line">(x_train, y_train), (x_test, y_test) = imdb.load_data(num_words=max_features)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ•´æ•°åˆ—è¡¨è½¬æ¢æˆå½¢çŠ¶ä¸º (samples, maxlen) çš„äºŒç»´æ•´æ•°å¼ é‡</span></span><br><span class="line">x_train = preprocessing.sequence.pad_sequences(x_train, maxlen=maxlen)</span><br><span class="line">x_test = preprocessing.sequence.pad_sequences(x_test, maxlen=maxlen)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨ IMDB æ•°æ®ä¸Šä½¿ç”¨ Embedding å±‚å’Œåˆ†ç±»å™¨</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> Embedding, Flatten, Dense</span><br><span class="line"></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(Embedding(<span class="number">10000</span>, <span class="number">8</span>, input_length=maxlen))  <span class="comment"># (samples, maxlen, 8)</span></span><br><span class="line">model.add(Flatten())  <span class="comment"># (samles, maxlen*8)</span></span><br><span class="line">model.add(Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>))  <span class="comment"># top classifier</span></span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>,</span><br><span class="line">              loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>,</span><br><span class="line">              metrics=[<span class="string">&#x27;acc&#x27;</span>])</span><br><span class="line">model.summary()</span><br><span class="line"></span><br><span class="line">history = model.fit(x_train, y_train, </span><br><span class="line">                    epochs=<span class="number">10</span>, </span><br><span class="line">                    batch_size=<span class="number">32</span>, </span><br><span class="line">                    validation_split=<span class="number">0.2</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><pre><code>Model: &quot;sequential_1&quot;_________________________________________________________________Layer (type)                 Output Shape              Param #   =================================================================embedding_2 (Embedding)      (None, 20, 8)             80000     _________________________________________________________________flatten_1 (Flatten)          (None, 160)               0         _________________________________________________________________dense_1 (Dense)              (None, 1)                 161       =================================================================Total params: 80,161Trainable params: 80,161Non-trainable params: 0_________________________________________________________________Epoch 1/10625/625 [==============================] - 1s 1ms/step - loss: 0.6686 - acc: 0.6145 - val_loss: 0.6152 - val_acc: 0.6952Epoch 2/10625/625 [==============================] - 1s 929us/step - loss: 0.5370 - acc: 0.7525 - val_loss: 0.5214 - val_acc: 0.7318Epoch 3/10625/625 [==============================] - 1s 878us/step - loss: 0.4573 - acc: 0.7895 - val_loss: 0.4979 - val_acc: 0.7456Epoch 4/10625/625 [==============================] - 1s 889us/step - loss: 0.4182 - acc: 0.8116 - val_loss: 0.4937 - val_acc: 0.7512Epoch 5/10625/625 [==============================] - 1s 902us/step - loss: 0.3931 - acc: 0.8224 - val_loss: 0.4935 - val_acc: 0.7568Epoch 6/10625/625 [==============================] - 1s 931us/step - loss: 0.3721 - acc: 0.8360 - val_loss: 0.4969 - val_acc: 0.7582Epoch 7/10625/625 [==============================] - 1s 878us/step - loss: 0.3534 - acc: 0.8482 - val_loss: 0.5050 - val_acc: 0.7570Epoch 8/10625/625 [==============================] - 1s 873us/step - loss: 0.3356 - acc: 0.8579 - val_loss: 0.5103 - val_acc: 0.7556Epoch 9/10625/625 [==============================] - 1s 999us/step - loss: 0.3183 - acc: 0.8670 - val_loss: 0.5161 - val_acc: 0.7560Epoch 10/10625/625 [==============================] - 1s 886us/step - loss: 0.3017 - acc: 0.8766 - val_loss: 0.5260 - val_acc: 0.7508</code></pre><p>è¿™é‡Œæˆ‘ä»¬åªæŠŠè¯åµŒå…¥åºåˆ—å±•å¼€ä¹‹åç”¨ä¸€ä¸ª Dense å±‚å»å®Œæˆåˆ†ç±»ï¼Œä¼šå¯¼è‡´æ¨¡å‹å¯¹è¾“å…¥åºåˆ—ä¸­çš„æ¯ä¸ªè¯å•ç‹¬å¤„ç†ï¼Œè€Œä¸å»è€ƒè™‘å•è¯ä¹‹é—´çš„å…³ç³»å’Œå¥å­ç»“æ„ã€‚è¿™ä¼šå¯¼è‡´æ¨¡å‹è®¤ä¸ºã€Œthis movie is a bomb(è¿™ç”µå½±è¶…çƒ‚)ã€å’Œã€Œthis movie is the bomb(è¿™ç”µå½±è¶…èµ)ã€éƒ½æ˜¯è´Ÿé¢è¯„ä»·ã€‚è¦å­¦ä¹ å¥å­æ•´ä½“çš„è¯å°±è¦ç”¨åˆ° RNN æˆ–è€… Conv1D äº†ï¼Œè¿™äº›ä¹‹åå†ä»‹ç»ã€‚</p><h4 id="ä½¿ç”¨é¢„è®­ç»ƒçš„è¯åµŒå…¥"><a href="#ä½¿ç”¨é¢„è®­ç»ƒçš„è¯åµŒå…¥" class="headerlink" title="ä½¿ç”¨é¢„è®­ç»ƒçš„è¯åµŒå…¥"></a>ä½¿ç”¨é¢„è®­ç»ƒçš„è¯åµŒå…¥</h4><p>å’Œæˆ‘ä»¬åœ¨åšè®¡ç®—æœºè§†è§‰çš„æ—¶å€™ä½¿ç”¨é¢„è®­ç»ƒç½‘ç»œä¸€æ ·ï¼Œåœ¨æ‰‹å¤´æ•°æ®å°‘çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨é¢„è®­ç»ƒçš„è¯åµŒå…¥ï¼Œå€Ÿç”¨äººå®¶è®­ç»ƒå‡ºæ¥çš„å¯å¤ç”¨çš„æ¨¡å‹é‡Œçš„é€šç”¨ç‰¹å¾ã€‚</p><p>é€šç”¨çš„è¯åµŒå…¥é€šå¸¸æ˜¯åˆ©ç”¨è¯é¢‘ç»Ÿè®¡è®¡ç®—å¾—å‡ºçš„ï¼Œç°åœ¨ä¹Ÿæœ‰å¾ˆå¤šå¯ä¾›æˆ‘ä»¬é€‰ç”¨çš„äº†ï¼Œæ¯”å¦‚ word2vecã€GloVe ç­‰ç­‰ï¼Œå…·ä½“çš„åŸç†éƒ½æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬å…ˆä¼šç”¨å°±è¡Œäº†ã€‚</p><p>æˆ‘ä»¬ä¼šåœ¨ä¸‹æ–‡çš„ä¾‹å­ä¸­å°è¯•ä½¿ç”¨ GloVeã€‚</p><h3 id="ä»åŸå§‹æ–‡æœ¬åˆ°è¯åµŒå…¥"><a href="#ä»åŸå§‹æ–‡æœ¬åˆ°è¯åµŒå…¥" class="headerlink" title="ä»åŸå§‹æ–‡æœ¬åˆ°è¯åµŒå…¥"></a>ä»åŸå§‹æ–‡æœ¬åˆ°è¯åµŒå…¥</h3><p>æˆ‘ä»¬å°è¯•ä»åŸå§‹çš„ IMDB æ•°æ®ï¼ˆå°±æ˜¯ä¸€å¤§å †æ–‡æœ¬å•¦ï¼‰å¼€å§‹ï¼Œå¤„ç†æ•°æ®ï¼Œåšè¯åµŒå…¥ã€‚</p><h4 id="ä¸‹è½½-IMDB-æ•°æ®çš„åŸå§‹æ–‡æœ¬"><a href="#ä¸‹è½½-IMDB-æ•°æ®çš„åŸå§‹æ–‡æœ¬" class="headerlink" title="ä¸‹è½½ IMDB æ•°æ®çš„åŸå§‹æ–‡æœ¬"></a>ä¸‹è½½ IMDB æ•°æ®çš„åŸå§‹æ–‡æœ¬</h4><p>åŸå§‹çš„ IMDB æ•°æ®é›†å¯ä»¥ä» <a href="http://mng.bz/0tIo">http://mng.bz/0tIo</a> ä¸‹è½½ï¼ˆæœ€åæ˜¯è·³è½¬åˆ°ä»s3ä¸‹çš„ <a href="http://s3.amazonaws.com/text-datasets/aclImdb.zip">http://s3.amazonaws.com/text-datasets/aclImdb.zip</a> ï¼Œä¸ç§‘å­¦ä¸Šç½‘å¾ˆæ…¢å“¦ï¼‰ã€‚</p><p>ä¸‹è½½çš„æ•°æ®é›†è§£å‹åæ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">aclImdb</span><br><span class="line">â”œâ”€â”€ test</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ neg</span><br><span class="line">â”‚Â Â  â””â”€â”€ pos</span><br><span class="line">â””â”€â”€ train</span><br><span class="line">    â”œâ”€â”€ neg</span><br><span class="line">    â””â”€â”€ pos</span><br></pre></td></tr></table></figure><p>åœ¨æ¯ä¸ª neg/pos ç›®å½•ä¸‹é¢å°±æ˜¯ä¸€å¤§å † <code>.txt</code> æ–‡ä»¶äº†ï¼Œæ¯ä¸ªé‡Œé¢æ˜¯ä¸€æ¡è¯„è®ºã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°† train è¯„è®ºè½¬æ¢æˆå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²ä¸€æ¡è¯„è®ºï¼Œå¹¶æŠŠå¯¹åº”çš„æ ‡ç­¾(neg/pos)å†™åˆ° labels åˆ—è¡¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¤„ç† IMDB åŸå§‹æ•°æ®çš„æ ‡ç­¾</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">imdb_dir = <span class="string">&#x27;/Volumes/WD/Files/dataset/aclImdb&#x27;</span></span><br><span class="line">train_dir = os.path.join(imdb_dir, <span class="string">&#x27;train&#x27;</span>)</span><br><span class="line"></span><br><span class="line">texts = []</span><br><span class="line">labels = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> label_type <span class="keyword">in</span> [<span class="string">&#x27;neg&#x27;</span>, <span class="string">&#x27;pos&#x27;</span>]:</span><br><span class="line">    dir_name = os.path.join(train_dir, label_type)</span><br><span class="line">    <span class="keyword">for</span> fname <span class="keyword">in</span> os.listdir(dir_name):</span><br><span class="line">        <span class="keyword">if</span> fname.endswith(<span class="string">&#x27;.txt&#x27;</span>):</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(os.path.join(dir_name, fname)) <span class="keyword">as</span> f:</span><br><span class="line">                texts.append(f.read())</span><br><span class="line">            labels.append(<span class="number">0</span> <span class="keyword">if</span> label_type == <span class="string">&#x27;neg&#x27;</span> <span class="keyword">else</span> <span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(labels[<span class="number">0</span>], texts[<span class="number">0</span>], sep=<span class="string">&#x27; --&gt; &#x27;</span>)</span><br><span class="line">print(labels[-<span class="number">1</span>], texts[-<span class="number">1</span>], sep=<span class="string">&#x27; --&gt; &#x27;</span>)</span><br><span class="line">print(<span class="built_in">len</span>(texts), <span class="built_in">len</span>(labels))</span><br></pre></td></tr></table></figure><pre><code>0 --&gt; Working with one of the best Shakespeare sources, this film manages to be creditable to it&#39;s source, whilst still appealing to a wider audience.&lt;br /&gt;&lt;br /&gt;Branagh steals the film from under Fishburne&#39;s nose, and there&#39;s a talented cast on good form.1 --&gt; Enchanted April is a tone poem, an impressionist painting, a masterpiece of conveying a message with few words. It has been one of my 10 favorite films since it came out. I continue to wait, albeit less patiently, for the film to come out in DVD format. Apparently, I am not alone.&lt;br /&gt;&lt;br /&gt;If parent company Amazon&#39;s listings are correct, there are many people who want this title in DVD format. Many people want to go to Italy with this cast and this script. Many people want to keep a permanent copy of this film in their libraries. The cast is spectacular, the cinematography and direction impeccable. The film is a definite keeper. Many have already asked. Please add our names to the list.25000 25000</code></pre><h4 id="å¯¹æ•°æ®è¿›è¡Œåˆ†è¯"><a href="#å¯¹æ•°æ®è¿›è¡Œåˆ†è¯" class="headerlink" title="å¯¹æ•°æ®è¿›è¡Œåˆ†è¯"></a>å¯¹æ•°æ®è¿›è¡Œåˆ†è¯</h4><p>ç°åœ¨æ¥åˆ†è¯ï¼Œé¡ºä¾¿åˆ’åˆ†ä¸€ä¸‹è®­ç»ƒé›†å’ŒéªŒè¯é›†ã€‚ä¸ºäº†ä½“éªŒé¢„è®­ç»ƒè¯åµŒå…¥ï¼Œæˆ‘ä»¬å†æŠŠè®­ç»ƒé›†æå°ä¸€ç‚¹ï¼Œåªç•™200æ¡æ•°æ®ç”¨æ¥è®­ç»ƒã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¹ IMDB åŸå§‹æ•°æ®çš„æ–‡æœ¬è¿›è¡Œåˆ†è¯</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.preprocessing.text <span class="keyword">import</span> Tokenizer</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.preprocessing.sequence <span class="keyword">import</span> pad_sequences</span><br><span class="line"></span><br><span class="line">maxlen = <span class="number">100</span>  <span class="comment"># åªçœ‹æ¯æ¡è¯„è®ºçš„å‰100ä¸ªè¯</span></span><br><span class="line">training_samples = <span class="number">200</span></span><br><span class="line">validation_samples = <span class="number">10000</span></span><br><span class="line">max_words = <span class="number">10000</span></span><br><span class="line"></span><br><span class="line">tokenizer = Tokenizer(num_words=max_words)</span><br><span class="line">tokenizer.fit_on_texts(texts)</span><br><span class="line">sequences = tokenizer.texts_to_sequences(texts)</span><br><span class="line">word_index = tokenizer.word_index</span><br><span class="line">print(<span class="string">f&#x27;Found <span class="subst">&#123;<span class="built_in">len</span>(word_index)&#125;</span> unique tokens.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">data = pad_sequences(sequences, maxlen=maxlen)</span><br><span class="line"></span><br><span class="line">labels = np.asarray(labels)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;Shape of data tensor:&#x27;</span>, data.shape)</span><br><span class="line">print(<span class="string">&#x27;Shape of label tensor:&#x27;</span>, labels.shape)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“ä¹±æ•°æ®</span></span><br><span class="line">indices = np.arange(labels.shape[<span class="number">0</span>])</span><br><span class="line">np.random.shuffle(indices)</span><br><span class="line">data = data[indices]</span><br><span class="line">labels = labels[indices]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ’åˆ†è®­ç»ƒã€éªŒè¯é›†</span></span><br><span class="line">x_train = data[:training_samples]</span><br><span class="line">y_train = labels[:training_samples]</span><br><span class="line">x_val = data[training_samples: training_samples + validation_samples]</span><br><span class="line">y_val = labels[training_samples: training_samples + validation_samples]</span><br></pre></td></tr></table></figure><pre><code>Found 88582 unique tokens.Shape of data tensor: (25000, 100)Shape of label tensor: (25000,)</code></pre><h4 id="ä¸‹è½½-GloVe-è¯åµŒå…¥"><a href="#ä¸‹è½½-GloVe-è¯åµŒå…¥" class="headerlink" title="ä¸‹è½½ GloVe è¯åµŒå…¥"></a>ä¸‹è½½ GloVe è¯åµŒå…¥</h4><p>ä¸‹è½½é¢„è®­ç»ƒå¥½çš„ GloVe è¯åµŒå…¥ï¼š <a href="http://nlp.stanford.edu/data/glove.6B.zip">http://nlp.stanford.edu/data/glove.6B.zip</a></p><p>å†™ä¸‹æ¥æŠŠå®ƒè§£å‹ï¼Œé‡Œé¢ç”¨çº¯æ–‡æœ¬ä¿å­˜äº†è®­ç»ƒå¥½çš„ 400000 ä¸ª tokens çš„ 100 ç»´è¯åµŒå…¥å‘é‡ã€‚</p><h4 id="å¯¹åµŒå…¥è¿›è¡Œé¢„å¤„ç†"><a href="#å¯¹åµŒå…¥è¿›è¡Œé¢„å¤„ç†" class="headerlink" title="å¯¹åµŒå…¥è¿›è¡Œé¢„å¤„ç†"></a>å¯¹åµŒå…¥è¿›è¡Œé¢„å¤„ç†</h4><p>è§£æè§£å‹åçš„æ–‡ä»¶ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">glove_dir = <span class="string">&#x27;/Volumes/WD/Files/glove.6B&#x27;</span></span><br><span class="line"></span><br><span class="line">embeddings_index = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(os.path.join(glove_dir, <span class="string">&#x27;glove.6B.100d.txt&#x27;</span>)) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        values = line.split()</span><br><span class="line">        word = values[<span class="number">0</span>]</span><br><span class="line">        coefs = np.asarray(values[<span class="number">1</span>:], dtype=<span class="string">&#x27;float32&#x27;</span>)</span><br><span class="line">        embeddings_index[word] = coefs</span><br><span class="line"></span><br><span class="line">print(<span class="string">f&#x27;Found <span class="subst">&#123;<span class="built_in">len</span>(embeddings_index)&#125;</span> word vectors.&#x27;</span>)</span><br></pre></td></tr></table></figure><pre><code>Found 400000 word vectors.</code></pre><p>ç„¶åï¼Œæˆ‘ä»¬è¦æ„å»ºä¸€ä¸ªå¯ä»¥åŠ è½½è¿› Embedding å±‚çš„åµŒå…¥çŸ©é˜µï¼Œå…¶å½¢çŠ¶ä¸º <code>(max_words, embedding_dim)</code>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">embedding_dim = <span class="number">100</span></span><br><span class="line"></span><br><span class="line">embedding_matrix = np.zeros((max_words, embedding_dim))</span><br><span class="line"><span class="keyword">for</span> word, i <span class="keyword">in</span> word_index.items():</span><br><span class="line">    <span class="keyword">if</span> i &lt; max_words:</span><br><span class="line">        embedding_vector = embeddings_index.get(word)  <span class="comment"># æœ‰çš„å°±ç”¨ embeddings_index é‡Œçš„è¯å‘é‡</span></span><br><span class="line">        <span class="keyword">if</span> embedding_vector <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:               <span class="comment"># æ²¡æœ‰å°±ç”¨å…¨é›¶</span></span><br><span class="line">            embedding_matrix[i] = embedding_vector</span><br><span class="line">            </span><br><span class="line">print(embedding_matrix)</span><br></pre></td></tr></table></figure><pre><code>[[ 0.          0.          0.         ...  0.          0.   0.        ] [-0.038194   -0.24487001  0.72812003 ... -0.1459      0.82779998   0.27061999] [-0.071953    0.23127     0.023731   ... -0.71894997  0.86894   0.19539   ] ... [-0.44036001  0.31821999  0.10778    ... -1.29849994  0.11824   0.64845002] [ 0.          0.          0.         ...  0.          0.   0.        ] [-0.54539001 -0.31817999 -0.016281   ... -0.44865     0.067047   0.17975999]]</code></pre><h4 id="å®šä¹‰æ¨¡å‹"><a href="#å®šä¹‰æ¨¡å‹" class="headerlink" title="å®šä¹‰æ¨¡å‹"></a>å®šä¹‰æ¨¡å‹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> Embedding, Flatten, Dense</span><br><span class="line"></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(Embedding(max_words, embedding_dim, input_length=maxlen))</span><br><span class="line">model.add(Flatten())</span><br><span class="line">model.add(Dense(<span class="number">32</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>))</span><br><span class="line"></span><br><span class="line">model.summary()</span><br></pre></td></tr></table></figure><pre><code>Model: &quot;sequential_2&quot;_________________________________________________________________Layer (type)                 Output Shape              Param #   =================================================================embedding_3 (Embedding)      (None, 100, 100)          1000000   _________________________________________________________________flatten_2 (Flatten)          (None, 10000)             0         _________________________________________________________________dense_2 (Dense)              (None, 32)                320032    _________________________________________________________________dense_3 (Dense)              (None, 1)                 33        =================================================================Total params: 1,320,065Trainable params: 1,320,065Non-trainable params: 0_________________________________________________________________</code></pre><h4 id="æŠŠ-GloVe-è¯åµŒå…¥åŠ è½½è¿›æ¨¡å‹"><a href="#æŠŠ-GloVe-è¯åµŒå…¥åŠ è½½è¿›æ¨¡å‹" class="headerlink" title="æŠŠ GloVe è¯åµŒå…¥åŠ è½½è¿›æ¨¡å‹"></a>æŠŠ GloVe è¯åµŒå…¥åŠ è½½è¿›æ¨¡å‹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">model.layers[<span class="number">0</span>].set_weights([embedding_matrix])</span><br><span class="line">model.layers[<span class="number">0</span>].trainable = <span class="literal">False</span></span><br></pre></td></tr></table></figure><h4 id="è®­ç»ƒä¸è¯„ä¼°æ¨¡å‹"><a href="#è®­ç»ƒä¸è¯„ä¼°æ¨¡å‹" class="headerlink" title="è®­ç»ƒä¸è¯„ä¼°æ¨¡å‹"></a>è®­ç»ƒä¸è¯„ä¼°æ¨¡å‹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>,</span><br><span class="line">              loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>, </span><br><span class="line">              metrics=[<span class="string">&#x27;acc&#x27;</span>])</span><br><span class="line">history = model.fit(x_train, y_train, </span><br><span class="line">                    epochs=<span class="number">10</span>, </span><br><span class="line">                    batch_size=<span class="number">32</span>, </span><br><span class="line">                    validation_data=(x_val, y_val))</span><br><span class="line">model.save_weights(<span class="string">&#x27;pre_trained_glove_model.h5&#x27;</span>)</span><br></pre></td></tr></table></figure><pre><code>Epoch 1/107/7 [==============================] - 0s 64ms/step - loss: 1.3595 - acc: 0.5150 - val_loss: 0.6871 - val_acc: 0.5490Epoch 2/107/7 [==============================] - 0s 42ms/step - loss: 0.6846 - acc: 0.7950 - val_loss: 0.7569 - val_acc: 0.5217Epoch 3/107/7 [==============================] - 0s 42ms/step - loss: 0.3757 - acc: 0.8900 - val_loss: 0.8181 - val_acc: 0.5189Epoch 4/107/7 [==============================] - 0s 41ms/step - loss: 0.3464 - acc: 0.8800 - val_loss: 0.8497 - val_acc: 0.4971Epoch 5/107/7 [==============================] - 0s 41ms/step - loss: 0.2278 - acc: 0.9600 - val_loss: 0.8661 - val_acc: 0.5308Epoch 6/107/7 [==============================] - 0s 42ms/step - loss: 0.1328 - acc: 0.9950 - val_loss: 0.6977 - val_acc: 0.5895Epoch 7/107/7 [==============================] - 0s 42ms/step - loss: 0.1859 - acc: 0.9250 - val_loss: 0.6923 - val_acc: 0.5867Epoch 8/107/7 [==============================] - 0s 42ms/step - loss: 0.0950 - acc: 0.9950 - val_loss: 0.7609 - val_acc: 0.5609Epoch 9/107/7 [==============================] - 0s 50ms/step - loss: 0.0453 - acc: 1.0000 - val_loss: 0.7235 - val_acc: 0.5979Epoch 10/107/7 [==============================] - 0s 49ms/step - loss: 0.0398 - acc: 1.0000 - val_loss: 1.1416 - val_acc: 0.5063</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»˜åˆ¶ç»“æœ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">acc = history.history[<span class="string">&#x27;acc&#x27;</span>]</span><br><span class="line">val_acc = history.history[<span class="string">&#x27;val_acc&#x27;</span>]</span><br><span class="line">loss = history.history[<span class="string">&#x27;loss&#x27;</span>]</span><br><span class="line">val_loss = history.history[<span class="string">&#x27;val_loss&#x27;</span>]</span><br><span class="line"></span><br><span class="line">epochs = <span class="built_in">range</span>(<span class="built_in">len</span>(acc))</span><br><span class="line"></span><br><span class="line">plt.plot(epochs, acc, <span class="string">&#x27;bo-&#x27;</span>, label=<span class="string">&#x27;Training acc&#x27;</span>)</span><br><span class="line">plt.plot(epochs, val_acc, <span class="string">&#x27;rs-&#x27;</span>, label=<span class="string">&#x27;Validation acc&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation accuracy&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">plt.figure()</span><br><span class="line"></span><br><span class="line">plt.plot(epochs, loss, <span class="string">&#x27;bo-&#x27;</span>, label=<span class="string">&#x27;Training loss&#x27;</span>)</span><br><span class="line">plt.plot(epochs, val_loss, <span class="string">&#x27;rs-&#x27;</span>, label=<span class="string">&#x27;Validation loss&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation loss&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghmvtdmhl3j30af07cmxf.jpg" alt="png"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghmvtbyf9tj30af07cglv.jpg" alt="png"></p><p>åªç”¨ 200 ä¸ªè®­ç»ƒæ ·æœ¬è¿˜æ˜¯å¤ªéš¾äº†ï¼Œä½†ç”¨é¢„è®­ç»ƒè¯åµŒå…¥è¿˜æ˜¯å¾—åˆ°äº†ä¸é”™çš„æˆæœçš„ã€‚ä½œä¸ºå¯¹æ¯”ï¼Œçœ‹çœ‹å¦‚æœä¸ä½¿ç”¨é¢„è®­ç»ƒï¼Œä¼šæ˜¯ä»€ä¹ˆæ ·çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ„å»ºæ¨¡å‹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> Embedding, Flatten, Dense</span><br><span class="line"></span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(Embedding(max_words, embedding_dim, input_length=maxlen))</span><br><span class="line">model.add(Flatten())</span><br><span class="line">model.add(Dense(<span class="number">32</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>))</span><br><span class="line"></span><br><span class="line">model.summary()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ä½¿ç”¨ GloVe è¯åµŒå…¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®­ç»ƒ</span></span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>, </span><br><span class="line">              loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>, </span><br><span class="line">              metrics=[<span class="string">&#x27;acc&#x27;</span>])</span><br><span class="line">history = model.fit(x_train, y_train, </span><br><span class="line">                    epochs=<span class="number">10</span>, </span><br><span class="line">                    batch_size=<span class="number">32</span>, </span><br><span class="line">                    validation_data=(x_val, y_val))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»˜åˆ¶ç»“æœ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">acc = history.history[<span class="string">&#x27;acc&#x27;</span>]</span><br><span class="line">val_acc = history.history[<span class="string">&#x27;val_acc&#x27;</span>]</span><br><span class="line">loss = history.history[<span class="string">&#x27;loss&#x27;</span>]</span><br><span class="line">val_loss = history.history[<span class="string">&#x27;val_loss&#x27;</span>]</span><br><span class="line"></span><br><span class="line">epochs = <span class="built_in">range</span>(<span class="built_in">len</span>(acc))</span><br><span class="line"></span><br><span class="line">plt.plot(epochs, acc, <span class="string">&#x27;bo-&#x27;</span>, label=<span class="string">&#x27;Training acc&#x27;</span>)</span><br><span class="line">plt.plot(epochs, val_acc, <span class="string">&#x27;rs-&#x27;</span>, label=<span class="string">&#x27;Validation acc&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation accuracy&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">plt.figure()</span><br><span class="line"></span><br><span class="line">plt.plot(epochs, loss, <span class="string">&#x27;bo-&#x27;</span>, label=<span class="string">&#x27;Training loss&#x27;</span>)</span><br><span class="line">plt.plot(epochs, val_loss, <span class="string">&#x27;rs-&#x27;</span>, label=<span class="string">&#x27;Validation loss&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation loss&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><pre><code>Model: &quot;sequential_3&quot;_________________________________________________________________Layer (type)                 Output Shape              Param #   =================================================================embedding_4 (Embedding)      (None, 100, 100)          1000000   _________________________________________________________________flatten_3 (Flatten)          (None, 10000)             0         _________________________________________________________________dense_4 (Dense)              (None, 32)                320032    _________________________________________________________________dense_5 (Dense)              (None, 1)                 33        =================================================================Total params: 1,320,065Trainable params: 1,320,065Non-trainable params: 0_________________________________________________________________Epoch 1/107/7 [==============================] - 1s 72ms/step - loss: 0.6972 - acc: 0.4600 - val_loss: 0.6921 - val_acc: 0.5150Epoch 2/107/7 [==============================] - 0s 46ms/step - loss: 0.4991 - acc: 1.0000 - val_loss: 0.6901 - val_acc: 0.5347Epoch 3/107/7 [==============================] - 0s 46ms/step - loss: 0.2795 - acc: 1.0000 - val_loss: 0.6914 - val_acc: 0.5401Epoch 4/107/7 [==============================] - 0s 52ms/step - loss: 0.1171 - acc: 1.0000 - val_loss: 0.6977 - val_acc: 0.5389Epoch 5/107/7 [==============================] - 0s 45ms/step - loss: 0.0535 - acc: 1.0000 - val_loss: 0.7115 - val_acc: 0.5343Epoch 6/107/7 [==============================] - 0s 44ms/step - loss: 0.0271 - acc: 1.0000 - val_loss: 0.7133 - val_acc: 0.5348Epoch 7/107/7 [==============================] - 0s 44ms/step - loss: 0.0149 - acc: 1.0000 - val_loss: 0.7146 - val_acc: 0.5382Epoch 8/107/7 [==============================] - 0s 44ms/step - loss: 0.0087 - acc: 1.0000 - val_loss: 0.7192 - val_acc: 0.5410Epoch 9/107/7 [==============================] - 0s 44ms/step - loss: 0.0052 - acc: 1.0000 - val_loss: 0.7266 - val_acc: 0.5398Epoch 10/107/7 [==============================] - 0s 53ms/step - loss: 0.0032 - acc: 1.0000 - val_loss: 0.7378 - val_acc: 0.5380</code></pre><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghmvtd56u4j30af07c3yq.jpg" alt="png"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghmvtcoi15j30af07cdg2.jpg" alt="png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé¢„è®­ç»ƒè¯åµŒå…¥çš„æ€§èƒ½è¦ä¼˜äºä¸ä»»åŠ¡ä¸€èµ·å­¦ä¹ çš„è¯åµŒå…¥ã€‚ä½†å¦‚æœæœ‰å¤§é‡çš„å¯ç”¨æ•°æ®ï¼Œç”¨ä¸€ä¸ª Embedding å±‚å»ä¸ä»»åŠ¡ä¸€èµ·è®­ç»ƒï¼Œé€šå¸¸æ¯”ä½¿ç”¨é¢„è®­ç»ƒè¯åµŒå…¥æ›´åŠ å¼ºå¤§ã€‚</p><p>æœ€åï¼Œå†æ¥çœ‹ä¸€ä¸‹æµ‹è¯•é›†ä¸Šçš„ç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¹æµ‹è¯•é›†æ•°æ®è¿›è¡Œåˆ†è¯</span></span><br><span class="line"></span><br><span class="line">test_dir = os.path.join(imdb_dir, <span class="string">&#x27;test&#x27;</span>)</span><br><span class="line"></span><br><span class="line">texts = []</span><br><span class="line">labels = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> label_type <span class="keyword">in</span> [<span class="string">&#x27;neg&#x27;</span>, <span class="string">&#x27;pos&#x27;</span>]:</span><br><span class="line">    dir_name = os.path.join(test_dir, label_type)</span><br><span class="line">    <span class="keyword">for</span> fname <span class="keyword">in</span> <span class="built_in">sorted</span>(os.listdir(dir_name)):</span><br><span class="line">        <span class="keyword">if</span> fname.endswith(<span class="string">&#x27;.txt&#x27;</span>):</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(os.path.join(dir_name, fname)) <span class="keyword">as</span> f:</span><br><span class="line">                texts.append(f.read())</span><br><span class="line">            labels.append(<span class="number">0</span> <span class="keyword">if</span> label_type == <span class="string">&#x27;neg&#x27;</span> <span class="keyword">else</span> <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">sequences = tokenizer.texts_to_sequences(texts)</span><br><span class="line">x_test = pad_sequences(sequences, maxlen=maxlen)</span><br><span class="line">y_test = np.asarray(labels)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨æµ‹è¯•é›†ä¸Šè¯„ä¼°æ¨¡å‹</span></span><br><span class="line"></span><br><span class="line">model.load_weights(<span class="string">&#x27;pre_trained_glove_model.h5&#x27;</span>)</span><br><span class="line">model.evaluate(x_test, y_test)</span><br></pre></td></tr></table></figure><pre><code>782/782 [==============================] - 1s 983us/step - loss: 1.1397 - acc: 0.5127[1.1397335529327393, 0.512719988822937]</code></pre><p>emmmï¼Œæœ€åçš„è¿›åº¦æ˜¯ä»¤äººæƒŠè®¶çš„ 50%+ ï¼åªç”¨å¦‚æ­¤å°‘çš„æ•°æ®æ¥è®­ç»ƒè¿˜æ˜¯éš¾å•Šã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> Deep Learning with Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
            <tag> Deep Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonæ·±åº¦å­¦ä¹ ä¹‹è®¡ç®—æœºè§†è§‰</title>
      <link href="/2020/07/29/DeepLearningWithPython/Deep-Learning%20with-Python-ch5/"/>
      <url>/2020/07/29/DeepLearningWithPython/Deep-Learning%20with-Python-ch5/</url>
      
        <content type="html"><![CDATA[<h1 id="Deep-Learning-with-Python-for-computer-vision"><a href="#Deep-Learning-with-Python-for-computer-vision" class="headerlink" title="Deep Learning with Python for computer vision"></a>Deep Learning with Python for computer vision</h1><p>è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘å­¦ä¹ ã€ŠDeep Learning with Pythonã€‹(ç¬¬äºŒç‰ˆï¼ŒFranÃ§ois Chollet è‘—) æ—¶å†™çš„ç³»åˆ—ç¬”è®°ä¹‹ä¸€ã€‚æ–‡ç« çš„å†…å®¹æ˜¯ä»  Jupyter notebooks è½¬æˆ Markdown çš„ï¼Œä½ å¯ä»¥å» <a href="https://github.com/cdfmlr/Deep-Learning-with-Python-Notebooks">GitHub</a> æˆ– <a href="https://gitee.com/cdfmlr/Deep-Learning-with-Python-Notebooks">Gitee</a> æ‰¾åˆ°åŸå§‹çš„ <code>.ipynb</code> ç¬”è®°æœ¬ã€‚</p><p>ä½ å¯ä»¥å»<a href="https://livebook.manning.com/book/deep-learning-with-python">è¿™ä¸ªç½‘ç«™åœ¨çº¿é˜…è¯»è¿™æœ¬ä¹¦çš„æ­£ç‰ˆåŸæ–‡</a>(è‹±æ–‡)ã€‚è¿™æœ¬ä¹¦çš„ä½œè€…ä¹Ÿç»™å‡ºäº†é…å¥—çš„ <a href="https://github.com/fchollet/deep-learning-with-python-notebooks">Jupyter notebooks</a>ã€‚</p><p>æœ¬æ–‡ä¸º <strong>ç¬¬5ç«   æ·±åº¦å­¦ä¹ ç”¨äºè®¡ç®—æœºè§†è§‰</strong> (Chapter 5. <em>Deep learning for computer vision</em>) çš„ç¬”è®°æ•´åˆã€‚</p><p>[TOC]</p><h2 id="å·ç§¯ç¥ç»ç½‘ç»œç®€ä»‹"><a href="#å·ç§¯ç¥ç»ç½‘ç»œç®€ä»‹" class="headerlink" title="å·ç§¯ç¥ç»ç½‘ç»œç®€ä»‹"></a>å·ç§¯ç¥ç»ç½‘ç»œç®€ä»‹</h2><blockquote><p>5.1 Introduction to convnets</p></blockquote><p>å·ç§¯ç¥ç»ç½‘ç»œå¤„ç†è®¡ç®—æœºè§†è§‰é—®é¢˜å¾ˆå‰å®³å•¦ã€‚</p><p>é¦–å…ˆçœ‹ä¸€ä¸ªæœ€ç®€å•çš„å·ç§¯ç¥ç»ç½‘ç»œå¤„ç† MNIST å®Œçˆ†ç¬¬äºŒç« é‡Œçš„å…¨è¿æ¥ç½‘ç»œçš„ä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line">model = models.Sequential()</span><br><span class="line"></span><br><span class="line">model.add(layers.Conv2D(<span class="number">32</span>, (<span class="number">3</span>, <span class="number">3</span>), activation=<span class="string">&#x27;relu&#x27;</span>, input_shape=(<span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>)))</span><br><span class="line">model.add(layers.MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line">model.add(layers.Conv2D(<span class="number">64</span>, (<span class="number">3</span>, <span class="number">3</span>), activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line">model.add(layers.Conv2D(<span class="number">64</span>, (<span class="number">3</span>, <span class="number">3</span>), activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line"></span><br><span class="line">model.add(layers.Flatten())</span><br><span class="line">model.add(layers.Dense(<span class="number">64</span>, activation=<span class="string">&quot;relu&quot;</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">10</span>, activation=<span class="string">&quot;softmax&quot;</span>))</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬ç”¨çš„ Conv2D å±‚è¦çš„ <code>input_shape</code> æ˜¯ <code>(image_height, image_width, image_channels)</code> è¿™ç§æ ¼å¼çš„ã€‚</p><p>Conv2D å’Œ MaxPooling2D å±‚çš„è¾“å‡ºéƒ½æ˜¯ 3D å¼ é‡ <code>(height, width, channels)</code>ï¼Œ height å’Œ width ä¼šé€å±‚å‡å°ï¼Œchannels æ˜¯ç”± Conv2D çš„ç¬¬ä¸€ä¸ªå‚æ•°æ§åˆ¶çš„ã€‚</p><p>æœ€åçš„ä¸‰å±‚é‡Œï¼Œæˆ‘ä»¬æ˜¯æŠŠæœ€åä¸€ä¸ª Conv2D å±‚çš„ <code>(3, 3, 64)</code> çš„å¼ é‡ç”¨ä¸€ç³»åˆ—å…¨è¿æ¥å±‚å˜æˆæƒ³è¦çš„ç»“æœå‘é‡ï¼šFlatten å±‚æ˜¯ç”¨æ¥æŠŠæˆ‘ä»¬çš„ 3D å¼ é‡å±•å¹³(flattenï¼Œå…¶å®æˆ‘æƒ³å†™æˆâ€œå‹â€ã€â€œé™â€ä¹‹ç±»çš„ï¼Œè¿™æ‰æ˜¯flattençš„æœ¬æ„ï¼Œä½†æ ‡å‡†çš„ä¸­æ–‡ç¿»è¯‘æ˜¯å±•å¹³)åˆ° 1D çš„ã€‚ ç„¶ååé¢çš„ä¸¤ä¸ª Dense å±‚å°±è¡Œæˆ‘ä»¬åœ¨ç¬¬äºŒç« åšçš„é‚£ç§ï¼Œæœ€åå¾—åˆ°ä¸€ä¸ª 10 è·¯çš„åˆ†ç±»ã€‚</p><p>æœ€åï¼Œçœ‹ä¸€ä¸‹æ¨¡å‹ç»“æ„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.summary()</span><br></pre></td></tr></table></figure><pre><code>Model: &quot;sequential_1&quot;_________________________________________________________________Layer (type)                 Output Shape              Param #   =================================================================conv2d_3 (Conv2D)            (None, 26, 26, 32)        320       _________________________________________________________________max_pooling2d_2 (MaxPooling2 (None, 13, 13, 32)        0         _________________________________________________________________conv2d_4 (Conv2D)            (None, 11, 11, 64)        18496     _________________________________________________________________max_pooling2d_3 (MaxPooling2 (None, 5, 5, 64)          0         _________________________________________________________________conv2d_5 (Conv2D)            (None, 3, 3, 64)          36928     _________________________________________________________________flatten_1 (Flatten)          (None, 576)               0         _________________________________________________________________dense_2 (Dense)              (None, 64)                36928     _________________________________________________________________dense_3 (Dense)              (None, 10)                650       =================================================================Total params: 93,322Trainable params: 93,322Non-trainable params: 0_________________________________________________________________</code></pre><p>å¥½äº†ï¼Œç½‘ç»œå°±å»ºæˆè¿™æ ·äº†ï¼Œè¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œæ¥ä¸‹æ¥å°±è®­ç»ƒå®ƒäº†ï¼Œå¤§è‡´å’Œä¹‹å‰ç¬¬äºŒç« é‡Œçš„æ˜¯ä¸€æ ·çš„ï¼ˆä½†æ³¨æ„reshapeçš„å½¢çŠ¶ä¸ä¸€æ ·ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Load the TensorBoard notebook extension</span></span><br><span class="line"><span class="comment"># TensorBoard å¯ä»¥å¯è§†åŒ–è®­ç»ƒè¿‡ç¨‹</span></span><br><span class="line">%load_ext tensorboard</span><br><span class="line"><span class="comment"># Clear any logs from previous runs</span></span><br><span class="line">!rm -rf ./logs/ </span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨ MNIST å›¾åƒä¸Šè®­ç»ƒå·ç§¯ç¥ç»ç½‘ç»œ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.datasets <span class="keyword">import</span> mnist</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.utils <span class="keyword">import</span> to_categorical</span><br><span class="line"></span><br><span class="line">(train_images, train_labels), (test_images, test_labels) = mnist.load_data()</span><br><span class="line"></span><br><span class="line">train_images = train_images.reshape((<span class="number">60000</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>))</span><br><span class="line">train_images = train_images.astype(<span class="string">&#x27;float32&#x27;</span>) / <span class="number">255</span></span><br><span class="line"></span><br><span class="line">test_images = test_images.reshape((<span class="number">10000</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>))</span><br><span class="line">test_images = test_images.astype(<span class="string">&#x27;float32&#x27;</span>) / <span class="number">255</span></span><br><span class="line"></span><br><span class="line">train_labels = to_categorical(train_labels)</span><br><span class="line">test_labels = to_categorical(test_labels)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡†å¤‡ TensorBoard</span></span><br><span class="line">log_dir = <span class="string">&quot;logs/fit/&quot;</span> + datetime.datetime.now().strftime(<span class="string">&quot;%Y%m%d-%H%M%S&quot;</span>)</span><br><span class="line">tensorboard_callback = tf.keras.callbacks.TensorBoard(log_dir=log_dir, histogram_freq=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>,</span><br><span class="line">              loss=<span class="string">&quot;categorical_crossentropy&quot;</span>,</span><br><span class="line">              metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br><span class="line">model.fit(train_images, train_labels, epochs=<span class="number">5</span>, batch_size=<span class="number">64</span>,</span><br><span class="line">          callbacks=[tensorboard_callback])</span><br></pre></td></tr></table></figure><pre><code>Train on 60000 samplesEpoch 1/560000/60000 [==============================] - 36s 599us/sample - loss: 0.0156 - accuracy: 0.9953Epoch 2/560000/60000 [==============================] - 33s 554us/sample - loss: 0.0127 - accuracy: 0.9960Epoch 3/560000/60000 [==============================] - 31s 524us/sample - loss: 0.0097 - accuracy: 0.9971Epoch 4/560000/60000 [==============================] - 32s 529us/sample - loss: 0.0092 - accuracy: 0.9974Epoch 5/560000/60000 [==============================] - 31s 523us/sample - loss: 0.0095 - accuracy: 0.9971&lt;tensorflow.python.keras.callbacks.History at 0x1441fa9d0&gt;</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%tensorboard --logdir logs/fit</span><br></pre></td></tr></table></figure><p>(è¿™ç†ä¼šè¾“å‡º tensorboard æ˜¾ç¤ºçš„å¯è§†åŒ–æ¨¡å‹è®­ç»ƒæƒ…å†µ)</p><iframe id="tensorboard-frame-f4ae12888a3a411e" width="100%" height="800" frameborder="0"></iframe><script>  (function() {    const frame = document.getElementById("tensorboard-frame-f4ae12888a3a411e");    const url = new URL("/", window.location);    url.port = 6006;    frame.src = url;  })();</script><p>æ¥åœ¨æµ‹è¯•é›†çœ‹ä¸€ä¸‹ç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">test_loss, test_acc = model.evaluate(test_images, test_labels, verbose=<span class="number">2</span>)</span><br><span class="line">print(test_loss, test_acc)</span><br></pre></td></tr></table></figure><pre><code>10000/1 - 1s - loss: 0.0172 - accuracy: 0.99260.03441549262946125 0.9926</code></pre><h3 id="å·ç§¯"><a href="#å·ç§¯" class="headerlink" title="å·ç§¯"></a>å·ç§¯</h3><h4 id="å·ç§¯ç¥ç»ç½‘ç»œ"><a href="#å·ç§¯ç¥ç»ç½‘ç»œ" class="headerlink" title="å·ç§¯ç¥ç»ç½‘ç»œ"></a>å·ç§¯ç¥ç»ç½‘ç»œ</h4><p>æˆ‘ä»¬ä¹‹å‰ç”¨çš„<em>å¯†é›†è¿æ¥å±‚</em>æ˜¯åœ¨æ•´ä¸ªè¾“å…¥ç‰¹å¾ç©ºé—´ï¼ˆåœ¨ MNIST ä¸­å°±æ˜¯æ‰€æœ‰çš„åƒç´ ï¼‰ä¸­å­¦ä¹ å…¨å±€æ¨¡å¼çš„ï¼›è€Œè¿™é‡Œçš„å·ç§¯å±‚æ˜¯å­¦ä¹ å±€éƒ¨æ¨¡å¼çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒDense æ˜¯å­¦æ•´ä¸ªå›¾åƒçš„ï¼Œè€Œ Conv æ˜¯å­¦å›¾åƒçš„å±€éƒ¨ï¼Œæ¯”å¦‚åœ¨æˆ‘ä»¬åˆšæ‰å†™çš„ä»£ç é‡Œæ˜¯å­¦äº† 3x3 çš„çª—å£ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggo1xjvr02j315g0o6n12.jpg" alt="å·ç§¯å±‚å­¦ä¹ å±€éƒ¨æ¨¡å¼"></p><p>è¿™ç§å·ç§¯ç¥ç»ç½‘ç»œå…·æœ‰ä¸¤ä¸ªæ€§è´¨ï¼š</p><ul><li><p>å·ç§¯ç¥ç»ç½‘ç»œå­¦åˆ°çš„æ¨¡å¼æ˜¯å¹³ç§»ä¸å˜çš„(translation invariant)ï¼šå·ç§¯ç¥ç»ç½‘ç»œå­¦ä¹ åˆ°æŸä¸ªæ¨¡å¼ä¹‹åï¼Œåœ¨å…¶ä»–åœ°æ–¹åˆçœ‹åˆ°äº†è¿™ä¸ªä¸€æ ·çš„æ¨¡å¼ï¼Œå®ƒå°±ä¼šè®¤å‡ºå®ƒå·²ç»å­¦è¿‡è¿™ä¸ªäº†ï¼Œä¸ç”¨å†å»å­¦ä¸€æ¬¡äº†ã€‚è€Œå¯¹äº Dense çš„ç½‘ç»œï¼Œå³ä½¿é‡åˆ°æœ‰ä¸€æ ·çš„å±€éƒ¨éƒ¨åˆ†ä¾ç„¶è¦å»é‡æ–°å­¦ä¹ ä¸€æ¬¡ã€‚è¿™ä¸ªæ€§è´¨è®©å·ç§¯ç¥ç»ç½‘ç»œå¯ä»¥é«˜æ•ˆåˆ©ç”¨æ•°æ®ï¼Œå®ƒåªéœ€è¦æ›´å°‘çš„è®­ç»ƒæ ·æœ¬å°±å¯ä»¥å­¦åˆ°æ³›åŒ–æ¯”è¾ƒå¥½çš„æ•°æ®è¡¨ç¤ºï¼ˆä¸€ä¸ªä¸ªå±€éƒ¨éƒ½è®°ä½äº†å˜›ï¼Œè€Œä¸æ˜¯é æ•´ä½“å»æ˜ å°„ï¼‰ã€‚</p></li><li><p>å·ç§¯ç¥ç»ç½‘ç»œå¯ä»¥å­¦åˆ°æ¨¡å¼çš„ç©ºé—´å±‚æ¬¡ç»“æ„(spatial hierarchies of patterns)ï¼šå·ç§¯ç¥ç»ç½‘ç»œåœ¨ç¬¬ä¸€å±‚å­¦å®Œäº†ä¸€ä¸ªä¸€ä¸ªå°çš„å±€éƒ¨æ¨¡å¼ä¹‹åï¼Œä¸‹ä¸€å±‚åˆå¯ä»¥ç”¨è¿™äº›å°å±€éƒ¨æ‹¼å‡ºå¤§ä¸€äº›çš„æ¨¡å¼ã€‚ç„¶åè¿™æ ·å¤šæå‡ å±‚ï¼Œå·ç§¯ç¥ç»ç½‘ç»œå°±å¯ä»¥å­¦åˆ°è¶Šæ¥è¶Šå¤æ‚ã€è¶Šæ¥è¶ŠæŠ½è±¡çš„è§†è§‰æ¦‚å¿µäº†ï¼Œå°±æ˜¯ä¸‹é¢å›¾ç‰‡è¿™ä¸ªæ„æ€ï¼š</p></li></ul><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggo29tuqchj30zh0u0dn6.jpg" alt="å·ç§¯ç¥ç»ç½‘ç»œå¯ä»¥å­¦åˆ°æ¨¡å¼çš„ç©ºé—´å±‚æ¬¡ç»“æ„"></p><h4 id="å·ç§¯å±‚"><a href="#å·ç§¯å±‚" class="headerlink" title="å·ç§¯å±‚"></a>å·ç§¯å±‚</h4><p>æˆ‘ä»¬åˆšæ‰ä¾‹å­ä¸­ç”¨æ¥è¡¨ç¤ºå›¾ç‰‡çš„é‚£ç§ 3D å¼ é‡ï¼ŒåŒ…æ‹¬ä¸¤ä¸ªç©ºé—´è½´ heightã€width å’Œä¸€ä¸ªæ·±åº¦è½´ depthï¼ˆä¹Ÿå« channels è½´ï¼‰ï¼Œå¯¹äº RGB å›¾ç‰‡ï¼Œæ·±åº¦è½´çš„ç»´åº¦å°±æ˜¯3ï¼Œåˆ†åˆ«è¡¨ç¤º3ç§é¢œè‰²å˜›ï¼›è€Œå¯¹äº MNIST è¿™ç§ç°åº¦å›¾ç‰‡ï¼Œæ·±åº¦å°±æ˜¯1ï¼Œåªç”¨ä¸€ä¸ªæ•°å»è¡¨ç¤ºç°åº¦å€¼ã€‚åœ¨è¿™ç§3Då¼ é‡å’Œåœ¨ä¸Šé¢åšçš„å·ç§¯è¿ç®—çš„ç»“æœè¢«ç§°ä½œ <em>feature map</em>ï¼ˆç‰¹å¾å›¾ï¼‰ã€‚</p><p>å·ç§¯è¿ç®—ä¼šä»è¾“å…¥ç‰¹å¾å›¾ä¸­æå–å‡ºä¸€ä¸ªä¸ªå°åˆ†å—ï¼Œå¹¶å¯¹æ‰€æœ‰è¿™äº›åˆ†å—æ–½åŠ ä¸€ä¸ªç›¸åŒçš„å˜æ¢ï¼Œå¾—åˆ°è¾“å‡ºç‰¹å¾å›¾ã€‚è¾“å‡ºç‰¹å¾å›¾ä»æ˜¯ä¸€ä¸ª 3D å¼ é‡ï¼šå…·æœ‰å®½åº¦å’Œé«˜åº¦ï¼Œå…¶æ·±åº¦å¯èƒ½æ˜¯ä»»æ„å€¼ï¼Œæ·±åº¦çš„å¤§å°æ˜¯è¯¥å±‚çš„ä¸€ä¸ªå‚æ•°ï¼Œæ·±åº¦è½´é‡Œçš„æ¯ä¸ª channel éƒ½ä»£è¡¨ä¸€ä¸ª filter (è¿‡æ»¤å™¨)ã€‚filter ä¼šå¯¹è¾“å…¥æ•°æ®çš„æŸä¸€æ–¹é¢è¿›è¡Œç¼–ç ï¼Œæ¯”å¦‚ï¼ŒæŸä¸ªè¿‡æ»¤å™¨å¯ä»¥ç¼–ç â€œè¾“å…¥ä¸­åŒ…å«ä¸€å¼ è„¸â€è¿™ç§æ¦‚å¿µã€‚</p><p>åœ¨åˆšæ‰çš„ MNIST ä¾‹å­ä¸­ï¼Œç¬¬ä¸€ä¸ªå·ç§¯å±‚æ¥å—å°ºå¯¸ä¸º <code>(28, 28, 1)</code> çš„è¾“å…¥ç‰¹å¾å›¾ï¼Œè¾“å‡ºä¸€ä¸ªå°ºå¯¸ä¸º <code>(26, 26, 32)</code> çš„ç‰¹å¾å›¾ã€‚è¿™ä¸ªè¾“å‡ºä¸­åŒ…å« 32 ä¸ª filterï¼Œåœ¨æ¯ä¸ªæ·±åº¦è½´ä¸­çš„ channel éƒ½åŒ…å«æœ‰ 26x26 çš„å€¼ï¼Œå«åš filter å¯¹è¾“å…¥çš„å“åº”å›¾(response map)ï¼Œè¡¨ç¤º filter åœ¨è¾“å…¥ä¸­ä¸åŒä½ç½®ä¸Šçš„è¿ç®—ç»“æœã€‚è¿™ä¹Ÿå°±æ˜¯ç‰¹å¾å›¾ä¸ºä»€ä¹ˆå«ç‰¹å¾å›¾çš„åŸå› äº†ï¼šæ·±åº¦è½´çš„æ¯ä¸ªç»´åº¦éƒ½æ˜¯ä¸€ä¸ªç‰¹å¾(æˆ–è¿‡æ»¤å™¨)ï¼Œè€Œ 2D å¼ é‡ <code>output[:, :, n]</code> æ˜¯è¿™ä¸ªè¿‡æ»¤å™¨åœ¨è¾“å…¥ä¸Šçš„å“åº”çš„äºŒç»´ç©ºé—´å›¾ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggo5m7eb85j31jy0jgagx.jpg" alt="å“åº”å›¾çš„ç¤ºæ„å›¾"></p><h4 id="å·ç§¯è¿ç®—"><a href="#å·ç§¯è¿ç®—" class="headerlink" title="å·ç§¯è¿ç®—"></a>å·ç§¯è¿ç®—</h4><p>å…³äºå·ç§¯ï¼Œï¼Œemmmï¼Œå¤å˜æ²¡æ€ä¹ˆå¬æ‡‚ï¼Œæˆ‘ä¸»è¦æ˜¯çœ‹<a href="https://www.zhihu.com/question/22298352">ã€ŒçŸ¥ä¹: å¦‚ä½•é€šä¿—æ˜“æ‡‚åœ°è§£é‡Šå·ç§¯?ã€</a>æ¥ç†è§£çš„ã€‚è¿™é‡Œæˆ‘ä»¬ä¸»è¦ç”¨çš„æ˜¯è¿™ç§ä½œç”¨ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggo6h1a5wfg30f30f4n2g.gif" alt="å·ç§¯"></p><p>Keras çš„ Conv2D å±‚åˆå§‹åŒ–å†™æˆï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Conv2D(output_depth, (window_height, window_width))</span><br></pre></td></tr></table></figure><p>å…¶ä¸­åŒ…å«äº†å·ç§¯è¿ç®—æœ‰ä¸¤ä¸ªæ ¸å¿ƒå‚æ•°ï¼š</p><ul><li>è¾“å‡ºç‰¹å¾å›¾çš„æ·±åº¦ï¼šåœ¨æˆ‘ä»¬åˆšæ‰çš„ MNIST ä¾‹å­é‡Œç”¨äº† 32 å’Œ 64ï¼›</li><li>ä»è¾“å…¥ä¸­æå–çš„æ¯ä¸ªå—ï¼ˆæ»‘çª—ï¼‰çš„å°ºå¯¸ï¼šä¸€èˆ¬æ˜¯ 3x3 æˆ–è€… 5x5ï¼›</li></ul><p>å·ç§¯è¿ç®—ä¼šåƒæ»‘åŠ¨çª—å£ä¸€æ ·çš„éå†æ‰€æœ‰å¯èƒ½çš„ä½ç½®ï¼ŒæŠŠè¾“å…¥ä¸­æ¯ä¸€å°å—çš„ç‰¹å¾ <code>(window_height, window_width, input_depth)</code> é€šè¿‡ä¸ä¸€ä¸ªç§°ä½œå·ç§¯æ ¸(convolution kernel)çš„è¦å­¦ä¹ çš„æƒé‡çŸ©é˜µåšç‚¹ä¹˜ï¼Œå˜åŒ–å¾—åˆ°ä¸€ä¸ªå‘é‡ <code>(output_depth, )</code>ã€‚æ‰€æœ‰çš„è¿™ç§ç»“æœå‘é‡æ‹¼åœ¨ä¸€èµ·å°±å¾—åˆ°äº†ä¸€ä¸ª 3D çš„æœ€ç»ˆè¾“å‡º <code>(height, width, output_depth)</code>ï¼Œå…¶ä¸­çš„æ¯ä¸ªå€¼å°±æ˜¯è¾“å…¥å¯¹åº”è¿‡æ¥çš„ï¼Œæ¯”å¦‚å– 3x3 çš„æ»‘çª—ï¼Œåˆ™ <code>output[i, j, :]</code> æ¥è‡ª <code>input[i-1:i+1, j-1:j+1, :]</code>ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggo6cg398tj30t40w8n2u.jpg" alt="å·ç§¯çš„å·¥ä½œåŸç†"></p><p>å…³äºå·ç§¯å’Œ CNN å¯ä»¥å»çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://mlnotebook.github.io/post/CNN1/">Convolutional Neural Networks - Basics, An Introduction to CNNs and Deep Learning</a></p><p>æ³¨æ„ï¼Œå› ä¸ºè¾¹ç•Œæ•ˆåº”(border effects)å’Œä½¿ç”¨äº†æ­¥å¹…(strides)ï¼Œæˆ‘ä»¬è¾“å‡ºçš„å®½åº¦å’Œé«˜åº¦å¯èƒ½ä¸è¾“å…¥çš„å®½åº¦å’Œé«˜åº¦ä¸åŒã€‚</p><h5 id="è¾¹ç•Œæ•ˆåº”å’Œå¡«å……"><a href="#è¾¹ç•Œæ•ˆåº”å’Œå¡«å……" class="headerlink" title="è¾¹ç•Œæ•ˆåº”å’Œå¡«å……"></a>è¾¹ç•Œæ•ˆåº”å’Œå¡«å……</h5><p>è¾¹ç•Œæ•ˆåº”å°±æ˜¯ä½ åœ¨åšæ»‘çª—ä¹‹åå¾—åˆ°çš„çŸ©é˜µå¤§å°ä¼šç¼©å°ä¸€åœˆï¼ˆè¾¹ç•Œæ²¡äº†ï¼‰ã€‚ä¾‹å¦‚ç°è¾“å…¥ä¸€ä¸ª 5x5 çš„å›¾ç‰‡ï¼Œå– 3x3 çš„å°å—åªèƒ½å–å‡º 9 å—æ¥ï¼Œå› æ­¤è¾“å‡ºçš„ç»“æœä¸º 3x3 çš„ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggo9oanxxcj31h60rc76w.jpg" alt="è¾¹ç•Œæ•ˆåº”"></p><p>ä¹‹å‰æˆ‘ä»¬åšçš„ MNIST ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä¸€å¼€å§‹è¾“å…¥ 28x28ï¼Œç¬¬ä¸€å±‚å– 3x3 çš„ï¼Œç»“æœå°±æ˜¯ 26x26 äº†ã€‚</p><p>å¦‚æœä¸å¸Œæœ›è¿™ç§å‡å°å‘ç”Ÿï¼Œå³å¸Œæœ›ä¿æŒè¾“å‡ºçš„ç©ºé—´ç»´åº¦ä¸è¾“å…¥çš„ä¸€è‡´ï¼Œåˆ™éœ€è¦åšå¡«å……(padding)ã€‚å¡«å……å°±æ˜¯åœ¨è¾“å…¥çš„å›¾ç‰‡è¾¹ç•Œä¸ŠåŠ ä¸€äº›è¡Œå’Œåˆ—ï¼Œ3x3 åŠ 1åœˆï¼Œ5x5 è¦åŠ 2åœˆï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggo9vytgefj31fa0kote4.jpg" alt="å¡«å……"></p><p>Keras çš„ Conv2D å±‚é‡Œå¯ä»¥ç”¨ <code>padding</code> å‚æ•°æ¥è®¾ç½®ä½¿ç”¨å¡«å……ã€‚<code>padding</code> å¯ä»¥è®¾ä¸ºï¼š</p><ul><li><code>&quot;valid&quot;</code>ï¼ˆé»˜è®¤å€¼ï¼‰ï¼šä¸åšå¡«å……ï¼Œåªå–â€œæœ‰æ•ˆâ€çš„å—ã€‚ä¾‹å¦‚åœ¨ 5Ã—5 çš„è¾“å…¥ç‰¹å¾å›¾ä¸­ï¼Œå¯ä»¥æå– 3Ã—3 å›¾å—çš„æœ‰æ•ˆä½ç½®ï¼›</li><li><code>&quot;same&quot;</code>ï¼š åšå¡«å……ï¼Œä½¿è¾“å‡ºå’Œè¾“å…¥çš„ widthã€height ç›¸ç­‰ã€‚</li></ul><h5 id="å·ç§¯æ­¥å¹…"><a href="#å·ç§¯æ­¥å¹…" class="headerlink" title="å·ç§¯æ­¥å¹…"></a>å·ç§¯æ­¥å¹…</h5><p>å·ç§¯çš„æ­¥å¹…å°±æ˜¯ä¸€æ¬¡æ»‘çª—ç§»å¤šå°‘ï¼Œä¹‹å‰æˆ‘ä»¬ä¸€ç›´åšçš„éƒ½æ˜¯æ­¥å¹…ä¸º1çš„ã€‚æˆ‘ä»¬æŠŠæ­¥å¹…å¤§äº 1 çš„å·ç§¯å«åš<strong>æ­¥è¿›å·ç§¯</strong>(strided convolution)ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªæ˜¯æ­¥å¹…ä¸º 2 çš„ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggp4beuceuj31dw0pu76q.jpg" alt="æ­¥å¹…ä¸º 2 çš„æ­¥è¿›å·ç§¯"></p><p>ç„¶è€Œæ­¥è¿›å·ç§¯åœ¨å®é™…é‡Œé¢ç”¨çš„å¹¶ä¸å¤šğŸ˜‚ï¼Œè¦åšè¿™ç§å¯¹ç‰¹å¾å›¾çš„ä¸‹é‡‡æ ·ï¼ˆdownsampledï¼‰æˆ‘ä»¬ä¸€èˆ¬ç”¨æœ€å¤§æ± åŒ–ã€‚</p><blockquote><p>æ³¨ï¼š</p><p><strong>ä¸‹é‡‡æ ·</strong>ï¼šå¯¹äºä¸€ä¸ªæ ·å€¼åºåˆ—é—´éš”å‡ ä¸ªæ ·å€¼å–æ ·ä¸€æ¬¡ï¼Œè¿™æ ·å¾—åˆ°æ–°åºåˆ—å°±æ˜¯åŸåºåˆ—çš„ä¸‹é‡‡æ ·ã€‚</p><p>From <a href="https://baike.baidu.com/item/%E4%B8%8B%E9%87%87%E6%A0%B7">ç™¾åº¦ç™¾ç§‘</a></p></blockquote><h3 id="æœ€å¤§æ± åŒ–"><a href="#æœ€å¤§æ± åŒ–" class="headerlink" title="æœ€å¤§æ± åŒ–"></a>æœ€å¤§æ± åŒ–</h3><p>ä¸æ­¥è¿›å·ç§¯ç±»ä¼¼ï¼Œæœ€å¤§æ± åŒ–æ˜¯ç”¨æ¥å¯¹ç‰¹å¾å›¾è¿›è¡Œä¸‹é‡‡æ ·çš„ã€‚åœ¨ä¸€å¼€å§‹çš„ MNIST ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç”¨äº† MaxPooling2D å±‚ä¹‹åï¼Œç‰¹å¾å›¾çš„å°ºå¯¸å°±å‡åŠäº†ã€‚</p><p>æœ€å¤§æ± åŒ–æ˜¯åœ¨ä¸€ä¸ªçª—å£é‡Œï¼Œä»è¾“å…¥ç‰¹å¾å›¾å–å‡ºæ¯ä¸ª channel çš„æœ€å¤§å€¼ï¼Œç„¶åè¾“å‡ºå‡ºæ¥ã€‚è¿™ä¸ªè¿ç®—å’Œå·ç§¯å¾ˆç±»ä¼¼ï¼Œä¸è¿‡æ–½åŠ çš„å‡½æ•°æ˜¯ä¸€ä¸ª maxã€‚</p><p>æœ€å¤§æ± åŒ–æˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯ç”¨ 2x2 çš„çª—å£ï¼Œæ­¥å¹…ä¸º 2ï¼Œè¿™æ ·å–å¯ä»¥å°†ç‰¹å¾å›¾ä¸‹é‡‡æ ·2å€ã€‚ï¼ˆå·ç§¯æ˜¯ä¸€èˆ¬å–3x3çª—å£å’Œæ­¥å¹…1ï¼‰</p><p>å¦‚æœä¸ç”¨æœ€å¤§æ± åŒ–ï¼Œç›´æ¥æŠŠä¸€å¤§å †å·ç§¯å±‚å †èµ·æ¥ï¼Œä¼šæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li>ç‰¹å¾å›¾å°ºå¯¸ä¸‹é™çš„æ…¢ï¼Œæåˆ°åé¢å‚æ•°å¤ªå¤šäº†ï¼Œä¼šåŠ é‡è¿‡æ‹Ÿåˆï¼›</li><li>ä¸åˆ©äºç©ºé—´å±‚çº§ç»“æ„çš„å­¦ä¹ ï¼šä¸€ç›´ä¸€å°ç‚¹ä¸€å°ç‚¹çš„ç”¨å·ç§¯å±‚å»å­¦ï¼Œä¸åˆ©äºçœ‹åˆ°æ›´æŠ½è±¡çš„æ•´ä½“ã€‚</li></ul><p>é™¤äº†æœ€å¤§æ± åŒ–ï¼Œä¸‹é‡‡æ ·çš„æ–¹å¼è¿˜æœ‰å¾ˆå¤šï¼šæ¯”å¦‚æ­¥è¿›å·ç§¯ã€å¹³å‡æ± åŒ–ä¹‹ç±»çš„ã€‚ä½†ä¸€èˆ¬ç”¨æœ€å¤§æ± åŒ–æ•ˆæœæ¯”è¾ƒå¥½ï¼Œæˆ‘ä»¬è¦çš„æ˜¯çŸ¥é“æœ‰æ²¡æœ‰æŸä¸ªç‰¹å¾å˜›ï¼Œå¦‚æœç”¨å¹³å‡å»å°±æŠŠè¿™ä¸ªç‰¹å¾â€œå‡æ·¡â€äº†ï¼Œå¦‚æœç”¨æ­¥è¿›å·ç§¯åˆå¯èƒ½æŠŠè¿™ä¸ªä¿¡æ¯é”™è¿‡äº†ã€‚</p><p>æ€»è€Œè¨€ä¹‹ï¼Œä½¿ç”¨æœ€å¤§æ± åŒ–/å…¶ä»–ä¸‹é‡‡æ ·çš„åŸå› ï¼Œä¸€æ˜¯å‡å°‘éœ€è¦å¤„ç†çš„ç‰¹å¾å›¾çš„å…ƒç´ ä¸ªæ•°ï¼ŒäºŒæ˜¯é€šè¿‡è®©ä¸€ç³»åˆ—çš„å·ç§¯å±‚è§‚å¯Ÿåˆ°è¶Šæ¥è¶Šå¤§çš„çª—å£(çœ‹åˆ°çš„è¦†ç›–è¶Šæ¥è¶Šå¤šæ¯”ä¾‹çš„åŸå§‹è¾“å…¥)ï¼Œä»è€Œå­¦åˆ°ç©ºé—´å±‚çº§ç»“æ„ã€‚</p><h2 id="åœ¨å°å‹æ•°æ®é›†ä¸Šä»å¤´è®­ç»ƒä¸€ä¸ªå·ç§¯ç¥ç»ç½‘ç»œ"><a href="#åœ¨å°å‹æ•°æ®é›†ä¸Šä»å¤´è®­ç»ƒä¸€ä¸ªå·ç§¯ç¥ç»ç½‘ç»œ" class="headerlink" title="åœ¨å°å‹æ•°æ®é›†ä¸Šä»å¤´è®­ç»ƒä¸€ä¸ªå·ç§¯ç¥ç»ç½‘ç»œ"></a>åœ¨å°å‹æ•°æ®é›†ä¸Šä»å¤´è®­ç»ƒä¸€ä¸ªå·ç§¯ç¥ç»ç½‘ç»œ</h2><blockquote><p>5.2 Training a convnet from scratch on a small dataset</p></blockquote><p>æˆ‘ä»¬æè®¡ç®—æœºè§†è§‰çš„æ—¶å€™ï¼Œç»å¸¸è¦å¤„ç†çš„é—®é¢˜å°±æ˜¯åœ¨å¾ˆå°çš„æ•°æ®é›†ä¸Šè®­ç»ƒä¸€ä¸ªå›¾åƒåˆ†ç±»çš„æ¨¡å‹ã€‚emmmï¼Œè¿™é‡Œçš„â€œå¾ˆå°â€å¯ä»¥æ˜¯å‡ ç™¾åˆ°å‡ ä¸‡ã€‚</p><p>ä»è¿™ä¸€èŠ‚å¼€å§‹åˆ°åé¢å‡ èŠ‚ï¼Œæˆ‘ä»¬è¦æçš„å°±æ˜¯ä»å¤´å¼€å§‹è®­ç»ƒä¸€ä¸ªå°å‹æ¨¡å‹ã€ä½¿ç”¨é¢„è®­ç»ƒçš„ç½‘ç»œåšç‰¹å¾æå–ã€å¯¹é¢„è®­ç»ƒçš„ç½‘ç»œè¿›è¡Œå¾®è°ƒï¼Œè¿™äº›æ­¥éª¤åˆèµ·æ¥å°±å¯ä»¥ç”¨äºè§£å†³å°å‹æ•°æ®é›†çš„å›¾åƒåˆ†ç±»é—®é¢˜äº†ã€‚</p><p>æˆ‘ä»¬è¿™ä¸€èŠ‚è¦åšçš„æ˜¯ä»å¤´å¼€å§‹è®­ç»ƒä¸€ä¸ªå°å‹æ¨¡å‹æ¥åˆ†ç±»çŒ«ç‹—çš„å›¾ç‰‡ã€‚ä¸åšæ­£åˆ™åŒ–ï¼Œå…ˆä¸ç®¡è¿‡æ‹Ÿåˆçš„é—®é¢˜ã€‚</p><h3 id="ä¸‹è½½æ•°æ®"><a href="#ä¸‹è½½æ•°æ®" class="headerlink" title="ä¸‹è½½æ•°æ®"></a>ä¸‹è½½æ•°æ®</h3><p>æˆ‘ä»¬å°†ä½¿ç”¨ Dogs vs. Cats dataset æ¥è®­ç»ƒæ¨¡å‹ï¼Œè¿™ä¸ªæ•°æ®é›†é‡Œé¢æ˜¯ä¸€å¤§å †çŒ«ã€ç‹—çš„ç…§ç‰‡ã€‚è¿™ä¸ªæ•°æ®é›†å°±ä¸æ˜¯ Keras å†…ç½®çš„äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä» Kaggle ä¸‹è½½ï¼š<a href="https://www.kaggle.com/c/dogs-vs-cats/data">https://www.kaggle.com/c/dogs-vs-cats/data</a></p><p>ä¸‹è½½ä¸‹æ¥è§£å‹ç¼©ï¼Œï¼Œï¼Œï¼ˆemmmmæœ‰ç‚¹å¤§æˆ‘çš„ MBP éƒ½è£…ä¸ä¸‹äº†ï¼Œæ”¾ç§»åŠ¨ç¡¬ç›˜ä¸Šæ‰è§£å‡ºæ¥çš„ğŸ˜‚ï¼Œemmmmï¼Œåˆæƒ³èµ·æ¥è¯¥ä¹°ä¸ªæ–°å›ºæ€äº†ï¼‰ã€‚</p><p>ç„¶åæ¥åˆ›å»ºæˆ‘ä»¬è¦ç”¨çš„æ•°æ®é›†ï¼šè®­ç»ƒé›†çŒ«ç‹—å„1000ä¸ªæ ·æœ¬ï¼ŒéªŒè¯é›†å„500ä¸ªï¼Œæµ‹è¯•é›†å„500ä¸ªã€‚ç¼–ç¨‹æ¥å®Œæˆè¿™ä¸ªå·¥ä½œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†å›¾åƒå¤åˆ¶åˆ°è®­ç»ƒã€éªŒè¯å’Œæµ‹è¯•çš„ç›®å½•</span></span><br><span class="line"><span class="keyword">import</span> os, shutil</span><br><span class="line"></span><br><span class="line">original_dataset_dir = <span class="string">&#x27;/Volumes/WD/Files/dataset/dogs-vs-cats/dogs-vs-cats/train&#x27;</span>    <span class="comment"># åŸå§‹æ•°æ®é›†</span></span><br><span class="line"></span><br><span class="line">base_dir = <span class="string">&#x27;/Volumes/WD/Files/dataset/dogs-vs-cats/cats_and_dogs_small&#x27;</span>    <span class="comment"># å°†è¦ä¿å­˜çš„è¾ƒå°æ•°æ®é›†çš„ä½ç½®</span></span><br><span class="line">os.mkdir(base_dir)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å‡ ä¸ªç›®å½•æ”¾åˆ’åˆ†åçš„è®­ç»ƒã€éªŒè¯å’Œæµ‹è¯•é›†</span></span><br><span class="line">train_dir = os.path.join(base_dir, <span class="string">&#x27;train&#x27;</span>)</span><br><span class="line">os.mkdir(train_dir)</span><br><span class="line">validation_dir = os.path.join(base_dir, <span class="string">&#x27;validation&#x27;</span>)</span><br><span class="line">os.mkdir(validation_dir)</span><br><span class="line">test_dir = os.path.join(base_dir, <span class="string">&#x27;test&#x27;</span>)</span><br><span class="line">os.mkdir(test_dir)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†å¼€æ”¾çŒ«ç‹—</span></span><br><span class="line">train_cats_dir = os.path.join(train_dir, <span class="string">&#x27;cats&#x27;</span>)</span><br><span class="line">os.mkdir(train_cats_dir)</span><br><span class="line">train_dogs_dir = os.path.join(train_dir, <span class="string">&#x27;dogs&#x27;</span>)</span><br><span class="line">os.mkdir(train_dogs_dir)</span><br><span class="line"></span><br><span class="line">validation_cats_dir = os.path.join(validation_dir, <span class="string">&#x27;cats&#x27;</span>)</span><br><span class="line">os.mkdir(validation_cats_dir)</span><br><span class="line">validation_dogs_dir = os.path.join(validation_dir, <span class="string">&#x27;dogs&#x27;</span>)</span><br><span class="line">os.mkdir(validation_dogs_dir)</span><br><span class="line"></span><br><span class="line">test_cats_dir = os.path.join(test_dir, <span class="string">&#x27;cats&#x27;</span>)</span><br><span class="line">os.mkdir(test_cats_dir)</span><br><span class="line">test_dogs_dir = os.path.join(test_dir, <span class="string">&#x27;dogs&#x27;</span>)</span><br><span class="line">os.mkdir(test_dogs_dir)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤åˆ¶çŒ«çš„å›¾ç‰‡</span></span><br><span class="line">fnames = [<span class="string">f&#x27;cat.<span class="subst">&#123;i&#125;</span>.jpg&#x27;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>)]    <span class="comment"># è¿™é‡Œç”¨äº† f-Stringï¼Œè¦æ±‚ Python &gt;= 3.6ï¼Œè€ç‰ˆæœ¬å¯ä»¥ç”¨ &#x27;cat.&#123;&#125;.jpg&#x27;.format(i)</span></span><br><span class="line"><span class="keyword">for</span> fname <span class="keyword">in</span> fnames:</span><br><span class="line">    src = os.path.join(original_dataset_dir, fname)</span><br><span class="line">    dst = os.path.join(train_cats_dir, fname)</span><br><span class="line">    shutil.copyfile(src, dst)</span><br><span class="line">    </span><br><span class="line">fnames = [<span class="string">f&#x27;cat.<span class="subst">&#123;i&#125;</span>.jpg&#x27;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>, <span class="number">1500</span>)]</span><br><span class="line"><span class="keyword">for</span> fname <span class="keyword">in</span> fnames:</span><br><span class="line">    src = os.path.join(original_dataset_dir, fname)</span><br><span class="line">    dst = os.path.join(validation_cats_dir, fname)</span><br><span class="line">    shutil.copyfile(src, dst)</span><br><span class="line">    </span><br><span class="line">fnames = [<span class="string">f&#x27;cat.<span class="subst">&#123;i&#125;</span>.jpg&#x27;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1500</span>, <span class="number">2000</span>)]</span><br><span class="line"><span class="keyword">for</span> fname <span class="keyword">in</span> fnames:</span><br><span class="line">    src = os.path.join(original_dataset_dir, fname)</span><br><span class="line">    dst = os.path.join(test_cats_dir, fname)</span><br><span class="line">    shutil.copyfile(src, dst)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># å¤åˆ¶ç‹—çš„å›¾ç‰‡</span></span><br><span class="line">fnames = [<span class="string">f&#x27;dog.<span class="subst">&#123;i&#125;</span>.jpg&#x27;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>)]</span><br><span class="line"><span class="keyword">for</span> fname <span class="keyword">in</span> fnames:</span><br><span class="line">    src = os.path.join(original_dataset_dir, fname)</span><br><span class="line">    dst = os.path.join(train_dogs_dir, fname)</span><br><span class="line">    shutil.copyfile(src, dst)</span><br><span class="line">    </span><br><span class="line">fnames = [<span class="string">f&#x27;dog.<span class="subst">&#123;i&#125;</span>.jpg&#x27;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>, <span class="number">1500</span>)]</span><br><span class="line"><span class="keyword">for</span> fname <span class="keyword">in</span> fnames:</span><br><span class="line">    src = os.path.join(original_dataset_dir, fname)</span><br><span class="line">    dst = os.path.join(validation_dogs_dir, fname)</span><br><span class="line">    shutil.copyfile(src, dst)</span><br><span class="line">    </span><br><span class="line">fnames = [<span class="string">f&#x27;dog.<span class="subst">&#123;i&#125;</span>.jpg&#x27;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1500</span>, <span class="number">2000</span>)]</span><br><span class="line"><span class="keyword">for</span> fname <span class="keyword">in</span> fnames:</span><br><span class="line">    src = os.path.join(original_dataset_dir, fname)</span><br><span class="line">    dst = os.path.join(test_dogs_dir, fname)</span><br><span class="line">    shutil.copyfile(src, dst)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># æ£€æŸ¥</span></span><br><span class="line">print(<span class="string">&#x27;total training cat images:&#x27;</span>, <span class="built_in">len</span>(os.listdir(train_cats_dir)))</span><br><span class="line">print(<span class="string">&#x27;total validation cat images:&#x27;</span>, <span class="built_in">len</span>(os.listdir(validation_cats_dir)))</span><br><span class="line">print(<span class="string">&#x27;total test cat images:&#x27;</span>, <span class="built_in">len</span>(os.listdir(test_cats_dir)))</span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;total training dog images:&#x27;</span>, <span class="built_in">len</span>(os.listdir(train_dogs_dir)))</span><br><span class="line">print(<span class="string">&#x27;total validation dog images:&#x27;</span>, <span class="built_in">len</span>(os.listdir(validation_dogs_dir)))</span><br><span class="line">print(<span class="string">&#x27;total test dog images:&#x27;</span>, <span class="built_in">len</span>(os.listdir(test_dogs_dir)))</span><br></pre></td></tr></table></figure><pre><code>total training cat images: 1000total validation cat images: 500total test cat images: 500total training dog images: 1000total validation dog images: 500total test dog images: 500</code></pre><h3 id="æ„å»ºç½‘ç»œ"><a href="#æ„å»ºç½‘ç»œ" class="headerlink" title="æ„å»ºç½‘ç»œ"></a>æ„å»ºç½‘ç»œ</h3><p>åœ¨å‡ ä¹æ‰€æœ‰çš„å·ç§¯ç¥ç»ç½‘ç»œé‡Œï¼Œæˆ‘ä»¬éƒ½æ˜¯è®©ç‰¹å¾å›¾çš„æ·±åº¦é€æ¸å¢å¤§ï¼Œè€Œå°ºå¯¸é€æ¸å‡å°ã€‚æ‰€ä»¥è¿™æ¬¡æˆ‘ä»¬ä¹Ÿæ˜¯è¿™æ ·çš„ã€‚</p><p>æˆ‘ä»¬ç°åœ¨çš„è¿™ä¸ªé—®é¢˜æ˜¯ä¸ªäºŒåˆ†ç±»ï¼Œæ‰€ä»¥æœ€åä¸€å±‚ç”¨ä¸€ä¸ª1å•å…ƒçš„ sigmoid æ¿€æ´»çš„ Denseï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†çŒ«ç‹—åˆ†ç±»çš„å°å‹å·ç§¯ç¥ç»ç½‘ç»œå®ä¾‹åŒ–</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line">model = models.Sequential()</span><br><span class="line">model.add(layers.Conv2D(<span class="number">32</span>, (<span class="number">3</span>, <span class="number">3</span>), activation=<span class="string">&#x27;relu&#x27;</span>, input_shape=(<span class="number">150</span>, <span class="number">150</span>, <span class="number">3</span>)))</span><br><span class="line">model.add(layers.MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line">model.add(layers.Conv2D(<span class="number">64</span>, (<span class="number">3</span>, <span class="number">3</span>), activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line">model.add(layers.Conv2D(<span class="number">128</span>, (<span class="number">3</span>, <span class="number">3</span>), activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line">model.add(layers.Conv2D(<span class="number">128</span>, (<span class="number">3</span>, <span class="number">3</span>), activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line">model.add(layers.Flatten())</span><br><span class="line">model.add(layers.Dense(<span class="number">512</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>))</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹ç½‘ç»œçš„ç»“æ„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.summary()</span><br></pre></td></tr></table></figure><pre><code>Model: &quot;sequential_4&quot;_________________________________________________________________Layer (type)                 Output Shape              Param #   =================================================================conv2d_16 (Conv2D)           (None, 148, 148, 32)      896       _________________________________________________________________max_pooling2d_16 (MaxPooling (None, 74, 74, 32)        0         _________________________________________________________________conv2d_17 (Conv2D)           (None, 72, 72, 64)        18496     _________________________________________________________________max_pooling2d_17 (MaxPooling (None, 36, 36, 64)        0         _________________________________________________________________conv2d_18 (Conv2D)           (None, 34, 34, 128)       73856     _________________________________________________________________max_pooling2d_18 (MaxPooling (None, 17, 17, 128)       0         _________________________________________________________________conv2d_19 (Conv2D)           (None, 15, 15, 128)       147584    _________________________________________________________________max_pooling2d_19 (MaxPooling (None, 7, 7, 128)         0         _________________________________________________________________flatten_4 (Flatten)          (None, 6272)              0         _________________________________________________________________dense_8 (Dense)              (None, 512)               3211776   _________________________________________________________________dense_9 (Dense)              (None, 1)                 513       =================================================================Total params: 3,453,121Trainable params: 3,453,121Non-trainable params: 0_________________________________________________________________</code></pre><p>ç„¶åå°±è¦ç¼–è¯‘è¿™ä¸ªç½‘ç»œäº†ï¼ŒåšäºŒåˆ†ç±»å˜›ï¼Œæ‰€ä»¥æŸå¤±å‡½æ•°ç”¨ binary crossentropyï¼ˆäºŒå…ƒäº¤å‰ç†µï¼‰ï¼Œä¼˜åŒ–å™¨è¿˜æ˜¯ç”¨ RMSprop (æˆ‘ä»¬ä¹‹å‰éƒ½æ˜¯å†™ <code>optimizer=&#39;rmsprop&#39;</code>ï¼Œè¿™æ¬¡è¦ä¼ ç‚¹å‚æ•°ï¼Œæ‰€ä»¥ç”¨ <code>optimizers.RMSprop</code> å®ä¾‹)ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> optimizers</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>,</span><br><span class="line">              optimizer=optimizers.RMSprop(lr=<span class="number">1e-4</span>),</span><br><span class="line">              metrics=[<span class="string">&#x27;acc&#x27;</span>])</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®é¢„å¤„ç†"><a href="#æ•°æ®é¢„å¤„ç†" class="headerlink" title="æ•°æ®é¢„å¤„ç†"></a>æ•°æ®é¢„å¤„ç†</h3><p>æˆ‘ä»¬è¦æŠŠé‚£äº›å›¾ç‰‡ææˆæµ®ç‚¹æ•°å¼ é‡æ‰èƒ½å–‚ç»™ç¥ç»ç½‘ç»œã€‚æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>è¯»å–å›¾ç‰‡æ–‡ä»¶</li><li>æŠŠ JPEG æ–‡ä»¶å†…å®¹è§£ç æˆ RGB åƒç´ ç½‘æ ¼</li><li>è½¬åŒ–æˆæµ®ç‚¹æ•°å¼ é‡</li><li>æŠŠåƒç´ çš„å€¼ä» <code>[0, 255]</code> ç¼©æ”¾åˆ° <code>[0, 1]</code></li></ol><p>Keras æä¾›äº†ä¸€äº›å·¥å…·å¯ä»¥è‡ªåŠ¨å®Œæˆè¿™äº›ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ ImageDataGenerator ä»ç›®å½•ä¸­è¯»å–å›¾åƒ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.preprocessing.image <span class="keyword">import</span> ImageDataGenerator</span><br><span class="line"></span><br><span class="line">train_datagen = ImageDataGenerator(rescale=<span class="number">1.</span>/<span class="number">255</span>)</span><br><span class="line">test_datagen = ImageDataGenerator(rescale=<span class="number">1.</span>/<span class="number">255</span>)</span><br><span class="line"></span><br><span class="line">train_generator = train_datagen.flow_from_directory(</span><br><span class="line">    train_dir,</span><br><span class="line">    target_size=(<span class="number">150</span>, <span class="number">150</span>),</span><br><span class="line">    batch_size=<span class="number">20</span>,</span><br><span class="line">    class_mode=<span class="string">&#x27;binary&#x27;</span>)    <span class="comment"># ç”¨äºŒåˆ†ç±»çš„æ ‡ç­¾</span></span><br><span class="line"></span><br><span class="line">validation_generator = test_datagen.flow_from_directory(</span><br><span class="line">    validation_dir,</span><br><span class="line">    target_size=(<span class="number">150</span>, <span class="number">150</span>),</span><br><span class="line">    batch_size=<span class="number">20</span>,</span><br><span class="line">    class_mode=<span class="string">&#x27;binary&#x27;</span>)</span><br></pre></td></tr></table></figure><pre><code>Found 2000 images belonging to 2 classes.Found 1000 images belonging to 2 classes.</code></pre><p>è¿™ä¸ªæå‡ºæ¥çš„ train_generator å’Œ validation_generator å°±æ˜¯ Python çš„é‚£ç§ Generatorï¼Œæƒ°æ€§è®¡ç®—çš„é‚£ç§ã€‚è¿™ä¸ªç”Ÿæˆå™¨ä¸€æ¬¡ yield å‡ºæ¥ä¸€ä¸ª batchï¼Œæ‰€ä»¥æŠŠå®ƒå«åšâ€œbatch generatorâ€ï¼Œè¿­ä»£å‡ºä¸€ä¸ªæ¥çœ‹ä¸€ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> data_batch, labels_batch <span class="keyword">in</span> train_generator:</span><br><span class="line">    print(<span class="string">&#x27;data batch shape:&#x27;</span>, data_batch.shape)</span><br><span class="line">    print(<span class="string">&#x27;labels batch shape:&#x27;</span>, labels_batch.shape)</span><br><span class="line">    print(<span class="string">&#x27;labels_batch:&#x27;</span>, labels_batch)</span><br><span class="line">    <span class="keyword">break</span></span><br></pre></td></tr></table></figure><pre><code>data batch shape: (20, 150, 150, 3)labels batch shape: (20,)labels_batch: [1. 1. 1. 1. 1. 1. 1. 1. 1. 0. 1. 1. 1. 1. 0. 0. 1. 1. 0. 1.]</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ©ç”¨ batch ç”Ÿæˆå™¨æ‹Ÿåˆæ¨¡å‹</span></span><br><span class="line">history = model.fit_generator(</span><br><span class="line">    train_generator,</span><br><span class="line">    steps_per_epoch=<span class="number">100</span>,</span><br><span class="line">    epochs=<span class="number">30</span>,</span><br><span class="line">    validation_data=validation_generator,</span><br><span class="line">    validation_steps=<span class="number">50</span>)</span><br></pre></td></tr></table></figure><pre><code>Epoch 1/30100/100 [==============================] - 97s 967ms/step - loss: 0.6901 - acc: 0.5450 - val_loss: 0.6785 - val_acc: 0.5270Epoch 2/30100/100 [==============================] - 86s 865ms/step - loss: 0.6661 - acc: 0.5875 - val_loss: 0.6525 - val_acc: 0.6060......Epoch 29/30100/100 [==============================] - 160s 2s/step - loss: 0.0533 - acc: 0.9860 - val_loss: 0.9298 - val_acc: 0.7310Epoch 30/30100/100 [==============================] - 162s 2s/step - loss: 0.0460 - acc: 0.9885 - val_loss: 1.0609 - val_acc: 0.7150</code></pre><p>è¿™é‡Œå› ä¸ºæ˜¯ä» generator è¯»å– batch æ¥ fitï¼Œæ‰€ä»¥æŠŠæˆ‘ä»¬å¹³æ—¶ç”¨çš„ fit æ”¹æˆäº† <code>fit_generator</code>ã€‚é‡Œé¢ä¼ è®­ç»ƒæ•°æ®ç”Ÿæˆå™¨ã€ä¸€ä¸ªè½®æ¬¡è¦ä» train_generator é‡Œ yield å‡ºæ¥çš„æ¬¡æ•°(steps_per_epoch)ã€è½®æ¬¡ã€éªŒè¯é›†ç”Ÿæˆå™¨ã€ä¸€ä¸ªè½®æ¬¡è¦ä» validation_generator é‡Œ yield å‡ºæ¥çš„æ¬¡æ•°(validation_steps)ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">steps_per_epoch &#x3D; è®­ç»ƒé›†æ•°æ®æ€»æ•° &#x2F; æ„å»ºgeneratoræ—¶æŒ‡å®šçš„batch_size</span><br></pre></td></tr></table></figure><p>validation_steps å’Œ steps_per_epoch ç±»ä¼¼ï¼Œåªæ˜¯æ˜¯å¯¹éªŒè¯é›†çš„ã€‚</p><p>ç”¨ä¸‹é¢è¿™è¡Œä»£ç æŠŠè®­ç»ƒå¥½çš„æ¨¡å‹ä¿å­˜ä¸‹æ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿å­˜æ¨¡å‹</span></span><br><span class="line">model.save(<span class="string">&#x27;/Volumes/WD/Files/dataset/dogs-vs-cats/cats_and_dogs_small_1.h5&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠè®­ç»ƒè¿‡ç¨‹ç”»å‡ºå›¾æ¥çœ‹ä¸€ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»˜åˆ¶è®­ç»ƒè¿‡ç¨‹ä¸­çš„æŸå¤±æ›²çº¿å’Œç²¾åº¦æ›²çº¿</span></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">acc = history.history[<span class="string">&#x27;acc&#x27;</span>]</span><br><span class="line">val_acc = history.history[<span class="string">&#x27;val_acc&#x27;</span>]</span><br><span class="line">loss = history.history[<span class="string">&#x27;loss&#x27;</span>]</span><br><span class="line">val_loss = history.history[<span class="string">&#x27;val_loss&#x27;</span>]</span><br><span class="line"></span><br><span class="line">epochs = <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(acc) + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">plt.plot(epochs, acc, <span class="string">&#x27;bo-&#x27;</span>, label=<span class="string">&#x27;Training acc&#x27;</span>)</span><br><span class="line">plt.plot(epochs, val_acc, <span class="string">&#x27;sr-&#x27;</span>, label=<span class="string">&#x27;Validation acc&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation accuracy&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">plt.figure()</span><br><span class="line"></span><br><span class="line">plt.plot(epochs, loss, <span class="string">&#x27;bo-&#x27;</span>, label=<span class="string">&#x27;Training loss&#x27;</span>)</span><br><span class="line">plt.plot(epochs, val_loss, <span class="string">&#x27;sr-&#x27;</span>, label=<span class="string">&#x27;Validation loss&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation loss&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh85zaz7caj30af07ct8s.jpg" alt="png"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh85zd7wcrj30af07cwek.jpg" alt="png"></p><p>ä¸å‡ºæ‰€æ–™ï¼Œè¿‡æ‹Ÿåˆäº†ï¼Œä»å·®ä¸å¤šç¬¬5è½®å°±å¼€å§‹è¿‡äº†ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦ç”¨ data augmentation (æ•°æ®å¢å¼º) æ¥é™ä½è¿‡æ‹Ÿåˆã€‚</p><h3 id="æ•°æ®å¢å¼º"><a href="#æ•°æ®å¢å¼º" class="headerlink" title="æ•°æ®å¢å¼º"></a>æ•°æ®å¢å¼º</h3><p>data augmentation (æ•°æ®å¢å¼º) æ˜¯ç”¨æ·±åº¦å­¦ä¹ å¤„ç†å›¾åƒä¸€èˆ¬éƒ½ä¼šç”¨åˆ°çš„ä¸€ä¸ªæ–¹æ³•ã€‚</p><p>è¿‡æ‹Ÿåˆæ˜¯ç”±äºè®­ç»ƒçš„æ•°æ®å¤ªå°‘å¯¼è‡´çš„ï¼ˆåªè¦æ ·æœ¬è¶³å¤Ÿå¤šï¼Œæ¨¡å‹å°±èƒ½çœ‹éå‡ ä¹æ‰€ä»¥å¯èƒ½ï¼Œä»è€Œå‡ ä¹ä¸ä¼šçŠ¯é”™ï¼‰ã€‚æ•°æ®å¢å¼ºæ˜¯ä¸€ç§ä»¥ç°æœ‰çš„æ ·æœ¬ä¸ºåŸºç¡€ç”Ÿæˆæ›´å¤šçš„è®­ç»ƒæ•°æ®çš„ä¸€ç§æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åˆ©ç”¨å¤šç§èƒ½å¤Ÿç”Ÿæˆå¯ä¿¡å›¾åƒçš„éšæœºå˜æ¢æ¥å¢åŠ ã€‚</p><p>åœ¨ Keras ä¸­ï¼Œæˆ‘ä»¬ç”¨ ImageDataGenerator çš„æ—¶å€™è®¾å‡ ä¸ªå‚æ•°å°±å¯ä»¥å®Œæˆæ•°æ®å¢å¼ºäº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">datagen = ImageDataGenerator(</span><br><span class="line">      rotation_range=<span class="number">40</span>,      <span class="comment"># éšæœºæ—‹è½¬å›¾ç‰‡çš„èŒƒå›´ï¼Œ0~180</span></span><br><span class="line">      width_shift_range=<span class="number">0.2</span>,  <span class="comment"># éšæœºæ°´å¹³ç§»åŠ¨çš„æ¯”ä¾‹</span></span><br><span class="line">      height_shift_range=<span class="number">0.2</span>, <span class="comment"># éšæœºç«–ç›´ç§»åŠ¨çš„æ¯”ä¾‹</span></span><br><span class="line">      shear_range=<span class="number">0.2</span>,        <span class="comment"># éšæœºé”™åˆ‡å˜æ¢(shearing transformations)çš„è§’åº¦</span></span><br><span class="line">      zoom_range=<span class="number">0.2</span>,         <span class="comment"># éšæœºç¼©æ”¾çš„èŒƒå›´</span></span><br><span class="line">      horizontal_flip=<span class="literal">True</span>,   <span class="comment"># æ˜¯å¦åšéšæœºæ°´å¹³åè½¬</span></span><br><span class="line">      fill_mode=<span class="string">&#x27;nearest&#x27;</span>)    <span class="comment"># å¡«å……æ–°åˆ›å»ºåƒç´ çš„æ–¹æ³•</span></span><br></pre></td></tr></table></figure><p>æ‰¾å¼ å›¾ç‰‡å¢å¼ºäº†è¯•è¯•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.preprocessing <span class="keyword">import</span> image</span><br><span class="line"></span><br><span class="line">fnames = [os.path.join(train_cats_dir, fname) <span class="keyword">for</span> </span><br><span class="line">          fname <span class="keyword">in</span> os.listdir(train_cats_dir)]</span><br><span class="line"></span><br><span class="line">img_path = fnames[<span class="number">3</span>]</span><br><span class="line">img = image.load_img(img_path, target_size=(<span class="number">150</span>, <span class="number">150</span>))    <span class="comment"># è¯»å–å›¾ç‰‡</span></span><br><span class="line"></span><br><span class="line">x = image.img_to_array(img)    <span class="comment"># shape (150, 150, 3)</span></span><br><span class="line">x = x.reshape((<span class="number">1</span>,) + x.shape)  <span class="comment"># shape (1, 150, 150, 3)</span></span><br><span class="line"></span><br><span class="line">i=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> batch <span class="keyword">in</span> datagen.flow(x, batch_size=<span class="number">1</span>):</span><br><span class="line">    plt.figure(i)</span><br><span class="line">    imgplot = plt.imshow(image.array_to_img(batch[<span class="number">0</span>]))</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">4</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh85zfrydzj307907075h.jpg" alt="png"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh85zk2m49j3079070myh.jpg" alt="png"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh85zhn5dcj3079070aba.jpg" alt="png"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh85zrkbkej30790703zv.jpg" alt="png"></p><p>æ³¨æ„æ•°æ®å¢å¼ºå¹¶æ²¡æœ‰å¸¦æ¥æ–°çš„ä¿¡æ¯ï¼Œåªæ˜¯æŠŠåŸæœ¬å°±æœ‰çš„ä¿¡æ¯ remix ä¸€ä¸‹ã€‚æ‰€ä»¥åœ¨æ•°æ®ç‰¹åˆ«å°‘çš„æƒ…å†µä¸‹ï¼Œå…‰ç”¨æ•°æ®å¢å¼ºä¸è¶³ä»¥æ¶ˆé™¤è¿‡æ‹Ÿåˆï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦åœ¨ Dense å±‚ä¹‹å‰ç”¨ä¸Š Dropoutã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªåŒ…å« dropout çš„æ–°å·ç§¯ç¥ç»ç½‘ç»œ</span></span><br><span class="line"></span><br><span class="line">model = models.Sequential()</span><br><span class="line">model.add(layers.Conv2D(<span class="number">32</span>, (<span class="number">3</span>, <span class="number">3</span>), activation=<span class="string">&#x27;relu&#x27;</span>, input_shape=(<span class="number">150</span>, <span class="number">150</span>, <span class="number">3</span>)))</span><br><span class="line">model.add(layers.MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line">model.add(layers.Conv2D(<span class="number">64</span>, (<span class="number">3</span>, <span class="number">3</span>), activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line">model.add(layers.Conv2D(<span class="number">128</span>, (<span class="number">3</span>, <span class="number">3</span>), activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line">model.add(layers.Conv2D(<span class="number">128</span>, (<span class="number">3</span>, <span class="number">3</span>), activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line">model.add(layers.Flatten())</span><br><span class="line"></span><br><span class="line">model.add(layers.Dropout(<span class="number">0.5</span>))    <span class="comment"># ğŸ‘ˆ æ–°å¢çš„ Dropout</span></span><br><span class="line"></span><br><span class="line">model.add(layers.Dense(<span class="number">512</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>))</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>, </span><br><span class="line">              optimizer=optimizers.RMSprop(lr=<span class="number">1e-4</span>), </span><br><span class="line">              metrics=[<span class="string">&#x27;acc&#x27;</span>])</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ©ç”¨æ•°æ®å¢å¼ºç”Ÿæˆå™¨æ¥è®­ç»ƒå·ç§¯ç¥ç»ç½‘ç»œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®ç”Ÿæˆå™¨</span></span><br><span class="line">train_datagen = ImageDataGenerator(</span><br><span class="line">    rescale=<span class="number">1.</span>/<span class="number">255</span>,</span><br><span class="line">    rotation_range=<span class="number">40</span>,</span><br><span class="line">    width_shift_range=<span class="number">0.2</span>,</span><br><span class="line">    height_shift_range=<span class="number">0.2</span>,</span><br><span class="line">    shear_range=<span class="number">0.2</span>,</span><br><span class="line">    zoom_range=<span class="number">0.2</span>,</span><br><span class="line">    horizontal_flip=<span class="literal">True</span>,)</span><br><span class="line"></span><br><span class="line">test_datagen = ImageDataGenerator(rescale=<span class="number">1.</span>/<span class="number">255</span>)    <span class="comment"># æµ‹è¯•é›†ä¸å¢å¼ºå“¦</span></span><br><span class="line"></span><br><span class="line">train_generator = train_datagen.flow_from_directory(</span><br><span class="line">    train_dir,</span><br><span class="line">    target_size=(<span class="number">150</span>, <span class="number">150</span>),</span><br><span class="line">    batch_size=<span class="number">32</span>,</span><br><span class="line">    class_mode=<span class="string">&#x27;binary&#x27;</span>)</span><br><span class="line"></span><br><span class="line">validation_generator = test_datagen.flow_from_directory(</span><br><span class="line">    validation_dir,</span><br><span class="line">    target_size=(<span class="number">150</span>, <span class="number">150</span>),</span><br><span class="line">    batch_size=<span class="number">32</span>,</span><br><span class="line">    class_mode=<span class="string">&#x27;binary&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®­ç»ƒ</span></span><br><span class="line">history = model.fit_generator(</span><br><span class="line">    train_generator,</span><br><span class="line">    steps_per_epoch=<span class="number">100</span>,</span><br><span class="line">    epochs=<span class="number">100</span>,</span><br><span class="line">    validation_data=validation_generator,</span><br><span class="line">    validation_steps=<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿å­˜æ¨¡å‹</span></span><br><span class="line">model.save(<span class="string">&#x27;/Volumes/WD/Files/dataset/dogs-vs-cats/cats_and_dogs_small_2.h5&#x27;</span>)</span><br></pre></td></tr></table></figure><pre><code>Found 2000 images belonging to 2 classes.Found 1000 images belonging to 2 classes.Epoch 1/100100/100 [==============================] - 142s 1s/step - loss: 0.6909 - acc: 0.5265 - val_loss: 0.6799 - val_acc: 0.5127Epoch 2/100100/100 [==============================] - 123s 1s/step - loss: 0.6817 - acc: 0.5474 - val_loss: 0.6561 - val_acc: 0.6320......100/100 [==============================] - 131s 1s/step - loss: 0.3225 - acc: 0.8612 - val_loss: 0.4465 - val_acc: 0.7976Epoch 99/100100/100 [==============================] - 134s 1s/step - loss: 0.3391 - acc: 0.8501 - val_loss: 0.5455 - val_acc: 0.7836Epoch 100/100100/100 [==============================] - 130s 1s/step - loss: 0.3140 - acc: 0.8624 - val_loss: 0.4295 - val_acc: 0.8274</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»˜åˆ¶è®­ç»ƒè¿‡ç¨‹ä¸­çš„æŸå¤±æ›²çº¿å’Œç²¾åº¦æ›²çº¿</span></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">acc = history.history[<span class="string">&#x27;acc&#x27;</span>]</span><br><span class="line">val_acc = history.history[<span class="string">&#x27;val_acc&#x27;</span>]</span><br><span class="line">loss = history.history[<span class="string">&#x27;loss&#x27;</span>]</span><br><span class="line">val_loss = history.history[<span class="string">&#x27;val_loss&#x27;</span>]</span><br><span class="line"></span><br><span class="line">epochs = <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(acc) + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">plt.plot(epochs, acc, <span class="string">&#x27;bo-&#x27;</span>, label=<span class="string">&#x27;Training acc&#x27;</span>)</span><br><span class="line">plt.plot(epochs, val_acc, <span class="string">&#x27;r-&#x27;</span>, label=<span class="string">&#x27;Validation acc&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation accuracy&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">plt.figure()</span><br><span class="line"></span><br><span class="line">plt.plot(epochs, loss, <span class="string">&#x27;bo-&#x27;</span>, label=<span class="string">&#x27;Training loss&#x27;</span>)</span><br><span class="line">plt.plot(epochs, val_loss, <span class="string">&#x27;r-&#x27;</span>, label=<span class="string">&#x27;Validation loss&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation loss&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh85zupxk2j30al07cjro.jpg" alt="png"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh85zwpa4hj30al07c0t2.jpg" alt="png"></p><p>ğŸ‘Œç”¨äº† Data Augmentation å’Œ Dropout ä¹‹åï¼Œè¿‡æ‹Ÿåˆå°±å¥½å¤šäº†ï¼Œç²¾åº¦ä¹Ÿæœ‰æ‰€æå‡ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿˜ä¼šç”¨ä¸€äº›æŠ€æœ¯æ¥è¿›ä¸€æ­¥ä¼˜åŒ–æ¨¡å‹ã€‚</p><h2 id="ä½¿ç”¨é¢„è®­ç»ƒçš„å·ç§¯ç¥ç»ç½‘ç»œ"><a href="#ä½¿ç”¨é¢„è®­ç»ƒçš„å·ç§¯ç¥ç»ç½‘ç»œ" class="headerlink" title="ä½¿ç”¨é¢„è®­ç»ƒçš„å·ç§¯ç¥ç»ç½‘ç»œ"></a>ä½¿ç”¨é¢„è®­ç»ƒçš„å·ç§¯ç¥ç»ç½‘ç»œ</h2><blockquote><p>5.3 Using a pretrained convnet</p></blockquote><p>å¯¹äºå°å‹å›¾åƒæ•°æ®é›†ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„ä¸€ç§é«˜æ•ˆçš„æ–¹æ³•æ˜¯åˆ©ç”¨é¢„è®­ç»ƒç½‘ç»œï¼ˆpretrained networkï¼‰æ¥æ„å»ºæ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚é¢„è®­ç»ƒç½‘ç»œæ˜¯ä¹‹å‰åœ¨å¤§å‹æ•°æ®é›†ä¸Šè®­ç»ƒå¥½çš„ç½‘ç»œï¼ˆé€šå¸¸æ˜¯åœ¨å¤§å‹å›¾ç‰‡åˆ†ç±»ä»»åŠ¡ä¸Šè®­ç»ƒå¥½çš„ï¼‰ã€‚å¦‚æœé¢„è®­ç»ƒé›†ç”¨çš„æ•°æ®è¶³å¤Ÿå¤šï¼Œæ¨¡å‹è¶³å¤Ÿæ³›åŒ–ï¼Œé‚£ä¹ˆé¢„è®­ç»ƒç½‘ç»œå­¦åˆ°çš„ç©ºé—´å±‚æ¬¡ç»“æ„å°±å¯ä»¥æœ‰æ•ˆåœ°ä½œä¸ºé€šç”¨æ¨¡å‹æ¥ååº”ç°å®çš„è§†è§‰ä¸–ç•Œï¼Œå› æ­¤å°±å¯ç”¨äºå„ç§ä¸åŒçš„è®¡ç®—æœºè§†è§‰é—®é¢˜ï¼Œå“ªæ€•æ–°çš„é—®é¢˜å’ŒåŸå§‹ä»»åŠ¡å®Œå…¨æ‰¯ä¸ä¸Šå…³ç³»ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªåœ¨ ImageNet (è¿™ä¸ªæ•°æ®é›†æœ‰140ä¸‡å¼ å›¾åƒï¼Œ1000ä¸ªä¸åŒçš„ç±»åˆ«ï¼Œä¸»è¦æ˜¯åŠ¨ç‰©å’Œå„ç§æ—¥å¸¸ç”¨å“)å®Œæˆé¢„è®­ç»ƒçš„ç½‘ç»œæ¥å¤„ç†çŒ«ç‹—åˆ†ç±»çš„é—®é¢˜ã€‚æˆ‘ä»¬å°†ä½¿ç”¨çš„æ˜¯ VGG16 è¿™ä¸ªæ¶æ„ã€‚</p><p>ä½¿ç”¨é¢„è®­ç»ƒç½‘ç»œæœ‰ä¸¤ç§æ–¹æ³•ï¼š<em>ç‰¹å¾æå–</em>(feature extraction)å’Œ<em>å¾®è°ƒæ¨¡å‹</em>(fine-tuning)ã€‚</p><h3 id="ç‰¹å¾æå–"><a href="#ç‰¹å¾æå–" class="headerlink" title="ç‰¹å¾æå–"></a>ç‰¹å¾æå–</h3><p>ç‰¹å¾æå–æ˜¯ä½¿ç”¨ä¹‹å‰çš„ç½‘ç»œå­¦åˆ°çš„è¡¨ç¤ºæ¥ä»æ–°æ ·æœ¬ä¸­æå–å‡ºéœ€è¦çš„ç‰¹å¾ï¼Œè¾“å…¥ä¸€ä¸ªæ–°çš„åˆ†ç±»å™¨ï¼Œä»å¤´å¼€å§‹è®­ç»ƒã€‚</p><p>åœ¨å‰é¢çš„å·ç§¯ç¥ç»ç½‘ç»œä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œæˆ‘ä»¬ç”¨æ¥å›¾ç‰‡åˆ†ç±»çš„æ¨¡å‹å¯ä»¥åˆ†æˆä¸¤éƒ¨åˆ†ï¼š</p><ul><li>å·ç§¯åŸºï¼ˆconvolutional baseï¼‰ï¼šå‰é¢çš„å·ç§¯ã€æ± åŒ–å±‚ï¼›</li><li>åˆ†ç±»å™¨ï¼ˆclassifierï¼‰ï¼šåé¢çš„å¯†è¿æ¥å±‚ï¼›</li></ul><p>æ‰€ä»¥å¯¹äºå·ç§¯ç¥ç»ç½‘ç»œï¼Œ<strong>ç‰¹å¾æå–</strong>å°±æ˜¯å–å‡ºä¹‹å‰è®­ç»ƒå¥½çš„ç½‘ç»œçš„å·ç§¯åŸºï¼ŒæŠŠæ–°çš„æ•°æ®è¾“å…¥è¿›å»è·‘ï¼Œç„¶åæ‹¿å…¶è¾“å‡ºå»è®­ç»ƒä¸€ä¸ªæ–°çš„åˆ†ç±»å™¨ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggvimux4ttj314l0u0jv4.jpg" alt="ä¿æŒå·ç§¯åŸºä¸å˜ï¼Œæ”¹å˜åˆ†ç±»å™¨"></p><p>æ³¨æ„ï¼Œåªå¤ç”¨å·ç§¯åŸºï¼Œè€Œä¸å¤ç”¨åˆ†ç±»å™¨ã€‚å·ç§¯åŸºæ˜¯ç”¨æ¥æå–ç‰¹å¾çš„ï¼Œè¿™ä¸ªå¯ä»¥ç›¸åŒï¼›ä½†ç”±äºæ¯ä¸ªé—®é¢˜çš„åˆ†ç±»ä¸åŒï¼Œç†åº”ä½¿ç”¨ä¸åŒçš„åˆ†ç±»å™¨ï¼›å¹¶ä¸”æœ‰çš„é—®é¢˜ä¸­ç‰¹å¾çš„ä½ç½®æ˜¯æœ‰ç”¨çš„ï¼Œè€Œæˆ‘ä»¬æŠŠç‰¹å¾å›¾è½¬åˆ° Dense å±‚çš„æ—¶å€™è¿™äº›ä½ç½®ç‰¹å¾å°±ä¸¢å¤±äº†ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯æ‰€æœ‰é—®é¢˜éƒ½æ˜¯ç”¨ Dense å»ç®€å•çš„å®Œæˆåˆ†ç±»çš„ï¼Œæ‰€ä»¥ä¸åº”è¯¥æ— è„‘å¥—ç”¨åˆ†ç±»å™¨ã€‚</p><p>åœ¨é¢„è®­ç»ƒç½‘ç»œä¸­ï¼Œèƒ½æå–çš„ç‰¹å¾è¡¨ç¤ºçš„é€šç”¨ç¨‹åº¦å–å†³äºäºå…¶æ·±åº¦ã€‚è¶Šå°‘çš„å±‚è¶Šé€šç”¨ï¼ˆæ¯”å¦‚ï¼Œå›¾ç‰‡çš„é¢œè‰²ã€è¾¹ç¼˜ã€çº¹ç†ä¹‹ç±»çš„ï¼‰ï¼Œè¶Šå¤šçš„å±‚å°±ä¼šåŒ…å«è¶Šå¤šçš„æŠ½è±¡ä¿¡æ¯ï¼ˆæ¯”å¦‚ï¼Œæœ‰ä¸€ä¸ªçŒ«çš„çœ¼ç›å•Šä¹‹ç±»çš„ï¼‰ã€‚æ‰€ä»¥å¦‚æœé¢„è®­ç»ƒç½‘ç»œå¤„ç†çš„åŸå§‹é—®é¢˜å’Œæˆ‘ä»¬å½“å‰è¦å¤„ç†çš„é—®é¢˜å·®è·å¤ªå¤§ï¼Œå°±åªå› è¯¥ä½¿ç”¨æ¯”è¾ƒå°‘çš„å‰å‡ å±‚ï¼Œè€Œä¸è¦ç”¨æ•´ä¸ªå·ç§¯åŸºã€‚</p><p>ç°åœ¨ï¼Œæ¥åšå®è·µäº†ï¼Œæˆ‘ä»¬è¦ç”¨åœ¨ ImageNet ä¸Šé¢„è®­ç»ƒçš„ VGG16 æ¨¡å‹æ¥å¤„ç†çŒ«ç‹—åˆ†ç±»çš„é—®é¢˜ï¼Œæˆ‘ä»¬å°†ä¿æŒå·ç§¯åŸºä¸å˜ï¼Œæ”¹å˜åˆ†ç±»å™¨ã€‚</p><p>VGG16 æ¨¡å‹æ˜¯ Keras æœ‰å†…ç½®çš„ï¼Œç›´æ¥ç”¨å°±å¥½äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.applications <span class="keyword">import</span> VGG16</span><br><span class="line"></span><br><span class="line">conv_base = VGG16(weights=<span class="string">&#x27;imagenet&#x27;</span>,        <span class="comment"># æŒ‡å®šæ¨¡å‹åˆå§‹åŒ–çš„æƒé‡æ£€æŸ¥ç‚¹</span></span><br><span class="line">                  include_top=<span class="literal">False</span>,         <span class="comment"># æ˜¯å¦åŒ…å«æœ€åçš„å¯†é›†è¿æ¥å±‚åˆ†ç±»å™¨</span></span><br><span class="line">                  input_shape=(<span class="number">150</span>, <span class="number">150</span>, <span class="number">3</span>)) <span class="comment"># è¾“å…¥çš„å½¢çŠ¶ï¼Œä¸ä¼ çš„è¯èƒ½å¤„ç†ä»»æ„å½¢çŠ¶çš„è¾“å…¥</span></span><br></pre></td></tr></table></figure><p>æ¨¡å‹æ˜¯è¦ä»è¿™é‡Œä¸‹è½½çš„ï¼š<a href="https://github.com/fchollet/deep-learning-models/releases">https://github.com/fchollet/deep-learning-models/releases</a></p><p>å¦‚æœè®©ä»–è‡ªå·±ä¸‹æ¯”è¾ƒæ…¢çš„è¯ï¼Œå¯ä»¥è€ƒè™‘æ‰‹åŠ¨ä¸‹è½½å®‰è£…ã€‚å‚è€ƒ vgg16 çš„æºç : <code>/usr/local/lib/python3.7/site-packages/keras_applications/vgg16.py</code>ï¼Œå‘ç°å®ƒæ˜¯è°ƒç”¨ä¸€ä¸ª get_file æ¥è·å–æ¨¡å‹çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">weights_path = keras_utils.get_file(</span><br><span class="line">    <span class="string">&#x27;vgg16_weights_tf_dim_ordering_tf_kernels_notop.h5&#x27;</span>,</span><br><span class="line">    WEIGHTS_PATH_NO_TOP,</span><br><span class="line">    cache_subdir=<span class="string">&#x27;models&#x27;</span>,</span><br><span class="line">    file_hash=<span class="string">&#x27;6d6bbae143d832006294945121d1f1fc&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçœ‹åˆ°ä»–æ˜¯ä»ä¸€ä¸ªå­ç›®å½• <code>models</code> é‡Œè¯»å–æ¨¡å‹çš„ï¼Œè¿˜æœ‰è¿™ä¸ª <code>keras_utils.get_file</code> å°±æ˜¯ <code>/usr/local/lib/python3.7/site-packages/tensorflow_core/python/keras/utils/data_utils.py</code> ç¬¬ 150 è¡Œå·¦å³çš„ get_file å‡½æ•°ï¼Œæ–‡æ¡£æ³¨é‡Šé‡Œå†™äº†ï¼Œä¸œè¥¿é»˜è®¤æ˜¯æ”¾åˆ° <code>~/.keras</code> è¿™ä¸ªç›®å½•çš„ã€‚</p><p>æ€»ä¹‹ï¼Œå°±æ˜¯æŠŠæ¨¡å‹ä¸‹è½½ä¸‹æ¥æ”¾åˆ° <code>~/.keras/models</code> é‡Œå°±å¥½äº†ã€‚</p><p>è¿˜æœ‰æ³¨æ„åŠ ä¸åŠ top(æœ€åçš„åˆ†ç±»å™¨)ï¼Œä¸‹è½½çš„æ¨¡å‹å¤§å°å·®è·è¿˜æ˜¯å¾ˆå¤§çš„ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggw35kvawgj30t407uta8.jpg" alt="ä¸åŒé…ç½®çš„VGG16é¢„è®­ç»ƒæ¨¡å‹çš„å¤§å°"></p><p>æ€»ä¹‹ï¼Œæœ€åå®Œäº†ä¼šå¾—åˆ°ä¸€ä¸ª conv_base æ¨¡å‹ï¼Œè¿™ä¸ªæ¨¡å‹è¿˜æ˜¯å¾ˆå®¹æ˜“ç†è§£çš„ï¼Œç”¨åˆ°çš„éƒ½æ˜¯æˆ‘ä»¬ä¹‹å‰å·²ç»å­¦è¿‡çš„ä¸œè¥¿ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conv_base.summary()</span><br></pre></td></tr></table></figure><pre><code>Model: &quot;vgg16&quot;_________________________________________________________________Layer (type)                 Output Shape              Param #   =================================================================input_1 (InputLayer)         [(None, 150, 150, 3)]     0         _________________________________________________________________block1_conv1 (Conv2D)        (None, 150, 150, 64)      1792      _________________________________________________________________block1_conv2 (Conv2D)        (None, 150, 150, 64)      36928     _________________________________________________________________block1_pool (MaxPooling2D)   (None, 75, 75, 64)        0         _________________________________________________________________block2_conv1 (Conv2D)        (None, 75, 75, 128)       73856     _________________________________________________________________block2_conv2 (Conv2D)        (None, 75, 75, 128)       147584    _________________________________________________________________block2_pool (MaxPooling2D)   (None, 37, 37, 128)       0         _________________________________________________________________block3_conv1 (Conv2D)        (None, 37, 37, 256)       295168    _________________________________________________________________block3_conv2 (Conv2D)        (None, 37, 37, 256)       590080    _________________________________________________________________block3_conv3 (Conv2D)        (None, 37, 37, 256)       590080    _________________________________________________________________block3_pool (MaxPooling2D)   (None, 18, 18, 256)       0         _________________________________________________________________block4_conv1 (Conv2D)        (None, 18, 18, 512)       1180160   _________________________________________________________________block4_conv2 (Conv2D)        (None, 18, 18, 512)       2359808   _________________________________________________________________block4_conv3 (Conv2D)        (None, 18, 18, 512)       2359808   _________________________________________________________________block4_pool (MaxPooling2D)   (None, 9, 9, 512)         0         _________________________________________________________________block5_conv1 (Conv2D)        (None, 9, 9, 512)         2359808   _________________________________________________________________block5_conv2 (Conv2D)        (None, 9, 9, 512)         2359808   _________________________________________________________________block5_conv3 (Conv2D)        (None, 9, 9, 512)         2359808   _________________________________________________________________block5_pool (MaxPooling2D)   (None, 4, 4, 512)         0         =================================================================Total params: 14,714,688Trainable params: 14,714,688Non-trainable params: 0_________________________________________________________________</code></pre><p>æ³¨æ„ï¼Œæœ€å‰é¢çš„è¾“å…¥å·²ç»è°ƒæˆäº†æˆ‘ä»¬å¸Œæœ›çš„<code>(150, 150, 3)</code>ï¼Œæœ€åçš„è¾“å‡ºæ˜¯<code>(4, 4, 512)</code>ï¼Œåœ¨åé¢æˆ‘ä»¬è¦è¿ä¸Šæˆ‘ä»¬è‡ªå·±çš„åˆ†ç±»å™¨ã€‚æœ‰ä¸¤ç§åŠæ³•ï¼š</p><ol><li>åœ¨è¿™ä¸ªå·ç§¯åŸºä¸Šè·‘æˆ‘ä»¬ç°åœ¨çš„æ•°æ®é›†ï¼Œç„¶åæŠŠç»“æœæ”¾åˆ°ä¸ª Numpy æ•°ç»„é‡Œé¢ï¼Œä¿å­˜åˆ°ç£ç›˜ï¼Œç„¶åä»¥è¿™ä¸ªæ•°ç»„ä¸ºè¾“å…¥ï¼Œæ‰”åˆ°ä¸ªå¯†è¿æ¥çš„ç½‘ç»œé‡Œé¢å»è®­ç»ƒã€‚è¿™ç§åŠæ³•æ¯”è¾ƒç®€å•ï¼Œä¹Ÿåªéœ€è¦è®¡ç®—ä¸€æ¬¡æ¶ˆè€—æœ€å¤§çš„å·ç§¯åŸºéƒ¨åˆ†ã€‚ä½†æ˜¯ï¼Œè¿™ç§åŠæ³•ä¸èƒ½ä½¿ç”¨æ•°æ®å¢å¼ºã€‚</li><li>æ‹“å±• conv_baseï¼Œå¾€å®ƒåé¢åŠ  Dense å±‚ï¼Œç„¶ååœ¨è¾“å…¥æ•°æ®ä¸Šç«¯åˆ°ç«¯è¿è¡Œæ•´ä¸ªç½‘ç»œï¼Œè¿™æ ·å¯ä»¥ä½¿ç”¨æ•°æ®å¢å¼ºï¼Œä½†è®¡ç®—ä»£ä»·æ¯”è¾ƒå¤§ã€‚</li></ol><p>é¦–å…ˆï¼Œæˆ‘ä»¬åšç¬¬ä¸€ç§ã€‚</p><h4 id="ä¸æ•°æ®å¢å¼ºçš„å¿«é€Ÿç‰¹å¾æå–"><a href="#ä¸æ•°æ®å¢å¼ºçš„å¿«é€Ÿç‰¹å¾æå–" class="headerlink" title="ä¸æ•°æ®å¢å¼ºçš„å¿«é€Ÿç‰¹å¾æå–"></a>ä¸æ•°æ®å¢å¼ºçš„å¿«é€Ÿç‰¹å¾æå–</h4><p>é‡è¿°ä¸€èˆ¬ï¼Œè¿™ç§æ–¹æ³•ä¿å­˜æˆ‘ä»¬çš„æ•°æ®é€šè¿‡ conv_base åçš„è¾“å‡ºï¼Œç„¶åå°†è¿™äº›è¾“å‡ºä½œä¸ºè¾“å…¥æ”¾åˆ°ä¸€ä¸ªæ–°æ¨¡å‹é‡Œã€‚</p><p>è¿™é‡Œè¿˜æ˜¯ç”¨ ImageDataGenerator æŠŠå›¾ç‰‡ã€æ ‡ç­¾æå–åˆ° Numpy æ•°ç»„ã€‚ç„¶åè°ƒç”¨ conv_base çš„ predict æ–¹æ³•æ¥ç”¨é¢„è®­ç»ƒæ¨¡å‹æå–ç‰¹å¾ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨é¢„è®­ç»ƒçš„å·ç§¯åŸºæå–ç‰¹å¾</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.preprocessing.image <span class="keyword">import</span> ImageDataGenerator</span><br><span class="line"></span><br><span class="line">base_dir = <span class="string">&#x27;/Volumes/WD/Files/dataset/dogs-vs-cats/cats_and_dogs_small&#x27;</span></span><br><span class="line">train_dir = os.path.join(base_dir, <span class="string">&#x27;train&#x27;</span>)</span><br><span class="line">validation_dir = os.path.join(base_dir, <span class="string">&#x27;validation&#x27;</span>)</span><br><span class="line">test_dir = os.path.join(base_dir, <span class="string">&#x27;test&#x27;</span>)</span><br><span class="line"></span><br><span class="line">datagen = ImageDataGenerator(rescale=<span class="number">1.</span>/<span class="number">255</span>)</span><br><span class="line">batch_size = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">extract_features</span>(<span class="params">directory, sample_count</span>):</span></span><br><span class="line">    features = np.zeros(shape=(sample_count, <span class="number">4</span>, <span class="number">4</span>, <span class="number">512</span>))    <span class="comment"># è¿™ä¸ªè¦ç¬¦åˆä¹‹å‰ conv_base.summary() æœ€åä¸€å±‚çš„è¾“å‡ºçš„å½¢çŠ¶</span></span><br><span class="line">    labels = np.zeros(shape=(sample_count))</span><br><span class="line">    generator = datagen.flow_from_directory(</span><br><span class="line">        directory,</span><br><span class="line">        target_size=(<span class="number">150</span>, <span class="number">150</span>),</span><br><span class="line">        batch_size=batch_size,</span><br><span class="line">        class_mode=<span class="string">&#x27;binary&#x27;</span>)</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> inputs_batch, labels_batch <span class="keyword">in</span> generator:    <span class="comment"># ä¸€æ‰¹ä¸€æ‰¹åŠ æ•°æ®</span></span><br><span class="line">        features_batch = conv_base.predict(inputs_batch)</span><br><span class="line">        features[i * batch_size : (i + <span class="number">1</span>) * batch_size] = features_batch</span><br><span class="line">        labels[i * batch_size : (i + <span class="number">1</span>) * batch_size] = labels_batch</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> i * batch_size &gt;= sample_count:    <span class="comment"># generator ä¼šç”Ÿæˆæ— é™çš„æ•°æ®å“¦ï¼Œbreak è¦è‡ªå·±æ§åˆ¶</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> features, labels</span><br><span class="line"></span><br><span class="line">train_features, train_labels = extract_features(train_dir, <span class="number">2000</span>)</span><br><span class="line">validation_features, validation_labels = extract_features(validation_dir, <span class="number">1000</span>)</span><br><span class="line">test_features, test_labels = extract_features(test_dir, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure><pre><code>Found 2000 images belonging to 2 classes.Found 1000 images belonging to 2 classes.Found 1000 images belonging to 2 classes.</code></pre><p>ä¹‹åæˆ‘ä»¬æ˜¯è¦æ¥å¯†è¿æ¥å±‚çš„åˆ†ç±»å™¨æ¥ç€ï¼Œæ‰€ä»¥è¿™é‡Œå…ˆæŠŠå¼ é‡å‹æ‰äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">train_features = np.reshape(train_features, (<span class="number">2000</span>, <span class="number">4</span> * <span class="number">4</span> * <span class="number">512</span>))</span><br><span class="line">validation_features = np.reshape(validation_features, (<span class="number">1000</span>, <span class="number">4</span> * <span class="number">4</span> * <span class="number">512</span>))</span><br><span class="line">test_features = np.reshape(test_features, (<span class="number">1000</span>, <span class="number">4</span> * <span class="number">4</span> * <span class="number">512</span>))</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯åšå¯†è¿æ¥çš„åˆ†ç±»å™¨äº†ï¼Œè¿˜æ˜¯ç”¨ dropout æ­£åˆ™åŒ–ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> optimizers</span><br><span class="line"></span><br><span class="line">model = models.Sequential()</span><br><span class="line">model.add(layers.Dense(<span class="number">256</span>, activation=<span class="string">&#x27;relu&#x27;</span>, input_dim=<span class="number">4</span> * <span class="number">4</span> * <span class="number">512</span>))</span><br><span class="line">model.add(layers.Dropout(<span class="number">0.5</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>))</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=optimizers.RMSprop(lr=<span class="number">2e-5</span>),</span><br><span class="line">              loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>,</span><br><span class="line">              metrics=[<span class="string">&#x27;acc&#x27;</span>])</span><br><span class="line"></span><br><span class="line">history = model.fit(train_features, train_labels,</span><br><span class="line">                    epochs=<span class="number">30</span>,</span><br><span class="line">                    batch_size=<span class="number">20</span>,</span><br><span class="line">                    validation_data=(validation_features, validation_labels))</span><br></pre></td></tr></table></figure><pre><code>Train on 2000 samples, validate on 1000 samplesEpoch 1/302000/2000 [==============================] - 3s 1ms/sample - loss: 0.5905 - acc: 0.6840 - val_loss: 0.4347 - val_acc: 0.8430Epoch 2/302000/2000 [==============================] - 1s 640us/sample - loss: 0.4339 - acc: 0.8060 - val_loss: 0.3566 - val_acc: 0.8620......Epoch 29/302000/2000 [==============================] - 1s 686us/sample - loss: 0.0928 - acc: 0.9755 - val_loss: 0.2390 - val_acc: 0.9010Epoch 30/302000/2000 [==============================] - 1s 687us/sample - loss: 0.0889 - acc: 0.9715 - val_loss: 0.2401 - val_acc: 0.9010</code></pre><p>çœ‹ç»“æœäº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">acc = history.history[<span class="string">&#x27;acc&#x27;</span>]</span><br><span class="line">val_acc = history.history[<span class="string">&#x27;val_acc&#x27;</span>]</span><br><span class="line">loss = history.history[<span class="string">&#x27;loss&#x27;</span>]</span><br><span class="line">val_loss = history.history[<span class="string">&#x27;val_loss&#x27;</span>]</span><br><span class="line"></span><br><span class="line">epochs = <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(acc) + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">plt.plot(epochs, acc, <span class="string">&#x27;bo-&#x27;</span>, label=<span class="string">&#x27;Training acc&#x27;</span>)</span><br><span class="line">plt.plot(epochs, val_acc, <span class="string">&#x27;rs-&#x27;</span>, label=<span class="string">&#x27;Validation acc&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation accuracy&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">plt.figure()</span><br><span class="line"></span><br><span class="line">plt.plot(epochs, loss, <span class="string">&#x27;bo-&#x27;</span>, label=<span class="string">&#x27;Training loss&#x27;</span>)</span><br><span class="line">plt.plot(epochs, val_loss, <span class="string">&#x27;rs-&#x27;</span>, label=<span class="string">&#x27;Validation loss&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation loss&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh861ydynej30al07cwek.jpg" alt="png"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh862078xaj30af07cglo.jpg" alt="png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ•ˆæœè¿˜æ˜¯å¾ˆä¸é”™çš„æ¥è¿‘ 90% çš„å‡†ç¡®ç‡ã€‚ä½†é—®é¢˜ä¹Ÿè¿˜æ˜¯æœ‰ï¼Œå› ä¸ºæ²¡æœ‰æ•°æ®å¢å¼ºï¼Œè¿‡æ‹Ÿåˆè¿˜æ˜¯ä¸¥é‡çš„ï¼ŒåŸºæœ¬ä»ä¸€å¼€å§‹å°±åœ¨è¿‡æ‹Ÿåˆäº†ã€‚å¯¹è¿™ç§å¤ªå°çš„å›¾ç‰‡æ•°æ®é›†ï¼Œæ²¡æœ‰æ•°æ®å¢å¼ºï¼Œä¸€èˆ¬éƒ½æ˜¯ä¸å¤ªè¡Œçš„ã€‚</p><h4 id="å¸¦æ•°æ®å¢å¼ºçš„ç‰¹å¾æå–"><a href="#å¸¦æ•°æ®å¢å¼ºçš„ç‰¹å¾æå–" class="headerlink" title="å¸¦æ•°æ®å¢å¼ºçš„ç‰¹å¾æå–"></a>å¸¦æ•°æ®å¢å¼ºçš„ç‰¹å¾æå–</h4><p>ç¬¬äºŒç§åŠæ³•ï¼Œæ‹“å±• conv_baseï¼Œå¾€å®ƒåé¢åŠ  Dense å±‚ï¼Œç„¶ååœ¨è¾“å…¥æ•°æ®ä¸Šç«¯åˆ°ç«¯è¿è¡Œæ•´ä¸ªç½‘ç»œã€‚</p><p>è¿™ä¸ªåŠæ³•è®¡ç®—ä»£ä»·éï¼å¸¸ï¼é«˜ï¼ï¼ŒåŸºæœ¬åªèƒ½ç”¨ GPU è·‘ã€‚æ²¡ GPU å°±è¢«ç”¨è¿™ä¸ªäº†ã€‚</p><p>åœ¨ Keras é‡Œï¼Œæˆ‘ä»¬å¯ä»¥åƒæ·»åŠ å±‚ä¸€æ ·æŠŠä¸€ä¸ªæ¨¡å‹æ·»åŠ åˆ° Sequential model é‡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨å·ç§¯åŸºçš„åŸºç¡€ä¸Šæ·»åŠ å¯†é›†è¿æ¥åˆ†ç±»å™¨</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"></span><br><span class="line">model = models.Sequential()</span><br><span class="line">model.add(conv_base)</span><br><span class="line">model.add(layers.Flatten())</span><br><span class="line">model.add(layers.Dense(<span class="number">256</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>))</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹æ¨¡å‹çš„æ ·å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.summary()</span><br></pre></td></tr></table></figure><pre><code>Model: &quot;sequential_1&quot;_________________________________________________________________Layer (type)                 Output Shape              Param #   =================================================================vgg16 (Model)                (None, 4, 4, 512)         14714688  _________________________________________________________________flatten (Flatten)            (None, 8192)              0         _________________________________________________________________dense_2 (Dense)              (None, 256)               2097408   _________________________________________________________________dense_3 (Dense)              (None, 1)                 257       =================================================================Total params: 16,812,353Trainable params: 16,812,353Non-trainable params: 0_________________________________________________________________</code></pre><p>æ³¨æ„ï¼Œåœ¨ç”¨è¿™ç§ç”¨é¢„è®­ç»ƒæ¨¡å‹çš„æ–¹æ³•æ—¶ï¼Œä¸€å®šè¦<strong>å†»ç»“å·ç§¯åŸº</strong>ï¼Œä¹Ÿå°±æ˜¯å‘Šè¯‰ç½‘ç»œï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ç§ä¸è¦å»æ›´æ–°å·ç§¯åŸºçš„å‚æ•°ï¼è¿™ä¸ªå¾ˆé‡è¦ï¼Œä¸è¿™ä¹ˆåšçš„è¯é¢„è®­ç»ƒå¥½çš„æ¨¡å‹å°±ä¼šè¢«ç ´åï¼Œåˆ°å¤´æ¥ç›¸å½“äºä½ æ˜¯ä»å¤´è®­ç»ƒçš„ï¼Œé‚£æ ·å°±å¤±å»ç”¨é¢„è®­ç»ƒçš„æ„ä¹‰äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å†»ç»“å·ç§¯åŸº</span></span><br><span class="line">conv_base.trainable = <span class="literal">False</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·åšä¹‹åï¼Œè®­ç»ƒæ¨¡å‹æ—¶å°±åªä¼šå»ä¸æ–­æ›´æ–° Dense å±‚çš„æƒé‡äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.summary()</span><br></pre></td></tr></table></figure><pre><code>Model: &quot;sequential_1&quot;_________________________________________________________________Layer (type)                 Output Shape              Param #   =================================================================vgg16 (Model)                (None, 4, 4, 512)         14714688  _________________________________________________________________flatten (Flatten)            (None, 8192)              0         _________________________________________________________________dense_2 (Dense)              (None, 256)               2097408   _________________________________________________________________dense_3 (Dense)              (None, 1)                 257       =================================================================Total params: 16,812,353Trainable params: 2,097,665Non-trainable params: 14,714,688_________________________________________________________________</code></pre><p>æ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥ä¸Šæ•°æ®å¢å¼ºï¼Œè®­ç»ƒæ¨¡å‹äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ©ç”¨å†»ç»“çš„å·ç§¯åŸºç«¯åˆ°ç«¯åœ°è®­ç»ƒæ¨¡å‹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.preprocessing.image <span class="keyword">import</span> ImageDataGenerator</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> optimizers</span><br><span class="line"></span><br><span class="line">train_datagen = ImageDataGenerator(</span><br><span class="line">    rescale=<span class="number">1.</span>/<span class="number">255</span>,</span><br><span class="line">    rotation_range=<span class="number">40</span>,</span><br><span class="line">    width_shift_range=<span class="number">0.2</span>,</span><br><span class="line">    height_shift_range=<span class="number">0.2</span>,</span><br><span class="line">    shear_range=<span class="number">0.2</span>,</span><br><span class="line">    zoom_range=<span class="number">0.2</span>,</span><br><span class="line">    horizontal_flip=<span class="literal">True</span>,</span><br><span class="line">    fill_mode=<span class="string">&#x27;nearest&#x27;</span>)</span><br><span class="line"></span><br><span class="line">test_datagen = ImageDataGenerator(rescale=<span class="number">1.</span>/<span class="number">255</span>)    <span class="comment"># æ³¨æ„ test ä¸å¢å¼º</span></span><br><span class="line"></span><br><span class="line">train_generator = train_datagen.flow_from_directory(</span><br><span class="line">    train_dir,</span><br><span class="line">    target_size=(<span class="number">150</span>, <span class="number">150</span>),</span><br><span class="line">    batch_size=<span class="number">20</span>,</span><br><span class="line">    class_mode=<span class="string">&#x27;binary&#x27;</span>)</span><br><span class="line"></span><br><span class="line">validation_generator = test_datagen.flow_from_directory(</span><br><span class="line">    validation_dir,</span><br><span class="line">    target_size=(<span class="number">150</span>, <span class="number">150</span>),</span><br><span class="line">    batch_size=<span class="number">20</span>,</span><br><span class="line">    class_mode=<span class="string">&#x27;binary&#x27;</span>)</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>,</span><br><span class="line">              optimizer=optimizers.RMSprop(lr=<span class="number">2e-5</span>),</span><br><span class="line">              metrics=[<span class="string">&#x27;acc&#x27;</span>])</span><br><span class="line"></span><br><span class="line">history = model.fit_generator(</span><br><span class="line">    train_generator,</span><br><span class="line">    steps_per_epoch=<span class="number">100</span>,</span><br><span class="line">    epochs=<span class="number">30</span>,</span><br><span class="line">    validation_data=validation_generator,</span><br><span class="line">    validation_steps=<span class="number">50</span>)</span><br></pre></td></tr></table></figure><p>P.S. è¿™ä¸ªåœ¨æˆ‘çš„ CPU ä¸Šè·‘ï¼Œä¸€è½®å¤§æ¦‚è¦15åˆ†é’Ÿï¼Œ30è½®ï¼Œï¼Œæˆ‘æ”¾å¼ƒäº†ã€‚æˆ‘ç”¨ Kaggle è·‘äº†è¿™ä¸ªï¼Œä¸€è½®æ‰30ç§’ğŸ˜­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Found 2000 images belonging to 2 classes.</span><br><span class="line">Found 1000 images belonging to 2 classes.</span><br><span class="line">Epoch 1&#x2F;30</span><br><span class="line">100&#x2F;100 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 30s 300ms&#x2F;step - loss: 0.5984 - acc: 0.6855 - val_loss: 0.4592 - val_acc: 0.8250</span><br><span class="line">Epoch 2&#x2F;30</span><br><span class="line">100&#x2F;100 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 30s 302ms&#x2F;step - loss: 0.4854 - acc: 0.7815 - val_loss: 0.3660 - val_acc: 0.8710</span><br><span class="line">......</span><br><span class="line">Epoch 29&#x2F;30</span><br><span class="line">100&#x2F;100 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 30s 300ms&#x2F;step - loss: 0.2774 - acc: 0.8825 - val_loss: 0.2402 - val_acc: 0.9040</span><br><span class="line">Epoch 30&#x2F;30</span><br><span class="line">100&#x2F;100 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 30s 302ms&#x2F;step - loss: 0.2693 - acc: 0.8900 - val_loss: 0.2401 - val_acc: 0.9070</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh5lk985mvj30m60vqtcp.jpg" alt="è¿è¡Œç»“æœå›¾"></p><h3 id="Fine-tuning-å¾®è°ƒæ¨¡å‹"><a href="#Fine-tuning-å¾®è°ƒæ¨¡å‹" class="headerlink" title="Fine-tuning å¾®è°ƒæ¨¡å‹"></a>Fine-tuning å¾®è°ƒæ¨¡å‹</h3><p>ï¼ˆæˆ‘æ¯”è¾ƒå–œæ¬¢ Fine-tuning è¿™ä¸ªè¯ï¼Œâ€œå¾®è°ƒâ€åè€Œæ²¡å†…å‘³å„¿äº†ã€‚ï¼‰</p><p>Fine-tuning æ˜¯è¡¥å……ç‰¹å¾æå–ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–æ¨¡å‹çš„ã€‚Fine-tuning åšçš„æ˜¯å°†å·ç§¯åŸºé¡¶éƒ¨(é åé¢çš„)çš„å‡ å±‚<strong>è§£å†»</strong>ï¼ŒæŠŠè§£å†»çš„å‡ å±‚å’Œæ–°å¢åŠ çš„éƒ¨åˆ†(å…¨è¿æ¥åˆ†ç±»å™¨)è”åˆè®­ç»ƒã€‚è¿™ä¸ªæ–¹æ³•ç¨å¾®è°ƒæ•´äº†é¢„è®­ç»ƒæ¨¡å‹é‡Œé¢é‚£äº›é«˜çº§æŠ½è±¡çš„è¡¨ç¤º(ä¹Ÿå°±æ˜¯é‚£äº›æ¥è¿‘é¡¶å±‚çš„)ï¼Œä½¿ä¹‹æ›´é€‚åˆæˆ‘ä»¬æ‰‹å¤´çš„é—®é¢˜ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh5nq823wfj30ik0t0tbf.jpg" alt="Fine-tuning ç¤ºæ„å›¾ï¼Œå¾®è°ƒäº† VGG16 çš„æœ€åä¸€ä¸ªå·ç§¯å—"></p><p>æ³¨æ„ï¼Œå¿…é¡»å…ˆæŠŠæœ€åçš„å…¨è¿æ¥åˆ†ç±»å™¨è®­ç»ƒå¥½ï¼Œæ‰èƒ½å» Fine-tune å·ç§¯åŸºé¡¶éƒ¨çš„ Conv å—ï¼Œä¸ç„¶å°±ä¼šæŠŠé¢„è®­ç»ƒçš„æˆæœå®Œå…¨ç ´åè°ƒã€‚</p><p>æ‰€ä»¥ï¼ŒFine-tuning éœ€è¦æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li>åœ¨å·²ç»è®­ç»ƒå¥½çš„ç½‘ç»œ(base networkï¼ŒåŸºç½‘ç»œ)ä¸Šæ·»åŠ æˆ‘ä»¬è‡ªå·±çš„ç½‘ç»œ(æ¯”å¦‚åˆ†ç±»å™¨);</li><li>å†»ç»“åŸºç½‘ç»œ;</li><li>è®­ç»ƒè‡ªå·±æ·»åŠ çš„é‚£ä¸€éƒ¨åˆ†;</li><li>è§£å†»åŸºç½‘ç»œçš„éƒ¨åˆ†å±‚;</li><li>è”åˆè®­ç»ƒè§£å†»çš„å±‚å’Œè‡ªå·±çš„é‚£éƒ¨åˆ†;</li></ol><p>å‰ä¸‰æ­¥éƒ½å’Œç‰¹å¾æå–åšçš„æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»ç¬¬å››æ­¥å¼€å§‹ã€‚é¦–å…ˆå†çœ‹ä¸€ä¸‹æˆ‘ä»¬çš„ VGG16 å·ç§¯åŸºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conv_base.summary()</span><br></pre></td></tr></table></figure><pre><code>Model: &quot;vgg16&quot;_________________________________________________________________Layer (type)                 Output Shape              Param #   =================================================================input_1 (InputLayer)         [(None, 150, 150, 3)]     0         _________________________________________________________________block1_conv1 (Conv2D)        (None, 150, 150, 64)      1792      _________________________________________________________________block1_conv2 (Conv2D)        (None, 150, 150, 64)      36928     _________________________________________________________________block1_pool (MaxPooling2D)   (None, 75, 75, 64)        0         _________________________________________________________________block2_conv1 (Conv2D)        (None, 75, 75, 128)       73856     _________________________________________________________________block2_conv2 (Conv2D)        (None, 75, 75, 128)       147584    _________________________________________________________________block2_pool (MaxPooling2D)   (None, 37, 37, 128)       0         _________________________________________________________________block3_conv1 (Conv2D)        (None, 37, 37, 256)       295168    _________________________________________________________________block3_conv2 (Conv2D)        (None, 37, 37, 256)       590080    _________________________________________________________________block3_conv3 (Conv2D)        (None, 37, 37, 256)       590080    _________________________________________________________________block3_pool (MaxPooling2D)   (None, 18, 18, 256)       0         _________________________________________________________________block4_conv1 (Conv2D)        (None, 18, 18, 512)       1180160   _________________________________________________________________block4_conv2 (Conv2D)        (None, 18, 18, 512)       2359808   _________________________________________________________________block4_conv3 (Conv2D)        (None, 18, 18, 512)       2359808   _________________________________________________________________block4_pool (MaxPooling2D)   (None, 9, 9, 512)         0         _________________________________________________________________block5_conv1 (Conv2D)        (None, 9, 9, 512)         2359808   _________________________________________________________________block5_conv2 (Conv2D)        (None, 9, 9, 512)         2359808   _________________________________________________________________block5_conv3 (Conv2D)        (None, 9, 9, 512)         2359808   _________________________________________________________________block5_pool (MaxPooling2D)   (None, 4, 4, 512)         0         =================================================================Total params: 14,714,688Trainable params: 0Non-trainable params: 14,714,688_________________________________________________________________</code></pre><p>æˆ‘ä»¬å°†è§£å†» block5_conv1, block5_conv2 å’Œ block5_conv3 æ¥å®Œæˆ Fine-turningï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å†»ç»“ç›´åˆ°æŸä¸€å±‚çš„æ‰€æœ‰å±‚</span></span><br><span class="line"></span><br><span class="line">conv_base.trainable = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">set_trainable = <span class="literal">False</span></span><br><span class="line"><span class="keyword">for</span> layer <span class="keyword">in</span> conv_base.layers:</span><br><span class="line">    <span class="keyword">if</span> layer.name == <span class="string">&#x27;block5_conv1&#x27;</span>:</span><br><span class="line">        set_trainable = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">if</span> set_trainable:</span><br><span class="line">        layer.trainable = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        layer.trainable = <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line"><span class="comment"># å¾®è°ƒæ¨¡å‹</span></span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>,</span><br><span class="line">              optimizer=optimizers.RMSprop(lr=<span class="number">1e-5</span>),    <span class="comment"># è¿™é‡Œç”¨çš„å­¦ä¹ ç‡(lr)å¾ˆå°ï¼Œæ˜¯å¸Œæœ›è®©å¾®è°ƒçš„ä¸‰å±‚è¡¨ç¤ºå˜åŒ–èŒƒå›´ä¸è¦å¤ªå¤§</span></span><br><span class="line">              metrics=[<span class="string">&#x27;acc&#x27;</span>])</span><br><span class="line"></span><br><span class="line">history = model.fit_generator(</span><br><span class="line">    train_generator,</span><br><span class="line">    steps_per_epoch=<span class="number">100</span>,</span><br><span class="line">    epochs=<span class="number">100</span>,</span><br><span class="line">    validation_data=validation_generator,</span><br><span class="line">    validation_steps=<span class="number">50</span>)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¹Ÿæ˜¯åœ¨ Kaggle è·‘çš„ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh6fkf1r4hj31jw0gaq87.jpg" alt="åœ¨ Kaggle è®­ç»ƒçš„æœ€åå‡ è½®è¾“å‡º"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh6flamoy7j30o60wkdl5.jpg" alt="è®­ç»ƒå†å²å›¾çº¿"></p><p>æˆ‘ä¸çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘åšå‡ºæ¥çš„å’Œä¹¦ä¸Šå·®è·å¾ˆå¤§ï¼Œæˆ‘åå¤çœ‹äº†å¥½è¿‡é”™éƒ½æ²¡å‘ç°æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå³ä½¿æˆ‘ç”¨ä½œè€…ç»™çš„ Notebook æ¥è·‘ä¹Ÿæ˜¯ğŸ˜‚ï¼Œä¸çŸ¥é“å“ªé‡Œå‡ºé—®é¢˜äº†ã€‚ä¸ç®¡äº†ï¼Ÿå°±è¿™æ ·å§ã€‚</p><p>æœ€åï¼Œæ¥çœ‹çœ‹åœ¨æµ‹è¯•é›†ä¸Šçš„ç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">test_generator = test_datagen.flow_from_directory(</span><br><span class="line">        test_dir,</span><br><span class="line">        target_size=(<span class="number">150</span>, <span class="number">150</span>),</span><br><span class="line">        batch_size=<span class="number">20</span>,</span><br><span class="line">        class_mode=<span class="string">&#x27;binary&#x27;</span>)</span><br><span class="line">test_loss, test_acc = model.evaluate_generator(test_generator, steps=<span class="number">50</span>)</span><br><span class="line">print(<span class="string">&#x27;test acc:&#x27;</span>, test_acc)</span><br></pre></td></tr></table></figure><p>ä¹¦ä¸Šçš„ç»“æœå‡†ç¡®ç‡æœ‰ 97% äº†ï¼Œï¼Œæˆ‘ï¼Œæˆ‘çš„è¿˜ä¸åˆ° 95%ï¼Œå®³ã€‚</p><h2 id="å·ç§¯ç¥ç»ç½‘ç»œçš„å¯è§†åŒ–"><a href="#å·ç§¯ç¥ç»ç½‘ç»œçš„å¯è§†åŒ–" class="headerlink" title="å·ç§¯ç¥ç»ç½‘ç»œçš„å¯è§†åŒ–"></a>å·ç§¯ç¥ç»ç½‘ç»œçš„å¯è§†åŒ–</h2><blockquote><p>5.4 Visualizing what convnets learn</p></blockquote><p>æˆ‘ä»¬å¸¸è¯´æ·±åº¦å­¦ä¹ æ˜¯é»‘ç®±ï¼Œæˆ‘ä»¬å¾ˆéš¾ä»å…¶å­¦ä¹ çš„è¿‡ç¨‹ä¸­æå–å‡º human-readable çš„è¡¨ç¤ºã€‚ä½†æ˜¯ï¼Œåšè®¡ç®—æœºè§†è§‰çš„å·ç§¯ç¥ç»ç½‘ç»œä¸æ˜¯è¿™æ ·ï¼Œå·ç§¯ç¥ç»ç½‘ç»œæ˜¯èƒ½å¯è§†åŒ–çš„ï¼Œæˆ‘ä»¬çœ‹å¾—æ‡‚çš„ï¼Œå› ä¸ºå·ç§¯ç¥ç»ç½‘ç»œæœ¬æ¥å°±æ˜¯æå–â€œè§†è§‰æ¦‚å¿µçš„è¡¨ç¤ºâ€çš„å˜›ã€‚</p><p>ç°åœ¨å·²ç»æœ‰å¾ˆå¤šç§ä¸åŒçš„æ–¹æ³•å¯ä»¥ä»ä¸åŒè§’åº¦æŠŠå·ç§¯ç¥ç»ç½‘ç»œå¯è§†åŒ–ï¼Œå¹¶åˆç†è§£é‡Šå…¶æ„ä¹‰ã€‚ä¸‹é¢ä»‹ç»å…¶ä¸­å‡ ç§ã€‚</p><h3 id="å¯è§†åŒ–ä¸­é—´æ¿€æ´»"><a href="#å¯è§†åŒ–ä¸­é—´æ¿€æ´»" class="headerlink" title="å¯è§†åŒ–ä¸­é—´æ¿€æ´»"></a>å¯è§†åŒ–ä¸­é—´æ¿€æ´»</h3><p><strong>å¯è§†åŒ–ä¸­é—´æ¿€æ´»</strong>ï¼ˆVisualizing intermediate activationsï¼‰ï¼Œä¹Ÿå°±æ˜¯å¯è§†åŒ–å·ç§¯ç¥ç»ç½‘ç»œçš„ä¸­é—´è¾“å‡ºã€‚è¿™ä¸ªå¯è§†åŒ–å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†è§£ä¸€ç³»åˆ—è¿ç»­å¾—å¤šå·ç§¯å±‚æ˜¯å¦‚ä½•å˜æ¢å¤„ç†è¾“å…¥æ•°æ®çš„ã€ä»¥åŠæ¯ä¸ªè¿‡æ»¤å™¨çš„åŸºæœ¬æ„ä¹‰ã€‚</p><p>è¿™ä¸ªå…¶å®å°±æ˜¯æŠŠå·ç§¯/æ± åŒ–å±‚è¾“å‡ºçš„ feature maps æ˜¾ç¤ºå‡ºæ¥çœ‹çœ‹ï¼ˆå±‚çš„è¾“å‡ºä¹Ÿå¯ä»¥å«åš activationï¼Œæ¿€æ´»ï¼‰ã€‚å…·ä½“çš„åšæ³•å°±æ˜¯æŠŠè¾“å‡ºçš„å„ä¸ª channel éƒ½åšæˆäºŒç»´çš„å›¾åƒæ˜¾ç¤ºå‡ºæ¥çœ‹ã€‚</p><p>æˆ‘ä»¬ç”¨ä¸€ä¸ªä¹‹å‰ç”Ÿæˆçš„æ¨¡å‹æ¥ä½œä¸ºä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> load_model</span><br><span class="line"></span><br><span class="line">model = load_model(<span class="string">&#x27;/Volumes/WD/Files/dataset/dogs-vs-cats/cats_and_dogs_small_2.h5&#x27;</span>)</span><br><span class="line">model.summary()</span><br></pre></td></tr></table></figure><pre><code>Model: &quot;sequential_5&quot;_________________________________________________________________Layer (type)                 Output Shape              Param #   =================================================================conv2d_20 (Conv2D)           (None, 148, 148, 32)      896       _________________________________________________________________max_pooling2d_20 (MaxPooling (None, 74, 74, 32)        0         _________________________________________________________________conv2d_21 (Conv2D)           (None, 72, 72, 64)        18496     _________________________________________________________________max_pooling2d_21 (MaxPooling (None, 36, 36, 64)        0         _________________________________________________________________conv2d_22 (Conv2D)           (None, 34, 34, 128)       73856     _________________________________________________________________max_pooling2d_22 (MaxPooling (None, 17, 17, 128)       0         _________________________________________________________________conv2d_23 (Conv2D)           (None, 15, 15, 128)       147584    _________________________________________________________________max_pooling2d_23 (MaxPooling (None, 7, 7, 128)         0         _________________________________________________________________flatten_5 (Flatten)          (None, 6272)              0         _________________________________________________________________dropout (Dropout)            (None, 6272)              0         _________________________________________________________________dense_10 (Dense)             (None, 512)               3211776   _________________________________________________________________dense_11 (Dense)             (None, 1)                 513       =================================================================Total params: 3,453,121Trainable params: 3,453,121Non-trainable params: 0_________________________________________________________________</code></pre><p>ç„¶åæˆ‘ä»¬æ‰¾ä¸€å¼ è®­ç»ƒçš„æ—¶å€™ç½‘ç»œæ²¡è§è¿‡çš„å›¾ç‰‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">img_path = <span class="string">&#x27;/Volumes/WD/Files/dataset/dogs-vs-cats/cats_and_dogs_small/test/cats/cat.1750.jpg&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.preprocessing <span class="keyword">import</span> image    <span class="comment"># æŠŠå›¾ç‰‡ææˆ 4D å¼ é‡</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">img = image.load_img(img_path, target_size=(<span class="number">150</span>, <span class="number">150</span>))</span><br><span class="line">img_tensor = image.img_to_array(img)</span><br><span class="line">img_tensor = np.expand_dims(img_tensor, axis=<span class="number">0</span>)</span><br><span class="line">img_tensor /= <span class="number">255.</span></span><br><span class="line"></span><br><span class="line">print(img_tensor.shape)</span><br></pre></td></tr></table></figure><pre><code>(1, 150, 150, 3)</code></pre><p>æ˜¾ç¤ºå›¾ç‰‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">plt.imshow(img_tensor[<span class="number">0</span>])</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh8669nh8uj3079070js1.jpg" alt="png"></p><p>è¦æå–ç‰¹å¾å›¾ï¼Œå°±è¦ç”¨ä¸€ä¸ªè¾“å…¥å¼ é‡å’Œä¸€ä¸ªè¾“å‡ºå¼ é‡åˆ—è¡¨æ¥å®ä¾‹åŒ–ä¸€ä¸ªæ¨¡å‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line">layer_outputs = [layer.output <span class="keyword">for</span> layer <span class="keyword">in</span> model.layers[:<span class="number">8</span>]]    <span class="comment"># æå–å‰ 8 å±‚çš„è¾“å‡º</span></span><br><span class="line">activation_model = models.Model(inputs=model.<span class="built_in">input</span>, outputs=layer_outputs)</span><br></pre></td></tr></table></figure><p>å½“è¾“å…¥ä¸€å¼ å›¾åƒæ—¶ï¼Œè¿™ä¸ªæ¨¡å‹å°±ä¼šè¿”å›åŸå§‹æ¨¡å‹å‰ 8 å±‚çš„æ¿€æ´»å€¼ã€‚æˆ‘ä»¬ä¹‹å‰çš„æ¨¡å‹éƒ½æ˜¯ç»™ä¸€ä¸ªè¾“å…¥ï¼Œè¿”ä¸€ä¸ªè¾“å‡ºçš„ï¼Œä½†å…¶å®ä¸€ä¸ªæ¨¡å‹æ˜¯å¯ä»¥ç»™ä»»æ„ä¸ªè¾“å…¥ï¼Œè¿”ä»»æ„ä¸ªè¾“å‡ºçš„ã€‚</p><p>æ¥ä¸‹æ¥åœ¨æŠŠåˆšæ‰æ‰¾çš„å›¾ç‰‡è¾“å…¥è¿›å»ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">activations = activation_model.predict(img_tensor)</span><br><span class="line"><span class="comment"># è¿”å› 8 ä¸ª Numpy æ•°ç»„ç»„æˆçš„åˆ—è¡¨ï¼Œæ¯å±‚ä¸€ä¸ªï¼Œé‡Œé¢æ”¾ç€æ¿€æ´»</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">first_layer_activation = activations[<span class="number">0</span>]</span><br><span class="line">print(first_layer_activation.shape)</span><br></pre></td></tr></table></figure><pre><code>(1, 148, 148, 32)</code></pre><p>è¿™ä¸œè¥¿æœ‰ 32 ä¸ª channelï¼Œæˆ‘ä»¬éšä¾¿æ‰“ä¸€ä¸ªå‡ºæ¥çœ‹çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†ç¬¬ 4 ä¸ª channel å¯è§†åŒ–</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">plt.matshow(first_layer_activation[<span class="number">0</span>, :, :, <span class="number">4</span>], cmap=<span class="string">&#x27;viridis&#x27;</span>)</span><br></pre></td></tr></table></figure><pre><code>&lt;matplotlib.image.AxesImage at 0x13f7b3d10&gt;</code></pre><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh8676bpw7j307f076wex.jpg" alt="png"></p><p>è¿™ä¸ªæ¯ä¸ª channel æ˜¯å¹²å˜›çš„åŸºæœ¬æ˜¯éšæœºçš„ï¼Œæˆ‘è¿™ä¸ªå°±å’Œä¹¦ä¸Šä¸ä¸€æ ·ã€‚</p><p>ä¸‹é¢ï¼Œæ¥ç»˜åˆ¶æ•´ä¸ªç½‘ç»œä¸­å®Œæ•´çš„ã€æ‰€æœ‰æ¿€æ´»çš„å¯è§†åŒ–ã€‚æˆ‘ä»¬å°† 8 ä¸ª feature mapsï¼Œæ¯ä¸ªå…¶ä¸­çš„æ‰€æœ‰ channels ç”»å‡ºæ¥äº†ï¼Œæ’åˆ°ä¸€å¼ å¤§å›¾ä¸Šï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†æ¯ä¸ªä¸­é—´æ¿€æ´»çš„æ‰€æœ‰é€šé“å¯è§†åŒ–</span></span><br><span class="line"></span><br><span class="line">layer_names = []</span><br><span class="line"><span class="keyword">for</span> layer <span class="keyword">in</span> model.layers[:<span class="number">8</span>]:</span><br><span class="line">    layer_names.append(layer.name)</span><br><span class="line">    </span><br><span class="line">images_per_row = <span class="number">16</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> layer_name, layer_activation <span class="keyword">in</span> <span class="built_in">zip</span>(layer_names, activations):</span><br><span class="line">    <span class="comment"># å¯¹äºæ¯ä¸ª layer_activationï¼Œå…¶å½¢çŠ¶ä¸º (1, size, size, n_features)</span></span><br><span class="line">    n_features = layer_activation.shape[-<span class="number">1</span>]    <span class="comment"># ç‰¹å¾å›¾é‡Œç‰¹å¾(channel)çš„ä¸ªæ•°</span></span><br><span class="line">    </span><br><span class="line">    size = layer_activation.shape[<span class="number">1</span>]    <span class="comment"># å›¾çš„å¤§å°</span></span><br><span class="line">    </span><br><span class="line">    n_cols = n_features // images_per_row</span><br><span class="line">    display_grid = np.zeros((size * n_cols, images_per_row * size))    <span class="comment"># åˆ†æ ¼</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(n_cols):</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(images_per_row):</span><br><span class="line">            channel_image = layer_activation[<span class="number">0</span>, :, :, col * images_per_row + row]</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># æŠŠå›¾ç‰‡æå¥½çœ‹ä¸€ç‚¹</span></span><br><span class="line">            channel_image -= channel_image.mean()</span><br><span class="line">            channel_image /= channel_image.std()</span><br><span class="line">            channel_image *= <span class="number">64</span></span><br><span class="line">            channel_image += <span class="number">128</span></span><br><span class="line">            channel_image = np.clip(channel_image, <span class="number">0</span>, <span class="number">255</span>).astype(<span class="string">&#x27;uint8&#x27;</span>)</span><br><span class="line">            display_grid[col * size : (col + <span class="number">1</span>) * size,</span><br><span class="line">                         row * size : (row + <span class="number">1</span>) * size] = channel_image</span><br><span class="line"></span><br><span class="line">    scale = <span class="number">1.</span> / size</span><br><span class="line">    plt.figure(figsize=(scale * display_grid.shape[<span class="number">1</span>], </span><br><span class="line">                        scale * display_grid.shape[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line">    plt.title(layer_name)</span><br><span class="line">    plt.grid(<span class="literal">False</span>)</span><br><span class="line">    plt.imshow(display_grid, aspect=<span class="string">&#x27;auto&#x27;</span>, cmap=<span class="string">&#x27;viridis&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><pre><code>/usr/local/lib/python3.7/site-packages/ipykernel_launcher.py:24: RuntimeWarning: invalid value encountered in true_divide</code></pre><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh866jmct8j30q004c40i.jpg" alt="png"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh8674iooxj30q004cdhw.jpg" alt="png"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh866chv4nj30q007cdjl.jpg" alt="png"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh866c10xej30q007cgpf.jpg" alt="png"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh866ewppaj30q00dejxf.jpg" alt="png"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh8666s9lfj30q00den33.jpg" alt="png"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh866djarhj30q00dejul.jpg" alt="png"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh866go1kzj30pu0dewhm.jpg" alt="png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œç‰¹å¾è¶Šæ¥è¶ŠæŠ½è±¡ã€‚åŒæ—¶ï¼Œé»‘çš„ä¹Ÿè¶Šæ¥è¶Šå¤šï¼ˆç¨€ç–åº¦è¶Šæ¥è¶Šå¤§ï¼‰ï¼Œé‚£äº›éƒ½æ˜¯è¾“å…¥å›¾åƒä¸­æ‰¾ä¸åˆ°è¿™äº›è¿‡æ»¤å™¨æ‰€ç¼–ç çš„æ¨¡å¼ï¼Œæ‰€ä»¥å°±ç©ºç™½äº†ã€‚</p><p>è¿™é‡Œè¡¨ç°å‡ºæ¥ä¸€ä¸ªé‡è¦æ™®éç‰¹å¾ï¼šéšç€å±‚æ•°çš„åŠ æ·±ï¼Œå±‚æ‰€æå–çš„ç‰¹å¾å˜å¾—è¶Šæ¥è¶ŠæŠ½è±¡ã€‚æ›´é«˜çš„å±‚æ¿€æ´»åŒ…å«å…³äºç‰¹å®šè¾“å…¥çš„ä¿¡æ¯è¶Šæ¥è¶Šå°‘ï¼Œè€Œå…³äºç›®æ ‡çš„ä¿¡æ¯è¶Šæ¥è¶Šå¤šã€‚</p><p>ä¸äººç±»å’ŒåŠ¨ç‰©æ„ŸçŸ¥ä¸–ç•Œçš„æ–¹å¼ç±»ä¼¼ï¼šäººç±»è§‚å¯Ÿä¸€ä¸ªåœºæ™¯å‡ ç§’é’Ÿåï¼Œå¯ä»¥è®°ä½å…¶ä¸­æœ‰å“ªäº›æŠ½è±¡ç‰©ä½“(æ¯”å¦‚è‡ªè¡Œè½¦ã€æ ‘)ï¼Œä½†è®°ä¸ä½è¿™äº›ç‰©ä½“çš„å…·ä½“å¤–è§‚ã€‚ä½ çš„å¤§è„‘ä¼šè‡ªåŠ¨å°†è§†è§‰è¾“å…¥å®Œå…¨æŠ½è±¡åŒ–ï¼Œå³å°†å…¶è½¬æ¢ä¸ºæ›´é«˜å±‚æ¬¡çš„è§†è§‰æ¦‚å¿µï¼ŒåŒæ—¶è¿‡æ»¤æ‰ä¸ç›¸å…³çš„è§†è§‰ç»†èŠ‚ã€‚</p><p>æ·±åº¦ç¥ç»ç½‘ç»œåˆ©ç”¨ä¿¡æ¯è’¸é¦ç®¡é“ (information distillation pipeline)ï¼Œå°†è¾“å…¥åŸå§‹æ•°æ®(æœ¬ä¾‹ä¸­æ˜¯ RGB å›¾åƒ)ï¼Œåå¤è¿›è¡Œå˜æ¢ï¼Œå°†æ— å…³ä¿¡æ¯è¿‡æ»¤æ‰(æ¯”å¦‚å›¾åƒçš„å…·ä½“å¤–è§‚)ï¼Œå¹¶æ”¾å¤§å’Œç»†åŒ–æœ‰ç”¨çš„ä¿¡æ¯(æ¯”å¦‚å›¾åƒçš„ç±»åˆ«)ï¼Œæœ€ç»ˆå®Œæˆå¯¹ä¿¡æ¯çš„åˆ©ç”¨ï¼ˆæ¯”å¦‚åˆ¤æ–­å‡ºå›¾ç‰‡æ˜¯çŒ«è¿˜æ˜¯ç‹—ï¼‰ã€‚</p><h3 id="å¯è§†åŒ–å·ç§¯ç¥ç»ç½‘ç»œçš„è¿‡æ»¤å™¨"><a href="#å¯è§†åŒ–å·ç§¯ç¥ç»ç½‘ç»œçš„è¿‡æ»¤å™¨" class="headerlink" title="å¯è§†åŒ–å·ç§¯ç¥ç»ç½‘ç»œçš„è¿‡æ»¤å™¨"></a>å¯è§†åŒ–å·ç§¯ç¥ç»ç½‘ç»œçš„è¿‡æ»¤å™¨</h3><p><strong>å¯è§†åŒ–å·ç§¯ç¥ç»ç½‘ç»œçš„è¿‡æ»¤å™¨</strong>ï¼ˆVisualizing convnets filtersï¼‰ï¼Œå¸®åŠ©ç†è§£å„ä¸ªè¿‡æ»¤å™¨å–„äºæ¥å—ä»€ä¹ˆæ ·çš„è§†è§‰æ¨¡å¼(patternï¼Œæˆ‘è§‰å¾—â€œæ¨¡å¼â€è¿™ä¸ªè¯å¹¶ä¸èƒ½å¾ˆå¥½çš„è¯ é‡Š pattern çš„æ„æ€)æˆ–æ¦‚å¿µã€‚</p><p>è¦è§‚å¯Ÿå·ç§¯ç¥ç»ç½‘ç»œå­¦åˆ°çš„è¿‡æ»¤å™¨ï¼Œæˆ‘ä»¬å¯ä»¥æ˜¾ç¤ºæ¯ä¸ªè¿‡æ»¤å™¨æ‰€å“åº”çš„è§†è§‰æ¨¡å¼ã€‚è¿™ä¸ªå¯ä»¥åœ¨è¾“å…¥ç©ºé—´ä¸Šç”¨ gradient ascentï¼ˆæ¢¯åº¦ä¸Šå‡ï¼‰æ¥å®ç°ï¼š</p><p>ä¸ºäº†ä»ç©ºç™½è¾“å…¥å›¾åƒå¼€å§‹ï¼Œè®©æŸä¸ªè¿‡æ»¤å™¨çš„å“åº”æœ€å¤§åŒ–ï¼Œå¯ä»¥å°†æ¢¯åº¦ä¸‹é™åº”ç”¨äºå·ç§¯ç¥ç»ç½‘ç»œè¾“å…¥å›¾åƒçš„å€¼ã€‚å¾—åˆ°çš„è¾“å…¥å›¾åƒå³ä¸ºå¯¹è¿‡æ»¤å™¨å…·æœ‰æœ€å¤§å“åº”çš„å›¾åƒã€‚</p><p>è¿™ä¸ªåšèµ·æ¥å¾ˆç®€å•ï¼Œæ„å»ºä¸€ä¸ªæŸå¤±å‡½æ•°ï¼Œå…¶ç›®çš„æ˜¯è®©æŸä¸ªå·ç§¯å±‚çš„æŸä¸ªè¿‡æ»¤å™¨çš„å€¼æœ€å¤§åŒ–ã€‚ç„¶åï¼Œä½¿ç”¨éšæœºæ¢¯åº¦ä¸‹é™æ¥è°ƒèŠ‚è¾“å…¥å›¾åƒçš„å€¼ï¼Œä½¿ä¹‹æ¿€æ´»å€¼æœ€å¤§åŒ–ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨ ImageNet ä¸Šé¢„è®­ç»ƒçš„ VGG16 ç½‘ç»œçš„ block3_conv1 å±‚ç¬¬ 0 ä¸ªè¿‡æ»¤å™¨æ¿€æ´»çš„æŸå¤±å°±æ˜¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.applications <span class="keyword">import</span> VGG16</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> backend <span class="keyword">as</span> K</span><br><span class="line"></span><br><span class="line">model = VGG16(weights=<span class="string">&#x27;imagenet&#x27;</span>, include_top=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">layer_name = <span class="string">&#x27;block3_conv1&#x27;</span></span><br><span class="line">filter_index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">layer_output = model.get_layer(layer_name).output</span><br><span class="line">loss = K.mean(layer_output[:, :, :, filter_index])</span><br><span class="line"></span><br><span class="line">print(loss)</span><br></pre></td></tr></table></figure><pre><code>Tensor(&quot;Mean_11:0&quot;, shape=(), dtype=float32)</code></pre><p>è¦åšæ¢¯åº¦ä¸‹é™å˜›ï¼Œæ‰€ä»¥è¦å¾—åˆ° loss ç›¸å¯¹äºæ¨¡å‹è¾“å…¥çš„æ¢¯åº¦ã€‚ç”¨ Keras çš„ backend çš„ gradients å‡½æ•°æ¥å®Œæˆè¿™ä¸ªï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line">tf.compat.v1.disable_eager_execution()  <span class="comment"># See https://github.com/tensorflow/tensorflow/issues/33135</span></span><br><span class="line"></span><br><span class="line">grads = K.gradients(loss, model.<span class="built_in">input</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># è¿™ä¸œè¥¿è¿”å›çš„æ˜¯ä¸€ä¸ªè£…ç€ä¸€ç³»åˆ—å¼ é‡çš„ listï¼Œåœ¨æ­¤å¤„ï¼Œlist é•¿åº¦ä¸º1ï¼Œæ‰€ä»¥å– [0] å°±æ˜¯ä¸€ä¸ªå¼ é‡</span></span><br><span class="line">print(grads)</span><br></pre></td></tr></table></figure><pre><code>Tensor(&quot;gradients_1/block1_conv1_4/Conv2D_grad/Conv2DBackpropInput:0&quot;, shape=(None, None, None, 3), dtype=float32)</code></pre><p>è¿™é‡Œå¯ä»¥ç”¨ä¸€ä¸ªå°æŠ€å·§æ¥è®©æ¢¯åº¦ä¸‹é™è¿‡ç¨‹å¹³é¡ºåœ°è¿›è¡Œï¼šå°†æ¢¯åº¦å¼ é‡é™¤ä»¥å…¶ L2 èŒƒæ•°(å¼ é‡çš„å¹³æ–¹çš„å¹³å‡å€¼çš„å¹³æ–¹æ ¹)æ¥æ ‡å‡†åŒ–ã€‚è¿™ç§æ“ä½œå¯ä»¥ä½¿è¾“å…¥å›¾åƒæ›´æ–°åœ°å¤§å°å§‹ç»ˆä¿æŒåœ¨åŒä¸€ä¸ªèŒƒå›´é‡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grads /= (K.sqrt(K.mean(K.square(grads))) + <span class="number">1e-5</span>)    <span class="comment"># + 1e-5 é˜²æ­¢é™¤ä»¥0</span></span><br><span class="line">print(grads)</span><br></pre></td></tr></table></figure><pre><code>Tensor(&quot;truediv_1:0&quot;, shape=(None, None, None, 3), dtype=float32)</code></pre><p>ç°åœ¨éœ€è¦æ¥è¿‘çš„é—®é¢˜æ˜¯ï¼Œç»™å®šè¾“å…¥å›¾åƒï¼Œè®¡ç®—å‡º loss å’Œ grads çš„å€¼ã€‚è¿™ä¸ªå¯ä»¥ç”¨ iterate å‡½æ¥åšï¼šå®ƒå°†ä¸€ä¸ª Numpy å¼ é‡è½¬æ¢ä¸ºä¸¤ä¸ª Numpy å¼ é‡ç»„æˆçš„åˆ—è¡¨ï¼Œè¿™ä¸¤ä¸ªå¼ é‡åˆ†åˆ«æ˜¯æŸå¤±å€¼å’Œæ¢¯åº¦å€¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">iterate = K.function([model.<span class="built_in">input</span>], [loss, grads])</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">loss_value, grads_value = iterate([np.zeros((<span class="number">1</span>, <span class="number">150</span>, <span class="number">150</span>, <span class="number">3</span>))])</span><br><span class="line">print(loss_value, grads_value)</span><br></pre></td></tr></table></figure><pre><code>0.0 [[[[0. 0. 0.]   [0. 0. 0.]   [0. 0. 0.]   ...   ...   [0. 0. 0.]   [0. 0. 0.]   [0. 0. 0.]]]]</code></pre><p>ç„¶åï¼Œå°±æ¥å†™æ¢¯åº¦ä¸‹é™äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡éšæœºæ¢¯åº¦ä¸‹é™è®©æŸå¤±æœ€å¤§åŒ–</span></span><br><span class="line"></span><br><span class="line">input_img_data = np.random.random((<span class="number">1</span>, <span class="number">150</span>, <span class="number">150</span>, <span class="number">3</span>)) * <span class="number">20</span> + <span class="number">128.</span>   <span class="comment"># éšä¾¿ä¸€ä¸ªæœ‰ç‡¥ç‚¹çš„ç°åº¦å›¾</span></span><br><span class="line"></span><br><span class="line">plt.imshow(input_img_data[<span class="number">0</span>, :, :, :] / <span class="number">225.</span>)</span><br><span class="line">plt.figure()</span><br><span class="line"></span><br><span class="line">step = <span class="number">1.</span>    <span class="comment"># æ¢¯åº¦æ›´æ–°çš„æ­¥é•¿</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">    loss_value, grads_value = iterate([input_img_data])</span><br><span class="line">    input_img_data += grads_value * step    <span class="comment"># æ²¿ç€è®©æŸå¤±æœ€å¤§åŒ–çš„æ–¹å‘è°ƒèŠ‚è¾“å…¥å›¾åƒ</span></span><br><span class="line">    </span><br><span class="line">plt.imshow(input_img_data[<span class="number">0</span>, :, :, :] / <span class="number">225.</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><pre><code>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).</code></pre><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh8673z1cwj30790700sy.jpg" alt="png"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh86752ufkj307907074x.jpg" alt="png"></p><p>Emmmï¼Œåˆšæ‰è¿™ä¸ªç”»å›¾æ˜¯æˆ‘éšä¾¿å†™çš„å•¦ï¼Œæ‰€ä»¥çˆ†äº†ä¸ª Warningï¼Œä¸ºäº†æ­£è§„åœ°ç”»å‡ºå›¾æ¥,ä¸‹é¢å¥½å¥½å¤„ç†ä¸€ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†å¼ é‡è½¬æ¢ä¸ºæœ‰æ•ˆå›¾åƒçš„ utility å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">deprocess_image</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="comment"># æ ‡å‡†åŒ–ï¼Œå‡å€¼ä¸º 0ï¼Œ æ ‡å‡†å·®ä¸º 0.1</span></span><br><span class="line">    x -= x.mean()</span><br><span class="line">    x /= (x.std() + <span class="number">1e-5</span>)</span><br><span class="line">    x *= <span class="number">0.1</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è£å‰ªåˆ° [0, 1]</span></span><br><span class="line">    x += <span class="number">0.5</span></span><br><span class="line">    x = np.clip(x, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å°† x è½¬æ¢ä¸º RGB æ•°ç»„</span></span><br><span class="line">    x *= <span class="number">255</span></span><br><span class="line">    x = np.clip(x, <span class="number">0</span>, <span class="number">255</span>).astype(<span class="string">&#x27;uint8&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æŠŠä¸Šé¢é‚£äº›ä¸œè¥¿å…¨éƒ¨æ‹¼èµ·æ¥å°±å¯ä»¥å¾—åˆ°å®Œæ•´çš„ç”Ÿæˆè¿‡æ»¤å™¨å¯è§†åŒ–çš„å‡½æ•°äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿæˆè¿‡æ»¤å™¨å¯è§†åŒ–çš„å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line">tf.compat.v1.disable_eager_execution()  <span class="comment"># See https://github.com/tensorflow/tensorflow/issues/33135</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_pattern</span>(<span class="params">layer_name, filter_index, size=<span class="number">150</span></span>):</span></span><br><span class="line">    <span class="comment"># æ„å»ºä¸€ä¸ªæŸå¤±å‡½æ•°ï¼Œå°† layer_name å±‚ç¬¬ filter_index ä¸ªè¿‡æ»¤å™¨çš„æ¿€æ´»æœ€å¤§åŒ–</span></span><br><span class="line">    layer_output = model.get_layer(layer_name).output</span><br><span class="line">    loss = K.mean(layer_output[:, :, :, filter_index])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è®¡ç®—æŸå¤±ç›¸å¯¹äºè¾“å…¥å›¾åƒçš„æ¢¯åº¦ï¼Œå¹¶å°†æ¢¯åº¦æ ‡å‡†åŒ–</span></span><br><span class="line">    grads = K.gradients(loss, model.<span class="built_in">input</span>)[<span class="number">0</span>]</span><br><span class="line">    grads /= (K.sqrt(K.mean(K.square(grads))) + <span class="number">1e-5</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è¿”å›ç»™å®šè¾“å…¥å›¾åƒçš„æŸå¤±å’Œæ¢¯åº¦</span></span><br><span class="line">    iterate = K.function([model.<span class="built_in">input</span>], [loss, grads])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ä»å¸¦æœ‰å™ªå£°çš„ç°åº¦å›¾å¼€å§‹ï¼Œæ¢¯åº¦ä¸Šå‡ 40 æ¬¡</span></span><br><span class="line">    input_img_data = np.random.random((<span class="number">1</span>, size, size, <span class="number">3</span>)) * <span class="number">20</span> + <span class="number">128.</span></span><br><span class="line">    step = <span class="number">1.</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">        loss_value, grads_value = iterate([input_img_data])</span><br><span class="line">        input_img_data += grads_value * step</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è¾“å‡ºç»“æœ</span></span><br><span class="line">    img = input_img_data[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> deprocess_image(img)</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥ç”¨äº†ï¼Œè¿˜æ˜¯é‚£åˆšæ‰é‚£ä¸ªä¾‹å­æ˜¯ä¸€ä¸‹|ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.imshow(generate_pattern(<span class="string">&#x27;block3_conv1&#x27;</span>, <span class="number">1</span>))</span><br></pre></td></tr></table></figure><pre><code>&lt;matplotlib.image.AxesImage at 0x167d78950&gt;</code></pre><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh866foirwj3079070t9a.jpg" alt="png"></p><p>è¿™ä¸ªå›¾å°±æ˜¯ block3_conv1 å±‚ç¬¬ 0 ä¸ªè¿‡æ»¤å™¨çš„å“åº”äº†ã€‚è¿™ç§ pattern å«åš polka-dotï¼ˆæ³¢å°”å¡ç‚¹å›¾æ¡ˆï¼‰ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠæ¯ä¸€å±‚çš„æ¯ä¸ªè¿‡æ»¤å™¨éƒ½å¯è§†åŒ–ã€‚ä¸ºäº†å¿«ä¸€ç‚¹ï¼Œæˆ‘ä»¬åªå¯è§†åŒ–æ¯ä¸ªå·ç§¯å—çš„ç¬¬ä¸€å±‚çš„å‰64ä¸ªè¿‡æ»¤å™¨ï¼ˆé˜²æ­¢ä¹Ÿæ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œå°±æ˜¯çœ‹çœ‹ï¼Œéšä¾¿æå‡ ä¸ªå°±è¡Œäº†ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿæˆä¸€å±‚ä¸­æ‰€æœ‰è¿‡æ»¤å™¨å“åº”æ¨¡å¼ç»„æˆçš„ç½‘æ ¼</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_patterns_in_layer</span>(<span class="params">layer_name, size=<span class="number">64</span>, margin=<span class="number">5</span></span>):</span></span><br><span class="line">    results = np.zeros((<span class="number">8</span> * size + <span class="number">7</span> * margin, <span class="number">8</span> * size + <span class="number">7</span> * margin, <span class="number">3</span>), dtype=np.<span class="built_in">int</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">            filter_img = generate_pattern(layer_name, i + (j * <span class="number">8</span>), size=size)</span><br><span class="line">            </span><br><span class="line">            horizontal_start = i * size + i * margin</span><br><span class="line">            horizontal_end = horizontal_start + size</span><br><span class="line">            </span><br><span class="line">            vertical_start = j * size + j * margin</span><br><span class="line">            vertical_end = vertical_start + size</span><br><span class="line">            </span><br><span class="line">            results[horizontal_start: horizontal_end,</span><br><span class="line">                    vertical_start: vertical_end, :] = filter_img</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">layer_names = [<span class="string">&#x27;block1_conv1&#x27;</span>, <span class="string">&#x27;block2_conv1&#x27;</span>, <span class="string">&#x27;block3_conv1&#x27;</span>, <span class="string">&#x27;block4_conv1&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> layer <span class="keyword">in</span> layer_names:</span><br><span class="line">    img = generate_patterns_in_layer(layer)</span><br><span class="line">    plt.figure(figsize=(<span class="number">20</span>, <span class="number">20</span>))</span><br><span class="line">    plt.title(layer)</span><br><span class="line">    plt.imshow(img)</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh86676843j30q00den33.jpg" alt="png"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh8668h3n8j30u00u44d3.jpg" alt="png"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh866aay9sj30u00u4du6.jpg" alt="png"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh866b9rihj30u00u4nbg.jpg" alt="png"></p><p>è¿™äº›å›¾é‡Œå°±è¡¨ç°äº†å·ç§¯ç¥ç»ç½‘ç»œçš„å±‚å¦‚ä½•è§‚å¯Ÿå›¾ç‰‡ä¸­çš„ä¿¡æ¯çš„ï¼šå·ç§¯ç¥ç»ç½‘ç»œä¸­æ¯ä¸€å±‚éƒ½å­¦ä¹ ä¸€ç»„è¿‡æ»¤å™¨ï¼Œç„¶åè¾“å…¥ä¼šè¢«è¡¨ç¤ºæˆè¿‡æ»¤å™¨çš„ç»„åˆï¼Œè¿™ä¸ªå…¶å®ç±»ä¼¼äºå‚…é‡Œå¶å˜æ¢çš„è¿‡ç¨‹ã€‚éšç€å±‚æ•°çš„åŠ æ·±ï¼Œå·ç§¯ç¥ç»ç½‘ç»œä¸­çš„è¿‡æ»¤å™¨å˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œè¶Šæ¥è¶Šç²¾ç»†ï¼Œæ‰€ä»¥å°±å¯ä»¥æå–ã€â€œç†è§£â€æ ¹æ®æŠ½è±¡çš„ä¿¡æ¯äº†ã€‚</p><h3 id="å¯è§†åŒ–å›¾åƒä¸­ç±»æ¿€æ´»çš„çƒ­åŠ›å›¾"><a href="#å¯è§†åŒ–å›¾åƒä¸­ç±»æ¿€æ´»çš„çƒ­åŠ›å›¾" class="headerlink" title="å¯è§†åŒ–å›¾åƒä¸­ç±»æ¿€æ´»çš„çƒ­åŠ›å›¾"></a>å¯è§†åŒ–å›¾åƒä¸­ç±»æ¿€æ´»çš„çƒ­åŠ›å›¾</h3><p><strong>å¯è§†åŒ–å›¾åƒä¸­ç±»æ¿€æ´»çš„çƒ­åŠ›å›¾</strong>ï¼ˆVisualizing heatmaps of class activation in an imageï¼‰ï¼Œç”¨æ¥äº†è§£ç½‘ç»œæ˜¯é å“ªéƒ¨åˆ†å›¾åƒæ¥è¯†åˆ«ä¸€ä¸ªç±»çš„ï¼Œä¹Ÿæœ‰åŠ©äºçŸ¥é“ç‰©ä½“åœ¨å›¾ç‰‡çš„å“ªä¸ªä½ç½®ã€‚</p><p>ç”¨æ¥å¯¹è¾“å…¥å›¾åƒç”Ÿæˆç±»æ¿€æ´»çš„çƒ­åŠ›å›¾çš„ä¸€ç§æŠ€æœ¯å« CAM (class activation map ç±»æ¿€æ´»å›¾)å¯è§†åŒ–ã€‚ç±»æ¿€æ´»çƒ­åŠ›å›¾å¯¹ä»»æ„è¾“å…¥çš„å›¾åƒçš„æ¯ä¸ªä½ç½®è¿›è¡Œè®¡ç®—ï¼Œè¡¨ç¤ºå‡ºæ¯ä¸ªä½ç½®å¯¹è¯¥ç±»åˆ«çš„é‡è¦ç¨‹åº¦ã€‚æ¯”å¦‚æˆ‘ä»¬çš„çŒ«ç‹—åˆ†ç±»ç½‘ç»œé‡Œï¼Œå¯¹ä¸€ä¸ªçŒ«çš„å›¾ç‰‡ç”Ÿæˆç±»æ¿€æ´»çƒ­åŠ›å›¾ï¼Œå¯ä»¥å¾—åˆ°è¿™ä¸ªå›¾ç‰‡çš„å„ä¸ªä¸åŒçš„éƒ¨ä½æœ‰å¤šåƒçŒ«ï¼ˆå¯¹æ¨¡å‹è®¤ä¸ºè¿™æ˜¯çŒ«çš„å›¾ç‰‡èµ·äº†è¿‡å¤§çš„ä½œç”¨ï¼‰ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬ç”¨ [Grad-CAM](<a href="https://arxiv.org/abs/">https://arxiv.org/abs/</a> 1610.02391.) è¿™ä¸ªæ–¹æ³•ï¼šç»™å®šä¸€å¼ è¾“å…¥å›¾åƒï¼Œå¯¹äºä¸€ä¸ªå·ç§¯å±‚çš„è¾“å‡ºç‰¹å¾å›¾ï¼Œç”¨ç±»åˆ«ç›¸å¯¹äºé€šé“çš„æ¢¯åº¦å¯¹è¿™ä¸ªç‰¹å¾å›¾ä¸­çš„æ¯ä¸ªé€šé“è¿›è¡ŒåŠ æƒã€‚è¯´äººè¯å°±æ˜¯ç”¨ã€Œæ¯ä¸ªé€šé“å¯¹åˆ†ç±»çš„é‡è¦ç¨‹åº¦ã€å¯¹ã€Œè¾“å…¥å›¾åƒå¯¹ä¸åŒé€šé“çš„æ¿€æ´»çš„å¼ºå¼±ç¨‹åº¦ã€çš„ç©ºé—´å›¾è¿›è¡ŒåŠ æƒï¼Œä»è€Œå¾—åˆ°ã€Œè¾“å…¥å›¾åƒå¯¹ç±»åˆ«çš„æ¿€æ´»å¼ºåº¦ã€çš„ç©ºé—´å›¾ã€‚ï¼ˆemmmï¼Œè¿™ç§è¶…é•¿çš„å¥å­çœ‹åŸæ–‡æ¯”è¾ƒå¥½ğŸ˜­ï¼šIntuitively, one way to understand this trick is that youâ€™re weighting a spatial map of â€œhow intensely the input image activates different channelsâ€ by â€œhow important each channel is with regard to the class,â€ resulting in a spatial map of â€œhow intensely the input image activates the class.â€ï¼‰</p><p>æˆ‘ä»¬åœ¨ VGG16 æ¨¡å‹æ¥æ¼”ç¤ºè¿™ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŠ è½½å¸¦æœ‰é¢„è®­ç»ƒæƒé‡çš„ VGG16 ç½‘ç»œ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.applications.vgg16 <span class="keyword">import</span> VGG16</span><br><span class="line"></span><br><span class="line">model = VGG16(weights=<span class="string">&#x27;imagenet&#x27;</span>)    <span class="comment"># æ³¨æ„è¿™ä¸ªæ˜¯å¸¦æœ‰åˆ†ç±»å™¨çš„ï¼Œæ¯”è¾ƒå¤§ï¼Œä¸‹è½½ç¨æ…¢ï¼ˆæœ‰500+MBï¼‰</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.summary()</span><br></pre></td></tr></table></figure><pre><code>Model: &quot;vgg16&quot;_________________________________________________________________Layer (type)                 Output Shape              Param #   =================================================================input_1 (InputLayer)         [(None, 224, 224, 3)]     0         _________________________________________________________________block1_conv1 (Conv2D)        (None, 224, 224, 64)      1792      _________________________________________________________________block1_conv2 (Conv2D)        (None, 224, 224, 64)      36928     _________________________________________________________________block1_pool (MaxPooling2D)   (None, 112, 112, 64)      0         _________________________________________________________________block2_conv1 (Conv2D)        (None, 112, 112, 128)     73856     _________________________________________________________________block2_conv2 (Conv2D)        (None, 112, 112, 128)     147584    _________________________________________________________________block2_pool (MaxPooling2D)   (None, 56, 56, 128)       0         _________________________________________________________________block3_conv1 (Conv2D)        (None, 56, 56, 256)       295168    _________________________________________________________________block3_conv2 (Conv2D)        (None, 56, 56, 256)       590080    _________________________________________________________________block3_conv3 (Conv2D)        (None, 56, 56, 256)       590080    _________________________________________________________________block3_pool (MaxPooling2D)   (None, 28, 28, 256)       0         _________________________________________________________________block4_conv1 (Conv2D)        (None, 28, 28, 512)       1180160   _________________________________________________________________block4_conv2 (Conv2D)        (None, 28, 28, 512)       2359808   _________________________________________________________________block4_conv3 (Conv2D)        (None, 28, 28, 512)       2359808   _________________________________________________________________block4_pool (MaxPooling2D)   (None, 14, 14, 512)       0         _________________________________________________________________block5_conv1 (Conv2D)        (None, 14, 14, 512)       2359808   _________________________________________________________________block5_conv2 (Conv2D)        (None, 14, 14, 512)       2359808   _________________________________________________________________block5_conv3 (Conv2D)        (None, 14, 14, 512)       2359808   _________________________________________________________________block5_pool (MaxPooling2D)   (None, 7, 7, 512)         0         _________________________________________________________________flatten (Flatten)            (None, 25088)             0         _________________________________________________________________fc1 (Dense)                  (None, 4096)              102764544 _________________________________________________________________fc2 (Dense)                  (None, 4096)              16781312  _________________________________________________________________predictions (Dense)          (None, 1000)              4097000   =================================================================Total params: 138,357,544Trainable params: 138,357,544Non-trainable params: 0_________________________________________________________________</code></pre><p>ç„¶åæˆ‘ä»¬ç…§ä¸€å¼ ç”¨æ¥æµ‹è¯•çš„å›¾ç‰‡ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh83vzik31j30oz0goq7t.jpg" alt="creative_commons_elephant"></p><p>è¿™æ˜¯ä¸¤åªäºšæ´²è±¡ğŸ˜å“¦ï¼ŒæŠŠè¿™ä¸ªå›¾ç‰‡å¤„ç†æˆ VGG16 æ¨¡å‹éœ€è¦çš„æ ·å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.preprocessing <span class="keyword">import</span> image</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.applications.vgg16 <span class="keyword">import</span> preprocess_input, decode_predictions</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">img_path = <span class="string">&#x27;./creative_commons_elephant.jpg&#x27;</span></span><br><span class="line">img = image.load_img(img_path, target_size=(<span class="number">224</span>, <span class="number">224</span>))</span><br><span class="line"></span><br><span class="line">img = image.load_img(img_path, target_size=(<span class="number">224</span>, <span class="number">224</span>))</span><br><span class="line">x = image.img_to_array(img)</span><br><span class="line">x = np.expand_dims(x, axis=<span class="number">0</span>)</span><br><span class="line">x = preprocess_input(x)</span><br></pre></td></tr></table></figure><p>é¢„æµ‹ä¸€ä¸‹å›¾ç‰‡é‡Œçš„æ˜¯å•¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">preds = model.predict(x)</span><br><span class="line">print(<span class="string">&#x27;Predicted:&#x27;</span>, decode_predictions(preds, top=<span class="number">3</span>)[<span class="number">0</span>])</span><br></pre></td></tr></table></figure><pre><code>Predicted: [(&#39;n02504458&#39;, &#39;African_elephant&#39;, 0.909421), (&#39;n01871265&#39;, &#39;tusker&#39;, 0.086182885), (&#39;n02504013&#39;, &#39;Indian_elephant&#39;, 0.0043545826)]</code></pre><p>æœ‰ 90% çš„æŠŠæ¡æ˜¯äºšæ´²è±¡ï¼Œä¸é”™ã€‚æ¥ä¸‹æ¥å°±è¦ç”¨ Grad-CAM ç®—æ³•æ¥æ˜¾ç¤ºå›¾åƒä¸­å“ªäº›éƒ¨åˆ†æœ€åƒéæ´²è±¡äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> backend <span class="keyword">as</span> K</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line">tf.compat.v1.disable_eager_execution()  <span class="comment"># See https://github.com/tensorflow/tensorflow/issues/33135</span></span><br><span class="line"></span><br><span class="line">african_elephant_output = model.output[:, <span class="number">386</span>]    <span class="comment"># è¿™ä¸ªæ˜¯è¾“å‡ºå‘é‡ä¸­ä»£è¡¨â€œéæ´²è±¡â€çš„å…ƒç´ </span></span><br><span class="line"></span><br><span class="line">last_conv_layer = model.get_layer(<span class="string">&#x27;block5_conv3&#x27;</span>)   <span class="comment"># VGG16 æœ€åä¸€ä¸ªå·ç§¯å±‚çš„è¾“å‡ºç‰¹å¾å›¾</span></span><br><span class="line"></span><br><span class="line">grads = K.gradients(african_elephant_output, last_conv_layer.output)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">pooled_grads = K.mean(grads, axis=(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>))    <span class="comment"># ç‰¹å®šç‰¹å¾å›¾é€šé“çš„æ¢¯åº¦å¹³å‡å¤§å°ï¼Œå½¢çŠ¶ä¸º (512,) </span></span><br><span class="line"></span><br><span class="line">iterate = K.function([model.<span class="built_in">input</span>], [pooled_grads, last_conv_layer.output[<span class="number">0</span>]])</span><br><span class="line"></span><br><span class="line">pooled_grads_value, conv_layer_output_value = iterate([x])    <span class="comment"># å¯¹åˆšæ‰çš„æµ‹è¯•ğŸ˜å›¾ç‰‡è®¡ç®—å‡ºæ¢¯åº¦å’Œç‰¹å¾å›¾</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">512</span>):</span><br><span class="line">    <span class="comment"># å°†ç‰¹å¾å›¾æ•°ç»„çš„æ¯ä¸ª channel ä¹˜ä»¥ã€Œè¿™ä¸ª channel å¯¹â€˜å¤§è±¡â€™ç±»åˆ«çš„é‡è¦ç¨‹åº¦ã€</span></span><br><span class="line">    conv_layer_output_value[:, :, i] *= pooled_grads_value[i]</span><br><span class="line">    </span><br><span class="line">heatmap = np.mean(conv_layer_output_value, axis=-<span class="number">1</span>)  <span class="comment"># å¤„ç†åçš„ç‰¹å¾å›¾çš„é€é€šé“å¹³å‡å€¼å³ä¸ºç±»æ¿€æ´»çš„çƒ­åŠ›å›¾</span></span><br></pre></td></tr></table></figure><p>æŠŠå®ƒç”»å‡ºæ¥çœ‹çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">heatmap = np.maximum(heatmap, <span class="number">0</span>)</span><br><span class="line">heatmap /= np.<span class="built_in">max</span>(heatmap)</span><br><span class="line">plt.matshow(heatmap)</span><br></pre></td></tr></table></figure><pre><code>&lt;matplotlib.image.AxesImage at 0x13d935210&gt;</code></pre><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh8669908hj3078076mx8.jpg" alt="png"></p><p>emmmmï¼Œçœ‹ä¸æ‡‚å•Šï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ç”¨ OpenCV æŠŠè¿™ä¸ªå åŠ åˆ°åŸå›¾ä¸Šå»çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"></span><br><span class="line">img = cv2.imread(img_path)    <span class="comment"># åŠ è½½åŸå›¾</span></span><br><span class="line">heatmap = cv2.resize(heatmap, (img.shape[<span class="number">1</span>], img.shape[<span class="number">0</span>]))    <span class="comment"># è°ƒæ•´çƒ­åŠ›å›¾å¤§å°ï¼Œç¬¦åˆåŸå›¾</span></span><br><span class="line">heatmap = np.uint8(<span class="number">255</span> * heatmap)    <span class="comment"># è½¬æ¢ä¸º RGB æ ¼å¼</span></span><br><span class="line">heatmap = cv2.applyColorMap(heatmap, cv2.COLORMAP_JET)</span><br><span class="line">superimposed_img = heatmap * <span class="number">0.4</span> + img    <span class="comment"># å åŠ </span></span><br><span class="line">cv2.imwrite(<span class="string">&#x27;./elephant_cam.jpg&#x27;</span>, superimposed_img)    <span class="comment"># ä¿å­˜</span></span><br></pre></td></tr></table></figure><pre><code>True</code></pre><p>å¾—åˆ°çš„å›¾åƒå¦‚ä¸‹ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh84yvepspj30oz0go7a9.jpg" alt="å åŠ åˆ°åŸå›¾çš„çƒ­åŠ›å›¾"></p><p>å¯ä»¥çœ‹å‡ºï¼ŒVGG16 ç½‘ç»œå…¶å®åªè¯†åˆ«äº†é‚£åªå°çš„è±¡ï¼Œæ³¨æ„ï¼Œå°è±¡å¤´éƒ¨çš„æ¿€æ´»å¼ºåº¦å¾ˆå¤§ï¼Œè¿™å¯èƒ½å°±æ˜¯ç½‘ç»œæ‰¾åˆ°çš„éæ´²è±¡çš„ç‹¬ç‰¹ä¹‹å¤„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> Deep Learning with Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
            <tag> Deep Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GitHub Actions å®è·µï¼šHexo GitHub Pages åšå®¢æŒç»­éƒ¨ç½²</title>
      <link href="/2020/07/26/blog/GitHub-Actions-Hexo-CI-CD/"/>
      <url>/2020/07/26/blog/GitHub-Actions-Hexo-CI-CD/</url>
      
        <content type="html"><![CDATA[<h1 id="GitHub-Actions-å®è·µ-Hexo-GitHub-Pages-åšå®¢æŒç»­éƒ¨ç½²"><a href="#GitHub-Actions-å®è·µ-Hexo-GitHub-Pages-åšå®¢æŒç»­éƒ¨ç½²" class="headerlink" title="GitHub Actions å®è·µ: Hexo GitHub Pages åšå®¢æŒç»­éƒ¨ç½²"></a>GitHub Actions å®è·µ: Hexo GitHub Pages åšå®¢æŒç»­éƒ¨ç½²</h1><p>æˆ‘ç”¨ Hexo æ¥ç®¡ç†è‡ªå·±çš„æ–‡ç« ã€å¹¶éƒ¨ç½²åˆ° Github Pags å·²ç»æœ‰ä¸€æ®µæ—¶é—´äº†ã€‚å…³äºæˆ‘æ„å»ºè¿™ä¸ªåšå®¢ç³»ç»Ÿçš„ç»è¿‡å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼šã€Š<a href="https://clownote.github.io/2019/08/15/blog/GitHub%E5%8A%A0Hexo%E6%89%93%E9%80%A0%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/">GitHub + Hexo =&gt; ä¸ªäººåšå®¢</a>ã€‹ã€‚</p><p>åœ¨å®é™…ä½¿ç”¨è¿™ä¸ªç³»ç»Ÿçš„è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘éƒ½æ˜¯æœ‰æƒ³æ³•å°±æ‰“å¼€ Typora å¼€å§‹å†™ï¼Œæ–‡ç« å†™å®Œäº†å°±åœ¨å¼€å¤´æ‰‹åŠ¨è¡¥ä¸€ä¸ª YAML é…ç½®ï¼Œç„¶åç›´æ¥æŠŠ <code>.md</code> æ–‡ä»¶æ‰”åˆ° <code>_post</code> æˆ–è€… <code>_draft</code> é‡Œã€‚ç„¶åç”¨ Hexo CLI ç”Ÿæˆã€éƒ¨ç½²ï¼Œç„¶åæŠŠæºæ–‡ä»¶ç”¨ Git æäº¤ã€æ¨é€åˆ° GitHub å¤‡ä»½ã€‚è¿™ä¸ªè¿‡ç¨‹åŸºæœ¬å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ vim newArticle.md    <span class="comment"># å®é™…ä¸Šæˆ‘æ˜¯ç”¨ Typora çš„ï¼Œè¿™é‡Œç¼–è¾‘è¿‡ç¨‹ç”¨ vim ä»£æ›¿</span></span><br><span class="line">$ mv newArticle.md ~/clownote/<span class="built_in">source</span>/_post    <span class="comment"># æˆ‘çš„åšå®¢ç³»ç»Ÿæ”¾åœ¨ ~/clownote</span></span><br><span class="line">$ hexo g -d    <span class="comment"># ç”Ÿæˆã€éƒ¨ç½²åˆ° GitHub Pages</span></span><br><span class="line">$ git add .</span><br><span class="line">$ git commit -m <span class="string">&quot;add newArticle&quot;</span></span><br><span class="line">$ git push</span><br></pre></td></tr></table></figure><p>hexo ç”Ÿæˆã€éƒ¨ç½²ã€git æäº¤ï¼Œè¿™ä¸ªè¿‡ç¨‹æœç„¶è¿˜æ˜¯å¤ªå†—é•¿äº†ã€‚æˆ‘åœ¨æƒ³ç”¨æ²¡æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥ç®€åŒ–è¿™ä¸ªå¥—è·¯åŒ–çš„æµç¨‹ã€‚å¯¹æ­¤ï¼Œæˆ‘é¦–å…ˆçš„æƒ³æ³•æ˜¯å†™ä¸€ä¸ª shell è„šæœ¬æ¥ç®€åŒ–æ•´å¥—æµç¨‹ã€‚è¿™ä¸ªè„šæœ¬æä¾›å¦‚ä¸‹æ¥å£ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ clownote new newArticleTitle    <span class="comment"># æ–°å»ºæ–‡ç« ï¼Œè‡ªåŠ¨æ‰“å¼€ Typora ç¼–è¾‘</span></span><br><span class="line">$ clownote update    <span class="comment"># ç”Ÿæˆã€éƒ¨ç½²ã€æºç  git æäº¤</span></span><br></pre></td></tr></table></figure><p>ä½†æ„Ÿè§‰æœ‰ç‚¹æ­»æ¿ï¼Œè€Œä¸”æˆ‘å…¶å®ä¸å¤ªå–œæ¬¢å†™ shell è„šæœ¬ï¼Œé‚£è¯­æ³•è™½ç„¶å¾ˆç®€æ´ã€é«˜æ•ˆï¼Œä½†çœŸçš„ï¼Œï¼ŒçœŸçš„ä¸€è¨€éš¾å°½ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ç”¨å…¶ä»–è¯­è¨€æ¥å†™è¿™ä¸œè¥¿ï¼ŒPython å°±ä¸é”™ï¼Œä¸ç”¨ç¼–è¯‘ã€å†™ä¸ªæ‰§è¡Œæ³¨é‡ŠåŠ ä¸Šæƒé™ç›´æ¥å°±èƒ½è·‘ã€‚ä½†æ˜¯ï¼Œè¿™æ ·æ¯”è¾ƒæ— è¶£å˜›ï¼Œæˆ‘æ²¡æœ‰è¿™ä¹ˆåšã€‚</p><p>ç°åœ¨æ˜¯äº‘æ—¶ä»£äº†ï¼ŒCI/CD è¿™ä¸€å¥—å¾ˆæµè¡Œäº†ï¼Œç©è¿™ä¸œè¥¿å¯èƒ½æ¯”å†™ä¸ªçƒ‚è„šæœ¬æœ‰æ„æ€å¤šäº†ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©ç”¨ CI/CD è¿™ä¸€å¥—æ¥å®Œæˆä»»åŠ¡ã€‚</p><h2 id="CI-CD-amp-CD"><a href="#CI-CD-amp-CD" class="headerlink" title="CI, CD &amp; CD"></a>CI, CD &amp; CD</h2><p>ç®€å•è¯´ä¸€ä¸‹ CI/CD â€”â€” CI, CD &amp; CDï¼šContinuous Integrationï¼ŒContinuous Deliveryï¼ŒContinuous Deploymentã€‚ç¿»è¯‘æˆä¸­æ–‡ï¼šæŒç»­é›†æˆã€æŒç»­äº¤ä»˜å’ŒæŒç»­éƒ¨ç½²ã€‚</p><ul><li>æŒç»­é›†æˆCIï¼šæäº¤ä»£ç åˆ°ä¸»åˆ†æ”¯å‰ï¼Œè‡ªåŠ¨ç¼–è¯‘ã€è‡ªåŠ¨æµ‹è¯•éªŒè¯ï¼Œæ²¡é€šè¿‡å°±ä¸èƒ½åˆå¹¶ï¼›</li><li>æŒç»­äº¤ä»˜CDï¼šåœ¨ CI éªŒè¯é€šè¿‡åï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œå¯ä»¥ç»§ç»­æ‰‹åŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼›</li><li>æŒç»­éƒ¨ç½²CDï¼šæŠŠéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒçš„è¿‡ç¨‹è‡ªåŠ¨åŒ–ï¼Œä¸éœ€è¦æ‰‹å·¥æ“ä½œã€‚</li></ul><blockquote><p>è¿˜ä¸äº†è§£ CI/CD æ˜¯ä»€ä¹ˆï¼Ÿç§»æ­¥çº¢å¸½çš„è¿™ç¯‡ ã€Š<a href="https://www.redhat.com/zh/topics/devops/what-is-ci-cd">CI/CDæ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ç†è§£æŒç»­é›†æˆã€æŒç»­äº¤ä»˜å’ŒæŒç»­éƒ¨ç½²</a>ã€‹ï¼Œè¿˜æœ‰è¿™ç¯‡ã€Š<a href="http://www.ttlsa.com/news/ci-cd-cd/">è¯¦è§£CIã€CD &amp; CD</a>ã€‹ï¼Œè¿˜æ˜¯ä¸æ‡‚ï¼Œå°±çœ‹çœ‹ <a href="https://www.zhihu.com/question/23444990">çŸ¥ä¹</a> å§ã€‚</p></blockquote><h2 id="åšå®¢çš„æŒç»­éƒ¨ç½²"><a href="#åšå®¢çš„æŒç»­éƒ¨ç½²" class="headerlink" title="åšå®¢çš„æŒç»­éƒ¨ç½²"></a>åšå®¢çš„æŒç»­éƒ¨ç½²</h2><p>æŠ›å¼€å®šä¹‰ï¼Œç›´è§‚ä¸Šï¼ŒæŒç»­éƒ¨ç½²ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æŒç»­ä¸æ–­åœ°å»éƒ¨ç½²ï¼Œéƒ¨ç½²è‡ªåŠ¨ç´§è·Ÿä»£ç æ”¹å˜ï¼šä½ çš„æäº¤äº†æºç ä¿®æ”¹ï¼Œéƒ¨ç½²ä¸Šå°±è‡ªåŠ¨æ›´æ–°äº†ã€‚å¯¹äºæˆ‘ä»¬çš„åšå®¢ç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯æ–°å»º/ä¿®æ”¹/åˆ é™¤äº†æ–‡ç« ï¼Œåšå®¢ç«™ç‚¹å°±è‡ªåŠ¨æ›´æ–°ã€ä¿®æ”¹å¯¹åº”å†…å®¹ã€‚ä»æ•ˆæœä¸Šæ¥è¯´ï¼Œå°±æ˜¯æˆ‘ä»¬ä¸ç”¨å†å»æ‰‹åŠ¨ <code>hexo g -d</code> ç”Ÿæˆã€éƒ¨ç½²äº†ã€‚</p><p>æˆ‘ä»¬åˆšæ‰æå‡ºçš„è„šæœ¬å°±èƒ½è¾¾åˆ°è¿™æ ·çš„ç›®çš„ï¼Œä½†æˆ‘è§‰å¾—è¿™æ ·ä¸å¤ªç®—æŒç»­éƒ¨ç½²ï¼Œå†™è„šæœ¬åªæ˜¯æŠŠä¸€ç³»åˆ—æ“ä½œåˆå¹¶åˆ°ä¸€èµ·è®©è®¡ç®—æœºé€æ­¥å®Œæˆï¼Œæœ¬è´¨å¹¶æ²¡æœ‰æ”¹å˜ï¼Œä½ ç»ˆç©¶æ˜¯è‡ªå·±åšäº†å…¨å¥—çš„éƒ¨ç½²å·¥ä½œã€‚ä½†ä½ ç»†å“ï¼Œç”¨æŒç»­éƒ¨ç½²å°±ä¸ä¸€æ ·äº†ï¼Œå®ƒæ˜¯å…ˆæäº¤æºç ï¼Œç„¶åå®ƒåœ¨äº‘ç«¯å°±è‡ªåŠ¨ç»™ä½ å»ç”Ÿæˆ(ç¼–è¯‘)ã€éƒ¨ç½²äº†ï¼Œè¿™ä¸ªç”Ÿæˆã€éƒ¨ç½²çš„å·¥ä½œæ˜¯ä¸éœ€è¦ç”±ä½ åœ¨æœ¬åœ°å®Œæˆçš„ã€‚</p><p>è¿™äº›å·¥ä½œä¸ç”±ä½ æ¥åšé è°åšå‘¢ï¼Ÿç”±æä¾› CI/CD æœåŠ¡çš„æœåŠ¡å™¨è‡ªåŠ¨æ¥å®Œæˆã€‚å…¶å® GitHub å°±å…è´¹æä¾›æ¥è¿™é¡¹æœåŠ¡ï¼Œå«åš <a href="https://github.com/features/actions">GitHub Actions</a>ã€‚</p><h2 id="GitHub-Actions"><a href="#GitHub-Actions" class="headerlink" title="GitHub Actions"></a>GitHub Actions</h2><p>GitHub Actions å¯ä»¥è‡ªåŠ¨åœ¨ä½ çš„ GitHub ä»“åº“å‘ç”Ÿäº‹ä»¶æ—¶è‡ªåŠ¨å®Œæˆä¸€äº›å·¥ä½œï¼Œæ¯”å¦‚åœ¨ä½ æ¨é€æäº¤(git push)åˆ°åšå®¢ä»“åº“æ—¶ï¼Œè‡ªåŠ¨ç»™ä½ éƒ¨ç½²ä¸Šã€‚è¯¦ç»†çš„å…¥é—¨ï¼Œæ¨èçœ‹çœ‹é˜®ä¸€å³°è€å¸ˆçš„ã€Š<a href="http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html">GitHub Actions å…¥é—¨æ•™ç¨‹</a>ã€‹ã€‚å½“ç„¶ï¼Œ<a href="https://docs.github.com/en/actions">å®˜æ–¹æ–‡æ¡£</a> ä¹Ÿæ˜¯å¾ˆå¥½çš„å­¦ä¹ èµ„æ–™ã€‚</p><p>è¿™ä¸ªä¸œè¥¿ç”¨èµ·æ¥æœ‰ç‚¹åƒ Dockerï¼Œå¯ä»¥ä»¥åˆ«äººåšå¥½çš„â€œé•œåƒâ€ï¼ˆåœ¨ GitHub Actions ä¸­ç§°ä¸º Actionsï¼‰ä¸ºåŸºç¡€å»æ‰§è¡Œä¸€äº›å·¥ä½œï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥æ„å»ºâ€œé•œåƒâ€ã€‚å…¶å®ï¼Œå·²ç»æœ‰å¾ˆå¤šäººåšè¿‡è‡ªåŠ¨åœ¨ Github Pages æŒç»­éƒ¨ç½² Hexo åšå®¢çš„ Actions äº†ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥ç›´æ¥ç”¨ã€‚ä½ å¯ä»¥åœ¨ GitHub ç½‘é¡µé¡¶éƒ¨çœ‹åˆ°ä¸€ä¸ª <code>Marketplace</code>ï¼Œç‚¹è¿›å»å¯ä»¥æœåˆ«äººå†™å¥½çš„ Actionsã€‚</p><blockquote><p>æ³¨ï¼šä¸‹æ–‡å¯¹ Workflow çš„ä»‹ç»ï¼š**Forked from <a href="http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html">ruanyifeng/GitHub Actions å…¥é—¨æ•™ç¨‹</a>**ï¼Œå¹¶å‚è€ƒå®˜æ–¹æ–‡æ¡£åšäº†ä¸€å®šçš„ä¿®æ”¹ã€è¡¥å……ã€‚</p></blockquote><p>GitHub Actions çš„é…ç½®æ–‡ä»¶å«åš Workflowï¼Œå­˜æ”¾åœ¨ä»£ç ä»“åº“çš„ <code>.github/workflows</code> ç›®å½•ã€‚Workflow æ–‡ä»¶æ˜¯ç”¨ <a href="https://yaml.org/">YAML</a> å»å†™çš„ï¼Œåç¼€åä¸º <code>.yml</code>ã€‚ä¸€ä¸ª repo å¯ä»¥æœ‰å¤šä¸ª workflow æ–‡ä»¶ã€‚GitHub ä¼šå‘ç° <code>.github/workflows</code> ç›®å½•é‡Œæ‰€æœ‰ <code>.yml</code> æ–‡ä»¶ï¼Œè‡ªåŠ¨æŠŠä»–ä»¬è¯†åˆ«ä¸º Actionï¼Œåœ¨å‡ºå‘å…¶ä¸­æŒ‡å®šçš„æ“ä½œæ—¶å°±è‡ªåŠ¨è¿è¡Œã€‚ä¸‹é¢ä»‹ç»ä¸€äº› Workflow çš„åŸºæœ¬å†™æ³•ï¼š</p><p>ï¼ˆ1ï¼‰<code>name</code>ï¼šworkflow çš„åç§°ã€‚å¦‚æœçœç•¥ï¼Œåˆ™é»˜è®¤ä¸ºå½“å‰ workflow çš„æ–‡ä»¶åã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">GitHub</span> <span class="string">Actions</span> <span class="string">Demo</span></span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰<code>on</code>ï¼šæŒ‡å®šè§¦å‘ workflow çš„äº‹ä»¶ã€‚æ¯”å¦‚ push æ—¶å‡ºå‘æ‰§è¡Œè¯¥ Actionã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">on:</span> <span class="string">push</span></span><br><span class="line"><span class="comment"># å¦‚æœæœ‰å¤šç§å¯ä»¥å†™æ•°ç»„ï¼š</span></span><br><span class="line"><span class="attr">on:</span> [<span class="string">push</span>, <span class="string">pull_request</span>]</span><br><span class="line"><span class="comment"># è¿˜å¯ä»¥æŒ‡å®šåˆ†æ”¯ on.&lt;push|pull_request&gt;.&lt;tags|branches&gt;ï¼š</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span>    </span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰<code>jobs</code>ï¼šè¡¨ç¤ºè¦æ‰§è¡Œçš„ä¸€é¡¹æˆ–å¤šé¡¹ä»»åŠ¡ï¼Œworkflow çš„ä¸»ä½“ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">my_first_job:</span>    <span class="comment"># job_id</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">My</span> <span class="string">first</span> <span class="string">job</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">  <span class="attr">greeting_job:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">This</span> <span class="string">job</span> <span class="string">needs</span> <span class="string">my_first_job</span></span><br><span class="line">    <span class="attr">needs:</span> <span class="string">my_first_job</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Print</span> <span class="string">a</span> <span class="string">greeting</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="attr">MY_VAR:</span> <span class="string">Hi</span> <span class="string">there!</span> <span class="string">My</span> <span class="string">name</span> <span class="string">is</span></span><br><span class="line">          <span class="attr">MY_NAME:</span> <span class="string">Mona</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">          <span class="string">echo</span> <span class="string">$MY_VAR</span> <span class="string">$MY_NAME.</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Hello</span> <span class="string">world</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/hello-world-javascript-action@v1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">who-to-greet:</span> <span class="string">&#x27;Mona the Octocat&#x27;</span></span><br><span class="line">        <span class="attr">id:</span> <span class="string">hello</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><code>name</code> ï¼šä»»åŠ¡çš„è¯´æ˜ã€‚</li><li><code>needs</code> ï¼šæŒ‡å®šå½“å‰ä»»åŠ¡çš„ä¾èµ–å…³ç³»ï¼Œå³è¿è¡Œé¡ºåºã€‚</li><li><code>runs-on</code> ï¼šæŒ‡å®šè¿è¡Œæ‰€éœ€è¦çš„è™šæ‹Ÿæœºç¯å¢ƒã€‚å¿…å¡«ï¼Œå¯ä»¥ç”¨ ubuntuã€windowsã€macOSï¼Œè¿˜æœ‰å¥½å¤šç‰ˆæœ¬å¯é€‰ï¼Œè¯¦ç»†çš„çœ‹<a href="https://docs.github.com/en/actions/reference/virtual-environments-for-github-hosted-runners">æ–‡æ¡£</a>ã€‚</li><li><code>steps</code>ï¼š<code>steps</code>å­—æ®µæŒ‡å®šæ¯ä¸ª Job çš„è¿è¡Œæ­¥éª¤ï¼Œå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤ã€‚æ¯ä¸ªæ­¥éª¤éƒ½å¯ä»¥æŒ‡å®šä»¥ä¸‹å­—æ®µï¼š<ul><li><code>jobs.&lt;job_id&gt;.steps.name</code>ï¼šæ­¥éª¤åç§°ã€‚</li><li><code>jobs.&lt;job_id&gt;.steps.id</code>ï¼šæ­¥éª¤çš„ step_idã€‚</li><li><code>jobs.&lt;job_id&gt;.steps.run</code>ï¼šè¯¥æ­¥éª¤è¿è¡Œçš„å‘½ä»¤æˆ–è€… actionã€‚å¸¦ env æ¥è®¾ç½®ç¯å¢ƒå˜é‡ã€‚</li><li><code>jobs.&lt;job_id&gt;.steps.uses</code>ï¼šè°ƒç”¨åˆ«äººåšå¥½çš„ actionã€‚å¸¦ with æ¥æŒ‡å®šè¿è¡Œå‚æ•°ã€‚</li></ul></li></ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¼€å§‹å®è·µï¼Œæ„å»ºè‡ªåŠ¨éƒ¨ç½² GitHub Pages çš„ GitHub Actionã€‚ï¼ˆGitHub å…¨å®¶æ¡¶è­¦å‘ŠğŸ˜¨ï¼‰</p><h2 id="ä½¿ç”¨-sma11black-hexo-action"><a href="#ä½¿ç”¨-sma11black-hexo-action" class="headerlink" title="ä½¿ç”¨ sma11black/hexo-action"></a>ä½¿ç”¨ sma11black/hexo-action</h2><p>æˆ‘æŸ¥çœ‹ã€å°è¯•äº†å¤šä¸ªå…³äº Hexo çš„ Actionsï¼Œæœ€åè§‰å¾— <a href="https://github.com/marketplace/actions/hexo-action">sma11black/hexo-action</a> æä¾›äº†æˆ‘éœ€è¦çš„ä¸€åˆ‡ï¼Œä»£ç å†™çš„ä¹Ÿå¾ˆå¥½ï¼Œæ–‡æ¡£ä¹Ÿæœ€ä¸ºå®Œå¤‡ã€‚æ‰€ä»¥å°±å†³å®šç›´æ¥ç”¨å®ƒäº†ï¼Œæ‡’å¾—è‡ªå·±å†™ã€‚</p><blockquote><p>æ’å˜´ï¼šè¿™ä¸ªé¡¹ç›®çœŸçš„ä¸é”™ï¼Œæœ€åè¿˜å†™äº†å‡ ä¸ª<a href="https://github.com/marketplace/actions/hexo-action#recommand-hexo-repository-settings">å»ºè®®çš„ Hexo åšå®¢è®¾ç½®</a>ï¼Œè¿™äº›å»ºè®®ç¡®å®ä¸é”™ã€‚</p></blockquote><p>ä¸‹é¢è·Ÿç€<a href="https://github.com/marketplace/actions/hexo-action">æ–‡æ¡£</a>ï¼Œä½¿ç”¨è¿™ä¸ª Actionã€‚</p><ol><li>è®¾ç½® <code>Deploy keys</code> å’Œ <code>Secrets</code>ã€‚</li></ol><p>é¦–å…ˆåœ¨æœ¬åœ°ç”Ÿæˆä¸€å¯¹ ssh-keyï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t rsa -C <span class="string">&quot;your_username@example.com&quot;</span></span><br></pre></td></tr></table></figure><p><code>your_username@example.com</code> è¦æ—¶ä½ è‡ªå·±çš„ã€ä½ ä¹‹åè¦åœ¨ <em>Github Pages</em> ä»“åº“é‡Œæäº¤çš„ GitHub ç”¨æˆ·é‚®ç®±ã€‚</p><p>æ³¨æ„ï¼šå‚è€ƒ Issue <a href="https://github.com/sma11black/hexo-action/issues/6">SSH Key doesnt work #6</a>ï¼Œ<strong>ä¸è¦åŠ  passphrase</strong>ï¼Œè®©ä½ å¡«å†™ã€ç¡®è®¤çš„æ—¶å€™ç›´æ¥å›è½¦ã€‚æŠŠç”Ÿæˆæ–‡ä»¶ä¿å­˜åˆ°ä¸€ä¸ªä½ èƒ½æ‰¾åˆ°çš„åœ°æ–¹ï¼ˆæ¯”å¦‚æ¡Œé¢ï¼Œä¸è¦æäº¤åˆ° git ä¸­ï¼Œä¸è¦ç”¨é»˜è®¤ä½ç½®ï¼‰ã€‚</p><p>ç„¶åè®¾ç½®å…¬é’¥ï¼šå»ä½ çš„ <em>Github Pages</em> ä»“åº“ï¼Œç‚¹ <code>Settings &gt; Deploy Keys</code>ï¼Œæ–°å»ºä¸€ä¸ªï¼ŒæŠŠåˆšä»ç”Ÿæˆçš„ <code>xxx.pub</code> é‡Œé¢çš„å†…å®¹å¡«è¿›å»ã€‚</p><p>æœ€åè®¾ç½®å¯†é’¥ï¼šå»ä½ çš„ hexo åšå®¢æºæ–‡ä»¶ä»“åº“ï¼Œç‚¹ <code>Settings &gt; Secrets</code>ï¼Œæ–°å»ºä¸€ä¸ªå«åš <code>DEPLOY_KEY</code> çš„é¡¹ï¼ŒæŠŠåˆšæ‰ç”Ÿæˆçš„å¦ä¸€ä¸ªæ–‡ä»¶é‡Œçš„å†…å®¹å¡«è¿›å»ã€‚</p><ol start="2"><li>é…ç½® workflowsã€‚</li></ol><p>å» hexo åšå®¢æºæ–‡ä»¶ä»“åº“ï¼Œåœ¨ GitHub ä¸Šä»“åº“é¡µé¢ç‚¹ Actionsï¼Œæ–°å»ºä¸€ä¸ªï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh47brdrqgj319g0u07wh.jpg" alt="å±å¹•å¿«ç…§ï¼Œæ–°å»ºä¸€ä¸ª Action"></p><p>å…¶å®ä¹Ÿå¯ä»¥åœ¨ <code>.github/workflows</code> ç›®å½•é‡Œåˆ›å»ºä¸€ä¸ª  <code>.yml</code>  æ–‡ä»¶ï¼Œå¼€å§‹ç¼–è¾‘ã€‚æ˜¯ç­‰æ•ˆçš„ã€‚</p><p>ç„¶åï¼Œåœ¨ workflows é…ç½®æ–‡ä»¶ä¸­å†™å…¥ä¸‹é¢ä»£ç ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Deploy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span> [<span class="string">push</span>]</span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">A</span> <span class="string">job</span> <span class="string">to</span> <span class="string">deploy</span> <span class="string">blog.</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">actions/checkout@v1</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">submodules:</span> <span class="literal">true</span> <span class="comment"># Checkout private submodules(themes or something else).</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Caching dependencies to speed up workflows. (GitHub will remove any cache entries that have not been accessed in over 7 days.)</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Cache</span> <span class="string">node</span> <span class="string">modules</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">actions/cache@v1</span></span><br><span class="line">      <span class="attr">id:</span> <span class="string">cache</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">node_modules</span></span><br><span class="line">        <span class="attr">key:</span> <span class="string">$&#123;&#123;</span> <span class="string">runner.os</span> <span class="string">&#125;&#125;-node-$&#123;&#123;</span> <span class="string">hashFiles(&#x27;**/package-lock.json&#x27;)</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">restore-keys:</span> <span class="string">|</span></span><br><span class="line">          <span class="string">$&#123;&#123;</span> <span class="string">runner.os</span> <span class="string">&#125;&#125;-node-</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">Dependencies</span></span><br><span class="line">      <span class="attr">if:</span> <span class="string">steps.cache.outputs.cache-hit</span> <span class="type">!=</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">npm</span> <span class="string">ci</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Deploy hexo blog website.</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">(Hexo</span> <span class="string">g</span> <span class="string">-d)</span></span><br><span class="line">      <span class="attr">id:</span> <span class="string">deploy</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">sma11black/hexo-action@v1.0.2</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">deploy_key:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.DEPLOY_KEY</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">user_name:</span> <span class="string">your_username</span></span><br><span class="line">        <span class="attr">user_email:</span> <span class="string">your_username@example.com</span></span><br><span class="line">        <span class="attr">commit_msg:</span> <span class="string">$&#123;&#123;</span> <span class="string">github.event.head_commit.message</span> <span class="string">&#125;&#125;</span>  <span class="comment"># (or delete this input setting to use hexo default settings)</span></span><br><span class="line">    <span class="comment"># Use the output from the `deploy` step(use for test action)</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Get</span> <span class="string">the</span> <span class="string">output</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">        <span class="string">echo</span> <span class="string">&quot;$<span class="template-variable">&#123;&#123; steps.deploy.outputs.notify &#125;&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„æŠŠ user_nameã€user_email æ¢æˆä½ åˆšæ‰åˆ›å»º ssh-key çš„é‚£ä¸ªã€‚</p><p>æŠŠç¼–è¾‘å¥½çš„é…ç½®æäº¤ä¸Šï¼Œå°±å®Œæˆäº†ï¼ä»¥åæ¯æ¬¡ä½  git push åˆ° GitHubï¼Œåšå®¢ç½‘ç«™å°±è‡ªåŠ¨æ›´æ–°äº†ï¼</p><h2 id="è¸©å‘"><a href="#è¸©å‘" class="headerlink" title="è¸©å‘"></a>è¸©å‘</h2><ol><li><strong>Action å†…éƒ¨æ— æ³•è®¿é—® GitHub</strong></li></ol><p>ç°åœ¨ git push æ—¶ï¼Œä½ å¯èƒ½å‘ç° Github å‘é‚®ä»¶å‘Šè¯‰ä½ è¿è¡Œå¤±è´¥äº†ï¼æ‰“å¼€çœ‹ç»“æœæ—¥å¿—é‡Œä¼šå‘ç°çˆ†å‡ºäº† è¿™ç§é”™è¯¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fatal: could not read Username for &#39;https:&#x2F;&#x2F;github.com&#39;: No such device or address</span><br></pre></td></tr></table></figure><p>é¦–å…ˆç¡®å®šä¹‹å‰çš„æ­¥éª¤æ­£ç¡®æ— è¯¯ï¼Œå°¤å…¶æ˜¯ user_email é…ç½®å’Œç”Ÿæˆçš„ ssh-key ä¸€è‡´ï¼Œä¸” publish keyã€private key è®¾ç½®æ­£ç¡®ã€‚</p><p>å¦‚æœè¿™äº›éƒ½ç¡®è®¤æ­£ç¡®æ— è¯¯ï¼Œè¯·å‚è€ƒ<a href="https://github.com/sma11black/hexo-action/issues/5">sma11black/hexo-action Issue #5</a>ï¼Œåœ¨ä½ çš„ hexo é…ç½®æ–‡ä»¶ <code>_config.yml</code> ä¸­ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æŠŠ deploy repo çš„ URL ä» <strong>HTTPS</strong> çš„æ¢æˆ <strong>SSH</strong> çš„ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">git@github.com:&lt;username&gt;/&lt;username&gt;.github.io.git</span></span><br><span class="line">  <span class="comment"># æ”¹ä¹‹å‰æ˜¯ https://github.com/...</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè§£å†³äº†æˆ‘çš„é—®é¢˜ã€‚</p><ol start="2"><li><strong>åšå®¢å‘å¸ƒæ—¶é—´é”™ä¹±</strong></li></ol><p>ä¹‹å‰æåˆ°è¿‡ï¼Œæˆ‘å¹³æ—¶å†™æ–‡ç« éƒ½æ˜¯ç›´æ¥æ‰“å¼€ Typora å°±å†™ï¼Œæ¯”å¦‚ç°åœ¨ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh48f31zmjj315b0u0dwz.jpg" alt="æœ¬æ–‡å†™ä½œè¿‡ç¨‹ä¸­ typora çš„å±å¹•å¿«ç…§"></p><p>ä½ å¯ä»¥çœ‹åˆ°æˆ‘æ˜¯æ²¡ä¿å­˜çš„ï¼Œå†™å®Œä¹‹åæˆ‘ä¼šæ‰‹åŠ¨åœ¨æ–‡ç« å¼€å¤´å†™ YAML é…ç½®ï¼Œç„¶åæ‰”åˆ° <code>_post</code> é‡Œï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">GitHub</span> <span class="string">Actions</span> <span class="string">å®è·µ:</span> <span class="string">Hexo</span> <span class="string">GitHub</span> <span class="string">Pages</span> <span class="string">åšå®¢æŒç»­éƒ¨ç½²</span></span><br><span class="line"><span class="attr">tags:</span> <span class="string">blog</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><p>å…¶å®æ›´ä¸€èˆ¬çš„ï¼Œå› ä¸ºæ‡’ï¼Œæˆ‘å°±å†™ä¸ª titleğŸ˜‚ï¼ˆæœ‰æ—¶å€™ç”šè‡³è¿ title éƒ½å¿˜è®°å†™ï¼‰ã€‚ä½†å¦‚æœä½ ç”¨ <code>hexo new</code>ã€<code>hexo publish</code> å»æ–°å»ºã€å…¬å¼€æ–‡ç« çš„è¯ï¼Œhexoç»™ä½ è‡ªåŠ¨å®Œæˆçš„é…ç½®é‡Œè¿˜ä¼šå¤šä¸€é¡¹ <code>date</code> å†™ä¸Šæ–‡ç« åˆ›å»ºçš„æ—¶é—´ã€‚ç”Ÿæˆç½‘é¡µæ—¶ï¼Œä¼šæ ¹æ®è¿™ä¸ª date æ¥ç¡®å®šæ–‡ç« æ—¥æœŸï¼›å¯¹äºæ²¡å†™dateæ ‡ç­¾çš„æ–‡ç« ï¼Œå®ƒä¼šè‡ªåŠ¨æŠŠæ–‡ç« å‘å¸ƒæ—¶é—´è®¾ç½®æˆä½ ç³»ç»Ÿä¸Šæ–‡ä»¶åˆ›å»ºçš„æ—¶é—´ã€‚</p><p>æˆ‘ä»¥å‰éƒ½å¿½ç•¥äº†è¿™ä¸ª dateï¼Œè¿™å¯¹äºåœ¨æœ¬åœ°ç”Ÿæˆæ˜¯æ²¡é—®é¢˜çš„ï¼Œå› ä¸ºæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­ä¿å­˜ç€æ–‡ä»¶åˆ›å»ºçš„æ—¶é—´ä¿¡æ¯ã€‚ä½†æ˜¯ä¸€ç”¨ä¸Šåˆšæ‰å†™å¥½çš„æŒç»­éƒ¨ç½²ï¼Œæˆ‘å‘ç°ä¸€å¤§å †è¿™ç§æ‰‹åŠ¨å»ºç«‹æ–‡ä»¶çš„æ–‡ç« å‘å¸ƒæ—¶é—´å…¨å˜æˆäº†æœ€åä¸€æ¬¡è‡ªåŠ¨éƒ¨ç½²çš„æ—¶é—´ã€‚æ¯”å¦‚æˆ‘ 7æœˆ24æ—¥ git pushäº†ï¼Œç„¶åè‡ªåŠ¨éƒ¨ç½²æ‰§è¡Œï¼Œä¸€å¤§å †æ–‡ç« çš„åˆ›å»ºæ—¶é—´å…¨å˜æˆäº†7æœˆ24æ—¥ğŸ˜±ã€‚</p><p>è¿™ä¸ªé—®é¢˜æ˜¯ç”±äºï¼ŒGitHub Actions æ˜¯åœ¨å®¹å™¨å†…è·‘çš„å˜›ï¼Œå®ƒè¿è¡Œæ—¶æŠŠæºç ä» GitHub å¤åˆ¶åˆ°å®¹å™¨å†…ï¼Œæ‰€ä»¥æ–‡ä»¶çš„åˆ›å»ºæ—¶é—´å…¨éƒ¨æ—¶è¿è¡Œçš„æ—¶é—´ã€‚ç„¶åç”Ÿæˆã€å‘å¸ƒï¼Œè¿™äº›æ²¡å†™ date æ ‡ç­¾çš„æ–‡ç« å°±éƒ½å˜æˆäº†â€œæ–°â€å†™çš„ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦ç»™æ‰€æœ‰ä»¥å‰æ²¡å†™ date çš„æ–‡ç« è¡¥ä¸Šè¿™ä¸ªé…ç½®ã€‚è¿˜æ˜¯å¾ˆå®¹æ˜“çš„ï¼Œåªè¦æ‰¾åˆ°è¿™äº›æ²¡å†™ date çš„æ–‡ç« ï¼Œç„¶ååœ¨ç³»ç»Ÿä¸­æŸ¥çœ‹æ–‡ä»¶å±æ€§é‡Œçš„åˆ›å»ºæ—¶é—´ï¼Œè¡¥ä¸Šå°±å¥½ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh4960r7kpj31po0qa458.jpg" alt="æŸ¥çœ‹æ–‡ä»¶å±æ€§é‡Œçš„åˆ›å»ºæ—¶é—´ï¼Œåœ¨æ–‡ä»¶ä¸­è¡¥å……date"></p><p>ä½†è¿™å¹¶ä¸æ˜¯ä¸ªå°å·¥ç¨‹å‘ï¼Œæ¶‰åŠçš„æ–‡ç« æœ‰æ•°åç¯‡ï¼Œè‚¯å®šä¸å¯èƒ½æ‰‹åŠ¨å»åšè¿™ä¸ªæ“ä½œã€‚æ‰€ä»¥ï¼Œå†™ç¨‹åºæ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼åšè¿™ä»¶äº‹çš„ç¨‹åºæ€è·¯å¦‚ä¸‹ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gh4ak19a40j30wz0u0tbm.jpg" alt="è‡ªåŠ¨å®ŒæˆYAMLä¿¡æ¯è¡¥å…¨çš„ç¨‹åºæµç¨‹å›¾"></p><p>æˆ‘ç”¨ Python å®ç°äº†è¿™ä¸ªç¨‹åºã€‚</p><h3 id="æ–‡ç« YAMLé…ç½®è¡¥å…¨è„šæœ¬"><a href="#æ–‡ç« YAMLé…ç½®è¡¥å…¨è„šæœ¬" class="headerlink" title="æ–‡ç« YAMLé…ç½®è¡¥å…¨è„šæœ¬"></a>æ–‡ç« YAMLé…ç½®è¡¥å…¨è„šæœ¬</h3><p>å› ä¸ºé…ç½®æ˜¯å†™æˆ YAML çš„å˜›ï¼Œæ‰€ä»¥è¯´ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ‰¾ä¸€ä¸ª Python çš„ YAML åº“ï¼Œæˆ‘å¯ä¸æƒ³æ‰‹å†™ä¸€ä»½ YAML è§£æã€ç”Ÿæˆçš„ä»£ç ã€‚Emmmï¼Œæˆ‘çš„ç”µè„‘ä¸Šæœ‰å…¶ä»–åº“ä¾èµ–å®‰è£…äº†ä¸€ä¸ª <a href="https://pyyaml.org/">PyYAML</a>ï¼Œæ‰€ä»¥å°±ç›´æ¥ç”¨è¿™ä¸ªäº†ã€‚å…³äº YAMLï¼Œæˆ‘ä»¬ä¸»è¦åªç”¨ä¸¤ç§åŠŸèƒ½ï¼šè§£æå’Œç”Ÿæˆï¼Œå¯ä»¥ç”¨å¦‚ä¸‹ä»£ç å®Œæˆï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml    <span class="comment"># å¯¼å…¥ PyYAML</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»å­—ç¬¦ä¸²è¯»å– YAML å†…å®¹ï¼Œè§£ææˆ Python å¯¹è±¡ï¼Œæ­£å¸¸æƒ…å†µè¿”å›ä¸€ä¸ª dictï¼š</span></span><br><span class="line">yaml.safe_load(content)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŠŠ Python å¯¹è±¡ï¼ˆä¸€èˆ¬ç”¨ä¸ª dictï¼‰è½¬åŒ–æˆ YAML å†…å®¹ï¼š</span></span><br><span class="line">content = yaml.dump(data, allow_unicode=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å°±è¦æ¥å°è£…æˆ‘ä»¬éœ€è¦çš„ä»åšå®¢æ–‡ä»¶ä¸­è¯»å–ã€å†™å…¥ YAML é…ç½®çš„å‡½æ•°äº†ï¼š</p><p>é¦–å…ˆæ˜¯è¯»å–ï¼šä»ä¸€ç¯‡æ–‡ç« ä¸­è¯»å– YAML é…ç½®ï¼Œå³åœ¨æ–‡ç« å¼€å¤´å¤„ä¸¤è¡Œ <code>---</code> ä¹‹é—´çš„ç¬¦åˆ YAML è¯­æ³•çš„é…ç½®ä¿¡æ¯ã€‚è¿”å› <code>yaml.safe_load</code> å‡ºæ¥çš„ Python å¯¹è±¡ã€åŸæ–‡ä»¶ä¸­ YAML é…ç½®çš„èµ·å§‹ç»“æŸè¡Œå·ï¼ˆä»0å¼€å§‹è®¡æ•°ï¼Œé—­åŒºé—´ï¼‰ï¼Œä»¥åŠä¸€ä¸ªä»£è¡¨æ–‡ä»¶ä¸­æ˜¯å¦å­˜åœ¨ YAML é…ç½®çš„ boolï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_yaml</span>(<span class="params">file_path</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> os.path.isfile(file_path), <span class="string">f&quot;Target file not exists: <span class="subst">&#123;file_path&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    is_yaml = <span class="literal">False</span></span><br><span class="line">    yaml_content = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    yaml_line = []</span><br><span class="line">    lines_cnt = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">            <span class="keyword">if</span> line.strip() == <span class="string">&#x27;---&#x27;</span>:</span><br><span class="line">                yaml_line.append(lines_cnt)</span><br><span class="line">                <span class="keyword">if</span> is_yaml <span class="keyword">or</span> (lines_cnt &gt; <span class="number">1</span>):</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                is_yaml = <span class="keyword">not</span> is_yaml</span><br><span class="line">            <span class="keyword">if</span> is_yaml:</span><br><span class="line">                yaml_content += line.replace(<span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;  &#x27;</span>)</span><br><span class="line">            lines_cnt += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> yaml.safe_load(yaml_content), yaml_line, <span class="built_in">len</span>(yaml_line) == <span class="number">2</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿˜æœ‰æ˜¯å†™å…¥ï¼Œåœ¨æ–‡ä»¶å¤´éƒ¨å†™å…¥ä¿¡æ¯ï¼Œå¦‚æœæ–‡ä»¶ç‰¹åˆ«å¤§è¿˜æ˜¯æœ‰ç‚¹å¤´ç–¼çš„ï¼Œ ä½†å¥½åœ¨åšå®¢æ–‡ç« ä¸å¯èƒ½å¤ªé•¿ï¼Œå¯ä»¥æš‚ä¸è€ƒè™‘æ–‡ä»¶å¤ªå¤§çš„æƒ…å†µï¼Œåªéœ€æŠŠæ–‡ç« å†…å®¹å…¨éƒ¨å…ˆè¯»å‡ºæ¥ï¼Œç„¶ååœ¨æ–‡ä»¶å¤´éƒ¨è¦†ç›–å†™å…¥ YAML é…ç½®ï¼Œå†æŠŠåŸå†…å®¹å†™å›å»ã€‚æˆ‘ä»¬éœ€è¦å†™çš„æ˜¯ä¸€ä¸ª <code>write_yaml</code>  å‡½æ•°å‘å…¶å‚æ•° file_path æŒ‡å®šçš„æ–‡ä»¶å¼€å¤´å†™å…¥ yaml_data è½¬åŒ–æˆçš„ YAML é…ç½®ä¿¡æ¯ï¼ŒYAML ä¿¡æ¯å°†è¢«å‰åå„ä¸€è¡Œ <code>---</code> æ‰€åŒ…è£¹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_yaml</span>(<span class="params">file_path, yaml_data</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">    yaml_text = yaml.dump(yaml_data, allow_unicode=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    wrapper = <span class="string">&#x27;---\n&#x27;</span></span><br><span class="line">    yaml_wrapped = wrapper + yaml_text + wrapper</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&quot;r+&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        file_content = f.read()</span><br><span class="line">        f.seek(<span class="number">0</span>)</span><br><span class="line">        f.write(yaml_wrapped)</span><br><span class="line">        f.write(file_content)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œæˆ‘ä»¬åˆšæ‰çš„ <code>write_yaml</code> å†™å…¥å¹¶æ²¡æœ‰åˆ é™¤åŸæœ‰çš„ YAML ä¿¡æ¯ï¼Œæ‰€ä»¥å¦‚æœä»¥å‰æœ‰çš„è¯å°±é‡å¤äº†ã€‚å’±ä»¬åˆšæ‰å†™çš„ <code>read_yaml</code> è¿”å›äº†æ–‡ä»¶ä¸­æ˜¯å¦æœ‰ YAMLã€YAML é…ç½®çš„å§‹æœ«ä½ç½®å¯¹å§ï¼Œä¾é è¿™ä¸¤ä¸ªï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠåŸæ¥å­˜åœ¨çš„ YAML åˆ é™¤äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove_lines</span>(<span class="params">file_path, lines_range</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">    <span class="comment"># ä» file_path æ–‡ä»¶ä¸­åˆ é™¤ lines_range æŒ‡å®šçš„è¡Œ(é—­åŒºé—´[start, end]ï¼Œä»0å¼€å§‹è®¡æ•°)</span></span><br><span class="line">    file_dir = os.path.dirname(file_path)</span><br><span class="line">    file_name = os.path.basename(file_path)</span><br><span class="line"></span><br><span class="line">    temp_file = os.path.join(file_dir, <span class="string">f&#x27;.<span class="subst">&#123;file_name&#125;</span>.tmp&#x27;</span>)</span><br><span class="line">    shutil.copy(file_path, temp_file)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(temp_file, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f_in:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f_out:</span><br><span class="line">            f_out.writelines(line <span class="keyword">for</span> i, line <span class="keyword">in</span> <span class="built_in">enumerate</span>(</span><br><span class="line">                f_in) <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">range</span>(lines_range[<span class="number">0</span>], lines_range[<span class="number">1</span>]+<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    os.remove(temp_file)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨è°ƒç”¨çš„åœ°æ–¹ï¼Œåˆ é™¤åŸæœ‰ YAML é…ç½®ï¼š</span></span><br><span class="line">data, yaml_line, has_yaml = read_yaml(article)</span><br><span class="line"><span class="keyword">if</span> has_yaml:</span><br><span class="line">remove_lines(article, yaml_line)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Okï¼ŒYAML çš„è¯»å†™å°±åšå¥½äº†ã€‚æ¥ä¸‹æ¥å†™ç”Ÿæˆ titleã€date çš„å‡½æ•°ï¼Œå¹¶å’Œæ–‡ä»¶ä¸­è¯»å–çš„åˆå¹¶ã€‚ title å–æ–‡ä»¶å <code>a.md</code> ä¸­çš„ <code>a</code>ï¼Œdate å–æ–‡ä»¶åˆ›å»ºæ—¶é—´ï¼ˆåœ¨ Mac ä¸­ï¼Œå¯ä»¥ç”¨ stat çš„ birthtime è·å–ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_creation_time</span>(<span class="params">file_path</span>):</span></span><br><span class="line">    <span class="keyword">if</span> platform.platform().find(<span class="string">&#x27;Darwin&#x27;</span>) != -<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> os.stat(file_path).st_birthtime</span><br><span class="line">    <span class="comment"># ctime: Linux æ˜¯ inode çš„ change timeï¼›æ®è¯´ Windows æ˜¯ creation time</span></span><br><span class="line">    <span class="keyword">return</span> os.path.getctime(file_path)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_base_conf</span>(<span class="params">file_path</span>) -&gt; dict:</span></span><br><span class="line">    title = os.path.basename(file_path)</span><br><span class="line">    title_list = title.split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(title_list) &gt; <span class="number">1</span>:</span><br><span class="line">        title = <span class="string">&#x27;&#x27;</span>.join(title_list[:-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    creation_time = get_creation_time(file_path)</span><br><span class="line">    date = datetime.datetime.fromtimestamp(creation_time)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;title&#x27;</span>: title, <span class="string">&#x27;date&#x27;</span>: date&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨è°ƒç”¨çš„åœ°æ–¹ï¼Œåˆå¹¶é…ç½®ä¿¡æ¯ï¼š</span></span><br><span class="line">conf = generate_base_conf(article)</span><br><span class="line">data, yaml_line, has_yaml = read_yaml(article)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">isinstance</span>(data, <span class="built_in">dict</span>):</span><br><span class="line">    conf.update(data)</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªå¯»æ‰¾æ‰€æœ‰åšå®¢æ–‡ç« æ–‡ä»¶çš„å‡½æ•°ï¼Œç„¶åéå†æ–‡ç« ï¼Œå®Œæˆå¤„ç†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md_files_gen</span>(<span class="params"><span class="built_in">dir</span>, file_filter=<span class="keyword">lambda</span> fp: <span class="literal">True</span></span>):</span></span><br><span class="line">    <span class="comment"># è¿”å›ä¸€ä¸ª generatorï¼Œç”Ÿæˆ dir ç›®å½•ä¸‹æ‰€æœ‰ä½¿ file_filter è¿”å› True çš„ .md æ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line">    <span class="keyword">for</span> dirpath, dirnames, filenames <span class="keyword">in</span> os.walk(<span class="built_in">dir</span>):</span><br><span class="line">        <span class="keyword">for</span> filename <span class="keyword">in</span> filenames:</span><br><span class="line">            <span class="keyword">if</span> filename.lower().endswith(<span class="string">&#x27;.md&#x27;</span>):</span><br><span class="line">                file_path = os.path.join(dirpath, filename)</span><br><span class="line">                <span class="keyword">if</span> file_filter(file_path):</span><br><span class="line">                    <span class="keyword">yield</span> file_path</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">complete_yaml4blogs</span>(<span class="params"><span class="built_in">dir</span></span>):</span></span><br><span class="line">    blogs = md_files_gen(<span class="built_in">dir</span>)</span><br><span class="line">    <span class="keyword">for</span> article <span class="keyword">in</span> blogs:</span><br><span class="line">        print(article)</span><br><span class="line">        conf = generate_base_conf(article)</span><br><span class="line">        data, yaml_line, has_yaml = read_yaml(article)</span><br><span class="line">        <span class="keyword">if</span> has_yaml:</span><br><span class="line">            remove_lines(article, yaml_line)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(data, <span class="built_in">dict</span>):</span><br><span class="line">            conf.update(data)</span><br><span class="line">        write_yaml(article, conf)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€åè°ƒç”¨ complete_yaml4blogs å°±å¯ä»¥å®Œæˆå·¥ä½œäº†ï¼š</span></span><br><span class="line">complete_yaml4blogs(<span class="string">&#x27;/Users/foo/hexo-blog/source&#x27;</span>)</span><br></pre></td></tr></table></figure><p>P.S. <code>md_files_gen</code> çš„ <code>file_filter</code> æ˜¯ä¸ºäº†æ–¹ä¾¿æ—¥åæ‹“å±•ä½¿ç”¨è€Œåšçš„ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªä¸œè¥¿è¿‡æ»¤ï¼Œåªå¤„ç†æœ€è¿‘ä¸€ä¸ªæœˆå†…çš„æ–°æ–‡ä»¶ã€‚</p><p>å®Œæ•´çš„ä»£ç æˆ‘æ”¾å»ä¸€ä¸ª Gist äº†ï¼š<a href="https://gist.github.com/cdfmlr/d5a40f670ab71512511a63bf94d8d424">cdfmlr/complete_yaml4blogs.py</a>ã€‚</p><script src="https://gist.github.com/cdfmlr/d5a40f670ab71512511a63bf94d8d424.js"></script><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>å•§ï¼Œè¿™ç¯‡æ–‡ç« å†™çš„ï¼Œï¼Œç»“æ„å¥½åƒæœ‰ç‚¹é—®é¢˜ã€‚æœ¬æ¥æ˜¯ä»‹ç»ç”¨ GitHub Actions çš„ï¼Œå´èŠ±äº†å¤§é‡çš„ç¯‡å¹…ä»‹ç»æˆ‘æ€ä¹ˆå¤„ç†å·æ‡’é€ æˆçš„ bug ğŸ˜‚ã€‚ä¸ç®¡äº†ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜è¿˜æ˜¯å¾ˆæœ‰è¶£çš„ï¼Œç»ƒä¹ ä¸€ä¸‹ Python æ–‡ä»¶æ“ä½œï¼Œè¿˜é¡ºä¾¿å­¦äº†ä¸ª PyYAML åº“ï¼Œä¹Ÿä¸äºå§ã€‚</p><hr><p>æœ¬æ–‡ç”± CDFMLR åŸåˆ›ï¼Œæ”¶å½•äºä¸ªäººåšå®¢ <a href="https://clownote.github.io./">https://clownote.github.ioã€‚</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Pythonæ·±åº¦å­¦ä¹ ä¹‹æœºå™¨å­¦ä¹ åŸºç¡€</title>
      <link href="/2020/07/10/DeepLearningWithPython/Deep-Learning%20with-Python-ch4/"/>
      <url>/2020/07/10/DeepLearningWithPython/Deep-Learning%20with-Python-ch4/</url>
      
        <content type="html"><![CDATA[<h1 id="Deep-Learning-with-Python"><a href="#Deep-Learning-with-Python" class="headerlink" title="Deep Learning with Python"></a>Deep Learning with Python</h1><p>è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘å­¦ä¹ ã€ŠDeep Learning with Pythonã€‹(ç¬¬äºŒç‰ˆï¼ŒFranÃ§ois Chollet è‘—) æ—¶å†™çš„ç³»åˆ—ç¬”è®°ä¹‹ä¸€ã€‚æ–‡ç« çš„å†…å®¹æ˜¯ä»  Jupyter notebooks è½¬æˆ Markdown çš„ï¼Œå½“æˆ‘å®Œæˆæ‰€ä»¥æ–‡ç« åï¼Œä¼šåœ¨ GitHub å‘å¸ƒæˆ‘å†™çš„æ‰€æœ‰  Jupyter notebooksã€‚</p><p>ä½ å¯ä»¥åœ¨è¿™ä¸ªç½‘å€åœ¨çº¿é˜…è¯»è¿™æœ¬ä¹¦çš„æ­£ç‰ˆåŸæ–‡(è‹±æ–‡)ï¼š<a href="https://livebook.manning.com/book/deep-learning-with-python">https://livebook.manning.com/book/deep-learning-with-python</a></p><p>è¿™æœ¬ä¹¦çš„ä½œè€…ä¹Ÿç»™å‡ºäº†ä¸€å¥— Jupyter notebooksï¼š<a href="https://github.com/fchollet/deep-learning-with-python-notebooks">https://github.com/fchollet/deep-learning-with-python-notebooks</a></p><hr><p>æœ¬æ–‡ä¸º <strong>ç¬¬4ç«  æœºå™¨å­¦ä¹ åŸºç¡€</strong> (Chapter 4. Fundamentals of machine learning) çš„ç¬”è®°æ•´åˆã€‚</p><p>æœ¬æ–‡ç›®å½•ï¼š</p><p>[TOC]</p><h2 id="æœºå™¨å­¦ä¹ çš„å››ä¸ªåˆ†æ”¯"><a href="#æœºå™¨å­¦ä¹ çš„å››ä¸ªåˆ†æ”¯" class="headerlink" title="æœºå™¨å­¦ä¹ çš„å››ä¸ªåˆ†æ”¯"></a>æœºå™¨å­¦ä¹ çš„å››ä¸ªåˆ†æ”¯</h2><blockquote><p>4.1 Four branches of machine learning</p></blockquote><ol><li>ç›‘ç£å­¦ä¹ </li><li>æ— ç›‘ç£å­¦ä¹ </li><li>è‡ªç›‘ç£å­¦ä¹ </li><li>å¼ºåŒ–å­¦ä¹ </li></ol><h2 id="æœºå™¨å­¦ä¹ æ¨¡å‹è¯„ä¼°"><a href="#æœºå™¨å­¦ä¹ æ¨¡å‹è¯„ä¼°" class="headerlink" title="æœºå™¨å­¦ä¹ æ¨¡å‹è¯„ä¼°"></a>æœºå™¨å­¦ä¹ æ¨¡å‹è¯„ä¼°</h2><blockquote><p>4.2 Evaluating machine-learning models</p></blockquote><h3 id="è®­ç»ƒé›†ã€éªŒè¯é›†å’Œæµ‹è¯•é›†"><a href="#è®­ç»ƒé›†ã€éªŒè¯é›†å’Œæµ‹è¯•é›†" class="headerlink" title="è®­ç»ƒé›†ã€éªŒè¯é›†å’Œæµ‹è¯•é›†"></a>è®­ç»ƒé›†ã€éªŒè¯é›†å’Œæµ‹è¯•é›†</h3><ul><li>è®­ç»ƒé›†ï¼šç”¨æ¥å­¦ä¹ å‚æ•°ï¼ˆç½‘ç»œé‡Œå„èŠ‚ç‚¹çš„æƒé‡ï¼‰ï¼›</li><li>éªŒè¯é›†ï¼šç”¨æ¥å­¦ä¹ è¶…å‚æ•°ï¼ˆç½‘ç»œçš„æƒé‡ï¼Œæ¯”å¦‚å±‚æ•°ã€å±‚çš„å¤§å°è¿™ç§ï¼‰ï¼›</li><li>æµ‹è¯•é›†ï¼šç”¨æ¥éªŒè¯ç»“æœï¼Œè¦ä¿è¯æ¨¡å‹ä»æœªè§è¿‡è¿™äº›æ•°æ®ã€‚</li></ul><p>æµ‹è¯•é›†å¿…é¡»æ˜¯å•ç‹¬åˆ†å‡ºæ¥çš„ï¼Œè®­ç»ƒé›†ã€æµ‹è¯•é›†ä¸­ä¸èƒ½å’Œæµ‹è¯•é›†æœ‰é‡åˆã€‚</p><p>æœ€å¥½çš„åšæ³•æ˜¯ï¼Œå…ˆæŠŠæ‰€æœ‰æ•°æ®åˆ†æˆè®­ç»ƒé›†å’Œæµ‹è¯•é›†ã€‚ç„¶åä»è®­ç»ƒé›†é‡Œåˆ†ä¸€éƒ¨åˆ†å‡ºæ¥åšéªŒè¯é›†ã€‚</p><p>ä»¥ä¸‹æ˜¯å‡ ç§é€‰æ‹©éªŒè¯é›†çš„æ–¹æ³•ï¼š</p><h4 id="ç®€å•ç•™å‡ºéªŒè¯"><a href="#ç®€å•ç•™å‡ºéªŒè¯" class="headerlink" title="ç®€å•ç•™å‡ºéªŒè¯"></a>ç®€å•ç•™å‡ºéªŒè¯</h4><blockquote><p>SIMPLE HOLD-OUT VALIDATION</p></blockquote><p>å°±æ˜¯ç®€å•çš„ä»è®­ç»ƒé›†é‡Œç•™å‡ºä¸€éƒ¨åˆ†æ¥åšéªŒè¯é›†ã€‚</p><p>å¯ç”¨çš„æ•°æ®å¤šçš„æ—¶å€™æ‰èƒ½ç”¨è¿™ä¸ªã€‚ä¸ç„¶æ•°æ®å°‘äº†ï¼Œåˆ†å‡ºæ¥çš„éªŒè¯é›†å°±å¤ªå°ï¼Œä¸å¤Ÿä¸€èˆ¬ï¼Œæ•ˆæœä¸å¥½ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggkhlemz7cj31io0k0n02.jpg" alt="ç®€å•ç•™å‡ºéªŒè¯çš„ç¤ºæ„å›¾"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Hold-out validation</span></span><br><span class="line"></span><br><span class="line">num_validation_samples = <span class="number">10000</span></span><br><span class="line"></span><br><span class="line">np.random.shuffle(data)    <span class="comment"># æ´—ç‰Œï¼Œæ‰“ä¹±æ•°æ®</span></span><br><span class="line"></span><br><span class="line">validation_data = data[:num_validation_samples]    <span class="comment">#å®šä¹‰éªŒè¯é›†</span></span><br><span class="line">data = data[num_validation_samples:]</span><br><span class="line"></span><br><span class="line">training_data = data[:]    <span class="comment"># å®šä¹‰è®­ç»ƒé›†</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨è®­ç»ƒé›†è®­ç»ƒæ¨¡å‹ï¼Œåœ¨éªŒè¯é›†è¯„ä¼°</span></span><br><span class="line">model = get_model()</span><br><span class="line">model.train(training_data)</span><br><span class="line">validation_score = model.evaluate(validation_data)</span><br><span class="line"></span><br><span class="line"><span class="comment">## ç„¶åè¿™é‡Œå¯ä»¥æ ¹æ®ç»“æœè°ƒæ•´æ¨¡å‹ï¼Œ</span></span><br><span class="line"><span class="comment">## ç„¶åé‡æ–°è®­ç»ƒã€è¯„ä¼°ï¼Œç„¶åå†æ¬¡è°ƒæ•´...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨è°ƒæ•´å¥½è¶…å‚æ•°ä¹‹åï¼Œç”¨é™¤äº†æµ‹è¯•é›†çš„æ‰€æœ‰æ•°æ®æ¥è®­ç»ƒæœ€ç»ˆæ¨¡å‹</span></span><br><span class="line">model = get_model()</span><br><span class="line">model.train(np.concatenate([training_data, validation_data]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨æµ‹è¯•é›†æ¥è¯„ä¼°æœ€ç»ˆæ¨¡å‹</span></span><br><span class="line">test_score = model.evaluate(test_data)</span><br></pre></td></tr></table></figure><h4 id="KæŠ˜éªŒè¯"><a href="#KæŠ˜éªŒè¯" class="headerlink" title="KæŠ˜éªŒè¯"></a>KæŠ˜éªŒè¯</h4><blockquote><p>K-FOLD VALIDATION</p></blockquote><p>è¿™ä¸ªæ–¹æ³•æ˜¯æŠŠæ•°æ®ç­‰åˆ†æˆ K ä»½ã€‚å¯¹æ¯ä¸ªéƒ¨åˆ† iï¼Œåœ¨å‰©ä¸‹çš„ K-1 ä¸ªéƒ¨åˆ†é‡Œè®­ç»ƒï¼Œåœ¨ i ä¸ŠéªŒè¯è¯„ä¼°ã€‚æœ€ç»ˆéªŒè¯çš„ç»“æœå– K æ¬¡çš„éªŒè¯å€¼çš„å¹³å‡ã€‚</p><p>è¿™ç§æ–¹æ³•å¯¹ä¸åŒçš„è®­ç»ƒã€éªŒè¯é›†åˆ’åˆ†å¯¹ç»“æœå½±å“æ¯”è¾ƒå¤§æ—¶ä¼šå¾ˆæœ‰æ•ˆï¼ˆæ¯”å¦‚æ•°æ®æ¯”è¾ƒå°‘çš„æ—¶å€™ï¼‰</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggki8sc8x0j31os0u0q90.jpg" alt="KæŠ˜éªŒè¯ç¤ºæ„å›¾"></p><p>emmmï¼Œæˆ‘è§‰å¾—è¿™ä¸ªå›¾æœ‰ç‚¹é—®é¢˜ï¼Œåº”è¯¥é™¤äº†é‚£äº›ç°è‰²çš„æ˜¯ Validationï¼Œç™½çš„åº”è¯¥éƒ½æ˜¯ Trainingã€‚ï¼ˆä¸­æ–‡è¯‘æœ¬ä¸Šå°±æ˜¯è¿™ç§ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># K-fold cross-validation</span></span><br><span class="line"></span><br><span class="line">k = <span class="number">4</span></span><br><span class="line">num_validation_samples = <span class="built_in">len</span>(data) // k</span><br><span class="line"></span><br><span class="line">np.random.shuffle(data)</span><br><span class="line"></span><br><span class="line">validation_scores = []</span><br><span class="line"><span class="keyword">for</span> fold <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">    <span class="comment"># é€‰æ‹©éªŒè¯é›†</span></span><br><span class="line">    validation_data = data[num_validation_samples * fold:</span><br><span class="line">                           num_validation_samples * (fold + <span class="number">1</span>)]</span><br><span class="line">    <span class="comment"># ç”¨å‰©ä¸‹çš„åšè®­ç»ƒé›†</span></span><br><span class="line">    training_data = data[:num_validation_samples * fold] + </span><br><span class="line">                    data[num_validation_samples * (fold + <span class="number">1</span>):]</span><br><span class="line">    </span><br><span class="line">    model = get_model()    <span class="comment"># æ³¨æ„æ˜¯ç”¨ä¸ªå…¨æ–°çš„æ¨¡å‹</span></span><br><span class="line">    </span><br><span class="line">    model.train(training_data)</span><br><span class="line">    </span><br><span class="line">    validation_score = model.evaluate(validation_data)</span><br><span class="line">    validation_scores.append(validation_score)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ€»çš„éªŒè¯å€¼æ˜¯æ‰€æœ‰çš„å¹³å‡</span></span><br><span class="line">validation_score = np.average(validation_scores)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç„¶åæ ¹æ®ç»“æœåšå„ç§è¶…å‚æ•°è°ƒæ•´å•¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€ååœ¨é™¤äº†æµ‹è¯•é›†çš„æ‰€æœ‰æ•°æ®ä¸Šè®­ç»ƒ</span></span><br><span class="line">model = get_model()</span><br><span class="line">model.train(data)</span><br><span class="line">test_score = model.evaluate(test_data)</span><br></pre></td></tr></table></figure><h4 id="å¸¦æœ‰æ‰“ä¹±æ•°æ®çš„é‡å¤KæŠ˜éªŒè¯"><a href="#å¸¦æœ‰æ‰“ä¹±æ•°æ®çš„é‡å¤KæŠ˜éªŒè¯" class="headerlink" title="å¸¦æœ‰æ‰“ä¹±æ•°æ®çš„é‡å¤KæŠ˜éªŒè¯"></a>å¸¦æœ‰æ‰“ä¹±æ•°æ®çš„é‡å¤KæŠ˜éªŒè¯</h4><blockquote><p>ITERATED K-FOLD VALIDATION WITH SHUFFLING</p></blockquote><p>å°±æ˜¯é‡å¤è·‘ P æ¬¡ KæŠ˜éªŒè¯ï¼Œæ¯æ¬¡å¼€å§‹å‰æ´—ç‰Œã€‚</p><p>è¿™ä¸ªæ˜¯æ•°æ®æ¯”è¾ƒå°‘ï¼Œåˆè¦æ±‚å°½å¯èƒ½ç²¾ç¡®çš„æ—¶å€™ç”¨çš„ã€‚è¦è·‘ P*K æ¬¡ï¼Œæ‰€ä»¥æ¯”è¾ƒè€—æ—¶ã€‚</p><p>ä¹¦ä¸Šæ²¡ç»™è¿™ä¸ªçš„ä»£ç ï¼Œå°±æ˜¯åœ¨ KæŠ˜ çš„åŸºç¡€ä¸Šå†åŠ ä¸€å±‚å¾ªç¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ITERATED K-FOLD VALIDATION WITH SHUFFLING</span></span><br><span class="line"></span><br><span class="line">p = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">k = <span class="number">4</span></span><br><span class="line">num_validation_samples = <span class="built_in">len</span>(data) // k</span><br><span class="line"></span><br><span class="line">total_validation_scores = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(p):</span><br><span class="line">    np.random.shuffle(data)</span><br><span class="line">    </span><br><span class="line">    validation_scores = []</span><br><span class="line">    <span class="keyword">for</span> fold <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">        <span class="comment"># <span class="doctag">TODO:</span> KæŠ˜éªŒè¯çš„é‚£å †ä»£ç </span></span><br><span class="line">    </span><br><span class="line">    validation_score = np.average(validation_scores)</span><br><span class="line">    total_validation_scores.append(validation_score)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># æ€»çš„éªŒè¯å€¼æ˜¯æ‰€æœ‰çš„å¹³å‡</span></span><br><span class="line">validation_score = np.average(total_validation_scores)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç„¶åæ ¹æ®ç»“æœåšå„ç§è¶…å‚æ•°è°ƒæ•´å•¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€ååœ¨é™¤äº†æµ‹è¯•é›†çš„æ‰€æœ‰æ•°æ®ä¸Šè®­ç»ƒ</span></span><br><span class="line">model = get_model()</span><br><span class="line">model.train(data)</span><br><span class="line">test_score = model.evaluate(test_data)</span><br></pre></td></tr></table></figure><h3 id="åˆ’åˆ†æ—¶çš„æ³¨æ„äº‹é¡¹"><a href="#åˆ’åˆ†æ—¶çš„æ³¨æ„äº‹é¡¹" class="headerlink" title="åˆ’åˆ†æ—¶çš„æ³¨æ„äº‹é¡¹"></a>åˆ’åˆ†æ—¶çš„æ³¨æ„äº‹é¡¹</h3><ul><li><strong>æ•°æ®ä»£è¡¨æ€§</strong>ï¼šè®­ç»ƒé›†å’Œæµ‹è¯•é›†éƒ½è¦å¯ä»¥ä»£è¡¨æ‰€æœ‰æ•°æ®ã€‚æ¯”å¦‚åšæ•°å­—è¯†åˆ«ï¼Œä¸èƒ½è®­ç»ƒé›†é‡Œåªæœ‰ 0ï½7ï¼Œæµ‹è¯•é›†é‡Œå…¨æ˜¯ 8ï½9ã€‚åšè¿™ç§ä¹‹å‰è¦æŠŠæ‰€æœ‰æ•°æ®éšæœºæ´—ç‰Œæ‰“ä¹±ï¼Œç„¶åå†åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›†ã€‚</li><li><strong>æ—¶é—´ç®­å¤´</strong>ï¼šå¦‚æœæ˜¯é‚£ç§åšè·Ÿæ—¶é—´æœ‰å…³çš„é¢„æµ‹ï¼ˆç»™è¿‡å»çš„ï¼Œé¢„æµ‹æœªæ¥çš„ï¼‰ï¼Œå¼€å§‹ä¹‹å‰<strong>ä¸è¦æ‰“ä¹±æ•°æ®</strong>ï¼Œè¦ä¿æŒæ•°æ®çš„æ—¶é—´é¡ºåºï¼ˆæ‰“ä¹±äº†ä¼šæ—¶é—´æ³„éœ²ï¼Œå°±æ˜¯æ¨¡å‹ä»â€œæœªæ¥â€å­¦ä¹ äº†ï¼‰ï¼Œå¹¶ä¸”æµ‹è¯•é›†çš„æ•°æ®è¦æ™šäºè®­ç»ƒé›†ã€‚</li><li><strong>æ•°æ®å†—ä½™</strong>ï¼šå¦‚æœæ•°æ®æœ‰é‡å¤ï¼Œéšæœºæ‰“ä¹±ä¹‹åï¼ŒåŒæ ·çš„æ•°æ®å°±å¯èƒ½åŒæ—¶å‡ºç°åœ¨è®­ç»ƒã€éªŒè¯ã€æµ‹è¯•é›†é‡Œäº†ã€‚è¿™ç§æƒ…å†µä¼šå½±å“ç»“æœï¼Œè®­ç»ƒå’ŒéªŒè¯é›†ä¸èƒ½æœ‰äº¤é›†ã€‚</li></ul><h2 id="æ•°æ®é¢„å¤„ç†ã€ç‰¹å¾å·¥ç¨‹å’Œç‰¹å¾å­¦ä¹ "><a href="#æ•°æ®é¢„å¤„ç†ã€ç‰¹å¾å·¥ç¨‹å’Œç‰¹å¾å­¦ä¹ " class="headerlink" title="æ•°æ®é¢„å¤„ç†ã€ç‰¹å¾å·¥ç¨‹å’Œç‰¹å¾å­¦ä¹ "></a>æ•°æ®é¢„å¤„ç†ã€ç‰¹å¾å·¥ç¨‹å’Œç‰¹å¾å­¦ä¹ </h2><blockquote><p>4.3 Data preprocessing, feature engineering, and feature learning</p></blockquote><h3 id="æ•°æ®é¢„å¤„ç†"><a href="#æ•°æ®é¢„å¤„ç†" class="headerlink" title="æ•°æ®é¢„å¤„ç†"></a>æ•°æ®é¢„å¤„ç†</h3><ol><li><p>VECTORIZATION å‘é‡åŒ–ï¼šå–‚ç»™ç¥ç»ç½‘ç»œçš„æ•°æ®éƒ½è¦æ˜¯æµ®ç‚¹æ•°çš„å¼ é‡ï¼ˆæœ‰æ—¶å€™ä¹Ÿå¯ä»¥æ˜¯æ•´æ•°çš„ï¼‰ï¼Œæˆ‘ä»¬è¦æŠŠå„ç§çœŸå®çš„æ•°æ®ï¼Œæ¯”å¦‚æ–‡æœ¬ã€å›¾åƒå…¨å˜æˆå¼ é‡ã€‚</p></li><li><p>VALUE NORMALIZATION å€¼æ ‡å‡†åŒ–ï¼šä¸ºäº†åˆ©äºè®­ç»ƒå’Œç»“æœï¼Œæˆ‘ä»¬è¦è®©æ•°æ®ç¬¦åˆä»¥ä¸‹æ ‡å‡†ï¼š</p><ul><li>å–å€¼å°ï¼Œä¸€èˆ¬å°± 0~1ï¼›</li><li>åŒè´¨æ€§ï¼Œå³æ‰€æœ‰ç‰¹å¾çš„å–å€¼èŒƒå›´å¤§è‡´ç›¸ç­‰ï¼›</li></ul></li></ol><p>å¦‚æœä¸¥æ ¼ä¸€ç‚¹ï¼ˆä½†ä¸æ˜¯å¿…é¡»çš„ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ•°æ®é‡Œçš„ç‰¹å¾åˆ†åˆ«å¤„ç†æˆå¹³å‡å€¼ä¸º 0ï¼Œæ ‡å‡†å·®ä¸º 1 çš„ã€‚ç”¨ Numpy æè¿™ä¸ªå¾ˆç®€å•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># x æ˜¯äºŒç»´çš„ï¼š(samples, features)</span></span><br><span class="line">x -= x.mean(axis=<span class="number">0</span>)</span><br><span class="line">x /= x.std(axis=<span class="number">0</span>)</span><br></pre></td></tr></table></figure><ol start="3"><li>HANDLING MISSING VALUES ç¼ºå¤±å€¼å¤„ç†ï¼šä¸€èˆ¬æ¥è¯´ï¼Œåªè¦ 0 ä¸æ˜¯æœ‰æ„ä¹‰çš„å€¼ï¼Œå°±å¯ä»¥ç”¨ 0 æ¥ä»£æ›¿ç¼ºå¤±å€¼ã€‚ç½‘ç»œå¯ä»¥å­¦ä¼š 0 æ˜¯ç¼ºå¤±çš„è¿™ç§æ„æ€çš„ã€‚è¿˜æœ‰å¦‚æœä½ çš„æµ‹è¯•é›†æ˜¯æœ‰ç¼ºå¤±æƒ…å†µçš„ï¼Œä½†è®­ç»ƒé›†æ²¡æœ‰ï¼Œå°±è¦æ‰‹åŠ¨åŠ äº›äººå·¥æ•°æ®å»è®©ç½‘ç»œå­¦ä¼šç¼ºå¤±æƒ…å†µã€‚</li></ol><h3 id="ç‰¹å¾å·¥ç¨‹"><a href="#ç‰¹å¾å·¥ç¨‹" class="headerlink" title="ç‰¹å¾å·¥ç¨‹"></a>ç‰¹å¾å·¥ç¨‹</h3><p>ç‰¹å¾å·¥ç¨‹(feature engineering)ï¼Œå°±æ˜¯åœ¨å¼€å§‹è®­ç»ƒä¹‹å‰ï¼Œæ‰‹åŠ¨å¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå¾—åˆ°ä¸€ç§æ˜“äºæœºå™¨å­¦ä¹ æ¨¡å‹ä»ä¸­å­¦ä¹ çš„æ•°æ®è¡¨ç¤ºã€‚</p><p>æˆ‘ä»¬çš„æœºå™¨å­¦ä¹ æ¨¡å‹ä¸€èˆ¬ä¸èƒ½ä»ä»»æ„çš„çœŸå®æ•°æ®é‡Œé¢é«˜æ•ˆåœ°è‡ªåŠ¨å­¦ä¹ ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç‰¹å¾å·¥ç¨‹ã€‚ç‰¹å¾å·¥ç¨‹çš„æœ¬è´¨å°±æ˜¯ç”¨æ›´ç®€å•çš„æ–¹å¼è¡¨è¾¾é—®é¢˜ï¼Œä»è€Œä½¿é—®é¢˜å˜å¾—æ›´å®¹æ˜“è§£å†³ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggkzvwdlyaj30vc0u0jwu.jpg" alt="ç‰¹å¾å·¥ç¨‹ç¤ºæ„å›¾"></p><p>ç‰¹å¾å·¥ç¨‹åœ¨æ·±åº¦å­¦ä¹ ä¹‹å‰éƒ½è‡³å…³é‡è¦ï¼Œæµ…å±‚çš„å­¦ä¹ ä¸€èˆ¬éƒ½æ²¡æœ‰è¶³å¤Ÿçš„å‡è®¾ç©ºé—´å»è‡ªå·±å­¦ä¹ å‡ºå…³é”®çš„ç‰¹å¾ã€‚ä½†ç°åœ¨æˆ‘ä»¬ç”¨æ·±åº¦å­¦ä¹ å¯ä»¥å…å»å¤§å¤šæ•°çš„ç‰¹å¾å·¥ç¨‹äº†ï¼Œæ·±åº¦å­¦ä¹ å¯ä»¥è‡ªå·±ä»æ•°æ®é‡Œå­¦å‡ºæœ‰ç”¨çš„ç‰¹å¾æ¥ï¼Œä½†æ˜¯åˆ©ç”¨ç‰¹å¾å·¥ç¨‹ï¼Œæˆ‘ä»¬çš„æ·±åº¦å­¦ä¹ è¿‡ç¨‹å¯ä»¥æ›´åŠ ä¼˜é›…ã€é«˜æ•ˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Clown0te(<span class="string">&quot;é˜²ç›—æ–‡çˆ¬:)è™«çš„è¿½è¸ªæ ‡ç­¾ï¼Œè¯»è€…ä¸å¿…åœ¨æ„&quot;</span>).by(CDFMLR)</span><br></pre></td></tr></table></figure><h2 id="è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆ"><a href="#è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆ" class="headerlink" title="è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆ"></a>è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆ</h2><blockquote><p>4.4 Overfitting and underfitting</p></blockquote><p>æœºå™¨å­¦ä¹ é‡Œé¢æœ‰ä¸€ç»„é—®é¢˜ï¼š<strong>ä¼˜åŒ–</strong>ï¼ˆoptimizationï¼‰å’Œ<strong>æ³›åŒ–</strong>ï¼ˆgeneralizationï¼‰ã€‚</p><p>ä¼˜åŒ–ä¸è¶³å°±æ˜¯æ¬ æ‹Ÿåˆï¼Œæ³›åŒ–æ— åŠ›å³ä¸ºè¿‡æ‹Ÿåˆã€‚</p><p>æ¬ æ‹Ÿåˆå°±è¦æ¥ç€è®­ç»ƒï¼Œæ·±åº¦å­¦ä¹ ç½‘ç»œæ€»æ˜¯å¯ä»¥ä¼˜åŒ–åˆ°ä¸€å®šç²¾åº¦çš„ï¼Œå…³é”®çš„é—®é¢˜æ˜¯æ³›åŒ–ã€‚å¤„ç†è¿‡æ‹Ÿåˆç”¨æ­£åˆ™åŒ–ï¼ˆregularizationï¼‰ï¼Œä»¥ä¸‹æ˜¯å‡ ç§æ­£åˆ™åŒ–çš„æ‰‹æ®µï¼š</p><h3 id="å¢åŠ è®­ç»ƒæ•°æ®"><a href="#å¢åŠ è®­ç»ƒæ•°æ®" class="headerlink" title="å¢åŠ è®­ç»ƒæ•°æ®"></a>å¢åŠ è®­ç»ƒæ•°æ®</h3><p>å¢åŠ è®­ç»ƒé›†çš„æ•°æ®ï¼Œemmmmmï¼Œæ‰¾æ›´å¤šçš„æ•°æ®ç»™å®ƒçœ‹å‘€ï¼Œè§å¤šè¯†å¹¿å•Šï¼Œè¿™å°±æ³›åŒ–äº†ã€‚</p><h3 id="å‡å°ç½‘ç»œå¤§å°"><a href="#å‡å°ç½‘ç»œå¤§å°" class="headerlink" title="å‡å°ç½‘ç»œå¤§å°"></a>å‡å°ç½‘ç»œå¤§å°</h3><p>å‡å°å±‚æ•°å’Œå±‚çš„å•å…ƒæ•°ï¼Œå³å‡å°æ€»çš„å‚æ•°ä¸ªæ•°ï¼ˆå«åšæ¨¡å‹çš„å®¹é‡ï¼Œcapacityï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥ç¼“è§£è¿‡æ‹Ÿåˆã€‚</p><p>å‚æ•°è¶Šå¤šï¼Œè®°å¿†å®¹é‡è¶Šå¤§ï¼Œå°±æ˜¯ä¼šæ­»è®°ç¡¬èƒŒå•¦ï¼Œä¸åˆ©äºæ³›åŒ–ï¼Œé¢˜ç›®ç¨å˜å®ƒå¿ƒæ€å°±å´©äº†ã€‚ä½†å¦‚æœå‚æ•°å¤ªå°‘ï¼Œè®°å¿†å®¹é‡å°ï¼Œå®ƒåˆå­¦ä¸ä¼šã€è®°ä¸ä½çŸ¥è¯†ï¼Œä¼šæ¬ æ‹Ÿåˆï¼ˆè¿™çŸ¥è¯†å®ƒä¸è¿›è„‘å­å‘€ï¼‰ã€‚</p><p>æˆ‘ä»¬è¦åœ¨å®¹é‡è¿‡å¤§å’Œè¿‡å°ä¹‹é—´æ‰¾ä¸ªå¹³è¡¡ï¼Œä½†è¿™ä¸ªæ²¡æœ‰ä¸‡èƒ½å…¬å¼å¯ä»¥å¥—ã€‚è¦è‡ªå·±å¤šåšäº›å°è¯•ï¼Œç”¨éªŒè¯é›†å»è¯„ä¼°ä¸åŒçš„é€‰æ‹©ï¼Œæœ€ç»ˆé€‰å‡ºæœ€å¥½çš„æ¥ã€‚ç¡®å®šè¿™ä¸ªçš„ä¸€èˆ¬æ–¹æ³•æ˜¯ï¼šä»ä¸€ä¸ªç›¸å¯¹è¾ƒå°çš„å€¼å¼€å§‹ï¼Œé€æ­¥å¢åŠ ï¼Œç›´åˆ°å¯¹ç»“æœåŸºæœ¬æ²¡æœ‰å½±å“äº†ã€‚</p><h3 id="æ·»åŠ æƒé‡æ­£åˆ™åŒ–"><a href="#æ·»åŠ æƒé‡æ­£åˆ™åŒ–" class="headerlink" title="æ·»åŠ æƒé‡æ­£åˆ™åŒ–"></a>æ·»åŠ æƒé‡æ­£åˆ™åŒ–</h3><p>å’Œå¥¥å¡å§†å‰ƒåˆ€åŸç†ä¸€è‡´ï¼Œä¸€ä¸ªç®€å•æ¨¡å‹æ¯”ä¸€ä¸ªå¤æ‚æ¨¡å‹æ›´ä¸å®¹æ˜“è¿‡æ‹Ÿåˆã€‚è¿™é‡Œè¯´çš„ç®€å•æ¨¡å‹æ˜¯æŒ‡ä¸€ä¸ªå‚æ•°å–å€¼çš„åˆ†å¸ƒç†µæ›´å°çš„æ¨¡å‹ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¼ºåˆ¶æ¨¡å‹æƒé‡å–è¾ƒå°çš„å€¼ï¼Œä»è€Œé™åˆ¶æ¨¡å‹çš„å¤æ‚åº¦ï¼Œæ¥é™ä½è¿‡æ‹Ÿåˆã€‚è¿™ç§ä½¿æƒé‡å€¼çš„åˆ†å¸ƒæ›´åŠ è§„åˆ™(regular)çš„æ–¹æ³•å«ä½œæƒé‡æ­£åˆ™åŒ–<br>(weight regularization)ã€‚å…·ä½“çš„å®ç°æ–¹æ³•æ˜¯åœ¨æŸå¤±å‡½æ•°ä¸­æ·»åŠ ä¸è¾ƒå¤§æƒé‡å€¼ç›¸å…³çš„æˆæœ¬ã€‚</p><p>æ·»åŠ è¿™ä¸ªæˆæœ¬çš„æ–¹æ³•ä¸»è¦æœ‰ä¸¤ç§ï¼š</p><ul><li>L1 regularizationï¼šæ·»åŠ ä¸æƒé‡ç³»æ•°çš„ç»å¯¹å€¼æˆæ­£æ¯”çš„å€¼ï¼ˆæƒé‡çš„ L1 èŒƒæ•°ï¼Œthe L1 norm of the weightsï¼‰ï¼›</li><li>L2 regularizationï¼šæ·»åŠ ä¸æƒé‡ç³»æ•°çš„å¹³æ–¹å€¼æˆæ­£æ¯”çš„å€¼ï¼ˆæƒé‡çš„ L2 èŒƒæ•°ï¼Œthe L2 norm of the weightsï¼‰ï¼Œåœ¨ç¥ç»ç½‘ç»œä¸­ï¼ŒL2 æ­£åˆ™åŒ–ä¹Ÿå«æƒé‡è¡°å‡(weight decay)ã€‚</li></ul><p>åœ¨ Keras é‡Œï¼Œæ·»åŠ æƒé‡æ­£åˆ™åŒ–å¯ä»¥é€šè¿‡åœ¨å±‚é‡Œä¼ ä¸€ä¸ªæƒé‡æ­£åˆ™åŒ–å®ä¾‹æ¥å®ç°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> keras <span class="keyword">import</span> regularizers</span><br><span class="line"></span><br><span class="line">model = models.Sequential()</span><br><span class="line"></span><br><span class="line">model.add(layers.Dense(<span class="number">16</span>, kernel_regularizer=regularizers.l2(<span class="number">0.001</span>), </span><br><span class="line">                       activation=<span class="string">&#x27;relu&#x27;</span>, input_shape=(<span class="number">10000</span>,)))</span><br><span class="line">model.add(layers.Dense(<span class="number">16</span>, kernel_regularizer=regularizers.l2(<span class="number">0.001</span>),</span><br><span class="line">                       activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>))</span><br></pre></td></tr></table></figure><p><code>regularizers.l2(0.001)</code> çš„æ„æ€æ˜¯åœ¨æŸå¤±å‡½æ•°ä¸­æ·»åŠ ä¸€é¡¹æƒ©ç½š <code>0.001 * weight_coefficient_value</code>ã€‚è¿™ä¸ªä¸œè¥¿åªåœ¨è®­ç»ƒçš„æ—¶å€™è¢«æ·»åŠ ï¼Œåœ¨ç”¨æµ‹è¯•é›†è¯„ä¼°çš„æ—¶å€™ä¸ä¼šç”Ÿæ•ˆï¼Œæ‰€ä»¥ä½ çœ‹åˆ°çš„è®­ç»ƒæ—¶çš„æŸå¤±å€¼è¦è¿œå¤§äºæµ‹è¯•æ—¶çš„ã€‚</p><p>è¿™é‡Œä¹Ÿå¯ä»¥æŠŠ L2 æ¢æˆç”¨ L1ï¼š<code>regularizers.l1(0.001)</code>ï¼Œæˆ–è€… L1ã€L2 åŒæ—¶ä¸Šï¼š<code>regularizers.l1_l2(l1=0.001, l2=0.001)</code>ã€‚</p><h3 id="æ·»åŠ -dropout"><a href="#æ·»åŠ -dropout" class="headerlink" title="æ·»åŠ  dropout"></a>æ·»åŠ  dropout</h3><p>å¯¹äºç¥ç»ç½‘ç»œçš„æ­£åˆ™åŒ–ï¼ŒDropout å…¶å®æ‰æ˜¯æ˜¯æœ€å¸¸ç”¨ã€æœ‰æ•ˆçš„æ–¹æ³•ã€‚</p><p>å¯¹æŸä¸€å±‚ä½¿ç”¨ dropoutï¼Œå°±æ˜¯åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­éšæœºèˆå¼ƒä¸€äº›å±‚è¾“å‡ºçš„ç‰¹å¾(å°±æ˜¯æŠŠå€¼è®¾ä¸º 0)ã€‚</p><p>æ¯”å¦‚ï¼š<code>[0.2, 0.5, 1.3, 0.8, 1.1]</code> -&gt; <code>[0, 0.5, 1.3, 0, 1.1]</code>ï¼Œå˜æˆ 0 çš„ä½ç½®æ˜¯éšæœºçš„å“¦ã€‚</p><p>è¿™é‡Œæœ‰ä¸€ä¸ª dropout rateï¼Œè¡¨ç¤ºæŠŠå¤šå°‘æ¯”ä¾‹çš„ç‰¹å¾ç½®ä¸º0ï¼Œè¿™ä¸ªæ¯”ä¾‹é€šå¸¸å– 0.2~0.5ã€‚è¿˜æœ‰ï¼Œåœ¨æµ‹è¯•çš„æ—¶å€™ä¸ dropout å•Šï¼Œä½†æµ‹è¯•æ—¶çš„è¾“å‡ºè¦æŒ‰ç…§ dropout rate æ¥ç¼©å°ï¼Œä»¥å¹³è¡¡æµ‹è¯•å’Œè®­ç»ƒæ—¶çš„ç»“æœã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯”å¦‚æˆ‘ä»¬æä¸€ä¸ª dropout rate ä¸º 0.5 çš„ï¼Œå³åœ¨è®­ç»ƒçš„æ—¶å€™æ‰”ä¸€åŠï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># training case</span></span><br><span class="line">layer_output *= np.random.randint(<span class="number">0</span>, high=<span class="number">2</span>, size=layer_output.shape)</span><br></pre></td></tr></table></figure><p>ç„¶åæµ‹è¯•çš„æ—¶å€™ï¼Œç›¸åº”çš„ç¼©å°50%ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># testing case</span></span><br><span class="line">layer_output *= <span class="number">0.5</span></span><br></pre></td></tr></table></figure><p>ä½†é€šå¸¸ï¼Œæˆ‘ä»¬ä¸æ˜¯åœ¨æµ‹è¯•çš„æ—¶å€™ç¼©å°ï¼›è€Œæ˜¯åœ¨è®­ç»ƒçš„æ—¶å€™æ‰©å¤§ï¼Œç„¶åæµ‹è¯•çš„æ—¶å€™å°±ä¸ç”¨åŠ¨äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># training case</span></span><br><span class="line">layer_output *= np.random.randint(<span class="number">0</span>, high=<span class="number">2</span>, size=layer_output.shape)</span><br><span class="line">layer_output /= <span class="number">0.5</span></span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggl4f43cguj31iy0dc77b.jpg" alt="è®­ç»ƒæ—¶å¯¹æ¿€æ´»çŸ©é˜µä½¿ç”¨ dropoutï¼Œå¹¶åœ¨è®­ç»ƒæ—¶æˆæ¯”ä¾‹å¢å¤§ã€‚æµ‹è¯•æ—¶æ¿€æ´»çŸ©é˜µä¿æŒä¸å˜"></p><p>åœ¨ Keras é‡Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ  Dropout å±‚æ¥å®ç°è¿™ä¸ªä¸œè¥¿ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.add(layers.Dropout(<span class="number">0.5</span>))</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨æˆ‘ä»¬ IMDB çš„ç½‘ç»œé‡Œé¢åŠ ä¸Š Dropoutï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">model = models.Sequential()</span><br><span class="line"></span><br><span class="line">model.add(layers.Dense(<span class="number">16</span>, activation=<span class="string">&#x27;relu&#x27;</span>, input_shape=(<span class="number">10000</span>,)))</span><br><span class="line">model.add(layers.Dropout(<span class="number">0.5</span>))</span><br><span class="line"></span><br><span class="line">model.add(layers.Dense(<span class="number">16</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.Dropout(<span class="number">0.5</span>))</span><br><span class="line"></span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>))</span><br></pre></td></tr></table></figure><h2 id="æœºå™¨å­¦ä¹ çš„é€šç”¨å·¥ä½œæµç¨‹"><a href="#æœºå™¨å­¦ä¹ çš„é€šç”¨å·¥ä½œæµç¨‹" class="headerlink" title="æœºå™¨å­¦ä¹ çš„é€šç”¨å·¥ä½œæµç¨‹"></a>æœºå™¨å­¦ä¹ çš„é€šç”¨å·¥ä½œæµç¨‹</h2><blockquote><p>4.5 The universal workflow of machine learning</p></blockquote><ol><li><p>å®šä¹‰é—®é¢˜ï¼Œæ”¶é›†æ•°æ®é›†ï¼šå®šä¹‰é—®é¢˜ä¸è¦è®­ç»ƒçš„æ•°æ®ã€‚æ”¶é›†è¿™äº›æ•°æ®ï¼Œæœ‰éœ€è¦çš„è¯ç”¨æ ‡ç­¾æ¥æ ‡æ³¨æ•°æ®ã€‚</p></li><li><p>é€‰æ‹©è¡¡é‡æˆåŠŸçš„æŒ‡æ ‡ï¼šé€‰æ‹©è¡¡é‡é—®é¢˜æˆåŠŸçš„æŒ‡æ ‡ã€‚ä½ è¦åœ¨éªŒè¯æ•°æ®ä¸Šç›‘æ§å“ªäº›æŒ‡æ ‡?</p></li><li><p>ç¡®å®šè¯„ä¼°æ–¹æ³•ï¼šç•™å‡ºéªŒè¯? K æŠ˜éªŒè¯?ä½ åº”è¯¥å°†å“ªä¸€éƒ¨åˆ†æ•°æ®ç”¨äºéªŒè¯?</p></li><li><p>å‡†å¤‡æ•°æ®ï¼šé¢„å¤„ç†å•¦ï¼Œç‰¹å¾å·¥ç¨‹å•¦ã€‚ã€‚</p></li><li><p>å¼€å‘æ¯”åŸºå‡†(æ¯”å¦‚éšæœºé¢„æµ‹)æ›´å¥½çš„æ¨¡å‹ï¼Œå³ä¸€ä¸ªå…·æœ‰ç»Ÿè®¡åŠŸæ•ˆçš„æ¨¡å‹ã€‚</p></li></ol><p>æœ€åä¸€å±‚å’ŒæŸå¤±çš„é€‰æ‹©ï¼š<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gglyp8zx9jj31jc0iiq75.jpg" alt="æœ€åä¸€å±‚å’ŒæŸå¤±çš„é€‰æ‹©"></p><ol start="7"><li><p>æ‰©å¤§è§„æ¨¡ï¼Œå¼€å‘å‡ºè¿‡æ‹Ÿåˆçš„æ¨¡å‹ï¼šåŠ å±‚ã€åŠ å•å…ƒã€åŠ è½®æ¬¡</p></li><li><p>è°ƒèŠ‚è¶…å‚æ•°ï¼Œæ¨¡å‹æ­£åˆ™åŒ–ï¼šåŸºäºæ¨¡å‹åœ¨éªŒè¯æ•°æ®ä¸Šçš„æ€§èƒ½æ¥è¿›è¡Œæ¨¡å‹æ­£åˆ™åŒ–ä¸è°ƒèŠ‚è¶…å‚æ•°ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> Deep Learning with Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
            <tag> Deep Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonæ·±åº¦å­¦ä¹ ä¹‹ç¥ç»ç½‘ç»œå…¥é—¨</title>
      <link href="/2020/07/08/DeepLearningWithPython/Deep-Learning%20with-Python-ch3/"/>
      <url>/2020/07/08/DeepLearningWithPython/Deep-Learning%20with-Python-ch3/</url>
      
        <content type="html"><![CDATA[<h1 id="Deep-Learning-with-Python"><a href="#Deep-Learning-with-Python" class="headerlink" title="Deep Learning with Python"></a>Deep Learning with Python</h1><p>è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘å­¦ä¹ ã€ŠDeep Learning with Pythonã€‹(ç¬¬äºŒç‰ˆï¼ŒFranÃ§ois Chollet è‘—) æ—¶å†™çš„ç³»åˆ—ç¬”è®°ä¹‹ä¸€ã€‚æ–‡ç« çš„å†…å®¹æ˜¯ä»  Jupyter notebooks è½¬æˆ Markdown çš„ï¼Œå½“æˆ‘å®Œæˆæ‰€ä»¥æ–‡ç« åï¼Œä¼šåœ¨ GitHub å‘å¸ƒæˆ‘å†™çš„æ‰€æœ‰  Jupyter notebooksã€‚</p><p>ä½ å¯ä»¥åœ¨è¿™ä¸ªç½‘å€åœ¨çº¿é˜…è¯»è¿™æœ¬ä¹¦çš„æ­£ç‰ˆåŸæ–‡(è‹±æ–‡)ï¼š<a href="https://livebook.manning.com/book/deep-learning-with-python">https://livebook.manning.com/book/deep-learning-with-python</a></p><p>è¿™æœ¬ä¹¦çš„ä½œè€…ä¹Ÿç»™å‡ºäº†ä¸€å¥— Jupyter notebooksï¼š<a href="https://github.com/fchollet/deep-learning-with-python-notebooks">https://github.com/fchollet/deep-learning-with-python-notebooks</a></p><hr><p>æœ¬æ–‡ä¸º <strong>ç¬¬3ç«  ç¥ç»ç½‘ç»œå…¥é—¨</strong> (Chapter 3. Getting started with neural networks) çš„ç¬”è®°æ•´åˆã€‚</p><p>æœ¬æ–‡ç›®å½•ï¼š</p><p>[TOC]</p><h2 id="ç”µå½±è¯„è®ºåˆ†ç±»-äºŒåˆ†ç±»é—®é¢˜"><a href="#ç”µå½±è¯„è®ºåˆ†ç±»-äºŒåˆ†ç±»é—®é¢˜" class="headerlink" title="ç”µå½±è¯„è®ºåˆ†ç±»:äºŒåˆ†ç±»é—®é¢˜"></a>ç”µå½±è¯„è®ºåˆ†ç±»:äºŒåˆ†ç±»é—®é¢˜</h2><p><a href="https://livebook.manning.com/book/deep-learning-with-python/chapter-3/101">åŸæ–‡é“¾æ¥</a></p><h3 id="IMDB-æ•°æ®é›†"><a href="#IMDB-æ•°æ®é›†" class="headerlink" title="IMDB æ•°æ®é›†"></a>IMDB æ•°æ®é›†</h3><p>IMDB æ•°æ®é›†é‡Œæ˜¯ 50,000 æ¡ç”µå½±è¯„è®ºã€‚ä¸€åŠæ˜¯è®­ç»ƒé›†ï¼Œä¸€åŠæ˜¯æµ‹è¯•é›†ã€‚<br>æ•°æ®é‡Œ 50% æ˜¯ç§¯æè¯„ä»·ï¼Œ50% æ˜¯æ¶ˆæè¯„ä»·ã€‚</p><p>Keras å†…ç½®äº†åšè¿‡é¢„å¤„ç†çš„ IMDB æ•°æ®é›†ï¼ŒæŠŠå•è¯åºåˆ—è½¬åŒ–æˆäº†æ•´æ•°åºåˆ—ï¼ˆä¸€ä¸ªæ•°å­—å¯¹åº”å­—å…¸é‡Œçš„è¯ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.datasets <span class="keyword">import</span> imdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®é›†</span></span><br><span class="line">(train_data, train_labels), (test_data, test_labels) = imdb.load_data(</span><br><span class="line">    num_words=<span class="number">10000</span>)</span><br></pre></td></tr></table></figure><p><code>num_words=10000</code> æ˜¯åªä¿ç•™å‡ºç°é¢‘ç‡å‰ 10000 çš„å•è¯ã€‚</p><p>å…ˆæ¥éšä¾¿çœ‹ä¸€æ¡è¯„è®ºï¼Œè¿™æ˜¯æ¡å¥½è¯„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å­—å…¸</span></span><br><span class="line">index_word = &#123;v: k <span class="keyword">for</span> k, v <span class="keyword">in</span> imdb.get_word_index().items()&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿˜åŸä¸€æ¡è¯„è®ºçœ‹çœ‹</span></span><br><span class="line">text = <span class="string">&#x27; &#x27;</span>.join([index_word[i] <span class="keyword">for</span> i <span class="keyword">in</span> train_data[<span class="number">0</span>]])</span><br><span class="line"></span><br><span class="line">print(<span class="string">f&quot;<span class="subst">&#123;train_labels[<span class="number">0</span>]&#125;</span>:&quot;</span>, text)</span><br></pre></td></tr></table></figure><pre><code>1: the as you with out themselves powerful lets loves their becomes reaching had journalist of lot from anyone to have after out atmosphere never more room and it so heart shows to years of every never going and help moments or of every chest visual movie except her was several of enough more with is now current film as you of mine potentially unfortunately of you than him that with out themselves her get for was camp of you movie sometimes movie that with scary but and to story wonderful that in seeing in character to of 70s musicians with heart had shadows they of here that with her serious to have does when from why what have critics they is you that isn&#39;t one will very to as itself with other and in of seen over landed for anyone of and br show&#39;s to whether from than out themselves history he name half some br of and odd was two most of mean for 1 any an boat she he should is thought frog but of script you not while history he heart to real at barrel but when from one bit then have two of script their with her nobody most that with wasn&#39;t to with armed acting watch an for with heartfelt film want an</code></pre><h3 id="æ•°æ®å‡†å¤‡"><a href="#æ•°æ®å‡†å¤‡" class="headerlink" title="æ•°æ®å‡†å¤‡"></a>æ•°æ®å‡†å¤‡</h3><p>å…ˆçœ‹ä¸€ä¸‹ train_data ç°åœ¨çš„å½¢çŠ¶ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_data.shape</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>(25000,)</code></pre><p>æˆ‘ä»¬è¦æŠŠå®ƒå˜æˆ <code>(samples, word_indices)</code> çš„æ ·å­ï¼Œå¤§æ¦‚æ˜¯ä¸‹é¢è¿™ç§ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[[0, 0, ..., 1, ..., 0, ..., 1],</span><br><span class="line"> [0, 1, ..., 0, ..., 1, ..., 0],</span><br><span class="line"> ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>æœ‰è¿™ä¸ªè¯å°±æ˜¯ 1ï¼Œæ²¡æœ‰å°±æ˜¯ 0ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">vectorize_sequences</span>(<span class="params">sequences, dimension=<span class="number">10000</span></span>):</span></span><br><span class="line">    results = np.zeros((<span class="built_in">len</span>(sequences), dimension))</span><br><span class="line">    <span class="keyword">for</span> i, sequence <span class="keyword">in</span> <span class="built_in">enumerate</span>(sequences):</span><br><span class="line">        results[i, sequence] = <span class="number">1.</span></span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line">x_train = vectorize_sequences(train_data)</span><br><span class="line">x_test = vectorize_sequences(test_data)</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x_train</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>array([[0., 1., 1., ..., 0., 0., 0.],       [0., 1., 1., ..., 0., 0., 0.],       [0., 1., 1., ..., 0., 0., 0.],       ...,       [0., 1., 1., ..., 0., 0., 0.],       [0., 1., 1., ..., 0., 0., 0.],       [0., 1., 1., ..., 0., 0., 0.]])</code></pre><p>labels ä¹Ÿéšä¾¿æä¸€ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_labels</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>array([1, 0, 0, ..., 0, 1, 0])</code></pre><p>å¤„ç†ä¸€ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">y_train = np.asarray(train_labels).astype(<span class="string">&#x27;float32&#x27;</span>)</span><br><span class="line">y_test = np.asarray(test_labels).astype(<span class="string">&#x27;float32&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">y_train</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>array([1., 0., 0., ..., 0., 1., 0.], dtype=float32)</code></pre><p>ç°åœ¨è¿™äº›æ•°æ®å°±å¯ä»¥å®‰å…¨æŠ•å–‚æˆ‘ä»¬ä¸€ä¼šå„¿å»ºçš„ç¥ç»ç½‘ç»œäº†ã€‚</p><h3 id="å»ºç«‹ç½‘ç»œ"><a href="#å»ºç«‹ç½‘ç»œ" class="headerlink" title="å»ºç«‹ç½‘ç»œ"></a>å»ºç«‹ç½‘ç»œ</h3><p>å¯¹äºè¿™ç§è¾“å…¥æ˜¯å‘é‡ã€æ ‡ç­¾æ˜¯æ ‡é‡ï¼ˆç”šè‡³æ˜¯ 0 æˆ– 1ï¼‰çš„é—®é¢˜ï¼š<br>ä½¿ç”¨ relu æ¿€æ´»çš„ Dense (å…¨è¿æ¥)å †èµ·æ¥çš„ç½‘ç»œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Dense(<span class="number">16</span>, activation=<span class="string">&#x27;relu&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è¿™ç§å±‚çš„ä½œç”¨æ˜¯ <code>output = relu(dot(W, input) + b)</code>ã€‚</p><p>16 æ˜¯æ¯å±‚é‡Œéšè—å•å…ƒ(hidden unit)çš„ä¸ªæ•°ã€‚ä¸€ä¸ª hidden unit å°±æ˜¯åœ¨è¿™å±‚çš„è¡¨ç¤ºç©ºé—´é‡Œçš„ä¸€ä¸ªç»´åº¦ã€‚<br>W çš„å½¢çŠ¶ä¹Ÿæ˜¯ <code>(input_dimension, 16)</code>ï¼Œdot å‡ºæ¥å°±æ˜¯ä¸ª 16 ç»´çš„å‘é‡ï¼Œä¹Ÿå°±æŠŠæ•°æ®æŠ•å½±åˆ°äº† 16 ç»´çš„è¡¨ç¤ºç©ºé—´ã€‚</p><p>è¿™ä¸ªç»´åº¦ (hidden unit çš„æ•°é‡) å¯ä»¥çœ‹æˆå¯¹ç½‘ç»œå­¦ä¹ çš„è‡ªç”±åº¦çš„æ§åˆ¶ã€‚<br>ç»´åº¦è¶Šé«˜ï¼Œèƒ½å­¦çš„ä¸œè¥¿è¶Šå¤æ‚ï¼Œä½†è®¡ç®—æ¶ˆè€—ä¹Ÿè¶Šå¤§ï¼Œè€Œä¸”å¯èƒ½å­¦åˆ°ä¸€äº›ä¸é‡è¦çš„ä¸œè¥¿å¯¼è‡´è¿‡æ‹Ÿåˆã€‚</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸¤å±‚è¿™ç§16ä¸ªéšè—å•å…ƒçš„å±‚ï¼Œ<br>æœ€åè¿˜æœ‰ä¸€ä¸ª sigmoid æ¿€æ´»çš„å±‚æ¥è¾“å‡ºç»“æœï¼ˆåœ¨$[0, 1]$å†…çš„å€¼ï¼‰ï¼Œ<br>è¿™ä¸ªç»“æœè¡¨ç¤ºé¢„æµ‹æœ‰å¤šå¯èƒ½è¿™ä¸ªæ•°æ®çš„æ ‡ç­¾æ˜¯1ï¼Œå³ä¸€æ¡å¥½è¯„ã€‚</p><p>relu æ˜¯è¿‡æ»¤æ‰è´Ÿå€¼ï¼ˆæŠŠè¾“å…¥çš„è´Ÿå€¼è¾“å‡ºæˆ0ï¼‰ï¼Œsigmoid æ˜¯æŠŠå€¼æŠ•åˆ° <code>[0, 1]</code>ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8cohvw31j31hi0lu49o.jpg" alt="relu and sigmoid"></p><p>åœ¨ Keras ä¸­å®ç°è¿™ä¸ªç½‘ç»œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"></span><br><span class="line">model = models.Sequential()</span><br><span class="line">model.add(layers.Dense(<span class="number">16</span>, activation=<span class="string">&#x27;relu&#x27;</span>, input_shape=(<span class="number">10000</span>, )))</span><br><span class="line">model.add(layers.Dense(<span class="number">16</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>))</span><br></pre></td></tr></table></figure><h4 id="æ¿€æ´»å‡½æ•°çš„ä½œç”¨"><a href="#æ¿€æ´»å‡½æ•°çš„ä½œç”¨" class="headerlink" title="æ¿€æ´»å‡½æ•°çš„ä½œç”¨"></a>æ¿€æ´»å‡½æ•°çš„ä½œç”¨</h4><p>æˆ‘ä»¬ä¹‹å‰åœ¨ MNIST é‡Œç”¨è¿‡ relu æ¿€æ´»å‡½æ•°ï¼Œæ‰€ä»¥<em>æ¿€æ´»å‡½æ•°</em>åˆ°åº•æ˜¯å¹²å˜›çš„ï¼Ÿ</p><p>ä¸€ä¸ªæ²¡æœ‰æ¿€æ´»å‡½æ•°çš„ Dense å±‚çš„ä½œç”¨åªæ˜¯ä¸€ä¸ªçº¿æ€§å˜æ¢ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">output &#x3D; dot(W, input) + b</span><br></pre></td></tr></table></figure><p>å¦‚æœæ¯ä¸€å±‚éƒ½æ˜¯è¿™ç§çº¿æ€§å˜æ¢ï¼ŒæŠŠå¤šä¸ªè¿™ç§å±‚å åœ¨ä¸€èµ·ï¼Œå‡è®¾ç©ºé—´å¹¶ä¸ä¼šå˜å¤§ï¼Œæ‰€ä»¥èƒ½å­¦åˆ°çš„ä¸œè¥¿å¾ˆæœ‰é™ã€‚</p><p>è€Œæ¿€æ´»å‡½æ•°å°±æ˜¯åœ¨ <code>dot(W, input) + b</code> å¤–é¢å¥—çš„ä¸€ä¸ªå‡½æ•°ï¼Œæ¯”å¦‚ relu æ¿€æ´»æ˜¯ <code>output = relu(dot(W, input) + b)</code>ã€‚<br>åˆ©ç”¨è¿™ç§æ¿€æ´»å‡½æ•°ï¼Œå¯ä»¥æ‹“å±•è¡¨ç¤ºç©ºé—´ï¼Œä¹Ÿå°±å¯ä»¥è®©ç½‘ç»œå­¦ä¹ åˆ°æ›´å¤æ‚çš„â€œçŸ¥è¯†â€ã€‚</p><h3 id="ç¼–è¯‘æ¨¡å‹"><a href="#ç¼–è¯‘æ¨¡å‹" class="headerlink" title="ç¼–è¯‘æ¨¡å‹"></a>ç¼–è¯‘æ¨¡å‹</h3><p>ç¼–è¯‘æ¨¡å‹æ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦é€‰æ‹©æŸå¤±å‡½æ•°ã€ä¼˜åŒ–å™¨å’ŒæŒ‡æ ‡ã€‚</p><p>å¯¹è¿™ç§æœ€åè¾“å‡º 0 æˆ– 1 çš„äºŒå…ƒåˆ†ç±»é—®é¢˜ï¼ŒæŸå¤±å‡½æ•°å¯ä»¥ä½¿ç”¨ <code>binary_crossentropy</code>(ä»åå­—å°±å¯ä»¥çœ‹å¾—å‡ºæ¥å¾ˆåˆé€‚å•¦)ã€‚</p><p>è¿™ä¸ª <em>crossentropy</em> ä¸­æ–‡å«äº¤å‰ç†µï¼Œæ˜¯ä¿¡æ¯è®ºé‡Œçš„ï¼Œæ˜¯ç”¨æ¥è¡¡é‡æ¦‚ç‡åˆ†å¸ƒç›´æ¥çš„è·ç¦»çš„ã€‚<br>æ‰€ä»¥è¾“å‡ºæ¦‚ç‡çš„æ¨¡å‹ç»å¸¸æ˜¯ç”¨è¿™ç§ crossentropy åšæŸå¤±çš„ã€‚</p><p>è‡³äºä¼˜åŒ–å™¨ï¼Œå’Œ MNIST ä¸€æ ·ï¼Œæˆ‘ä»¬ç”¨ <code>rmsprop</code> ï¼ˆä¹¦é‡Œè¿˜æ²¡å†™ä¸ºä»€ä¹ˆï¼‰ï¼ŒæŒ‡æ ‡ä¹Ÿè¿˜æ˜¯å‡†ç¡®åº¦ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>,</span><br><span class="line">              loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>,</span><br><span class="line">              metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br></pre></td></tr></table></figure><p>å› ä¸ºè¿™å‡ ä¸ªoptimizerã€lossã€metrics éƒ½æ˜¯å¸¸ç”¨çš„ï¼Œæ‰€ä»¥ Keras å†…ç½®äº†ï¼Œå¯ä»¥ç›´æ¥ä¼ å­—ç¬¦ä¸²ã€‚<br>ä½†ä¹Ÿå¯ä»¥ä¼ ç±»å®ä¾‹æ¥å®šåˆ¶ä¸€äº›å‚æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> optimizers</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> losses</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> metrics</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=optimizers.RMSprop(lr=<span class="number">0.001</span>),</span><br><span class="line">              loss=losses.binary_crossentropy,</span><br><span class="line">              metrics=[metrics.binary_accuracy])</span><br></pre></td></tr></table></figure><h3 id="è®­ç»ƒæ¨¡å‹"><a href="#è®­ç»ƒæ¨¡å‹" class="headerlink" title="è®­ç»ƒæ¨¡å‹"></a>è®­ç»ƒæ¨¡å‹</h3><p>ä¸ºäº†åœ¨è®­ç»ƒçš„è¿‡ç¨‹ä¸­éªŒè¯æ¨¡å‹åœ¨å®ƒæ²¡è§è¿‡çš„æ•°æ®ä¸Šç²¾åº¦å¦‚ä½•ï¼Œæˆ‘ä»¬ä»åŸæ¥çš„è®­ç»ƒæ•°æ®é‡Œåˆ† 10,000 ä¸ªæ ·æœ¬å‡ºæ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x_val = x_train[:<span class="number">10000</span>]</span><br><span class="line">partial_x_train = x_train[<span class="number">10000</span>:]</span><br><span class="line"></span><br><span class="line">y_val = y_train[:<span class="number">10000</span>]</span><br><span class="line">partial_y_train = y_train[<span class="number">10000</span>:]</span><br></pre></td></tr></table></figure><p>ç”¨ä¸€æ‰¹ 512 ä¸ªæ ·æœ¬çš„ mini-batchesï¼Œè·‘ 20 è½®ï¼ˆæ‰€æœ‰x_trainé‡Œçš„æ•°æ®è·‘ä¸€éç®—ä¸€è½®ï¼‰ï¼Œ<br>å¹¶ç”¨åˆšåˆ†å‡ºæ¥çš„ 10,000 çš„æ ·æœ¬åšç²¾åº¦éªŒè¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>,</span><br><span class="line">              loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>,</span><br><span class="line">              metrics=[<span class="string">&#x27;acc&#x27;</span>])</span><br><span class="line"></span><br><span class="line">history = model.fit(partial_x_train,</span><br><span class="line">                    partial_y_train,</span><br><span class="line">                    epochs=<span class="number">20</span>,</span><br><span class="line">                    batch_size=<span class="number">512</span>,</span><br><span class="line">                    validation_data=(x_val, y_val))</span><br></pre></td></tr></table></figure><pre><code>Train on 15000 samples, validate on 10000 samplesEpoch 1/2015000/15000 [==============================] - 3s 205us/sample - loss: 0.5340 - acc: 0.7867 - val_loss: 0.4386 - val_acc: 0.8340.......Epoch 20/2015000/15000 [==============================] - 1s 74us/sample - loss: 0.0053 - acc: 0.9995 - val_loss: 0.7030 - val_acc: 0.8675</code></pre><p><code>fit</code> é˜”ä»¥è¿”å› historyï¼Œé‡Œé¢ä¿å­˜äº†è®­ç»ƒè¿‡ç¨‹é‡Œæ¯ä¸ª Epoch çš„é»‘å†å²ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">history_dict = history.history</span><br><span class="line">history_dict.keys()</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>dict_keys([&#39;loss&#39;, &#39;acc&#39;, &#39;val_loss&#39;, &#39;val_acc&#39;])</code></pre><p>æˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›ä¸œè¥¿ç”»å›¾å‡ºæ¥çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”»è®­ç»ƒå’ŒéªŒè¯çš„æŸå¤±</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">history_dict = history.history</span><br><span class="line">loss_values = history_dict[<span class="string">&#x27;loss&#x27;</span>]</span><br><span class="line">val_loss_values = history_dict[<span class="string">&#x27;val_loss&#x27;</span>]</span><br><span class="line"></span><br><span class="line">epochs = <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(loss_values) + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">plt.plot(epochs, loss_values, <span class="string">&#x27;ro-&#x27;</span>, label=<span class="string">&#x27;Training loss&#x27;</span>)</span><br><span class="line">plt.plot(epochs, val_loss_values, <span class="string">&#x27;bs-&#x27;</span>, label=<span class="string">&#x27;Validation loss&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation loss&#x27;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;Epochs&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;Loss&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggjeapcizwj30at07qjri.jpg" alt="png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”»è®­ç»ƒå’ŒéªŒè¯çš„å‡†ç¡®åº¦</span></span><br><span class="line"></span><br><span class="line">plt.clf()</span><br><span class="line"></span><br><span class="line">acc = history_dict[<span class="string">&#x27;acc&#x27;</span>]</span><br><span class="line">val_acc = history_dict[<span class="string">&#x27;val_acc&#x27;</span>]</span><br><span class="line"></span><br><span class="line">plt.plot(epochs, acc, <span class="string">&#x27;ro-&#x27;</span>, label=<span class="string">&#x27;Training acc&#x27;</span>)</span><br><span class="line">plt.plot(epochs, val_acc, <span class="string">&#x27;bs-&#x27;</span>, label=<span class="string">&#x27;Validation acc&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation accuracy&#x27;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;Epochs&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;Loss&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggjeasgbdsj30az07q3ym.jpg" alt="png"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè®­ç»ƒé›†ä¸Šçš„ç²¾åº¦å€’æ˜¯ä¸€ç›´åœ¨å¢ï¼ˆæŸå¤±ä¸€ç›´å‡ï¼‰ï¼Œ<br>ä½†åœ¨éªŒè¯é›†ä¸Šï¼Œåˆ°äº†åé¢æŸå¤±åè€Œå¤§äº†ï¼Œå·®ä¸å¤šç¬¬4è½®å·¦å³å°±åˆ°æœ€å¥½çš„å³°å€¼äº†ã€‚</p><p>è¿™å°±æ˜¯è¿‡æ‹Ÿåˆäº†ï¼Œå…¶å®ä»ç¬¬äºŒè½®å¼€å§‹å°±å¼€å§‹è¿‡äº†ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å…¶å®è·‘ä¸ª3ã€4è½®å°± ok äº†ã€‚<br>è¦æ˜¯å†è·‘ä¸‹å»ï¼Œå’±çš„æ¨¡å‹å°±åªâ€œç²¾é€šâ€è®­ç»ƒé›†ï¼Œä¸è®¤è¯†å…¶ä»–æ²¡è§è¿‡çš„æ•°æ®äº†ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬é‡æ–°è®­ç»ƒä¸€ä¸ªæ¨¡å‹ï¼ˆè¦ä»å»ºç«‹ç½‘ç»œå¼€å§‹é‡å†™ï¼Œä¸ç„¶fitæ˜¯æ¥ç€åˆšæ‰å·²ç»è¿›è¡Œè¿‡çš„è¿™äº›ï¼‰ï¼Œé‚£å»ç”¨æµ‹è¯•é›†æµ‹è¯•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">model = models.Sequential()</span><br><span class="line">model.add(layers.Dense(<span class="number">16</span>, activation=<span class="string">&#x27;relu&#x27;</span>, input_shape=(<span class="number">10000</span>, )))</span><br><span class="line">model.add(layers.Dense(<span class="number">16</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>))</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>,</span><br><span class="line">             loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>,</span><br><span class="line">             metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br><span class="line"></span><br><span class="line">model.fit(x_train, y_train, epochs=<span class="number">4</span>, batch_size=<span class="number">512</span>)</span><br><span class="line">result = model.evaluate(x_test, y_test, verbose=<span class="number">2</span>)    <span class="comment"># verbose=2 to avoid a looooong progress bar that fills the screen with &#x27;=&#x27;. https://github.com/tensorflow/tensorflow/issues/32286</span></span><br></pre></td></tr></table></figure><pre><code>Train on 25000 samplesEpoch 1/425000/25000 [==============================] - 2s 69us/sample - loss: 0.4829 - accuracy: 0.8179Epoch 2/425000/25000 [==============================] - 1s 42us/sample - loss: 0.2827 - accuracy: 0.9054Epoch 3/425000/25000 [==============================] - 1s 42us/sample - loss: 0.2109 - accuracy: 0.9253Epoch 4/425000/25000 [==============================] - 1s 43us/sample - loss: 0.1750 - accuracy: 0.938025000/1 - 3s - loss: 0.2819 - accuracy: 0.8836</code></pre><p>æŠŠç»“æœè¾“å‡ºå‡ºæ¥çœ‹çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(result)</span><br></pre></td></tr></table></figure><pre><code>[0.2923990402317047, 0.8836]</code></pre><p>è®­ç»ƒå®Œæˆåï¼Œæˆ‘ä»¬å½“ç„¶æƒ³å®é™…è¯•ä¸€ä¸‹ï¼Œå¯¹å§ã€‚æ‰€ä»¥æˆ‘ä»¬é¢„æµ‹ä¸€ä¸‹æµ‹è¯•é›†ï¼ŒæŠŠç»“æœæ‰“å‡ºæ¥çœ‹çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.predict(x_test)</span><br></pre></td></tr></table></figure><p>Output:</p><pre><code>array([[0.17157233],       [0.99989915],       [0.79564804],       ...,       [0.11750051],       [0.05890778],       [0.5040823 ]], dtype=float32)</code></pre><h3 id="è¿›ä¸€æ­¥å®éªŒ"><a href="#è¿›ä¸€æ­¥å®éªŒ" class="headerlink" title="è¿›ä¸€æ­¥å®éªŒ"></a>è¿›ä¸€æ­¥å®éªŒ</h3><ol><li>å°è¯•åªç”¨ä¸€ä¸ªå±‚</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">model = models.Sequential()</span><br><span class="line"><span class="comment"># model.add(layers.Dense(16, activation=&#x27;relu&#x27;, input_shape=(10000, )))</span></span><br><span class="line"><span class="comment"># model.add(layers.Dense(16, activation=&#x27;relu&#x27;))</span></span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>, input_shape=(<span class="number">10000</span>, )))</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>,</span><br><span class="line">             loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>,</span><br><span class="line">             metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br><span class="line"></span><br><span class="line">model.fit(x_train, y_train, epochs=<span class="number">4</span>, batch_size=<span class="number">512</span>)</span><br><span class="line">result = model.evaluate(x_test, y_test, verbose=<span class="number">2</span>)    <span class="comment"># verbose=2 to avoid a looooong progress bar that fills the screen with &#x27;=&#x27;. https://github.com/tensorflow/tensorflow/issues/32286</span></span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><pre><code>Train on 25000 samplesEpoch 1/425000/25000 [==============================] - 3s 116us/sample - loss: 0.5865 - accuracy: 0.7814Epoch 2/425000/25000 [==============================] - 1s 31us/sample - loss: 0.4669 - accuracy: 0.8608Epoch 3/425000/25000 [==============================] - 1s 32us/sample - loss: 0.3991 - accuracy: 0.8790Epoch 4/425000/25000 [==============================] - 1s 33us/sample - loss: 0.3538 - accuracy: 0.892025000/1 - 3s - loss: 0.3794 - accuracy: 0.8732[0.3726908649635315, 0.8732]</code></pre><p>â€¦è¿™é—®é¢˜æ¯”è¾ƒç®€å•ï¼Œä¸€ä¸ªå±‚æ•ˆæœéƒ½è¿™ä¹ˆå¥½ï¼Œä½†æ¯”ä¹‹å‰æ­£ç»çš„å·®è¿œäº†</p><ol start="2"><li>å¤šæå‡ ä¸ªå±‚</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">model = models.Sequential()</span><br><span class="line">model.add(layers.Dense(<span class="number">16</span>, activation=<span class="string">&#x27;relu&#x27;</span>, input_shape=(<span class="number">10000</span>, )))</span><br><span class="line">model.add(layers.Dense(<span class="number">16</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">16</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">16</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>))</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>,</span><br><span class="line">             loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>,</span><br><span class="line">             metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br><span class="line"></span><br><span class="line">model.fit(x_train, y_train, epochs=<span class="number">4</span>, batch_size=<span class="number">512</span>)</span><br><span class="line">result = model.evaluate(x_test, y_test, verbose=<span class="number">2</span>)    <span class="comment"># verbose=2 to avoid a looooong progress bar that fills the screen with &#x27;=&#x27;. https://github.com/tensorflow/tensorflow/issues/32286</span></span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><pre><code>Train on 25000 samplesEpoch 1/425000/25000 [==============================] - 3s 123us/sample - loss: 0.5285 - accuracy: 0.7614Epoch 2/425000/25000 [==============================] - 1s 45us/sample - loss: 0.2683 - accuracy: 0.9072s - loss:Epoch 3/425000/25000 [==============================] - 1s 45us/sample - loss: 0.1949 - accuracy: 0.9297Epoch 4/425000/25000 [==============================] - 1s 47us/sample - loss: 0.1625 - accuracy: 0.942225000/1 - 2s - loss: 0.3130 - accuracy: 0.8806[0.30894253887176515, 0.88056]</code></pre><p>å¥½ä¸€ç‚¹ï¼Œä½†ä¹Ÿè¿˜ä¸å¦‚æ­£ç»çš„ç‰ˆæœ¬</p><ol start="3"><li>å¤šå‡ ä¸ªéšè—å±‚çš„å•å…ƒ</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">model = models.Sequential()</span><br><span class="line">model.add(layers.Dense(<span class="number">16</span>, activation=<span class="string">&#x27;relu&#x27;</span>, input_shape=(<span class="number">10000</span>, )))</span><br><span class="line">model.add(layers.Dense(<span class="number">1024</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>))</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>,</span><br><span class="line">             loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>,</span><br><span class="line">             metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br><span class="line"></span><br><span class="line">model.fit(x_train, y_train, epochs=<span class="number">4</span>, batch_size=<span class="number">512</span>)</span><br><span class="line">result = model.evaluate(x_test, y_test, verbose=<span class="number">2</span>)    <span class="comment"># verbose=2 to avoid a looooong progress bar that fills the screen with &#x27;=&#x27;. https://github.com/tensorflow/tensorflow/issues/32286</span></span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><pre><code>Train on 25000 samplesEpoch 1/425000/25000 [==============================] - 15s 593us/sample - loss: 0.5297 - accuracy: 0.7964Epoch 2/425000/25000 [==============================] - 12s 490us/sample - loss: 0.2233 - accuracy: 0.9109Epoch 3/425000/25000 [==============================] - 12s 489us/sample - loss: 0.1148 - accuracy: 0.9593Epoch 4/425000/25000 [==============================] - 12s 494us/sample - loss: 0.0578 - accuracy: 0.983525000/1 - 9s - loss: 0.3693 - accuracy: 0.8812[0.4772889766550064, 0.8812]</code></pre><p>ä¸æ˜¯è¿œå¤šè¶Šå¥½å‘€ã€‚</p><ol start="4"><li>ç”¨ mse æŸå¤±</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">model = models.Sequential()</span><br><span class="line">model.add(layers.Dense(<span class="number">16</span>, activation=<span class="string">&#x27;relu&#x27;</span>, input_shape=(<span class="number">10000</span>, )))</span><br><span class="line">model.add(layers.Dense(<span class="number">16</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>))</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>,</span><br><span class="line">             loss=<span class="string">&#x27;mse&#x27;</span>,</span><br><span class="line">             metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br><span class="line"></span><br><span class="line">model.fit(x_train, y_train, epochs=<span class="number">4</span>, batch_size=<span class="number">512</span>)</span><br><span class="line">result = model.evaluate(x_test, y_test, verbose=<span class="number">2</span>)    <span class="comment"># verbose=2 to avoid a looooong progress bar that fills the screen with &#x27;=&#x27;. https://github.com/tensorflow/tensorflow/issues/32286</span></span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><pre><code>Train on 25000 samplesEpoch 1/425000/25000 [==============================] - 3s 119us/sample - loss: 0.1472 - accuracy: 0.8188Epoch 2/425000/25000 [==============================] - 1s 46us/sample - loss: 0.0755 - accuracy: 0.9121Epoch 3/425000/25000 [==============================] - 1s 50us/sample - loss: 0.0577 - accuracy: 0.9319Epoch 4/425000/25000 [==============================] - 1s 47us/sample - loss: 0.0474 - accuracy: 0.944225000/1 - 3s - loss: 0.0914 - accuracy: 0.8828[0.08648386991858482, 0.88276]</code></pre><ol start="5"><li>ç”¨ tanh æ¿€æ´»</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">model = models.Sequential()</span><br><span class="line">model.add(layers.Dense(<span class="number">16</span>, activation=<span class="string">&#x27;tanh&#x27;</span>, input_shape=(<span class="number">10000</span>, )))</span><br><span class="line">model.add(layers.Dense(<span class="number">16</span>, activation=<span class="string">&#x27;tanh&#x27;</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>))</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>,</span><br><span class="line">             loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>,</span><br><span class="line">             metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br><span class="line"></span><br><span class="line">model.fit(x_train, y_train, epochs=<span class="number">4</span>, batch_size=<span class="number">512</span>)</span><br><span class="line">result = model.evaluate(x_test, y_test, verbose=<span class="number">2</span>)    <span class="comment"># verbose=2 to avoid a looooong progress bar that fills the screen with &#x27;=&#x27;. https://github.com/tensorflow/tensorflow/issues/32286</span></span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><pre><code>Train on 25000 samplesEpoch 1/425000/25000 [==============================] - 4s 149us/sample - loss: 0.4237 - accuracy: 0.8241Epoch 2/425000/25000 [==============================] - 1s 46us/sample - loss: 0.2310 - accuracy: 0.9163Epoch 3/425000/25000 [==============================] - 1s 46us/sample - loss: 0.1779 - accuracy: 0.9329Epoch 4/425000/25000 [==============================] - 1s 49us/sample - loss: 0.1499 - accuracy: 0.945825000/1 - 3s - loss: 0.3738 - accuracy: 0.8772[0.3238203083658218, 0.87716]</code></pre><p>æ‰€ä»¥ï¼Œè¿™äº›å®éªŒå°±æ˜¯è¯´ï¼Œä¹‹å‰æˆ‘ä»¬ä¹¦ä¸Šç”¨çš„æ¨¡å‹æ˜¯åˆç†çš„ï¼Œä½ æ”¹æ¥æ”¹å»éƒ½ä¸å¦‚ä»–é‚£ä¸ªğŸ˜‚ã€‚</p><h2 id="æ–°é—»åˆ†ç±»-å¤šåˆ†ç±»é—®é¢˜"><a href="#æ–°é—»åˆ†ç±»-å¤šåˆ†ç±»é—®é¢˜" class="headerlink" title="æ–°é—»åˆ†ç±»: å¤šåˆ†ç±»é—®é¢˜"></a>æ–°é—»åˆ†ç±»: å¤šåˆ†ç±»é—®é¢˜</h2><p><a href="https://livebook.manning.com/book/deep-learning-with-python/chapter-3/192">åŸæ–‡é“¾æ¥</a></p><p>åˆšæ‰æˆ‘ä»¬ç”µå½±è¯„è®ºé—®é¢˜ä¸æ˜¯æŠŠå‘é‡è¾“å…¥åˆ†æˆä¸¤ç±»å˜›ï¼Œè¿™èŠ‚æˆ‘ä»¬è¦æŠŠä¸œè¥¿åˆ†æˆå¤šç±»ï¼Œå³åšâ€œå¤šåˆ†ç±»ï¼ˆmulti-class classificationï¼‰â€ã€‚</p><p>æˆ‘ä»¬è¦æŠŠæ¥è‡ªè·¯é€ç¤¾çš„æ–°é—»åˆ†åˆ° 46 ä¸ªè¯é¢˜ç§ç±»é‡Œï¼Œè¿™é‡Œè¦æ±‚ä¸€æ¡æ–°é—»åªèƒ½å±äºä¸€ä¸ªç±»ï¼Œæ‰€ä»¥å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬è¦åšçš„æ˜¯ä¸€ä¸ªâ€œå•æ ‡ç­¾å¤šåˆ†ç±»ï¼ˆsingle-label, multiclass classificationï¼‰â€é—®é¢˜ã€‚</p><h3 id="è·¯é€ç¤¾æ•°æ®é›†"><a href="#è·¯é€ç¤¾æ•°æ®é›†" class="headerlink" title="è·¯é€ç¤¾æ•°æ®é›†"></a>è·¯é€ç¤¾æ•°æ®é›†</h3><p>the Reuters datasetï¼Œè·¯é€ç¤¾åœ¨ 1986 å¹´ï¼ˆæ¯”æˆ‘è€å¤šäº†ğŸ˜‚ï¼‰å‘å¸ƒçš„æ•°æ®é›†ï¼Œé‡Œé¢æœ‰ 46 ç±»æ–°é—»ï¼Œè®­ç»ƒé›†é‡Œæ¯ç±»è‡³å°‘ 10 æ¡æ•°æ®ã€‚</p><p>è¿™ä¸ªç©å…·æ•°æ®é›†å’Œ IMDBã€MNIST ä¸€æ ·ï¼Œä¹Ÿåœ¨  Keras é‡Œå†…ç½®äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.datasets <span class="keyword">import</span> reuters</span><br><span class="line"></span><br><span class="line">(train_data, train_labels), (test_data, test_labels) = reuters.load_data(</span><br><span class="line">    num_words=<span class="number">10000</span>)</span><br></pre></td></tr></table></figure><pre><code>Downloading data from https://storage.googleapis.com/tensorflow/tf-keras-datasets/reuters.npz2113536/2110848 [==============================] - 6s 3us/step</code></pre><p>è¿™ä¸ªæ•°æ®é›†é‡Œé¢çš„æ•°æ®å’Œä¹‹å‰çš„ IMDB ä¸€æ ·ï¼ŒæŠŠå•è¯ç¿»è¯‘æˆäº†æ•°å­—ï¼Œç„¶åæˆ‘ä»¬åªæˆªå–å‡ºç°é¢‘ç‡æœ€é«˜çš„10000ä¸ªè¯ã€‚</p><p>å’±ä»¬è¿™ä¸ªè®­ç»ƒé›†é‡Œæœ‰ 8K+ æ¡æ•°æ®ï¼Œæµ‹è¯•é›† 2K+ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="built_in">len</span>(train_data), <span class="built_in">len</span>(test_data))</span><br></pre></td></tr></table></figure><pre><code>8982 2246</code></pre><p>å’±ä»¬è¿˜æ˜¯åƒæ IMDB æ—¶é‚£æ ·ï¼ŒæŠŠæ•°æ®è¿˜åŸä¼šæ–‡æœ¬çœ‹çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode_news</span>(<span class="params">data</span>):</span></span><br><span class="line">    reverse_word_index = &#123;v: k <span class="keyword">for</span> k, v <span class="keyword">in</span> reuters.get_word_index().items()&#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27; &#x27;</span>.join([reverse_word_index.get(i - <span class="number">3</span>, <span class="string">&#x27;?&#x27;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> data])</span><br><span class="line">    <span class="comment"># i - 3 æ˜¯å› ä¸º 0ã€1ã€2 ä¸ºä¿ç•™è¯ â€œpaddingâ€(å¡«å……)ã€â€œstart of sequenceâ€(åºåˆ—å¼€å§‹)ã€â€œunknownâ€(æœªçŸ¥è¯)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">text = decode_news(train_data[<span class="number">0</span>])</span><br><span class="line">print(text)</span><br></pre></td></tr></table></figure><pre><code>? ? ? said as a result of its december acquisition of space co it expects earnings per share in 1987 of 1 15 to 1 30 dlrs per share up from 70 cts in 1986 the company said pretax net should rise to nine to 10 mln dlrs from six mln dlrs in 1986 and rental operation revenues to 19 to 22 mln dlrs from 12 5 mln dlrs it said cash flow per share this year should be 2 50 to three dlrs reuter 3</code></pre><p>æ ‡ç­¾æ˜¯ 0~45 çš„æ•°å­—ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_labels[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><p>Output:</p><pre><code>3</code></pre><h3 id="æ•°æ®å‡†å¤‡-1"><a href="#æ•°æ®å‡†å¤‡-1" class="headerlink" title="æ•°æ®å‡†å¤‡"></a>æ•°æ®å‡†å¤‡</h3><p>é¦–å…ˆï¼Œè¿˜æ˜¯æŠŠæ•°æ®ä½å‘é‡åŒ–ï¼Œç›´æ¥å¥—ç”¨æˆ‘ä»¬æ IMDB æ—¶å†™çš„ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">vectorize_sequences</span>(<span class="params">sequences, dimension=<span class="number">10000</span></span>):</span></span><br><span class="line">    results = np.zeros((<span class="built_in">len</span>(sequences), dimension))</span><br><span class="line">    <span class="keyword">for</span> i, sequence <span class="keyword">in</span> <span class="built_in">enumerate</span>(sequences):</span><br><span class="line">        results[i, sequence] = <span class="number">1.</span></span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x_train = vectorize_sequences(train_data)</span><br><span class="line">x_test = vectorize_sequences(test_data)</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯è¿™ç§æ•ˆæœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(x_train)</span><br></pre></td></tr></table></figure><pre><code>array([[0., 1., 1., ..., 0., 0., 0.],       [0., 1., 1., ..., 0., 0., 0.],       [0., 1., 1., ..., 0., 0., 0.],       ...,       [0., 1., 1., ..., 0., 0., 0.],       [0., 1., 1., ..., 0., 0., 0.],       [0., 1., 1., ..., 0., 0., 0.]])</code></pre><p>ç„¶åè¦å¤„ç†æ ‡ç­¾ã€‚æˆ‘ä»¬å¯ä»¥æŠŠæ ‡ç­¾å¤„ç†æˆæ•´æ•°å¼ é‡ï¼Œä¹Ÿå¯ä»¥ç”¨ <code>One-hot</code> ç¼–ç <br>å¯¹äºåˆ†ç±»è¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬å¸¸ç”¨ one-hot ç¼–ç ï¼ˆä¹Ÿå«<em>åˆ†ç±»ç¼–ç </em>ï¼Œcategorical encodingï¼‰ã€‚</p><p>å¯¹äºæˆ‘ä»¬å½“å‰çš„é—®é¢˜ï¼Œä½¿ç”¨ one-hot ç¼–ç ï¼Œå³ç”¨é™¤äº†æ ‡ç­¾ç´¢å¼•ä½ç½®ä¸º 1 å…¶ä½™ä½ç½®å…¨ä¸º 0 çš„å‘é‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">to_one_hot</span>(<span class="params">labels, dimension=<span class="number">46</span></span>):</span></span><br><span class="line">    results = np.zeros((<span class="built_in">len</span>(labels), dimension))</span><br><span class="line">    <span class="keyword">for</span> i, label <span class="keyword">in</span> <span class="built_in">enumerate</span>(labels):</span><br><span class="line">        results[i, label] = <span class="number">1.</span></span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">one_hot_train_labels = to_one_hot(train_labels)</span><br><span class="line">one_hot_test_labels = to_one_hot(test_labels)</span><br></pre></td></tr></table></figure><p>å…¶å®ï¼Œï¼Œï¼ŒKeras é‡Œè‡ªå¸¦äº†ä¸€ä¸ªå¯ä»¥å¹²è¿™ä¸ªäº‹æƒ…çš„å‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.utils <span class="keyword">import</span> to_categorical</span><br><span class="line"><span class="comment"># ä¹¦ä¸Šæ˜¯ from keras.utils.np_utils import to_categorical ä½†ï¼Œï¼Œï¼Œæ—¶ä»£å˜äº†ï¼Œè€Œä¸”å’±è¿™ç”¨çš„æ˜¯ tensorflow.kerasï¼Œæ‰€ä»¥ç¨å¾®æœ‰ç‚¹åŒºåˆ«</span></span><br><span class="line"></span><br><span class="line">one_hot_train_labels = to_categorical(train_labels)</span><br><span class="line">one_hot_test_labels = to_categorical(test_labels)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(one_hot_train_labels)</span><br></pre></td></tr></table></figure><pre><code>array([[0., 0., 0., ..., 0., 0., 0.],       [0., 0., 0., ..., 0., 0., 0.],       [0., 0., 0., ..., 0., 0., 0.],       ...,       [0., 0., 0., ..., 0., 0., 0.],       [0., 0., 0., ..., 0., 0., 0.],       [0., 0., 0., ..., 0., 0., 0.]], dtype=float32)</code></pre><h3 id="æ„å»ºç½‘ç»œ"><a href="#æ„å»ºç½‘ç»œ" class="headerlink" title="æ„å»ºç½‘ç»œ"></a>æ„å»ºç½‘ç»œ</h3><p>è¿™ä¸ªé—®é¢˜å’Œä¹‹å‰çš„ç”µå½±è¯„è®ºåˆ†ç±»é—®é¢˜è¿˜æ˜¯å·®ä¸å¤šçš„ï¼Œåªæ˜¯æœ€åçš„è§£çš„å¯èƒ½ä» 2 -&gt; 46ï¼Œè§£ç©ºé—´å¤§äº†å¤ªå¤šäº†ã€‚</p><p>å¯¹äºæˆ‘ä»¬ç”¨çš„ Dense å±‚å †å ï¼Œæ¯å±‚éƒ½æ˜¯æ¥æ”¶ä¸Šä¸€å±‚è¾“å‡ºçš„ä¿¡æ¯ä½œä¸ºè¾“å…¥ã€‚<br>æ‰€ä»¥ï¼Œå¦‚æœæŸä¸€å±‚ä¸¢å¤±äº†ä¸€äº›ä¿¡æ¯ï¼Œé‚£ä¹ˆè¿™äº›ä¿¡æ¯å°±å†ä¹Ÿä¸èƒ½è¢«åé¢çš„å±‚æ‰¾å›æ¥äº†ã€‚<br>å¦‚æœä¸¢å¤±çš„ä¿¡æ¯å¯¹åˆ†ç±»æ²¡ç”¨ï¼Œé‚£è¿™ç§ä¸¢å¤±æ˜¯å¥½çš„ã€æˆ‘ä»¬æœŸæœ›å‘ç”Ÿçš„ï¼›<br>ä½†å¦‚æœè¿™äº›ä¸¢å¤±çš„ä¿¡æ¯æ˜¯å¯¹æœ€ååˆ†ç±»èµ·ä½œç”¨çš„ï¼Œé‚£è¿™ç§ä¸¢å¤±å°±åˆ¶çº¦ç½‘ç»œçš„ç»“æœäº†ã€‚<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™å¯èƒ½é€ æˆä¸€ç§â€œä¿¡æ¯ç“¶é¢ˆâ€ã€‚è¿™ç§ç“¶é¢ˆåœ¨æ¯ä¸€å±‚éƒ½å¯èƒ½å‘ç”Ÿã€‚</p><p>ä¹‹å‰çš„ç”µå½±è¯„è®ºåˆ†ç±»æœ€ååªè¦ 2 ä¸ªç»“æœï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠå±‚é‡Œçš„å•å…ƒæ˜¯ç”¨äº† 16 ä¸ªï¼Œ<br>å³è®©æœºå™¨åœ¨ä¸€ä¸ª 16 ç»´ç©ºé—´é‡Œå­¦ä¹ ï¼Œä»¥åŠè¶³å¤Ÿå¤§äº†ï¼Œä¸å¤ªä¼šæœ‰â€œä¿¡æ¯ç“¶é¢ˆâ€œã€‚</p><p>è€Œæˆ‘ä»¬ç°åœ¨çš„é—®é¢˜ï¼Œè§£ç©ºé—´æ˜¯ 46 ç»´çš„ã€‚<br>ç›´æ¥ç…§æ¬ä¹‹å‰çš„ä»£ç ï¼Œè®©å®ƒåœ¨ 16 ç»´ç©ºé—´é‡Œå­¦ä¹ ï¼Œè‚¯å®šæœ‰ç“¶é¢ˆï¼</p><p>è§£å†³ç“¶é¢ˆçš„åŠæ³•å¾ˆç®€å•ï¼Œç›´æ¥å¢åŠ å±‚é‡Œçš„å•å…ƒå°±å¥½ã€‚è¿™é‡Œæˆ‘ä»¬æ˜¯ 16 -&gt; 64:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"></span><br><span class="line">model = models.Sequential()</span><br><span class="line">model.add(layers.Dense(<span class="number">64</span>, activation=<span class="string">&#x27;relu&#x27;</span>, input_shape=(<span class="number">10000</span>,)))</span><br><span class="line">model.add(layers.Dense(<span class="number">64</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">46</span>, activation=<span class="string">&#x27;softmax&#x27;</span>))</span><br></pre></td></tr></table></figure><p>åœ¨æœ€åä¸€å±‚ï¼Œæˆ‘ä»¬çš„è¾“å‡ºæ˜¯ 46 ç»´çš„ï¼Œå¯¹åº” 46 ç§åˆ†ç±»ï¼Œ<br>è€Œè¿™ä¸€å±‚çš„æ¿€æ´»å‡½æ•°æ˜¯ softmaxï¼Œå’Œæˆ‘ä»¬åœ¨è®­ç»ƒ MNIST æ—¶ç”¨çš„ä¸€æ ·ã€‚</p><p>ç”¨ softmax å¯ä»¥è®©ç½‘ç»œè¾“å‡ºåœ¨ 46 ç§åˆ†ç±»ä¸Šçš„æ¦‚ç‡åˆ†å¸ƒï¼Œå³ä¸€ä¸ª 46 ç»´çš„å‘é‡ï¼Œ<br>å…¶ä¸­ç¬¬ i ä¸ªå…ƒç´ ä»£è¡¨è¾“å…¥å±äºç¬¬ i ç§åˆ†ç±»çš„å¯èƒ½æ€§ï¼Œ<br>å¹¶ä¸”è¿™ 46 ä¸ªå…ƒç´ çš„æ€»å’Œä¸º <code>1</code>ã€‚</p><h3 id="ç¼–è¯‘æ¨¡å‹-1"><a href="#ç¼–è¯‘æ¨¡å‹-1" class="headerlink" title="ç¼–è¯‘æ¨¡å‹"></a>ç¼–è¯‘æ¨¡å‹</h3><p>ç¼–è¯‘æ¨¡å‹ï¼Œåˆè¦ç¡®å®šæŸå¤±å‡½æ•°ã€ä¼˜åŒ–å™¨å’Œä¼˜åŒ–çš„ç›®æ ‡äº†ã€‚</p><ul><li>æŸå¤±å‡½æ•°ï¼Œåˆ†ç±»é—®é¢˜å˜›ï¼Œè¿˜æ˜¯ç”¨â€œåˆ†ç±»äº¤å‰ç†µâ€ categorical_crossentropyã€‚</li><li>ä¼˜åŒ–å™¨ï¼Œå…¶å®å¯¹å¾ˆå¤šé—®é¢˜æˆ‘ä»¬éƒ½æ˜¯ç”¨ rmsprop</li><li>ç›®æ ‡è¿˜æ˜¯ä¸€ä¸ªï¼Œé¢„æµ‹çš„ç²¾åº¦ accuracy</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>,</span><br><span class="line">              loss=<span class="string">&#x27;categorical_crossentropy&#x27;</span>,</span><br><span class="line">              metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br></pre></td></tr></table></figure><h3 id="éªŒè¯æ•ˆæœ"><a href="#éªŒè¯æ•ˆæœ" class="headerlink" title="éªŒè¯æ•ˆæœ"></a>éªŒè¯æ•ˆæœ</h3><p>æˆ‘ä»¬è¿˜æ˜¯è¦æä¸€ä¸ªéªŒè¯é›†æ¥åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è¯„ä¼°æ¨¡å‹çš„ã€‚ä»è®­ç»ƒé›†é‡Œåˆ†ä¸ª 1K æ¡æ•°æ®å‡ºæ¥å°±å¥½ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x_val = x_train[:<span class="number">1000</span>]</span><br><span class="line">partial_x_train = x_train[<span class="number">1000</span>:]</span><br><span class="line"></span><br><span class="line">y_val = one_hot_train_labels[:<span class="number">1000</span>]</span><br><span class="line">partial_y_train = one_hot_train_labels[<span class="number">1000</span>:]</span><br></pre></td></tr></table></figure><h3 id="è®­ç»ƒæ¨¡å‹-1"><a href="#è®­ç»ƒæ¨¡å‹-1" class="headerlink" title="è®­ç»ƒæ¨¡å‹"></a>è®­ç»ƒæ¨¡å‹</h3><p>å¥½äº†ï¼Œå‡†å¤‡å·¥ä½œå®Œæˆï¼Œåˆå¯ä»¥çœ‹åˆ°æœ€è¿·äººçš„è®­ç»ƒè¿‡ç¨‹äº†ï¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">history = model.fit(partial_x_train,</span><br><span class="line">                    partial_y_train,</span><br><span class="line">                    epochs=<span class="number">20</span>,</span><br><span class="line">                    batch_size=<span class="number">512</span>,</span><br><span class="line">                    validation_data=(x_val, y_val))</span><br></pre></td></tr></table></figure><pre><code>Train on 7982 samples, validate on 1000 samplesEpoch 1/207982/7982 [==============================] - 3s 372us/sample - loss: 2.6180 - accuracy: 0.5150 - val_loss: 1.7517 - val_accuracy: 0.6290......Epoch 20/207982/7982 [==============================] - 1s 91us/sample - loss: 0.1134 - accuracy: 0.9578 - val_loss: 1.0900 - val_accuracy: 0.8040</code></pre><p>ğŸ†—æŒºå¿«çš„ï¼Œç…§ä¾‹ï¼Œè¿˜æ˜¯ç”»å›¾çœ‹çœ‹è®­ç»ƒè¿‡ç¨‹ã€‚</p><ol><li>è®­ç»ƒè¿‡ç¨‹ä¸­çš„æŸå¤±</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">loss = history.history[<span class="string">&#x27;loss&#x27;</span>]</span><br><span class="line">val_loss = history.history[<span class="string">&#x27;val_loss&#x27;</span>]</span><br><span class="line">epochs = <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(loss) + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">plt.plot(epochs, loss, <span class="string">&#x27;bo-&#x27;</span>, label=<span class="string">&#x27;Training loss&#x27;</span>)</span><br><span class="line">plt.plot(epochs, val_loss, <span class="string">&#x27;rs-&#x27;</span>, label=<span class="string">&#x27;Validation loss&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation loss&#x27;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;Epochs&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;Loss&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggjed34amjj30at07qdfx.jpg" alt="png"></p><ol start="2"><li>è®­ç»ƒè¿‡ç¨‹ä¸­çš„ç²¾åº¦</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">plt.clf()</span><br><span class="line"></span><br><span class="line">acc = history.history[<span class="string">&#x27;accuracy&#x27;</span>]</span><br><span class="line">val_acc = history.history[<span class="string">&#x27;val_accuracy&#x27;</span>]</span><br><span class="line"></span><br><span class="line">plt.plot(epochs, acc, <span class="string">&#x27;bo-&#x27;</span>, label=<span class="string">&#x27;Training acc&#x27;</span>)</span><br><span class="line">plt.plot(epochs, val_acc, <span class="string">&#x27;rs-&#x27;</span>, label=<span class="string">&#x27;Validation acc&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation accuracy&#x27;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;Epochs&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;Loss&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggjed4tgtzj30at07qglp.jpg" alt="png"></p><p>Emmmmï¼Œè¯´ï¼Œç¬¬9è½® epochs çš„æ—¶å€™å¼€å§‹è¿‡æ‹Ÿåˆäº†ï¼ˆä½ çœ‹validationçš„æ›²çº¿æŠ–åœ¨ç¬¬9è½®äº†ä¸€ä¸‹ï¼‰ã€‚<br>æ‰€ä»¥åªè¦è·‘ 9 è½®å°±å¤Ÿäº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">model = models.Sequential()</span><br><span class="line">model.add(layers.Dense(<span class="number">64</span>, activation=<span class="string">&#x27;relu&#x27;</span>, input_shape=(<span class="number">10000</span>,)))</span><br><span class="line">model.add(layers.Dense(<span class="number">64</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">46</span>, activation=<span class="string">&#x27;softmax&#x27;</span>))</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>,</span><br><span class="line">              loss=<span class="string">&#x27;categorical_crossentropy&#x27;</span>,</span><br><span class="line">              metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br><span class="line"></span><br><span class="line">model.fit(partial_x_train,</span><br><span class="line">          partial_y_train,</span><br><span class="line">          epochs=<span class="number">9</span>,</span><br><span class="line">          batch_size=<span class="number">512</span>,</span><br><span class="line">          validation_data=(x_val, y_val))</span><br></pre></td></tr></table></figure><pre><code>Train on 7982 samples, validate on 1000 samplesEpoch 1/97982/7982 [==============================] - 1s 153us/sample - loss: 2.5943 - accuracy: 0.5515 - val_loss: 1.7017 - val_accuracy: 0.6410......Epoch 9/97982/7982 [==============================] - 1s 84us/sample - loss: 0.2793 - accuracy: 0.9402 - val_loss: 0.8758 - val_accuracy: 0.8170&lt;tensorflow.python.keras.callbacks.History at 0x16eb5d6d0&gt;</code></pre><p>ç„¶åï¼Œç”¨æµ‹è¯•é›†æµ‹è¯•ä¸€ä¸‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">results = model.evaluate(x_test, one_hot_test_labels, verbose=<span class="number">2</span>)</span><br><span class="line">print(results)</span><br></pre></td></tr></table></figure><pre><code>2246/1 - 0s - loss: 1.7611 - accuracy: 0.7912[0.983459981976082, 0.7911843]</code></pre><p>ç²¾åº¦å·®ä¸å¤š 80%ï¼Œå…¶å®è¿˜æ˜¯ä¸é”™çš„äº†ï¼Œæ¯”éšæœºçåˆ’çº¿å»åˆ†å¥½å¤šäº†ã€‚</p><p>å¦‚æœéšæœºåˆ’çº¿å»åˆ†ç±»çš„è¯ï¼Œå¯¹äºŒå…ƒåˆ†ç±»é—®é¢˜ç²¾åº¦æ˜¯ 50 %ï¼Œè€Œå¯¹è¿™ 46 å…ƒçš„åˆ†ç±»ç²¾åº¦åªè¦ä¸åˆ° 19% äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line">test_labels_copy = copy.copy(test_labels)</span><br><span class="line">np.random.shuffle(test_labels_copy)</span><br><span class="line">hits_array = np.array(test_labels) == np.array(test_labels_copy)</span><br><span class="line"><span class="built_in">float</span>(np.<span class="built_in">sum</span>(hits_array)) / <span class="built_in">len</span>(test_labels)</span><br></pre></td></tr></table></figure><pre><code>0.18432769367764915</code></pre><p>è°ƒç”¨ model å®ä¾‹çš„ predict æ–¹æ³•ï¼Œå¯ä»¥å¾—åˆ°å¯¹è¾“å…¥åœ¨ 46 ä¸ªåˆ†ç±»ä¸Šçš„æ¦‚ç‡åˆ†å¸ƒï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">predictions = model.predict(x_test)</span><br><span class="line">print(predictions)</span><br></pre></td></tr></table></figure><pre><code>array([[4.7181980e-05, 2.0765587e-05, 8.6653872e-06, ..., 3.1266565e-05,        8.2046267e-07, 6.0611728e-06],       [5.9005950e-04, 1.3404934e-02, 1.2290048e-03, ..., 4.2919168e-05,        5.7422225e-05, 4.0201416e-05],       [8.5751421e-04, 9.2367262e-01, 1.5855590e-03, ..., 4.8341672e-04,        4.5594123e-05, 2.6183401e-05],       ...,       [8.5679676e-05, 2.0081598e-04, 4.1808224e-05, ..., 7.6962686e-05,        6.5783697e-06, 2.9889508e-05],       [1.7291466e-03, 2.5600385e-02, 1.8182390e-03, ..., 1.4499390e-03,        4.8478998e-04, 8.5257640e-04],       [2.5776261e-04, 8.6797208e-01, 3.9900807e-03, ..., 2.6547859e-04,        6.5820634e-05, 6.8603881e-06]], dtype=float32)</code></pre><p>predictions åˆ†åˆ«ä»£è¡¨ 46 ä¸ªåˆ†ç±»çš„å¯èƒ½:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">predictions[<span class="number">0</span>].shape</span><br></pre></td></tr></table></figure><pre><code>(46,)</code></pre><p>ä»–ä»¬çš„æ€»å’Œä¸º 1ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.<span class="built_in">sum</span>(predictions[<span class="number">0</span>])</span><br></pre></td></tr></table></figure><pre><code>0.99999994</code></pre><p> å…¶ä¸­æœ€å¤§çš„ï¼Œå³æˆ‘ä»¬è®¤ä¸ºè¿™æ¡æ–°é—»å±äºè¿™ä¸ªåˆ†ç±»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.argmax(predictions[<span class="number">0</span>])</span><br></pre></td></tr></table></figure><pre><code>3</code></pre><h3 id="å¤„ç†æ ‡ç­¾å’ŒæŸå¤±çš„å¦ä¸€ç§æ–¹æ³•"><a href="#å¤„ç†æ ‡ç­¾å’ŒæŸå¤±çš„å¦ä¸€ç§æ–¹æ³•" class="headerlink" title="å¤„ç†æ ‡ç­¾å’ŒæŸå¤±çš„å¦ä¸€ç§æ–¹æ³•"></a>å¤„ç†æ ‡ç­¾å’ŒæŸå¤±çš„å¦ä¸€ç§æ–¹æ³•</h3><p>å‰é¢æåˆ°äº†æ ‡ç­¾å¯ä»¥ä½¿ç”¨ one-hot ç¼–ç ï¼Œæˆ–è€…ç›´æ¥æŠŠæ ‡ç­¾å¤„ç†æˆæ•´æ•°å¼ é‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">y_train = np.array(train_labels)</span><br><span class="line">y_test = np.array(test_labels)</span><br></pre></td></tr></table></figure><p>ç”¨è¿™ç§çš„è¯ï¼ŒæŸå¤±å‡½æ•°ä¹Ÿè¦è·Ÿç€æ”¹ï¼Œæ”¹æˆ sparse_categorical_crossentropyï¼Œ<br>è¿™ä¸ªå’Œ categorical_crossentropy åœ¨æ•°å­¦ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯æ¥å£ä¸åŒï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>,</span><br><span class="line">              loss=<span class="string">&#x27;sparse_categorical_crossentropy&#x27;</span>,</span><br><span class="line">              metrics=[<span class="string">&#x27;acc&#x27;</span>])</span><br></pre></td></tr></table></figure><h3 id="ä¸­é—´å±‚ç»´åº¦è¶³å¤Ÿå¤§çš„é‡è¦æ€§"><a href="#ä¸­é—´å±‚ç»´åº¦è¶³å¤Ÿå¤§çš„é‡è¦æ€§" class="headerlink" title="ä¸­é—´å±‚ç»´åº¦è¶³å¤Ÿå¤§çš„é‡è¦æ€§"></a>ä¸­é—´å±‚ç»´åº¦è¶³å¤Ÿå¤§çš„é‡è¦æ€§</h3><p>ä¹‹å‰è®¨è®ºäº†å…³äºâ€œä¿¡æ¯ç“¶é¢ˆâ€çš„äº‹ï¼Œç„¶åæˆ‘ä»¬å°±è¯´å¯¹è¿™ä¸ª 46 ç»´ç»“æœçš„ç½‘ç»œï¼Œä¸­é—´å±‚çš„ç»´åº¦è¦è¶³å¤Ÿå¤§ï¼</p><p>ç°åœ¨å’±è¯•è¯•å¦‚æœä¸å¤Ÿå¤§ï¼ˆå¯¼è‡´ä¿¡æ¯ç“¶é¢ˆï¼‰ä¼šæ€ä¹ˆæ ·ï¼Œå’±æå¤¸å¼ ä¸€ç‚¹ï¼Œä» 64 å‡åˆ° 4ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">model = models.Sequential()</span><br><span class="line">model.add(layers.Dense(<span class="number">64</span>, activation=<span class="string">&#x27;relu&#x27;</span>, input_shape=(<span class="number">10000</span>,)))</span><br><span class="line">model.add(layers.Dense(<span class="number">4</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">46</span>, activation=<span class="string">&#x27;softmax&#x27;</span>))</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>,</span><br><span class="line">              loss=<span class="string">&#x27;categorical_crossentropy&#x27;</span>,</span><br><span class="line">              metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br><span class="line"></span><br><span class="line">model.fit(partial_x_train,</span><br><span class="line">          partial_y_train,</span><br><span class="line">          epochs=<span class="number">20</span>,</span><br><span class="line">          batch_size=<span class="number">128</span>,</span><br><span class="line">          validation_data=(x_val, y_val))</span><br></pre></td></tr></table></figure><pre><code>Train on 7982 samples, validate on 1000 samplesEpoch 1/207982/7982 [==============================] - 2s 288us/sample - loss: 2.8097 - accuracy: 0.4721 - val_loss: 2.0554 - val_accuracy: 0.5430.......Epoch 20/207982/7982 [==============================] - 1s 121us/sample - loss: 0.6443 - accuracy: 0.8069 - val_loss: 1.8962 - val_accuracy: 0.6800&lt;tensorflow.python.keras.callbacks.History at 0x16f628b50&gt;</code></pre><p>çœ‹çœ‹è¿™ï¼Œè¿™è®­ç»ƒå‡ºæ¥æ¯”ä¹‹å‰ 64 ç»´çš„å·®çš„ä¸æ˜¯ä¸€ç‚¹åŠç‚¹å“ˆï¼Œå·®è·ç›¸å½“æ˜æ˜¾äº†ã€‚</p><p>å‘ç”Ÿè¿™ç§æ•ˆæœçš„ä¸‹é™å°±æ˜¯å› ä¸ºä½ ç»™ä»–å­¦ä¹ çš„ç©ºé—´ç»´åº¦å¤ªä½äº†ï¼Œä»–æŠŠå¥½å¤šå¯¹åˆ†ç±»æœ‰ç”¨çš„ä¿¡æ¯æŠ›å¼ƒäº†ã€‚</p><p>é‚£æ˜¯ä¸æ˜¯è¶Šå¤§è¶Šå¥½ï¼Ÿæˆ‘ä»¬å†è¯•è¯•æŠŠä¸­é—´å±‚åŠ å¤§ä¸€äº›ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">model = models.Sequential()</span><br><span class="line">model.add(layers.Dense(<span class="number">64</span>, activation=<span class="string">&#x27;relu&#x27;</span>, input_shape=(<span class="number">10000</span>,)))</span><br><span class="line">model.add(layers.Dense(<span class="number">4096</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">46</span>, activation=<span class="string">&#x27;softmax&#x27;</span>))</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>,</span><br><span class="line">              loss=<span class="string">&#x27;categorical_crossentropy&#x27;</span>,</span><br><span class="line">              metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br><span class="line"></span><br><span class="line">model.fit(partial_x_train,</span><br><span class="line">          partial_y_train,</span><br><span class="line">          epochs=<span class="number">20</span>,</span><br><span class="line">          batch_size=<span class="number">128</span>,</span><br><span class="line">          validation_data=(x_val, y_val))</span><br></pre></td></tr></table></figure><pre><code>Train on 7982 samples, validate on 1000 samplesEpoch 1/207982/7982 [==============================] - 2s 273us/sample - loss: 1.5523 - accuracy: 0.6310 - val_loss: 1.1903 - val_accuracy: 0.7060......Epoch 20/207982/7982 [==============================] - 2s 296us/sample - loss: 0.0697 - accuracy: 0.9605 - val_loss: 3.5296 - val_accuracy: 0.7850&lt;tensorflow.python.keras.callbacks.History at 0x1707fcf90&gt;</code></pre><p>å¯ä»¥çœ‹åˆ°è®­ç»ƒç”¨çš„æ—¶é—´é•¿äº†ä¸€ç‚¹ï¼Œç”µè„‘æ›´æš–æ‰‹äº†ä¸€ç‚¹ï¼Œä½†æ•ˆæœå´æ²¡æœ‰å¤šå¤§çš„æå‡ã€‚<br>è¿™æ˜¯ç”±äºç¬¬ä¸€å±‚è¾“å…¥åˆ°ä¸­é—´å±‚çš„åªæœ‰ 64 ç»´å˜›ï¼Œä¸­é—´å±‚å†å¤§ï¼Œä¹Ÿè¢«ç¬¬ä¸€å±‚çš„ç“¶é¢ˆåˆ¶çº¦äº†ã€‚</p><p>åœ¨è¯•è¯•æŠŠç¬¬ä¸€å±‚ä¹ŸåŠ å¤§ï¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">model = models.Sequential()</span><br><span class="line">model.add(layers.Dense(<span class="number">512</span>, activation=<span class="string">&#x27;relu&#x27;</span>, input_shape=(<span class="number">10000</span>,)))</span><br><span class="line">model.add(layers.Dense(<span class="number">512</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">46</span>, activation=<span class="string">&#x27;softmax&#x27;</span>))</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>,</span><br><span class="line">              loss=<span class="string">&#x27;categorical_crossentropy&#x27;</span>,</span><br><span class="line">              metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br><span class="line"></span><br><span class="line">model.fit(partial_x_train,</span><br><span class="line">          partial_y_train,</span><br><span class="line">          epochs=<span class="number">20</span>,</span><br><span class="line">          batch_size=<span class="number">128</span>,</span><br><span class="line">          validation_data=(x_val, y_val))</span><br></pre></td></tr></table></figure><pre><code>Train on 7982 samples, validate on 1000 samplesEpoch 1/207982/7982 [==============================] - 5s 662us/sample - loss: 1.3423 - accuracy: 0.6913 - val_loss: 0.9565 - val_accuracy: 0.7920......Epoch 20/207982/7982 [==============================] - 5s 583us/sample - loss: 0.0648 - accuracy: 0.9597 - val_loss: 2.9887 - val_accuracy: 0.8030&lt;tensorflow.python.keras.callbacks.History at 0x176fbbd90&gt;</code></pre><p>ï¼ˆç¨å¾®å°ä¸€ç‚¹ï¼Œæœ¬æ¥æ˜¯ç”¨ 4096 çš„ï¼Œä½†å¤ªå¤§äº†ï¼Œå’±ä¹ä¸ç‰ˆ mbp è·‘çš„è´¼æ…¢ï¼Œè·‘å®Œè¦20å¤šåˆ†é’Ÿï¼Œæˆ‘æ‡’å¾—ç­‰ï¼‰</p><p>è¿™ä¸ªå¤šæµªè´¹äº†å¥½å¤šæ—¶é—´ï¼Œè€Œä¸”ä»–å¾ˆå¿«å°±<del>è¿‡æ³¥æ²³</del>è¿‡æ‹Ÿåˆäº†ï¼Œè¿‡å¾—è¿˜è¿‡å¾—å¾ˆä¸¥é‡ï¼Œç”»ä¸ªå›¾çœ‹ä¸€ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">loss = _.history[<span class="string">&#x27;loss&#x27;</span>]</span><br><span class="line">val_loss = _.history[<span class="string">&#x27;val_loss&#x27;</span>]</span><br><span class="line">epochs = <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(loss) + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">plt.plot(epochs, loss, <span class="string">&#x27;bo-&#x27;</span>, label=<span class="string">&#x27;Training loss&#x27;</span>)</span><br><span class="line">plt.plot(epochs, val_loss, <span class="string">&#x27;rs-&#x27;</span>, label=<span class="string">&#x27;Validation loss&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation loss&#x27;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;Epochs&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;Loss&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggjefsh6f1j30at07qwel.jpg" alt="png"></p><p>æ‰€ä»¥ï¼Œå¤ªå¤§äº†ä¹Ÿä¸å¥½ã€‚è¿˜æ˜¯è¦æœ‰ä¸ªåº¦ï¼</p><h3 id="å°è¯•ä½¿ç”¨æ›´å°‘-æ›´å¤šçš„å±‚"><a href="#å°è¯•ä½¿ç”¨æ›´å°‘-æ›´å¤šçš„å±‚" class="headerlink" title="å°è¯•ä½¿ç”¨æ›´å°‘/æ›´å¤šçš„å±‚"></a>å°è¯•ä½¿ç”¨æ›´å°‘/æ›´å¤šçš„å±‚</h3><ol><li>æ›´å°‘çš„å±‚</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">model = models.Sequential()</span><br><span class="line">model.add(layers.Dense(<span class="number">46</span>, activation=<span class="string">&#x27;softmax&#x27;</span>, input_shape=(<span class="number">10000</span>,)))</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>,</span><br><span class="line">              loss=<span class="string">&#x27;categorical_crossentropy&#x27;</span>,</span><br><span class="line">              metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br><span class="line"></span><br><span class="line">history = model.fit(partial_x_train,</span><br><span class="line">          partial_y_train,</span><br><span class="line">          epochs=<span class="number">20</span>,</span><br><span class="line">          batch_size=<span class="number">128</span>,</span><br><span class="line">          validation_data=(x_val, y_val))</span><br><span class="line"></span><br><span class="line">loss = history.history[<span class="string">&#x27;loss&#x27;</span>]</span><br><span class="line">val_loss = history.history[<span class="string">&#x27;val_loss&#x27;</span>]</span><br><span class="line">epochs = <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(loss) + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">plt.plot(epochs, loss, <span class="string">&#x27;bo-&#x27;</span>, label=<span class="string">&#x27;Training loss&#x27;</span>)</span><br><span class="line">plt.plot(epochs, val_loss, <span class="string">&#x27;rs-&#x27;</span>, label=<span class="string">&#x27;Validation loss&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation loss&#x27;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;Epochs&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;Loss&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><pre><code>Train on 7982 samples, validate on 1000 samplesEpoch 1/207982/7982 [==============================] - 1s 132us/sample - loss: 2.4611 - accuracy: 0.6001 - val_loss: 1.8556 - val_accuracy: 0.6440......Epoch 20/207982/7982 [==============================] - 1s 85us/sample - loss: 0.1485 - accuracy: 0.9570 - val_loss: 1.2116 - val_accuracy: 0.7960</code></pre><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggjeg0o13pj30at07qaa5.jpg" alt="png"></p><p>å¿«å‘€ï¼ç»“æœç¨å¾®å·®äº†ä¸€ç‚¹ç‚¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Clown0te(<span class="string">&quot;é˜²ç›—æ–‡çˆ¬:)è™«çš„è¿½è¸ªæ ‡ç­¾ï¼Œè¯»è€…ä¸å¿…åœ¨æ„&quot;</span>).by(CDFMLR)</span><br></pre></td></tr></table></figure><ol start="2"><li>æ›´å¤šçš„å±‚</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">model = models.Sequential()</span><br><span class="line">model.add(layers.Dense(<span class="number">64</span>, activation=<span class="string">&#x27;relu&#x27;</span>, input_shape=(<span class="number">10000</span>,)))</span><br><span class="line">model.add(layers.Dense(<span class="number">64</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">64</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">64</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">46</span>, activation=<span class="string">&#x27;softmax&#x27;</span>))</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;rmsprop&#x27;</span>,</span><br><span class="line">              loss=<span class="string">&#x27;categorical_crossentropy&#x27;</span>,</span><br><span class="line">              metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br><span class="line"></span><br><span class="line">history = model.fit(partial_x_train,</span><br><span class="line">          partial_y_train,</span><br><span class="line">          epochs=<span class="number">20</span>,</span><br><span class="line">          batch_size=<span class="number">128</span>,</span><br><span class="line">          validation_data=(x_val, y_val))</span><br><span class="line"></span><br><span class="line">loss = history.history[<span class="string">&#x27;loss&#x27;</span>]</span><br><span class="line">val_loss = history.history[<span class="string">&#x27;val_loss&#x27;</span>]</span><br><span class="line">epochs = <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(loss) + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">plt.plot(epochs, loss, <span class="string">&#x27;bo-&#x27;</span>, label=<span class="string">&#x27;Training loss&#x27;</span>)</span><br><span class="line">plt.plot(epochs, val_loss, <span class="string">&#x27;rs-&#x27;</span>, label=<span class="string">&#x27;Validation loss&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and validation loss&#x27;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;Epochs&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;Loss&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><pre><code>Train on 7982 samples, validate on 1000 samplesEpoch 1/207982/7982 [==============================] - 2s 188us/sample - loss: 1.8340 - accuracy: 0.5829 - val_loss: 1.3336 - val_accuracy: 0.6910......Epoch 20/207982/7982 [==============================] - 1s 115us/sample - loss: 0.0891 - accuracy: 0.9600 - val_loss: 1.7227 - val_accuracy: 0.7900</code></pre><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggjem9vu9zj30b007qmxh.jpg" alt="png"></p><p>æ‰€ä»¥ï¼Œè¿™ä¸ªä¹Ÿä¸æ˜¯è¶Šå¤šè¶Šå¥½å‘€ï¼</p><h2 id="é¢„æµ‹æˆ¿ä»·-å›å½’é—®é¢˜"><a href="#é¢„æµ‹æˆ¿ä»·-å›å½’é—®é¢˜" class="headerlink" title="é¢„æµ‹æˆ¿ä»·: å›å½’é—®é¢˜"></a>é¢„æµ‹æˆ¿ä»·: å›å½’é—®é¢˜</h2><p><a href="https://livebook.manning.com/book/deep-learning-with-python/chapter-3/271">åŸæ–‡é“¾æ¥</a></p><p>å‰é¢ä¸¤ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬éƒ½æ˜¯åœ¨åšåˆ†ç±»é—®é¢˜ï¼ˆé¢„æµ‹ç¦»æ•£çš„æ ‡ç­¾ï¼‰ã€‚è¿™æ¬¡çœ‹ä¸€ä¸ªå›å½’é—®é¢˜ï¼ˆé¢„æµ‹è¿ç»­çš„æ•°å€¼ï¼‰ã€‚</p><h3 id="æ³¢å£«é¡¿æˆ¿é—´æ•°æ®é›†"><a href="#æ³¢å£«é¡¿æˆ¿é—´æ•°æ®é›†" class="headerlink" title="æ³¢å£«é¡¿æˆ¿é—´æ•°æ®é›†"></a>æ³¢å£«é¡¿æˆ¿é—´æ•°æ®é›†</h3><p>æˆ‘ä»¬ç”¨ Boston Housing Price dataset è¿™ä¸ªæ•°æ®é›†æ¥é¢„æµ‹ 70 å¹´ä»£ä¸­æœŸçš„æ³¢å£«é¡¿éƒŠåŒºæˆ¿ä»·ã€‚æ•°æ®é›†é‡Œæœ‰å½“æ—¶é‚£ä¸ªåœ°æ–¹çš„ä¸€äº›æ•°æ®ï¼Œæ¯”å¦‚çŠ¯ç½ªå¾‹ã€ç¨ç‡ä»€ä¹ˆçš„ã€‚</p><p>è¿™ä¸ªæ•°æ®é›†æ¯”èµ·æˆ‘ä»¬å‰ä¸¤ä¸ªåˆ†ç±»çš„æ•°æ®é›†ï¼Œæ•°æ®ç›¸å½“å°‘ï¼Œåªæœ‰ 506 ä¸ªï¼Œ404 ä¸ªåœ¨è®­ç»ƒé›†ï¼Œ102 éä¸ªåœ¨æµ‹è¯•é›†ã€‚æ•°æ®é‡Œæ¯ç§ç‰¹å¾ï¼ˆfeatureï¼‰çš„è¾“å…¥æ•°æ®æ•°é‡çº§ä¹Ÿä¸å°½ç›¸åŒã€‚</p><p>æˆ‘ä»¬å…ˆæŠŠæ•°æ®å¯¼è¿›æ¥çœ‹çœ‹ï¼ˆè¿™ä¸ªæ•°æ®é›†ä¹Ÿæ˜¯ Keras è‡ªå¸¦æœ‰çš„ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.datasets <span class="keyword">import</span> boston_housing</span><br><span class="line"></span><br><span class="line">(train_data, train_targets), (test_data, test_targets) = boston_housing.load_data()</span><br><span class="line"></span><br><span class="line">print(train_data.shape, test_data.shape)</span><br></pre></td></tr></table></figure><pre><code>(404, 13) (102, 13)</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_data[<span class="number">0</span>:<span class="number">3</span>]</span><br></pre></td></tr></table></figure><pre><code>array([[1.23247e+00, 0.00000e+00, 8.14000e+00, 0.00000e+00, 5.38000e-01,        6.14200e+00, 9.17000e+01, 3.97690e+00, 4.00000e+00, 3.07000e+02,        2.10000e+01, 3.96900e+02, 1.87200e+01],       [2.17700e-02, 8.25000e+01, 2.03000e+00, 0.00000e+00, 4.15000e-01,        7.61000e+00, 1.57000e+01, 6.27000e+00, 2.00000e+00, 3.48000e+02,        1.47000e+01, 3.95380e+02, 3.11000e+00],       [4.89822e+00, 0.00000e+00, 1.81000e+01, 0.00000e+00, 6.31000e-01,        4.97000e+00, 1.00000e+02, 1.33250e+00, 2.40000e+01, 6.66000e+02,        2.02000e+01, 3.75520e+02, 3.26000e+00]])</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_targets[<span class="number">0</span>:<span class="number">3</span>]</span><br></pre></td></tr></table></figure><pre><code>array([15.2, 42.3, 50. ])</code></pre><p>targets é‡Œçš„æ•°æ®å•ä½æ˜¯ <em>åƒç¾å…ƒ</em>ï¼Œ è¿™ä¸ªæ—¶å€™çš„æˆ¿ä»·è¿˜æ¯”è¾ƒä¾¿å®œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">min</span>(train_targets), <span class="built_in">sum</span>(train_targets)/<span class="built_in">len</span>(train_targets), <span class="built_in">max</span>(train_targets)</span><br></pre></td></tr></table></figure><pre><code>(5.0, 22.395049504950496, 50.0)</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">x = <span class="built_in">range</span>(<span class="built_in">len</span>(train_targets))</span><br><span class="line">y = train_targets</span><br><span class="line"></span><br><span class="line">plt.plot(x, y, <span class="string">&#x27;o&#x27;</span>, label=<span class="string">&#x27;data&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;House Prices&#x27;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;train_targets&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;prices&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggje0e4s1qj30aq07r3yo.jpg" alt="png"></p><h3 id="æ•°æ®å‡†å¤‡-2"><a href="#æ•°æ®å‡†å¤‡-2" class="headerlink" title="æ•°æ®å‡†å¤‡"></a>æ•°æ®å‡†å¤‡</h3><p>æˆ‘ä»¬å–‚ç»™ç¥ç»ç½‘ç»œçš„æ•°æ®å€¼çš„èŒƒå›´ä¸åº”è¯¥å·®è·å¤ªå¤§ï¼Œè™½ç„¶ç¥ç»ç½‘ç»œæ˜¯å¯ä»¥å¤„ç†å·®è·å¤§çš„æ•°æ®çš„ï¼Œä½†æ€»å½’ä¸å¤ªå¥½ã€‚<br>å¯¹äºè¿™ç§å·®è·å¤§çš„æ•°æ®ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šå¯¹æ¯ä¸ªç‰¹å¾åšæ ‡å‡†åŒ–ï¼ˆfeature-wise normalizationï¼‰ã€‚</p><p>å…·ä½“çš„æ“ä½œæ˜¯å¯¹æ¯ä¸ªç‰¹å¾ï¼ˆè¾“å…¥æ•°æ®çŸ©é˜µçš„ä¸€åˆ—ï¼‰å‡å»è¯¥åˆ—çš„å‡å€¼ï¼Œå†é™¤ä»¥å…¶æ ‡å‡†å·®ã€‚<br>è¿™æ ·åšå®Œä¹‹åï¼Œæ•°æ®ä¼šå˜æˆä»¥ 0 ä¸ºä¸­å¿ƒçš„ï¼Œæœ‰ä¸€ä¸ªæ ‡å‡†å·®çš„ï¼ˆæ ‡å‡†å·®ä¸º 1 ï¼‰ã€‚</p><p>ç”¨ Numpy å¯ä»¥å¾ˆå®¹æ˜“çš„åšè¿™ä¸ªï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mean = train_data.mean(axis=<span class="number">0</span>)</span><br><span class="line">std = train_data.std(axis=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">train_data -= mean</span><br><span class="line">train_data /= std</span><br><span class="line"></span><br><span class="line">test_data -= mean</span><br><span class="line">test_data /= std</span><br></pre></td></tr></table></figure><p>æ³¨æ„å“ˆï¼Œå¯¹æµ‹è¯•é›†çš„å¤„ç†ç”¨çš„æ˜¯è®­ç»ƒé›†çš„å‡å€¼å’Œæ ‡å‡†å·®ã€‚</p><p>å¤„ç†å®Œæ•°æ®å°±å¯ä»¥æ„å»ºç½‘ç»œã€è®­ç»ƒäº†ï¼ˆæ ‡ç­¾ä¸ç”¨å¤„ç†ï¼Œæ¯”åˆ†ç±»æ–¹ä¾¿ï¼‰</p><h3 id="æ„å»ºç½‘ç»œ-1"><a href="#æ„å»ºç½‘ç»œ-1" class="headerlink" title="æ„å»ºç½‘ç»œ"></a>æ„å»ºç½‘ç»œ</h3><p>æ•°æ®è¶Šå°‘ï¼Œè¶Šå®¹æ˜“è¿‡æ‹Ÿåˆï¼Œè¦å‡ç¼“è¿‡æ‹Ÿåˆï¼Œå¯ä»¥ä½¿ç”¨æ¯”è¾ƒå°çš„ç½‘ç»œã€‚</p><p>æ¯”å¦‚ï¼Œåœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªåªæœ‰ä¸¤ä¸ªéšè—å±‚çš„ç½‘ç»œï¼Œæ¯ä¸ª 64 å•å…ƒï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_model</span>():</span></span><br><span class="line">    model = models.Sequential()</span><br><span class="line">    model.add(layers.Dense(<span class="number">64</span>, activation=<span class="string">&quot;relu&quot;</span>, input_shape=(train_data.shape[<span class="number">1</span>], )))</span><br><span class="line">    model.add(layers.Dense(<span class="number">64</span>, activation=<span class="string">&quot;relu&quot;</span>))</span><br><span class="line">    model.add(layers.Dense(<span class="number">1</span>))</span><br><span class="line">    </span><br><span class="line">    model.<span class="built_in">compile</span>(optimizer=<span class="string">&quot;rmsprop&quot;</span>, loss=<span class="string">&quot;mse&quot;</span>, metrics=[<span class="string">&quot;mae&quot;</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> model</span><br></pre></td></tr></table></figure><p>ç½‘ç»œçš„æœ€åä¸€å±‚åªæœ‰ä¸€ä¸ªå•å…ƒï¼Œå¹¶ä¸”æ²¡æœ‰æ¿€æ´»å‡½æ•°ï¼ˆæ‰€ä»¥æ˜¯ä¸ªçº¿æ€§çš„å±‚ï¼‰ã€‚è¿™ç§å±‚æ˜¯æˆ‘ä»¬åšè¿ç»­å•å€¼å›å½’é—®é¢˜çš„æœ€åä¸€æ­¥çš„æ ‡é…ã€‚</p><p>å¦‚æœåŠ äº†æ¿€æ´»å‡½æ•°ï¼Œè¾“å‡ºçš„å€¼å°±ä¼šæœ‰èŒƒå›´é™åˆ¶ï¼Œæ¯”å¦‚ sigmoid ä¼šæŠŠå€¼é™åˆ¶åˆ° <code>[0, 1]</code>ã€‚æ²¡æœ‰æ¿€æ´»å‡½æ•°ï¼Œè¿™ä¸ªçº¿æ€§çš„å±‚è¾“å‡ºçš„å€¼å°±æ²¡æœ‰é™åˆ¶äº†ã€‚</p><p>æˆ‘ä»¬åœ¨ç¼–è¯‘æ¨¡å‹æ—¶ï¼Œä½¿ç”¨çš„æŸå¤±å‡½æ•°æ˜¯ <code>mse</code> ï¼ˆmean squared errorï¼Œå‡æ–¹è¯¯å·®ï¼‰ã€‚è¿™ä¸ªå‡½æ•°è¿”å›é¢„æµ‹å’ŒçœŸå®ç›®æ ‡å€¼çš„å·®çš„å¹³æ–¹ã€‚å›å½’é—®é¢˜å¤šç”¨è¿™ä¸ªæŸå¤±ã€‚</p><p>ç„¶åæˆ‘ä»¬è¿˜ç”¨äº†ä»¥å‰æ²¡ç”¨è¿‡çš„è®­ç»ƒæŒ‡æ ‡ â€”â€” <code>mae</code>ï¼ˆmean absolute errorï¼Œå¹³å‡ç»å¯¹è¯¯å·®ï¼‰ï¼Œè¿™ä¸ªä¸œè¥¿æ˜¯é¢„æµ‹å’ŒçœŸå®ç›®æ ‡çš„å·®çš„ç»å¯¹å€¼ã€‚</p><h3 id="æ‹ŸåˆéªŒè¯-â€”â€”-K-fold-éªŒè¯"><a href="#æ‹ŸåˆéªŒè¯-â€”â€”-K-fold-éªŒè¯" class="headerlink" title="æ‹ŸåˆéªŒè¯ â€”â€” K-fold éªŒè¯"></a>æ‹ŸåˆéªŒè¯ â€”â€” K-fold éªŒè¯</h3><p>æˆ‘ä»¬ä¹‹å‰ä¸€ç›´åœ¨åš â€”â€” ä¸ºäº†å¯¹ç½‘ç»œè¿›è¡Œè¯„ä¼°ï¼Œæ¥è°ƒèŠ‚ç½‘ç»œå‚æ•°(æ¯”å¦‚è®­ç»ƒçš„è½®æ•°)ï¼Œæˆ‘ä»¬å°†æ•°æ®åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’ŒéªŒè¯é›†ã€‚è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦è¿™ä¹ˆåšã€‚<br>ä½†æœ‰ä¸€ç‚¹éº»çƒ¦æ˜¯ï¼Œæˆ‘ä»¬è¿™æ¬¡çš„æ•°æ®å¤ªå°‘äº†ï¼Œæ‰€ä»¥åˆ†å‡ºæ¥çš„éªŒè¯é›†å°±å¾ˆå°ï¼ˆå¯èƒ½æ‰æœ‰100æ¡æ•°æ®ï¼‰ã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒéªŒè¯é›†é€‰æ‹©çš„æ•°æ®ä¸åŒï¼Œå¯èƒ½å¯¹éªŒè¯çš„ç»“æœæœ‰å¾ˆå¤§å½±å“ï¼ˆå³éªŒè¯é›†çš„åˆ’åˆ†æ–¹å¼ä¸åŒå¯èƒ½é€ æˆéªŒè¯ç»“æœçš„æ–¹å·®å¾ˆå¤§ï¼‰ï¼Œè¿™ç§æƒ…å†µä¼šå½±å“æˆ‘ä»¬å¯¹æ¨¡å‹çš„éªŒè¯ã€‚</p><p>åœ¨è¿™ç§å°´å°¬çš„å¢ƒåœ°ï¼Œæœ€ä½³å®è·µæ˜¯ä½¿ç”¨ <em>K-fold</em> äº¤å‰éªŒè¯ï¼ˆKæŠ˜äº¤å‰éªŒè¯ï¼‰ã€‚</p><p>ç”¨ K-fold éªŒè¯ï¼Œæˆ‘ä»¬æŠŠæ•°æ®åˆ†æˆ K ä¸ªéƒ¨åˆ†ï¼ˆä¸€èˆ¬ k = 4 or 5ï¼‰ï¼Œç„¶åå®ä¾‹åŒ– K ä¸ªç‹¬ç«‹çš„æ¨¡å‹ï¼Œæ¯ä¸ªç”¨ K-1 ä»½æ•°æ®å»è®­ç»ƒï¼Œç„¶åç”¨å‰©ä½™çš„ä¸€ä»½å»éªŒè¯ï¼Œæœ€ç»ˆæ¨¡å‹çš„éªŒè¯åˆ†æ•°ä½¿ç”¨ K ä¸ªéƒ¨åˆ†çš„å¹³å‡å€¼ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gert24t4p8j317u0mstci.jpg" alt="K-fold éªŒè¯ç¤ºæ„å›¾"></p><p>K-fold éªŒè¯çš„ä»£ç å®ç°ï¼š</p><p>ç¨å¾®æ”¹ä¸€ä¸‹ä¹¦ä¸Šçš„ä¾‹å­ï¼Œæˆ‘ä»¬åŠ ä¸€ç‚¹ç”¨ TensorBoard æ¥å¯è§†åŒ–è®­ç»ƒè¿‡ç¨‹çš„ä»£ç ã€‚é¦–å…ˆåœ¨ Jupyter Lab ç¬”è®°æœ¬é‡ŒåŠ è½½ tensorboardï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Load the TensorBoard notebook extension</span></span><br><span class="line"><span class="comment"># TensorBoard å¯ä»¥å¯è§†åŒ–è®­ç»ƒè¿‡ç¨‹</span></span><br><span class="line">%load_ext tensorboard</span><br><span class="line"><span class="comment"># Clear any logs from previous runs</span></span><br><span class="line">!rm -rf ./logs/ </span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>The tensorboard extension is already loaded. To reload it, use:  %reload_ext tensorboard</code></pre><p>ç„¶åå¼€å§‹å†™ä¸»è¦çš„ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">k = <span class="number">4</span></span><br><span class="line">num_val_samples = <span class="built_in">len</span>(train_data) // k</span><br><span class="line">num_epochs = <span class="number">100</span></span><br><span class="line">all_scores = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡†å¤‡ TensorBoard</span></span><br><span class="line">log_dir = <span class="string">&quot;logs/fit/&quot;</span> + datetime.datetime.now().strftime(<span class="string">&quot;%Y%m%d-%H%M%S&quot;</span>)</span><br><span class="line">tensorboard_callback = tf.keras.callbacks.TensorBoard(log_dir=log_dir, histogram_freq=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">    print(<span class="string">f&#x27;processing fold #<span class="subst">&#123;i&#125;</span> (<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>/<span class="subst">&#123;k&#125;</span>)&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å‡†å¤‡éªŒè¯æ•°æ®</span></span><br><span class="line">    val_data = train_data[i * num_val_samples: (i + <span class="number">1</span>) * num_val_samples]</span><br><span class="line">    val_targets = train_targets[i * num_val_samples: (i + <span class="number">1</span>) * num_val_samples]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å‡†å¤‡è®­ç»ƒæ•°æ®</span></span><br><span class="line">    partial_train_data = np.concatenate(</span><br><span class="line">        [train_data[: i * num_val_samples],</span><br><span class="line">         train_data[(i+<span class="number">1</span>) * num_val_samples :]],</span><br><span class="line">        axis=<span class="number">0</span>)</span><br><span class="line">    partial_train_targets = np.concatenate(</span><br><span class="line">        [train_targets[: i * num_val_samples], </span><br><span class="line">         train_targets[(i+<span class="number">1</span>) *  num_val_samples :]], </span><br><span class="line">        axis=<span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#æ„å»ºã€è®­ç»ƒæ¨¡å‹</span></span><br><span class="line">    model = build_model()</span><br><span class="line">    model.fit(partial_train_data, partial_train_targets, </span><br><span class="line">              epochs=num_epochs, batch_size=<span class="number">1</span>, verbose=<span class="number">0</span>,</span><br><span class="line">              callbacks=[tensorboard_callback])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æœ‰éªŒè¯é›†è¯„ä¼°æ¨¡å‹</span></span><br><span class="line">    val_mse, val_mae = model.evaluate(val_data, val_targets, verbose=<span class="number">0</span>)</span><br><span class="line">    all_scores.append(val_mae)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">np.mean(all_scores)</span><br></pre></td></tr></table></figure><pre><code>processing fold #0 (1/4)processing fold #1 (2/4)processing fold #2 (3/4)processing fold #3 (4/4)2.4046657</code></pre><p>ç”¨ä¸‹é¢è¿™ä¸ªå‘½ä»¤å¯ä»¥åœ¨ Jupyter Lab ç¬”è®°æœ¬é‡Œæ˜¾ç¤º tensorboardï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%tensorboard --logdir logs/fit</span><br></pre></td></tr></table></figure><p>å®ƒå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggje37vwedj31fw0u0dmn.jpg" alt="tensorboardçš„æˆªå›¾"></p><p>è¿™ä¸ªä¸œè¥¿ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ä½ çš„æµè§ˆå™¨é‡Œç›´æ¥æ‰“å¼€ <code>http://localhost:6006</code> å¾—åˆ°ã€‚</p><p>åˆšæ‰é‚£ä¸ªåªæ˜¯ç©ä¸€ä¸‹å“ˆï¼Œç°åœ¨æˆ‘ä»¬æ”¹ä¸€ä¸‹ï¼Œè¿­ä»£ 500 è½®ï¼ˆæ²¡ç‹¬æ˜¾çš„mbpè·‘è¿™ä¸ªå¥½æ…¢å•Šå•Šå•Šï¼‰ï¼ŒæŠŠè®­ç»ƒçš„ç»“æœè®°ä¸‹æ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">k = <span class="number">4</span></span><br><span class="line">num_val_samples = <span class="built_in">len</span>(train_data) // k</span><br><span class="line"></span><br><span class="line">num_epochs = <span class="number">500</span></span><br><span class="line">all_mae_histories = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">    print(<span class="string">f&#x27;processing fold #<span class="subst">&#123;i&#125;</span> (<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>/<span class="subst">&#123;k&#125;</span>)&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å‡†å¤‡éªŒè¯æ•°æ®</span></span><br><span class="line">    val_data = train_data[i * num_val_samples: (i + <span class="number">1</span>) * num_val_samples]</span><br><span class="line">    val_targets = train_targets[i * num_val_samples: (i + <span class="number">1</span>) * num_val_samples]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å‡†å¤‡è®­ç»ƒæ•°æ®</span></span><br><span class="line">    partial_train_data = np.concatenate(</span><br><span class="line">        [train_data[: i * num_val_samples],</span><br><span class="line">         train_data[(i+<span class="number">1</span>) * num_val_samples :]],</span><br><span class="line">        axis=<span class="number">0</span>)</span><br><span class="line">    partial_train_targets = np.concatenate(</span><br><span class="line">        [train_targets[: i * num_val_samples], </span><br><span class="line">         train_targets[(i+<span class="number">1</span>) *  num_val_samples :]], </span><br><span class="line">        axis=<span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#æ„å»ºã€è®­ç»ƒæ¨¡å‹</span></span><br><span class="line">    model = build_model()</span><br><span class="line">    history = model.fit(partial_train_data, partial_train_targets,</span><br><span class="line">                        validation_data=(val_data, val_targets),</span><br><span class="line">                        epochs=num_epochs, batch_size=<span class="number">1</span>, verbose=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    mae_history = history.history[<span class="string">&#x27;val_mae&#x27;</span>]</span><br><span class="line">    all_mae_histories.append(mae_history)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;Done.&quot;</span>)</span><br></pre></td></tr></table></figure><pre><code>processing fold #0 (1/4)processing fold #1 (2/4)processing fold #2 (3/4)processing fold #3 (4/4)Done.</code></pre><p>ç”»å›¾ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">average_mae_history = [</span><br><span class="line">    np.mean([x[i] <span class="keyword">for</span> x <span class="keyword">in</span> all_mae_histories]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs)]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">plt.plot(<span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(average_mae_history) + <span class="number">1</span>), average_mae_history)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;Epochs&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;Validation MAE&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggje0zqitmj30b007eq35.jpg" alt="png"></p><p>è¿™ä¸ªå›¾å¤ªå¯†äº†ï¼Œçœ‹ä¸æ¸…ï¼Œæ‰€ä»¥è¦å¤„ç†ä¸€ä¸‹ï¼š</p><ul><li>å»æ‰å‰åç»„æ•°æ®ï¼Œè¿™ç«¯æ˜æ˜¾å’Œå…¶ä»–çš„æ•°é‡å·®è·æ¯”è¾ƒå¤§ï¼›</li><li>æŠŠæ¯ä¸ªç‚¹éƒ½æ¢æˆå‰é¢æ•°æ®ç‚¹çš„æŒ‡æ•°ç§»åŠ¨å¹³å‡å€¼ï¼ˆan exponential moving average of the previous pointsï¼‰ï¼ŒæŠŠæ›²çº¿å˜å¹³æ»‘ï¼›</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">smooth_curve</span>(<span class="params">points, factor=<span class="number">0.9</span></span>):</span></span><br><span class="line">  smoothed_points = []</span><br><span class="line">  <span class="keyword">for</span> point <span class="keyword">in</span> points:</span><br><span class="line">    <span class="keyword">if</span> smoothed_points:</span><br><span class="line">      previous = smoothed_points[-<span class="number">1</span>]</span><br><span class="line">      smoothed_points.append(previous * factor + point * (<span class="number">1</span> - factor))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      smoothed_points.append(point)</span><br><span class="line">  <span class="keyword">return</span> smoothed_points</span><br><span class="line"></span><br><span class="line">smooth_mae_history = smooth_curve(average_mae_history[<span class="number">10</span>:])</span><br><span class="line"></span><br><span class="line">plt.plot(<span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(smooth_mae_history) + <span class="number">1</span>), smooth_mae_history)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;Epochs&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;Validation MAE&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggje11t08ij30b007egls.jpg" alt="png"></p><p>ä»è¿™ä¸ªå›¾çœ‹ï¼Œå·®ä¸å¤šè¿‡äº† 80 ä¸ª epochs åå°±è¿‡æ‹Ÿåˆäº†ã€‚</p><p>åœ¨å°è¯•äº†è¿™äº›ä¹‹åï¼Œæˆ‘ä»¬æ‰¾å‡ºæœ€ä½³çš„å‚æ•°ï¼ˆè½®æ•°å•¦ï¼Œç½‘ç»œçš„å±‚æ•°å•¦ï¼Œè¿™äº›éƒ½å¯ä»¥è¯•è¯•ï¼‰ï¼Œç„¶åç”¨æœ€ä½³çš„å‚æ•°åœ¨æ‰€æœ‰æ•°æ®ä¸Šè®­ç»ƒï¼Œæ¥å¾—å‡ºæœ€ç»ˆçš„ç”Ÿäº§æ¨¡å‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®­ç»ƒæœ€ç»ˆæ¨¡å‹</span></span><br><span class="line"></span><br><span class="line">model = build_model()</span><br><span class="line">model.fit(train_data, train_targets, </span><br><span class="line">          epochs=<span class="number">80</span>, batch_size=<span class="number">16</span>, verbose=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€åè¯„ä¼°ä¸€ä¸‹</span></span><br><span class="line">test_mse_score, test_mae_score = model.evaluate(test_data, test_targets, verbose=<span class="number">0</span>)</span><br><span class="line">print(test_mse_score, test_mae_score)</span><br></pre></td></tr></table></figure><pre><code>17.43332971311083 2.6102107</code></pre><p>è¿™ä¸ª test_mae_score çš„å€¼è¯´æ˜ï¼Œæˆ‘ä»¬è®­ç»ƒå‡ºæ¥çš„æ¨¡å‹çš„é¢„æµ‹å’Œå®é™…å¤§æ¦‚å·®äº† 2k+ ç¾å…ƒã€‚ã€‚ã€‚ğŸ˜­</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> Deep Learning with Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
            <tag> Deep Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SwiftUIåŸºç¡€â€”â€”æ„å»ºåˆ—è¡¨å’Œå¯¼èˆª</title>
      <link href="/2020/06/24/SwiftUI/SwiftUI_Essentials_2_Building_List_and_navigation/"/>
      <url>/2020/06/24/SwiftUI/SwiftUI_Essentials_2_Building_List_and_navigation/</url>
      
        <content type="html"><![CDATA[<h1 id="Swift-UI-åŸºç¡€"><a href="#Swift-UI-åŸºç¡€" class="headerlink" title="Swift UI åŸºç¡€"></a>Swift UI åŸºç¡€</h1><p>ä»Šå¤©æ˜¯ WWDC20 çš„ç¬¬äºŒå¤©äº†ï¼Œæ‰€ä»¥ç»§ç»­æ¥å­¦ä¹  Apple çš„ app å¼€å‘ã€‚ğŸ˜œ</p><blockquote><p>ç¿»è¯‘è‡ª SwiftUI çš„å®˜æ–¹æ•™ç¨‹ï¼š<a href="https://developer.apple.com/tutorials/swiftui/tutorials">Learn to Make Apps with SwiftUI</a></p><p>è¿™ç¯‡æ–‡ç« æ˜¯ Apple ç»™çš„ SwiftUI å®˜æ–¹æ•™ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘è‡ªå·±é˜…è¯»å­¦ä¹ çš„æ—¶å€™é¡ºä¾¿ç¿»è¯‘çš„ã€‚</p></blockquote><h2 id="æ„å»ºåˆ—è¡¨å’Œå¯¼èˆª"><a href="#æ„å»ºåˆ—è¡¨å’Œå¯¼èˆª" class="headerlink" title="æ„å»ºåˆ—è¡¨å’Œå¯¼èˆª"></a>æ„å»ºåˆ—è¡¨å’Œå¯¼èˆª</h2><blockquote><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://developer.apple.com/tutorials/swiftui/building-lists-and-navigation">https://developer.apple.com/tutorials/swiftui/building-lists-and-navigation</a></p></blockquote><p>åœ¨æˆ‘ä»¬å·²ç»å®Œæˆäº†åŸºæœ¬çš„åœ°æ ‡ç»†èŠ‚è§†å›¾åï¼Œç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦æä¾›ç»™ç”¨æˆ·ä¸€ç§æ–¹å¼ï¼Œæ¥æŸ¥çœ‹å®Œæ•´çš„åœ°æ ‡åˆ—è¡¨ï¼Œå¹¶å¯ä»¥æŸ¥çœ‹æ¯ä¸€ä¸ªåœ°æ ‡çš„ç»†èŠ‚ã€‚</p><p>æˆ‘ä»¬å°†æ„å»ºå¯ä»¥å±•ç¤ºä»»æ„åœ°æ ‡ä¿¡æ¯çš„è§†å›¾ï¼Œè¿˜æœ‰åŠ¨æ€ç”Ÿæˆä¸€ä¸ªæ»šåŠ¨åˆ—è¡¨ï¼Œç”¨æˆ·å¯ä»¥ç‚¹å‡»åˆ—è¡¨é‡Œçš„é¡¹ç›®æ¥æŸ¥çœ‹å¯¹åº”åœ°æ ‡çš„ç»†èŠ‚ä¿¡æ¯ã€‚ä¸ºäº†å¾®è°ƒç”¨æˆ·ç•Œé¢ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Xcode çš„ç”»å¸ƒåœ¨ä¸åŒçš„è®¾å¤‡å°ºå¯¸ä¸‹æ¸²æŸ“å¤šä¸ªé¢„è§ˆã€‚</p><p>è½½é¡¹ç›®æ–‡ä»¶ï¼Œè·Ÿç€ä¸‹é¢çš„æ­¥éª¤å¼€å§‹æ„å»ºå·¥ç¨‹å§ï¼š</p><blockquote><p>é¢„è®¡æ—¶é—´ï¼š35åˆ†é’Ÿ</p><p>é¡¹ç›®æ–‡ä»¶ï¼š<a href="https://docs-assets.developer.apple.com/published/f021500afcdf6c3930549f1ffeb65e7e/110/BuildingListsAndNavigation.zip">https://docs-assets.developer.apple.com/published/f021500afcdf6c3930549f1ffeb65e7e/110/BuildingListsAndNavigation.zip</a> </p></blockquote><h3 id="Â§-1-è®¤è¯†æ ·æœ¬æ•°æ®-Sample-Data"><a href="#Â§-1-è®¤è¯†æ ·æœ¬æ•°æ®-Sample-Data" class="headerlink" title="Â§ 1 è®¤è¯†æ ·æœ¬æ•°æ®(Sample Data)"></a>Â§ 1 è®¤è¯†æ ·æœ¬æ•°æ®(Sample Data)</h3><blockquote><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://developer.apple.com/tutorials/swiftui/building-lists-and-navigation#Get-to-Know-the-Sample-Data">https://developer.apple.com/tutorials/swiftui/building-lists-and-navigation#Get-to-Know-the-Sample-Data</a></p></blockquote><p>åœ¨ä¹‹å‰çš„æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬æŠŠä¿¡æ¯ç”¨ç¡¬ç¼–ç (hard-coded)å†™æ­»åˆ°äº†æˆ‘ä»¬çš„è‡ªå®šä¹‰è§†å›¾ä¸­ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¦å­¦ä¹ å¦‚ä½•è®©è§†å›¾æ˜¾ç¤ºæˆ‘ä»¬ä¼ è¿›å»çš„æŒ‡å®šä¿¡æ¯ã€‚</p><p>é¦–å…ˆï¼Œä¸‹è½½æ‰“å¼€èµ·æ­¥é¡¹ç›®æ–‡ä»¶ï¼Œç„¶åè‡ªå·±ç†Ÿæ‚‰ä¸€ä¸‹æ ·æœ¬æ•°æ®å§ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg33qnycraj30pa0dkq3j.jpg" alt="ä¸€å¼ å›¾æ˜¾ç¤ºäº†å¦‚ä½•ä»JSONæ•°æ®ä¸­æå–å„ç§åœ°æ ‡çš„ç»†èŠ‚"></p><p><strong>Step 1.</strong> åœ¨é¡¹ç›®å¯¼èˆªï¼ˆProject navigatorï¼‰ä¸­é€‰æ‹© <strong>Models</strong> &gt; <code>Landmark.swift</code>ã€‚</p><p><code>Landmark.swift</code> declares a <code>Landmark</code>structure that stores all of the landmark information the app needs to display, and imports an array of landmark data from <code>landmarkData.json</code>.</p><p><code>Landmark.swift</code> å£°æ˜äº†ä¸€ä¸ª <code>Landmark</code> ç»“æ„ä½“ï¼Œç”¨æ¥å‚¨å­˜æˆ‘ä»¬çš„ app éœ€è¦æ˜¾ç¤ºçš„æ‰€æœ‰åœ°æ ‡ä¿¡æ¯ï¼ˆè¿™äº›ä¿¡æ¯æ˜¯ä» <code>landmarkData.json</code> è¯»å–å‡ºæ¥çš„ï¼‰ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Landmark.swift</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> CoreLocation</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Landmark</span>: <span class="title">Hashable</span>, <span class="title">Codable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> id: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">var</span> imageName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">var</span> coordinates: <span class="type">Coordinates</span></span><br><span class="line">    <span class="keyword">var</span> state: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> park: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> category: <span class="type">Category</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> locationCoordinate: <span class="type">CLLocationCoordinate2D</span> &#123;</span><br><span class="line">        <span class="type">CLLocationCoordinate2D</span>(</span><br><span class="line">            latitude: coordinates.latitude,</span><br><span class="line">            longitude: coordinates.longitude)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">Category</span>: <span class="title">String</span>, <span class="title">CaseIterable</span>, <span class="title">Codable</span>, <span class="title">Hashable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> featured <span class="operator">=</span> <span class="string">&quot;Featured&quot;</span></span><br><span class="line">        <span class="keyword">case</span> lakes <span class="operator">=</span> <span class="string">&quot;Lakes&quot;</span></span><br><span class="line">        <span class="keyword">case</span> rivers <span class="operator">=</span> <span class="string">&quot;Rivers&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Landmark</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> image: <span class="type">Image</span> &#123;</span><br><span class="line">        <span class="type">ImageStore</span>.shared.image(name: imageName)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Coordinates</span>: <span class="title">Hashable</span>, <span class="title">Codable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> latitude: <span class="type">Double</span></span><br><span class="line">    <span class="keyword">var</span> longitude: <span class="type">Double</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Step 2.</strong> åœ¨é¡¹ç›®å¯¼èˆªä¸­ï¼Œé€‰æ‹© <strong>Resources</strong> &gt; <code>landmarkData.json</code>ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Turtle Rock&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;category&quot;</span>: <span class="string">&quot;Featured&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;city&quot;</span>: <span class="string">&quot;Twentynine Palms&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;state&quot;</span>: <span class="string">&quot;California&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="number">1001</span>,</span><br><span class="line">        <span class="attr">&quot;park&quot;</span>: <span class="string">&quot;Joshua Tree National Park&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;coordinates&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;longitude&quot;</span>: <span class="number">-116.166868</span>,</span><br><span class="line">            <span class="attr">&quot;latitude&quot;</span>: <span class="number">34.011286</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;imageName&quot;</span>: <span class="string">&quot;turtlerock&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Silver Salmon Creek&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;category&quot;</span>: <span class="string">&quot;Lakes&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;city&quot;</span>: <span class="string">&quot;Port Alsworth&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;state&quot;</span>: <span class="string">&quot;Alaska&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="number">1002</span>,</span><br><span class="line">        <span class="attr">&quot;park&quot;</span>: <span class="string">&quot;Lake Clark National Park and Preserve&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;coordinates&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;longitude&quot;</span>: <span class="number">-152.665167</span>,</span><br><span class="line">            <span class="attr">&quot;latitude&quot;</span>: <span class="number">59.980167</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;imageName&quot;</span>: <span class="string">&quot;silversalmoncreek&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>åœ¨æ¥ä¸‹æ¥çš„æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬éƒ½å°†ä½¿ç”¨è¿™ä¸ªæ ·æœ¬æ•°æ®æ–‡ä»¶ã€‚</p><p><strong>Step 3.</strong> æ³¨æ„ï¼Œåœ¨ <a href="https://clownote.github.io/2020/06/23/SwiftUI/SwiftUI_Essentials_Creating_and_Combining_Views/">åˆ›å»ºå¹¶ç»„åˆè§†å›¾</a> é‡Œæˆ‘ä»¬å†™çš„ ContentView ç°åœ¨é‡å‘½åæˆäº† <code>LandmarkDetail</code>ã€‚</p><p>åœ¨æ¥ä¸‹æ¥çš„æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¿˜æœ‰æ„å»ºæ›´å¤šçš„å…¶ä»–è§†å›¾ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LandmarkDetail.swift</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LandmarkDetail</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>()</span><br><span class="line">                .edgesIgnoringSafeArea(.top)</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>()</span><br><span class="line">                .offset(y: <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line">                .padding(.bottom, <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                    .font(.title)</span><br><span class="line"></span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line"></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LandmarkDetail_Previews</span>: <span class="title">PreviewProvider</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkDetail</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¢„è§ˆæ•ˆæœæ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg35gcegikj30vj0u013u.jpg" alt="Xcodeé¢„è§ˆçš„æˆªå›¾ï¼Œåœ°å›¾è§†å›¾å¯¹å‡†äº†æ˜¾ç¤ºå™¨çš„é¡¶éƒ¨"></p><h3 id="Â§-2-åˆ›å»ºè¡Œè§†å›¾-Row-View"><a href="#Â§-2-åˆ›å»ºè¡Œè§†å›¾-Row-View" class="headerlink" title="Â§ 2 åˆ›å»ºè¡Œè§†å›¾(Row View)"></a>Â§ 2 åˆ›å»ºè¡Œè§†å›¾(Row View)</h3><p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºçš„ç¬¬ä¸€ä¸ªè§†å›¾æ˜¯ä¸€ä¸ªç”¨äºæ˜¾ç¤ºæ¯ä¸ªåœ°æ ‡è¯¦ç»†ä¿¡æ¯çš„è¡Œã€‚è¿™ä¸ªè¡Œè§†å›¾å°†å®ƒæ‰€æ˜¾ç¤ºçš„åœ°æ ‡çš„ä¿¡æ¯å­˜å‚¨åœ¨ä¸€ä¸ªå±æ€§ä¸­ï¼Œå› æ­¤ä¸€ä¸ªè¿™ç§è§†å›¾æ˜¯å¯ä»¥æ˜¾ç¤ºä»»ä½•åœ°æ ‡çš„ã€‚ä¹‹åï¼Œæˆ‘ä»¬å°†æŠŠå¤šä¸ªè¿™ç§è¡Œç»„åˆæˆä¸€ä¸ªåœ°æ ‡åˆ—è¡¨ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg360dch7nj30md0bo74z.jpg" alt="ä¸€å¼ å›¾æè¿°äº†ä½ å°†ä¸ºæœ¬æ•™ç¨‹æ„å»ºçš„è¡Œæ˜¯å¦‚ä½•æ„å»ºçš„ã€‚è¯¥è¡Œç”±å·¦è¾¹çš„å›¾åƒã€ä»JSONæ–‡ä»¶ä¸­æå–æ•°æ®ä»¥äº†è§£åœ°æ ‡ç»†èŠ‚çš„æ–‡æœ¬è§†å›¾å’Œå³è¾¹çš„é—´éš”ç¬¦ç»„æˆã€‚"></p><p><strong>Step 1.</strong> åˆ›å»ºä¸€ä¸ªæ–°çš„ SwiftUI Viewï¼Œæ–‡ä»¶å‘½åä¸º <code>LandmarkRow.swift</code>ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg361wqte4j30tg0xcwld.jpg" alt="Xcodeçš„æˆªå›¾ï¼Œæ˜¾ç¤ºæ–‡ä»¶åˆ›å»ºå¯¹è¯æ¡†ã€‚"></p><p><strong>Step 2.</strong> å¦‚æœé¢„è§ˆæ²¡æœ‰æ˜¾ç¤ºï¼Œåˆ™é€šè¿‡  <strong>Editor &gt; Canvas</strong> æ‰“å¼€ç”»å¸ƒï¼Œç„¶åç‚¹ <strong>Resume</strong>ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg37cr5otnj30tg0xcmxq.jpg" alt="ä¸€å¼ å›¾ç‰‡æ˜¾ç¤ºäº†Xcodeä¸­æ¬¢è¿æ¥åˆ°SwiftUIå±å¹•"></p><p><strong>Step 3.</strong> ç»™ <code>LandmarkRow</code> æ·»åŠ ä¸€ä¸ª landmark å‚¨å­˜å±æ€§ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LandmarkRow.swift</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LandmarkRow</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LandmarkRow_Previews</span>: <span class="title">PreviewProvider</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkRow</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ä½ æ·»åŠ  landmark å±æ€§æ—¶ï¼Œé¢„è§ˆä¼šåœæ­¢å·¥ä½œï¼Œå› ä¸ºLandmarkRowç±»å‹åœ¨åˆå§‹åŒ–æ—¶éœ€è¦ä¸€ä¸ª Landmark å®ä¾‹ã€‚</p><p>ä¸ºäº†ä¿®å¤é¢„è§ˆï¼Œæˆ‘ä»¬è¦ä¿®æ”¹ä¸€ä¸‹é¢„è§ˆæä¾›å™¨ï¼ˆPreviewProviderï¼‰ã€‚</p><p><strong>Step 4.</strong> åœ¨ LandmarkRow_Previews çš„ previews é™æ€å±æ€§ä¸­ï¼Œç»™ LandmarkRow çš„åˆå§‹åŒ–å™¨ä¸­æ·»åŠ  landmark å‚æ•°ï¼ŒæŒ‡å®š landmarkData æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚</p><p>ç°åœ¨ï¼Œé¢„è§ˆå°±å¯ä»¥å·¥ä½œäº†ï¼Œæ˜¾ç¤ºå‡ºäº†æ–‡æœ¬ â€œHello Worldâ€ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg37q6jzywj31940n6whf.jpg" alt="ä»£ç å’Œé¢„è§ˆæˆªå›¾ï¼Œé¢„è§ˆæ˜¾ç¤ºå‡ºäº†Hello World"></p><p>ä¿®å¤äº†è¿™ä¸ªé—®é¢˜ä¹‹åï¼Œå°±å¯ä»¥å¼€å§‹æ„å»ºè¡Œçš„è§†å›¾äº†ã€‚</p><p><strong>Step 5.</strong> æŠŠç°æœ‰çš„æ–‡æœ¬è§†å›¾åµŒå…¥åˆ°ä¸€ä¸ª HStack é‡Œã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg37sj9i5aj318m0podiy.jpg" alt="ä»£ç å’Œé¢„è§ˆæˆªå›¾ï¼Œä»£ç æŠŠç°æœ‰çš„æ–‡æœ¬è§†å›¾åµŒå…¥åˆ°ä¸€ä¸ª HStack é‡Œï¼Œé¢„è§ˆä¸å˜"></p><p><strong>Step 6.</strong> æŠŠæ–‡æœ¬è§†å›¾çš„å†…å®¹æ”¹æˆ <code>landmark</code> å±æ€§çš„ <code>name</code>ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg37zyjvbzj31920oy0vt.jpg" alt="ä»£ç å’Œé¢„è§ˆæˆªå›¾ï¼Œæ–‡æœ¬è§†å›¾çš„å†…å®¹æ”¹æˆäº†landmarkå±æ€§çš„nameï¼Œé¢„è§ˆæ˜¾ç¤ºæ–‡æœ¬Turtle Rock"></p><p><strong>Step 7.</strong> é€šè¿‡åœ¨æ–‡æœ¬è§†å›¾å‰æ·»åŠ å›¾åƒï¼Œåœ¨æ–‡æœ¬è§†å›¾åæ·»åŠ é—´éš”ç¬¦æ¥å®Œæˆè¡Œã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg38568glgj319g0tstd3.jpg" alt="ä»£ç å’Œé¢„è§ˆæˆªå›¾ï¼Œåœ¨æ–‡æœ¬è§†å›¾å‰æ·»åŠ å›¾åƒï¼Œåœ¨æ–‡æœ¬è§†å›¾åæ·»åŠ é—´éš”"></p><hr><p>è¿™ä¸€èŠ‚é‡Œæˆ‘ä»¬å®Œæˆçš„ä¸»è¦ä»£ç æ˜¯<code>LandmarkRow.swift</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LandmarkRow</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> landmark: <span class="type">Landmark</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            landmark.image</span><br><span class="line">                .resizable()</span><br><span class="line">                .frame(width: <span class="number">50</span>, height: <span class="number">50</span>)</span><br><span class="line">            <span class="type">Text</span>(landmark.name)</span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LandmarkRow_Previews</span>: <span class="title">PreviewProvider</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LandmarkRow</span>(landmark: landmarkData[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥åœ¨ Playground é‡Œå®Œæˆè¿™ä¸ªï¼Œä½†ç¨å¾®æœ‰ç‚¹éº»çƒ¦ã€‚</p><p>æ–°å»ºä¸€ä¸ª Playgroundï¼Œæ‰“å¼€å·¦ä¾§çš„ Navigaterï¼Œå±•å¼€å¯ä»¥çœ‹åˆ° Resources æ–‡ä»¶å¤¹ï¼ŒæŠŠ Apple ç»™çš„é‚£ä¸ªé¡¹ç›®æ–‡ä»¶ä¸­çš„ Resources é‡Œé¢çš„ä¸œè¥¿ï¼ˆä¸€ä¸ª jsonæ–‡ä»¶ï¼Œè¿˜æœ‰ä¸€å †å›¾ç‰‡æ–‡ä»¶ï¼‰</p><h3 id="Â§-3-è‡ªå®šä¹‰è¡Œé¢„è§ˆ"><a href="#Â§-3-è‡ªå®šä¹‰è¡Œé¢„è§ˆ" class="headerlink" title="Â§ 3 è‡ªå®šä¹‰è¡Œé¢„è§ˆ"></a>Â§ 3 è‡ªå®šä¹‰è¡Œé¢„è§ˆ</h3><p>Xcode çš„ç”»å¸ƒå¯ä»¥è‡ªåŠ¨è¯†åˆ«å¹¶æ˜¾ç¤ºå½“å‰ç¼–è¾‘å™¨ä¸­å®ç°äº† PreviewProvider åè®®çš„ä»»ä½•ç±»å‹ã€‚é¢„è§ˆæä¾›å™¨ï¼ˆpreview providerï¼‰ä¼šè¿”å›ä¸€ä¸ªæˆ–å¤šä¸ªè§†å›¾ï¼Œå¹¶å¸¦æœ‰é…ç½®å¤§å°å’Œè®¾å¤‡çš„é€‰é¡¹ã€‚</p><p>ä½ å¯ä»¥è‡ªå®šä¹‰ä»é¢„è§ˆæä¾›å™¨è¿”å›çš„å†…å®¹ï¼Œä»¥å‡†ç¡®åœ°å‘ˆç°å¯¹å·¥ä½œæœ€æœ‰å¸®åŠ©çš„é¢„è§ˆã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg3h6nrl7oj30nt0kgmyz.jpg" alt="ä¸¤å°iPhoneè®¾å¤‡å¹¶æ’çš„å›¾ç‰‡ã€‚å·¦è¾¹çš„iPhoneåœ¨é è¿‘æ˜¾ç¤ºå±ä¸­é—´çš„å››è¡Œå‘¨å›´æœ‰ä¸€ä¸ªé«˜äº®ã€‚å·¦è¾¹çš„å››è¡Œé«˜äº®å¤„æœ‰ä¸€ä¸ªç®­å¤´ï¼Œè¿™äº›ç®­å¤´åœ¨å³è¾¹iPhoneçš„åˆ—è¡¨è§†å›¾ä¸­å¾—åˆ°äº†å¤åˆ¶ã€‚"></p><p><strong>Step 1.</strong> åœ¨LandmarkRow_Previewsä¸­ï¼ŒæŠŠ landmark å‚æ•°æ”¹ä¸º landmarkData æ•°ç»„ä¸­çš„ç¬¬äºŒä¸ªå…ƒç´ ã€‚</p><p>ä¿®æ”¹å®Œä»£ç ï¼Œé¢„è§ˆä¼šç«‹å³æ”¹å˜ï¼Œæ˜¾ç¤ºç¬¬äºŒä¸ªæ ·æœ¬åœ°æ ‡ï¼Œè€Œä¸å†æ˜¯ç¬¬ä¸€ä¸ªã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg3hqssaaaj317f0u0gpw.jpg" alt="ä»£ç å’Œé¢„è§ˆçš„æˆªå›¾"></p><p><strong>Step 2.</strong> ä½¿ç”¨ <code>previewLayout(_:)</code> ä¿®é¥°å™¨æ¥æŠŠé¢„è§ˆè®¾ç½®æˆè¿‘ä¼¼ä¸€ä¸ªè¡Œçš„å°ºå¯¸å¤§å°ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg3idkm3npj318o0u0q7l.jpg" alt="ä»£ç å’Œé¢„è§ˆçš„æˆªå›¾"></p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ª Group æ¥ä»ä¸€ä¸ª preview provider è¿”å›å¤šä¸ªé¢„è§ˆã€‚</p><p><strong>Step 3.</strong> å°†ç°åœ¨ previews è¿”å›çš„ LandmarkRow åŒ…è£¹åœ¨ä¸€ä¸ª Group ä¸­ï¼Œå¹¶å°†ç¬¬ä¸€è¡Œå†æ¬¡æ·»åŠ å›æ¥ã€‚</p><p>Group æ˜¯å¯¹è§†å›¾å†…å®¹è¿›è¡Œåˆ†ç»„çš„å®¹å™¨ã€‚Xcode åœ¨ç”»å¸ƒä¸­ä»¥å•ç‹¬çš„é¢„è§ˆæ¥å‘ˆç° Group çš„å­è§†å›¾ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg3nomqyhzj313a0u00z2.jpg" alt="ä»£ç å’Œé¢„è§ˆçš„æˆªå›¾"></p><p><strong>Step 4.</strong> ä¸ºäº†ç®€åŒ–ä»£ç ï¼Œå°† <code> previewLayout(_:)</code> çš„è°ƒç”¨ç§»åˆ°ç»„çš„å­å£°æ˜çš„å¤–é¢ã€‚</p><p>è§†å›¾çš„å­©å­ (Children) ä¼šç»§æ‰¿è§†å›¾çš„ä¸Šä¸‹æ–‡è®¾ç½®ï¼Œä¾‹å¦‚é¢„è§ˆé…ç½®ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg3o6fyo1vj313m0u0ag3.jpg" alt="ä»£ç å’Œé¢„è§ˆçš„æˆªå›¾"></p><p>æˆ‘ä»¬åœ¨é¢„è§ˆæä¾›å™¨(PreviewProvider)ä¸­å†™çš„ä»£ç åªä¼šæ”¹å˜ç”»å¸ƒ(canvas)ä¸­æ˜¾ç¤ºçš„é¢„è§ˆå†…å®¹ï¼Œä¸ä¼šå½±å“è§†å›¾æœ¬èº«ã€‚</p><h3 id="Â§-4-åˆ›å»ºåœ°æ ‡åˆ—è¡¨ï¼ˆthe-List-of-Landmarksï¼‰"><a href="#Â§-4-åˆ›å»ºåœ°æ ‡åˆ—è¡¨ï¼ˆthe-List-of-Landmarksï¼‰" class="headerlink" title="Â§ 4 åˆ›å»ºåœ°æ ‡åˆ—è¡¨ï¼ˆthe List of Landmarksï¼‰"></a>Â§ 4 åˆ›å»ºåœ°æ ‡åˆ—è¡¨ï¼ˆthe List of Landmarksï¼‰</h3><p>ä½¿ç”¨ SwiftUI çš„ <code>List</code> ç±»å‹ï¼Œå¯ä»¥æ˜¾ç¤ºä¸€ä¸ªå¹³å°ç‰¹å®š(platform-specific)çš„è§†å›¾åˆ—è¡¨ã€‚åˆ—è¡¨ä¸­çš„å…ƒç´ å¯ä»¥æ˜¯é™æ€çš„ï¼Œæ¯”å¦‚åˆ°ç›®å‰ä¸ºæ­¢ä½ åˆ›å»ºçš„é‚£ç§ stack çš„å­è§†å›¾ï¼Œä¹Ÿå¯ä»¥æ˜¯åŠ¨æ€ç”Ÿæˆçš„ã€‚æˆ‘ä»¬ç”šè‡³å¯ä»¥åœ¨ List é‡Œæ··åˆé™æ€å’ŒåŠ¨æ€ç”Ÿæˆçš„è§†å›¾ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg3ogifginj30m905kdgp.jpg" alt="ä¸¤è¡Œåœ°æ ‡çš„æˆªå›¾ï¼Œå·¦è¾¹æœ‰å›¾ç‰‡ï¼Œåœ°æ ‡åç§°ï¼Œæ¯æ’å³ä¾§è¾¹ç¼˜æœ‰å¯¼èˆªç®­å¤´ã€‚"></p><p><strong>Step 1.</strong> åˆ›å»ºä¸€ä¸ªæ–°çš„ SwiftUI Viewï¼Œå‘½åä¸º <code>LandmarkList.swift</code>ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg3oovkeetj30tg0xcdmp.jpg" alt="Xcodeçš„æˆªå›¾ï¼Œæ˜¾ç¤ºæ–°SwiftUIè§†å›¾æ­£è¢«æ·»åŠ åˆ°é¡¹ç›®ä¸­ã€‚"></p><p><strong>Step 2.</strong> ç”¨ä¸€ä¸ª List æ›¿æ¢é»˜è®¤çš„ Text è§†å›¾ï¼Œå¹¶æä¾› LandmarkRow å®ä¾‹ï¼Œå°†å‰ä¸¤ä¸ªåœ°æ ‡ä½œä¸ºåˆ—è¡¨çš„å­èŠ‚ç‚¹ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg3or740ejj318w0nkgpr.jpg" alt="ä»£ç å’Œé¢„è§ˆçš„æˆªå›¾"></p><p>é¢„è§ˆæ˜¾ç¤ºä¸¤ä¸ª LandmarkRow ä»¥é€‚åˆ iOS çš„åˆ—è¡¨æ ·å¼å‘ˆç°å‡ºæ¥äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Learn to Make Apps with SwiftUI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SwiftUI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SwiftUIåŸºç¡€â€”â€”åˆ›å»ºå¹¶ç»„åˆè§†å›¾</title>
      <link href="/2020/06/23/SwiftUI/SwiftUI_Essentials_1_Creating_and_Combining_Views/"/>
      <url>/2020/06/23/SwiftUI/SwiftUI_Essentials_1_Creating_and_Combining_Views/</url>
      
        <content type="html"><![CDATA[<h1 id="Swift-UI-åŸºç¡€"><a href="#Swift-UI-åŸºç¡€" class="headerlink" title="Swift UI åŸºç¡€"></a>Swift UI åŸºç¡€</h1><p>ä»Šå¤©å¼€ 2020 å¹´çš„ WWDC äº†ï¼Œæ‰€ä»¥æ¥å­¦ä¹ ä¸€ä¸‹ Apple çš„ app å¼€å‘å§ã€‚ğŸ˜œ</p><blockquote><p>ç¿»è¯‘è‡ªï¼šLearn to Make Apps with SwiftUI</p><p>è‹±æ–‡åŸæ–‡ï¼š<a href="https://developer.apple.com/tutorials/swiftui/tutorials">https://developer.apple.com/tutorials/swiftui/tutorials</a></p><p>è¿™ç¯‡æ–‡ç« æ˜¯ Apple ç»™çš„ SwiftUI å®˜æ–¹æ•™ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘è‡ªå·±é˜…è¯»å­¦ä¹ çš„æ—¶å€™é¡ºä¾¿ç¿»è¯‘çš„ã€‚</p></blockquote><h2 id="åˆ›å»ºå¹¶ç»„åˆè§†å›¾"><a href="#åˆ›å»ºå¹¶ç»„åˆè§†å›¾" class="headerlink" title="åˆ›å»ºå¹¶ç»„åˆè§†å›¾"></a>åˆ›å»ºå¹¶ç»„åˆè§†å›¾</h2><blockquote><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://developer.apple.com/tutorials/swiftui/creating-and-combining-views">https://developer.apple.com/tutorials/swiftui/creating-and-combining-views</a></p></blockquote><p>è¿™ä¸ªæ•™ç¨‹æ•™ä½ æ„å»ºä¸€ä¸ª iOS app â€”â€” <em>Landmarks</em>ã€‚è¿™ä¸ª App æ˜¯ç”¨æ¥å‘ç°ã€åˆ†äº«ä½ å–œæ¬¢çš„åœ°ç‚¹çš„ã€‚æˆ‘ä»¬ä¼šä»æ„å»ºä¸€ä¸ªæ˜¾ç¤ºåœ°æ ‡(Landmarks) è¯¦æƒ…çš„ View å¼€å§‹ã€‚</p><p>è¦å¸ƒå±€è¿™ä¸ªåœ°æ ‡è¯¦æƒ…çš„ Viewï¼Œæˆ‘ä»¬ç”¨ <em>stacks</em> æ¥ç»„åˆã€å †æ”¾[^1] å›¾ç‰‡å’Œæ–‡æœ¬è§†å›¾ç»„ä»¶ã€‚æˆ‘ä»¬è¿˜è¦ç”¨å¼•å…¥ MapKit ç»„ä»¶æ¥æä¾›åœ°å›¾è§†å›¾ã€‚åœ¨ä½ ä¿®æ”¹è§†å›¾çš„æ—¶å€™ï¼ŒXcode ä¼šç»™ä½ åŠæ—¶çš„åé¦ˆï¼Œè®©ä½ çœ‹åˆ°æ”¹å˜çš„ä»£ç ã€‚</p><p>ä¸‹è½½é¡¹ç›®æ–‡ä»¶ï¼Œè·Ÿç€ä¸‹é¢çš„æ­¥éª¤å¼€å§‹æ„å»ºå·¥ç¨‹å§ï¼š</p><blockquote><p>é¢„è®¡ç”¨æ—¶ï¼š40 åˆ†é’Ÿ</p><p>ä¸‹è½½é¡¹ç›®æ–‡ä»¶ï¼š<a href="https://docs-assets.developer.apple.com/published/b90bcabe8b9615e22850aaf17f3e7dfd/110/CreatingAndCombiningViews.zip">https://docs-assets.developer.apple.com/published/b90bcabe8b9615e22850aaf17f3e7dfd/110/CreatingAndCombiningViews.zip</a></p><p>Xcode 11ï¼š<a href="https://itunes.apple.com/us/app/xcode/id497799835?mt=12">https://itunes.apple.com/us/app/xcode/id497799835?mt=12</a></p></blockquote><p>[^1]: combine and layerï¼Œæˆ‘çš„ç†è§£æ˜¯ combine åœ¨åŒä¸€æ°´å¹³é¢ç»„åˆï¼Œlayer åšå‚ç›´æ–¹å‘ä¸Šå †æ”¾</p><h3 id="Â§-1-åˆ›å»ºæ–°é¡¹ç›®å’Œæ¢ç´¢ç”»å¸ƒ"><a href="#Â§-1-åˆ›å»ºæ–°é¡¹ç›®å’Œæ¢ç´¢ç”»å¸ƒ" class="headerlink" title="Â§ 1 åˆ›å»ºæ–°é¡¹ç›®å’Œæ¢ç´¢ç”»å¸ƒ"></a>Â§ 1 åˆ›å»ºæ–°é¡¹ç›®å’Œæ¢ç´¢ç”»å¸ƒ</h3><blockquote><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://developer.apple.com/tutorials/swiftui/creating-and-combining-views#create-a-new-project-and-explore-the-canvas">https://developer.apple.com/tutorials/swiftui/creating-and-combining-views#create-a-new-project-and-explore-the-canvas</a></p></blockquote><p>åœ¨ Xcode åˆ›å»ºä¸€ä¸ªä½¿ç”¨ SwiftUI çš„æ–°é¡¹ç›®ã€‚åœ¨é‡Œé¢æ¢ç´¢ç”»å¸ƒã€é¢„è§ˆå’Œ SwiftUI çš„æ¨¡ç‰ˆä»£ç ã€‚</p><p>è¦åœ¨ Xcode é‡Œé¢„è§ˆè§†å›¾ï¼Œå¹¶ä¸ä¹‹äº¤äº’ï¼Œéœ€è¦ macOS Catalina 10.15ã€‚[^2]</p><p><strong>Step 1.</strong> æ‰“å¼€ Xcodeï¼Œç„¶ååœ¨ Xcode çš„å¯åŠ¨é¡µé¢ç‚¹å‡» <strong>Create a new Xcode project</strong>ï¼Œæˆ–è€…é€‰æ‹© <strong>File &gt; New &gt; Project</strong>ã€‚[^3] <img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1geow8syirjj30tg0xcwg2.jpg" alt="ä¸€å¼ å±å¹•æˆªå›¾ï¼ŒWelcome to Xcodeé¡µé¢çš„ï¼Œå½“ä½ æ‰“å¼€Xcodeçš„æ—¶å€™ä¼šæ˜¾ç¤ºã€‚å½“ä½ æ‰“å¼€Xcodeæ—¶ï¼Œæœ‰ä¸‰ä¸ªé€‰é¡¹å¯ä¾›é€‰æ‹©ã€‚å¼€å§‹ä½¿ç”¨ä¸€ä¸ªplaygroundï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„Xcodeé¡¹ç›®ï¼Œå’Œå…‹éš†ä¸€ä¸ªç°æœ‰çš„é¡¹ç›®ã€‚ç¬¬äºŒä¸ªé€‰é¡¹--åˆ›å»ºä¸€ä¸ªæ–°çš„Xcodeé¡¹ç›®--è¢«çªå‡ºæ˜¾ç¤ºã€‚"></p><p><strong>Step 2.</strong> åœ¨æ¨¡ç‰ˆé€‰æ‹©çª—å£é‡Œé€‰æ‹© <strong>iOS</strong> å¹³å°ã€<strong>Single View App</strong> æ¨¡ç‰ˆï¼Œç„¶åç‚¹å‡» <strong>Next</strong>ã€‚<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1geox1ilcygj30tg0xcjtr.jpg" alt="Xcodeä¸­çš„æ¨¡æ¿é€‰æ‹©è¡¨çš„æˆªå›¾ã€‚åœ¨æœ€ä¸Šé¢ä¸€è¡Œä¸­ï¼ŒiOSè¢«é€‰ä¸ºå¹³å°ã€‚åœ¨åº”ç”¨éƒ¨åˆ†ï¼Œé€‰æ‹©äº†å•è§†å›¾Appä½œä¸ºæ¨¡æ¿ï¼›åœ¨å·¥ä½œè¡¨å³ä¸‹è§’çš„ä¸‹ä¸€æ­¥æŒ‰é’®ä¸Šæ–¹æœ‰ä¸€ä¸ªé«˜äº®æ˜¾ç¤ºã€‚"></p><p><strong>Step 3.</strong> åœ¨ Product Name å¤„è¾“å…¥â€œLandmarksâ€ï¼Œuser interface é€‰æ‹© <strong>SwiftUI</strong>ï¼Œç‚¹å‡» <strong>Next</strong>ã€‚ç„¶åé€‰æ‹©ä¸€ä¸ªä½ç½®åœ¨ä½ çš„ Mac ä¸Šä¿å­˜è¿™ä¸ªé¡¹ç›®ã€‚<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1geox5hibhcj30u00xzwhi.jpg" alt="Xcodeä¸­çš„æ¨¡æ¿é€‰æ‹©è¡¨æˆªå›¾ã€‚åœ¨æœ€ä¸Šé¢ä¸€è¡Œä¸­ï¼ŒiOSè¢«é€‰ä¸ºå¹³å°ã€‚åœ¨åº”ç”¨éƒ¨åˆ†ï¼Œé€‰æ‹©äº†å•è§†å›¾Appä½œä¸ºæ¨¡æ¿ï¼›åœ¨å·¥ä½œè¡¨å³ä¸‹è§’çš„ä¸‹ä¸€æ­¥æŒ‰é’®ä¸Šæ–¹æœ‰ä¸€ä¸ªé«˜äº®æ˜¾ç¤ºã€‚"></p><p><strong>Step 4.</strong> åœ¨é¡¹ç›®å¯¼èˆªæ (Project navigator)é‡Œé€‰æ‹©<code>ContentView.swift</code>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒSwiftUI å£°æ˜äº†ä¸¤ä¸ªç»“æ„ä½“ï¼Œç¬¬ä¸€ä¸ªéµå¾ªäº† View åè®®ï¼Œæ˜¯ç”¨æ¥æè¿°è§†å›¾çš„å†…å®¹å’Œå¸ƒå±€çš„ï¼›ç¬¬äºŒä¸ªç»“æ„ä½“å£°æ˜äº†å¯¹è¿™ä¸ªè§†å›¾çš„é¢„è§ˆã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2aqcod8mj30zr0u0gop.jpg" alt="ä»£ç ä»¥åŠæ¥é¢„è§ˆçš„å±å¹•æˆªå›¾ï¼Œé¢„è§ˆæ˜¯iPhoneä¸Šæ˜¾ç¤ºçš„æ•ˆæœï¼Œæ–‡å­—&quot;Hello Worldï¼&quot;ä½äºé¢„è§ˆçš„ä¸­é—´ã€‚"></p><p><strong>Step 5.</strong> åœ¨ç”»å¸ƒ(canvas)é‡Œç‚¹å‡» **Resume ** æ¥æ˜¾ç¤ºé¢„è§ˆã€‚</p><p>Tipsï¼šå¦‚æœç”»å¸ƒæ²¡æœ‰æ˜¾ç¤ºï¼Œä½ å¯ä»¥é€‰æ‹©<strong>Editor &gt; Editor and Canvas</strong>ï¼Œæ¥æ‰“å¡å®ƒã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gepcq2cqr7j30tg0xc3zm.jpg" alt="A screenshot of the Preview window, with a Refresh button in its upper-right corner."></p><p><strong>Step 6.</strong> åœ¨ body å±æ€§é‡Œï¼ŒæŠŠ <code>â€œHello Worldâ€</code> æ”¹æˆå¯¹ä½ è‡ªå·±æ‰“æ‹›å‘¼çš„è¯ã€‚</p><p>åœ¨ä½ æ”¹å˜è§†å›¾ä½“(a viewâ€™s <code>body</code> property)çš„æ—¶å€™ï¼Œé¢„è§ˆåŠæ—¶åœ°åæ˜ å‡ºäº†ä½ çš„æ”¹å˜ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2atforcrj30zc0u0tbt.jpg" alt="ä»£ç ä»¥åŠæ¥é¢„è§ˆçš„å±å¹•æˆªå›¾ï¼Œé¢„è§ˆæ˜¯iPhoneä¸Šæ˜¾ç¤ºçš„æ•ˆæœï¼Œæ–‡å­—&quot;Hello SwiftUIï¼&quot;ä½äºé¢„è§ˆçš„ä¸­é—´ã€‚"></p><p>å®Œæˆè¿™ä¸€èŠ‚åï¼Œæˆ‘ä»¬çš„ä¸»è¦ä»£ç çœ‹ä¸Šå»æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello SwiftUI!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€è¯‘æ³¨ã€‘ï¼šç”±äºæœ¬äººä½¿ç”¨ MacOS Mojave 10.14ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨é¢„è§ˆçš„åŠŸèƒ½ã€‚è¿™è¿˜æ˜¯ç›¸å½“ç—›è‹¦çš„ï¼Œæ²¡æœ‰é¢„è§ˆå‡ ä¹éš¾ä»¥è¿›è¡Œ UI è®¾è®¡äº†ï¼Œæ‰€ä»¥æˆ‘é‡‡å–çš„ä»£æ›¿æ–¹æ¡ˆæ˜¯åœ¨ Playground ä¸­å†™ SwiftUIã€‚å®ç°çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><p>æ–°å»ºä¸€ä¸ª Playgroundï¼Œé€‰æ‹© iOS å¹³å°ï¼ŒBlank æ¨¡ç‰ˆã€‚æ‰“å¼€ Playground åï¼ŒæŠŠé‡Œé¢çš„ä»£ç æ›¿æ¢å¦‚ä¸‹ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> PlaygroundSupport</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">HelloWoldView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">PlaygroundPage</span>.current.setLiveView(<span class="type">HelloWoldView</span>())</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿è¡Œ Playground è‡³ç¬¬ 10 è¡Œï¼ˆé¼ æ ‡ç§»åˆ°ç¬¬åè¡Œçš„è¡Œæ ‡å¤„ï¼Œæ•°å­—å˜æˆè¡¨ç¤ºè¿è¡Œçš„ç®­å¤´â–¶ï¸ï¼Œç‚¹å‡»è¿™ä¸ªç®­å¤´ï¼‰ï¼Œå³å¯çœ‹åˆ°é¢„è§ˆï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gepdi7wg5vj31e00u01fv.jpg" alt="ä¸€å¼  Playground çš„æˆªå›¾ï¼Œå·¦è¾¹å†™äº†å‰æ–‡é‡Œçš„ Hello World ç¨‹åºä»£ç ï¼Œå³è¾¹æ˜¾ç¤ºå‡ºäº†é¢„è§ˆâ€”â€”ä¸€ä¸ªç©ºç™½çš„é¡µé¢ä¸­é—´æ˜¾ç¤ºæœ‰æ–‡æœ¬ Hello World"></p><p>è¿™æ ·å‹‰å¼ºå¯ä»¥è¿›è¡Œ SwiftUI çš„å¼€å‘ï¼Œåªæ˜¯æ— æ³•å¦‚åœ¨ Catalina çš„ Xcode é¡¹ç›®é‡Œé‚£æ ·å’Œç”»å¸ƒäº¤äº’ã€‚</p><p>[^2]: æœ¬äººä½¿ç”¨ MacOS Mojave 10.14ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨é¢„è§ˆçš„åŠŸèƒ½ï¼Œæˆ‘é‡‡å–çš„ä»£æ›¿æ–¹æ¡ˆæ˜¯åœ¨ Playground ä¸­å†™ SwiftUIï¼š<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gepd5aetotj31e00u0nkd.jpg" alt="ä¸€ä¸ª Playground çš„æˆªå›¾ï¼Œå›¾ä¸­å†™äº†ä¸€æ®µæ˜¾ç¤º Hello SwiftUI æ–‡æœ¬çš„ç¨‹åºï¼Œå³è¾¹æ˜¾ç¤ºå‡ºäº†é¢„è§ˆ"><br>[^3]: åˆ†äº«ä¸€ä¸ªè®©æˆ‘å¾ˆæ„ŸåŠ¨çš„ç»†èŠ‚ï¼ŒApple çš„æ–‡æ¡£é‡Œï¼Œå±…ç„¶å¯¹è¿™æ ·çš„ä¸€å¼ æˆªå›¾å†™äº†å¦‚æ­¤è¯¦ç»†çš„ alt è¯´æ˜ï¼š<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1geowgmdd4nj31aa0u0tyk.jpg" alt="Appleæ–‡æ¡£çš„æˆªå›¾ï¼Œæ˜¾ç¤ºäº† apple å¯¹ç½‘é¡µä¸Šçš„ä¸€å¼ å›¾ç‰‡å†™äº†ç‰¹åˆ«è¯¦ç»†çš„ alt è¯´æ˜"> æ‰ªå¿ƒè‡ªé—®ï¼Œæˆ‘ä»æ¥ä¸è®¤çœŸå†™ altï¼Œæ€»è®¤ä¸ºè¿™ä¸œè¥¿åˆçœ‹ä¸è§å†™å®ƒå¹²å˜›ï¼çœ‹åˆ°äº† Apple çš„åšæ³•ï¼Œä¸ç¦æ€ç´¢ï¼Œä¸‡ä¸€æ­£åœ¨é˜…è¯»ä½ çš„æ–‡ç« çš„äººå› ä¸ºç½‘ç»œã€è®¡ç®—æœºã€ç”šè‡³æ˜¯è§†è§‰é—®é¢˜æ— æ³•çœ‹åˆ°è¿™å¼ å›¾ç‰‡ï¼Œæˆ‘ä»¬éš¾é“æ²¡æœ‰ä¹‰åŠ¡ä¸ºè¿™æ ·çš„ç‰¹æ®Šäººç¾¤å†™ä¸€æ®µå›¾ç‰‡è¯´æ˜å˜›ï¼Ÿå°¤å…¶æ˜¯å¯¹æœ‰è§†è§‰éšœç¢çš„äººå£«ï¼ä»¥åæˆ‘ä¼šå°½å¯èƒ½è®¤çœŸå†™ altï¼ç¬¬ä¸€æ­¥å°±æ˜¯â€”â€”è¿™ç¯‡æ–‡ç« ç¿»è¯‘é‡ŒåŒ…æ‹¬è¿™äº› altï¼</p><h3 id="Â§-2-å®šåˆ¶æ–‡æœ¬è§†å›¾-Text-View"><a href="#Â§-2-å®šåˆ¶æ–‡æœ¬è§†å›¾-Text-View" class="headerlink" title="Â§ 2 å®šåˆ¶æ–‡æœ¬è§†å›¾(Text View)"></a>Â§ 2 å®šåˆ¶æ–‡æœ¬è§†å›¾(Text View)</h3><blockquote><p>åŸæ–‡é“¾æ¥: <a href="https://developer.apple.com/tutorials/swiftui/creating-and-combining-views#customize-the-text-view">https://developer.apple.com/tutorials/swiftui/creating-and-combining-views#customize-the-text-view</a></p></blockquote><p>é€šè¿‡ä¿®æ”¹ä»£ç ï¼Œä½ å¯ä»¥å®šåˆ¶è§†å›¾çš„æ˜¾ç¤ºæ•ˆæœã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨æ£€è§†å™¨(inspector)æ¥å‘ç°ä½ å¯ä»¥åšäº›ä»€ä¹ˆï¼Œå¹¶å¸®åŠ©ä½ å®Œæˆä»£ç ã€‚</p><p>åœ¨æ„å»º <em>Landmarks</em> app çš„è¿‡ç¨‹ä¸­ï¼Œä½ å¯ä»¥éšæ„ä½¿ç”¨ä»»ä½•ç¼–è¾‘å™¨ï¼šä»£ç ç¼–è¾‘å™¨(source editor)ï¼Œç”»å¸ƒ(canvas)ï¼Œæ£€è§†å™¨(inspectors)ã€‚æ— è®ºä½ ä½¿ç”¨äº†é‚£ç§æ–¹å¼æ¥ç¼–è¾‘ï¼Œä»£ç æ€»ä¼šè‡ªåŠ¨ä¿æŒæ›´æ–°ã€‚</p><p><video data-v-f6e12e74="" autoplay="autoplay" muted="muted" playsinline=""><!----><source src="https://docs-assets.developer.apple.com/published/62bc5b3021f9628ad1536bdab67f5781/110/customize-text-view.mp4"></video></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç›‘è§†å™¨æ¥å®šåˆ¶æ–‡æœ¬è§†å›¾ã€‚</p><p><strong>Step 1.</strong> åœ¨é¢„è§ˆä¸­ï¼ŒæŒ‰ä½ command ç‚¹å‡»æˆ‘ä»¬å†™äº†é—®å€™çš„æ–‡æœ¬ï¼Œä¼šå‡ºç°ä¸€ä¸ªç»“æ„ç¼–è¾‘å¼¹å‡ºæ¡†(popover)ã€‚åœ¨è¿™ä¸ªå¼¹å‡ºæ¡†é‡Œï¼Œé€‰æ‹© <strong>Inspect</strong>ã€‚</p><p>è¿™ä¸ªå¼¹å‡ºæ¡†é‡Œè¿˜æœ‰å…¶ä»–çš„ä½ å¯ä»¥å®šåˆ¶çš„å±æ€§ï¼Œä¸åŒçš„è§†å›¾å¯èƒ½æœ‰ä¸åŒçš„å±æ€§ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2443doj0j30tg0xcgr0.jpg" alt="ç»“æ„ç¼–è¾‘å¼¹å‡ºæ¡†çš„æˆªå›¾"></p><p><strong>Step 2.</strong> åœ¨æ£€è§†å™¨ä¸­ï¼ŒæŠŠæ–‡æœ¬(Text)æ”¹æˆ â€œTurtle Rockâ€ â€”â€” ä½ çš„ app ä¸­è¦å±•ç°çš„ç¬¬ä¸€ä¸ªåœ°æ ‡ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg249uwx45j30tg0xcwmm.jpg" alt="åœ¨æ£€è§†å™¨ä¸­ï¼ŒæŠŠæ–‡æœ¬(Text)æ”¹æˆ â€œTurtle Rockâ€çš„æˆªå›¾"></p><p><strong>Step 3.</strong> æŠŠå­—ä½“ä¿®æ”¹æˆ <strong>Title</strong> (æ ‡é¢˜)ã€‚</p><p>è¿™ä¸ªæ“ä½œæ˜¯è®©æ–‡æœ¬ä½¿ç”¨ç³»ç»Ÿå­—ä½“ï¼Œè¿™ç§å­—ä½“å¯ä»¥è·Ÿéšç”¨æˆ·å½“å‰çš„åå¥½è®¾ç½®ã€‚</p><p>ã€è¯‘æ³¨ã€‘ä¹Ÿå¯ä»¥ä½¿ç”¨ä»£ç å®Œæˆè¿™ä¸ªæ›´æ”¹: <code>Text(&quot;Turtle Rock&quot;).font(.title)</code>ã€‚å“ˆå“ˆï¼Œè¿™ç§å†™æ³•å°±å¾ˆ Swiftï¼Œå…·ä½“è¿™æ˜¯ä»€ä¹ˆæ„æ€ä¸‹é¢çš„åŸæ–‡æœ‰å†™ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg248kgh47j30tg0xck13.jpg" alt="åœ¨æ£€è§†å™¨ä¸­ï¼Œä¿®æ”¹å­—ä½“çš„æˆªå›¾"></p><p>è¦ç”¨ SwiftUI å®šåˆ¶è§†å›¾ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ç§°ä½œä¿®é¥°å™¨(<em>modifiers</em>)çš„æ–¹æ³•ã€‚ä¿®é¥°å™¨ä¼šåŒ…è£…ä¸€ä¸ª View æ¥æ›´æ”¹å…¶æ˜¾ç¤ºæ•ˆæœæˆ–å…¶ä»–å±æ€§ã€‚æ¯ä¸ªä¿®é¥°å™¨éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ Viewï¼Œæ‰€ä»¥æˆ‘ä»¬å¸¸é“¾å¼è°ƒç”¨å¤šä¸ªä¿®é¥°å™¨ä»¥å åŠ æ•ˆæœã€‚</p><p><strong>Step 4.</strong> æ‰‹åŠ¨ä¿®æ”¹ä»£ç ï¼Œæ·»åŠ ä¸€ä¸ªä¿®é¥°å™¨ï¼š<code>foregroundColor(.green)</code>ï¼Œè¿™æ˜¯ç”¨æ¥æŠŠæ–‡æœ¬é¢œè‰²æ”¹æˆç»¿è‰²çš„ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2946pjduj317s0pigp3.jpg" alt="ä¿®æ”¹åçš„ä»£ç å’Œæ¥è‡ªXcodeé¢„è§ˆçš„æˆªå›¾ï¼Œå®ƒæ˜¾ç¤ºä¸€ä¸ªåœ¨iPhoneä¸Šçš„æ•ˆæœé¢„è§ˆï¼Œç»¿è‰²çš„æ–‡å­—ï¼ŒTurtle Rockï¼Œåœ¨æ˜¾ç¤ºå™¨çš„ä¸­é—´ã€‚"></p><p>ä»£ç æ‰æ˜¯æˆ‘ä»¬çš„è§†å›¾æ•ˆæœçš„ä¾æ®ï¼Œå½“ä½ ç”¨æ£€è§†å™¨æ¥ä¿®æ”¹æˆ–ç§»é™¤ä¿®é¥°å™¨æ—¶ï¼ŒXcode éƒ½ä¼šç«‹åˆ»åœ¨ä»£ç é‡Œåšå‡ºç›¸åº”çš„ä¿®æ”¹ã€‚</p><p><strong>Step 5.</strong> ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨ä»£ç é‡ŒæŒ‰ä½ Command ç‚¹å‡» <code>Text</code> çš„å£°æ˜ï¼Œä»å¼¹å‡ºæ¡†é‡Œé€‰æ‹© <strong>Inspect</strong>ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥æ‰“å¼€ç›‘è§†å™¨ã€‚åœ¨ <strong>Color</strong> èœå•é‡Œï¼ŒæŠŠé¢œè‰²è®¾ç½®æˆ <strong>Inherited</strong>ï¼Œè¿™æ ·æ–‡æœ¬çš„é¢œè‰²å°±å¤åŸäº†ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg25eor1eqj30tg0xcqfu.jpg" alt="æ¥è‡ªXcodeçš„ç»“æ„åŒ–ç¼–è¾‘å™¨èœå•æˆªå›¾ï¼Œé€šè¿‡Command-ç‚¹å‡»æ–‡æœ¬è§†å›¾çš„å£°æ˜æ‰“å¼€ã€‚"></p><p><strong>Step 6.</strong> æ³¨æ„ï¼Œå®Œæˆåˆšæ‰é‚£ä¸€æ­¥ä¹‹åï¼Œ Xcode è‡ªåŠ¨å¸®æˆ‘ä»¬æŠŠä»£ç åšäº†ç›¸åº”çš„ä¿®æ”¹ï¼Œå³å»æ‰äº†ä¿®é¥°å™¨ <code>foregroundColor(.green)</code>ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg27bz7r5sj317o0ougod.jpg" alt="åŸæ–‡é‡Œçš„ä»£ç å’Œé¢„è§ˆçš„æˆªå›¾"></p><hr><p>å®Œæˆè¿™ä¸€èŠ‚åï¼Œæˆ‘ä»¬çš„ä¸»è¦ä»£ç çœ‹ä¸Šå»æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">            .font(.title)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Â§-3-ç”¨-Stacks-ç»„åˆè§†å›¾"><a href="#Â§-3-ç”¨-Stacks-ç»„åˆè§†å›¾" class="headerlink" title="Â§ 3 ç”¨ Stacks ç»„åˆè§†å›¾"></a>Â§ 3 ç”¨ Stacks ç»„åˆè§†å›¾</h3><blockquote><p>åŸæ–‡é“¾æ¥: <a href="https://developer.apple.com/tutorials/swiftui/creating-and-combining-views#Combine-Views-Using-Stacks">https://developer.apple.com/tutorials/swiftui/creating-and-combining-views#Combine-Views-Using-Stacks</a></p></blockquote><p>åœ¨ä¸Šä¸€èŠ‚æˆ‘ä»¬å®Œæˆäº†ä¸€ä¸ªæ ‡é¢˜ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†å†æ·»åŠ ä¸€äº›æ–‡æœ¬è§†å›¾æ¥æè¿°åœ°æ ‡çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚æ‰€å¤„çš„å…¬å›­åç§°å’Œæ‰€åœ¨çš„å·ã€‚</p><p>åœ¨ä½¿ç”¨ SwiftUI åˆ›å»º View æ—¶ï¼Œæˆ‘ä»¬åœ¨è§†å›¾çš„ <code>body</code> å±æ€§é‡Œæè¿°å…¶å†…å®¹ã€å¸ƒå±€ã€è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œbody å±æ€§åªä¼šè¿”å›<strong>ä¸€ä¸ª</strong>è§†å›¾ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦æŠŠå¤šä¸ªè§†å›¾æ”¾åˆ° stack é‡Œæ¥è®©å®ƒä»¬åœ¨æ°´å¹³ã€ç«–ç›´ã€å‰åæ–¹å‘ä¸Šç»„åˆåœ¨ä¸€èµ·ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg280wmdfij30f408ct8p.jpg" alt="ä¸€ä¸ªVStackçš„ç¤ºæ„å›¾ï¼Œåœ¨è§†å›¾çš„ä¸ŠåŠéƒ¨åˆ†æ˜¾ç¤ºäº†Turtle Rockçš„æ ‡é¢˜å·¦å¯¹é½ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªè¢«é«˜å…‰åŒ…å›´çš„HStackã€‚HStackåŒ…å«ä¸‰ä¸ªè§†å›¾ã€‚å·¦è¾¹çš„è§†å›¾æ˜¾ç¤ºæ–‡æœ¬&quot;Joshua Tree National Park&quot;ã€‚ä¸­é—´çš„è§†å›¾æ˜¯ä¸€ä¸ªéš”æ¿Spacerã€‚å³è¾¹çš„è§†å›¾æ˜¾ç¤ºæ–‡å­— &quot;California&quot;"></p><p>åœ¨è¿™ä¸€èŠ‚é‡Œï¼Œæˆ‘ä»¬æˆ‘ä»¬å°†ç”¨ä¸€ä¸ªç«–ç›´æ–¹å‘çš„ stack æ¥æŠŠæ ‡é¢˜æ”¾åœ¨ä¸€ä¸ªåŒ…å«äº†åœ°æ ‡ç»†èŠ‚çš„æ°´å¹³ stack çš„ä¸Šæ–¹ã€‚</p><p>ï¼ˆemmmï¼Œæˆ‘ä¸€ç›´ä¸å¤ªä¼šç¿»è¯‘è¿™ç§æ¯”è¾ƒé•¿çš„è‹±æ–‡å¥å­ï¼Œå¯èƒ½æ˜¯æˆ‘è¯­æ–‡å­¦çš„ä¸å¥½å§ï¼Œæˆ‘ä¸çŸ¥é“æ€ä¹ˆè§£è€¦è¿™ç§æœ‰åµŒå¥—ç»“æ„çš„å¥å­ï¼‰</p><p>æˆ‘ä»¬ Xcode çš„ç»“æ„ç¼–è¾‘(structured editing)æä¾›æŠŠä¸€ä¸ª view åµŒå…¥ä¸€ä¸ªå®¹å™¨è§†å›¾ã€æ‰“å¼€æ£€è§†å™¨å’Œå…¶ä»–è®¸å¤šæœ‰ç”¨çš„æ“ä½œã€‚</p><p><strong>Step 1.</strong> æŒ‰ä½ Command ç‚¹å‡»æ–‡æœ¬è§†å›¾çš„åˆå§‹åŒ–å™¨(æ„é€ å‡½æ•°å•¦)ï¼Œä¼šæ˜¾ç¤ºå‡ºç»“æ„ç¼–è¾‘å¼¹å‡ºæ¡†ï¼Œåœ¨é‡Œé¢é€‰æ‹© <strong>Embed in VStack</strong>ï¼ˆåµŒå…¥VStackï¼‰ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg28iuv3hrj30tg0xcajy.jpg" alt="å½“ä½ Commandç‚¹å‡»æ–‡æœ¬åˆå§‹åŒ–å™¨æ—¶æ˜¾ç¤ºçš„å¼¹å‡ºå¼èœå•çš„æˆªå›¾ã€‚åœ¨èœå•ä¸­ï¼Œ&quot;åµŒå…¥VStack &quot;é€‰é¡¹è¢«é«˜äº®æ˜¾ç¤ºã€‚"></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä»åº“é‡Œæ‹–ä¸€ä¸ª Text æ”¾åˆ° Stack é‡Œå¢åŠ ä¸€ä¸ªæ–‡æœ¬è§†å›¾ã€‚</p><p><strong>Step 2.</strong> ç‚¹å‡»ä½äº Xcode çª—å£å³ä¸Šæ–¹çš„åŠ å·ï¼ˆ+ï¼‰æ‰“å¼€åº“ã€‚ä»é‡Œé¢æ‹–ä¸€ä¸ª Text å‡ºæ¥æ”¾åˆ°æˆ‘ä»¬çš„â€œTurtle Rockâ€æ–‡æœ¬è§†å›¾ä»£ç çš„åé¢ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2919jfa8j30tg0xc4bd.jpg" alt="ç”»å¸ƒå’Œé¢„è§ˆçš„æˆªå›¾ï¼Œä»¥åŠåº“çª—å£ï¼Œæ˜¾ç¤ºäº†Turtle Rockä¸‹æ–¹çš„æ–°æ–‡æœ¬è§†å›¾ã€‚"></p><p><strong>Step 3.</strong> æŠŠæ–°çš„æ–‡æœ¬è§†å›¾çš„å†…å®¹æ›¿æ¢ä¸ºâ€œ<strong>Joshua Tree National Park</strong>â€ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg296yvagmj317g0q4whx.jpg" alt="ä»£ç å’Œé¢„è§ˆæˆªå›¾ï¼Œé¢„è§ˆä¸­æ˜¾ç¤ºäº†Turtle Rockä¸‹æ–¹çš„æ–°æ–‡æœ¬è§†å›¾ã€‚"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿˜ä¼šå®šåˆ¶åˆšåˆšæ·»åŠ çš„é‚£ä¸ªè¡¨ç¤º<em>ä½ç½®</em>çš„æ–‡æœ¬è§†å›¾ï¼Œä»¥åŒ¹é…æ‰€éœ€çš„å¸ƒå±€ã€‚</p><p><strong>Step 4.</strong> è®¾ç½®ä½ç½®æ–‡æœ¬çš„å­—ä½“ä¸º subheadlineï¼ˆå‰¯æ ‡é¢˜ï¼‰ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">.font(.subheadline)</span><br></pre></td></tr></table></figure><p><strong>Step 5.</strong> ç¼–è¾‘ VStack çš„åˆå§‹åŒ–å™¨æ¥æŒ‡å®šè§†å›¾å‰ç¼˜å¯¹é½ï¼ˆalign the views by their leading edgesï¼Œå°±æ˜¯æŠŠå·¦è¾¹å¯¹é½äº†ï¼ŒAndroid é‡Œçš„ <code>gravity=&quot;start&quot;</code> è¿™ç§æ„æ€å§ï¼‰ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œstack ä¼šæ²¿å…¶è½´çº¿æŠŠå†…å®¹ä¸­å¿ƒå¯¹é½ï¼Œå¹¶ä¸”åªæä¾›é€‚åˆå†…å®¹çš„ç©ºé—´ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg29moovfzj317s0ou0w9.jpg" alt="ä»£ç å’Œé¢„è§ˆçš„æˆªå›¾ï¼Œé¢„è§ˆæ˜¯æ˜¾ç¤ºçš„æ˜¯iPhoneä¸Šçš„æ•ˆæœï¼ŒTurtle Rockå’ŒJoshua Tree National Parkæ–‡æœ¬åœ¨æ˜¾ç¤ºå±çš„ä¸­é—´å·¦å¯¹é½ã€‚"></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦åœ¨è¡¨ç¤ºä½ç½®çš„æ–‡æœ¬å³è¾¹å¢åŠ ä¸€ä¸ªæ–‡æœ¬ï¼Œè¡¨ç¤ºå…¶æ‰€åœ¨çš„å·ã€‚</p><p><strong>Step 6.</strong> åœ¨ç”»å¸ƒä¸­ï¼ŒæŒ‰ä½ Command ç‚¹å‡» <strong>Joshua Tree National Park</strong>ï¼Œé€‰æ‹© <strong>Embed in HStack</strong>ï¼ˆåµŒå…¥HStackï¼‰ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg29rui2mhj30tg0xcwnl.jpg" alt="å¼¹å‡ºçª—å£çš„æˆªå›¾ï¼Œèœå•ä¸­é«˜äº®æ˜¾ç¤ºEmbed in HStackã€‚"></p><p><strong>Step 7.</strong> åœ¨ä½ç½®åé¢æ–°å»ºä¸€ä¸ªæ–‡æœ¬è§†å›¾ï¼ŒæŠŠå†…å®¹æ”¹æˆå·åï¼ŒæŠŠå­—ä½“è®¾ç½®ä¸º subheadlineã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg29wvmdrrj30zf0u0td7.jpg" alt="ä»£ç å’Œé¢„è§ˆçš„æˆªå›¾"></p><p><strong>Step 8.</strong>  ä¸ºäº†è®©æˆ‘ä»¬çš„å¸ƒå±€å æ»¡æ•´ä¸ªè®¾å¤‡çš„å±å¹•å®½åº¦ï¼Œæˆ‘ä»¬åœ¨åŒ…å«å…¬å›­å’Œå·åçš„ HStack é‡Œæ·»åŠ ä¸€ä¸ª <strong>Spacer</strong> æ¥æŠŠä¸¤ä¸ªæ–‡æœ¬è§†å›¾åˆ†å¼€ã€‚</p><p><code>Spacer</code> ç”¨æ¥â€œæ’‘å¤§â€å®¹å™¨å¸ƒå±€ï¼Œä½¿å…¶å æ»¡æ•´ä¸ªæ°´å¹³æˆ–ç«–ç›´æ–¹å‘çš„çˆ¶è§†å›¾ï¼ˆits parent viewï¼‰ç©ºé—´ï¼Œè€Œä¸å†åªæ˜¯æ°å¥½åŒ…å«å†…å®¹ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2ahwhhvwj30zm0u0433.jpg" alt="ä»£ç å’Œé¢„è§ˆçš„æˆªå›¾"></p><p><strong>Step 9.</strong> æœ€åï¼Œä½¿ç”¨ <code>padding()</code> ä¿®é¥°æ–¹æ³•ç»™åœ°æ ‡çš„åç§°å’Œç»†èŠ‚å¢åŠ ä¸€ç‚¹ç©ºé—´ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2alkmh6oj30zn0u0791.jpg" alt="ä»£ç å’Œé¢„è§ˆçš„æˆªå›¾"></p><hr><p>å®Œæˆè¿™ä¸€èŠ‚åï¼Œæˆ‘ä»¬çš„ä¸»è¦ä»£ç çœ‹ä¸Šå»æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                .font(.title)</span><br><span class="line">            <span class="type">HStack</span>&#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                    .font(.subheadline)</span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                    .font(.subheadline)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Â§-4-åˆ›å»ºè‡ªå®šä¹‰å›¾ç‰‡è§†å›¾-Custom-Image-View"><a href="#Â§-4-åˆ›å»ºè‡ªå®šä¹‰å›¾ç‰‡è§†å›¾-Custom-Image-View" class="headerlink" title="Â§ 4 åˆ›å»ºè‡ªå®šä¹‰å›¾ç‰‡è§†å›¾(Custom Image View)"></a>Â§ 4 åˆ›å»ºè‡ªå®šä¹‰å›¾ç‰‡è§†å›¾(Custom Image View)</h3><p>ç°åœ¨ï¼Œå’±ä»¬çš„åœ°æ ‡åç§°ã€ä½ç½®éƒ½å·²ç»å®‰æ’å¥½äº†ã€‚ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬æ‰“ç®—åŠ ä¸€å¼ åœ°æ ‡çš„å›¾ç‰‡ã€‚</p><p>æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ–°çš„è‡ªå®šä¹‰è§†å›¾ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨ç°åœ¨çš„æ–‡ä»¶é‡Œç»§ç»­å†™æ›´å¤šçš„ä»£ç äº†ã€‚è¿™ä¸ªè‡ªå®šä¹‰è§†å›¾å°†åŒ…å«æœ‰é®ç½©ã€è¾¹æ¡†å’ŒæŠ•å½±ã€‚</p><p><video data-v-f6e12e74="" autoplay="autoplay" muted="muted" playsinline=""><!----><source src="https://docs-assets.developer.apple.com/published/dd83089688f823328fbd9cb9a26238c5/110/custom-image-view.mp4"></video></p><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦å…ˆæ·»åŠ å›¾ç‰‡åˆ°é¡¹ç›®çš„èµ„äº§ç›®å½•( asset catalog)ã€‚</p><p><strong>Step 1.</strong> æŠŠ <code>turtlerock.png</code> ï¼ˆåœ¨Appleç»™çš„é¡¹ç›®æ–‡ä»¶é‡Œçš„ Resources æ–‡ä»¶å¤¹é‡Œæœ‰ï¼‰æŠŠå®ƒæ‹–åˆ° èµ„äº§ç›®å½• ç¼–è¾‘å™¨é‡Œï¼ŒXcode ä¼šä¸ºè¿™ä¸ªæ–°å›¾ç‰‡åˆ›å»ºä¸€ä¸ªå›¾ç‰‡é›†ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2bi3sx88j30tg0xc76h.jpg" alt="èµ„äº§ç›®å½•çš„æˆªå›¾ï¼Œå›¾ç‰‡æ”¾åœ¨1å€æ§½ä¸­ã€‚"></p><p>ã€è¯‘æ³¨ã€‘é‚£ä¸ªå›¾ç‰‡å°±æ˜¯ä¸‹é¢è¿™å¼ ğŸ‘‡</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2blu752tj306y06y0us.jpg" alt="turtlerock"></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ SwiftUI View æ¥å†™æˆ‘ä»¬çš„è‡ªå®šä¹‰å›¾ç‰‡è§†å›¾ã€‚</p><p><strong>Step 2.</strong> é€‰æ‹© <strong>File &gt; New &gt; File</strong>ï¼Œæ‰“å¼€æ¨¡ç‰ˆé€‰æ‹©å™¨ï¼Œåœ¨ <strong>User Interface</strong> ä¸­ï¼Œé€‰æ‹© <strong>SwiftUI View</strong>ï¼Œç„¶åç‚¹ <strong>Next</strong>ï¼ŒæŠŠæ–‡ä»¶åå–æˆ <code>CircleImage.swift</code>ï¼Œç„¶åç‚¹ <strong>Create</strong>ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2gd8yh7lj30tg0q1424.jpg" alt="æ–°æ–‡ä»¶ç±»å‹é€‰æ‹©å™¨çš„æˆªå›¾ï¼Œé«˜äº®æ˜¾ç¤ºSwiftUI Viewå’Œä¸‹ä¸€æ­¥æŒ‰é’®ã€‚"></p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±å‡†å¤‡å¥½æ’å…¥å›¾ç‰‡ï¼Œç„¶åä¿®æ”¹æ˜¾ç¤ºæ•ˆæœæ¥è¾¾åˆ°æˆ‘ä»¬çš„é¢„æœŸç›®æ ‡äº†ã€‚</p><p><strong>Step 3.</strong> ç”¨æˆ‘ä»¬åˆšæ‰å‡†å¤‡å¥½çš„å›¾ç‰‡æ¥æ›¿æ¢æ–°å»ºçš„æ–‡ä»¶é‡Œçš„æ–‡æœ¬è§†å›¾ï¼Œç”¨ <code>Image(_:)</code> æ¥æ˜¾ç¤ºä¸€å¼ å›¾ç‰‡ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2gj64fgfj30zi0u0am7.jpg" alt="ä½¿ç”¨Imageæ˜¾ç¤ºå›¾ç‰‡çš„ä»£ç å’Œé¢„è§ˆæˆªå›¾"></p><p>ã€è¯‘æ³¨ã€‘åœ¨ Playground é‡Œå†™ <code>Image(&quot;turtlerock&quot;)</code> è¦ä¸æˆï¼Œè¦ç”¨ <code>Image(uiImage: UIImage(named: &quot;turtlerock.jpg&quot;)!)</code></p><p><strong>Step 4.</strong> æ·»åŠ ä¸€ä¸ª <code>clipShape(Circle())</code> è°ƒç”¨æ¥æŠŠå›¾ç‰‡è£å‰ªä¸ºåœ†å½¢ã€‚</p><p><code>Circle</code> ç±»å‹æ˜¯ä¸€ä¸ªå½¢çŠ¶ï¼Œä½ å¯ä»¥æŠŠå®ƒå½“é®ç½©(mask)ç”¨ï¼Œä¹Ÿå¯ä»¥æŠŠå®ƒä½œä¸ºä¸€ä¸ªåœ†å½¢çš„è§†å›¾ï¼ˆæœ‰åœ†å½¢çš„ç¬”è§¦æˆ–è€…åœ†å½¢å¡«å……çš„ï¼‰ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2hfamef6j317w0psaki.jpg" alt="æŠŠImageæ˜¾ç¤ºå›¾ç‰‡å˜æˆåœ†å½¢çš„ä»£ç å’Œé¢„è§ˆæ•ˆæœæˆªå›¾"></p><p><strong>Step 5.</strong> å†åˆ›å»ºä¸€ä¸ªæ–°çš„ç°è‰²ç¬”è§¦çš„åœ†ï¼Œç„¶åæŠŠå®ƒä½œä¸º <code>overlay</code> åŠ åˆ°æˆ‘ä»¬ä¹‹å‰çš„ Image ä¸Šï¼Œè¿™æ ·å¯ä»¥ä½œå‡ºä¸€ä¸ªè¾¹æ¡†æ•ˆæœã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2hodymblj317u0pqtj5.jpg" alt="ä»£ç å’Œé¢„è§ˆæ•ˆæœæˆªå›¾ï¼ŒåŠ äº†ç°è‰²çš„åœ†å½¢è¾¹æ¡†"></p><p><strong>Step 6.</strong> æ¥ä¸‹æ¥ï¼Œæ·»åŠ ä¸€ä¸ªåŠå¾„ä¸º 10 ç‚¹çš„é˜´å½±ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2hrhhj7tj317c0q2n8b.jpg" alt="ä»£ç å’Œé¢„è§ˆæ•ˆæœæˆªå›¾ï¼ŒåŠ äº†é˜´å½±"></p><p><strong>Step 7.</strong> æŠŠè¾¹æ¡†é¢œè‰²æ”¹æˆç™½è‰²ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2hta2gs3j31960p8wq2.jpg" alt="ä»£ç å’Œé¢„è§ˆæ•ˆæœæˆªå›¾ï¼ŒæŠŠè¾¹æ¡†é¢œè‰²æ”¹æˆäº†ç™½è‰²"></p><p>ç°åœ¨ï¼Œæˆ‘ä»¬çš„è‡ªå®šä¹‰å›¾ç‰‡è§†å›¾å°±å®Œæˆäº†ã€‚</p><hr><p>å®Œæˆè¿™ä¸€èŠ‚åï¼Œæˆ‘ä»¬çš„ä¸»è¦ä»£ç çœ‹ä¸Šå»æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CircleImage</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="comment">// Playground é‡Œæ¢æˆï¼šImage(uiImage: UIImage(named: &quot;turtlerock.jpg&quot;)!)</span></span><br><span class="line">        <span class="type">Image</span>(<span class="string">&quot;turtlerock&quot;</span>)</span><br><span class="line">            .clipShape(<span class="type">Circle</span>())</span><br><span class="line">            .overlay(</span><br><span class="line">                <span class="type">Circle</span>().stroke(<span class="type">Color</span>.white, lineWidth: <span class="number">4</span>))</span><br><span class="line">            .shadow(radius: <span class="number">10</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Â§-5-åŒæ—¶ä½¿ç”¨-SwiftUI-å’Œ-UIKit"><a href="#Â§-5-åŒæ—¶ä½¿ç”¨-SwiftUI-å’Œ-UIKit" class="headerlink" title="Â§ 5 åŒæ—¶ä½¿ç”¨ SwiftUI å’Œ UIKit"></a>Â§ 5 åŒæ—¶ä½¿ç”¨ SwiftUI å’Œ UIKit</h3><p>ç°åœ¨ï¼Œå’±æ‰“ç®—åšä¸€ä¸ªåœ°å›¾è§†å›¾äº†ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªæ¥è‡ª <code>MapKit</code> çš„ <code>MKMapView</code> ç±»æ¥æä¾›ä¸€ä¸ªåœ°å›¾è§†å›¾ã€‚</p><p>è¦åœ¨ SwiftUI ä¸­ä½¿ç”¨ <code>UIView</code> çš„å­ç±»ï¼Œæˆ‘ä»¬è¦æŠŠå®ƒç”¨ä¸€ä¸ªå®ç°äº† <code>UIViewRepresentable</code> åè®®çš„ SwiftUI è§†å›¾åŒ…è£¹èµ·æ¥ã€‚SwiftUI ä¹Ÿå¯¹ WatchKit å’Œ AppKit çš„è§†å›¾æä¾›äº†ç›¸ä¼¼çš„åè®®ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2i5762mvj30oy0bcwha.jpg" alt="MapKitè§†å›¾æˆªå›¾ï¼Œçº¦ä¹¦äºšæ ‘å›½å®¶å…¬å›­ä¸Šæœ‰ä¸€ä¸ªæ ‡è®°ã€‚"></p><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦è‡ªå®šä¹‰ä¸€ä¸ªè§†å›¾æ¥åŒ…è£… MKMapViewã€‚</p><p><strong>Step 1.</strong> é€‰æ‹© <strong>File &gt; New &gt; File</strong>ï¼Œæ‰“å¼€æ¨¡ç‰ˆé€‰æ‹©å™¨ï¼Œåœ¨ <strong>User Interface</strong> ä¸­ï¼Œé€‰æ‹© <strong>SwiftUI View</strong>ï¼Œç„¶åç‚¹ <strong>Next</strong>ï¼ŒæŠŠæ–‡ä»¶åå–æˆ <code>MapView.swift</code>ï¼Œç„¶åç‚¹ <strong>Create</strong>ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2itovm2cj30tg0q1427.jpg" alt="æ–°å»ºæ–‡ä»¶ç±»å‹é€‰æ‹©å™¨çš„æˆªå›¾ï¼Œé«˜äº®æ˜¾ç¤ºSwiftUI Viewå’Œä¸‹ä¸€æ­¥æŒ‰é’®ã€‚"></p><p><strong>Step 2.</strong> æ·»åŠ ä¸€ä¸ª import è¯­å¥æ¥å¯¼å…¥ <code>MapKit</code>ï¼Œç„¶åè®© <code>MapView</code> éµå¾ª <code>UIViewRepresentable</code> åè®®ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MapView.swift</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> MapKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MapView</span>: <span class="title">UIViewRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MapView_Previews</span>: <span class="title">PreviewProvider</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">MapView</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ«ä»‹æ„ Xcode æç¤ºçš„é”™è¯¯ï¼Œæˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥å‡ æ­¥é‡Œè§£å†³è¿™äº›é—®é¢˜ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¦å®Œæˆ <code>UIViewRepresentable</code> è¦æ±‚ä¸¤ä¸ªå®ç°ï¼š</p><ul><li><code>makeUIView(context:)</code>ï¼šè¿™ä¸ªæ–¹æ³•ç”¨æ¥åˆ›å»º MKMapViewï¼›</li><li><code>updateUIView(_:context:)</code>ï¼šè¿™ä¸ªæ–¹æ³•ç”¨æ¥è®¾å®šè§†å›¾ï¼Œå¹¶å¯¹ä»»æ„æ”¹å˜ä½œå‡ºå“åº”ã€‚</li></ul><p><strong>Step 3.</strong> æŠŠæ–°å»ºçš„è§†å›¾é‡Œçš„ body å±æ€§çš„ä»£ç æ›¿æ¢æˆå®šä¹‰ä¸€ä¸ª <code>makeUIView(context:)</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨æ¥åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ <code>KMapView</code>ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MapView</span>: <span class="title">UIViewRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeUIView</span><span class="params">(context: Context)</span></span> -&gt; <span class="type">MKMapView</span> &#123;</span><br><span class="line">        <span class="type">MKMapView</span>(frame: .zero)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Step 4.</strong> åœ¨ MapView é‡Œæ·»åŠ ä¸€ä¸ª <code>updateUIView(_:context:)</code> æ–¹æ³•æ¥è®¾ç½®æˆ‘ä»¬çš„åœ°å›¾æŠŠè¦æ˜¾ç¤ºçš„ä½ç½®æ”¾åˆ°ä¸­å¿ƒä½ç½®ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">updateUIView</span><span class="params">(<span class="keyword">_</span> uiView: MKMapView, context: Context)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> coordinate <span class="operator">=</span> <span class="type">CLLocationCoordinate2D</span>(</span><br><span class="line">        latitude: <span class="number">34.011286</span>, longitude: <span class="operator">-</span><span class="number">116.166868</span>)</span><br><span class="line">    <span class="keyword">let</span> span <span class="operator">=</span> <span class="type">MKCoordinateSpan</span>(latitudeDelta: <span class="number">2.0</span>, longitudeDelta: <span class="number">2.0</span>)</span><br><span class="line">    <span class="keyword">let</span> region <span class="operator">=</span> <span class="type">MKCoordinateRegion</span>(center: coordinate, span: span)</span><br><span class="line">    uiView.setRegion(region, animated: <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºåœ¨é™æ€æ¨¡å¼ï¼ˆstatic modeï¼‰ä¸‹é¢„è§ˆåªä¼šæ¸²æŸ“ SwiftUI è§†å›¾ï¼Œè€Œæˆ‘ä»¬çš„åœ°å›¾æ˜¯ä¸ª UIView çš„å­ç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠé¢„è§ˆè°ƒåˆ° live æ¨¡å¼ï¼ˆlive previewï¼‰æ‰èƒ½çœ‹è§åœ°å›¾ã€‚</p><p><strong>Step 5.</strong> ç‚¹å‡» <strong>Live Preview</strong> æŒ‰é’®æ¥æŠŠé¢„è§ˆè°ƒè‡³ live æ¨¡å¼ã€‚ç„¶åï¼Œä½ å¯èƒ½è¿˜éœ€è¦ç‚¹å‡» <strong>Try Again</strong> æˆ–è€… <strong>Resume</strong> æŒ‰é’®æ‰èƒ½æ˜¾ç¤ºå‡ºé¢„æœŸçš„æ•ˆæœã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2kfi6wy2j30tg0xc48n.jpg" alt="Xcodeç”»å¸ƒçš„æˆªå›¾ï¼Œé€‰æ‹©äº†Live PreviewæŒ‰é’®ã€‚"></p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†çœ‹è§ä¸€å¼ æ˜¾ç¤ºç€ Joshua Tree National Park çš„åœ°å›¾â€”â€”è¿™å°±æ˜¯æˆ‘ä»¬çš„åœ°æ ‡ Turtle Rock çš„å®¶ã€‚</p><hr><p>è¿™ä¸€èŠ‚é‡Œï¼Œæˆ‘ä»¬å®Œæˆçš„ä¸»è¦ä»£ç çœ‹ä¸Šå»æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MapView</span>: <span class="title">UIViewRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">makeUIView</span><span class="params">(context: Context)</span></span> -&gt; <span class="type">MKMapView</span> &#123;</span><br><span class="line">        <span class="type">MKMapView</span>(frame: .zero)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">updateUIView</span><span class="params">(<span class="keyword">_</span> uiView: MKMapView, context: Context)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> coordinate <span class="operator">=</span> <span class="type">CLLocationCoordinate2D</span>(</span><br><span class="line">            latitude: <span class="number">34.011286</span>, longitude: <span class="operator">-</span><span class="number">116.166868</span>)</span><br><span class="line">        <span class="keyword">let</span> span <span class="operator">=</span> <span class="type">MKCoordinateSpan</span>(latitudeDelta: <span class="number">2.0</span>, longitudeDelta: <span class="number">2.0</span>)</span><br><span class="line">        <span class="keyword">let</span> region <span class="operator">=</span> <span class="type">MKCoordinateRegion</span>(center: coordinate, span: span)</span><br><span class="line">        uiView.setRegion(region, animated: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Â§-6-ç»„æˆ-Detail-è§†å›¾"><a href="#Â§-6-ç»„æˆ-Detail-è§†å›¾" class="headerlink" title="Â§ 6 ç»„æˆ Detail è§†å›¾"></a>Â§ 6 ç»„æˆ Detail è§†å›¾</h3><p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»æ„å»ºå®Œäº†æˆ‘ä»¬éœ€è¦çš„ä¸€åˆ‡â€”â€”åœ°æ ‡çš„åå­—å’Œä½ç½®ã€ä¸€å¼ åœ†å½¢çš„å›¾ç‰‡ä»¥åŠå…¶æ‰€åœ¨ä½ç½®çš„åœ°å›¾ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬è¦æŠŠè¿™äº›æˆ‘ä»¬å†™å¥½çš„è‡ªå®šä¹‰è§†å›¾ç»„åˆåœ¨ä¸€èµ·ï¼Œæ¥å®Œæˆä¸€ä¸ªåœ°æ ‡çš„ Detail è§†å›¾çš„æœ€ç»ˆè®¾è®¡äº†ï¼æˆ‘ä»¬è¦ç”¨åˆ°çš„è¿˜æ˜¯å·²ç»å¼€å§‹ç†Ÿæ‚‰çš„é‚£äº›å·¥å…·ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2kw18daoj30lq0lkqbl.jpg" alt="åˆæˆè§†å›¾çš„å›¾åƒï¼Œä¸Šé¢æ˜¯åœ°å›¾è§†å›¾ï¼Œä¸‹é¢æ˜¯å…¬å›­åç§°ï¼Œä¸­é—´æ˜¯åœ†å½¢å›¾åƒè§†å›¾ã€‚"></p><p><strong>Step 1.</strong> åœ¨é¡¹ç›®å¯¼èˆªï¼ˆProject navigatorï¼‰ä¸­ï¼Œé€‰æ‹©æ‰“å¼€ <code>ContentView.swift</code> æ–‡ä»¶ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2kzfv52qj31020u0792.jpg" alt="ContentView.swiftæ–‡ä»¶å†…çš„ä»£ç å’Œé¢„è§ˆæˆªå›¾"></p><p><strong>Step 2.</strong> æŠŠä¹‹å‰é‚£ä¸ªåŒ…å«ä¸‰ä¸ª Text çš„ VStack ç”¨å¦ä¸€ä¸ªæ–°çš„ VStack åŒ…è£¹èµ·æ¥ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2l1en0s5j312c0u0afy.jpg" alt="ä»£ç å’Œé¢„è§ˆæ•ˆæœçš„æˆªå›¾ï¼Œåœ¨ä¹‹å‰çš„ VStackå¤–é¢å¥—äº†ä¸€ä¸ªæ–°çš„VStackï¼Œé¢„è§ˆæ•ˆæœä¸å˜"></p><p><strong>Step 3.</strong> æŠŠæˆ‘ä»¬è‡ªå®šä¹‰çš„ MapView æ”¾åˆ° stack çš„é¡¶éƒ¨ï¼Œå¹¶ç”¨ <code>frame(width:height:)</code> æ¥è°ƒæ•´å…¶å¤§å°ã€‚</p><p>å½“ä½ åªæŒ‡å®šäº† heightï¼ˆé«˜åº¦ï¼‰å±æ€§æ—¶ï¼Œè§†å›¾ä¼šè‡ªåŠ¨æŠŠå®½åº¦è®¾ç½®æˆç¬¦åˆå†…å®¹çš„ã€‚åœ¨è¿™é‡Œï¼ŒMapView ä¼šæ‹“å±•å¼€å……æ»¡æ•´ä¸ªå¯ç”¨ç©ºé—´ã€‚</p><p><strong>Step 4.</strong> ç‚¹å‡» <strong>Live Preview</strong> æŒ‰é’®æ¥æŸ¥çœ‹åœ¨ç»„åˆè§†å›¾ä¸­æ¸²æŸ“å‡ºæ¥çš„åœ°å›¾ã€‚</p><p>åœ¨æ˜¾ç¤º  Live Preview çš„åŒæ—¶ï¼Œä½ ä¹Ÿè¿˜å¯ä»¥ç»§ç»­ç¼–è¾‘è§†å›¾ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2lg3l7hpj30zd0u0q5e.jpg" alt="ä»£ç å’Œé¢„è§ˆæ•ˆæœçš„æˆªå›¾ï¼Œæ·»åŠ äº†MapView"></p><p><strong>Step 5.</strong> åœ¨ stack é‡Œæ·»åŠ ä¸€ä¸ª CircleImageã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2lh5tko1j30yp0u0tn8.jpg" alt="ä»£ç å’Œé¢„è§ˆæ•ˆæœçš„æˆªå›¾ï¼Œæ·»åŠ äº† CircleImage"></p><p><strong>Step 6.</strong> æˆ‘ä»¬è¦æŠŠå›¾ç‰‡è§†å›¾ç§»åˆ°åœ°å›¾è§†å›¾çš„ä¸Šå±‚ï¼šç»™å®ƒç«–ç›´åç§»(offset) -130 ç‚¹ï¼Œåº•éƒ¨å†…è¡¥(padding) -130 ç‚¹ã€‚</p><p>è¿™ä¸ªè°ƒæ•´é€šè¿‡æŠŠå›¾ç‰‡å‘ä¸Šç§»ï¼Œæ¥æä¾›ç»™æ–‡æœ¬æ›´å¤šç©ºé—´ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2lsxro6ej310t0u07ie.jpg" alt="ä»£ç å’Œé¢„è§ˆæ•ˆæœçš„æˆªå›¾ï¼Œç§»åŠ¨äº†åœ†å½¢å›¾ç‰‡"></p><p><strong>Step 7.</strong>  åœ¨æœ€å¤–å±‚çš„ VStack çš„åº•éƒ¨å¢åŠ ä¸€ä¸ª spacerï¼ŒæŠŠæˆ‘ä»¬çš„é‚£äº›å†…å®¹æ¨åˆ°å±å¹•é¡¶éƒ¨ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gg2lw903stj30za0u016z.jpg" alt="ä»£ç å’Œé¢„è§ˆæ•ˆæœçš„æˆªå›¾ï¼Œå¢åŠ æ¥ä¸€ä¸ª spacerï¼Œå†…å®¹å…¨åœ¨å±å¹•é¡¶éƒ¨æ¥äº†"></p><p><strong>Step 8.</strong> æœ€åä¸€æ­¥ï¼Œä¸ºäº†èƒ½è®©æˆ‘ä»¬çš„åœ°å›¾æ‹“å±•åˆ°å±å¹•é¡¶éƒ¨è¾¹ç¼˜ï¼ˆè¯´ç›´ç™½ç‚¹å°±æ˜¯ä¼¸åˆ°åˆ˜æµ·é‡ŒğŸ˜‚ï¼‰ï¼Œç»™åœ°å›¾è§†å›¾åŠ ä¸€ä¸ª <code>edgesIgnoringSafeArea(.top)</code> ä¿®é¥°ã€‚</p><hr><p>è¿™ä¸€èŠ‚é‡Œï¼Œæˆ‘ä»¬å®Œæˆçš„ä¸»è¦ä»£ç çœ‹ä¸Šå»æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">MapView</span>()</span><br><span class="line">                .edgesIgnoringSafeArea(.top)</span><br><span class="line">                .frame(height: <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">CircleImage</span>()</span><br><span class="line">                .offset(y: <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line">                .padding(.bottom, <span class="operator">-</span><span class="number">130</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">VStack</span>(alignment: .leading) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">&quot;Turtle Rock&quot;</span>)</span><br><span class="line">                    .font(.title)</span><br><span class="line">                <span class="type">HStack</span>(alignment: .top) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Joshua Tree National Park&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                    <span class="type">Spacer</span>()</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;California&quot;</span>)</span><br><span class="line">                        .font(.subheadline)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line"></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Learn to Make Apps with SwiftUI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SwiftUI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode è¯¾ç¨‹è¡¨ Iã€IIã€III</title>
      <link href="/2020/05/13/School/Leetcode-course-tab-I-II-III/"/>
      <url>/2020/05/13/School/Leetcode-course-tab-I-II-III/</url>
      
        <content type="html"><![CDATA[<h1 id="Leetcode-è¯¾ç¨‹è¡¨-Iã€IIã€III"><a href="#Leetcode-è¯¾ç¨‹è¡¨-Iã€IIã€III" class="headerlink" title="Leetcode è¯¾ç¨‹è¡¨ Iã€IIã€III"></a>Leetcode è¯¾ç¨‹è¡¨ Iã€IIã€III</h1><p>è¿™ç¯‡æ–‡ç« ä»‹ç» Leetcode çš„è¯¾ç¨‹è¡¨ Iã€IIã€III ä¸‰é“é¢˜ç›®çš„è§£æ³•ã€‚</p><p>[TOC]</p><p>æœ¬æ–‡ç”± CDFMLR åŸåˆ›ï¼Œæ”¶å½•äºä¸ªäººä¸»é¡µ <a href="https://clownote.github.io./">https://clownote.github.ioã€‚</a></p><h2 id="207-è¯¾ç¨‹è¡¨"><a href="#207-è¯¾ç¨‹è¡¨" class="headerlink" title="207. è¯¾ç¨‹è¡¨"></a><a href="https://leetcode-cn.com/problems/course-schedule/">207. è¯¾ç¨‹è¡¨</a></h2><h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>ä½ è¿™ä¸ªå­¦æœŸå¿…é¡»é€‰ä¿® numCourse é—¨è¯¾ç¨‹ï¼Œè®°ä¸º 0 åˆ° numCourse-1 ã€‚</p><p>åœ¨é€‰ä¿®æŸäº›è¯¾ç¨‹ä¹‹å‰éœ€è¦ä¸€äº›å…ˆä¿®è¯¾ç¨‹ã€‚ ä¾‹å¦‚ï¼Œæƒ³è¦å­¦ä¹ è¯¾ç¨‹ 0 ï¼Œä½ éœ€è¦å…ˆå®Œæˆè¯¾ç¨‹ 1 ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªåŒ¹é…æ¥è¡¨ç¤ºä»–ä»¬ï¼š[0,1]</p><p>ç»™å®šè¯¾ç¨‹æ€»é‡ä»¥åŠå®ƒä»¬çš„å…ˆå†³æ¡ä»¶ï¼Œè¯·ä½ åˆ¤æ–­æ˜¯å¦å¯èƒ½å®Œæˆæ‰€æœ‰è¯¾ç¨‹çš„å­¦ä¹ ï¼Ÿ</p><p>ç¤ºä¾‹ 1:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: 2, [[1,0]] </span><br><span class="line">è¾“å‡º: true</span><br><span class="line">è§£é‡Š: æ€»å…±æœ‰ 2 é—¨è¯¾ç¨‹ã€‚å­¦ä¹ è¯¾ç¨‹ 1 ä¹‹å‰ï¼Œä½ éœ€è¦å®Œæˆè¯¾ç¨‹ 0ã€‚æ‰€ä»¥è¿™æ˜¯å¯èƒ½çš„ã€‚</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 2:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: 2, [[1,0],[0,1]]</span><br><span class="line">è¾“å‡º: false</span><br><span class="line">è§£é‡Š: æ€»å…±æœ‰ 2 é—¨è¯¾ç¨‹ã€‚å­¦ä¹ è¯¾ç¨‹ 1 ä¹‹å‰ï¼Œä½ éœ€è¦å…ˆå®Œæˆè¯¾ç¨‹ 0ï¼›å¹¶ä¸”å­¦ä¹ è¯¾ç¨‹ 0 ä¹‹å‰ï¼Œä½ è¿˜åº”å…ˆå®Œæˆè¯¾ç¨‹ 1ã€‚è¿™æ˜¯ä¸å¯èƒ½çš„ã€‚</span><br></pre></td></tr></table></figure><p>æç¤ºï¼š</p><ol><li>è¾“å…¥çš„å…ˆå†³æ¡ä»¶æ˜¯ç”± <strong>è¾¹ç¼˜åˆ—è¡¨</strong> è¡¨ç¤ºçš„å›¾å½¢ï¼Œè€Œä¸æ˜¯ é‚»æ¥çŸ©é˜µ ã€‚è¯¦æƒ…è¯·å‚è§<a href="http://blog.csdn.net/woaidapaopao/article/details/51732947">å›¾çš„è¡¨ç¤ºæ³•</a>ã€‚</li><li>ä½ å¯ä»¥å‡å®šè¾“å…¥çš„å…ˆå†³æ¡ä»¶ä¸­æ²¡æœ‰é‡å¤çš„è¾¹ã€‚</li><li><code>1 &lt;= numCourses &lt;= 10^5</code></li></ol><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/course-schedule">https://leetcode-cn.com/problems/course-schedule</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p><h3 id="DFS"><a href="#DFS" class="headerlink" title="DFS"></a>DFS</h3><p>è¿™ä¸ªä¸œè¥¿è¦å¯ä»¥å­¦å°±æ˜¯è¦å›¾é‡Œæ²¡æœ‰ç¯ã€‚æœ‰ç¯å°±â€œå¾ªç¯ä¾èµ–â€ï¼Œæ²¡æ³•å­¦äº†ã€‚æ‰€ä»¥è§£æ³•å°±æ˜¯æ·±åº¦ä¼˜å…ˆå»æœç´¢æœ‰æ²¡æœ‰ç¯ï¼Œæœ‰å°±ä¸è¡Œï¼Œæ²¡æœ‰å°±è¡Œã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">canFinish</span><span class="params">(numCourses <span class="keyword">int</span>, prerequisites [][]<span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    adj := <span class="built_in">make</span>([][]<span class="keyword">int</span>, numCourses)</span><br><span class="line">    <span class="keyword">for</span> _, p := <span class="keyword">range</span> prerequisites &#123;</span><br><span class="line">        adj[p[<span class="number">1</span>]] = <span class="built_in">append</span>(adj[p[<span class="number">1</span>]], p[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; numCourses; i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> hasCycle(i, adj, <span class="built_in">make</span>([]<span class="keyword">bool</span>, numCourses)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hasCycle</span><span class="params">(node <span class="keyword">int</span>, adj [][]<span class="keyword">int</span>, visited []<span class="keyword">bool</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    visited[node] = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">for</span> _, a := <span class="keyword">range</span> adj[node] &#123;</span><br><span class="line">        <span class="keyword">if</span> visited[a] || hasCycle(a, adj, visited) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    visited[node] = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gepo6jel4dj30qe05ymxv.jpg" alt="æ‰§è¡Œé€šè¿‡çš„æˆªå›¾ï¼Œå›¾ç‰‡ä¸Šæ˜¾ç¤ºæ‰§è¡Œç”¨æ—¶44msåœ¨æ‰€æœ‰ Go æäº¤ä¸­å‡»è´¥äº†14.12%çš„ç”¨æˆ·ï¼Œå†…å­˜æ¶ˆè€—6.7MBåœ¨æ‰€æœ‰ Go æäº¤ä¸­å‡»è´¥äº†100%çš„ç”¨æˆ·"></p><h2 id="210-è¯¾ç¨‹è¡¨-II"><a href="#210-è¯¾ç¨‹è¡¨-II" class="headerlink" title="210. è¯¾ç¨‹è¡¨ II"></a><a href="https://leetcode-cn.com/problems/course-schedule-ii/">210. è¯¾ç¨‹è¡¨ II</a></h2><h3 id="é¢˜ç›®-1"><a href="#é¢˜ç›®-1" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>ç°åœ¨ä½ æ€»å…±æœ‰ n é—¨è¯¾éœ€è¦é€‰ï¼Œè®°ä¸º 0 åˆ° n-1ã€‚</p><p>åœ¨é€‰ä¿®æŸäº›è¯¾ç¨‹ä¹‹å‰éœ€è¦ä¸€äº›å…ˆä¿®è¯¾ç¨‹ã€‚ ä¾‹å¦‚ï¼Œæƒ³è¦å­¦ä¹ è¯¾ç¨‹ 0 ï¼Œä½ éœ€è¦å…ˆå®Œæˆè¯¾ç¨‹ 1 ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªåŒ¹é…æ¥è¡¨ç¤ºä»–ä»¬: [0,1]</p><p>ç»™å®šè¯¾ç¨‹æ€»é‡ä»¥åŠå®ƒä»¬çš„å…ˆå†³æ¡ä»¶ï¼Œè¿”å›ä½ ä¸ºäº†å­¦å®Œæ‰€æœ‰è¯¾ç¨‹æ‰€å®‰æ’çš„å­¦ä¹ é¡ºåºã€‚</p><p>å¯èƒ½ä¼šæœ‰å¤šä¸ªæ­£ç¡®çš„é¡ºåºï¼Œä½ åªè¦è¿”å›ä¸€ç§å°±å¯ä»¥äº†ã€‚å¦‚æœä¸å¯èƒ½å®Œæˆæ‰€æœ‰è¯¾ç¨‹ï¼Œè¿”å›ä¸€ä¸ªç©ºæ•°ç»„ã€‚</p><p>ç¤ºä¾‹ 1:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: 2, [[1,0]] </span><br><span class="line">è¾“å‡º: [0,1]</span><br><span class="line">è§£é‡Š: æ€»å…±æœ‰ 2 é—¨è¯¾ç¨‹ã€‚è¦å­¦ä¹ è¯¾ç¨‹ 1ï¼Œä½ éœ€è¦å…ˆå®Œæˆè¯¾ç¨‹ 0ã€‚å› æ­¤ï¼Œæ­£ç¡®çš„è¯¾ç¨‹é¡ºåºä¸º [0,1] ã€‚</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 2:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: 4, [[1,0],[2,0],[3,1],[3,2]]</span><br><span class="line">è¾“å‡º: [0,1,2,3] or [0,2,1,3]</span><br><span class="line">è§£é‡Š: æ€»å…±æœ‰ 4 é—¨è¯¾ç¨‹ã€‚è¦å­¦ä¹ è¯¾ç¨‹ 3ï¼Œä½ åº”è¯¥å…ˆå®Œæˆè¯¾ç¨‹ 1 å’Œè¯¾ç¨‹ 2ã€‚å¹¶ä¸”è¯¾ç¨‹ 1 å’Œè¯¾ç¨‹ 2 éƒ½åº”è¯¥æ’åœ¨è¯¾ç¨‹ 0 ä¹‹åã€‚</span><br><span class="line">     å› æ­¤ï¼Œä¸€ä¸ªæ­£ç¡®çš„è¯¾ç¨‹é¡ºåºæ˜¯ [0,1,2,3] ã€‚å¦ä¸€ä¸ªæ­£ç¡®çš„æ’åºæ˜¯ [0,2,1,3] ã€‚</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜</strong>:</p><p>è¾“å…¥çš„å…ˆå†³æ¡ä»¶æ˜¯ç”±è¾¹ç¼˜åˆ—è¡¨è¡¨ç¤ºçš„å›¾å½¢ï¼Œè€Œä¸æ˜¯é‚»æ¥çŸ©é˜µã€‚è¯¦æƒ…è¯·å‚è§å›¾çš„è¡¨ç¤ºæ³•ã€‚<br>ä½ å¯ä»¥å‡å®šè¾“å…¥çš„å…ˆå†³æ¡ä»¶ä¸­æ²¡æœ‰é‡å¤çš„è¾¹ã€‚</p><p><strong>æç¤º</strong>:</p><ol><li>è¿™ä¸ªé—®é¢˜ç›¸å½“äºæŸ¥æ‰¾ä¸€ä¸ªå¾ªç¯æ˜¯å¦å­˜åœ¨äºæœ‰å‘å›¾ä¸­ã€‚å¦‚æœå­˜åœ¨å¾ªç¯ï¼Œåˆ™ä¸å­˜åœ¨æ‹“æ‰‘æ’åºï¼Œå› æ­¤ä¸å¯èƒ½é€‰å–æ‰€æœ‰è¯¾ç¨‹è¿›è¡Œå­¦ä¹ ã€‚</li><li>é€šè¿‡ DFS è¿›è¡Œæ‹“æ‰‘æ’åº - ä¸€ä¸ªå…³äºCourseraçš„ç²¾å½©è§†é¢‘æ•™ç¨‹ï¼ˆ21åˆ†é’Ÿï¼‰ï¼Œä»‹ç»æ‹“æ‰‘æ’åºçš„åŸºæœ¬æ¦‚å¿µã€‚</li><li>æ‹“æ‰‘æ’åºä¹Ÿå¯ä»¥é€šè¿‡ BFS å®Œæˆã€‚</li></ol><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/course-schedule-ii">https://leetcode-cn.com/problems/course-schedule-ii</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p><h3 id="æ‹“æ‰‘æ’åº"><a href="#æ‹“æ‰‘æ’åº" class="headerlink" title="æ‹“æ‰‘æ’åº"></a>æ‹“æ‰‘æ’åº</h3><p>è¿™ä¸ªé¢˜å°±æ˜¯åšæ‹“æ‰‘æ’åºï¼Œä½†æ‹“æ‰‘æ’åºåªèƒ½ç”¨äº DAG (æœ‰å‘æ— ç¯å›¾) ï¼æ‰€ä»¥æˆ‘ä»¬ç›´æ¥æŠŠä¸Šé¢é‚£ä¸ªé¢˜ç›®çš„ hasCycle æŠ„è¿‡æ¥åˆ¤æ–­æ˜¯å¦æœ‰ç¯ï¼Œæœ‰ç¯å°±è¿”å›ä¸€ä¸ªç©ºåºåˆ—å°±å¥½äº†ï¼Œæ²¡ç¯å°±æ‹¿å»æ‹“æ‰‘æ’åºã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findOrder</span><span class="params">(numCourses <span class="keyword">int</span>, prerequisites [][]<span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">    adj := <span class="built_in">make</span>([][]<span class="keyword">int</span>, numCourses)</span><br><span class="line">    <span class="keyword">for</span> _, p := <span class="keyword">range</span> prerequisites &#123;</span><br><span class="line">        adj[p[<span class="number">1</span>]] = <span class="built_in">append</span>(adj[p[<span class="number">1</span>]], p[<span class="number">0</span>])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    visited :=  <span class="built_in">make</span>([]<span class="keyword">bool</span>, numCourses)</span><br><span class="line">    ret := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; numCourses; i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> hasCycle(i, adj, <span class="built_in">make</span>([]<span class="keyword">bool</span>, numCourses)) &#123;</span><br><span class="line">            <span class="keyword">return</span> []<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        dfsForTopoSort(i, adj, visited, &amp;ret)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(ret) &lt; numCourses &#123;</span><br><span class="line">        <span class="keyword">return</span> []<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    reverse(ret)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hasCycle</span><span class="params">(node <span class="keyword">int</span>, adj [][]<span class="keyword">int</span>, visited []<span class="keyword">bool</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    visited[node] = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">for</span> _, a := <span class="keyword">range</span> adj[node] &#123;</span><br><span class="line">        <span class="keyword">if</span> visited[a] || hasCycle(a, adj, visited) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    visited[node] = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dfsForTopoSort</span><span class="params">(node <span class="keyword">int</span>, adj [][]<span class="keyword">int</span>, visited []<span class="keyword">bool</span>, ret *[]<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> !visited[node] &#123;</span><br><span class="line">        visited[node] = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> _, a := <span class="keyword">range</span> adj[node] &#123;</span><br><span class="line">            <span class="keyword">if</span> !visited[a] &#123;</span><br><span class="line">                dfsForTopoSort(a, adj, visited, ret)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        *ret = <span class="built_in">append</span>(*ret, node)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverse</span><span class="params">(a []<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> left, right := <span class="number">0</span>, <span class="built_in">len</span>(a)<span class="number">-1</span>; left &lt; right; left, right = left+<span class="number">1</span>, right<span class="number">-1</span> &#123;</span><br><span class="line">        a[left], a[right] = a[right], a[left]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ï¼Œä½†åˆ¤æ–­ç¯ + æ‹“æ‰‘æ’åºè·‘äº†ä¸¤éå˜›ï¼Œæœ€åè¿˜åšäº†ä¸€ä¸ªåˆ‡ç‰‡ç¿»è½¬ï¼Œæ‰€ä»¥æ¯”è¾ƒæ…¢ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1geproy8i5cj30o805maar.jpg" alt="Leetcode æ‰§è¡Œç»“æœæˆªå›¾ï¼Œæ‰§è¡Œç”¨æ—¶ 40 ms, åœ¨æ‰€æœ‰ Go æäº¤ä¸­å‡»è´¥äº†11.81%çš„ç”¨æˆ·; å†…å­˜æ¶ˆè€— 6.8 MB, åœ¨æ‰€æœ‰ Go æäº¤ä¸­å‡»è´¥äº†100.00%çš„ç”¨æˆ·"></p><h2 id="630-è¯¾ç¨‹è¡¨-III"><a href="#630-è¯¾ç¨‹è¡¨-III" class="headerlink" title="630. è¯¾ç¨‹è¡¨ III"></a><a href="https://leetcode-cn.com/problems/course-schedule-iii/">630. è¯¾ç¨‹è¡¨ III</a></h2><h3 id="é¢˜ç›®-2"><a href="#é¢˜ç›®-2" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>è¿™é‡Œæœ‰ n é—¨ä¸åŒçš„åœ¨çº¿è¯¾ç¨‹ï¼Œä»–ä»¬æŒ‰ä» 1 åˆ° n ç¼–å·ã€‚æ¯ä¸€é—¨è¯¾ç¨‹æœ‰ä¸€å®šçš„æŒç»­ä¸Šè¯¾æ—¶é—´ï¼ˆè¯¾ç¨‹æ—¶é—´ï¼‰t ä»¥åŠå…³é—­æ—¶é—´ç¬¬ d å¤©ã€‚ä¸€é—¨è¯¾è¦æŒç»­å­¦ä¹  t å¤©ç›´åˆ°ç¬¬ d å¤©æ—¶è¦å®Œæˆï¼Œä½ å°†ä¼šä»ç¬¬ 1 å¤©å¼€å§‹ã€‚</p><p>ç»™å‡º n ä¸ªåœ¨çº¿è¯¾ç¨‹ç”¨ (t, d) å¯¹è¡¨ç¤ºã€‚ä½ çš„ä»»åŠ¡æ˜¯æ‰¾å‡ºæœ€å¤šå¯ä»¥ä¿®å‡ é—¨è¯¾ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: [[100, 200], [200, 1300], [1000, 1250], [2000, 3200]]</span><br><span class="line">è¾“å‡º: 3</span><br><span class="line">è§£é‡Š: </span><br><span class="line">è¿™é‡Œä¸€å…±æœ‰ 4 é—¨è¯¾ç¨‹, ä½†æ˜¯ä½ æœ€å¤šå¯ä»¥ä¿® 3 é—¨:</span><br><span class="line">é¦–å…ˆ, ä¿®ç¬¬ä¸€é—¨è¯¾æ—¶, å®ƒè¦è€—è´¹ 100 å¤©ï¼Œä½ ä¼šåœ¨ç¬¬ 100 å¤©å®Œæˆ, åœ¨ç¬¬ 101 å¤©å‡†å¤‡ä¸‹é—¨è¯¾ã€‚</span><br><span class="line">ç¬¬äºŒ, ä¿®ç¬¬ä¸‰é—¨è¯¾æ—¶, å®ƒä¼šè€—è´¹ 1000 å¤©ï¼Œæ‰€ä»¥ä½ å°†åœ¨ç¬¬ 1100 å¤©çš„æ—¶å€™å®Œæˆå®ƒ, ä»¥åŠåœ¨ç¬¬ 1101 å¤©å¼€å§‹å‡†å¤‡ä¸‹é—¨è¯¾ç¨‹ã€‚</span><br><span class="line">ç¬¬ä¸‰, ä¿®ç¬¬äºŒé—¨è¯¾æ—¶, å®ƒä¼šè€—æ—¶ 200 å¤©ï¼Œæ‰€ä»¥ä½ å°†ä¼šåœ¨ç¬¬ 1300 å¤©æ—¶å®Œæˆå®ƒã€‚</span><br><span class="line">ç¬¬å››é—¨è¯¾ç°åœ¨ä¸èƒ½ä¿®ï¼Œå› ä¸ºä½ å°†ä¼šåœ¨ç¬¬ 3300 å¤©å®Œæˆå®ƒï¼Œè¿™å·²ç»è¶…å‡ºäº†å…³é—­æ—¥æœŸã€‚</span><br></pre></td></tr></table></figure><p>æç¤º:</p><ol><li>æ•´æ•° 1 &lt;= d, t, n &lt;= 10,000 ã€‚</li><li>ä½ ä¸èƒ½åŒæ—¶ä¿®ä¸¤é—¨è¯¾ç¨‹ã€‚</li></ol><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/course-schedule-iii">https://leetcode-cn.com/problems/course-schedule-iii</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p><h3 id="è´ªå¿ƒä¼˜å…ˆé˜Ÿåˆ—"><a href="#è´ªå¿ƒä¼˜å…ˆé˜Ÿåˆ—" class="headerlink" title="è´ªå¿ƒä¼˜å…ˆé˜Ÿåˆ—"></a>è´ªå¿ƒä¼˜å…ˆé˜Ÿåˆ—</h3><p>å“‡ï¼Œè¿™ä¸ªé¢˜çš„è´ªå¿ƒç­–ç•¥è¿˜æ˜¯å¾ˆ6âƒ£ï¸çš„ï¼Œæ€è·¯å†™èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œ<a href="https://leetcode-cn.com/problems/course-schedule-iii/solution/ke-cheng-biao-iii-by-leetcode/">å®˜æ–¹é¢˜è§£</a> å†™çš„å¾ˆå¥½äº†ï¼Œç›´æ¥ç…§ç€å®ƒé‚£ä¸ªï¼Œå…¶å®åŸºæœ¬çš„ä»£ç å¾ˆç®€å•çš„ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼ªä»£ç </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">scheduleCourse</span><span class="params">(courses [][]<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">sort(&amp;courses)</span><br><span class="line"></span><br><span class="line">queue := PriorityQueue&#123;&#125;</span><br><span class="line">time := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> _, c := <span class="keyword">range</span> courses &#123;</span><br><span class="line"><span class="keyword">if</span> time + c[<span class="number">0</span>] &lt;= c[<span class="number">1</span>] &#123;</span><br><span class="line">queue.Push(c[<span class="number">0</span>])</span><br><span class="line">time += c[<span class="number">0</span>]</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> !queue.IsEmpty() &amp;&amp; queue.Top() &gt; c[<span class="number">0</span>] &#123;</span><br><span class="line">time += c[<span class="number">0</span>] - queue.Poll()</span><br><span class="line">queue.Push(c[<span class="number">0</span>])</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> queue.Size()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é—®é¢˜æ˜¯ï¼Œè¿™é‡Œé¢éœ€è¦ sort å’Œ PriorityQueueã€‚Pythonã€Javaã€ç”šè‡³ C++ å†™è¿™ä¸ªéƒ½è¿˜æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„ï¼Œç›´æ¥ç”¨æ ‡å‡†åº“é‡Œçš„å®ç°ã€‚ä½† Golangï¼Œï¼Œï¼Œæ ‡å‡†åº“çš„è¿™ä¸¤ä¸ªä¸œè¥¿æœ‰ç‚¹è¯¡å¼‚ï¼Œç”¨èµ·æ¥æ²¡é‚£ä¹ˆæ–¹ä¾¿ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å…ˆè¯•è¯•è‡ªå·±å®ç°<strong>æ’åº</strong>å’Œ<strong>ä¼˜å…ˆé˜Ÿåˆ—</strong>ï¼Œç»ƒä¹ ä¸€ä¸‹ï¼Œä¹Ÿå½“æ˜¯è¿½å¿†ä»¥å‰å†™ C æ—¶é‚£ç§å•¥éƒ½è‡ªå·±å†™çš„æ—¶å…‰ã€‚</p><h4 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h4><p>ä¼˜å…ˆé˜Ÿåˆ—ä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨å †å»å®ç°ï¼Œä½†è¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ç›´æ¥ç»´æŠ¤ä¸€ä¸ªåˆ‡ç‰‡ï¼Œæ¯æ¬¡æ’å…¥å…ƒç´ çš„æ—¶å€™æ’ä¸ªåºä¹Ÿå°±â€œä¼˜å…ˆé˜Ÿåˆ—â€äº†ã€‚</p><p>æˆ‘ä»¬å…ˆå†™ä¸€ä¸ªå¿«é€Ÿæ’åºï¼Œè®© courses çš„æ’åºå’Œä¼˜å…ˆé˜Ÿåˆ—éƒ½åŸºäºè¿™ä¸ªå¿«æ’ã€‚</p><p>ç”±äº courses æ˜¯ <code>[][]int</code>ï¼Œä¼˜å…ˆé˜Ÿåˆ—æ˜¯ <code>[]int</code>ï¼Œæˆ‘ä»¬å†™ä¸€ç§é€šç”¨çš„â€”â€”å¯¹ <code>[]interface&#123;&#125;</code> çš„å¿«æ’ï¼Œè¿™ä¸ªä»£ç è¿˜æ˜¯å¾ˆä¼ ç»Ÿçš„ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">quick_sort</span><span class="params">(pA *([]<span class="keyword">interface</span>&#123;&#125;)</span>, <span class="title">p</span> <span class="title">int</span>, <span class="title">r</span> <span class="title">int</span>, <span class="title">le</span> <span class="title">func</span><span class="params">(a, b <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">bool</span>)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> p &gt;= r &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">q := partition(pA, p, r, le)</span><br><span class="line">quick_sort(pA, p, q<span class="number">-1</span>, le)</span><br><span class="line">quick_sort(pA, q+<span class="number">1</span>, r, le)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">partition</span><span class="params">(pA *([]<span class="keyword">interface</span>&#123;&#125;)</span>, <span class="title">p</span> <span class="title">int</span>, <span class="title">r</span> <span class="title">int</span>, <span class="title">le</span> <span class="title">func</span><span class="params">(a, b <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">bool</span>) <span class="title">int</span></span> &#123;</span><br><span class="line">A := (*pA)</span><br><span class="line"></span><br><span class="line">q := p</span><br><span class="line"><span class="keyword">for</span> u := p; u &lt; r; u++ &#123;</span><br><span class="line"><span class="keyword">if</span> le(A[u], A[r]) &#123;</span><br><span class="line">A[q], A[u] = A[u], A[q]</span><br><span class="line">q++</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">A[q], A[r] = A[r], A[q]</span><br><span class="line"><span class="keyword">return</span> q</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠå®ƒå°è£…ä¸€å±‚ï¼Œåˆ†åˆ«æä¾›<code>[][]int</code>ã€<code>[]int</code> çš„æ’åºæ¥å£ï¼Œå…¶å®è¿™ä¸¤ä¸ªä»£ç åŸºæœ¬æ˜¯ä¸€æ ·çš„ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">quick_sort_sint</span><span class="params">(pA *([]<span class="keyword">int</span>)</span>, <span class="title">p</span> <span class="title">int</span>, <span class="title">r</span> <span class="title">int</span>, <span class="title">le</span> <span class="title">func</span><span class="params">(a, b <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">bool</span>)</span> &#123;</span><br><span class="line"><span class="keyword">var</span> interfaceSlice []<span class="keyword">interface</span>&#123;&#125; = <span class="built_in">make</span>([]<span class="keyword">interface</span>&#123;&#125;, <span class="built_in">len</span>(*pA))</span><br><span class="line"><span class="keyword">for</span> i, d := <span class="keyword">range</span> *pA &#123;</span><br><span class="line">interfaceSlice[i] = d</span><br><span class="line">&#125;</span><br><span class="line">quick_sort(&amp;interfaceSlice, p, r, le)</span><br><span class="line"><span class="keyword">for</span> i, v := <span class="keyword">range</span> interfaceSlice &#123;</span><br><span class="line">(*pA)[i] = v.(<span class="keyword">int</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">quick_sort_ssint</span><span class="params">(pA *([][]<span class="keyword">int</span>)</span>, <span class="title">p</span> <span class="title">int</span>, <span class="title">r</span> <span class="title">int</span>, <span class="title">le</span> <span class="title">func</span><span class="params">(a, b <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">bool</span>)</span> &#123;</span><br><span class="line"><span class="keyword">var</span> interfaceSlice []<span class="keyword">interface</span>&#123;&#125; = <span class="built_in">make</span>([]<span class="keyword">interface</span>&#123;&#125;, <span class="built_in">len</span>(*pA))</span><br><span class="line"><span class="keyword">for</span> i, d := <span class="keyword">range</span> *pA &#123;</span><br><span class="line">interfaceSlice[i] = d</span><br><span class="line">&#125;</span><br><span class="line">quick_sort(&amp;interfaceSlice, p, r, le)</span><br><span class="line"><span class="keyword">for</span> i, v := <span class="keyword">range</span> interfaceSlice &#123;</span><br><span class="line">(*pA)[i] = v.([]<span class="keyword">int</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†™å¥½äº†æ’åºï¼Œå†çœ‹ä¼˜å…ˆé˜Ÿåˆ—ï¼Œå®ç°åŸºæœ¬çš„å…¥ã€å‡ºã€é¡¶ã€å¤§å°ã€ç©ºåˆ¤æ–­å°±å¥½ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> PriorityQueue <span class="keyword">struct</span> &#123;</span><br><span class="line">data []<span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *PriorityQueue)</span> <span class="title">top</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> q.data[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *PriorityQueue)</span> <span class="title">push</span><span class="params">(element <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">q.data = <span class="built_in">append</span>(q.data, element)</span><br><span class="line">quick_sort_sint(&amp;q.data, <span class="number">0</span>, <span class="built_in">len</span>(q.data)<span class="number">-1</span>, <span class="function"><span class="keyword">func</span> <span class="params">(a, b <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> b.(<span class="keyword">int</span>) &lt;= a.(<span class="keyword">int</span>)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *PriorityQueue)</span> <span class="title">poll</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">r := q.data[<span class="number">0</span>]</span><br><span class="line">q.data = q.data[<span class="number">1</span>:]</span><br><span class="line"><span class="keyword">return</span> r</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *PriorityQueue)</span> <span class="title">isEmpty</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">len</span>(q.data) == <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *PriorityQueue)</span> <span class="title">size</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">len</span>(q.data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆåˆ°ä¸€èµ·ï¼Œå°±æœ‰è§£äº†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">scheduleCourse</span><span class="params">(courses [][]<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">quick_sort_ssint(&amp;courses, <span class="number">0</span>, <span class="built_in">len</span>(courses)<span class="number">-1</span>,</span><br><span class="line"><span class="function"><span class="keyword">func</span><span class="params">(a, b <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> a.([]<span class="keyword">int</span>)[<span class="number">1</span>] &lt;= b.([]<span class="keyword">int</span>)[<span class="number">1</span>]</span><br><span class="line">&#125;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">queue := PriorityQueue&#123;&#125;</span><br><span class="line">time := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> _, c := <span class="keyword">range</span> courses &#123;</span><br><span class="line"><span class="keyword">if</span> time + c[<span class="number">0</span>] &lt;= c[<span class="number">1</span>] &#123;</span><br><span class="line">queue.push(c[<span class="number">0</span>])</span><br><span class="line">time += c[<span class="number">0</span>]</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> !queue.isEmpty() &amp;&amp; queue.top() &gt; c[<span class="number">0</span>] &#123;</span><br><span class="line">time += c[<span class="number">0</span>] - queue.poll()</span><br><span class="line">queue.push(c[<span class="number">0</span>])</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> queue.size()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** ä¼˜å…ˆé˜Ÿåˆ— **/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> PriorityQueue <span class="keyword">struct</span> &#123;</span><br><span class="line">data []<span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *PriorityQueue)</span> <span class="title">top</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> q.data[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *PriorityQueue)</span> <span class="title">push</span><span class="params">(element <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">q.data = <span class="built_in">append</span>(q.data, element)</span><br><span class="line">quick_sort_sint(&amp;q.data, <span class="number">0</span>, <span class="built_in">len</span>(q.data)<span class="number">-1</span>, <span class="function"><span class="keyword">func</span> <span class="params">(a, b <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> b.(<span class="keyword">int</span>) &lt;= a.(<span class="keyword">int</span>)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *PriorityQueue)</span> <span class="title">poll</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">r := q.data[<span class="number">0</span>]</span><br><span class="line">q.data = q.data[<span class="number">1</span>:]</span><br><span class="line"><span class="keyword">return</span> r</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *PriorityQueue)</span> <span class="title">isEmpty</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">len</span>(q.data) == <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *PriorityQueue)</span> <span class="title">size</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">len</span>(q.data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** æŠŠå¯¹ []int çš„å¿«æ’è½¬åŒ–ä¸ºå¯¹ []interface&#123;&#125; çš„å¿«æ’  **/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">quick_sort_sint</span><span class="params">(pA *([]<span class="keyword">int</span>)</span>, <span class="title">p</span> <span class="title">int</span>, <span class="title">r</span> <span class="title">int</span>, <span class="title">le</span> <span class="title">func</span><span class="params">(a, b <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">bool</span>)</span> &#123;</span><br><span class="line"><span class="keyword">var</span> interfaceSlice []<span class="keyword">interface</span>&#123;&#125; = <span class="built_in">make</span>([]<span class="keyword">interface</span>&#123;&#125;, <span class="built_in">len</span>(*pA))</span><br><span class="line"><span class="keyword">for</span> i, d := <span class="keyword">range</span> *pA &#123;</span><br><span class="line">interfaceSlice[i] = d</span><br><span class="line">&#125;</span><br><span class="line">quick_sort(&amp;interfaceSlice, p, r, le)</span><br><span class="line"><span class="keyword">for</span> i, v := <span class="keyword">range</span> interfaceSlice &#123;</span><br><span class="line">(*pA)[i] = v.(<span class="keyword">int</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** æŠŠå¯¹ [][]int çš„å¿«æ’è½¬åŒ–ä¸ºå¯¹ []interface&#123;&#125; çš„å¿«æ’  **/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">quick_sort_ssint</span><span class="params">(pA *([][]<span class="keyword">int</span>)</span>, <span class="title">p</span> <span class="title">int</span>, <span class="title">r</span> <span class="title">int</span>, <span class="title">le</span> <span class="title">func</span><span class="params">(a, b <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">bool</span>)</span> &#123;</span><br><span class="line"><span class="keyword">var</span> interfaceSlice []<span class="keyword">interface</span>&#123;&#125; = <span class="built_in">make</span>([]<span class="keyword">interface</span>&#123;&#125;, <span class="built_in">len</span>(*pA))</span><br><span class="line"><span class="keyword">for</span> i, d := <span class="keyword">range</span> *pA &#123;</span><br><span class="line">interfaceSlice[i] = d</span><br><span class="line">&#125;</span><br><span class="line">quick_sort(&amp;interfaceSlice, p, r, le)</span><br><span class="line"><span class="keyword">for</span> i, v := <span class="keyword">range</span> interfaceSlice &#123;</span><br><span class="line">(*pA)[i] = v.([]<span class="keyword">int</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** å¯¹ []interface&#123;&#125; çš„å¿«æ’  **/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">quick_sort</span><span class="params">(pA *([]<span class="keyword">interface</span>&#123;&#125;)</span>, <span class="title">p</span> <span class="title">int</span>, <span class="title">r</span> <span class="title">int</span>, <span class="title">le</span> <span class="title">func</span><span class="params">(a, b <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">bool</span>)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> p &gt;= r &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">q := partition(pA, p, r, le)</span><br><span class="line">quick_sort(pA, p, q<span class="number">-1</span>, le)</span><br><span class="line">quick_sort(pA, q+<span class="number">1</span>, r, le)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">partition</span><span class="params">(pA *([]<span class="keyword">interface</span>&#123;&#125;)</span>, <span class="title">p</span> <span class="title">int</span>, <span class="title">r</span> <span class="title">int</span>, <span class="title">le</span> <span class="title">func</span><span class="params">(a, b <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">bool</span>) <span class="title">int</span></span> &#123;</span><br><span class="line">A := (*pA)</span><br><span class="line"></span><br><span class="line">q := p</span><br><span class="line"><span class="keyword">for</span> u := p; u &lt; r; u++ &#123;</span><br><span class="line"><span class="keyword">if</span> le(A[u], A[r]) &#123;</span><br><span class="line">A[q], A[u] = A[u], A[q]</span><br><span class="line">q++</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">A[q], A[r] = A[r], A[q]</span><br><span class="line"><span class="keyword">return</span> q</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç‰ˆæœ¬ç®—æ³•æ˜¯æ­£ç¡®çš„ï¼Œä½†æäº¤è¿è¡Œä¼šè¶…æ—¶ï¼</p><p><code>clown0teï¼ˆé˜²&#123;ç›—[æ–‡()çˆ¬]è™«&#125;çš„è¿½è¸ªæ ‡ç­¾ï¼Œè¯»è€…ä¸å¿…åœ¨æ„ï¼‰</code></p><h4 id="æ’å…¥æ’åº-å½’å¹¶æ’åº"><a href="#æ’å…¥æ’åº-å½’å¹¶æ’åº" class="headerlink" title="æ’å…¥æ’åº + å½’å¹¶æ’åº"></a>æ’å…¥æ’åº + å½’å¹¶æ’åº</h4><p>æˆ‘ä»¬çš„ç¨‹åºé‡Œå¤§é‡çš„æ’åºï¼Œè¿™ä¸ªä¹Ÿæ˜¯æœ€ä¸»è¦çš„æ—¶é—´æ¶ˆè€—ï¼Œè€Œåˆšæ‰ç®€å•ç²—æš´çš„å…¨ç”¨äº†å¿«æ’ï¼Œè¿™è‚¯å®šä¸æ˜¯æœ€å¥½çš„ï¼Œè€ƒè™‘åœ¨è¿™æ–¹é¢ä¼˜åŒ–ä¸€ä¸‹ï¼š</p><ol><li><code>PriorityQueue.Push</code> æ•°æ®åŸºæœ¬æœ‰åºï¼Œå¯¹åŸºæœ¬æœ‰åºçš„æ•°æ®ç”¨å¿«æ’è‚¯å®šæ…¢ï¼ˆæ‰€ä»¥æˆ‘ä»¬æœ‰æ—¶å€™ç”¨å¿«æ’è¦å…ˆæŠŠæ•°æ®æ‰“ä¹±ï¼‰ï¼Œæˆ‘ä»¬æŠŠè¿™é‡Œæ”¹æˆå¯¹åŸºæœ¬æœ‰åºçš„æ•°æ®æœ€å¿«çš„â€”â€”æ’å…¥æ’åºã€‚</li><li><code>courses</code> çš„æ’åºï¼Œæ—¢ç„¶ä¸éœ€è¦é‡å¤ä½¿ç”¨å¿«æ’æˆ‘ä»¬å°±å¯ä»¥æŠŠä¹‹å‰çš„ <code>interface&#123;&#125;</code> å°è£…å»æ‰ï¼Œç›´æ¥å®ç°ä¸€ä¸ªå¯¹ <code>[][]int</code> çš„æ’åºï¼ˆæˆ‘è¿˜æŠŠå¿«æ’æ”¹æˆäº†å½’å¹¶æ’åºï¼Œåªæ˜¯ä¸ºäº†å¥½ç©ï¼‰</li></ol><p>å…ˆå†™æœ€ç®€å•çš„æ’å…¥æ’åºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">insertSortReverse</span><span class="params">(pA *[]<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">A := *pA</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="built_in">len</span>(A); i++ &#123;</span><br><span class="line">key := A[i]</span><br><span class="line">j := i - <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> j &gt;= <span class="number">0</span> &amp;&amp; A[j] &lt; key &#123;</span><br><span class="line">A[j+<span class="number">1</span>] = A[j]</span><br><span class="line">j -= <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">A[j+<span class="number">1</span>] = key</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œå½’å¹¶æ’åºï¼Œè¿™ä¸ªä»£ç ä¹Ÿä¸æ˜¯å¾ˆéš¾ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> INF = []<span class="keyword">int</span>&#123;<span class="number">99999999</span>, <span class="number">99999999</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">merge</span><span class="params">(pA *[][]<span class="keyword">int</span>, p, q, r <span class="keyword">int</span>, le <span class="keyword">func</span> (a, b []<span class="keyword">int</span>)</span> <span class="title">bool</span>)</span> &#123;</span><br><span class="line"><span class="comment">// n1 := q - p + 1</span></span><br><span class="line"><span class="comment">// n2 := r - q</span></span><br><span class="line"><span class="comment">// b, c := make([][]int, n1+1), make([][]int, n2+1)</span></span><br><span class="line">A := *pA</span><br><span class="line"></span><br><span class="line">b := <span class="built_in">append</span>(<span class="built_in">make</span>([][]<span class="keyword">int</span>, <span class="number">0</span>), A[p: q+<span class="number">1</span>]...)</span><br><span class="line">c := <span class="built_in">append</span>(<span class="built_in">make</span>([][]<span class="keyword">int</span>, <span class="number">0</span>), A[q+<span class="number">1</span>: r+<span class="number">1</span>]...)</span><br><span class="line"></span><br><span class="line">b = <span class="built_in">append</span>(b, INF)</span><br><span class="line">c = <span class="built_in">append</span>(c, INF)</span><br><span class="line">i, j := <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> k := p; k &lt;= r; k++ &#123;</span><br><span class="line"><span class="keyword">if</span> le(b[i], c[j]) &#123;</span><br><span class="line">A[k] = b[i]</span><br><span class="line">i++</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">A[k] = c[j]</span><br><span class="line">j++</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mergeSort</span><span class="params">(pA *[][]<span class="keyword">int</span>, p <span class="keyword">int</span>, r <span class="keyword">int</span>, le <span class="keyword">func</span> (a, b []<span class="keyword">int</span>)</span> <span class="title">bool</span>)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> p &gt;= r &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">q := (p + r) / <span class="number">2</span></span><br><span class="line">mergeSort(pA, p, q, le)</span><br><span class="line">mergeSort(pA, q+<span class="number">1</span>, r, le)</span><br><span class="line">merge(pA, p, q, r, le)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä»£ç å†™çš„æ—¶å€™è¦æ³¨æ„ä¸€ç‚¹ï¼Œb å’Œ c è¿™é‡Œï¼Œä¸èƒ½ç›´æ¥è¿™æ ·ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b := <span class="built_in">append</span>(A[p: q+<span class="number">1</span>], INF)</span><br><span class="line">c := <span class="built_in">append</span>(A[q+<span class="number">1</span>: r+<span class="number">1</span>], INF)</span><br></pre></td></tr></table></figure><p>åŸå› æ˜¯ï¼Œ<strong>åˆ‡ç‰‡å’Œåº•å±‚æ•°ç»„</strong>ã€‚ä½ æ„å»º b çš„æ—¶å€™å¾€é‡Œé¢ append äº†ä¸€ä¸ª INFï¼Œå®é™…ä¸Šæ˜¯åº•å±‚æ•°ç»„çš„<code>A[q+1]</code> ä½ç½®å˜æˆäº† INFï¼Œæ‰€ä»¥å†æ„å»º c çš„æ—¶å€™ï¼Œåˆ‡ç‰‡ <code>A[q+1: r+1]</code> çš„å€¼å°±æˆäº† <code>[INF, ...]</code>ï¼Œç„¶åå½’å¹¶å°±çˆ†ç‚¸äº†ğŸ’¥ã€‚</p><p>æŠŠä»£ç åˆä¸€ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">scheduleCourse</span><span class="params">(courses [][]<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">mergeSort(&amp;courses, <span class="number">0</span>, <span class="built_in">len</span>(courses)<span class="number">-1</span>, <span class="function"><span class="keyword">func</span> <span class="params">(a, b []<span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> a[<span class="number">1</span>] &lt;= b[<span class="number">1</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">queue := PriorityQueue&#123;&#125;</span><br><span class="line">time := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> _, c := <span class="keyword">range</span> courses &#123;</span><br><span class="line"><span class="keyword">if</span> time + c[<span class="number">0</span>] &lt;= c[<span class="number">1</span>] &#123;</span><br><span class="line">queue.Push(c[<span class="number">0</span>])</span><br><span class="line">time += c[<span class="number">0</span>]</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> !queue.IsEmpty() &amp;&amp; queue.Top() &gt; c[<span class="number">0</span>] &#123;</span><br><span class="line">time += c[<span class="number">0</span>] - queue.Poll()</span><br><span class="line">queue.Push(c[<span class="number">0</span>])</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> queue.Size()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** ä¼˜å…ˆé˜Ÿåˆ— **/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> PriorityQueue <span class="keyword">struct</span> &#123;</span><br><span class="line">data []<span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *PriorityQueue)</span> <span class="title">Top</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> q.data[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *PriorityQueue)</span> <span class="title">Push</span><span class="params">(element <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">q.data = <span class="built_in">append</span>(q.data, element)</span><br><span class="line">insertSortReverse(&amp;q.data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *PriorityQueue)</span> <span class="title">Poll</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">r := q.data[<span class="number">0</span>]</span><br><span class="line">q.data = q.data[<span class="number">1</span>:]</span><br><span class="line"><span class="keyword">return</span> r</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *PriorityQueue)</span> <span class="title">IsEmpty</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">len</span>(q.data) == <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *PriorityQueue)</span> <span class="title">Size</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">len</span>(q.data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**  å¯¹ []int çš„æ’å…¥æ’åº**/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">insertSortReverse</span><span class="params">(pA *[]<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">A := *pA</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="built_in">len</span>(A); i++ &#123;</span><br><span class="line">key := A[i]</span><br><span class="line">j := i - <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> j &gt;= <span class="number">0</span> &amp;&amp; A[j] &lt; key &#123;</span><br><span class="line">A[j+<span class="number">1</span>] = A[j]</span><br><span class="line">j -= <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">A[j+<span class="number">1</span>] = key</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** å¯¹ [][]int çš„å½’å¹¶æ’åº **/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> INF = []<span class="keyword">int</span>&#123;<span class="number">99999999</span>, <span class="number">99999999</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">merge</span><span class="params">(pA *[][]<span class="keyword">int</span>, p, q, r <span class="keyword">int</span>, le <span class="keyword">func</span> (a, b []<span class="keyword">int</span>)</span> <span class="title">bool</span>)</span> &#123;</span><br><span class="line"><span class="comment">// n1 := q - p + 1</span></span><br><span class="line"><span class="comment">// n2 := r - q</span></span><br><span class="line"><span class="comment">// b, c := make([][]int, n1+1), make([][]int, n2+1)</span></span><br><span class="line">A := *pA</span><br><span class="line"></span><br><span class="line">b := <span class="built_in">append</span>(<span class="built_in">make</span>([][]<span class="keyword">int</span>, <span class="number">0</span>), A[p: q+<span class="number">1</span>]...)</span><br><span class="line">c := <span class="built_in">append</span>(<span class="built_in">make</span>([][]<span class="keyword">int</span>, <span class="number">0</span>), A[q+<span class="number">1</span>: r+<span class="number">1</span>]...)</span><br><span class="line"></span><br><span class="line">b = <span class="built_in">append</span>(b, INF)</span><br><span class="line">c = <span class="built_in">append</span>(c, INF)</span><br><span class="line">i, j := <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> k := p; k &lt;= r; k++ &#123;</span><br><span class="line"><span class="keyword">if</span> le(b[i], c[j]) &#123;</span><br><span class="line">A[k] = b[i]</span><br><span class="line">i++</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">A[k] = c[j]</span><br><span class="line">j++</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mergeSort</span><span class="params">(pA *[][]<span class="keyword">int</span>, p <span class="keyword">int</span>, r <span class="keyword">int</span>, le <span class="keyword">func</span> (a, b []<span class="keyword">int</span>)</span> <span class="title">bool</span>)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> p &gt;= r &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">q := (p + r) / <span class="number">2</span></span><br><span class="line">mergeSort(pA, p, q, le)</span><br><span class="line">mergeSort(pA, q+<span class="number">1</span>, r, le)</span><br><span class="line">merge(pA, p, q, r, le)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™ä¸€ä¸ªç‰ˆæœ¬å°±å¯ä»¥é€šè¿‡äº†ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1geq2tnkgy4j30p605yjs3.jpg" alt="Leetcode æ‰§è¡Œç»“æœæˆªå›¾ï¼Œæ‰§è¡Œç”¨æ—¶ 580 ms, åœ¨æ‰€æœ‰ Go æäº¤ä¸­å‡»è´¥äº†50.00%çš„ç”¨æˆ·;å†…å­˜æ¶ˆè€— 8.1 MB, åœ¨æ‰€æœ‰ Go æäº¤ä¸­å‡»è´¥äº†100.00%çš„ç”¨æˆ·"></p><h4 id="æ ‡å‡†åº“-sort-heap"><a href="#æ ‡å‡†åº“-sort-heap" class="headerlink" title="æ ‡å‡†åº“ sort + heap"></a>æ ‡å‡†åº“ sort + heap</h4><p>Go çš„æ ‡å‡†åº“è¿˜æ˜¯å¾ˆå¼ºå¤§çš„ï¼Œä½†æ˜¯æ ‡å‡†åº“çš„è®¾è®¡ç›¸å½“çš„ Golangï¼Œæ‰ä»å…¶ä»–è¯­è¨€è½¬è¿‡æ¥ç”¨ç€çœŸçš„å¾ˆä¸ä¹ æƒ¯ï¼ˆæ¯”å¦‚ math åŒ…é‡Œè¿ Max éƒ½æ²¡æœ‰ï¼‰ï¼Œä¸è¿‡å¤šç”¨ç”¨è¿™äº›ä¸œè¥¿ã€å¤šçœ‹çœ‹å®ƒä»¬çš„æºç ï¼ˆGo æ ‡å‡†åº“çš„å¥½å¤šæºç å†™çš„æŒºæœ‰æ„æ€çš„ï¼‰ï¼Œå¯¹ç†è§£ Go çš„æ€æƒ³å¾ˆæœ‰å¸®åŠ©ã€‚</p><p>æˆ‘ä»¬ç”¨åˆ°çš„ä¸¤ä¸ªä¸œè¥¿ï¼Œæ’åºå’Œä¼˜å…ˆé˜Ÿåˆ—ï¼ŒGo æ ‡å‡†åº“é‡Œå…¶å®éƒ½æœ‰å¯ç”¨çš„ï¼š</p><ul><li>æ’åºï¼š<code>sort</code> åŒ…</li><li>ä¼˜å…ˆé˜Ÿåˆ—ï¼š<code>container/heap</code> åŒ…ï¼ŒGo æ²¡æœ‰ç›´æ¥çš„ä¼˜å…ˆé˜Ÿåˆ—ï¼Œä½†æˆ‘ä»¬å¯ä»¥ç”¨å †æ¥å¿«é€Ÿå®ç°ä¸€ä¸ªã€‚</li></ul><p>é¦–å…ˆçœ‹æ’åºï¼š</p><blockquote><p><strong>Package sort</strong></p><p>Package sort provides primitives for sorting slices and user-defined collections.</p></blockquote><p><code>sort</code> åŒ…é‡Œå·²ç»å°è£…å¥½äº†å¾ˆå¤šæˆ‘ä»¬å¸¸ç”¨çš„æ’åºæƒ…å†µï¼Œæ¯”å¦‚ï¼Œå¯¹æ•´æ•°åˆ‡ç‰‡ <code>[]int</code> çš„æ’åºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;sort&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">s := []<span class="keyword">int</span>&#123;<span class="number">5</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>&#125; <span class="comment">// unsorted</span></span><br><span class="line">sort.Ints(s)</span><br><span class="line">fmt.Println(s)<span class="comment">// [1 2 3 4 5 6]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™ç§ç”¨èµ·æ¥å¾ˆæ–¹ä¾¿ï¼Œä½†æˆ‘ä»¬ç°åœ¨è¦æ’ä¸€ä¸ª <code>[][]int</code> è¿™å°±ä¸å¤ªå¸¸è§„äº†ã€‚å¯¹è¿™ç§éå¸¸è§„ä¸œè¥¿çš„æ’åºï¼Œgo æä¾›çš„æ–¹å¼å’Œå…¶ä»–è¯­è¨€æœ‰ä¸€äº›åŒºåˆ«ã€‚</p><p>å¤§å¤šæ•°è¯­è¨€ï¼Œå¯¹è¿™ç§éå¸¸è§„ä¸œè¥¿çš„æ’åºï¼Œæˆ‘ä»¬æ˜¯æŠŠä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ä¼ è¿›å»ï¼Œç„¶åç»™ä»–ä¸€ä¸ªå‡½æ•°ï¼Œå‘Šè¯‰å®ƒæ¯”è¾ƒçš„ç»“æœã€‚ä¾‹å¦‚ï¼Œè¿™æ˜¯ C++ STL çš„ç”¨æ³•ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">myfunction</span> <span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span> </span>&#123; <span class="keyword">return</span> (i&lt;j); &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> myints[] = &#123;<span class="number">32</span>,<span class="number">71</span>,<span class="number">12</span>,<span class="number">45</span>,<span class="number">26</span>,<span class="number">80</span>,<span class="number">53</span>,<span class="number">33</span>&#125;;</span><br><span class="line">  <span class="function"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">myvector</span> <span class="params">(myints, myints+<span class="number">8</span>)</span></span>;<span class="comment">// 32 71 12 45 26 80 53 33</span></span><br><span class="line">    <span class="comment">// using function as comp</span></span><br><span class="line"><span class="built_in">std</span>::sort (myvector.begin()+<span class="number">4</span>, myvector.end(), myfunction);<span class="comment">// 12 32 45 71(26 33 53 80)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Go è¯­è¨€é‡Œä¹Ÿæœ‰è¿™ç§ç”¨æ³•ï¼Œå®ƒæä¾›äº†ä¸€ä¸ª<code>sort.Slice</code> å¯¹ä»»æ„åˆ‡ç‰‡è¿›è¡Œæ’åºï¼Œæ¯”å¦‚è¿™æ˜¯ä¸€ä¸ªæ–‡æ¡£é‡Œçš„ä¾‹å­ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;sort&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">people := []<span class="keyword">struct</span> &#123;</span><br><span class="line">Name <span class="keyword">string</span></span><br><span class="line">Age  <span class="keyword">int</span></span><br><span class="line">&#125;&#123;</span><br><span class="line">&#123;<span class="string">&quot;Gopher&quot;</span>, <span class="number">7</span>&#125;,</span><br><span class="line">&#123;<span class="string">&quot;Alice&quot;</span>, <span class="number">55</span>&#125;,</span><br><span class="line">&#123;<span class="string">&quot;Vera&quot;</span>, <span class="number">24</span>&#125;,</span><br><span class="line">&#123;<span class="string">&quot;Bob&quot;</span>, <span class="number">75</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line">sort.Slice(people, <span class="function"><span class="keyword">func</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123; <span class="keyword">return</span> people[i].Name &lt; people[j].Name &#125;)</span><br><span class="line">fmt.Println(<span class="string">&quot;By name:&quot;</span>, people) <span class="comment">// By name: [&#123;Alice 55&#125; &#123;Bob 75&#125; &#123;Gopher 7&#125; &#123;Vera 24&#125;]</span></span><br><span class="line"></span><br><span class="line">sort.Slice(people, <span class="function"><span class="keyword">func</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123; <span class="keyword">return</span> people[i].Age &lt; people[j].Age &#125;)</span><br><span class="line">fmt.Println(<span class="string">&quot;By age:&quot;</span>, people) <span class="comment">// By age: [&#123;Gopher 7&#125; &#123;Vera 24&#125; &#123;Alice 55&#125; &#123;Bob 75&#125;]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œå¯¹ <code>[][]int</code> æ’åºçš„éœ€æ±‚å¯ä»¥è§£å†³äº†ï¼Œbut we do need one more thing.</p><p>Go è¿˜æä¾›äº†ä¸€ç§æ›´åŠ  Go é£æ ¼çš„æ’åºï¼š<code>sort.Sort</code>ã€‚</p><blockquote><p><code>func Sort(data Interface)</code></p><p>Sort sorts data. It makes one call to data.Len to determine n, and O(n*log(n)) calls to data.Less and data.Swap. The sort is not guaranteed to be stable.</p></blockquote><p>è¿™ç©æ„å„¿æ˜¯ä¼ ä¸€ä¸ª <code>sort.Interface</code> çš„å®ç°è¿›æ¥ï¼Œè¿™çœŸçš„å¾ˆ Golangï¼</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Interface <span class="keyword">interface</span> &#123;</span><br><span class="line">    <span class="comment">// Len is the number of elements in the collection.</span></span><br><span class="line">    Len() <span class="keyword">int</span></span><br><span class="line">    <span class="comment">// Less reports whether the element with</span></span><br><span class="line">    <span class="comment">// index i should sort before the element with index j.</span></span><br><span class="line">    Less(i, j <span class="keyword">int</span>) <span class="keyword">bool</span></span><br><span class="line">    <span class="comment">// Swap swaps the elements with indexes i and j.</span></span><br><span class="line">    Swap(i, j <span class="keyword">int</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é•¿åº¦ã€å¤§å°ã€äº¤æ¢çš„æ–¹æ³•éƒ½ç”±ä½ æ¥å®šã€‚å…¶å®ä¸€èˆ¬ç”¨èµ·æ¥è¿˜æ˜¯å¾ˆç®€å•çš„ï¼ŒLenã€SwapåŸºæœ¬å°±è¿™æ ·ï¼Œä¸€èˆ¬è¦æ”¹çš„åªæœ‰ Lessï¼ˆåªæ”¹Lessï¼Œå…¶å®ä¹Ÿå·®ä¸å¤šå°±æ˜¯ sort.Sliceï¼Œä½†å†…éƒ¨å®ç°è¿˜æ˜¯æœ‰æ‰€åŒºåˆ«çš„ï¼‰ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;sort&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">Name <span class="keyword">string</span></span><br><span class="line">Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Person)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;%s: %d&quot;</span>, p.Name, p.Age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ByAge implements sort.Interface for []Person based on</span></span><br><span class="line"><span class="comment">// the Age field.</span></span><br><span class="line"><span class="keyword">type</span> ByAge []Person</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a ByAge)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span>           &#123; <span class="keyword">return</span> <span class="built_in">len</span>(a) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a ByAge)</span> <span class="title">Swap</span><span class="params">(i, j <span class="keyword">int</span>)</span></span>      &#123; a[i], a[j] = a[j], a[i] &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a ByAge)</span> <span class="title">Less</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123; <span class="keyword">return</span> a[i].Age &lt; a[j].Age &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">people := []Person&#123;</span><br><span class="line">&#123;<span class="string">&quot;Bob&quot;</span>, <span class="number">31</span>&#125;,</span><br><span class="line">&#123;<span class="string">&quot;John&quot;</span>, <span class="number">42</span>&#125;,</span><br><span class="line">&#123;<span class="string">&quot;Michael&quot;</span>, <span class="number">17</span>&#125;,</span><br><span class="line">&#123;<span class="string">&quot;Jenny&quot;</span>, <span class="number">26</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(people)</span><br><span class="line"></span><br><span class="line">sort.Sort(ByAge(people))</span><br><span class="line">fmt.Println(people)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ’åºçš„é—®é¢˜è§£å†³äº†ï¼Œå†çœ‹ä¼˜å…ˆé˜Ÿåˆ—ï¼š</p><blockquote><p>Package container/heap</p><p>Package heap provides heap operations for any type that implements heap.Interface. A heap is a tree with the property that each node is the minimum-valued node in its subtree.</p><p>The minimum element in the tree is the root, at index 0.</p><p>A heap is a common way to implement a priority queue. To build a priority queue, implement the Heap interface with the (negative) priority as the ordering for the Less method, so Push adds items while Pop removes the highest-priority item from the queue. The Examples include such an implementation; the file example_pq_test.go has the complete source.</p></blockquote><p>ä¼˜å…ˆé˜Ÿåˆ—å¯ä»¥ç”¨å †æ¥å®ç°ï¼Œå®ç°ä¸€ä¸ªå †è¦å®ç° heap.Interfaceï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ¥å£æ˜¯â€œç»§æ‰¿â€äº† sort.Interface çš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åˆšæ‰è¦ä»‹ç»å®ƒçš„åŸå› ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Interface <span class="keyword">interface</span> &#123;</span><br><span class="line">    sort.Interface</span><br><span class="line">    Push(x <span class="keyword">interface</span>&#123;&#125;) <span class="comment">// add x as element Len()</span></span><br><span class="line">    Pop() <span class="keyword">interface</span>&#123;&#125;   <span class="comment">// remove and return element Len() - 1.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…·ä½“è¦æ€ä¹ˆåšï¼Œå…¶å® Go çš„æ–‡æ¡£é‡Œç»™å‡ºäº†äº›ä¼˜å…ˆé˜Ÿåˆ—çš„ä¾‹å­äº†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This example demonstrates a priority queue built using the heap interface.</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;container/heap&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// An Item is something we manage in a priority queue.</span></span><br><span class="line"><span class="keyword">type</span> Item <span class="keyword">struct</span> &#123;</span><br><span class="line">value    <span class="keyword">string</span> <span class="comment">// The value of the item; arbitrary.</span></span><br><span class="line">priority <span class="keyword">int</span>    <span class="comment">// The priority of the item in the queue.</span></span><br><span class="line"><span class="comment">// The index is needed by update and is maintained by the heap.Interface methods.</span></span><br><span class="line">index <span class="keyword">int</span> <span class="comment">// The index of the item in the heap.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// A PriorityQueue implements heap.Interface and holds Items.</span></span><br><span class="line"><span class="keyword">type</span> PriorityQueue []*Item</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pq PriorityQueue)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> &#123; <span class="keyword">return</span> <span class="built_in">len</span>(pq) &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pq PriorityQueue)</span> <span class="title">Less</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="comment">// We want Pop to give us the highest, not lowest, priority so we use greater than here.</span></span><br><span class="line"><span class="keyword">return</span> pq[i].priority &gt; pq[j].priority</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pq PriorityQueue)</span> <span class="title">Swap</span><span class="params">(i, j <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">pq[i], pq[j] = pq[j], pq[i]</span><br><span class="line">pq[i].index = i</span><br><span class="line">pq[j].index = j</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pq *PriorityQueue)</span> <span class="title">Push</span><span class="params">(x <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">n := <span class="built_in">len</span>(*pq)</span><br><span class="line">item := x.(*Item)</span><br><span class="line">item.index = n</span><br><span class="line">*pq = <span class="built_in">append</span>(*pq, item)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pq *PriorityQueue)</span> <span class="title">Pop</span><span class="params">()</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">old := *pq</span><br><span class="line">n := <span class="built_in">len</span>(old)</span><br><span class="line">item := old[n<span class="number">-1</span>]</span><br><span class="line">old[n<span class="number">-1</span>] = <span class="literal">nil</span>  <span class="comment">// avoid memory leak</span></span><br><span class="line">item.index = <span class="number">-1</span> <span class="comment">// for safety</span></span><br><span class="line">*pq = old[<span class="number">0</span> : n<span class="number">-1</span>]</span><br><span class="line"><span class="keyword">return</span> item</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// update modifies the priority and value of an Item in the queue.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pq *PriorityQueue)</span> <span class="title">update</span><span class="params">(item *Item, value <span class="keyword">string</span>, priority <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">item.value = value</span><br><span class="line">item.priority = priority</span><br><span class="line">heap.Fix(pq, item.index)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This example creates a PriorityQueue with some items, adds and manipulates an item,</span></span><br><span class="line"><span class="comment">// and then removes the items in priority order.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// Some items and their priorities.</span></span><br><span class="line">items := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;</span><br><span class="line"><span class="string">&quot;banana&quot;</span>: <span class="number">3</span>, <span class="string">&quot;apple&quot;</span>: <span class="number">2</span>, <span class="string">&quot;pear&quot;</span>: <span class="number">4</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a priority queue, put the items in it, and</span></span><br><span class="line"><span class="comment">// establish the priority queue (heap) invariants.</span></span><br><span class="line">pq := <span class="built_in">make</span>(PriorityQueue, <span class="built_in">len</span>(items))</span><br><span class="line">i := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> value, priority := <span class="keyword">range</span> items &#123;</span><br><span class="line">pq[i] = &amp;Item&#123;</span><br><span class="line">value:    value,</span><br><span class="line">priority: priority,</span><br><span class="line">index:    i,</span><br><span class="line">&#125;</span><br><span class="line">i++</span><br><span class="line">&#125;</span><br><span class="line">heap.Init(&amp;pq)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Insert a new item and then modify its priority.</span></span><br><span class="line">item := &amp;Item&#123;</span><br><span class="line">value:    <span class="string">&quot;orange&quot;</span>,</span><br><span class="line">priority: <span class="number">1</span>,</span><br><span class="line">&#125;</span><br><span class="line">heap.Push(&amp;pq, item)</span><br><span class="line">pq.update(item, item.value, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Take the items out; they arrive in decreasing priority order.</span></span><br><span class="line"><span class="keyword">for</span> pq.Len() &gt; <span class="number">0</span> &#123;</span><br><span class="line">item := heap.Pop(&amp;pq).(*Item)</span><br><span class="line">fmt.Printf(<span class="string">&quot;%.2d:%s &quot;</span>, item.priority, item.value)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>çœŸæ­£ç”¨èµ·æ¥æ²¡æœ‰è¿™ä¹ˆéš¾ï¼Œå®ƒè¿™ä¸ªæ˜¯æ¯”è¾ƒä¸€èˆ¬çš„æƒ…å†µäº†ã€‚æˆ‘ä»¬è¿™é‡Œéœ€è¦çš„åªæ˜¯ä¸€ä¸ªç®€å•çš„åŸºäº <code>[]int</code> çš„å †ï¼Œå¯ä»¥ç®€åŒ–å¾ˆå¤šçš„ã€‚</p><p>ç”¨åº“å°±æ¯”è¾ƒç®€å•ï¼Œç›´æ¥å†™å…¨éƒ¨çš„ä»£ç äº†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;sort&quot;</span></span><br><span class="line"><span class="string">&quot;container/heap&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">scheduleCourse</span><span class="params">(courses [][]<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">sort.Slice(courses, <span class="function"><span class="keyword">func</span> <span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;<span class="keyword">return</span> courses[i][<span class="number">1</span>] &lt; courses[j][<span class="number">1</span>]&#125;)</span><br><span class="line"></span><br><span class="line">queue := &amp;PriorityQueue&#123;&#125;</span><br><span class="line">time := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> _, c := <span class="keyword">range</span> courses &#123;</span><br><span class="line"><span class="keyword">if</span> time + c[<span class="number">0</span>] &lt;= c[<span class="number">1</span>] &#123;</span><br><span class="line">heap.Push(queue, c[<span class="number">0</span>])</span><br><span class="line">time += c[<span class="number">0</span>]</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> queue.Len() != <span class="number">0</span> &amp;&amp; queue.Top() &gt; c[<span class="number">0</span>] &#123;</span><br><span class="line">time += c[<span class="number">0</span>] - heap.Pop(queue).(<span class="keyword">int</span>)</span><br><span class="line">heap.Push(queue, c[<span class="number">0</span>])</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> queue.Len()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> PriorityQueue []<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q PriorityQueue)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">len</span>(q)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q PriorityQueue)</span> <span class="title">Swap</span><span class="params">(a, b <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">q[a], q[b] = q[b], q[a]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q PriorityQueue)</span> <span class="title">Less</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> q[a] &gt; q[b]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q PriorityQueue)</span> <span class="title">Top</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> q[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *PriorityQueue)</span> <span class="title">Push</span><span class="params">(x <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">*q = <span class="built_in">append</span>(*q, x.(<span class="keyword">int</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *PriorityQueue)</span> <span class="title">Pop</span><span class="params">()</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">v := (*q)[q.Len()<span class="number">-1</span>]</span><br><span class="line">*q = (*q)[: q.Len()<span class="number">-1</span>]</span><br><span class="line"><span class="keyword">return</span> v</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨ scheduleCourse é‡Œè°ƒç”¨ PriorityQueue æ—¶è¦æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„å¿…é¡»æ˜¯ <code>heap.Push</code> å’Œ <code>heap.Pop</code>ï¼Œä¸èƒ½å»è°ƒç”¨è‡ªå·±å†™çš„é‚£ä¸ª <code>queue.Push/Pop</code>ï¼Œheap.Pushã€Pop æ‰èƒ½ä¿è¯å †çš„æ­£ç¡®æ€§ã€‚</p><p>è¿™ä¸ªå¯ä»¥é€šè¿‡ï¼Œæ‰§è¡Œç”¨æ—¶ 152 msï¼ˆå‡»è´¥87.5%ï¼‰ï¼Œå†…å­˜æ¶ˆè€—ï¼š7.3 MBã€‚è¿˜æœ‰äººå†™çš„æ¯”è¿™å¿«ï¼Ÿ</p><p>æˆ‘çœ‹äº†ä¸€ä¸‹ sort.Slice æºç ï¼Œå®ƒç”¨äº†äº›åå°„ï¼ˆreflectliteï¼‰ğŸ˜‚ï¼Œæ‰€ä»¥æ¯” sort.Sort æ…¢ï¼ˆsort.Sortæ²¡æœ‰åå°„ï¼‰ï¼Œé‚£äº›å†™çš„æ›´å¿«çš„äººéƒ½æ˜¯ç”¨  sort.Sort ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;sort&quot;</span></span><br><span class="line"><span class="string">&quot;container/heap&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">scheduleCourse</span><span class="params">(courses [][]<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> coursesSoted SS4Sort = courses</span><br><span class="line">sort.Sort(coursesSoted)</span><br><span class="line"></span><br><span class="line">queue := &amp;PriorityQueue&#123;&#125;</span><br><span class="line">time := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> _, c := <span class="keyword">range</span> coursesSoted &#123;</span><br><span class="line"><span class="keyword">if</span> time + c[<span class="number">0</span>] &lt;= c[<span class="number">1</span>] &#123;</span><br><span class="line">heap.Push(queue, c[<span class="number">0</span>])</span><br><span class="line">time += c[<span class="number">0</span>]</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> queue.Len() != <span class="number">0</span> &amp;&amp; queue.Top() &gt; c[<span class="number">0</span>] &#123;</span><br><span class="line">time += c[<span class="number">0</span>] - heap.Pop(queue).(<span class="keyword">int</span>)</span><br><span class="line">heap.Push(queue, c[<span class="number">0</span>])</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> queue.Len()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** å¯¹ [][]int æ’åºçš„æ¥å£ **/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SS4Sort [][]<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s SS4Sort)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">len</span>(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s SS4Sort)</span> <span class="title">Swap</span><span class="params">(a, b <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">s[a], s[b] = s[b], s[a]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s SS4Sort)</span> <span class="title">Less</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> s[a][<span class="number">1</span>] &lt; s[b][<span class="number">1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** ä¼˜å…ˆé˜Ÿåˆ— **/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> PriorityQueue []<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q PriorityQueue)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">len</span>(q)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q PriorityQueue)</span> <span class="title">Swap</span><span class="params">(a, b <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">q[a], q[b] = q[b], q[a]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q PriorityQueue)</span> <span class="title">Less</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> q[a] &gt; q[b]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q PriorityQueue)</span> <span class="title">Top</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> q[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *PriorityQueue)</span> <span class="title">Push</span><span class="params">(x <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">*q = <span class="built_in">append</span>(*q, x.(<span class="keyword">int</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *PriorityQueue)</span> <span class="title">Pop</span><span class="params">()</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">v := (*q)[q.Len()<span class="number">-1</span>]</span><br><span class="line">*q = (*q)[: q.Len()<span class="number">-1</span>]</span><br><span class="line"><span class="keyword">return</span> v</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1geqkex0ey2j30oa05oaar.jpg" alt="Leetcode æ‰§è¡Œç»“æœæˆªå›¾ï¼Œæ‰§è¡Œç”¨æ—¶ 136 ms, åœ¨æ‰€æœ‰ Go æäº¤ä¸­å‡»è´¥äº†100.00%çš„ç”¨æˆ·; å†…å­˜æ¶ˆè€— 7.3 MB, åœ¨æ‰€æœ‰ Go æäº¤ä¸­å‡»è´¥äº†100.00%çš„ç”¨æˆ·"></p><p>å“ï¼Œï¼ŒGo è¿˜æ˜¯å†™ç»“æ„åŒ–æ¯”è¾ƒå¼ºçš„ä¸œè¥¿å¥½ç”¨ã€‚è¿™ç§åº“é‡Œå¤§é‡çš„æ¥å£éœ€è¦è‡ªå·±å†™å®ç°ï¼Œåœ¨å·¥ç¨‹é‡Œå€’æ˜¯æŒºå¥½ç”¨ï¼Œä½†æ‹¿æ¥è§£è¿™ç§å°é—®é¢˜å†™èµ·æ¥å°±å„ç§ä¸æ–¹ä¾¿äº†ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonæ·±åº¦å­¦ä¹ ä¹‹åˆçª¥ç¥ç»ç½‘ç»œ</title>
      <link href="/2020/05/12/DeepLearningWithPython/Deep-Learning%20with-Python-ch2/"/>
      <url>/2020/05/12/DeepLearningWithPython/Deep-Learning%20with-Python-ch2/</url>
      
        <content type="html"><![CDATA[<h1 id="Deep-Learning-with-Python"><a href="#Deep-Learning-with-Python" class="headerlink" title="Deep Learning with Python"></a>Deep Learning with Python</h1><p>è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘å­¦ä¹ ã€ŠDeep Learning with Pythonã€‹(ç¬¬äºŒç‰ˆï¼ŒFranÃ§ois Chollet è‘—) æ—¶å†™çš„ç³»åˆ—ç¬”è®°ä¹‹ä¸€ã€‚æ–‡ç« çš„å†…å®¹æ˜¯ä»  Jupyter notebooks è½¬æˆ Markdown çš„ï¼Œå½“æˆ‘å®Œæˆæ‰€ä»¥æ–‡ç« åï¼Œä¼šåœ¨ GitHub å‘å¸ƒæˆ‘å†™çš„æ‰€æœ‰  Jupyter notebooksã€‚</p><p>ä½ å¯ä»¥åœ¨è¿™ä¸ªç½‘å€åœ¨çº¿é˜…è¯»è¿™æœ¬ä¹¦çš„æ­£ç‰ˆåŸæ–‡(è‹±æ–‡)ï¼š<a href="https://livebook.manning.com/book/deep-learning-with-python">https://livebook.manning.com/book/deep-learning-with-python</a></p><p>è¿™æœ¬ä¹¦çš„ä½œè€…ä¹Ÿç»™å‡ºäº†ä¸€å¥— Jupyter notebooksï¼š<a href="https://github.com/fchollet/deep-learning-with-python-notebooks">https://github.com/fchollet/deep-learning-with-python-notebooks</a></p><hr><p>æœ¬æ–‡ä¸º <strong>ç¬¬2ç«  å¼€å§‹ä¹‹å‰ï¼šç¥ç»ç½‘ç»œèƒŒåçš„æ•°å­¦</strong> (Chapter 2. Before we begin: the mathematical building blocks of neural networks) çš„ç¬”è®°æ•´åˆã€‚</p><p>æœ¬æ–‡ç›®å½•ï¼š</p><p>[TOC]</p><h2 id="åˆçª¥ç¥ç»ç½‘ç»œ"><a href="#åˆçª¥ç¥ç»ç½‘ç»œ" class="headerlink" title="åˆçª¥ç¥ç»ç½‘ç»œ"></a>åˆçª¥ç¥ç»ç½‘ç»œ</h2><p>å­¦ç¼–ç¨‹è¯­è¨€ä» â€œHello Worldâ€ å¼€å§‹ï¼Œå­¦ Deep learning ä» <code>MINST</code> å¼€å§‹ã€‚</p><p>MNIST ç”¨æ¥è®­ç»ƒæ‰‹å†™æ•°å­—è¯†åˆ«ï¼Œ å®ƒåŒ…å« 28x28 çš„ç°åº¦æ‰‹å†™å›¾ç‰‡ï¼Œä»¥åŠæ¯å¼ å›¾ç‰‡å¯¹åº”çš„æ ‡ç­¾(0~9çš„å€¼)ã€‚</p><h3 id="å¯¼å…¥MNISTæ•°æ®é›†"><a href="#å¯¼å…¥MNISTæ•°æ®é›†" class="headerlink" title="å¯¼å…¥MNISTæ•°æ®é›†"></a>å¯¼å…¥MNISTæ•°æ®é›†</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Loading the MNIST dataset in Keras</span></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.datasets <span class="keyword">import</span> mnist</span><br><span class="line">(train_images, train_labels), (test_images, test_labels) = mnist.load_data()</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹è®­ç»ƒé›†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(train_images.shape)</span><br><span class="line">print(train_labels.shape)</span><br><span class="line">train_labels</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>(60000, 28, 28)(60000,)array([5, 0, 4, ..., 5, 6, 8], dtype=uint8)</code></pre><p>è¿™æ˜¯æµ‹è¯•é›†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(test_images.shape)</span><br><span class="line">print(test_labels.shape)</span><br><span class="line">test_labels</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>(10000, 28, 28)(10000,)array([7, 2, 1, ..., 4, 5, 6], dtype=uint8)</code></pre><h3 id="ç½‘ç»œæ„å»º"><a href="#ç½‘ç»œæ„å»º" class="headerlink" title="ç½‘ç»œæ„å»º"></a>ç½‘ç»œæ„å»º</h3><p>æˆ‘ä»¬æ¥æ„å»ºä¸€ä¸ªç”¨æ¥å­¦ä¹  MNIST é›†çš„ç¥ç»ç½‘ç»œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers</span><br><span class="line"></span><br><span class="line">network = models.Sequential()</span><br><span class="line">network.add(layers.Dense(<span class="number">512</span>, activation=<span class="string">&#x27;relu&#x27;</span>, input_shape=(<span class="number">28</span> * <span class="number">28</span>, )))</span><br><span class="line">network.add(layers.Dense(<span class="number">10</span>, activation=<span class="string">&#x27;softmax&#x27;</span>))</span><br></pre></td></tr></table></figure><p>ç¥ç»ç½‘ç»œæ˜¯ä¸€ä¸ªä¸ªã€Œå±‚ã€ç»„æˆçš„ã€‚<br>ä¸€ä¸ªã€Œå±‚ã€å°±åƒæ˜¯ä¸€ä¸ªâ€œè’¸é¦è¿‡æ»¤å™¨â€ï¼Œå®ƒä¼šâ€œè¿‡æ»¤â€å¤„ç†è¾“å…¥çš„æ•°æ®ï¼Œä»é‡Œé¢â€œç²¾ç‚¼â€å‡ºéœ€è¦çš„ä¿¡æ¯ï¼Œç„¶åä¼ åˆ°ä¸‹ä¸€å±‚ã€‚</p><p>è¿™æ ·ä¸€ç³»åˆ—çš„ã€Œå±‚ã€ç»„åˆèµ·æ¥ï¼Œåƒæµæ°´çº¿ä¸€æ ·å¯¹æ•°æ®è¿›è¡Œå¤„ç†ã€‚<br>å±‚å±‚æ‰¬å¼ƒï¼Œè®©è¢«å¤„ç†çš„æ•°æ®ï¼Œæˆ–è€…è¯´â€œæ•°æ®çš„è¡¨ç¤ºâ€å¯¹æˆ‘ä»¬æœ€ç»ˆå¸Œæœ›çš„ç»“æœè¶Šæ¥è¶Šâ€œæœ‰ç”¨â€ã€‚</p><p>æˆ‘ä»¬åˆšæ‰è¿™æ®µä»£ç æ„å»ºçš„ç½‘ç»œåŒ…å«ä¸¤ä¸ªã€ŒDense å±‚ã€ï¼Œè¿™ä¹ˆå«æ˜¯å› ä¸ºå®ƒä»¬æ˜¯å¯†é›†è¿æ¥ï¼ˆdensely connectedï¼‰æˆ–è€…è¯´æ˜¯ <em>å…¨è¿æ¥</em> çš„ã€‚</p><p>æ•°æ®åˆ°äº†æœ€åä¸€å±‚ï¼ˆç¬¬äºŒå±‚ï¼‰ï¼Œæ˜¯ä¸€ä¸ª <strong>10è·¯</strong> çš„ softmax å±‚ã€‚<br>è¿™ä¸ªå±‚è¾“å‡ºçš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å« 10 ä¸ªæ¦‚ç‡å€¼ï¼ˆå®ƒä»¬çš„å’Œä¸º1ï¼‰ï¼Œè¿™ä¸ªè¾“å‡ºã€Œè¡¨ç¤ºã€çš„ä¿¡æ¯å°±å¯¹æˆ‘ä»¬é¢„æµ‹å›¾ç‰‡å¯¹åº”çš„æ•°å­—ç›¸å½“æœ‰ç”¨äº†ã€‚<br>äº‹å®ä¸Šè¿™è¾“å‡ºä¸­çš„æ¯ä¸€ä¸ªæ¦‚ç‡å€¼å°±åˆ†åˆ«ä»£è¡¨è¾“å…¥å›¾ç‰‡å±äº10ä¸ªæ•°å­—ï¼ˆ0ï½9ï¼‰ä¸­çš„ä¸€ä¸ªçš„æ¦‚ç‡ï¼</p><h3 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦ <em>ç¼–è¯‘</em> è¿™ä¸ªç½‘ç»œï¼Œè¿™ä¸ªæ­¥éª¤éœ€è¦ç»™3ä¸ªå‚æ•°ï¼š</p><ul><li>æŸå¤±å‡½æ•°ï¼šè¯„ä»·ä½ è¿™ç½‘ç»œè¡¨ç°çš„å¥½ä¸å¥½çš„å‡½æ•°</li><li>ä¼˜åŒ–å™¨ï¼šæ€ä¹ˆæ›´æ–°ï¼ˆä¼˜åŒ–ï¼‰ä½ è¿™ä¸ªç½‘ç»œ</li><li>è®­ç»ƒå’Œæµ‹è¯•è¿‡ç¨‹ä¸­éœ€è¦ç›‘æ§çš„æŒ‡æ ‡ï¼Œæ¯”å¦‚è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬åªå…³å¿ƒä¸€ä¸ªæŒ‡æ ‡ â€”â€” é¢„æµ‹çš„ç²¾åº¦</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">network.<span class="built_in">compile</span>(loss=<span class="string">&quot;categorical_crossentropy&quot;</span>,</span><br><span class="line">                optimizer=<span class="string">&#x27;rmsprop&#x27;</span>,</span><br><span class="line">                metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br></pre></td></tr></table></figure><h3 id="é¢„å¤„ç†"><a href="#é¢„å¤„ç†" class="headerlink" title="é¢„å¤„ç†"></a>é¢„å¤„ç†</h3><h4 id="å›¾å½¢å¤„ç†"><a href="#å›¾å½¢å¤„ç†" class="headerlink" title="å›¾å½¢å¤„ç†"></a>å›¾å½¢å¤„ç†</h4><p>æˆ‘ä»¬è¿˜éœ€è¦å¤„ç†ä¸€ä¸‹å›¾å½¢æ•°æ®ï¼ŒæŠŠå®ƒå˜æˆæˆ‘ä»¬çš„ç½‘ç»œè®¤è¯†çš„æ ·å­ã€‚</p><p>MNIST æ•°æ®é›†é‡Œçš„å›¾ç‰‡æ˜¯ 28x28 çš„ï¼Œæ¯ä¸ªå€¼æ˜¯å±äº [0, 255] çš„ uint8ã€‚<br>è€Œæˆ‘ä»¬çš„ç¥ç»ç½‘ç»œæƒ³è¦çš„æ˜¯ 28x28 çš„åœ¨ [0, 1] ä¸­çš„ float32ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">train_images = train_images.reshape((<span class="number">60000</span>, <span class="number">28</span> * <span class="number">28</span>))</span><br><span class="line">train_images = train_images.astype(<span class="string">&#x27;float32&#x27;</span>) / <span class="number">255</span></span><br><span class="line"></span><br><span class="line">test_images = test_images.reshape((<span class="number">10000</span>, <span class="number">28</span> * <span class="number">28</span>))</span><br><span class="line">test_images = test_images.astype(<span class="string">&#x27;float32&#x27;</span>) / <span class="number">255</span></span><br></pre></td></tr></table></figure><h4 id="æ ‡ç­¾å¤„ç†"><a href="#æ ‡ç­¾å¤„ç†" class="headerlink" title="æ ‡ç­¾å¤„ç†"></a>æ ‡ç­¾å¤„ç†</h4><p>åŒæ ·ï¼Œæ ‡ç­¾ä¹Ÿæ˜¯éœ€è¦å¤„ç†ä¸€ä¸‹çš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.utils <span class="keyword">import</span> to_categorical</span><br><span class="line"></span><br><span class="line">train_labels = to_categorical(train_labels)</span><br><span class="line">test_labels = to_categorical(test_labels)</span><br></pre></td></tr></table></figure><h3 id="è®­ç»ƒç½‘ç»œ"><a href="#è®­ç»ƒç½‘ç»œ" class="headerlink" title="è®­ç»ƒç½‘ç»œ"></a>è®­ç»ƒç½‘ç»œ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">network.fit(train_images, train_labels, epochs=<span class="number">5</span>, batch_size=<span class="number">128</span>)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>Train on 60000 samplesEpoch 1/560000/60000 [==============================] - 3s 49us/sample - loss: 0.2549 - accuracy: 0.9254Epoch 2/560000/60000 [==============================] - 2s 38us/sample - loss: 0.1025 - accuracy: 0.9693Epoch 3/560000/60000 [==============================] - 2s 35us/sample - loss: 0.0676 - accuracy: 0.9800Epoch 4/560000/60000 [==============================] - 2s 37us/sample - loss: 0.0491 - accuracy: 0.9848Epoch 5/560000/60000 [==============================] - 2s 42us/sample - loss: 0.0369 - accuracy: 0.9888&lt;tensorflow.python.keras.callbacks.History at 0x13a7892d0&gt;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè®­ç»ƒå¾ˆå¿«ï¼Œä¸€ä¼šå„¿å°±å¯¹è®­ç»ƒé›†æœ‰ 98%+ çš„ç²¾åº¦äº†ã€‚</p><p>å†ç”¨æµ‹è¯•é›†å»è¯•è¯•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">test_loss, test_acc = network.evaluate(test_images, test_labels, verbose=<span class="number">2</span>)    <span class="comment"># verbose=2 to avoid a looooong progress bar that fills the screen with &#x27;=&#x27;. https://github.com/tensorflow/tensorflow/issues/32286</span></span><br><span class="line">print(<span class="string">&#x27;test_acc:&#x27;</span>, test_acc)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>10000/1 - 0s - loss: 0.0362 - accuracy: 0.9789test_acc: 0.9789</code></pre><p>æˆ‘ä»¬è®­ç»ƒå¥½çš„ç½‘ç»œåœ¨æµ‹è¯•é›†ä¸‹çš„è¡¨ç°å¹¶æ²¡æœ‰ä¹‹å‰åœ¨è®­ç»ƒé›†ä¸­é‚£ä¹ˆå¥½ï¼Œè¿™æ˜¯ã€Œè¿‡æ‹Ÿåˆã€çš„é”…ã€‚</p><h2 id="ç¥ç»ç½‘ç»œçš„æ•°æ®è¡¨ç¤º"><a href="#ç¥ç»ç½‘ç»œçš„æ•°æ®è¡¨ç¤º" class="headerlink" title="ç¥ç»ç½‘ç»œçš„æ•°æ®è¡¨ç¤º"></a>ç¥ç»ç½‘ç»œçš„æ•°æ®è¡¨ç¤º</h2><p>Tensorï¼Œå¼ é‡ï¼Œä»»æ„ç»´çš„æ•°ç»„ï¼ˆæˆ‘çš„æ„æ€æ˜¯ç¼–ç¨‹çš„é‚£ç§æ•°ç»„ï¼‰ã€‚çŸ©é˜µæ˜¯äºŒç»´çš„å¼ é‡ã€‚</p><p>æˆ‘ä»¬å¸¸æŠŠã€Œå¼ é‡çš„ç»´åº¦ã€è¯´æˆã€Œè½´ã€ã€‚</p><h3 id="è®¤è¯†å¼ é‡"><a href="#è®¤è¯†å¼ é‡" class="headerlink" title="è®¤è¯†å¼ é‡"></a>è®¤è¯†å¼ é‡</h3><h4 id="æ ‡é‡-0D-Tensors"><a href="#æ ‡é‡-0D-Tensors" class="headerlink" title="æ ‡é‡ (0D Tensors)"></a>æ ‡é‡ (0D Tensors)</h4><p>Scalarsï¼Œæ ‡é‡æ˜¯ 0 ç»´çš„å¼ é‡ï¼ˆ0ä¸ªè½´ï¼‰ï¼ŒåŒ…å«ä¸€ä¸ªæ•°ã€‚</p><p>æ ‡é‡åœ¨ numpy ä¸­å¯ä»¥ç”¨ float32 æˆ– float64 è¡¨ç¤ºã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">x = np.array(<span class="number">12</span>)</span><br><span class="line">x</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>array(12)</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x.ndim    <span class="comment"># è½´æ•°ï¼ˆç»´æ•°ï¼‰</span></span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>1</code></pre><h4 id="å‘é‡-1D-Tensors"><a href="#å‘é‡-1D-Tensors" class="headerlink" title="å‘é‡ (1D Tensors)"></a>å‘é‡ (1D Tensors)</h4><p>Vectorsï¼Œå‘é‡æ˜¯ 1 ç»´å¼ é‡ï¼ˆæœ‰1ä¸ªè½´ï¼‰ï¼ŒåŒ…å«ä¸€åˆ—æ ‡é‡ï¼ˆå°±æ˜¯æä¸ªarrayè£…æ ‡é‡ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line">x</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>array([1, 2, 3, 4, 5])</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x.ndim</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>1</code></pre><p>æˆ‘ä»¬æŠŠè¿™æ ·æœ‰5ä¸ªå…ƒç´ çš„å‘é‡å«åšâ€œ5ç»´å‘é‡â€ã€‚<br>ä½†æ³¨æ„<strong>5Då‘é‡</strong>å¯ä¸æ˜¯<strong>5Då¼ é‡</strong>ï¼</p><ul><li>5Då‘é‡ï¼šåªæœ‰1ä¸ªè½´ï¼Œåœ¨è¿™ä¸ªè½´ä¸Šæœ‰5ä¸ªç»´åº¦ã€‚</li><li>5Då¼ é‡ï¼šæœ‰5ä¸ªè½´ï¼Œåœ¨æ¯ä¸ªè½´ä¸Šå¯ä»¥æœ‰ä»»æ„ç»´åº¦ã€‚</li></ul><p>è¿™ä¸ªå°±å¾ˆè¿·ï¼Œè¿™â€œç»´åº¦â€æœ‰çš„æ—¶å€™æ˜¯æŒ‡è½´æ•°ï¼Œæœ‰çš„æ—¶å€™æ˜¯æŒ‡è½´ä¸Šçš„å…ƒç´ ä¸ªæ•°ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬æœ€å¥½æ¢ç§è¯´æ³•ï¼Œç”¨ã€Œé˜¶ã€æ¥è¡¨ç¤ºè½´æ•°ï¼Œè¯´ <strong>5é˜¶å¼ é‡</strong>ã€‚</p><h4 id="çŸ©é˜µ-2D-Tensors"><a href="#çŸ©é˜µ-2D-Tensors" class="headerlink" title="çŸ©é˜µ (2D Tensors)"></a>çŸ©é˜µ (2D Tensors)</h4><p>Matricesï¼ŒçŸ©é˜µæ˜¯ 2 é˜¶å¼ é‡ï¼ˆ2ä¸ªè½´ï¼Œå°±æ˜¯æˆ‘ä»¬è¯´çš„ã€Œè¡Œã€å’Œã€Œåˆ—ã€ï¼‰ï¼ŒåŒ…å«ä¸€åˆ—å‘é‡ï¼ˆå°±æ˜¯æä¸ªarrayè£…å‘é‡ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x = np.array([[<span class="number">5</span>, <span class="number">78</span>, <span class="number">2</span>, <span class="number">34</span>, <span class="number">0</span>],</span><br><span class="line">              [<span class="number">6</span>, <span class="number">79</span>, <span class="number">3</span>, <span class="number">35</span>, <span class="number">1</span>],</span><br><span class="line">              [<span class="number">7</span>, <span class="number">80</span>, <span class="number">4</span>, <span class="number">36</span>, <span class="number">2</span>]])</span><br><span class="line">x</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>array([[ 5, 78,  2, 34,  0],       [ 6, 79,  3, 35,  1],       [ 7, 80,  4, 36,  2]])</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x.ndim</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>2</code></pre><h4 id="é«˜é˜¶å¼ é‡"><a href="#é«˜é˜¶å¼ é‡" class="headerlink" title="é«˜é˜¶å¼ é‡"></a>é«˜é˜¶å¼ é‡</h4><p>ä½ æä¸ªè£…çŸ©é˜µçš„ array å°±å¾—åˆ°äº†3é˜¶å¼ é‡ã€‚</p><p>å†æä¸ªè£…3é˜¶å¼ é‡çš„ array å°±å¾—åˆ°äº†4é˜¶å¼ é‡ï¼Œä¾æ¬¡ç±»æ¨ï¼Œå°±æœ‰é«˜é˜¶å¼ é‡äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">x = np.array([[[<span class="number">5</span>, <span class="number">78</span>, <span class="number">2</span>, <span class="number">34</span>, <span class="number">0</span>],</span><br><span class="line">               [<span class="number">6</span>, <span class="number">79</span>, <span class="number">3</span>, <span class="number">35</span>, <span class="number">1</span>],</span><br><span class="line">               [<span class="number">7</span>, <span class="number">80</span>, <span class="number">4</span>, <span class="number">36</span>, <span class="number">2</span>]],</span><br><span class="line">              [[<span class="number">5</span>, <span class="number">78</span>, <span class="number">2</span>, <span class="number">34</span>, <span class="number">0</span>],</span><br><span class="line">               [<span class="number">6</span>, <span class="number">79</span>, <span class="number">3</span>, <span class="number">35</span>, <span class="number">1</span>],</span><br><span class="line">               [<span class="number">7</span>, <span class="number">80</span>, <span class="number">4</span>, <span class="number">36</span>, <span class="number">2</span>]],</span><br><span class="line">              [[<span class="number">5</span>, <span class="number">78</span>, <span class="number">2</span>, <span class="number">34</span>, <span class="number">0</span>],</span><br><span class="line">               [<span class="number">6</span>, <span class="number">79</span>, <span class="number">3</span>, <span class="number">35</span>, <span class="number">1</span>],</span><br><span class="line">               [<span class="number">7</span>, <span class="number">80</span>, <span class="number">4</span>, <span class="number">36</span>, <span class="number">2</span>]]])</span><br><span class="line">x.ndim</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>3</code></pre><p>æ·±åº¦å­¦ä¹ é‡Œï¼Œæˆ‘ä»¬ä¸€èˆ¬å°±ç”¨0ï½4é˜¶çš„å¼ é‡ã€‚</p><h3 id="å¼ é‡çš„ä¸‰è¦ç´ "><a href="#å¼ é‡çš„ä¸‰è¦ç´ " class="headerlink" title="å¼ é‡çš„ä¸‰è¦ç´ "></a>å¼ é‡çš„ä¸‰è¦ç´ </h3><ul><li>é˜¶æ•°ï¼ˆè½´çš„ä¸ªæ•°ï¼‰ï¼š3ï¼Œ5ï¼Œâ€¦</li><li>å½¢çŠ¶ï¼ˆå„è½´ç»´æ•°ï¼‰ï¼š(2, 1, 3)ï¼Œ(6, 5, 5, 3, 6)ï¼Œâ€¦</li><li>æ•°æ®ç±»å‹ï¼šfloat32ï¼Œuint8ï¼Œâ€¦</li></ul><p>æˆ‘ä»¬æ¥çœ‹çœ‹ MNIST é‡Œçš„å¼ é‡æ•°æ®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.datasets <span class="keyword">import</span> mnist</span><br><span class="line">(train_images, train_labels), (test_images, test_labels) = mnist.load_data()</span><br><span class="line"></span><br><span class="line">print(train_images.ndim)</span><br><span class="line">print(train_images.shape)</span><br><span class="line">print(train_images.dtype)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>3(60000, 28, 28)uint8</code></pre><p>æ‰€ä»¥ train_images æ˜¯ä¸ª8ä½æ— ç¬¦å·æ•´æ•°çš„3é˜¶å¼ é‡ã€‚</p><p>æ‰“å°ä¸ªé‡Œé¢çš„å›¾ç‰‡çœ‹çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">digit = train_images[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;image:&quot;</span>)</span><br><span class="line">plt.imshow(digit, cmap=plt.cm.binary)</span><br><span class="line">plt.show()</span><br><span class="line">print(<span class="string">&quot;label: &quot;</span>, train_labels[<span class="number">0</span>])</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gepeqfrnx9j3073070747.jpg" alt="ä¸€å¼ å›¾ç‰‡ï¼Œæ˜¾ç¤ºäº†ä¸€ä¸ªä½äºå›¾åƒä¸­å¤®çš„æ•°å­—5"></p><pre><code>label:  5</code></pre><h3 id="Numpyå¼ é‡æ“ä½œ"><a href="#Numpyå¼ é‡æ“ä½œ" class="headerlink" title="Numpyå¼ é‡æ“ä½œ"></a>Numpyå¼ é‡æ“ä½œ</h3><h4 id="å¼ é‡åˆ‡ç‰‡ï¼š"><a href="#å¼ é‡åˆ‡ç‰‡ï¼š" class="headerlink" title="å¼ é‡åˆ‡ç‰‡ï¼š"></a>å¼ é‡åˆ‡ç‰‡ï¼š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">my_slice = train_images[<span class="number">10</span>:<span class="number">100</span>]</span><br><span class="line">print(my_slice.shape)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>(90, 28, 28)</code></pre><p>ç­‰ä»·äºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">my_slice = train_images[<span class="number">10</span>:<span class="number">100</span>, :, :]</span><br><span class="line">print(my_slice.shape)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>(90, 28, 28)</code></pre><p>ä¹Ÿç­‰ä»·äº</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">my_slice = train_images[<span class="number">10</span>:<span class="number">100</span>, <span class="number">0</span>:<span class="number">28</span>, <span class="number">0</span>:<span class="number">28</span>]</span><br><span class="line">print(my_slice.shape)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>(90, 28, 28)</code></pre><p>é€‰å‡º <strong>å³ä¸‹è§’</strong> 14x14 çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">my_slice = train_images[:, <span class="number">14</span>:, <span class="number">14</span>:]</span><br><span class="line">plt.imshow(my_slice[<span class="number">0</span>], cmap=plt.cm.binary)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gepeimx6pwj3073070a9v.jpg" alt="ä¸€å¼ å›¾ç‰‡ï¼Œåœ¨å·¦ä¸Šè§’æœ‰æ•°å­—5çš„ä¸€éƒ¨åˆ†"></p><p>é€‰å‡º ä¸­å¿ƒå¤„ 14x14 çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">my_slice = train_images[:, <span class="number">7</span>:-<span class="number">7</span>, <span class="number">7</span>:-<span class="number">7</span>]</span><br><span class="line">plt.imshow(my_slice[<span class="number">0</span>], cmap=plt.cm.binary)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gepeiqkaq6j3073070jr7.jpg" alt="ä¸€å¼ å›¾ç‰‡ï¼Œæ˜¾ç¤ºäº†ä¸€ä¸ªæ•°å­—5ï¼Œå æ»¡äº†æ•´ä¸ªå›¾ç‰‡"></p><h4 id="æ•°æ®æ‰¹é‡"><a href="#æ•°æ®æ‰¹é‡" class="headerlink" title="æ•°æ®æ‰¹é‡"></a>æ•°æ®æ‰¹é‡</h4><p>æ·±åº¦å­¦ä¹ çš„æ•°æ®é‡Œï¼Œä¸€èˆ¬ç¬¬ä¸€ä¸ªè½´ï¼ˆindex=0ï¼‰å«åšã€Œæ ·æœ¬è½´ã€ï¼ˆæˆ–è€…è¯´ã€Œæ ·æœ¬ç»´åº¦ã€ï¼‰ã€‚</p><p>æ·±åº¦å­¦ä¹ é‡Œï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šä¸€æ¬¡æ€§å¤„ç†æ•´ä¸ªæ•°æ®é›†ï¼Œæˆ‘ä»¬ä¸€æ‰¹ä¸€æ‰¹åœ°å¤„ç†ã€‚</p><p>åœ¨ MNIST ä¸­ï¼Œæˆ‘ä»¬çš„ä¸€ä¸ªæ‰¹é‡æ˜¯ 128 ä¸ªæ•°æ®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ä¸€æ‰¹</span></span><br><span class="line">batch = train_images[:<span class="number">128</span>]</span><br><span class="line"><span class="comment"># ç¬¬äºŒæ‰¹</span></span><br><span class="line">batch = train_images[<span class="number">128</span>:<span class="number">256</span>]</span><br><span class="line"><span class="comment"># ç¬¬næ‰¹</span></span><br><span class="line">n = <span class="number">12</span></span><br><span class="line">batch = train_images[<span class="number">128</span> * n : <span class="number">128</span> * (n+<span class="number">1</span>)]</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œåœ¨ä½¿ç”¨ batch çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹ŸæŠŠç¬¬ä¸€ä¸ªè½´å«åšã€Œæ‰¹é‡è½´ã€ã€‚</p><h3 id="å¸¸è§æ•°æ®å¼ é‡è¡¨ç¤º"><a href="#å¸¸è§æ•°æ®å¼ é‡è¡¨ç¤º" class="headerlink" title="å¸¸è§æ•°æ®å¼ é‡è¡¨ç¤º"></a>å¸¸è§æ•°æ®å¼ é‡è¡¨ç¤º</h3><table><thead><tr><th align="center">æ•°æ®</th><th align="center">å¼ é‡ç»´æ•°</th><th align="left">å½¢çŠ¶</th></tr></thead><tbody><tr><td align="center">å‘é‡æ•°æ®</td><td align="center">2D</td><td align="left">(samples,features)</td></tr><tr><td align="center">æ—¶é—´åºåˆ—</td><td align="center">3D</td><td align="left">(samples, timesteps, features)</td></tr><tr><td align="center">å›¾åƒ</td><td align="center">4D</td><td align="left">(samples, height, width, channels) æˆ– (samples, channels, height, width)</td></tr><tr><td align="center">è§†é¢‘</td><td align="center">5D</td><td align="left">(samples, frames, height, width, channels) æˆ– (samples, frames, channels, height, width)</td></tr></tbody></table><h2 id="ç¥ç»ç½‘ç»œçš„â€œé½¿è½®â€-å¼ é‡è¿ç®—"><a href="#ç¥ç»ç½‘ç»œçš„â€œé½¿è½®â€-å¼ é‡è¿ç®—" class="headerlink" title="ç¥ç»ç½‘ç»œçš„â€œé½¿è½®â€: å¼ é‡è¿ç®—"></a>ç¥ç»ç½‘ç»œçš„â€œé½¿è½®â€: å¼ é‡è¿ç®—</h2><p>åœ¨æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç¥ç»ç½‘ç»œä¾‹å­ä¸­(MNIST)ï¼Œæˆ‘ä»¬çš„æ¯ä¸€å±‚å…¶å®éƒ½æ˜¯å¯¹è¾“å…¥æ•°æ®åšäº†ç±»ä¼¼å¦‚ä¸‹çš„è¿ç®—ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">output &#x3D; relu(dot(W, input) + b)</span><br></pre></td></tr></table></figure><p>input æ˜¯è¾“å…¥ï¼Œ<br>W å’Œ b æ˜¯å±‚çš„å±æ€§ï¼Œ<br>output æ˜¯è¾“å‡ºã€‚</p><p>è¿™äº›ä¸œè¥¿ä¹‹é—´åšäº† reluã€dotã€add è¿ç®—ï¼Œ<br>æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šè§£é‡Šè¿™äº›è¿ç®—ã€‚</p><h3 id="é€å…ƒç´ æ“ä½œ-Element-wise"><a href="#é€å…ƒç´ æ“ä½œ-Element-wise" class="headerlink" title="é€å…ƒç´ æ“ä½œ(Element-wise)"></a>é€å…ƒç´ æ“ä½œ(Element-wise)</h3><p>Element-wise çš„æ“ä½œï¼Œå°±æ˜¯åˆ†åˆ«å¯¹å¼ é‡ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ä½œç”¨ã€‚<br>æ¯”å¦‚ï¼Œæˆ‘ä»¬å®ç°ä¸€ä¸ªç®€å•çš„ <code>relu</code> ï¼ˆ<code>relu(x) = max(x, 0)</code>ï¼‰:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">naive_relu</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(x.shape) == <span class="number">2</span>    <span class="comment"># x is a 2D Numpy tensor.</span></span><br><span class="line">    x = x.copy()    <span class="comment"># Avoid overwriting the input tensor.</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(x.shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(x.shape[<span class="number">1</span>]):</span><br><span class="line">            x[i, j] = <span class="built_in">max</span>(x[i, j], <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure><p>åŠ æ³•ä¹Ÿæ˜¯é€å…ƒç´ æ“ä½œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">naive_add</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="comment"># assert x and y are 2D Numpy tensors and have the same shape.</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(x.shape) == <span class="number">2</span></span><br><span class="line">    <span class="keyword">assert</span> x.shape == y.shape</span><br><span class="line">    </span><br><span class="line">    x = x.copy()    <span class="comment"># Avoid overwriting the input tensor.</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(x.shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(x.shape[<span class="number">1</span>]):</span><br><span class="line">            x[i, j] += y[i, j]</span><br><span class="line">    <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure><p>åœ¨ Numpy é‡Œï¼Œè¿™äº›éƒ½å†™å¥½äº†ã€‚ å…·ä½“çš„è¿ç®—æ˜¯äº¤ç»™ C æˆ– Fortran å†™çš„ BLAS è¿›è¡Œçš„ï¼Œé€Ÿåº¦å¾ˆé«˜ã€‚</p><p>ä½ å¯ä»¥è¿™æ ·æŸ¥çœ‹æœ‰æ²¡æœ‰è£… BLASï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">np.show_config()</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>blas_mkl_info:  NOT AVAILABLEblis_info:  NOT AVAILABLEopenblas_info:    libraries = [&#39;openblas&#39;, &#39;openblas&#39;]    library_dirs = [&#39;/usr/local/lib&#39;]    language = c    define_macros = [(&#39;HAVE_CBLAS&#39;, None)]blas_opt_info:    libraries = [&#39;openblas&#39;, &#39;openblas&#39;]    library_dirs = [&#39;/usr/local/lib&#39;]    language = c    define_macros = [(&#39;HAVE_CBLAS&#39;, None)]lapack_mkl_info:  NOT AVAILABLEopenblas_lapack_info:    libraries = [&#39;openblas&#39;, &#39;openblas&#39;]    library_dirs = [&#39;/usr/local/lib&#39;]    language = c    define_macros = [(&#39;HAVE_CBLAS&#39;, None)]lapack_opt_info:    libraries = [&#39;openblas&#39;, &#39;openblas&#39;]    library_dirs = [&#39;/usr/local/lib&#39;]    language = c    define_macros = [(&#39;HAVE_CBLAS&#39;, None)]</code></pre><p>ä¸‹é¢æ˜¯å¦‚ä½•ä½¿ç”¨ numpy çš„é€å…ƒç´  reluã€addï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">a = np.array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">              [-<span class="number">1</span>, <span class="number">2</span>, -<span class="number">3</span>],</span><br><span class="line">              [<span class="number">3</span>, -<span class="number">1</span>, <span class="number">4</span>]])</span><br><span class="line">b = np.array([[<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>], </span><br><span class="line">              [-<span class="number">2</span>, -<span class="number">3</span>, <span class="number">1</span>], </span><br><span class="line">              [<span class="number">1</span>, <span class="number">0</span>, <span class="number">4</span>]])</span><br><span class="line"></span><br><span class="line">c = a + b    <span class="comment"># Element-wise addition</span></span><br><span class="line">d = np.maximum(c, <span class="number">0</span>)    <span class="comment"># Element-wise relu</span></span><br><span class="line"></span><br><span class="line">print(c)</span><br><span class="line">print(d)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>[[ 7  9 11] [-3 -1 -2] [ 4 -1  8]][[ 7  9 11] [ 0  0  0] [ 4  0  8]]</code></pre><h3 id="å¹¿æ’­-Broadcasting"><a href="#å¹¿æ’­-Broadcasting" class="headerlink" title="å¹¿æ’­(Broadcasting)"></a>å¹¿æ’­(Broadcasting)</h3><p>å½“è¿›è¡Œé€å…ƒç´ è¿ç®—æ—¶ï¼Œå¦‚æœä¸¤ä¸ªå¼ é‡çš„å½¢çŠ¶ä¸åŒï¼Œåœ¨å¯è¡Œçš„æƒ…å†µä¸‹ï¼Œè¾ƒå°çš„å¼ é‡ä¼šã€Œå¹¿æ’­ã€æˆå’Œè¾ƒå¤§çš„å¼ é‡ä¸€æ ·çš„å½¢çŠ¶ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œå¯ä»¥é€šè¿‡å¹¿æ’­ï¼Œå¯¹å½¢çŠ¶ä¸º <code>(a, b, ..., n, n+1, ..., m)</code> å’Œ <code>(n, n+1, ..., m)</code> çš„ä¸¤ä¸ªå¼ é‡è¿›è¡Œé€å…ƒç´ è¿ç®—ã€‚</p><p>æ¯”å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = np.random.random((<span class="number">64</span>, <span class="number">3</span>, <span class="number">32</span>, <span class="number">10</span>))    <span class="comment"># x is a random tensor with shape (64, 3, 32, 10).</span></span><br><span class="line">y = np.random.random((<span class="number">32</span>, <span class="number">10</span>))    <span class="comment"># y is a random tensor with shape (32, 10).</span></span><br><span class="line">z = np.maximum(x, y)    <span class="comment"># The output z has shape (64, 3, 32, 10) like x.</span></span><br></pre></td></tr></table></figure><p>å¹¿æ’­çš„æ“ä½œå¦‚ä¸‹ï¼š</p><ol><li>å°å¼ é‡å¢åŠ è½´ï¼ˆå¹¿æ’­è½´ï¼‰ï¼ŒåŠ åˆ°å’Œå¤§çš„ä¸€æ ·ï¼ˆndimï¼‰</li><li>å°å¼ é‡çš„å…ƒç´ åœ¨æ–°è½´ä¸Šé‡å¤ï¼ŒåŠ åˆ°å’Œå¤§çš„ä¸€æ ·ï¼ˆshapeï¼‰</li></ol><p>E.g. </p><pre><code>x: (32, 10), y: (10,)Step 1: add an empty first axis to y: Y -&gt; (1, 10)Step 2: repeat y 32 times alongside this new axis: Y -&gt; (32, 10)</code></pre><p>åœ¨å®Œæˆåï¼Œæœ‰ <code>Y[i, :] == y for i in range(0, 32)</code></p><p>å½“ç„¶ï¼Œåœ¨å®é™…çš„å®ç°é‡Œï¼Œæˆ‘ä»¬ä¸è¿™æ ·å»å¤åˆ¶ï¼Œè¿™æ ·å¤ªæµªè´¹ç©ºé—´äº†ï¼Œ<br>æˆ‘ä»¬æ˜¯ç›´æ¥åœ¨ç®—æ³•é‡Œå®ç°è¿™ä¸ªâ€œå¤åˆ¶çš„â€ã€‚<br>æ¯”å¦‚ï¼Œæˆ‘ä»¬å®ç°ä¸€ä¸ªç®€å•çš„å‘é‡å’ŒçŸ©é˜µç›¸åŠ ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">naive_add_matrix_and_vector</span>(<span class="params">m, v</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(m.shape) == <span class="number">2</span>    <span class="comment"># m is a 2D Numpy tensor.</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(v.shape) == <span class="number">1</span>    <span class="comment"># v is a Numpy vector.</span></span><br><span class="line">    <span class="keyword">assert</span> m.shape[<span class="number">1</span>] == v.shape[<span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line">    m = m.copy()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m.shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(m.shape[<span class="number">1</span>]):</span><br><span class="line">            m[i, j] += v[j]</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line">naive_add_matrix_and_vector(np.array([[<span class="number">1</span> ,<span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]]), </span><br><span class="line">                            np.array([<span class="number">1</span>, -<span class="number">1</span>, <span class="number">100</span>]))</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>array([[  2,   1, 103],       [  5,   4, 106],       [  8,   7, 109]])</code></pre><h3 id="å¼ é‡ç‚¹ç§¯-dot"><a href="#å¼ é‡ç‚¹ç§¯-dot" class="headerlink" title="å¼ é‡ç‚¹ç§¯(dot)"></a>å¼ é‡ç‚¹ç§¯(dot)</h3><p>å¼ é‡ç‚¹ç§¯ï¼Œæˆ–è€…å«å¼ é‡ä¹˜ç§¯ï¼Œåœ¨ numpy é‡Œç”¨ <code>dot(x, y)</code> å®Œæˆã€‚</p><p>ç‚¹ç§¯çš„æ“ä½œå¯ä»¥ä»å¦‚ä¸‹çš„ç®€å•ç¨‹åºä¸­çœ‹å‡ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘é‡ç‚¹ç§¯</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">naive_vector_dot</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(x.shape) == <span class="number">1</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(y.shape) == <span class="number">1</span></span><br><span class="line">    <span class="keyword">assert</span> x.shape[<span class="number">0</span>] == y.shape[<span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line">    z = <span class="number">0.</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(x.shape[<span class="number">0</span>]):</span><br><span class="line">        z += x[i] * y[i]</span><br><span class="line">    <span class="keyword">return</span> z</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># çŸ©é˜µä¸å‘é‡ç‚¹ç§¯</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">naive_matrix_vector_dot</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    z = np.zeros(x.shape[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(x.shape[<span class="number">0</span>]):</span><br><span class="line">        z[i] = naive_vector_dot(x[i, :], y)</span><br><span class="line">    <span class="keyword">return</span> z</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># çŸ©é˜µç‚¹ç§¯</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">naive_matrix_dot</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(x.shape) == <span class="number">2</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(y.shape) == <span class="number">2</span></span><br><span class="line">    <span class="keyword">assert</span> x.shape[<span class="number">1</span>] == y.shape[<span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line">    z = np.zeros((x.shape[<span class="number">0</span>], y.shape[<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(x.shape[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(y.shape[<span class="number">1</span>]):</span><br><span class="line">            row_x = x[i, :]</span><br><span class="line">            column_y = y[:, j]</span><br><span class="line">            z[i, j] = naive_vector_dot(row_x, column_y)</span><br><span class="line">    <span class="keyword">return</span> z</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a = np.array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">              [-<span class="number">1</span>, <span class="number">2</span>, -<span class="number">3</span>],</span><br><span class="line">              [<span class="number">3</span>, -<span class="number">1</span>, <span class="number">4</span>]])</span><br><span class="line">b = np.array([[<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>], </span><br><span class="line">              [-<span class="number">2</span>, -<span class="number">3</span>, <span class="number">1</span>], </span><br><span class="line">              [<span class="number">1</span>, <span class="number">0</span>, <span class="number">4</span>]])</span><br><span class="line">naive_matrix_dot(a, b)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>array([[  5.,   1.,  22.],       [-13., -13., -18.],       [ 24.,  24.,  39.]])</code></pre><p>å¯¹äºé«˜ç»´çš„å¼ é‡ç‚¹ç§¯ï¼Œå…¶å®ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚<br>ä¾‹å¦‚ï¼Œ(è¿™è¯´çš„æ˜¯shapeå“ˆ)ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(a, b, c, d) . (d,) -&gt; (a, b, c)</span><br><span class="line">(a, b, c, d) . (d, e) -&gt; (a, b, c, e)</span><br></pre></td></tr></table></figure><h3 id="å¼ é‡å˜å½¢-reshaping"><a href="#å¼ é‡å˜å½¢-reshaping" class="headerlink" title="å¼ é‡å˜å½¢(reshaping)"></a>å¼ é‡å˜å½¢(reshaping)</h3><p>è¿™ä¸ªæ“ä½œï¼Œç®€è¨€ä¹‹å°±æ˜¯ï¼Œï¼Œï¼Œè¿˜æ˜¯é‚£äº›å…ƒç´ ï¼Œåªæ˜¯æ’åˆ—çš„æ–¹å¼å˜äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x = np.array([[<span class="number">0.</span>, <span class="number">1.</span>],</span><br><span class="line">              [<span class="number">2.</span>, <span class="number">3.</span>],</span><br><span class="line">              [<span class="number">4.</span>, <span class="number">5.</span>]])</span><br><span class="line">print(x.shape)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>(3, 2)</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x.reshape((<span class="number">6</span>, <span class="number">1</span>))</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>array([[0.],       [1.],       [2.],       [3.],       [4.],       [5.]])</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x.reshape((<span class="number">2</span>, <span class="number">3</span>))</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>array([[0., 1., 2.],       [3., 4., 5.]])</code></pre><p>ã€Œè½¬ç½®ã€(transposition) æ˜¯ä¸€ç§ç‰¹æ®Šçš„çŸ©é˜µå˜å½¢ï¼Œ<br>è½¬ç½®å°±æ˜¯è¡Œåˆ—äº’æ¢ã€‚</p><p>åŸæ¥çš„ <code>x[i, :]</code>ï¼Œè½¬ç½®åå°±æˆäº† <code>x[:, i]</code>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = np.zeros((<span class="number">300</span>, <span class="number">20</span>))</span><br><span class="line">y = np.transpose(x)</span><br><span class="line">print(y.shape)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><pre><code>(20, 300)</code></pre><h2 id="ç¥ç»ç½‘ç»œçš„â€œå¼•æ“â€-åŸºäºæ¢¯åº¦çš„ä¼˜åŒ–"><a href="#ç¥ç»ç½‘ç»œçš„â€œå¼•æ“â€-åŸºäºæ¢¯åº¦çš„ä¼˜åŒ–" class="headerlink" title="ç¥ç»ç½‘ç»œçš„â€œå¼•æ“â€: åŸºäºæ¢¯åº¦çš„ä¼˜åŒ–"></a>ç¥ç»ç½‘ç»œçš„â€œå¼•æ“â€: åŸºäºæ¢¯åº¦çš„ä¼˜åŒ–</h2><p>å†çœ‹ä¸€æ¬¡æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç¥ç»ç½‘ç»œä¾‹å­ä¸­(MNIST)ï¼Œæ¯ä¸€å±‚å¯¹è¾“å…¥æ•°æ®åšçš„è¿ç®—ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">output &#x3D; relu(dot(W, input) + b)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå¼å­é‡Œï¼šW å’Œ b æ˜¯å±‚çš„å±æ€§ï¼ˆæƒé‡ï¼Œæˆ–ç€è¯´å¯è®­ç»ƒå‚æ•°ï¼‰ã€‚<br>å…·ä½“æ¥è¯´ï¼Œ</p><ul><li><code>W</code> æ˜¯ kernel å±æ€§ï¼›</li><li><code>b</code> æ˜¯ bias å±æ€§ã€‚</li></ul><p>è¿™äº›ã€Œæƒé‡ã€å°±æ˜¯ç¥ç»ç½‘ç»œä»æ•°æ®ä¸­å­¦ä¹ åˆ°çš„ä¸œè¥¿ã€‚</p><p>ä¸€å¼€å§‹ï¼Œè¿™äº›æƒé‡è¢«éšæœºåˆå§‹åŒ–æˆä¸€äº›è¾ƒå°çš„å€¼ã€‚ç„¶åä»è¿™æ¬¡éšæœºçš„è¾“å‡ºå¼€å§‹ï¼Œåé¦ˆè°ƒèŠ‚ï¼Œé€æ­¥æ”¹å–„ã€‚</p><p>è¿™ä¸ªæ”¹å–„çš„è¿‡ç¨‹æ˜¯åœ¨ã€Œè®­ç»ƒå¾ªç¯ã€ä¸­å®Œæˆçš„ï¼Œåªæœ‰å¿…è¦ï¼Œè¿™ä¸ªå¾ªç¯å¯ä»¥ä¸€ç›´è¿›è¡Œä¸‹å»ï¼š</p><ol><li>æŠ½å–ä¸€æ‰¹è®­ç»ƒæ•°æ® x ä»¥åŠå¯¹åº”çš„ y</li><li>å‘å‰ä¼ æ’­ï¼Œå¾—åˆ° x ç»è¿‡ç½‘ç»œç®—å‡ºæ¥çš„é¢„æµ‹ y_pred</li><li>é€šè¿‡ y_pred ä¸ yï¼Œè®¡ç®—å‡ºæŸå¤±</li><li>é€šè¿‡æŸç§æ–¹å¼è°ƒæ•´å‚æ•°ï¼Œå‡å°æŸå¤±</li></ol><p>å‰ä¸‰æ­¥éƒ½æ¯”è¾ƒç®€å•ï¼Œç¬¬4æ­¥æ›´æ–°å‚æ•°æ¯”è¾ƒå¤æ‚ï¼Œä¸€ç§æ¯”è¾ƒæœ‰æ•ˆã€å¯è¡Œçš„åŠæ³•å°±æ˜¯åˆ©ç”¨å¯å¾®æ€§ï¼Œé€šè¿‡è®¡ç®—æ¢¯åº¦ï¼Œå‘æ¢¯åº¦çš„åæ–¹å‘ç§»åŠ¨å‚æ•°ã€‚</p><h3 id="å¯¼æ•°-derivative"><a href="#å¯¼æ•°-derivative" class="headerlink" title="å¯¼æ•°(derivative)"></a>å¯¼æ•°(derivative)</h3><p>è¿™ä¸€èŠ‚è§£é‡Šäº†å¯¼æ•°çš„å®šä¹‰ã€‚</p><p>(ç›´æ¥å»çœ‹ä¹¦å§ã€‚)</p><p>çŸ¥é“äº†å¯¼æ•°ï¼Œé‚£è¦æ›´æ–° x æ¥æœ€å°åŒ–ä¸€ä¸ªå‡½æ•° <code>f(x)</code>ï¼Œå…¶å®åªéœ€å°† x å‘å¯¼æ•°çš„åæ–¹å‘ç§»åŠ¨ã€‚</p><h3 id="æ¢¯åº¦-gradient"><a href="#æ¢¯åº¦-gradient" class="headerlink" title="æ¢¯åº¦(gradient)"></a>æ¢¯åº¦(gradient)</h3><p>ã€Œæ¢¯åº¦ã€æ˜¯å¼ é‡è¿ç®—çš„å¯¼æ•°ã€‚æˆ–è€…è¯´ã€Œæ¢¯åº¦ã€æ˜¯ã€Œå¯¼æ•°ã€åœ¨å¤šå…ƒå‡½æ•°ä¸Šçš„æ¨å¹¿ã€‚<br>æŸç‚¹çš„æ¢¯åº¦ä»£è¡¨çš„æ˜¯è¯¥ç‚¹çš„æ›²ç‡ã€‚</p><p>è€ƒè™‘:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">y_pred &#x3D; dot(W, x)</span><br><span class="line">loss_value &#x3D; loss(y_pred, y)</span><br></pre></td></tr></table></figure><p>è‹¥å›ºå®š x å’Œ yï¼Œåˆ™ loss_value å°†æ˜¯ä¸€ä¸ª W çš„å‡½æ•°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loss_value &#x3D; f(W)</span><br></pre></td></tr></table></figure><p>è®¾å½“å‰ç‚¹ä¸º <code>W0</code>ï¼Œ<br>åˆ™ f åœ¨ W0 çš„å¯¼æ•°(æ¢¯åº¦)è®°ä¸º <code>gradient(f)(W0)</code>ï¼Œ<br>è¿™ä¸ªæ¢¯åº¦å€¼ä¸ W åŒå‹ã€‚<br>å…¶ä¸­æ¯ä¸ªå…ƒç´  <code>gradient(f) (W0)[i, j]</code> ä»£è¡¨æ”¹å˜ <code>W0[i, j]</code> æ—¶ï¼Œf çš„å˜åŒ–æ–¹å‘åŠå¤§å°ã€‚</p><p>æ‰€ä»¥ï¼Œè¦æ”¹å˜ W çš„å€¼æ¥å®ç° <code>min f</code>ï¼Œå°±å¯ä»¥å‘æ¢¯åº¦çš„åæ–¹å‘ï¼ˆå³<strong>æ¢¯åº¦ä¸‹é™</strong>çš„æ–¹å‘ï¼‰ç§»åŠ¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">W1 &#x3D; W0 - step * gradient(f)(W0)</span><br></pre></td></tr></table></figure><h3 id="éšæœºæ¢¯åº¦ä¸‹é™-Stochastic-gradient-descent"><a href="#éšæœºæ¢¯åº¦ä¸‹é™-Stochastic-gradient-descent" class="headerlink" title="éšæœºæ¢¯åº¦ä¸‹é™(Stochastic gradient descent)"></a>éšæœºæ¢¯åº¦ä¸‹é™(Stochastic gradient descent)</h3><p>ç†è®ºä¸Šï¼Œç»™å®šä¸€ä¸ªå¯å¾®å‡½æ•°ï¼Œå…¶æœ€å°å€¼ä¸€å®šåœ¨å¯¼æ•°ä¸º0çš„ç‚¹ä¸­å–åˆ°ã€‚æ‰€ä»¥æˆ‘ä»¬åªæœ‰æ±‚å‡ºæ‰€æœ‰å¯¼æ•°ä¸º0çš„ç‚¹ï¼Œæ¯”è¾ƒå…¶å‡½æ•°å€¼ï¼Œå°±å¯ä»¥å¾—åˆ°æœ€å°å€¼ã€‚</p><p>è¿™ä¸ªæ–¹æ³•æ”¾åˆ°ç¥ç»ç½‘ç»œä¸­ï¼Œå°±éœ€è¦è§£ä¸€ä¸ªå…³äº <code>W</code> çš„æ–¹ç¨‹ <code>gradient(f)(W) = 0</code>ï¼Œè¿™æ˜¯ä¸ª N å…ƒæ–¹ç¨‹ï¼ˆN=ç¥ç»ç½‘ç»œä¸­å‚æ•°ä¸ªæ•°ï¼‰ï¼Œè€Œå®é™…ä¸ŠNä¸€èˆ¬ä¸ä¼šå°‘äº1kï¼Œè¿™ä½¿å¾—è§£è¿™ä¸ªæ–¹ç¨‹å˜å¾—å‡ ä¹ä¸å¯è¡Œã€‚</p><p>æ‰€ä»¥é¢å¯¹è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åˆ©ç”¨ä¸Šé¢ä»‹ç»çš„4æ­¥æ³•ï¼Œå…¶ä¸­ç¬¬å››æ­¥ä½¿ç”¨æ¢¯åº¦ä¸‹é™ï¼Œé€æ­¥å¾€æ¢¯åº¦çš„åæ–¹å‘æ›´æ–°å‚æ•°ï¼Œä¸€å°æ­¥ä¸€å°æ­¥åœ°æœå‡å°æŸå¤±çš„æ–¹å‘å‰è¿›ï¼š</p><ol><li>æŠ½å–ä¸€æ‰¹è®­ç»ƒæ•°æ® x ä»¥åŠå¯¹åº”çš„ y</li><li>å‘å‰ä¼ æ’­ï¼Œå¾—åˆ° x ç»è¿‡ç½‘ç»œç®—å‡ºæ¥çš„é¢„æµ‹ y_pred</li><li>é€šè¿‡ y_pred ä¸ yï¼Œè®¡ç®—å‡ºæŸå¤±</li><li>é€šè¿‡æŸç§æ–¹å¼è°ƒæ•´å‚æ•°ï¼Œå‡å°æŸå¤±<ol><li>å‘åä¼ æ’­ï¼Œè®¡ç®—æŸå¤±å‡½æ•°å…³äºç½‘ç»œå‚æ•°çš„æ¢¯åº¦</li><li>æœæ¢¯åº¦çš„åæ–¹å‘ç¨å¾®ç§»åŠ¨å‚æ•°å³å¯å‡å°æŸå¤±ï¼ˆW -= step * gradientï¼‰</li></ol></li></ol><p>è¿™ä¸ªæ–¹æ³•å«åšã€Œå°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™ã€ï¼ˆmini-batch stochastic gradient descentï¼Œmini-batch SGDï¼‰ã€‚<br>éšæœºä¸€è¯æ˜¯æŒ‡æˆ‘ä»¬åœ¨ç¬¬1æ­¥æŠ½å–æ•°æ®æ˜¯éšæœºæŠ½å–çš„ã€‚</p><p>æœ‰ä¸€äº›å˜ç§çš„ SGD ä¸åªçœ‹å½“å‰æ¢¯åº¦å°±æ›´æ–°å€¼äº†ï¼Œå®ƒä»¬è¿˜è¦çœ‹ä¸Šä¸€æ¬¡çš„æƒé‡æ›´æ–°ã€‚è¿™äº›å˜ä½“è¢«ç§°ä½œã€Œä¼˜åŒ–æ–¹æ³•(optimization method)ã€æˆ–è€…ã€Œä¼˜åŒ–å™¨(optimizer)ã€ã€‚åœ¨å¾ˆå¤šè¿™äº›å˜ä½“ä¸­ï¼Œéƒ½ä¼šä½¿ç”¨ä¸€ä¸ªå«ã€ŒåŠ¨é‡(momentum)ã€çš„æ¦‚å¿µã€‚</p><p>ã€ŒåŠ¨é‡ã€ä¸»è¦å¤„ç† SGD ä¸­çš„ä¸¤ä¸ªé—®é¢˜ï¼šæ”¶æ•›é€Ÿåº¦å’Œå±€éƒ¨æå°ç‚¹ã€‚<br>ç”¨åŠ¨é‡å¯ä»¥é¿å…åœ¨ learning rate æ¯”è¾ƒå°æ—¶æ”¶æ•›åˆ°å±€éƒ¨æœ€ä¼˜è§£ï¼Œè€Œä¸æ˜¯å‘å…¨å±€æœ€ä¼˜è§£ç»§ç»­å‰è¿›ã€‚</p><p>è¿™é‡Œçš„åŠ¨é‡å°±æ˜¯æ¥è‡ªç‰©ç†çš„é‚£ä¸ªåŠ¨é‡æ¦‚å¿µã€‚æˆ‘ä»¬å¯ä»¥æƒ³è±¡ï¼Œä¸€ä¸ªå°çƒåœ¨æŸå¤±æ›²é¢ä¸Šå¾€ä¸‹(æ¢¯åº¦ä¸‹é™çš„æ–¹å‘)æ»šï¼Œå¦‚æœæœ‰è¶³å¤Ÿçš„åŠ¨é‡ï¼Œå®ƒå°±å¯ä»¥â€œå†²è¿‡â€å±€éƒ¨æœ€å°å€¼ï¼Œä¸è¢«å›°åœ¨é‚£é‡Œã€‚<br>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå°çƒçš„è¿åŠ¨ä¸ä½†è¢«å½“å‰ä½ç½®çš„å¡åº¦ï¼ˆå½“å‰çš„åŠ é€Ÿåº¦ï¼‰å†³å®šï¼Œè¿˜å—å½“å‰çš„é€Ÿåº¦ï¼ˆè¿™å–å†³äºä¹‹å‰çš„åŠ é€Ÿåº¦ï¼‰çš„å½±å“ã€‚</p><p>è¿™ä¸ªæ€æƒ³æ”¾åˆ°ç¥ç»ç½‘ç»œä¸­ï¼Œä¹Ÿå°±æ˜¯ï¼Œä¸€æ¬¡æƒé‡å€¼çš„æ›´æ–°ï¼Œä¸ä½†çœ‹å½“å‰çš„æ¢¯åº¦ï¼Œè¿˜è¦çœ‹ä¸Šä¸€æ¬¡æƒé‡æ›´æ–°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># naive implementation of Optimization with momentum</span></span><br><span class="line">past_velocity = <span class="number">0.</span></span><br><span class="line">momentum = <span class="number">0.1</span>    <span class="comment"># Constant momentum factor</span></span><br><span class="line"><span class="keyword">while</span> loss &gt; <span class="number">0.01</span>:    <span class="comment"># Optimization loop</span></span><br><span class="line">    w, loss, gradient = get_current_parameters()</span><br><span class="line">    velocity = past_velocity * momentum + learning_rate * gradient</span><br><span class="line">    w = w + momentum * velocity - learning_rate * gradient</span><br><span class="line">    past_velocity = velocity</span><br><span class="line">    update_parameter(w)</span><br></pre></td></tr></table></figure><h3 id="åå‘ä¼ æ’­ç®—æ³•ï¼šé“¾å¼æ±‚å¯¼"><a href="#åå‘ä¼ æ’­ç®—æ³•ï¼šé“¾å¼æ±‚å¯¼" class="headerlink" title="åå‘ä¼ æ’­ç®—æ³•ï¼šé“¾å¼æ±‚å¯¼"></a>åå‘ä¼ æ’­ç®—æ³•ï¼šé“¾å¼æ±‚å¯¼</h3><p>ç¥ç»ç½‘ç»œæ˜¯ä¸€å¤§å †å¼ é‡æ“ä½œé“¾å¼å’Œåœ¨ä¸€èµ·çš„ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f(W1, W2, W3) &#x3D; a(W1, b(W2, c(W3)))    # å…¶ä¸­ W1, W2, W3 æ˜¯æƒé‡</span><br></pre></td></tr></table></figure><p>å¾®ç§¯åˆ†é‡Œæœ‰ä¸ªã€Œé“¾å¼æ³•åˆ™(chain rule)ã€å¯ä»¥ç»™è¿™ç§å¤åˆå‡½æ•°æ±‚å¯¼ï¼š<code>f(g(x)) = f&#39;(g(x)) * g&#39;(x)</code></p><p>æŠŠè¿™ä¸ªé“¾å¼æ³•åˆ™ç”¨åˆ°ç¥ç»ç½‘ç»œå°±æå‡ºäº†ä¸€ä¸ªå«ã€Œåå‘ä¼ æ’­(Backpropagation)ã€çš„ç®—æ³•ï¼Œ<br>è¿™ä¸ªç®—æ³•ä¹Ÿå«ã€Œåå¼å¾®åˆ†(reverse-mode differentiation)ã€ã€‚</p><p>åå‘ä¼ æ’­ä»æœ€ç»ˆç®—å‡ºçš„æŸå¤±å‡ºå‘ï¼Œä»ç¥ç»ç½‘ç»œçš„æœ€é¡¶å±‚åå‘ä½œç”¨è‡³æœ€åº•å±‚ï¼Œç”¨è¿™ä¸ªé“¾å¼æ³•åˆ™ç®—å‡ºæ¯å±‚é‡Œæ¯ä¸ªå‚æ•°å¯¹äºæŸå¤±çš„è´¡çŒ®å¤§å°ã€‚</p><p>ç°åœ¨çš„ TensorFlow ä¹‹ç±»çš„æ¡†æ¶ï¼Œéƒ½æœ‰ç§å«ã€Œç¬¦å·å¾®åˆ†(symbolic differentiation)ã€çš„èƒ½åŠ›ã€‚<br>è¿™ä½¿å¾—è¿™äº›æ¡†æ¶å¯ä»¥è‡ªåŠ¨æ±‚å‡ºç»™å®šç¥ç»ç½‘ç»œé‡Œæ“ä½œçš„æ¢¯åº¦å‡½æ•°ï¼Œç„¶åæˆ‘ä»¬å°±ä¸ç”¨æ‰‹åŠ¨å®ç°åå‘ä¼ æ’­äº†ï¼ˆè™½ç„¶æœ‰æ„æ€ï¼Œä½†å†™èµ·æ¥çœŸçš„çƒ¦ï¼‰ï¼Œç›´æ¥ä»æ¢¯åº¦å‡½æ•°å–å€¼å°±è¡Œäº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> Deep Learning with Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
            <tag> Deep Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•ç”¨ pip å®‰è£…è‡ªå·±å†™çš„åŒ…</title>
      <link href="/2020/05/07/blog/pip-install-yourselfs-packages/"/>
      <url>/2020/05/07/blog/pip-install-yourselfs-packages/</url>
      
        <content type="html"><![CDATA[<h1 id="å¦‚ä½•ç”¨-pip-å®‰è£…è‡ªå·±å†™çš„åŒ…"><a href="#å¦‚ä½•ç”¨-pip-å®‰è£…è‡ªå·±å†™çš„åŒ…" class="headerlink" title="å¦‚ä½•ç”¨ pip å®‰è£…è‡ªå·±å†™çš„åŒ…"></a>å¦‚ä½•ç”¨ pip å®‰è£…è‡ªå·±å†™çš„åŒ…</h1><p>æ˜¨å¤©çªå‘å¥‡æƒ³ï¼Œæƒ³è®©è‡ªå·±å†™çš„åŒ…ä¹Ÿå¯ä»¥åƒæˆ‘ä»¬å¸¸ç”¨çš„ numpyã€flaskã€tensorflow é‚£æ ·ç›´æ¥ä¸€ä¸ª <code>pip install XXX</code> å‘½ä»¤å°±å®‰è£…ä¸Šã€‚</p><p>è¦å®ç°è¿™ä¸ªï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ pip å’Œ Pypiã€‚</p><p>ï¼ˆå¦‚æœä½ æ‡‚ä¸€ç‚¹ç‚¹è‹±è¯­ï¼Œè¯·ç›´æ¥çœ‹è¿™ç¯‡æ–‡æ¡£ï¼š<a href="https://packaging.python.org/guides/distributing-packages-using-setuptools/#packaging-and-distributing-projects">Packaging and distributing projects</a>ï¼‰</p><p>ï¼ˆå¦‚æœä½ ç”¨ Windowsï¼Œæˆ‘ä¸ä¿è¯ä½ å¯ä»¥é¡ºåˆ©å®Œæˆæ‰€æœ‰æ“ä½œï¼Œè‡ªæ±‚å¤šç¦ [å‘Šè¾]ï¼‰</p><h2 id="Pypi"><a href="#Pypi" class="headerlink" title="Pypi"></a>Pypi</h2><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gejog1c7xdj31e00u0kdb.jpg" alt="pypi"></p><blockquote><p>The Python Package Index (PyPI) is a repository of software for the Python programming language.</p></blockquote><p>è¿™æ˜¯ <a href="https://pypi.org/">Pypi</a> çš„å®˜ç½‘ä¸Šå¯¹è‡ªå·±çš„æè¿°ï¼Œå¤§æ¦‚ç¿»è¯‘ä¸€ä¸‹ï¼š</p><blockquote><p>Python Package Index (PyPI) æ˜¯ Python ç¼–ç¨‹è¯­è¨€çš„è½¯ä»¶åº“ã€‚</p></blockquote><p>å…¶å®ï¼Œæˆ‘ä»¬å¹³æ—¶ä½¿ç”¨ pip æ—¶ï¼Œå°±æ˜¯åœ¨ Pypi é‡Œæ‹‰å–è¿™äº›åŒ…çš„ï¼Œä¾‹å¦‚ï¼š</p><ul><li><a href="https://pypi.org/project/numpy/">numpy</a>: pip install numpy</li><li><a href="https://pypi.org/project/tensorflow/">tensorflow</a>: pip install tensorflow</li></ul><p>å¦‚ä½•ç”¨ pip å®‰è£…åŒ…å¯ä»¥å‚è€ƒï¼š<a href="https://packaging.python.org/tutorials/installing-packages/">æ–‡æ¡£ - Installing Packages</a>ï¼Œè¿™ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ã€‚</p><p>æˆ‘ä»¬æ¥ä¸‹æ¥å‚è€ƒ <a href="https://packaging.python.org/tutorials/packaging-projects/">æ–‡æ¡£ - Packaging Python Projects</a>ï¼Œè®¨è®ºå¦‚ä½•æ‰“åŒ…ã€å‘å¸ƒè‡ªå·±çš„é¡¹ç›®ï¼Œç„¶åç”¨ pip å®‰è£…è‡ªå·±å†™çš„åŒ…ã€‚</p><h2 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h2><p>å¤§å®¶éƒ½çŸ¥é“ï¼ˆä¸ç„¶è¿™ç¯‡æ–‡ç« è¿˜ä¸é€‚åˆç°åœ¨çš„ä½ ï¼Œä¸ç”¨çœ‹äº†ï¼‰ï¼Œæˆ‘ä»¬å†™ä¸€ä¸ª Python é¡¹ç›®æ—¶ï¼Œæœ€åŸºæœ¬çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">packaging_tutorial&#x2F;</span><br><span class="line">  example_pkg&#x2F;</span><br><span class="line">    __init__.py</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬è¦å¼€æºæˆ–è€…ä»¥å…¶ä»–å½¢å¼å‘å¸ƒä¸€ä¸ªé¡¹ç›®æ—¶ï¼Œæ¯”å¦‚æ”¾åˆ° Github ä¹‹å‰ï¼Œè¿˜ä¼šåŠ ä¸€äº›æµ‹è¯•ã€LICENSEã€READMEï¼Œç›®å½•å°±å˜æˆäº†è¿™æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">packaging_tutorial&#x2F;</span><br><span class="line">  example_pkg&#x2F;</span><br><span class="line">    __init__.py</span><br><span class="line">  tests&#x2F;</span><br><span class="line">  LICENSE</span><br><span class="line">  README.md</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬è¦æ‰“åŒ…å‘å¸ƒè¿™ä¸ªé¡¹ç›®ï¼Œè¿˜éœ€è¦å†åŠ ä¸€ä¸ª <code>setup.py</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">packaging_tutorial&#x2F;</span><br><span class="line">  example_pkg&#x2F;</span><br><span class="line">    __init__.py</span><br><span class="line">  tests&#x2F;</span><br><span class="line">  setup.py</span><br><span class="line">  LICENSE</span><br><span class="line">  README.md</span><br></pre></td></tr></table></figure><h2 id="setup-py"><a href="#setup-py" class="headerlink" title="setup.py"></a>setup.py</h2><p><code> setup.py</code> æè¿°äº†ä½ çš„é¡¹ç›®ï¼Œå‘Šè¯‰åˆ«äººä½ é¡¹ç›®çš„åç§°ã€ç‰ˆæœ¬ã€æè¿°ã€ä¾èµ–â€¦â€¦ç±»ä¼¼äºå†™ node.js åŒå­¦çš„ <code>package.json </code>ã€‚</p><p>è¯´çš„å®˜æ–¹ä¸€ç‚¹å°±æ˜¯ï¼šsetup.py æ˜¯ setuptools çš„æ„å»ºè„šæœ¬ã€‚å®ƒå‘Šè¯‰ setuptools å…³äºä½ çš„è½¯ä»¶åŒ…ï¼ˆå¦‚åç§°å’Œç‰ˆæœ¬ï¼‰ä»¥åŠè¦åŒ…å«å“ªäº›ä»£ç æ–‡ä»¶ã€‚</p><p>ä¸€ä¸ªåŸºæœ¬çš„ setup.py é•¿è¿™æ ·ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> setuptools <span class="keyword">import</span> setup</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;README.md&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> fh:</span><br><span class="line">    long_description = fh.read()</span><br><span class="line"></span><br><span class="line">setup(</span><br><span class="line">    name=<span class="string">&#x27;packaging_tutorial&#x27;</span>,</span><br><span class="line">    version=<span class="string">&#x27;0.0.1&#x27;</span>,</span><br><span class="line">    packages=setuptools.find_packages(),</span><br><span class="line">    url=<span class="string">&#x27;https://github.com/pypa/sampleproject&#x27;</span>,</span><br><span class="line">    license=<span class="string">&#x27;MIT&#x27;</span>,</span><br><span class="line">    author=<span class="string">&#x27;Example Author&#x27;</span>,</span><br><span class="line">    author_email=<span class="string">&#x27;author@example.com&#x27;</span>,</span><br><span class="line">    description=<span class="string">&#x27;A small example package&#x27;</span>,</span><br><span class="line">    long_description=long_description,</span><br><span class="line">    long_description_content_type=<span class="string">&quot;text/markdown&quot;</span>,</span><br><span class="line">    install_requires=[<span class="string">&#x27;numpy&#x27;</span>],</span><br><span class="line">    classifiers=[</span><br><span class="line">        <span class="string">&quot;Programming Language :: Python :: 3&quot;</span>,</span><br><span class="line">        <span class="string">&quot;License :: OSI Approved :: MIT License&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Operating System :: OS Independent&quot;</span>,</span><br><span class="line">    ],</span><br><span class="line">    python_requires=<span class="string">&#x27;&gt;=3.6&#x27;</span>,</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…¶å®åŸºæœ¬çœ‹åå­—å°±çŸ¥é“æ˜¯äº›ä»€ä¹ˆäº†ï¼Œæˆ‘ä»¬åªè¯´æ˜å‡ ä¸ªç‰¹åˆ«çš„ï¼š</p><ul><li><code>packages</code>ï¼Œè¿™é‡Œå¯ä»¥å†™ä¸€ä¸ªlistï¼Œæ¯”å¦‚ <code>packages=[&#39;example_pkg1&#39;, &#39;example_pkg2&#39;, ...]</code>ï¼Œå³ä½ çš„ç›®å½•é‡Œçš„ Python åŒ…ï¼ˆå¸¦<code>__init__.py</code>çš„é‚£ç§ç›®å½•ï¼‰ï¼Œä¹Ÿå¯ä»¥å¦‚å®˜ç½‘å»ºè®®çš„ç›´æ¥è®© setuptools ç»™ä½ å»æ‰¾ã€‚</li></ul><ul><li><code>long_description</code>ï¼Œæˆ‘ä»¬ä» README.md é‡Œç›´æ¥è¯»å–çš„ markdown æ–‡æ¡£ï¼Œæ‰€ä»¥æŠŠ<code>long_description_content_type</code> å¯¹äºè®¾ç½®äº† markdownã€‚</li></ul><ul><li><code>install_requires</code>ï¼Œæ˜¯ä½ è¿™ä¸ªé¡¹ç›®ä¾èµ–çš„åŒ…ï¼Œå¯ä»¥è®© pip å®‰è£…ä½ çš„åŒ…çš„æ—¶å€™æ£€æŸ¥ä¾èµ–ï¼Œå¦‚æœä¾èµ–æ²¡æœ‰å®‰è£…æˆ–ç‰ˆæœ¬ä¸å¯¹ï¼Œå°±æŠŠæ­£ç¡®çš„ä¾èµ–ä¹Ÿä¸€èµ·è£…ä¸Šã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„ä¾èµ–å¿…é¡»æ˜¯ pypi é‡Œæœ‰çš„(å³ä½ å¯ä»¥ç”¨ pip install xxx å®‰è£…çš„)ã€‚è¦äº†è§£æ›´å¤šè¯·çœ‹ï¼š<a href="https://packaging.python.org/discussions/install-requires-vs-requirements/#install-requires-vs-requirements-files">install_requires vs requirements files</a></li></ul><ul><li><code>classifiers</code>ï¼Œå°±æ˜¯ç»™ä½ çš„é¡¹ç›®è´´äº›æ ‡ç­¾ï¼Œæ–¹ä¾¿åˆ«äººæ£€ç´¢å•¦ï¼Œå¯é€‰çš„åœ¨è¿™ä¸ªç›®å½•é‡Œï¼š<a href="https://pypi.org/classifiers/">https://pypi.org/classifiers/</a></li></ul><p>setup.py é‡Œè¿˜å¯ä»¥æŒ‡å®šå¾ˆå¤šå…¶ä»–ä¸œè¥¿çš„ï¼Œå…·ä½“çœ‹æ–‡æ¡£ï¼š<a href="https://packaging.python.org/guides/distributing-packages-using-setuptools/#setup-args">https://packaging.python.org/guides/distributing-packages-using-setuptools/#setup-args</a></p><hr><p>å†™å®Œ setup.py å…¶å®æˆ‘ä»¬å°±å¯ä»¥åœ¨è‡ªå·±çš„ç”µè„‘ä¸Š pip å®‰è£…è¿™ä¸ªåŒ…äº†ï¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> packaging_tutorial</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> pip3 install .</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> ~</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python3</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; import example_pkg    <span class="comment"># æ³¨æ„è¿™é‡Œimportçš„ä¸æ˜¯setupé‡Œçš„nameï¼Œè€Œæ˜¯packagesåˆ—è¡¨é‡Œçš„åŒ…å</span></span></span><br></pre></td></tr></table></figure><p>å¦‚æœæœ¬åœ°å®‰è£…æ²¡é—®é¢˜ï¼ˆæˆ‘æ²¡é‡åˆ°é—®é¢˜ï¼Œä¸æ¸…æ¥šæœ‰æ²¡æœ‰å‘ï¼‰ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŠŠåŒ…å°±è¦ä¸Šä¼ åˆ° Pypi äº†ã€‚</p><h2 id="æ³¨å†Œ-Pypi-è´¦å·"><a href="#æ³¨å†Œ-Pypi-è´¦å·" class="headerlink" title="æ³¨å†Œ Pypi è´¦å·"></a>æ³¨å†Œ Pypi è´¦å·</h2><p>å’Œ GitHub ä¸€æ ·å“ˆï¼Œä½ å¾—å…ˆæ³¨å†Œä¸€ä¸ªå·æ‰èƒ½ä¸Šä¼ åˆ° Pypiã€‚</p><p>ç›´æ¥ç‚¹è¿™ä¸ªé“¾æ¥æ³¨å†Œï¼š<a href="https://pypi.org/account/register/">https://pypi.org/account/register/</a>ã€‚</p><p>æ³¨å†Œå¥½ä¹‹åï¼Œç”Ÿæˆä¸€ä¸ª tokenï¼š<a href="https://pypi.org/manage/account/#api-tokens%E3%80%82%E7%94%B1%E4%BA%8E%E6%88%91%E4%BB%AC%E6%98%AF%E8%A6%81%E4%B8%8A%E4%BC%A0%E6%96%B0%E9%A1%B9%E7%9B%AE%EF%BC%8C%E6%89%80%E4%BB%A5%E4%B8%8D%E8%A6%81%E9%99%90%E5%88%B6">https://pypi.org/manage/account/#api-tokensã€‚ç”±äºæˆ‘ä»¬æ˜¯è¦ä¸Šä¼ æ–°é¡¹ç›®ï¼Œæ‰€ä»¥ä¸è¦é™åˆ¶</a> scope åˆ°ç‰¹å®šçš„é¡¹ç›®ã€‚</p><p>âš ï¸<strong>æ³¨æ„ï¼štoken ç”Ÿæˆå‡ºæ¥ä»¥åä¸è¦é©¬ä¸Šå…³æ‰é¡µé¢ï¼Œä¸ç„¶å°±æ²¡äº†ï¼ï¼ï¼æŠŠ token å¤åˆ¶ç²˜è´´ä¿å­˜åˆ°ä¸ªæœ¬åœ°çš„æ–‡ä»¶é‡Œ(ä½ è¦æ‰‹æŠ„æˆ‘ä¸åå¯¹ï¼Œä¸€ç™¾å¤šä½ï¼Œåˆ«æŠ„é”™å°±è¡Œ [ç‹—å¤´])ã€‚</strong></p><p>ç„¶åï¼Œåˆ›å»ºä¸€ä¸ªçº¯æ–‡æœ¬æ–‡ä»¶ <code>$HOME/.pypirc</code> ï¼ˆWindows å’‹æè‡ªè¡Œè§£å†³ï¼Œæˆ‘ä¸ç”¨Windowsï¼‰ï¼Œåœ¨é‡Œé¢å†™ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[pypi]</span><br><span class="line">username &#x3D; __token__</span><br><span class="line">password &#x3D; &lt;æ¢æˆä½ åˆšåˆšå¤åˆ¶ä¸‹æ¥çš„ token, åŒ…æ‹¬ &#96;pypi-&#96; å‰ç¼€&gt;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œ<strong>ä¸è¦æŠŠusernameæ”¹æˆä½ çš„ç”¨æˆ·å</strong>ï¼Œå°±æ˜¯å†™ <code>username = __token__</code>ï¼Œå›ºå®šderï¼å› ä¸ºæˆ‘ä»¬æ˜¯è¦ç”¨ token å˜›ï¼Œæ‰€ä»¥ç”¨æˆ·æ˜¯ <code>__token__</code>ã€‚<code>password = token</code> æŠŠ token æ¢æˆä½ çš„ tokenï¼Œæ³¨æ„ä¸è¦æ¢è¡Œï¼Œä¹Ÿä¸è¦åŠ å…¶ä»–ä¹±ä¸ƒå…«ç³Ÿçš„ç©ºç™½å­—ç¬¦ï¼ˆå¦‚æœä½ è¦Windowsçš„è®°äº‹æœ¬ï¼Œè¯·å°å¿ƒBOMï¼‰ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[pypi]</span><br><span class="line">username &#x3D; __token__</span><br><span class="line">password &#x3D; pypi-BCqRT66666666kLTI1NjQzZGUJXsgElwaS576OnvGVIshizhegedeshisabiJzaW9uIjogMXC05ZzcIWlOs2lyTZCOCCCCU1NwACvbnL9IsWyPMiOiAidXiJBBBcmcicN0AAAYgCB82jrAI9RDJl5BJfK2333333</span><br></pre></td></tr></table></figure><h2 id="æ‰“åŒ…ã€ä¸Šä¼ "><a href="#æ‰“åŒ…ã€ä¸Šä¼ " class="headerlink" title="æ‰“åŒ…ã€ä¸Šä¼ "></a>æ‰“åŒ…ã€ä¸Šä¼ </h2><p>æ‰“åŒ…å¾ˆç®€å•ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> packaging_tutorial</span><br><span class="line">$ python setup.py sdist</span><br><span class="line">$ tree .</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ LICENSE</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ packaging_tutorial.egg-info</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ PKG-INFO</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ SOURCES.txt</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ dependency_links.txt</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ requires.txt</span><br><span class="line">â”‚Â Â  â””â”€â”€ top_level.txt</span><br><span class="line">â”œâ”€â”€ dist</span><br><span class="line">â”‚Â Â  â””â”€â”€ packaging_tutorial-0.0.1.tar.gz</span><br><span class="line">â”œâ”€â”€ setup.py</span><br><span class="line">â””â”€â”€ example_pkg</span><br><span class="line">    â”œâ”€â”€ __init__.py</span><br><span class="line">    â””â”€â”€ src.py</span><br></pre></td></tr></table></figure><p>ä½ ä¼šçœ‹è§å‡ºæ¥äº› <code>packaging_tutorial.egg-info</code>ã€<code>dist</code> å•¦ã€‚å¦‚æœä½ æ²¡å…´è¶£ï¼Œå°±ä¸ç”¨ç®¡å®ƒä»¬ï¼ŒæŠŠä»–ä»¬çœ‹æˆâ€œç¼–è¯‘â€å‡ºæ¥çš„äºŒè¿›åˆ¶æ–‡ä»¶å°±å¥½ã€‚è¿™äº›ä¹Ÿä¸ç”¨åŠ ç‰ˆæœ¬ç®¡ç†é‡Œï¼Œä½ éšæ—¶å¯ä»¥ç”Ÿæˆçš„ã€‚</p><p>ç„¶åå°±æ˜¯ä¸Šä¼ äº†ï¼Œè¿™ä¸€æ­¥éœ€è¦æˆ‘ä»¬å…ˆå®‰è£…ä¸€ä¸ª twineï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install twine</span><br></pre></td></tr></table></figure><p>å¥½äº†ä¹‹åï¼Œç”¨ twine å°±å¯ä»¥æŠŠåŒ…ä¸Šä¼ åˆ° pypi äº†ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ twine upload dist/*</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œä½ å¯ä»¥åªä¸Šä¼ æŸä¸ªç‰¹å®šç‰ˆæœ¬ï¼š <code>twine upload dist/packaging_tutorial-0.0.1.tar.gz</code>ã€‚</p><p>å¦‚æœå¤±è´¥ï¼Œè¯·æ£€æŸ¥ä½ çš„ç½‘ç»œï¼Œç¡®ä¿ä½ å¯ä»¥ä¸Š <a href="https://pypi.org/">pypiå®˜ç½‘</a> (æè¿™äº›æœ€å¥½ç§‘å­¦ä¸Šç½‘ï¼Œä¸ç„¶æˆ‘ä¸çŸ¥é“èƒ½ä¸èƒ½æˆ)ï¼›è¿˜æœ‰æ£€æŸ¥ä½ çš„ <code>$HOME/.pypirc</code>ï¼Œtoken æœ‰æ²¡æœ‰å†™é”™ã€‚</p><p>ä¸Šä¼ å®Œå®ƒå°±ä¼šè¾“å‡ºä¸€ä¸ª URLï¼š<code>https://pypi.org/project/&lt;sampleproject&gt;</code>ï¼Œæ‰“å¼€å°±å¯ä»¥åœ¨ pypi é‡Œçœ‹åˆ°ä½ çš„é¡¹ç›®äº†ï¼</p><h2 id="ç”¨-Pip-å®‰è£…è‡ªå·±å†™çš„åŒ…"><a href="#ç”¨-Pip-å®‰è£…è‡ªå·±å†™çš„åŒ…" class="headerlink" title="ç”¨ Pip å®‰è£…è‡ªå·±å†™çš„åŒ…"></a>ç”¨ Pip å®‰è£…è‡ªå·±å†™çš„åŒ…</h2><p>æœ€åï¼Œæ¢å°è®¡ç®—æœºï¼ˆæˆ‘ä»¬è‡ªå·±çš„ç”µè„‘ä¸Šå·²ç»å®‰è£…è¿‡äº†å˜›ï¼Œç—›å¤±è´æ´äº†ï¼Œä¸å¥½ç©äº†ï¼‰ã€‚</p><p>åœ¨å¦ä¸€å°æœºå™¨ä¸Šï¼ˆå®‰è£…äº† pythonã€pipçš„ï¼‰ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install packaging_tutorial</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥çœ‹åˆ°ä¸‹è½½ã€ä¾èµ–å¤„ç†ã€å®‰è£…çš„è¿‡ç¨‹ã€‚å¥½äº†ä¹‹åä½ å°±å¯ä»¥ç”¨è‡ªå·±å†™çš„åŒ…äº†ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python</span><br><span class="line">&gt;&gt;&gt; import example_pkg</span><br></pre></td></tr></table></figure><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>è¿™ç¯‡æ–‡ç« åªæ˜¯å¯¹æ•´ä¸ªæµç¨‹ç®€è¦çš„è®°å½•å’Œä»‹ç»ï¼Œå®˜æ–¹çš„è¿™ç¯‡æ–‡ç« å†™äº†æ›´å®Œæ•´çš„ä»‹ç»ï¼š<a href="https://packaging.python.org/guides/distributing-packages-using-setuptools/#packaging-and-distributing-projects">Packaging and distributing projects</a>ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode 236. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</title>
      <link href="/2020/04/28/School/leetcode_P236_lowest-common-ancestor-of-a-binary-tree/"/>
      <url>/2020/04/28/School/leetcode_P236_lowest-common-ancestor-of-a-binary-tree/</url>
      
        <content type="html"><![CDATA[<h1 id="leetcode-236-äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"><a href="#leetcode-236-äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ" class="headerlink" title="leetcode 236. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"></a>leetcode <a href="https://leetcode-cn.com/problems/lowest-common-ancestor-of-a-binary-tree/">236. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</a></h1><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚</p><p>ç™¾åº¦ç™¾ç§‘ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªç»“ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªç»“ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆï¼‰ã€‚â€</p><p>ä¾‹å¦‚ï¼Œç»™å®šå¦‚ä¸‹äºŒå‰æ ‘:  root = [3,5,1,6,2,0,8,null,null,7,4]</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge9c56ruw6j305k05aa9z.jpg" alt="img"> </p><p>ç¤ºä¾‹ 1:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: root &#x3D; [3,5,1,6,2,0,8,null,null,7,4], p &#x3D; 5, q &#x3D; 1</span><br><span class="line">è¾“å‡º: 3</span><br><span class="line">è§£é‡Š: èŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 1 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 3ã€‚</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 2:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: root &#x3D; [3,5,1,6,2,0,8,null,null,7,4], p &#x3D; 5, q &#x3D; 4</span><br><span class="line">è¾“å‡º: 5</span><br><span class="line">è§£é‡Š: èŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 4 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 5ã€‚å› ä¸ºæ ¹æ®å®šä¹‰æœ€è¿‘å…¬å…±ç¥–å…ˆèŠ‚ç‚¹å¯ä»¥ä¸ºèŠ‚ç‚¹æœ¬èº«ã€‚</span><br></pre></td></tr></table></figure><p>è¯´æ˜:</p><p>æ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ã€‚<br>pã€q ä¸ºä¸åŒèŠ‚ç‚¹ä¸”å‡å­˜åœ¨äºç»™å®šçš„äºŒå‰æ ‘ä¸­ã€‚</p><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/lowest-common-ancestor-of-a-binary-tree">https://leetcode-cn.com/problems/lowest-common-ancestor-of-a-binary-tree</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p><hr><p>ã€‚ã€‚ã€‚è¿™ä¸ªé¢˜ï¼Œä»¥å‰è‚¯å®šåˆ·è¿‡ï¼Œè®°ä¸å¾—æ˜¯å“ªä¸ª OJ çš„äº†ã€‚æœ€ç®€æ´çš„æ–¹æ³•åº”è¯¥æ˜¯é€’å½’å›æº¯ï¼Œä½†ä¸æƒ³å†™äº†ã€‚ç›´æ¥æ‹¿æš´åŠ›æ³• ac äº†ï¼Œå†æ”¹æˆå¹¶å‘ç©ç©å§ã€‚ã€‚ã€‚</p><h2 id="æš´åŠ›æ³•"><a href="#æš´åŠ›æ³•" class="headerlink" title="æš´åŠ›æ³•"></a>æš´åŠ›æ³•</h2><p>é¦–å…ˆï¼Œå®ç°ä¸€ä¸ªè¾…åŠ©å‡½æ•° <code>rewalk(root, node *TreeNode) []*TreeNode</code> ï¼šéå†æ ‘ï¼Œæ‰¾åˆ°ä»æŸèŠ‚ç‚¹åˆ°æ ¹èŠ‚ç‚¹åˆ°ä¸€æ¡è·¯å¾„ï¼Œå³æ‰¾åˆ°è¿™ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰ç¥–å…ˆèŠ‚ç‚¹ã€‚</p><p>é€šè¿‡è¿™ä¸ª rewalk å‡½æ•°ï¼Œè·å¾— pã€q çš„æ‰€æœ‰ç¥–å…ˆèŠ‚ç‚¹ï¼Œç„¶åä»é‡Œé¢æ‰¾è·ç¦» pã€q æœ€è¿‘çš„å…¬å…±ç¥–å…ˆèŠ‚ç‚¹è¿”å›å³å¯ã€‚</p><p>Golang å®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for TreeNode.</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *     Val int</span></span><br><span class="line"><span class="comment"> *     Left *ListNode</span></span><br><span class="line"><span class="comment"> *     Right *ListNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">lowestCommonAncestor</span><span class="params">(root, p, q *TreeNode)</span> *<span class="title">TreeNode</span></span> &#123;</span><br><span class="line">    rp := rewalk(root, p)</span><br><span class="line">    rq := rewalk(root, q)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, pp := <span class="keyword">range</span> rp &#123;</span><br><span class="line">        <span class="keyword">for</span> _, qq := <span class="keyword">range</span> rq &#123;</span><br><span class="line">            <span class="keyword">if</span> pp == qq &#123;</span><br><span class="line">                <span class="keyword">return</span> pp</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &amp;TreeNode&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">rewalk</span><span class="params">(root, node *TreeNode)</span> []*<span class="title">TreeNode</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> []*TreeNode&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> root.Left == node || root.Right == node &#123;</span><br><span class="line">        <span class="keyword">return</span> []*TreeNode&#123;node, root&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> r := rewalk(root.Left, node); <span class="built_in">len</span>(r) &gt; <span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">append</span>(r, root)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> r := rewalk(root.Right, node); <span class="built_in">len</span>(r) &gt; <span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">append</span>(r, root)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> []*TreeNode&#123;node&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge99q4zyelj31cn0u04qp.jpg" alt="image-20200428102347236"></p><p>Swift:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     public var val: Int</span></span><br><span class="line"><span class="comment"> *     public var left: TreeNode?</span></span><br><span class="line"><span class="comment"> *     public var right: TreeNode?</span></span><br><span class="line"><span class="comment"> *     public init(_ val: Int) &#123;</span></span><br><span class="line"><span class="comment"> *         self.val = val</span></span><br><span class="line"><span class="comment"> *         self.left = nil</span></span><br><span class="line"><span class="comment"> *         self.right = nil</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">lowestCommonAncestor</span><span class="params">(<span class="keyword">_</span> root: TreeNode?, <span class="keyword">_</span> p: TreeNode?, <span class="keyword">_</span> q: TreeNode?)</span></span> -&gt; <span class="type">TreeNode</span>? &#123;</span><br><span class="line">        <span class="keyword">for</span> pp <span class="keyword">in</span> rewalk(root, p) &#123;</span><br><span class="line">            <span class="keyword">for</span> qq <span class="keyword">in</span> rewalk(root, q) &#123;</span><br><span class="line">                <span class="keyword">if</span> pp<span class="operator">?</span>.val <span class="operator">==</span> qq<span class="operator">?</span>.val &#123;</span><br><span class="line">                    <span class="keyword">return</span> pp</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">rewalk</span><span class="params">(<span class="keyword">_</span> root: TreeNode?, <span class="keyword">_</span> node: TreeNode?)</span></span> -&gt; [<span class="type">TreeNode</span>?] &#123;</span><br><span class="line">        <span class="keyword">if</span> root <span class="operator">==</span> <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> [<span class="type">TreeNode</span>?]()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> root<span class="operator">?</span>.left<span class="operator">?</span>.val <span class="operator">==</span> node<span class="operator">?</span>.val <span class="operator">||</span> root<span class="operator">?</span>.right<span class="operator">?</span>.val <span class="operator">==</span> node<span class="operator">?</span>.val &#123;</span><br><span class="line">            <span class="keyword">return</span> [node, root]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> rl <span class="operator">=</span> rewalk(root<span class="operator">?</span>.left, node)</span><br><span class="line">        <span class="keyword">if</span> rl.count <span class="operator">&gt;</span> <span class="number">1</span> &#123;</span><br><span class="line">            rl.append(root)</span><br><span class="line">            <span class="keyword">return</span> rl</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> rr <span class="operator">=</span> rewalk(root<span class="operator">?</span>.right, node)</span><br><span class="line">        <span class="keyword">if</span> rr.count <span class="operator">&gt;</span> <span class="number">1</span> &#123;</span><br><span class="line">            rr.append(root)</span><br><span class="line">            <span class="keyword">return</span> rr</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> [node]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge9a8pvmnnj31cn0u01kx.jpg" alt="image-20200428104142149"></p><h2 id="å¹¶å‘"><a href="#å¹¶å‘" class="headerlink" title="å¹¶å‘"></a>å¹¶å‘</h2><p>åœ¨å‰å‡ å¤©å†™çš„ <a href="https://clownote.github.io/2020/04/21/School/Leetcode_P100_same-tree/">ä»ã€ŒLeetcode 100. ç›¸åŒçš„æ ‘ã€å‡ºå‘è®¨è®ºä¸ºä»€ä¹ˆç”¨ã€Œå¹¶å‘ã€</a> ä¸€æ–‡é‡Œï¼Œæˆ‘è®¨è®ºè¿‡ï¼Œæœ‰çš„æ—¶å€™ç”¨å¹¶å‘å¹¶ä¸æ˜¯ä¸ºäº†è·‘çš„å¿«ï¼Œåªæ˜¯è®©è§£å†³é—®é¢˜çš„æ€è·¯å˜å¾—æ›´æ¸…æ™°ã€æ“ä½œæ›´åŠ â€œåŸå­åŒ–â€ã€é¿å…æ—¶é—´ä¸åŒæ­¥é€ æˆçš„é¢å¤–å‚¨å­˜ä½¿ç”¨ã€‚è¿™é‡Œä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠåˆšæ‰çš„æš´åŠ›æ³•æ”¹æˆç”¨ goroutine å’Œ channelï¼ŒGolang å®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">lowestCommonAncestor</span><span class="params">(root, p, q *TreeNode)</span> *<span class="title">TreeNode</span></span> &#123;</span><br><span class="line">    cp := <span class="built_in">make</span>(<span class="keyword">chan</span> *TreeNode)</span><br><span class="line">    cq := <span class="built_in">make</span>(<span class="keyword">chan</span> *TreeNode)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">go</span> rewalk(root, p, cp)</span><br><span class="line">    <span class="keyword">go</span> rewalk(root, q, cq)</span><br><span class="line"></span><br><span class="line">    ans := <span class="built_in">make</span>(<span class="keyword">chan</span> *TreeNode)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        ap := []*TreeNode&#123;&#125;</span><br><span class="line">        aq := []*TreeNode&#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> &#123;</span><br><span class="line">            <span class="keyword">select</span> &#123;</span><br><span class="line">            <span class="keyword">case</span> p := &lt;- cp:</span><br><span class="line">                <span class="keyword">for</span> _, q := <span class="keyword">range</span> aq &#123;</span><br><span class="line">                    <span class="keyword">if</span> p == q &#123;</span><br><span class="line">                        ans &lt;- p</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                ap = <span class="built_in">append</span>(ap, p)</span><br><span class="line">            <span class="keyword">case</span> q := &lt;- cq:</span><br><span class="line">                <span class="keyword">for</span> _, p := <span class="keyword">range</span> ap &#123;</span><br><span class="line">                    <span class="keyword">if</span> q == p &#123;</span><br><span class="line">                        ans &lt;- q</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                aq = <span class="built_in">append</span>(aq, q)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &lt;-ans</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">rewalk</span><span class="params">(root, node *TreeNode, ch <span class="keyword">chan</span> *TreeNode)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> root.Left == node || root.Right == node &#123;</span><br><span class="line">        ch &lt;- node</span><br><span class="line">        ch &lt;- root</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> r := rewalk(root.Left, node, ch); r &#123;</span><br><span class="line">        ch &lt;- root</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> r := rewalk(root.Right, node, ch); r &#123;</span><br><span class="line">        ch &lt;- root</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    ch &lt;- node</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge9bp875ekj31cn0u01kx.jpg" alt="image-20200428113206480"></p><p>é€šè¿‡è°ƒæ•´è¶…æ—¶ï¼ˆå°±æ˜¯åœ¨ select é‡ŒåŠ ä¸€ä¸ª <code>case &lt;- time.After(...*time.Microsecond)</code>ï¼‰ï¼Œæˆ‘å»å¡äº† leetcode çš„æµ‹è¯•ç”¨ä¾‹å‡ºæ¥çœ‹ï¼Œä»–çš„æ•°æ®è§„æ¨¡éƒ½æ¯”è¾ƒå°ï¼Œç»™çš„æ ‘éƒ½ä¸å¤§ï¼Œæ‰€ä»¥è¿™ä¸ªç”¨å¹¶å‘ä¼˜åŠ¿ä½“ç°ä¸å‡ºæ¥ã€‚ä½†å¦‚æœä½ çš„æ ‘ç‚’é¸¡å¤§ï¼Œè¿™ä¸ªç”¨å¹¶å‘çš„ç®—æ³•è‚¯å®šæ˜¯ä¼šæœ‰ä¸€å®šä¼˜åŠ¿çš„ã€‚æ¯”å¦‚å¦‚æœç»™çš„ pã€q è·ç¦»æ ‘æ ¹éƒ½æœ‰ 10,000,000 ä¸ªç¥–å…ˆèŠ‚ç‚¹ï¼Œæš´åŠ›æ³•è¦å…¨éƒ¨è·‘ä¸€è¾¹ã€å­˜ä¸‹æ¥ã€å†åµŒå¥—for  10,000,000 ä¸ª  10,000,000 ä¸ªçš„å»éå†ï¼Œè€Œå¦‚æœå®ƒä»¬çš„æœ€è¿‘å…¬å…±ç¥–å…ˆåªè·ç¦» 1000 ä¸ªèŠ‚ç‚¹ï¼Œé‚£å¹¶å‘åªè¦è·‘ 1000 ä¸ªå°±ç»“æŸäº†ã€æ£€æŸ¥çš„éå†ä¹Ÿæ˜¯åœ¨ 1000 * 1000 é‡Œçš„ï¼Œè¿™è¦å¿«å¾—å¤šã€çœå¾—å¤šäº†ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode 104. äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦</title>
      <link href="/2020/04/28/School/Leetcode_P104_maximum-depth-of-binary-tree/"/>
      <url>/2020/04/28/School/Leetcode_P104_maximum-depth-of-binary-tree/</url>
      
        <content type="html"><![CDATA[<h1 id="Leetcode-104-äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦"><a href="#Leetcode-104-äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦" class="headerlink" title="Leetcode 104. äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦"></a>Leetcode <a href="https://leetcode-cn.com/problems/maximum-depth-of-binary-tree/">104. äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦</a></h1><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ‰¾å‡ºå…¶æœ€å¤§æ·±åº¦ã€‚</p><p>äºŒå‰æ ‘çš„æ·±åº¦ä¸ºæ ¹èŠ‚ç‚¹åˆ°æœ€è¿œå¶å­èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ•°ã€‚</p><p>è¯´æ˜: å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚</p><p>ç¤ºä¾‹ï¼š<br>ç»™å®šäºŒå‰æ ‘ <code>[3,9,20,null,null,15,7]</code>ï¼Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  3</span><br><span class="line"> &#x2F; \</span><br><span class="line">9  20</span><br><span class="line">  &#x2F;  \</span><br><span class="line"> 15   7</span><br></pre></td></tr></table></figure><p>è¿”å›å®ƒçš„æœ€å¤§æ·±åº¦ 3 ã€‚</p><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/maximum-depth-of-binary-tree">https://leetcode-cn.com/problems/maximum-depth-of-binary-tree</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p><h2 id="é€’å½’"><a href="#é€’å½’" class="headerlink" title="é€’å½’"></a>é€’å½’</h2><p>æ±‚æ·±åº¦ï¼Œæ·±åº¦ä¼˜å…ˆå»è·‘ä¸€éå°±å‡ºæ¥äº†ã€‚Golang å®ç°:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *     Val int</span></span><br><span class="line"><span class="comment"> *     Left *TreeNode</span></span><br><span class="line"><span class="comment"> *     Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxDepth</span><span class="params">(root *TreeNode)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    leftDepth := maxDepth(root.Left) + <span class="number">1</span></span><br><span class="line">    rightDepth := maxDepth(root.Right) + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> leftDepth &gt; rightDepth &#123;</span><br><span class="line">        <span class="keyword">return</span> leftDepth</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> rightDepth</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge96uvbw9fj31co0u01kx.jpg" alt="image-20200428084432376"></p><p>Swift:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     public var val: Int</span></span><br><span class="line"><span class="comment"> *     public var left: TreeNode?</span></span><br><span class="line"><span class="comment"> *     public var right: TreeNode?</span></span><br><span class="line"><span class="comment"> *     public init(_ val: Int) &#123;</span></span><br><span class="line"><span class="comment"> *         self.val = val</span></span><br><span class="line"><span class="comment"> *         self.left = nil</span></span><br><span class="line"><span class="comment"> *         self.right = nil</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">maxDepth</span><span class="params">(<span class="keyword">_</span> root: TreeNode?)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> root <span class="operator">==</span> <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(maxDepth(root<span class="operator">?</span>.left), maxDepth(root<span class="operator">?</span>.right)) <span class="operator">+</span> <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge96tea5w1j31ih0u0qss.jpg" alt="image-20200428084300289"></p><h2 id="è¿­ä»£"><a href="#è¿­ä»£" class="headerlink" title="è¿­ä»£"></a>è¿­ä»£</h2><p>æŠŠé€’å½’æ”¹æˆæ ˆï¼ŒDFSä¹Ÿèƒ½å‡ºæ¥ï¼ŒåŸºæœ¬æ˜¯ä¸€æ ·çš„ã€‚Golang å®ç°:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxDepth</span><span class="params">(root *TreeNode)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    depth := <span class="number">1</span></span><br><span class="line">    root.Val = <span class="number">1</span></span><br><span class="line">    stack := []*TreeNode&#123;root&#125;</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">len</span>(stack) &gt; <span class="number">0</span> &#123;</span><br><span class="line">        node := stack[<span class="built_in">len</span>(stack) - <span class="number">1</span>]</span><br><span class="line">        stack = stack[: <span class="built_in">len</span>(stack) - <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> node.Val &gt; depth &#123;</span><br><span class="line">            depth = node.Val</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> node.Left != <span class="literal">nil</span> &#123;</span><br><span class="line">            node.Left.Val = node.Val + <span class="number">1</span></span><br><span class="line">            stack = <span class="built_in">append</span>(stack, node.Left)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> node.Right != <span class="literal">nil</span> &#123;</span><br><span class="line">            node.Right.Val = node.Val + <span class="number">1</span></span><br><span class="line">            stack = <span class="built_in">append</span>(stack, node.Right)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> depth</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge972t6548j31co0u01kx.jpg" alt="å±å¹•å¿«ç…§ 2020-04-28 08.51.08"></p><p>è™½ç„¶ä¸åœ°é“ï¼Œä½†ä»£ç åŸºæœ¬ä¸å˜ï¼Œæ”¹å‡ ä¸ªç¬¦å·å°±å¯ä»¥æ”¾åˆ° Swift é‡Œè·‘äº†:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">maxDepth</span><span class="params">(<span class="keyword">_</span> root: TreeNode?)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> root <span class="operator">==</span> <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> depth <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">        root<span class="operator">?</span>.val <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">var</span> stack: [<span class="type">TreeNode</span>] <span class="operator">=</span> [root<span class="operator">!</span>, ]</span><br><span class="line">        <span class="keyword">while</span> <span class="operator">!</span>stack.isEmpty &#123;</span><br><span class="line">            <span class="keyword">let</span> node <span class="operator">=</span> stack.popLast()<span class="operator">!</span></span><br><span class="line">            <span class="keyword">if</span> node.val <span class="operator">&gt;</span> depth &#123;</span><br><span class="line">                depth <span class="operator">=</span> node.val</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> node.left <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">                node.left<span class="operator">?</span>.val <span class="operator">=</span> node.val <span class="operator">+</span> <span class="number">1</span></span><br><span class="line">                stack.append(node.left<span class="operator">!</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> node.right <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">                node.right<span class="operator">?</span>.val <span class="operator">=</span> node.val <span class="operator">+</span> <span class="number">1</span></span><br><span class="line">                stack.append(node.right<span class="operator">!</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> depth</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge984g3z1qj31co0u01kx.jpg" alt="image-20200428092824475"></p>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode 101. å¯¹ç§°äºŒå‰æ ‘</title>
      <link href="/2020/04/21/School/Leetcode_P101_symmetric-tree/"/>
      <url>/2020/04/21/School/Leetcode_P101_symmetric-tree/</url>
      
        <content type="html"><![CDATA[<h1 id="Leetcode-101-å¯¹ç§°äºŒå‰æ ‘"><a href="#Leetcode-101-å¯¹ç§°äºŒå‰æ ‘" class="headerlink" title="Leetcode 101. å¯¹ç§°äºŒå‰æ ‘"></a>Leetcode <a href="https://leetcode-cn.com/problems/symmetric-tree/">101. å¯¹ç§°äºŒå‰æ ‘</a></h1><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ£€æŸ¥å®ƒæ˜¯å¦æ˜¯é•œåƒå¯¹ç§°çš„ã€‚ </p><p>ä¾‹å¦‚ï¼ŒäºŒå‰æ ‘ <code>[1,2,2,3,4,4,3]</code> æ˜¯å¯¹ç§°çš„ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    1</span><br><span class="line">   &#x2F; \</span><br><span class="line">  2   2</span><br><span class="line"> &#x2F; \ &#x2F; \</span><br><span class="line">3  4 4  3</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¸‹é¢è¿™ä¸ª <code>[1,2,2,null,3,null,3]</code> åˆ™ä¸æ˜¯é•œåƒå¯¹ç§°çš„:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  1</span><br><span class="line"> &#x2F; \</span><br><span class="line">2   2</span><br><span class="line"> \   \</span><br><span class="line"> 3    3</span><br></pre></td></tr></table></figure><p>è¿›é˜¶ï¼š</p><p>ä½ å¯ä»¥è¿ç”¨é€’å½’å’Œè¿­ä»£ä¸¤ç§æ–¹æ³•è§£å†³è¿™ä¸ªé—®é¢˜å—ï¼Ÿ</p><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/symmetric-tree">https://leetcode-cn.com/problems/symmetric-tree</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p><h2 id="æš´åŠ›æ³•"><a href="#æš´åŠ›æ³•" class="headerlink" title="æš´åŠ›æ³•"></a>æš´åŠ›æ³•</h2><p>æŠŠå·¦å­æ ‘ä»¥<strong>å…ˆå·¦åå³</strong>çš„é¡ºåºéå†ï¼ŒæŠŠ val ç”¨çº¿æ€§ç»“æ„å­˜ä¸‹æ¥ï¼›æŠŠå³å­æ ‘ä»¥<strong>å…ˆå³åå·¦</strong>çš„é¡ºåºéå†ï¼ŒæŠŠ val ç”¨çº¿æ€§ç»“æ„å­˜ä¸‹æ¥ã€‚ç„¶åï¼Œæ¯”è¾ƒä¸¤ä¸ªç»“æœï¼Œç›¸ç­‰åˆ™è¯´æ˜å¯¹ç§°ã€‚å¤§æ¦‚å°±è¿™ä¸ªæ€è·¯ï¼Œä½ ç»†å“ã€‚</p><p>æ¶‰åŠåˆ°ç©ºå€¼å¤„ç†çš„ä»£ç æˆ‘å–œæ¬¢ç”¨ Swift å®ç°ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     public var val: Int</span></span><br><span class="line"><span class="comment"> *     public var left: TreeNode?</span></span><br><span class="line"><span class="comment"> *     public var right: TreeNode?</span></span><br><span class="line"><span class="comment"> *     public init(_ val: Int) &#123;</span></span><br><span class="line"><span class="comment"> *         self.val = val</span></span><br><span class="line"><span class="comment"> *         self.left = nil</span></span><br><span class="line"><span class="comment"> *         self.right = nil</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isSymmetric</span><span class="params">(<span class="keyword">_</span> root: TreeNode?)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> leftSubTreeVals <span class="operator">=</span> [root<span class="operator">?</span>.val]</span><br><span class="line">        leftFirstWalk(root<span class="operator">?</span>.left, <span class="operator">&amp;</span>leftSubTreeVals)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> rightSubTreeVals <span class="operator">=</span> [root<span class="operator">?</span>.val]</span><br><span class="line">        rightFirstWalk(root<span class="operator">?</span>.right, <span class="operator">&amp;</span>rightSubTreeVals)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> leftSubTreeVals <span class="operator">==</span> rightSubTreeVals</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">leftFirstWalk</span><span class="params">(<span class="keyword">_</span> root: TreeNode?,<span class="keyword">_</span> vals: <span class="keyword">inout</span> [Int?])</span></span> &#123;</span><br><span class="line">        vals.append(root<span class="operator">?</span>.val)</span><br><span class="line">        <span class="keyword">if</span> root <span class="operator">==</span> <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        leftFirstWalk(root<span class="operator">?</span>.left, <span class="operator">&amp;</span>vals)</span><br><span class="line">        leftFirstWalk(root<span class="operator">?</span>.right, <span class="operator">&amp;</span>vals)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">rightFirstWalk</span><span class="params">(<span class="keyword">_</span> root: TreeNode?,<span class="keyword">_</span> vals: <span class="keyword">inout</span> [Int?])</span></span> &#123;</span><br><span class="line">        vals.append(root<span class="operator">?</span>.val)</span><br><span class="line">        <span class="keyword">if</span> root <span class="operator">==</span> <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        rightFirstWalk(root<span class="operator">?</span>.right, <span class="operator">&amp;</span>vals)</span><br><span class="line">        rightFirstWalk(root<span class="operator">?</span>.left, <span class="operator">&amp;</span>vals)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge1gffgsjwj31c60u01kx.jpg" alt="å±å¹•å¿«ç…§ 2020-04-21 16.11.00"></p><p>ï¼ˆä¸€å¼€å§‹rightFirstWalkæ˜¯ç›´æ¥å¤åˆ¶ç²˜è´´leftFirstWalkè¿‡æ¥çš„ï¼Œé‡Œé¢çš„ left å¿˜æ”¹æˆ right äº†ğŸ˜‚ï¼Œæ‰€ä»¥æŠ¥äº†ä¸ªWAï¼‰</p><h2 id="é€’å½’æ³•"><a href="#é€’å½’æ³•" class="headerlink" title="é€’å½’æ³•"></a>é€’å½’æ³•</h2><p>å’Œå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬é€’å½’çš„è®¾è®¡ä»è€ƒè™‘ä¸€ä¸ªæœ€ç®€å•çš„æƒ…å½¢å¼€å§‹ã€‚è€ƒè™‘ä¸¤æ£µåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„æ ‘ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n1      n2</span><br></pre></td></tr></table></figure><p>å®ƒä»¬æ˜¯å¯¹ç§°çš„å½“ä¸”ä»…å½“ <code>n1 == n2</code>ã€‚</p><p>å¦‚æœè¿™ä¸¤ä¸ªèŠ‚ç‚¹æœ‰ä¸”åªæœ‰ä¸€å±‚å­©å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   n1          n2</span><br><span class="line">  &#x2F; \         &#x2F; \</span><br><span class="line">l1   r1     l2   r2</span><br></pre></td></tr></table></figure><p>è¿™æ—¶ï¼Œä¸¤æ£µæ•°å¯¹ç§°çš„å……è¦æ¡ä»¶å˜æˆäº†ï¼š<code>n1 == n2</code> ä¸” <code>l1 == r2</code> ä¸” <code>r1 == r2</code>ã€‚</p><p>æ³¨æ„åˆ° <code>l1 == r2</code> ç­‰ä»·äºä¸¤æ£µåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„æ ‘ <code>l1</code> å’Œ <code>r2</code> å¯¹ç§°ã€‚</p><p>è¿™ç»™äº†æˆ‘ä»¬ä¸€ä¸ªå¯ç¤ºï¼Œå¦‚æœè¿™ä¸¤ä¸ªèŠ‚ç‚¹æœ‰å­æ ‘ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   n1          n2</span><br><span class="line">  &#x2F; \         &#x2F; \</span><br><span class="line">l1   r1     l2   r2</span><br></pre></td></tr></table></figure><p>è¿™æ—¶ï¼Œä¸¤æ£µæ•°å¯¹ç§°çš„å……è¦æ¡ä»¶å°±æ˜¯ï¼š<code>n1 == n2</code> ä¸” <code>l1 ä¸ r2 å¯¹ç§°</code> ä¸” <code>r1 ä¸ r2 å¯¹ç§°</code>ã€‚</p><p> Swift å®ç°ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isSymmetric</span><span class="params">(<span class="keyword">_</span> root: TreeNode?)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> symmetric(root<span class="operator">?</span>.left, root<span class="operator">?</span>.right)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">symmetric</span><span class="params">(<span class="keyword">_</span> left: TreeNode?, <span class="keyword">_</span> right: TreeNode?)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> left <span class="operator">==</span> <span class="literal">nil</span> <span class="operator">&amp;&amp;</span> right <span class="operator">==</span> <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> left<span class="operator">?</span>.val <span class="operator">!=</span> right<span class="operator">?</span>.val &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> symmetric(left<span class="operator">?</span>.left, right<span class="operator">?</span>.right) <span class="operator">&amp;&amp;</span> symmetric(left<span class="operator">?</span>.right, right<span class="operator">?</span>.left)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge1hly9ljrj31c60u01kx.jpg" alt="image-20200421165205677"></p><h2 id="è¿­ä»£æ³•"><a href="#è¿­ä»£æ³•" class="headerlink" title="è¿­ä»£æ³•"></a>è¿­ä»£æ³•</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isSymmetric</span><span class="params">(<span class="keyword">_</span> root: TreeNode?)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> s <span class="operator">=</span> [root, root]</span><br><span class="line">        <span class="keyword">while</span> <span class="operator">!</span>s.isEmpty &#123;</span><br><span class="line">            <span class="keyword">let</span> t1 <span class="operator">=</span> s.popLast()</span><br><span class="line">            <span class="keyword">let</span> t2 <span class="operator">=</span> s.popLast()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> t1<span class="operator">??</span>.val <span class="operator">!=</span> t2<span class="operator">??</span>.val &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> t1<span class="operator">??</span>.val <span class="operator">!=</span> <span class="literal">nil</span> <span class="operator">||</span> t2<span class="operator">??</span>.val <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">                s.insert(contentsOf: [t1<span class="operator">??</span>.left, t2<span class="operator">??</span>.right], at: <span class="number">0</span>)</span><br><span class="line">                s.insert(contentsOf: [t1<span class="operator">??</span>.right, t2<span class="operator">??</span>.left], at: <span class="number">0</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge1iqz5yxhj31c60u01kx.jpg" alt="image-20200421173132163"></p><hr><h2 id="ï¼ˆè’Ÿè’»çš„æŠ±æ€¨ï¼‰"><a href="#ï¼ˆè’Ÿè’»çš„æŠ±æ€¨ï¼‰" class="headerlink" title="ï¼ˆè’Ÿè’»çš„æŠ±æ€¨ï¼‰"></a>ï¼ˆè’Ÿè’»çš„æŠ±æ€¨ï¼‰</h2><p>å•ªï¼</p><p>å˜£ï¼</p><p>è’Ÿè’»æŠŠé”®ç›˜ä¸€ç ¸ï¼Œå°±å¤ºé—¨è€Œå‡ºã€‚</p><p>â€œè’Ÿè’»å‡ºé—¨äº†ï¼â€ï¼Œä¸çŸ¥è°å–Šäº†è¿™ä¹ˆä¸€å—“å­ï¼Œå®¶å®¶æˆ·æˆ·ä¾¿éƒ½æ€¥ç€å¼€çª—ï¼Œå¤ªå¤ªä»¬é¡¾ä¸å¾—æ•´ç†é¥°ç‰©å°±ä¼¸å‡ºå¤´æ¥å›´è§‚è’Ÿè’»çš„è“¬å¤´å¢é¢ã€‚</p><p>å…ˆç”Ÿä»¬ã€å­©å­ä»¬ã€æ²¡æœ‰æŠ¢åˆ°çª—å£å®åœ°çš„å¹´è½»å°å§ä»¬ï¼Œå¼€å§‹æ¨æ”˜ç€ã€å¬‰ç¬‘ç€æŒ¤å‡ºé—¨æ¥ï¼Œå¹³æ—¶èƒ½å¤Ÿä¸¤ä¸ªäººå¹¶æ’èµ°çš„é—¨ï¼Œè¿™æ—¶çœ‹æ¥ç‹­çª„å¾—å¯ç¬‘ã€‚èµ°åœ¨åé¢çš„ã€è„¾æ°”æš´èºçš„è€äººå¥½ä¸å®¹æ˜“æŒªåˆ°è¡—ä¸Šï¼Œå‘æ˜çš„è§†çº¿é©¬ä¸Šè¢«å‰é¢ä¸€æ’æ’é«˜ä¸¾ç€å­©å­çš„å°ä¼™å­ä»¬çš±èµ·çš„åè¡£é®ä½äº†ï¼Œåªçœ‹å¾—ä»–ä»¬æ»¡ç›®æ€’ç«ã€‚</p><p>å…«å°ºå®½çš„è¡—é“ä¸€ç¬é—´å˜å¾—æ°´æ³„ä¸é€šï¼Œä½ç€å¤´çš„è’Ÿè’»å¦‚å¹³æ—¶é‚£èˆ¬å¿½è§†ç€èº«å‘¨çš„é‚»å±…ä»¬â€”â€”ä»–æ‰€åˆ°ä¹‹å¤„ï¼Œäººç¾¤ä¹Ÿä¸çŸ¥æ˜¯æ€ä¹ˆæ¶ˆé€€çš„ï¼Œè‡ªç„¶å°±è®©å‡ºäº†ä¸€ä¸ªåˆšå¤Ÿè’Ÿè’»å‰è¿›çš„èº«ä½ã€‚ä»–ä¸€è·¯éª‚éª‚å’§å’§ï¼šâ€œè¿™ Leetcode æœ‰æ¯’ï¼Œå†™äº†ä¸‰ä¸ªå·®ä¸å¤šçš„ç®—æ³•ï¼Œä¸€ä¸ªæ¯”ä¸€ä¸ªæ…¢ï¼æ—©çŸ¥é“éšä¾¿å†™ä»–ä¸€ä¸ªå°±æºœäº†ï¼Œæµªè´¹è¿™ä¹ˆå¤šæ—¶é—´ä¹Ÿä¸è§ä¸ªæ•ˆæœï¼Œæˆ‘å›¾ä¸ªå•¥äº†ã€‚ã€‚ã€‚â€</p><p>è¿™æ—¶ï¼Œä¸€ä¸ªå­©å­ã€‚ã€‚ã€‚</p><p>ï¼ˆå•Šï¼Œç»ˆäºä¸‹è¯¾äº†ï¼Œåƒé¥­å»äº†ã€‚ã€‚ã€‚ä¸å†™äº†ğŸ‘‹ï¼‰</p><hr><p>By <a href="https://clownote.github.io/">CDFMLR</a>.</p>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»ã€ŒLeetcode 100. ç›¸åŒçš„æ ‘ã€å‡ºå‘è®¨è®ºä¸ºä»€ä¹ˆç”¨ã€Œå¹¶å‘ã€</title>
      <link href="/2020/04/21/School/Leetcode_P100_same-tree/"/>
      <url>/2020/04/21/School/Leetcode_P100_same-tree/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»ã€ŒLeetcode-100-ç›¸åŒçš„æ ‘ã€å‡ºå‘è®¨è®ºä¸ºä»€ä¹ˆç”¨ã€Œå¹¶å‘ã€"><a href="#ä»ã€ŒLeetcode-100-ç›¸åŒçš„æ ‘ã€å‡ºå‘è®¨è®ºä¸ºä»€ä¹ˆç”¨ã€Œå¹¶å‘ã€" class="headerlink" title="ä»ã€ŒLeetcode 100. ç›¸åŒçš„æ ‘ã€å‡ºå‘è®¨è®ºä¸ºä»€ä¹ˆç”¨ã€Œå¹¶å‘ã€"></a>ä»ã€ŒLeetcode <a href="https://leetcode-cn.com/problems/same-tree/">100. ç›¸åŒçš„æ ‘</a>ã€å‡ºå‘è®¨è®ºä¸ºä»€ä¹ˆç”¨ã€Œå¹¶å‘ã€</h1><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>ç»™å®šä¸¤ä¸ªäºŒå‰æ ‘ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥æ£€éªŒå®ƒä»¬æ˜¯å¦ç›¸åŒã€‚</p><p>å¦‚æœä¸¤ä¸ªæ ‘åœ¨ç»“æ„ä¸Šç›¸åŒï¼Œå¹¶ä¸”èŠ‚ç‚¹å…·æœ‰ç›¸åŒçš„å€¼ï¼Œåˆ™è®¤ä¸ºå®ƒä»¬æ˜¯ç›¸åŒçš„ã€‚</p><p>ç¤ºä¾‹ 1:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥:       1         1</span><br><span class="line">          &#x2F; \       &#x2F; \</span><br><span class="line">         2   3     2   3</span><br><span class="line"></span><br><span class="line">        [1,2,3],   [1,2,3]</span><br><span class="line"></span><br><span class="line">è¾“å‡º: true</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 2:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥:      1          1</span><br><span class="line">          &#x2F;           \</span><br><span class="line">         2             2</span><br><span class="line"></span><br><span class="line">        [1,2],     [1,null,2]</span><br><span class="line"></span><br><span class="line">è¾“å‡º: false</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 3:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥:       1         1</span><br><span class="line">          &#x2F; \       &#x2F; \</span><br><span class="line">         2   1     1   2</span><br><span class="line"></span><br><span class="line">        [1,2,1],   [1,1,2]</span><br><span class="line"></span><br><span class="line">è¾“å‡º: false</span><br></pre></td></tr></table></figure><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/same-tree">https://leetcode-cn.com/problems/same-tree</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p><h2 id="é€’å½’"><a href="#é€’å½’" class="headerlink" title="é€’å½’"></a>é€’å½’</h2><p>æ ‘å˜›ï¼Œæœ€æ–¹ä¾¿çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯é€’å½’ã€‚</p><p> åŒæ—¶ Walk ä¸¤æ£µæ ‘ï¼Œå¯¹äºæŸä¸€æ­¥æœ‰è¿™ä¹ˆå‡ ç§æƒ…å†µï¼š</p><ul><li>ä¸¤ä¸ªèŠ‚ç‚¹éƒ½èµ°åˆ° nil äº†ï¼Œè¯´æ˜ä¹‹å‰éƒ½ç›¸ç­‰ï¼Œè¿™é‡Œä¹Ÿç›¸ç­‰ï¼Œè¿”å› true;</li><li>ä¸¤ä¸ªèŠ‚ç‚¹ä¸€ä¸ªåˆ°äº† nilï¼Œå¦ä¸€ä¸ªä¸æ˜¯ï¼Œè¯´æ˜ä¸ç›¸ç­‰ï¼Œè¿”å› false;</li><li>ä¸¤ä¸ªèŠ‚ç‚¹éƒ½ä¸ä¸º nilï¼Œä½†å…¶ Val ä¸ç­‰ï¼Œè¯´æ˜ä¸ç›¸ç­‰ï¼Œè¿”å› false;</li><li>ä¸¤ä¸ªèŠ‚ç‚¹éƒ½ä¸ä¸º nilï¼Œä¸” Val ç›¸ç­‰ï¼Œåˆ†åˆ«ä¸‹ä¸€å±‚é€’å½’å·¦å³å­æ ‘ï¼Œè‹¥å·¦å³å­æ ‘éƒ½ç›¸ç­‰åˆ™è¿”å› true.</li></ul><p>Golang å®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *     Val int</span></span><br><span class="line"><span class="comment"> *     Left *TreeNode</span></span><br><span class="line"><span class="comment"> *     Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isSameTree</span><span class="params">(p *TreeNode, q *TreeNode)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> p == <span class="literal">nil</span> &amp;&amp; q == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (p == <span class="literal">nil</span> || q == <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> p.Val != q.Val &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> isSameTree(p.Left, q.Left) &amp;&amp; isSameTree(p.Right, q.Right)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ACï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge172qhlqij31c60u01kx.jpg" alt="image-20200421104735760"></p><p>Golang åœ¨å¤„ç†è¿™ç§æ¶‰åŠ nil å€¼åˆ¤æ–­çš„é—®é¢˜çš„æ—¶å€™éƒ½æ˜¾å¾—ç¨å¾®ç¹çäº†ä¸€ç‚¹ï¼Œç”¨ Swift å¯ä»¥å†™å‡ºæ›´ç®€æ´çš„ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     public var val: Int</span></span><br><span class="line"><span class="comment"> *     public var left: TreeNode?</span></span><br><span class="line"><span class="comment"> *     public var right: TreeNode?</span></span><br><span class="line"><span class="comment"> *     public init(_ val: Int) &#123;</span></span><br><span class="line"><span class="comment"> *         self.val = val</span></span><br><span class="line"><span class="comment"> *         self.left = nil</span></span><br><span class="line"><span class="comment"> *         self.right = nil</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isSameTree</span><span class="params">(<span class="keyword">_</span> p: TreeNode?, <span class="keyword">_</span> q: TreeNode?)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> p <span class="operator">==</span> <span class="literal">nil</span> <span class="operator">&amp;&amp;</span> q <span class="operator">==</span> <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> p<span class="operator">?</span>.val <span class="operator">!=</span> q<span class="operator">?</span>.val &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> isSameTree(p<span class="operator">?</span>.left, q<span class="operator">?</span>.left) <span class="operator">&amp;&amp;</span> isSameTree(p<span class="operator">?</span>.right, q<span class="operator">?</span>.right)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge18xo0znij31c60u01kx.jpg" alt="å±å¹•å¿«ç…§ 2020-04-21 11.48.10"></p><h2 id="è¿­ä»£"><a href="#è¿­ä»£" class="headerlink" title="è¿­ä»£"></a>è¿­ä»£</h2><p>æŠŠé€’å½’æ”¹æˆç”¨ä¸€ä¸ª <del>æ ˆ</del> é˜Ÿåˆ—å°±å¯ä»¥åœ¨è¿­ä»£é‡Œå®Œæˆè¿™ä¸ªåŠŸèƒ½äº†ï¼ŒGolang å®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isSameTree</span><span class="params">(p *TreeNode, q *TreeNode)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    s := [][<span class="number">2</span>]*TreeNode&#123;[<span class="number">2</span>]*TreeNode&#123;p, q&#125;&#125;</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">len</span>(s) &gt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> p, q, s = s[<span class="number">0</span>][<span class="number">0</span>], s[<span class="number">0</span>][<span class="number">1</span>], s[<span class="number">1</span>:]; !<span class="function"><span class="keyword">func</span> <span class="params">(pn, qn *TreeNode)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">            <span class="keyword">switch</span> &#123;</span><br><span class="line">            <span class="keyword">case</span> p == <span class="literal">nil</span> &amp;&amp; q == <span class="literal">nil</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            <span class="keyword">case</span> p == <span class="literal">nil</span> || q == <span class="literal">nil</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            <span class="keyword">case</span> p.Val != q.Val:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;(p, q) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> p != <span class="literal">nil</span> &#123;</span><br><span class="line">            s = <span class="built_in">append</span>(s, [<span class="number">2</span>]*TreeNode&#123;p.Left, q.Left&#125;, [<span class="number">2</span>]*TreeNode&#123;p.Right, q.Right&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä¸å–œæ¬¢è¿™ä¸ªç®—æ³•ï¼Œæ‰€ä»¥æˆ‘æ•…æ„æŠŠä»£ç å†™çš„å¾ˆæ¶å¿ƒï¼Œä½†å®ƒå¯ä»¥è¿è¡Œé€šè¿‡ï¼Œè€Œä¸”ä¸æ…¢ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge1e4ks0hqj31c60u01kx.jpg" alt="image-20200421145136574"></p><p>åˆ©ç”¨ Swift çš„ <strong>Optionals</strong> å’Œ <strong>Closures</strong>ï¼Œå¯ä»¥åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šç®€åŒ–åˆšæ‰çš„ golang ä»£ç ï¼Œè¿™ä¸ªä»£ç å°±çœ‹å¾—æ‡‚äº†ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isSameTree</span><span class="params">(<span class="keyword">_</span> p: TreeNode?, <span class="keyword">_</span> q: TreeNode?)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> s <span class="operator">=</span> [[p, q], ]</span><br><span class="line">        <span class="keyword">while</span> <span class="operator">!</span>s.isEmpty &#123;</span><br><span class="line">            <span class="keyword">let</span> pn <span class="operator">=</span> s[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">let</span> qn <span class="operator">=</span> s[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">            s.remove(at: <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="operator">!</span>&#123; <span class="variable">$0</span><span class="operator">?</span>.val <span class="operator">==</span> <span class="variable">$1</span><span class="operator">?</span>.val &#125;(pn, qn) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> pn <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">                s.append([pn<span class="operator">?</span>.left, qn<span class="operator">?</span>.left])</span><br><span class="line">                s.append([pn<span class="operator">?</span>.right, qn<span class="operator">?</span>.right])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge1f4q9thqj31c60u01kx.jpg" alt="image-20200421152621048"></p><h2 id="è¿›ä¸€æ­¥æ¢ç©¶ï¼šç›¸åŒçš„äºŒå‰æŸ¥æ‰¾æ ‘"><a href="#è¿›ä¸€æ­¥æ¢ç©¶ï¼šç›¸åŒçš„äºŒå‰æŸ¥æ‰¾æ ‘" class="headerlink" title="è¿›ä¸€æ­¥æ¢ç©¶ï¼šç›¸åŒçš„äºŒå‰æŸ¥æ‰¾æ ‘"></a>è¿›ä¸€æ­¥æ¢ç©¶ï¼šç›¸åŒçš„äºŒå‰æŸ¥æ‰¾æ ‘</h2><p>åœ¨ <em>A Tour of Go</em> çš„ã€Œå¹¶å‘ã€ç« èŠ‚é‡Œæœ‰è¿™ä¹ˆä¸€ä¸ªå« <a href="https://tour.golang.org/concurrency/7">Exercise: Equivalent Binary Trees</a> çš„ç»ƒä¹ é¢˜ï¼Œå’Œæˆ‘ä»¬çš„ã€Œ Leetcode 100. ç›¸åŒçš„æ ‘ã€éƒ½æ˜¯åˆ¤æ–­æ ‘æ˜¯å¦ç›¸åŒçš„ï¼Œä½†é¢˜ç›®æœ‰æ‰€åŒºåˆ«ã€‚</p><p><em>A Tour of Go</em> é‡Œçš„é¢˜ç›®å¤§æ¦‚å¦‚ä¸‹ï¼š</p><blockquote><p>ä¸åŒäºŒå‰æ ‘çš„å¶èŠ‚ç‚¹ä¸Šå¯ä»¥ä¿å­˜ç›¸åŒçš„å€¼åºåˆ—ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ä¸¤ä¸ªäºŒå‰æ ‘éƒ½ä¿å­˜äº†åºåˆ— <code>1ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ5ï¼Œ8ï¼Œ13</code>ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge2umnsl25j30dn0513yh.jpg" alt="img"></p><p>åœ¨å¤§å¤šæ•°è¯­è¨€ä¸­ï¼Œæ£€æŸ¥ä¸¤ä¸ªäºŒå‰æ ‘æ˜¯å¦ä¿å­˜äº†ç›¸åŒåºåˆ—çš„å‡½æ•°éƒ½ç›¸å½“å¤æ‚ã€‚ æˆ‘ä»¬å°†ä½¿ç”¨ Go çš„å¹¶å‘å’Œä¿¡é“æ¥ç¼–å†™ä¸€ä¸ªç®€å•çš„è§£æ³•ã€‚</p></blockquote><p>è¿™ä¸ªé¢˜æ˜¯è®©åˆ¤æ–­ä¸¤ä¸ª<strong>äºŒå‰æŸ¥æ‰¾æ ‘</strong>ï¼ˆä¸ä»…æ˜¯äºŒå‰æ ‘ï¼ï¼‰é‡Œä¿å­˜çš„åºåˆ—æ˜¯å¦ç›¸åŒã€‚</p><p>æˆ‘å…ˆè´´ä¸€ä¸‹è¿™é“é¢˜çš„äºŒå‰æœç´¢æ ‘å®ç°ï¼ˆä¸ºäº†æµ‹è¯•ï¼Œæˆ‘æŠŠæ ‘å¤§å°è°ƒçš„æ¯”è¾ƒå¤§ï¼‰ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright 2011 The Go Authors.  All rights reserved.</span></span><br><span class="line"><span class="comment">// Use of this source code is governed by a BSD-style</span></span><br><span class="line"><span class="comment">// license that can be found in the LICENSE file.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> tree <span class="comment">// import &quot;golang.org/x/tour/tree&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math/rand&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// A Tree is a binary tree with integer values.</span></span><br><span class="line"><span class="keyword">type</span> Tree <span class="keyword">struct</span> &#123;</span><br><span class="line">Left  *Tree</span><br><span class="line">Value <span class="keyword">int</span></span><br><span class="line">Right *Tree</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// New returns a new, random binary tree holding the values k, 2k, ..., 10k.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">(k <span class="keyword">int</span>)</span> *<span class="title">Tree</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> t *Tree</span><br><span class="line"><span class="keyword">for</span> _, v := <span class="keyword">range</span> rand.Perm(<span class="number">10000000</span>) &#123;</span><br><span class="line">t = insert(t, (<span class="number">1</span>+v)*k)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> t</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">insert</span><span class="params">(t *Tree, v <span class="keyword">int</span>)</span> *<span class="title">Tree</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> t == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> &amp;Tree&#123;<span class="literal">nil</span>, v, <span class="literal">nil</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> v &lt; t.Value &#123;</span><br><span class="line">t.Left = insert(t.Left, v)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">t.Right = insert(t.Right, v)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> t</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *Tree)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> t == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;()&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">s := <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">if</span> t.Left != <span class="literal">nil</span> &#123;</span><br><span class="line">s += t.Left.String() + <span class="string">&quot; &quot;</span></span><br><span class="line">&#125;</span><br><span class="line">s += fmt.Sprint(t.Value)</span><br><span class="line"><span class="keyword">if</span> t.Right != <span class="literal">nil</span> &#123;</span><br><span class="line">s += <span class="string">&quot; &quot;</span> + t.Right.String()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;(&quot;</span> + s + <span class="string">&quot;)&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥è·‘ä¸ªä¸­åºéå†ï¼ŒæŠŠå€¼å­˜ä¸‹æ¥ï¼Œå³æŠŠäºŒå‰æœç´¢æ ‘é‡Œçš„æ•°æ®æ”¾åˆ°æ’å¥½åºçš„é¡ºåºç»“æ„ä¸­ï¼Œå†æ¯”è¾ƒä¸¤ä¸ªé¡ºåºç»“æ„æ˜¯å¦ç­‰ä»·ã€‚æ¯”å¦‚å¯¹äºé¢˜ç›®ä¸­è¿™ä¸¤æ£µæ ‘ï¼Œæˆ‘ä»¬åˆ†åˆ«æŠŠä»–ä»¬åŒ–ä¸ºé¡ºåºç»“æ„ï¼Œåˆšå¥½ä¸¤ä¸ªç»“æœéƒ½æ˜¯ <code>[1ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ5ï¼Œ8ï¼Œ13]</code>ï¼Œæ‰€ä»¥ï¼Œä¸¤æ£µæ ‘æ˜¯ç­‰ä»·çš„ã€‚ä»£ç å®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// noConcurrency.go</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;./tree&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TreeHeight <span class="keyword">int</span> = <span class="number">10000000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Walk æ­¥è¿› tree t å°†æ‰€æœ‰çš„å€¼ä» tree å‘é€åˆ° channel chã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Walk</span><span class="params">(t *tree.Tree, ch *[]<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> t != <span class="literal">nil</span> &#123;</span><br><span class="line">Walk(t.Left, ch)</span><br><span class="line">*ch = <span class="built_in">append</span>(*ch, t.Value)</span><br><span class="line">Walk(t.Right, ch)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Same æ£€æµ‹æ ‘ t1 å’Œ t2 æ˜¯å¦å«æœ‰ç›¸åŒçš„å€¼ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Same</span><span class="params">(t1, t2 *tree.Tree)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">c1 := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>)</span><br><span class="line">c2 := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>)</span><br><span class="line">Walk(t1, &amp;c1)</span><br><span class="line">Walk(t2, &amp;c2)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; TreeHeight; i++ &#123;</span><br><span class="line"><span class="keyword">if</span> c1[i] != c2[i] &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">testSame()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testSame</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(Same(tree.New(<span class="number">1</span>), tree.New(<span class="number">1</span>)))</span><br><span class="line">fmt.Println(Same(tree.New(<span class="number">1</span>), tree.New(<span class="number">2</span>)))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå®ç°ä¾èµ–é¢å¤–çš„æ•°æ®å‚¨å­˜ï¼Œå†…å­˜æ¶ˆè€—å¾ˆå¤§ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge2vh6wvlvj311a0padom.jpg" alt="å±å¹•å¿«ç…§ 2020-04-22 21.33.05"></p><p>æ‰€ä»¥ï¼Œè¿˜æœ‰æ›´å¥½çš„å®ç°å—ï¼Ÿæ˜¯çš„ï¼æˆ‘ä¸€å¼€å§‹ä»‹ç»äº†ï¼Œè¿™ä¸ªé¢˜ç›®æ˜¯å‡ºç°åœ¨ã€Œå¹¶å‘ã€ç« èŠ‚é‡Œçš„ï¼ä¹ä¸€çœ‹ï¼Œä½ å¯èƒ½è§‰å¾—è¿™ä¸ªé¢˜ç”¨å¹¶å‘ï¼Œå¥½åƒå°±æ˜¯å¯ä»¥æŠŠä¸¤ä¸ªåŒ–ä¸ºé¡ºåºç»“æ„çš„é€’å½’æ”¾ä¸¤ä¸ªçº¿ç¨‹é‡Œï¼Œå•ç‹¬è·‘ï¼Œå¯ä»¥å¿«ä¸€äº›å—ï¼Ÿè¿™å¥½åƒä¹Ÿå¿«ä¸äº†å¤šå°‘ã€‚ã€‚</p><p>å…¶å®ï¼Œä¹‹æ‰€ä»¥ç”¨å¹¶å‘ï¼Œä¸æ˜¯ä¸ºäº†å¿«ï¼Œæ˜¯ä¸ºäº†çœå†…å­˜ï¼åˆ©ç”¨ Go ç¨‹ä¸ä¿¡é“ï¼Œæˆ‘ä»¬å¯ä»¥ç›¸å½“æ–¹ä¾¿çš„å®ç°ä¸€ä¸ª<strong>ä¸ç”¨é¢å¤–é¡ºåºç»“æ„</strong>çš„å®ç°ã€‚</p><p>è¿™ä¸ªå®ç°çš„æ€è·¯æ˜¯ï¼Œå¼€ä¸¤ä¸ª goroutine é‡Œåˆ†åˆ«è·‘ Walkï¼Œä¸­åºé‚£é‡Œä¸æ˜¯ append åˆ‡ç‰‡ï¼Œè€Œæ˜¯æŠŠå€¼ä¼ åˆ°ä¿¡é“é‡Œã€‚å†å¼€å¦ä¸€ä¸ª goroutine é˜»å¡ï¼Œç­‰ä¸¤ä¸ª Walk goroutine çš„ä¿¡é“éƒ½æœ‰å€¼äº†ï¼Œå°±åˆ¤æ–­è¿™ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼Œä¸ç­‰å°±ç›´æ¥è¿”å›äº†ï¼›ç›¸ç­‰çš„è¯ç»§ç»­é˜»å¡ï¼Œåˆ¤æ–­ä¸‹ä¸€ç»„ä¼ è¿‡æ¥çš„å€¼ï¼Œç›´åˆ°éå†å®Œæ ‘ã€‚å¦‚æœéå†å®Œäº†ï¼Œæ¯ä¸€ç»„å€¼éƒ½ç›¸ç­‰ï¼Œå°±è¯´æ˜ä¸¤æ£µæ ‘æ˜¯ç›¸ç­‰çš„ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// concurrency.go</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;./tree&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TreeHeight <span class="keyword">int</span> = <span class="number">10000000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Walk æ­¥è¿› tree t å°†æ‰€æœ‰çš„å€¼ä» tree å‘é€åˆ° channel chã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Walk</span><span class="params">(t *tree.Tree, ch <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> t != <span class="literal">nil</span> &#123;</span><br><span class="line">Walk(t.Left, ch)</span><br><span class="line">ch &lt;- t.Value</span><br><span class="line">Walk(t.Right, ch)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Same æ£€æµ‹æ ‘ t1 å’Œ t2 æ˜¯å¦å«æœ‰ç›¸åŒçš„å€¼ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Same</span><span class="params">(t1, t2 *tree.Tree)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">c1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">c2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line">ans := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> Walk(t1, c1)</span><br><span class="line"><span class="keyword">go</span> Walk(t2, c2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; TreeHeight; i++ &#123;</span><br><span class="line"><span class="keyword">if</span> &lt;-c1 != &lt;-c2 &#123;</span><br><span class="line">ans &lt;- <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">ans &lt;- <span class="literal">true</span></span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> &lt;-ans</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">testSame()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testSame</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(Same(tree.New(<span class="number">1</span>), tree.New(<span class="number">1</span>)))</span><br><span class="line">fmt.Println(Same(tree.New(<span class="number">1</span>), tree.New(<span class="number">2</span>)))</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è™½ç„¶æ—¶é—´ä¸ŠåŒºåˆ«ä¸å¤§ï¼ˆæ‰€ä»¥æˆ‘æ²¡è´´å‡ºæ¥ï¼‰ï¼Œä½†è¿™ä¸ªç‰ˆæœ¬çš„ä»£ç é‡Œï¼Œæˆ‘ä»¬æŠŠ <code>noConcurrency.go</code> é‡Œçš„ä¸¤ä¸ªç©ºé—´å¤æ‚åº¦ $O(n)$ åˆ‡ç‰‡æ”¹æˆäº† $O(1)$ çš„ä¿¡é“ï¼æ‰€ä»¥å†…å­˜æ¶ˆè€—ç›¸å½“æ˜¾è‘—å¾—ä¸‹é™äº†ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge2vi16zg2j311a0pa7cz.jpg" alt="å±å¹•å¿«ç…§ 2020-04-22 21.35.47"></p><h2 id="å¯ç¤ºï¼šå…³äºå¹¶å‘çš„æ€è€ƒ"><a href="#å¯ç¤ºï¼šå…³äºå¹¶å‘çš„æ€è€ƒ" class="headerlink" title="å¯ç¤ºï¼šå…³äºå¹¶å‘çš„æ€è€ƒ"></a>å¯ç¤ºï¼šå…³äºå¹¶å‘çš„æ€è€ƒ</h2><p>åœ¨è¿‡å»è¿˜æ²¡æœ‰å­¦ä¹ å¹¶å‘æŠ€æœ¯çš„å¾ˆé•¿çš„ä¸€æ®µæ—¶é—´é‡Œï¼Œæˆ‘éƒ½è®¤ä¸ºå¹¶å‘è¿™äº›ä¸œè¥¿å°±æ˜¯ä¸ºäº†å¿«ï¼ç›´åˆ°æˆ‘å­¦ Python çš„æ—¶å€™å­¦äº†ä¸€ç‚¹ç‚¹å¹¶å‘ï¼Œæ‰äº†è§£åˆ°å¹¶å‘åœ¨æˆ‘ä»¬çš„é€šä¿¡ã€æœåŠ¡è¿™æ–¹é¢æœ‰å¤šé‡è¦ã€‚ä¸è¿‡è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä¾ç„¶è®¤ä¸ºæœ¬æºæ˜¯å¹¶å‘å¯ä»¥è·‘å¾—å¿«ï¼å®ƒè·‘å¾—å¿«æ‰€ä»¥å•ä½æ—¶é—´å†…èƒ½å¤„ç†çš„æœåŠ¡å¢å¤šäº†ã€‚ã€‚ã€‚</p><p>å­¦ä¹ äº† Go ä¹‹åï¼Œå›å¤´æƒ³æƒ³è¿™äº›æƒ³æ³•ï¼Œå°±æ„Ÿè§‰æœ‰ç‚¹ç‰‡é¢äº†ã€‚</p><p>è¯šç„¶ï¼Œåœ¨å¦‚ä»Šçš„å¤šæ ¸/è¶…çº¿ç¨‹å¤„ç†å™¨ä¸‹ï¼Œå¹¶å‘ã€å¹¶è¡Œçš„ç¡®èƒ½å¸¦æ¥æ€§èƒ½çš„æå‡ã€‚ä½†è¿™äº›æ‰‹æ®µåœ¨å•æ ¸å•çº¿ç¨‹çš„å¤„ç†å™¨ä¸Šè·‘å¾—å¹¶ä¸å¿«ï¼Œè¿˜ä¸å¦‚å•çº¿ç¨‹å‘¢ã€‚ç”šè‡³æœ‰çš„æ—¶å€™ï¼Œå³ä½¿æ˜¯åœ¨å¤šçº¿ç¨‹å¤„ç†å™¨ä¸‹å¹¶å‘è·‘å¾—ä¹Ÿä¸å¿«ï¼Œå°±æ¯”å¦‚æˆ‘åˆšæ‰å†™çš„ä¸¤ä¸ªç‰ˆæœ¬åˆ¤æ–­ç›¸åŒçš„äºŒå‰æŸ¥æ‰¾æ ‘çš„ä»£ç ï¼Œå®ƒä»¬è€—æ—¶å‡ ä¹æ˜¯ä¸€æ ·çš„ã€‚å³ä¾¿å¦‚æ­¤ï¼Œæˆ‘ä»¬è¿˜æ˜¯åœ¨ç”¨å¹¶å‘â€”â€”ä¸æ˜¯ä¸ºäº†æ•ˆç‡ï¼Œè€Œæ˜¯æŠŠé—®é¢˜æ‹†åˆ†æˆå°çš„æ¨¡å—ï¼Œå•ç‹¬å»å¤„ç†ä¸€ä¸ªä¸€ä¸ªçš„å°æ¨¡å—ã€‚æ¨¡å—ä¸æ¨¡å—ä¹‹é—´ç›¸å¯¹ç‹¬ç«‹ï¼Œåªåœ¨å¿…è¦çš„æ—¶æœºä¼ é€’å¿…è¦çš„ã€æœ€å°åŒ–çš„ä¿¡æ¯ï¼ˆè€Œä¸”æœ€å¥½æ˜¯å•å‘ç‚¹å¯¹ç‚¹çš„ä¼ é€’ï¼Œä¸€ä¸ªå‘ï¼Œä¸€ä¸ªæ”¶ï¼‰ã€‚</p><p>æ¨¡å—é—´çš„é€šä¿¡æ˜¯è¿™ç§ç³»ç»Ÿçš„ç²¾é«“ã€‚</p><p>æˆ‘ä»¬ä¸€å¼€å§‹å†™çš„ <code>noConcurrency.go</code> é‡Œä¸¤ä¸ª Walk æ¨¡å—ç‹¬è‡ªè¿è¡Œï¼ˆè™½ç„¶è¿™é‡Œä¸¤ä¸ªæ¨¡å—ä¸æ˜¯å¹¶å‘çš„ï¼Œä½†ä¸å½±å“è®¨è®ºï¼Œä½ å¯ä»¥çœ‹ä½œæ˜¯å¹¶å‘ï¼Œç»™Walkè°ƒç”¨å‰é¢åŠ ä¸ªgoå°±å¥½äº†ï¼‰ï¼Œå®ƒä»¬ä¹‹é—´æ²¡æœ‰ä»»ä½•é€šè®¯æŠŠå®ƒä»¬è”ç³»èµ·æ¥ã€‚è¿™å¯¼è‡´äº†ä¸¤ä¸ªæ¨¡å—å¿…é¡»å„è‡ªæŠŠæ•´é¢—æ ‘è·‘å®Œï¼Œè¿”ä¸¤ä¸ªè¶…å¤§çš„åˆ‡ç‰‡å›æ¥ï¼Œå†é€ä½åˆ¤æ–­ä¸¤ä¸ªåˆ‡ç‰‡é‡Œçš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚è¦æ³¨æ„ï¼Œè¿™ä¸¤ä¸ªè¶…å¤§çš„åˆ‡ç‰‡é‡Œæ¯ä¸€ä¸ªå€¼æˆ‘ä»¬éƒ½åªæœ‰äº†ä¸€æ¬¡å•Šï¼Œä½†æ˜¯ç”¨ä¹‹å‰å®ƒåœ¨é‚£é‡Œå ç”¨å†…å­˜ï¼Œç”¨ä¹‹åå®ƒè¿˜åœ¨é‚£é‡Œæ¶ˆè€—èµ„æºã€‚ä¸€å¤§å †($O(n)$)è¿™æ ·çš„ã€Œå½“å‰æ²¡æœ‰æ­£åœ¨è¢«ä½¿ç”¨çš„å€¼ã€å¯¼è‡´äº†å¤§é‡çš„æµªè´¹ã€‚</p><p>æˆ‘ä»¬ä¸å¸Œæœ›è¿™æ ·çš„æµªè´¹ï¼Œå³å¸Œæœ›å°½é‡å‡å°‘è¿™ç§ã€Œå½“å‰æ²¡æœ‰æ­£åœ¨è¢«ä½¿ç”¨çš„å€¼ã€ã€‚é‚£è¦æ€ä¹ˆåŠï¼Ÿå°½é‡å‡å°‘å°±å‡åˆ°é›¶å˜›ï¼Œé‚£è¿™ä»»åŠ¡å°±å®Œæˆä¸äº†äº†ã€‚é›¶ä¸ªä¸è¡Œï¼Œå°±è€ƒè™‘ $O(1)$ ä¸ªã€‚æˆ‘ä»¬å¾ˆè‡ªç„¶å°±æƒ³åˆ°äº†ä¸¤ä¸ª Walk åˆ†åˆ«æŠŠè‡ªå·±éå†åˆ°çš„å€¼æ”¾åˆ°å˜é‡ <code>c1</code>ã€<code>c2</code> é‡Œï¼Œç„¶ååŠæ—¶åœ°æ¯”è¾ƒ <code>c1</code>ã€<code>c2</code> ï¼Œæ¯”è¾ƒå®Œå°±æ‰”ï¼Œç„¶åä¸¤ä¸ª Walk åˆå¯ä»¥å¾€é‡Œé¢æ”¾å€¼äº†ï¼Œç„¶åå†æ¬¡æ¯”è¾ƒã€‚è¿™ç§æƒ³æ³•å³å¯ä»¥å®Œæˆä»»åŠ¡ï¼ŒåˆæŠŠæ¶ˆè€—é™åˆ°äº† $O(1)$ã€‚</p><p>æˆ‘ä»¬æ¥è¯•ç€è¿™ç§æƒ³æ³•ï¼Œç”¨ä¼ ç»Ÿçš„ä»£ç ï¼Œéœ€è¦åŒæ—¶éå†ä¸¤é¢—æ ‘ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">DuplicateWalk</span><span class="params">(t1 *tree.Tree, t2 *tree.Tree)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> t1 != <span class="literal">nil</span> &amp;&amp; t2 != <span class="literal">nil</span> &#123;</span><br><span class="line">Walk(t1.Left, t2.Left)</span><br><span class="line">        <span class="keyword">if</span> t1.Value != t2.Value &#123;</span><br><span class="line">            <span class="comment">// not Equivalent</span></span><br><span class="line">        &#125;</span><br><span class="line">Walk(t1.Right, t2.Right)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ ä¼šå‘ç°è¿™å¾ˆä¸ä¼˜é›…ï¼æ˜æ˜æ˜¯ä¸¤æ£µä¸åŒçš„æ ‘çš„éå†ï¼Œç°åœ¨éƒ½è¿åˆ°ä¸€èµ·äº†ï¼åœ¨è¿™ä¸ªé—®é¢˜é‡Œå› ä¸ºéå†äºŒå‰æ ‘è¿™ç§ä»»åŠ¡å¾ˆç®€å•ï¼Œæ‰€ä»¥è¿™ç§å†™æ³•å‹‰å¼ºå¯ä»¥æ¥å—ï¼Œä½†å¦‚æœä½ é¢å¯¹çš„ä¸æ˜¯æ ‘çš„éå†è€Œæ˜¯ä¸€ä¸ªè¶…å¤æ‚çš„å·¥ä½œã€ä¹Ÿä¸æ­¢æ˜¯ä¸¤ä¸ªåŒæ—¶ï¼Œè€Œæ˜¯ä¸Šåƒä¸ªä»»åŠ¡ï¼Œè¿™ç§å†™æ³•å°±ä¼šå¤æ‚çš„ä¸å¯æ¥å—ï¼Œä¹ƒè‡³æ— æ³•å®ç°äº†ã€‚</p><p>æ—¢è¦åŒæ—¶å‘ç”Ÿï¼ˆ<code>Walk(t1, t2)</code>ï¼‰ï¼Œåˆè¦åŒæ—¶åœæ­¢è¿›è¡Œæ¯”è¾ƒï¼ˆ<code>if t1.Value != t2.Value &#123;...&#125;</code>ï¼‰ï¼Œè¿˜è¦ä¸æ¶å¿ƒåœ°æŠŠä¸¤æ£µæ ‘çš„éå†å†™åœ¨ä¸€èµ·ï¼Œè¿™å°±æ˜¯ã€Œå¹¶å‘ã€å¯ä»¥å¹²çš„äº‹äº†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> Walk(t1, c1)</span><br><span class="line"><span class="keyword">go</span> Walk(t2, c2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; TreeHeight; i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> &lt;-c1 != &lt;-c2 &#123;</span><br><span class="line">            ans &lt;- <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ans &lt;- <span class="literal">true</span></span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure><p>æ ‘çš„é€’å½’è¿˜æ˜¯ä¸€é¢—æ ‘ä¸€é¢—æ ‘åˆ†å¼€çš„ï¼ˆè¿™å¾ˆå¥½ï¼Œä¸€ä¸ªæ¨¡å—å°±åªåº”è¯¥åšä¸€ä¸ªäº‹ï¼‰ï¼Œè€Œä¸”è¿™æ¬¡å®ƒä»¬åŒæ—¶è¿è¡Œã€‚åŒæ—¶è¿è¡Œå°±å¯ä»¥è¿›è¡Œé€šä¿¡ï¼å®ƒä»¬åˆ†åˆ«é ä¸¤ä¸ªä¿¡é“æŠŠéå†åˆ°çš„å€¼ä¼ å‡ºæ¥ï¼Œç„¶åå¦ä¸€ä¸ª goroutine ï¼ˆæ¨¡å—ï¼‰å°±ç­‰ç€è¿™ä¸¤ä¸ªä¿¡é“éƒ½æœ‰å€¼çš„æ—¶å€™æŠŠå€¼å–å‡ºæ¥æ¯”è¾ƒä¸€æ³¢ã€‚è¿™æ ·åœ¨å¹¶å‘ä¸‹é ä¿¡é“æ¥é€šä¿¡ï¼Œå•å‘ï¼Œç‚¹å¯¹ç‚¹ï¼Œä¸€ä¸ªå‘ã€ä¸€ä¸ªæ”¶ï¼Œåœ¨ä¼˜é›…åœ°å®Œæˆä»»åŠ¡çš„åŒæ—¶ï¼ŒåˆæŠŠæ¶ˆè€—é™åˆ°äº†æœ€ä½ã€‚æ‰€ä»¥è¯´æ¨¡å—é—´çš„é€šä¿¡æ˜¯å¹¶å‘ç³»ç»Ÿçš„ç²¾é«“ã€‚</p><p>å½“ç„¶ï¼Œå¹¶å‘è¿˜æœ‰å¦ä¸€ç§å¥½å¤„ï¼šåœ¨è¿™ç§æ¨¡å—åŒ–çš„ç³»ç»Ÿä¸­ï¼Œåªæœ‰æ¨¡å—è®¾è®¡çš„é€‚å½“å°ï¼Œåˆ†ç¦»å¾—è¶³å¤Ÿå……åˆ†ï¼Œæ¨¡å—é—´çš„é€šä¿¡æ§åˆ¶å¾—è¶³å¤Ÿå‡†ç¡®ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªæ¨¡å—å‡ºäº†é—®é¢˜ï¼Œé™¤äº†ä¸ä¹‹é€šä¿¡çš„æœ‰é™ä¸ªæ¨¡å—éšä¹‹æŒ‚èµ·å¤–ï¼Œå…¶ä»–çš„æ¨¡å—éƒ½è¿˜æ˜¯å¥½çš„ã€‚è¿™ç§å°è§„æ¨¡çš„å±€éƒ¨é—®é¢˜æ˜¯å¯ä»¥å¤„ç†çš„ï¼Œä¸å®¹æ˜“é€ æˆå…¨ç›˜è¿é”å´©æºƒã€‚è¿™åœ¨æœåŠ¡ç«¯ç¨‹åºé‡Œå°¤ä¸ºé‡è¦ã€‚</p><p>ï¼ˆæˆ‘å›°äº†å†™ä¸ä¸‹å»äº†ï¼Œå°±è¿™æ ·å§ï¼Œæœ‰æœºä¼šå†æ”¹æ”¹ã€å†è¡¥å……ï¼‰</p><hr><p>By CDFMLR.</p>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode 78. å­é›†</title>
      <link href="/2020/04/14/School/Leetcode_P78_subsets/"/>
      <url>/2020/04/14/School/Leetcode_P78_subsets/</url>
      
        <content type="html"><![CDATA[<h1 id="Leetcode-78-å­é›†"><a href="#Leetcode-78-å­é›†" class="headerlink" title="Leetcode 78. å­é›†"></a>Leetcode <a href="https://leetcode-cn.com/problems/subsets/">78. å­é›†</a></h1><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>ç»™å®šä¸€ç»„ä¸å«é‡å¤å…ƒç´ çš„æ•´æ•°æ•°ç»„ numsï¼Œè¿”å›è¯¥æ•°ç»„æ‰€æœ‰å¯èƒ½çš„å­é›†ï¼ˆå¹‚é›†ï¼‰ã€‚</p><p>è¯´æ˜ï¼šè§£é›†ä¸èƒ½åŒ…å«é‡å¤çš„å­é›†ã€‚</p><p>ç¤ºä¾‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: nums &#x3D; [1,2,3]</span><br><span class="line">è¾“å‡º:</span><br><span class="line">[</span><br><span class="line">  [3],</span><br><span class="line">  [1],</span><br><span class="line">  [2],</span><br><span class="line">  [1,2,3],</span><br><span class="line">  [1,3],</span><br><span class="line">  [2,3],</span><br><span class="line">  [1,2],</span><br><span class="line">  []</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/subsets">https://leetcode-cn.com/problems/subsets</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p><h2 id="ä½è¿ç®—"><a href="#ä½è¿ç®—" class="headerlink" title="ä½è¿ç®—"></a>ä½è¿ç®—</h2><p>å…¶å®å˜›ï¼Œå–å­é›†è¿™ä»¶äº‹æƒ…ï¼Œå¯¹æ¯ä¸€ä¸ªå…ƒç´ å°±ä¸¤ç§çŠ¶æ€ï¼Œå–å’Œä¸å–ï¼Œå…±æœ‰ $2^{len(nums)}$ç§å¯èƒ½ã€‚è¿™å¯ä»¥ç›´æ¥ç”¨ä¸€ä¸ªäºŒè¿›åˆ¶ bit ï¼ˆbooleanï¼‰ä½å‘é‡è¡¨ç¤º:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">å¹‚é›† = [</span><br><span class="line">    [],</span><br><span class="line">    [<span class="number">1</span>],</span><br><span class="line">    [<span class="number">2</span>],</span><br><span class="line">    [<span class="number">1</span>,<span class="number">2</span>],</span><br><span class="line">    [<span class="number">3</span>],</span><br><span class="line">    [<span class="number">1</span>,<span class="number">3</span>],</span><br><span class="line">    [<span class="number">2</span>,<span class="number">3</span>],</span><br><span class="line">    [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 0 è¡¨ç¤ºä¸å–</span></span><br><span class="line"><span class="comment"># 1 è¡¨ç¤ºå–</span></span><br><span class="line">å¯¹åº”å–çš„çŠ¶æ€ = [</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæ‰€æœ‰å¯¹åº”å–çš„çŠ¶æ€åˆåœ¨ä¸€èµ·ï¼Œå…¶å®å°±æ˜¯éå†äº† <code>len(nums)</code> ä½çš„äºŒè¿›åˆ¶ä½å‘é‡æ‰€æœ‰å¯èƒ½çš„å–å€¼ã€‚å¦‚æœç”¨æ•´æ•°è¡¨ç¤ºäºŒè¿›åˆ¶ä½å‘é‡ï¼Œå³éå† <code>[0, 1 &lt;&lt; len(nums) - 1]</code> ã€‚è¿™æ ·å®ç°èµ·æ¥å¾ˆç®€å•äº†ï¼Œè·‘ä¸€ä¸ªå¾ªç¯å°±è¡Œï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1</span> &lt;&lt; <span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªéå†é‡Œï¼ŒæŠŠäºŒè¿›åˆ¶ä½å‘é‡æ˜ å°„åˆ°åŸæ•°ç»„çš„ç´¢å¼•ï¼Œå°±èƒ½å–å‡ºä¸€ä¸ªå­é›†äº†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">s := []<span class="keyword">int</span>&#123;&#125;</span><br><span class="line"><span class="keyword">for</span> j, ii := <span class="number">0</span>, i; j &lt; <span class="built_in">len</span>(nums); j, ii = j+<span class="number">1</span>, ii&gt;&gt;<span class="number">1</span> &#123;</span><br><span class="line">    <span class="comment">// è¿™ä¸ª for å…¶å®å°±æ˜¯æ¯æ¬¡ä»ä½ä½ç«¯ pop ä¸€ä¸ªä½å‡ºæ¥ï¼Œè¿™ä¸ªä½å¯¹åº”ä¸€ä¸ªç´¢å¼•å˜›</span></span><br><span class="line">    <span class="comment">// pop å‡ºçš„æ˜¯ 1 å°±å–è¿™ä¸ªç´¢å¼•å¤„çš„å…ƒç´ è¿›å­é›†</span></span><br><span class="line">    <span class="keyword">if</span> ii &amp; <span class="number">1</span> == <span class="number">1</span> &#123;</span><br><span class="line">        s = <span class="built_in">append</span>(s, nums[j])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆåœ¨ä¸€èµ·ï¼Œå°±æœ‰äº†å®Œæ•´çš„ Golang å®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">subsets</span><span class="params">(nums []<span class="keyword">int</span>)</span> [][]<span class="title">int</span></span> &#123;</span><br><span class="line">    subs := [][]<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1</span> &lt;&lt; <span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">        s := []<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> j, ii := <span class="number">0</span>, i; j &lt; <span class="built_in">len</span>(nums); j, ii = j+<span class="number">1</span>, ii&gt;&gt;<span class="number">1</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> ii &amp; <span class="number">1</span> == <span class="number">1</span> &#123;</span><br><span class="line">                s = <span class="built_in">append</span>(s, nums[j])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        subs = <span class="built_in">append</span>(subs, s)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> subs</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å•Šï¼Œæˆ‘å†™ä¸æ¸…è¿™ä¸ªï¼Œï¼Œï¼Œæˆ‘è§‰å¾—äºŒè¿›åˆ¶ã€ä½è¿ç®—è¿™ç§ä¸œè¥¿ç›¸å½“è‡ªç„¶ï¼Œå°±åƒæˆ‘ä»¬ç®— 1 + 1 å¾ˆè‡ªç„¶å°±å¾—åˆ°äº† 2ï¼Œç”¨äºŒè¿›åˆ¶ä½å‘é‡æ˜¯ä¸€ç§å¾ˆè‡ªç„¶çš„äº‹ï¼Œå®ƒå°±è¯¥è¿™ä¹ˆç”¨ï¼Œæ‰€æœ‰åå€’éš¾ä»¥è§£é‡Šäº†ğŸ˜‚</p><p>ä¹Ÿè®¸è¿™ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ€è·¯ï¼Œä½†ä»ç»“æœä¸Šæ¥çœ‹ï¼Œè¿™ä¸ªç®—æ³•è¿˜æ˜¯æ¯”è¾ƒå¿«çš„ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gdt1clsxr0j31c60u0not.jpg" alt="å±å¹•å¿«ç…§ 2020-04-14 08.50.13"></p>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode 136. åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—</title>
      <link href="/2020/04/08/School/Leetcode_P136_single-number/"/>
      <url>/2020/04/08/School/Leetcode_P136_single-number/</url>
      
        <content type="html"><![CDATA[<h1 id="Leetcode-136-åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—"><a href="#Leetcode-136-åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—" class="headerlink" title="Leetcode 136. åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—"></a>Leetcode <a href="https://leetcode-cn.com/problems/single-number/">136. åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—</a></h1><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>ç»™å®šä¸€ä¸ªéç©ºæ•´æ•°æ•°ç»„ï¼Œé™¤äº†æŸä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ä»¥å¤–ï¼Œå…¶ä½™æ¯ä¸ªå…ƒç´ å‡å‡ºç°ä¸¤æ¬¡ã€‚æ‰¾å‡ºé‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„å…ƒç´ ã€‚</p><p>è¯´æ˜ï¼š</p><p>ä½ çš„ç®—æ³•åº”è¯¥å…·æœ‰çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€‚ ä½ å¯ä»¥ä¸ä½¿ç”¨é¢å¤–ç©ºé—´æ¥å®ç°å—ï¼Ÿ</p><p>ç¤ºä¾‹ 1:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: [2,2,1]</span><br><span class="line">è¾“å‡º: 1</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 2:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: [4,1,2,1,2]</span><br><span class="line">è¾“å‡º: 4</span><br></pre></td></tr></table></figure><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/single-number">https://leetcode-cn.com/problems/single-number</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p><h2 id="å“ˆå¸Œè¡¨"><a href="#å“ˆå¸Œè¡¨" class="headerlink" title="å“ˆå¸Œè¡¨"></a>å“ˆå¸Œè¡¨</h2><p>è¿™é“é¢˜æœ€ç®€å•çš„æ–¹æ³•ï¼Œå“ˆå¸Œè¡¨æš´åŠ›å­˜ä¸€ä¸‹å‡ºç°æ¬¡æ•°å°±å¥½äº†ã€‚ç”±äºé¢˜ç›®ä¿è¯æœ€å¤šæœ‰å‡ºç°ä¸¤æ¬¡ï¼Œæ‰€ä»¥ç”¨ä¸ªboolå»å­˜å‡ºç°æ¬¡æ•°å°±è¡Œäº†ï¼ŒGolang å®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">singleNumber</span><span class="params">(nums []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    memo := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">bool</span>)</span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> nums &#123;</span><br><span class="line">        memo[v] = !memo[v]</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">for</span> k, v := <span class="keyword">range</span> memo &#123;</span><br><span class="line">        <span class="keyword">if</span> v &#123;</span><br><span class="line">            <span class="keyword">return</span> k</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¼‚æˆ–"><a href="#å¼‚æˆ–" class="headerlink" title="å¼‚æˆ–"></a>å¼‚æˆ–</h2><p>æŒ‰ä½å¼‚æˆ–ï¼ˆCé£æ ¼å†™åš <code>^</code>ï¼‰æœ‰å¾ˆå¤šæœ‰è¶£çš„æ€§è´¨ï¼Œè¿™é“é¢˜å¯ä»¥ç”¨å…¶ä¸­çš„ä¸€ä¸¤ä¸ªï¼š</p><ol><li><code>x ^ x = 0</code></li><li><code>0 ^ x = x</code></li></ol><p>å…¶å®è¿™ä¸¤ä¸ªæ€§è´¨è¿˜æ˜¯å¾ˆæ˜¾ç„¶çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  100110</span><br><span class="line">^ 100110</span><br><span class="line">--------</span><br><span class="line">  000000</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  000000</span><br><span class="line">^ 100110</span><br><span class="line">--------</span><br><span class="line">  100110</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªæ€§è´¨åˆåœ¨ä¸€èµ·å°±æœ‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a ^ a ^ b ^ b ^ ... ^ z &#x3D; z</span><br><span class="line">&#x2F;&#x2F; çœç•¥çš„é‚£é‡Œä¹Ÿæ˜¯ä¸€å¯¹ä¸€å¯¹çš„ï¼Œåªæœ‰zæ˜¯å•ç‹¬ä¸€ä¸ª</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜å°±è§£å†³äº†ã€‚</p><p>Golang å®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">singleNumber</span><span class="params">(nums []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    x := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> nums &#123;</span><br><span class="line">        x ^= v</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gdmdhgx8xwj317x0u04qd.jpg" alt="image-20200408150554908"></p>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode 3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</title>
      <link href="/2020/04/07/School/Leetcode_P3_longest-substring-without-repeating-characters/"/>
      <url>/2020/04/07/School/Leetcode_P3_longest-substring-without-repeating-characters/</url>
      
        <content type="html"><![CDATA[<h1 id="Leetcode-3-æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²"><a href="#Leetcode-3-æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²" class="headerlink" title="Leetcode 3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²"></a>Leetcode <a href="https://leetcode-cn.com/problems/longest-substring-without-repeating-characters/">3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</a></h1><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„ æœ€é•¿å­ä¸² çš„é•¿åº¦ã€‚</p><p>ç¤ºä¾‹ 1:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: &quot;abcabcbb&quot;</span><br><span class="line">è¾“å‡º: 3 </span><br><span class="line">è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ &quot;abc&quot;ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 2:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: &quot;bbbbb&quot;</span><br><span class="line">è¾“å‡º: 1</span><br><span class="line">è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ &quot;b&quot;ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 1ã€‚</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 3:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: &quot;pwwkew&quot;</span><br><span class="line">è¾“å‡º: 3</span><br><span class="line">è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ &quot;wke&quot;ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚</span><br></pre></td></tr></table></figure><p>â€‹     è¯·æ³¨æ„ï¼Œä½ çš„ç­”æ¡ˆå¿…é¡»æ˜¯ å­ä¸² çš„é•¿åº¦ï¼Œâ€pwkeâ€ æ˜¯ä¸€ä¸ªå­åºåˆ—ï¼Œä¸æ˜¯å­ä¸²ã€‚</p><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/longest-substring-without-repeating-characters">https://leetcode-cn.com/problems/longest-substring-without-repeating-characters</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p><h2 id="å¯èƒ½æ˜¯æ»‘çª—çš„è§£æ³•"><a href="#å¯èƒ½æ˜¯æ»‘çª—çš„è§£æ³•" class="headerlink" title="å¯èƒ½æ˜¯æ»‘çª—çš„è§£æ³•"></a>å¯èƒ½æ˜¯æ»‘çª—çš„è§£æ³•</h2><p>ï¼ˆè¿™é“é¢˜æˆ‘å»å¹´å†™çš„äº†ï¼Œå¤§æ¦‚çœ‹äº†ä¸€ä¸‹ï¼Œè¿˜å¯ä»¥ï¼Œå°±ä¸é‡æ–°å†™ äº†ï¼‰</p><p>å…¶å®å°±æ˜¯åƒäººä¸€æ ·å»æ‰¾ï¼Œè¿™ä¸ªç®—æ³•è¿˜æ˜¯å¾ˆç›´æ¥æš´åŠ›çš„ï¼ŒCè¯­è¨€å®ç°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(<span class="keyword">char</span> * s)</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *pmhead = s;</span><br><span class="line">    <span class="keyword">char</span> *pmtail = s;</span><br><span class="line">    <span class="keyword">int</span> max = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">char</span> c = *s;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span> *pc;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> j;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (c = s[i++], c != <span class="string">&#x27;\0&#x27;</span>) &#123;</span><br><span class="line">        j = pmtail - pmhead;</span><br><span class="line">        pc = <span class="built_in">memchr</span>(pmhead, c, j);</span><br><span class="line">        <span class="keyword">if</span> (pc != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (j &gt; max) &#123;</span><br><span class="line">                max = j;</span><br><span class="line">            &#125;</span><br><span class="line">            pmhead = pc + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        pmtail++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (pmtail - pmhead &gt; max) &#123;</span><br><span class="line">        max = pmtail - pmhead;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gdkvuf8tzaj31l10u0dkk.jpg" alt="image-20200407080959808"></p>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode 14. æœ€é•¿å…¬å…±å‰ç¼€</title>
      <link href="/2020/03/31/School/Leetcode_P14_longest-common-prefix/"/>
      <url>/2020/03/31/School/Leetcode_P14_longest-common-prefix/</url>
      
        <content type="html"><![CDATA[<h1 id="Leetcode-14-æœ€é•¿å…¬å…±å‰ç¼€"><a href="#Leetcode-14-æœ€é•¿å…¬å…±å‰ç¼€" class="headerlink" title="Leetcode 14. æœ€é•¿å…¬å…±å‰ç¼€"></a>Leetcode <a href="https://leetcode-cn.com/problems/longest-common-prefix/">14. æœ€é•¿å…¬å…±å‰ç¼€</a></h1><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥æŸ¥æ‰¾å­—ç¬¦ä¸²æ•°ç»„ä¸­çš„æœ€é•¿å…¬å…±å‰ç¼€ã€‚</p><p>å¦‚æœä¸å­˜åœ¨å…¬å…±å‰ç¼€ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸² â€œâ€ã€‚</p><p>ç¤ºä¾‹ 1:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: [&quot;flower&quot;,&quot;flow&quot;,&quot;flight&quot;]</span><br><span class="line">è¾“å‡º: &quot;fl&quot;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 2:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: [&quot;dog&quot;,&quot;racecar&quot;,&quot;car&quot;]</span><br><span class="line">è¾“å‡º: &quot;&quot;</span><br><span class="line">è§£é‡Š: è¾“å…¥ä¸å­˜åœ¨å…¬å…±å‰ç¼€ã€‚</span><br></pre></td></tr></table></figure><p>è¯´æ˜:</p><p>æ‰€æœ‰è¾“å…¥åªåŒ…å«å°å†™å­—æ¯ a-z ã€‚</p><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/longest-common-prefix">https://leetcode-cn.com/problems/longest-common-prefix</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p><h2 id="æš´åŠ›éå†æ³•"><a href="#æš´åŠ›éå†æ³•" class="headerlink" title="æš´åŠ›éå†æ³•"></a>æš´åŠ›éå†æ³•</h2><p>è¿™ä¸ªæ–¹æ³•çš„æ€è·¯æ˜¯è¿™æ ·ï¼š</p><p>ä¾‹å¦‚ï¼Œå¤„ç†é¢˜ä¾‹ <code>strs = [&quot;flower&quot;,&quot;flow&quot;,&quot;flight&quot;]</code>:</p><p>ç¬¬ä¸€è½®ï¼š</p><ol><li>ä» <code>strs[0]</code> å³<del>ç¬¬0ä¸ª</del>ç¬¬ä¸€ä¸ªå…ƒç´  <code>&quot;flower&quot;</code> å–å‡ºç¬¬ä¸€ä¸ªå­—ç¬¦ <code>&quot;f&quot;</code></li><li>éå† <code>strs</code>ï¼Œè‹¥æœ‰å…ƒç´ æ²¡æœ‰å‰ç¼€ <code>&quot;f&quot;</code>ï¼Œåˆ™æœ€é•¿å…¬å…±å‰ç¼€ä¸º <code>&quot;&quot;</code></li></ol><p>ç¬¬äºŒè½®ï¼š</p><ol><li>ä» <code>strs[0]</code> å³<del>ç¬¬0ä¸ª</del>ç¬¬ä¸€ä¸ªå…ƒç´  <code>&quot;flower&quot;</code> å–å‡ºå‰ä¸¤ä¸ªå­—ç¬¦ <code>&quot;fl&quot;</code></li><li>éå† <code>strs</code>ï¼Œè‹¥æœ‰å…ƒç´ æ²¡æœ‰å‰ç¼€ <code>&quot;fl&quot;</code>ï¼Œåˆ™æœ€é•¿å…¬å…±å‰ç¼€ä¸º <code>&quot;f&quot;</code></li></ol><p>ç¬¬ä¸‰è½®ï¼š</p><ol><li>ä» <code>strs[0]</code> å³<del>ç¬¬0ä¸ª</del>ç¬¬ä¸€ä¸ªå…ƒç´  <code>&quot;flower&quot;</code> å†å–å‡ºå‰ä¸‰ä¸ªå­—ç¬¦ï¼Œå¾—åˆ° <code>&quot;flo&quot;</code></li><li>éå† <code>strs</code>ï¼Œè‹¥æœ‰å…ƒç´ æ²¡æœ‰å‰ç¼€ <code>&quot;flo&quot;</code>ï¼Œåˆ™æœ€é•¿å…¬å…±å‰ç¼€ä¸º <code>&quot;fl&quot;</code></li></ol><p>â€¦â€¦</p><p>Golang å®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">longestCommonPrefix</span><span class="params">(strs []<span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(strs) == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    i := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ; i &lt; <span class="built_in">len</span>(strs[<span class="number">0</span>]); i++ &#123;</span><br><span class="line">        <span class="keyword">for</span> j := <span class="number">1</span>; j &lt; <span class="built_in">len</span>(strs); j++ &#123;</span><br><span class="line">            <span class="keyword">if</span> !strings.HasPrefix(strs[j], strs[<span class="number">0</span>][:i+<span class="number">1</span>]) &#123;</span><br><span class="line">                <span class="keyword">return</span> strs[<span class="number">0</span>][:i]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> strs[<span class="number">0</span>][:i]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gdct2u0iynj31930u04pt.jpg" alt="å±å¹•å¿«ç…§ 2020-03-31 08.28.51"></p><p>æ„Ÿè§‰è¿˜æœ‰å¥½å¤šç§æš´åŠ›éå†çš„æ–¹æ³•ï¼Œéšä¾¿æ€ä¹ˆéƒ½å‡ºå¾—æ¥ï¼Œä½†å¥½åƒæ•ˆç‡éƒ½å·®ä¸å¤šï¼Ÿå¤§æ¦‚æ˜¯ $O(\sum_{i=0}^{len(strs)}len(strs[i]))$ï¼Ÿ</p><h2 id="åˆ†æ²»æ³•"><a href="#åˆ†æ²»æ³•" class="headerlink" title="åˆ†æ²»æ³•"></a>åˆ†æ²»æ³•</h2><p>æˆ‘æƒ³ç”¨åˆ†æ²»æ¥å†™è¿™ä¸ªï¼Œæ„Ÿè§‰ä¼šæ¯”è¾ƒæœ‰æ„æ€ã€‚</p><p>å…¶å®å°±æ˜¯ä¸€ä¸ªé€’å½’ï¼Œç”¨äºŒåˆ†æ³•â€œåˆ†â€é—®é¢˜ï¼Œåˆ†åˆ°æœ€ååŸºç¡€æƒ…å†µå°±æ˜¯åªå‰©ä¸€ä¸ªå…ƒç´ ç›´æ¥è¿”å›ï¼›ç„¶åâ€œåˆâ€å°±æ˜¯æ±‚äºŒåˆ†å·¦å³é€’å½’å„è‡ªè¿”å›æ¥çš„ä¸¤ä¸ªä¸²çš„æœ€é•¿å…¬å…±å‰ç¼€ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gdcuvnmzffj31sz0u0gqr.jpg" alt="image-20200331093206511"></p><p>ï¼ˆæˆ‘ç–¯äº†ï¼Œå±…ç„¶ç”¨ XMind ç”»è¿™ä¸ªã€‚ã€‚ã€‚ï¼‰</p><p>ä»£ç å®ç°ï¼ŒGolangï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">longestCommonPrefix</span><span class="params">(strs []<span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(strs) == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> partLongestCommonPrefix(strs)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">partLongestCommonPrefix</span><span class="params">(strs []<span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(strs) &lt;= <span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> strs[<span class="number">0</span>]</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        m := <span class="built_in">len</span>(strs) / <span class="number">2</span></span><br><span class="line">        l := partLongestCommonPrefix(strs[: m])</span><br><span class="line">        r := partLongestCommonPrefix(strs[m :])</span><br><span class="line">        <span class="keyword">return</span> fuzzbuzz(l, r)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * fuzzbuzz æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥è¿”å›ä¸¤ä¸ªå­—ç¬¦ä¸²çš„æœ€é•¿å…¬å…±å‰ç¼€</span></span><br><span class="line"><span class="comment"> * ç”¨è¿™ä¸ªå‡½æ•°æ¥ä¸¾åä¾‹ï¼Œä»¥æ­¤å‘¼åå¤§å®¶è®¤çœŸå‘½åã€å–æœ‰æ„ä¹‰çš„åå­—ï¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fuzzbuzz</span><span class="params">(foo, bar <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    fuzz := <span class="built_in">len</span>(foo)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(bar) &lt; fuzz &#123;</span><br><span class="line">        fuzz = <span class="built_in">len</span>(bar)</span><br><span class="line">    &#125;</span><br><span class="line">    buzz := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ; buzz &lt; fuzz; buzz++ &#123;</span><br><span class="line">        <span class="keyword">if</span> foo[buzz] != bar[buzz] &#123;</span><br><span class="line">            <span class="keyword">return</span> foo[: buzz]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> foo[: buzz]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®è¿™ä¸ªæ—¶é—´å¤æ‚åº¦å’Œåˆšæ‰é‚£ä¸ªæš´åŠ›æ³•å·®ä¸å¤šï¼Œè€Œç©ºé—´å ç”¨è¿˜æ›´å¤šäº†ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gdcuauj2g2j31930u01kx.jpg" alt="image-20200331091205895"></p>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PythonåŸºç¡€æ‰‹å†ŒP2 åŸºæœ¬æ•°æ®ç±»å‹åŸºæœ¬ç±»å‹</title>
      <link href="/2020/03/28/python_booklet/Python%E5%9F%BA%E7%A1%80%E6%89%8B%E5%86%8CP2%20%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"/>
      <url>/2020/03/28/python_booklet/Python%E5%9F%BA%E7%A1%80%E6%89%8B%E5%86%8CP2%20%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="Python-åŸºæœ¬æ•°æ®ç±»å‹"><a href="#Python-åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="Python åŸºæœ¬æ•°æ®ç±»å‹"></a>Python åŸºæœ¬æ•°æ®ç±»å‹</h1><p>ã€‚ã€‚ã€‚</p><p>ä»Šå¤©æ²¡æœ‰æƒ³è¦å†™åœ¨å¼€å¤´çš„åºŸè¯ï¼Œï¼Œï¼Œå¥½çƒ¦ï¼Œè¦ä¸ç ´ä¾‹ç›´æ¥å¼€å§‹å§ã€‚</p><h2 id="å˜é‡ä¸å¸¸é‡"><a href="#å˜é‡ä¸å¸¸é‡" class="headerlink" title="å˜é‡ä¸å¸¸é‡"></a>å˜é‡ä¸å¸¸é‡</h2><h3 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h3><p>Python æ˜¯ä¸€é—¨<strong>åŠ¨æ€è¯­è¨€</strong>ï¼Œè¿™æ„å‘³ç€ Python å˜é‡æœ¬èº«çš„ç±»å‹æ˜¯ä¸å›ºå®šçš„ã€‚<br>åœ¨ Python ä¸­ä½¿ç”¨å˜é‡å‰<strong>ä¸ç”¨å£°æ˜</strong>ï¼ˆä¸ç”¨å†™ç±»ä¼¼ <code>int a;</code> çš„è¯­å¥ï¼‰ï¼Œ<strong>åœ¨é¦–æ¬¡ä½¿ç”¨å‰ä¸ºå…¶èµ‹åˆå§‹å€¼</strong>å°±è¡Œï¼ˆç›´æ¥ç”¨ <code>a = 0</code>ï¼‰ã€‚</p><h3 id="å¸¸é‡"><a href="#å¸¸é‡" class="headerlink" title="å¸¸é‡"></a>å¸¸é‡</h3><p>å®é™…ä¸Šï¼Œåœ¨ Python è¯­æ³•ä¸­å¹¶<strong>æ²¡æœ‰å®šä¹‰å¸¸é‡</strong>ã€‚</p><p>ä½†æ˜¯ <a href="https://www.python.org/dev/peps/pep-0008/">PEP 8</a> å®šä¹‰äº†å¸¸é‡çš„å‘½åè§„èŒƒä¸º<strong>å¤§å†™å­—æ¯å’Œä¸‹åˆ’çº¿</strong>ç»„æˆã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™ç§â€œå¸¸é‡â€é¦–æ¬¡èµ‹å€¼åï¼Œ<strong>æ— æ³•é˜»æ­¢å…¶ä»–ä»£ç å¯¹å…¶è¿›è¡Œä¿®æ”¹æˆ–åˆ é™¤</strong>ã€‚</p><p>è¦ä½¿ç”¨çœŸæ­£çš„å¸¸é‡ï¼Œå¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ªï¼Œä¾‹å¦‚ï¼š<a href="https://code.activestate.com/recipes/65207-constants-in-python/">constants-in-python</a>ã€‚</p><h2 id="ç©ºå€¼"><a href="#ç©ºå€¼" class="headerlink" title="ç©ºå€¼"></a>ç©ºå€¼</h2><p>Python ä¸­ä½¿ç”¨ <code>None</code> æ¥ä»£è¡¨ç©ºå€¼ã€‚<br><code>None</code> åœ¨äº¤äº’å¼å‘½ä»¤è¡Œä¸­ä¸ä¼šæ˜¾ç¤ºï¼Œä½†å¯ä»¥ç”¨ <code>print()</code> æ‰“å°å‡ºæ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="literal">None</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="literal">None</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(a)</span><br><span class="line"><span class="literal">None</span></span><br></pre></td></tr></table></figure><h2 id="å¸ƒå°”å€¼"><a href="#å¸ƒå°”å€¼" class="headerlink" title="å¸ƒå°”å€¼"></a>å¸ƒå°”å€¼</h2><p>Python ä¸­æœ‰å¸ƒå°”å€¼ <code>True</code> å’Œ <code>False</code>ã€‚</p><h3 id="çœŸå€¼é—®é¢˜"><a href="#çœŸå€¼é—®é¢˜" class="headerlink" title="çœŸå€¼é—®é¢˜"></a>çœŸå€¼é—®é¢˜</h3><p>ä»£è¡¨ â€˜å‡â€™ çš„å€¼æœ‰ï¼š<code>False</code>ï¼Œ<code>None</code>ï¼Œ<code>0</code>ï¼Œ<code>&#39;&#39;</code>ï¼Œ<code>[]</code>ï¼Œ<code>&#123;&#125;</code>ï¼Œâ€¦ï¼›<br>å…¶ä½™å€¼ä¸ºçœŸã€‚</p><h3 id="å¸ƒå°”å€¼çš„ç›¸å…³çš„è¿ç®—"><a href="#å¸ƒå°”å€¼çš„ç›¸å…³çš„è¿ç®—" class="headerlink" title="å¸ƒå°”å€¼çš„ç›¸å…³çš„è¿ç®—"></a>å¸ƒå°”å€¼çš„ç›¸å…³çš„è¿ç®—</h3><table><thead><tr><th>é€»è¾‘è¿ç®—ç¬¦</th><th>ç›¸å½“äºCä¸­çš„</th></tr></thead><tbody><tr><td><code>and</code></td><td><code>&amp;&amp;</code></td></tr><tr><td><code>or</code></td><td>`</td></tr><tr><td><code>not</code></td><td><code>!</code></td></tr></tbody></table><p>âš ï¸ã€æ³¨æ„ <code>and</code> çš„ä¼˜å…ˆçº§é«˜äº <code>or</code>ã€‚</p><table><thead><tr><th>æ¯”è¾ƒè¿ç®—ç¬¦</th></tr></thead><tbody><tr><td><code>&lt;</code>, <code>&gt;</code>, <code>==</code>, <code>!=</code></td></tr></tbody></table><p>ä½¿ç”¨æ¯”è¾ƒè¿ç®—ç¬¦å¾—åˆ°çš„ç»“æœæ˜¯å¸ƒå°”å€¼ï¼ˆ<code>True</code> æˆ– <code>False</code>ï¼‰ã€‚</p><p><strong>ä½¿ç”¨é€»è¾‘è¿ç®—ç¬¦å¾—åˆ°çš„ç»“æœæœªå¿…æ˜¯å¸ƒå°”å€¼</strong>ï¼š</p><p>å…·ä½“çš„è¿ç®—æƒ…å†µå¯ä»¥å‚è€ƒä¸‹é¢è¿™æ®µç¨‹åºç”Ÿæˆçš„è¡¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># **æ³¨æ„ï¼Œæ˜¯ç¬¬ä¸€åˆ—çš„å€¼ and|or ç¬¬ä¸€è¡Œçš„å€¼ï¼**</span></span><br><span class="line">li = [<span class="string">&#x27;and&#x27;</span>, <span class="string">&#x27;or&#x27;</span>]</span><br><span class="line">ls = [<span class="literal">True</span>, <span class="literal">False</span>, <span class="literal">None</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="string">&#x27;&quot;abc&quot;&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> opt <span class="keyword">in</span> li:</span><br><span class="line">    <span class="comment"># head</span></span><br><span class="line">    print(<span class="string">&#x27;&lt;%s&gt;&#x27;</span> % opt, end=<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> ls:</span><br><span class="line">        print(j, end=<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">    print(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> ls:</span><br><span class="line">        <span class="comment"># col</span></span><br><span class="line">        print(i, end=<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> ls:</span><br><span class="line">            <span class="comment"># row</span></span><br><span class="line">            print(</span><br><span class="line">                    <span class="built_in">eval</span>(<span class="string">&#x27;%s %s %s&#x27;</span> % (i, opt, j)),</span><br><span class="line">                    end=<span class="string">&#x27;\t&#x27;</span></span><br><span class="line">                    )</span><br><span class="line">        print(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="comment"># end</span></span><br><span class="line">    print(<span class="string">&#x27;\n-------\n&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ä»ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ<br><code>and</code> çš„è§„åˆ™æ˜¯ï¼š</p><blockquote><p>å‰åä¸¤è€… <strong>çš†ä¸ºçœŸ</strong> ï¼Œè¿”å› <strong>å</strong> è€…ï¼›<br>å‰åä¸¤è€… <strong>æœ‰ä¸€å‡</strong> ï¼Œè¿”å› <strong>å‡</strong> è€…ï¼›<br>å‰åä¸¤è€… <strong>çš†ä¸ºå‡</strong> ï¼Œè¿”å› <strong>å‰</strong> è€…ï¼›</p></blockquote><p><code>or</code> çš„è§„åˆ™æ˜¯ï¼š</p><blockquote><p>å‰åä¸¤è€… <strong>çš†ä¸ºçœŸ</strong> ï¼Œè¿”å› <strong>å‰</strong> è€…ï¼›<br>å‰åä¸¤è€… <strong>æœ‰ä¸€çœŸ</strong> ï¼Œè¿”å› <strong>çœŸ</strong> è€…ï¼›<br>å‰åä¸¤è€… <strong>çš†ä¸ºå‡</strong> ï¼Œè¿”å› <strong>å</strong> è€…ï¼›</p></blockquote><p>æ­¤å¤–ï¼Œ<br><code>not</code> çš„è§„åˆ™æ˜¯ï¼š</p><blockquote><p>è‹¥å¯¹è±¡ä¸º <strong>çœŸ</strong> ï¼Œè¿”å› <code>False</code><br>è‹¥å¯¹è±¡ä¸º <strong>å‡</strong> ï¼Œè¿”å› <code>True</code></p></blockquote><h2 id="æ•°å­—"><a href="#æ•°å­—" class="headerlink" title="æ•°å­—"></a>æ•°å­—</h2><h3 id="int-float"><a href="#int-float" class="headerlink" title="int, float"></a>int, float</h3><p>Python ä¸­å†…ç½®æœ‰ <a href="https://docs.python.org/3/library/functions.html#int">int</a> å’Œ <a href="https://docs.python.org/3/library/functions.html#float">float</a> ä¸¤ç±»æ•°å­—ã€‚</p><table><thead><tr><th>æ•°å­—</th><th>å«ä¹‰</th><th>è¡¨ç¤ºèŒƒå›´</th><th>ç²¾åº¦</th></tr></thead><tbody><tr><td>int</td><td>æ•´æ•°</td><td>å¤§å°æ²¡æœ‰é™åˆ¶</td><td>å§‹ç»ˆæ˜¯å‡†ç¡®çš„</td></tr><tr><td>float</td><td>ï¼ˆåŸºäºäºŒè¿›åˆ¶çš„ï¼‰æµ®ç‚¹æ•°</td><td>æœ‰ä¸€å®šå¤§å°é™åˆ¶ï¼Œè¶…å‡ºåè¡¨ç¤ºä¸ºinf</td><td>å’ŒCä¸€æ ·ï¼Œä¸å‡†ç¡®</td></tr></tbody></table><h3 id="å¤æ•°"><a href="#å¤æ•°" class="headerlink" title="å¤æ•°"></a>å¤æ•°</h3><p>Python è¿˜å†…ç½®äº†å¯¹ <a href="https://zh.wikipedia.org/wiki/%E5%A4%8D%E6%95%B0_(%E6%95%B0%E5%AD%A6)">å¤æ•°</a> çš„æ”¯æŒï¼Œä½¿ç”¨åç¼€ <code>j</code> æˆ– <code>J</code> è¡¨ç¤ºè™šæ•°éƒ¨åˆ†ï¼ˆä¾‹å¦‚ï¼Œ<code>3+5j</code>ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="number">3</span> + <span class="number">1j</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="number">3</span> - <span class="number">1j</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a * b</span><br><span class="line">(<span class="number">10</span>+<span class="number">0j</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br></pre></td></tr></table></figure><p>å…³äºè¿™éƒ¨åˆ†è¯¦è§<a href="https://docs.python.org/3/library/stdtypes.html#typesnumeric">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><h3 id="å…¶ä»–æ•°å­—ç±»å‹"><a href="#å…¶ä»–æ•°å­—ç±»å‹" class="headerlink" title="å…¶ä»–æ•°å­—ç±»å‹"></a>å…¶ä»–æ•°å­—ç±»å‹</h3><p>åœ¨æ ‡å‡†åº“ä¸­ï¼Œpython è¿˜æœ‰å¯¹ <a href="https://docs.python.org/3/library/decimal.html#decimal.Decimal">ç²¾ç¡®å°æ•° Decimalï¼ˆåŸºäºåè¿›åˆ¶çš„æµ®ç‚¹æ•°ï¼‰</a>å’Œ <a href="https://docs.python.org/3/library/fractions.html#fractions.Fraction">åˆ†æ•°  Fraction</a> ç­‰å…¶ä»–æ•°å­—ç±»å‹çš„æ”¯æŒã€‚</p><h4 id="Decimal-ï¼ˆå°æ•°ï¼‰"><a href="#Decimal-ï¼ˆå°æ•°ï¼‰" class="headerlink" title="Decimal ï¼ˆå°æ•°ï¼‰"></a>Decimal ï¼ˆå°æ•°ï¼‰</h4><p>åœ¨ Python çš„æ ‡å‡†åº“ä¸­ï¼Œ<code>decimal</code> åº“æä¾›äº† <em>åŸºäºåè¿›åˆ¶çš„æµ®ç‚¹æ•°</em> <strong>Decimal</strong> ç±»å‹ï¼Œè¿™ç§æ•°å­—ç±»å‹ä¿®å¤äº† float çš„ä¸å‡†ç¡®é—®é¢˜ï¼Œå¯ä»¥ç”¨ <strong>Decimal</strong> å®ç°æ›´åŠ ç²¾å‡†çš„æ•°å­¦è®¡ç®—(ä½†ä¹Ÿä¸æ˜¯ç»å¯¹çš„å‡†ç¡®ï¼Œä»å­˜åœ¨è¯¯å·®)ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> decimal <span class="keyword">import</span> *</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0.1</span> + <span class="number">0.1</span> + <span class="number">0.1</span> - <span class="number">0.3</span>   <span class="comment"># float</span></span><br><span class="line"><span class="number">5.551115123125783e-17</span>       <span class="comment"># è¿™ä¸ªç»“æœæ˜¯ä¸ç²¾ç¡®çš„</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Decimal(<span class="number">0.1</span>) + Decimal(<span class="number">0.1</span>) + Decimal(<span class="number">0.1</span>) - Decimal(<span class="number">0.3</span>)   <span class="comment"># decimal</span></span><br><span class="line">Decimal(<span class="string">&#x27;2.775557561565156540423631668E-17&#x27;</span>)    <span class="comment"># è¾ƒä¸ºç²¾ç¡®</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>getcontext().prec = <span class="number">12</span>    <span class="comment"># é™åˆ¶ Decimal çš„å°æ•°ä½æ•°</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Decimal(<span class="number">0.1</span>) + Decimal(<span class="number">0.1</span>) + Decimal(<span class="number">0.1</span>) - Decimal(<span class="number">0.3</span>)</span><br><span class="line">Decimal(<span class="string">&#x27;1.11022302463E-17&#x27;</span>)</span><br></pre></td></tr></table></figure><p>æ­£å¦‚ä¸Šä¾‹ï¼Œè¦ä½¿ç”¨ <code>Decimal</code> ç±»å‹ï¼Œ</p><ul><li><p>é¦–å…ˆè¦ <code>import decimal</code>ï¼›</p></li><li><p>ç„¶åç”¨ <code>decimal.Decimal(Num)</code>æ¥è·å–ä¸€ä¸ª Decimal å®ä¾‹ï¼Œè¿™é‡Œçš„ Num å¯ä»¥æ˜¯å¦‚ä¸‹å‡ ç§ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Decimal(<span class="string">&#x27;3.14&#x27;</span>)     <span class="comment"># å†…å®¹æ˜¯ float çš„å­—ç¬¦ä¸²</span></span><br><span class="line">Decimal(<span class="string">&#x27;3.14&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Decimal((<span class="number">0</span>, (<span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>), -<span class="number">2</span>))  <span class="comment"># tuple (sign, digit_tuple, exponent)ï¼Œå¾—åˆ°çš„å€¼æ˜¯ (-1) * sign * digit_tuple ä»£è¡¨æ•°å­— * 10 ^ exponent</span></span><br><span class="line">Decimal(<span class="string">&#x27;3.14&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Decimal(<span class="number">314</span>)        <span class="comment"># intï¼Œfloat éƒ½å¯ä»¥</span></span><br><span class="line">Decimal(<span class="string">&#x27;314&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Decimal(Decimal(<span class="number">314</span>))  <span class="comment"># å¦ä¸€ä¸ª decimal å®ä¾‹</span></span><br><span class="line">Decimal(<span class="string">&#x27;314&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Decimal(<span class="string">&#x27;  3.14  \\n&#x27;</span>)    <span class="comment"># å‰åå¯ä»¥æœ‰ç©ºç™½å­—ç¬¦</span></span><br><span class="line">Decimal(<span class="string">&#x27;3.14&#x27;</span>)</span><br></pre></td></tr></table></figure></li><li><p>decimal.getcontext().prec ä»£è¡¨æœ‰æ•ˆä½æ•°ï¼Œ</p><ul><li>é€šè¿‡ <code>print(decimal.getcontext().prec)</code> æ¥æŸ¥çœ‹å½“å‰å€¼ï¼Œé»˜è®¤æ˜¯28ä½</li><li>é€šè¿‡ <code>decimal.getcontext().prec = Places</code> æ¥è®¾ç½®æœ‰æ•ˆä½æ•°ï¼Œè¿™ä¸ªç²¾åº¦çš„å–å€¼æ˜¯ <code>[1, MAX_PREC]</code> ï¼ŒMAX_PRECå–å€¼åœ¨64ä½æœºå™¨ä¸Šæ˜¯ <code>999999999999999999</code>ï¼Œ32ä½ä¸º <code>425000000</code>ï¼ˆè¿™æ˜¯å› ä¸ºè¿™ä¸ªå€¼è¦å¯ä»¥è½¬åŒ–ä¸ºCçš„æ•´å‹ï¼Œè¯¦è§<a href="https://github.com/python/cpython/blob/3.7/Lib/_pydecimal.py">Pythonç‰ˆçš„æºç </a>ï¼‰ï¼</li></ul></li><li><p>åŠ å‡ä¹˜é™¤è¿ç®—å…¥å¸¸</p></li></ul><h4 id="Fraction-ï¼ˆåˆ†æ•°ï¼‰"><a href="#Fraction-ï¼ˆåˆ†æ•°ï¼‰" class="headerlink" title="Fraction ï¼ˆåˆ†æ•°ï¼‰"></a>Fraction ï¼ˆåˆ†æ•°ï¼‰</h4><p>åœ¨ <code>fractions</code> åº“ä¸­ï¼Œå®šä¹‰äº† <code>Fraction</code> ç±»å‹ï¼Œç”¨ä»¥è¡¨è¾¾åˆ†æ•°ï¼ŒåŠ å‡ä¹˜é™¤è¿ç®—å…¥å¸¸ã€‚</p><p>ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> fractions <span class="keyword">import</span> *</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Fraction(<span class="number">1.5</span>)    <span class="comment"># ä¼ å…¥ floatï¼Œä¼šè‡ªåŠ¨ç®—å‡ºåˆ†æ•°è¡¨ç¤º</span></span><br><span class="line">Fraction(<span class="number">3</span>, <span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Fraction(<span class="number">1</span>, <span class="number">3</span>)   <span class="comment"># ä¼ å…¥ åˆ†å­ï¼Œåˆ†æ¯</span></span><br><span class="line">Fraction(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Fraction(<span class="number">2</span>, <span class="number">6</span>)   <span class="comment"># é»˜è®¤ä¼šæœ‰ç†åŒ–</span></span><br><span class="line">Fraction(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Fraction(<span class="number">2</span>, <span class="number">6</span>, _normalize=<span class="literal">False</span>)    <span class="comment"># æŒ‡å®šä¸æœ‰ç†åŒ–</span></span><br><span class="line">Fraction(<span class="number">2</span>, <span class="number">6</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Fraction(Fraction(<span class="number">1</span>/<span class="number">11</span>))    <span class="comment"># å¦ä¸€ä¸ª Fraction å®ä¾‹ï¼ŒDecimal å®ä¾‹ä¹Ÿå¯ä»¥</span></span><br><span class="line">Fraction(<span class="number">3275345183542179</span>, <span class="number">36028797018963968</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Fraction(<span class="string">&#x27; 22/7 &#x27;</span>)    <span class="comment"># ä½¿ç”¨ä»£è¡¨åˆ†æ•°çš„å­—ç¬¦ä¸²ï¼Œæ³¨æ„ numerator/denominatorï¼Œä¸­é—´ä¸å¯æœ‰ç©ºæ ¼ï¼Œå‰åå¯æœ‰ç©ºç™½å­—ç¬¦</span></span><br><span class="line">Fraction(<span class="number">22</span>, <span class="number">7</span>)</span><br></pre></td></tr></table></figure><h2 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h2><h3 id="å­—ç¬¦ä¸²çš„è¡¨ç¤º"><a href="#å­—ç¬¦ä¸²çš„è¡¨ç¤º" class="headerlink" title="å­—ç¬¦ä¸²çš„è¡¨ç¤º"></a>å­—ç¬¦ä¸²çš„è¡¨ç¤º</h3><p>Python ä¸­ï¼Œå­—ç¬¦ä¸²å¯ä»¥ç”¨å•å¼•å· (<code>&#39;...&#39;</code>) æˆ–åŒå¼•å· (<code>&quot;...&quot;</code>) æ ‡è¯†å•è¡Œå†…çš„å­—ç¬¦ä¸²ï¼Œ<br>è¿˜å¯ä»¥ä½¿ç”¨è¿ç»­ä¸‰ä¸ªå•/åŒå¼•å·(<code>&#39;&#39;&#39;...&#39;&#39;&#39;</code> æˆ– <code>&quot;&quot;&quot;...&quot;&quot;&quot;</code>)è¡¨ç¤ºä¸æ ¼å¼åŒ–çš„å¤šè¡Œå­—ç¬¦ã€‚</p><p>Pythonæ²¡æœ‰å•ç‹¬çš„å­—ç¬¦ç±»å‹ï¼›ä¸€ä¸ªå­—ç¬¦å°±æ˜¯ä¸€ä¸ªç®€å•çš„é•¿åº¦ä¸º1çš„å­—ç¬¦ä¸²ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>st = <span class="string">&#x27;1\</span></span><br><span class="line"><span class="string">... 2\</span></span><br><span class="line"><span class="string">... 3\</span></span><br><span class="line"><span class="string">... a&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>st</span><br><span class="line"><span class="string">&#x27;123a&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>st = <span class="string">&#x27;&#x27;&#x27;1</span></span><br><span class="line"><span class="string"><span class="meta">... </span>2</span></span><br><span class="line"><span class="string"><span class="meta">... </span>3</span></span><br><span class="line"><span class="string"><span class="meta">... </span>a</span></span><br><span class="line"><span class="string"><span class="meta">... </span>&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>st</span><br><span class="line"><span class="string">&#x27;1\n2\n3\na\n&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br></pre></td></tr></table></figure><p>âš ï¸ã€æ³¨æ„ã€‘å•å¼•å·å¯ä»¥åŒ…å«åŒå¼•å·ï¼Œ<code>&#39;asd&quot;123&quot;fgh&#39;</code> æ˜¯å…è®¸çš„ï¼ŒåŒæ · <code>&#39;&#39;&#39;</code> ä¸­ä¹Ÿå¯ä»¥åŒ…å« <code>&quot;&quot;&quot;</code>ã€‚</p><h3 id="å­—ç¬¦ç¼–ç "><a href="#å­—ç¬¦ç¼–ç " class="headerlink" title="å­—ç¬¦ç¼–ç "></a>å­—ç¬¦ç¼–ç </h3><p>é¦–å…ˆï¼Œé™„ä¸Šå‡ ç§å­—ç¬¦ç¼–ç çš„æ¯”è¾ƒï¼š<br>| ç¼–ç  | é•¿åº¦ | â€˜Aâ€™ | â€˜ä¸­â€™ |<br>| â€“ | â€“ | â€“ | â€“ |<br>| ASCII | 1 Byte | <strong>01000001</strong> | (æ— æ­¤å­—ç¬¦) |<br>| Unicode | é€šå¸¸æ˜¯2 Byte | <em>00000000</em> <strong>01000001</strong> (ASCIIå‰è¡¥é›¶) | 01001110 00101101 |<br>| UTF-8 | å¯å˜ï¼ˆ1~6 Byteï¼‰| <strong>01000001</strong> ï¼ˆUTF-8åŒ…å«ç€ASCIIï¼‰| 11100100 10111000 10101101 |</p><p>Python3.x é»˜è®¤ç”¨ Unicode ç¼–ç å­—ç¬¦ä¸²ã€‚</p><p>ç¼–ç  &lt;=&gt; å­—ç¬¦ çš„å‡½æ•°ï¼š</p><ul><li><code>ord()</code>ï¼šè·å–å­—ç¬¦çš„æ•´æ•°è¡¨ç¤ºï¼›</li><li><code>chr()</code>ï¼šæŠŠç¼–ç è½¬æ¢æˆå¯¹åº”çš„å­—ç¬¦ï¼›</li></ul><p>ä¾‹å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line"><span class="number">65</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">ord</span>(<span class="string">&#x27;ä¸­&#x27;</span>)</span><br><span class="line"><span class="number">20013</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">chr</span>(<span class="number">66</span>)</span><br><span class="line"><span class="string">&#x27;B&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">chr</span>(<span class="number">20014</span>)</span><br><span class="line"><span class="string">&#x27;ä¸®&#x27;</span></span><br></pre></td></tr></table></figure><hr><p>Python çš„å­—ç¬¦ä¸²ç±»å‹æ˜¯ <code>str</code>ã€‚</p><blockquote><p><code>str</code> åœ¨å†…å­˜ä¸­ä»¥ Unicode è¡¨ç¤ºï¼Œä¸€ä¸ªå­—ç¬¦å¯¹åº”è‹¥å¹²å­—èŠ‚ã€‚</p></blockquote><p>åœ¨å†™å…¥äºŒçº§ç¼“å­˜ï¼ˆæœ¬åœ°-&gt;ç¡¬ç›˜ | è¿œç¨‹-&gt;ç½‘ç»œï¼‰æ—¶ï¼Œ<code>str</code>å°†å˜ä¸º<code>bytes</code>ã€‚</p><blockquote><p><code>bytes</code> ä»¥å­—èŠ‚ä¸ºå•ä½ã€‚</p></blockquote><p>Python ç”¨å¸¦ <code>b</code> å‰ç¼€çš„å•/åŒå¼•å·è¡¨ç¤º <code>bytes</code>ã€‚</p><table><thead><tr><th>str</th><th>bytes</th></tr></thead><tbody><tr><td><code>&#39;ABC&#39;</code></td><td><code>b&#39;ABC&#39;</code></td></tr></tbody></table><hr><p>str &lt;=&gt; bytes:</p><ul><li>encode(): str â€“&gt; bytes</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;abc&#x27;</span>.encode(<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line"><span class="string">b&#x27;abc&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;ä¸­æ–‡&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="string">b&#x27;\xe4\xb8\xad\xe6\x96\x87&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;ä¸­æ–‡&#x27;</span>.encode(<span class="string">&#x27;ascii&#x27;</span>)    <span class="comment"># è¶…å‡ºèŒƒå›´äº†ï¼ŒæŠ¥é”™</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Traceback (most recent call last):</span></span><br><span class="line"><span class="string">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span></span><br><span class="line"><span class="string">UnicodeEncodeError: &#x27;ascii&#x27; codec can&#x27;t encode characters in position 0-1: ordinal not in range(128)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>decode(): bytes â€“&gt; str</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">b&#x27;abc&#x27;</span>.decode(<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;abc&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">b&#x27;\xe4\xb8\xad\xe6\x96\x87&#x27;</span>.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;ä¸­æ–‡&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">b&#x27;\xe4\xb8\xad\xe6\x96\x87&#x27;</span>.decode(<span class="string">&#x27;ascii&#x27;</span>)    <span class="comment"># è¶…å‡ºèŒƒå›´äº†ï¼ŒæŠ¥é”™</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Traceback (most recent call last):</span></span><br><span class="line"><span class="string">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span></span><br><span class="line"><span class="string">UnicodeDecodeError: &#x27;ascii&#x27; codec can&#x27;t decode byte 0xe4 in position 0: ordinal not in range(128)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># è‹¥ bytes ä¸­åŒ…å«æ— æ³•è§£ç çš„å­—èŠ‚ï¼Œdecode() ä¼šæŠ¥é”™ï¼›</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># å¯ä»¥åœ¨è°ƒç”¨ decode() æ—¶ä¼ å…¥ `errors=&#x27;ignore&#x27;` ï¼Œä»¥å¿½ç•¥é”™è¯¯å­—èŠ‚ã€‚</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">b&#x27;\xe4\xb8\xad\xe6\x96\x87asd&#x27;</span>.decode(<span class="string">&#x27;ascii&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;asd&#x27;</span></span><br></pre></td></tr></table></figure><p>âš ï¸ã€æ³¨æ„ã€‘ä¸ºé¿å…ä¹±ç é—®é¢˜ï¼Œ<strong>åº”å§‹ç»ˆä½¿ç”¨ <code>utf-8</code> ç¼–ç å¯¹ <code>str</code> å’Œ <code>bytes</code> è¿›è¡Œè½¬æ¢ã€‚</strong></p><h3 id="è½¬ä¹‰å­—ç¬¦"><a href="#è½¬ä¹‰å­—ç¬¦" class="headerlink" title="è½¬ä¹‰å­—ç¬¦"></a>è½¬ä¹‰å­—ç¬¦</h3><p>Python å­—ç¬¦ä¸²ä¸­å¯ä»¥ä½¿ç”¨è½¬ä¹‰å­—ç¬¦ï¼Œå¯ä»¥å‚è€ƒä¸‹è¡¨ï¼š</p><table><thead><tr><th>è½¬ä¹‰å­—ç¬¦</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>\</code>(åœ¨è¡Œå°¾æ—¶)</td><td>ç»­è¡Œç¬¦</td></tr><tr><td><code>\\</code></td><td>åæ–œæ ç¬¦å·</td></tr><tr><td><code>\&#39;</code></td><td>å•å¼•å·</td></tr><tr><td><code>\&quot;</code></td><td>åŒå¼•å·</td></tr><tr><td><code>\a</code></td><td>å“é“ƒ</td></tr><tr><td><code>\b</code></td><td>é€€æ ¼(Backspace)</td></tr><tr><td><code>\e</code></td><td>è½¬ä¹‰</td></tr><tr><td><code>\000</code></td><td>ç©º</td></tr><tr><td><code>\n</code></td><td>æ¢è¡Œ</td></tr><tr><td><code>\v</code></td><td>çºµå‘åˆ¶è¡¨ç¬¦</td></tr><tr><td><code>\t</code></td><td>æ¨ªå‘åˆ¶è¡¨ç¬¦</td></tr><tr><td><code>\r</code></td><td>å›è½¦</td></tr><tr><td><code>\f</code></td><td>æ¢é¡µ</td></tr><tr><td><code>\xxx</code></td><td>å…«è¿›åˆ¶æ•°ï¼Œä¾‹å¦‚ï¼š<code>&#39;\100&#39;</code> ä»£è¡¨ <code>&#39;@&#39;</code></td></tr><tr><td><code>\oyy</code></td><td>å…«è¿›åˆ¶æ•°ï¼Œyyä»£è¡¨çš„å­—ç¬¦ï¼Œä¾‹å¦‚ï¼š<code>&#39;\o12&#39;</code> ä»£è¡¨æ¢è¡Œ</td></tr><tr><td><code>\xyy</code></td><td>åå…­è¿›åˆ¶æ•°ï¼Œyyä»£è¡¨çš„å­—ç¬¦ï¼Œä¾‹å¦‚ï¼š<code>&#39;\x0a&#39;</code> ä»£è¡¨æ¢è¡Œ</td></tr><tr><td><code>\uxxxx</code></td><td>åå…­è¿›åˆ¶æ•°ï¼Œxxxxä»£è¡¨çš„å­—ç¬¦ï¼Œä¾‹å¦‚ï¼š<code>&#39;\u4e2d\u6587&#39;</code> ä»£è¡¨ <code>&#39;ä¸­æ–‡&#39;</code></td></tr><tr><td><code>\other</code></td><td>å…¶å®ƒçš„å­—ç¬¦ä»¥æ™®é€šæ ¼å¼è¾“å‡ºï¼Œä¾‹å¦‚ï¼š<code>&#39;\sds&#39;</code> ä»£è¡¨ <code>&#39;\\sds&#39;</code></td></tr></tbody></table><p>è‹¥è¦å–æ¶ˆè½¬ä¹‰ï¼Œå¯ä»¥ç»™å­—ç¬¦ä¸² <code>r</code> å‰ç¼€ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(<span class="string">&#x27;C:\some\name&#x27;</span>)  <span class="comment"># here \n means newline!</span></span><br><span class="line">C:\some</span><br><span class="line">ame</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(<span class="string">r&#x27;C:\some\name&#x27;</span>)  <span class="comment"># note the r before the quote</span></span><br><span class="line">C:\some\name</span><br></pre></td></tr></table></figure><h3 id="åŸºæœ¬å­—ç¬¦ä¸²æ“ä½œ"><a href="#åŸºæœ¬å­—ç¬¦ä¸²æ“ä½œ" class="headerlink" title="åŸºæœ¬å­—ç¬¦ä¸²æ“ä½œ"></a>åŸºæœ¬å­—ç¬¦ä¸²æ“ä½œ</h3><h4 id="è·å–å­—ç¬¦ä¸²é•¿åº¦"><a href="#è·å–å­—ç¬¦ä¸²é•¿åº¦" class="headerlink" title="è·å–å­—ç¬¦ä¸²é•¿åº¦"></a>è·å–å­—ç¬¦ä¸²é•¿åº¦</h4><p>Python å†…ç½®çš„ <code>len()</code> å‡½æ•°å¯ä»¥è·å–å¤šç§ç±»å‹çš„å¯¹è±¡é•¿åº¦ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(word)</span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># è¿™ä¸ªæ–¹æ³•ç­‰æ•ˆäºï¼š</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>word.__len__()</span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></table></figure><h4 id="å­—ç¬¦ä¸²è¿æ¥"><a href="#å­—ç¬¦ä¸²è¿æ¥" class="headerlink" title="å­—ç¬¦ä¸²è¿æ¥"></a>å­—ç¬¦ä¸²è¿æ¥</h4><ul><li>ç›¸é‚»çš„ä¸¤ä¸ªå­—ç¬¦ä¸²æ–‡æœ¬è‡ªåŠ¨è¿æ¥åœ¨ä¸€èµ·ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;Py&#x27;</span> <span class="string">&#x27;thon&#x27;</span></span><br><span class="line"><span class="string">&#x27;Python&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># è¿™ä¸ªåŠŸèƒ½å¯ä»¥ç”¨æ¥å†™é•¿å­—ç¬¦ä¸²ï¼š</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>text = (<span class="string">&#x27;Put several strings within parentheses &#x27;</span></span><br><span class="line">            <span class="string">&#x27;to have them joined together.&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>text</span><br><span class="line"><span class="string">&#x27;Put several strings within parentheses to have them joined together.&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>å­—ç¬¦ä¸²çš„ <code>+</code> ä¸ <code>*</code></li></ul><p>å­—ç¬¦ä¸²å¯ä»¥ç”± + æ“ä½œç¬¦è¿æ¥(ç²˜åˆ°ä¸€èµ·)ï¼Œå¯ä»¥ç”± * è¡¨ç¤ºé‡å¤ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># 3 times &#x27;un&#x27;, followed by &#x27;ium&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">3</span> * <span class="string">&#x27;un&#x27;</span> + <span class="string">&#x27;ium&#x27;</span></span><br><span class="line"><span class="string">&#x27;unununium&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="å­—ç¬¦ä¸²æ’å€¼"><a href="#å­—ç¬¦ä¸²æ’å€¼" class="headerlink" title="å­—ç¬¦ä¸²æ’å€¼"></a>å­—ç¬¦ä¸²æ’å€¼</h4><p>å­—ç¬¦ä¸²çš„æ’å€¼ä¸»è¦æœ‰ 4 ç§æ–¹å¼ï¼š</p><ol><li>å­—ç¬¦ä¸²è¿æ¥</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="number">123</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&quot;a is &quot;</span> + <span class="built_in">str</span>(a) + <span class="string">&quot;:)&quot;</span> </span><br><span class="line"><span class="string">&#x27;a is 123:)&#x27;</span></span><br></pre></td></tr></table></figure><ol start="2"><li><code>%</code> å…ƒç»„æ’å€¼</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="number">123</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="number">66.77</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c = <span class="string">&#x27;hello&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;a = %s, b = %s, c = %s&#x27;</span> % (a, b, c)</span><br><span class="line"><span class="string">&#x27;a = 123, b = 66.77, c = hello&#x27;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>å­—ç¬¦ä¸²çš„ <code>format</code> æ–¹æ³•</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;a = &#123;arg_a&#125;, b = &#123;arg_b&#125;, c = &#123;arg_c&#125;&#x27;</span>.<span class="built_in">format</span>(arg_a=<span class="string">&quot;ä¸œæ–¹&quot;</span>, arg_b=<span class="number">123</span>, arg_c=<span class="number">333.44</span>+<span class="number">8j</span>)</span><br><span class="line"><span class="string">&#x27;a = ä¸œæ–¹, b = 123, c = (333.44+8j)&#x27;</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…ä¹Ÿå¯ä»¥åŒ¿åï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;Another way: &#123;0&#125;, &#123;2&#125;, &#123;1&#125;, &#123;3&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="string">&quot;zero&quot;</span>, <span class="number">2</span>, <span class="number">1.0</span>, <span class="number">3</span>)</span><br><span class="line"><span class="string">&#x27;Another way: zero, 1.0, 2, 3&#x27;</span></span><br></pre></td></tr></table></figure><ol start="4"><li><code>f-string</code></li></ol><p>Python 3.6 å¼•å…¥äº† <code>f-string</code>ï¼Œè®©æ’å€¼æ›´åŠ ä¼˜é›…ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="number">123</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="number">456.789</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">f&#x27;<span class="subst">&#123;a&#125;</span> + <span class="subst">&#123;b&#125;</span> = <span class="subst">&#123;a+b&#125;</span>&#x27;</span></span><br><span class="line"><span class="string">&#x27;123 + 456.789 = 579.789&#x27;</span></span><br></pre></td></tr></table></figure><p>æ›´å¤šå…³äº <code>f-string</code> çš„è¯´æ˜ï¼Œå¯ä»¥å‚è€ƒ <a href="https://realpython.com/python-f-strings/">realpythonçš„è¿™ç¯‡æ–‡ç« </a>ï¼Œæˆ–è€…æŸ¥çœ‹ <code>f-string</code> çš„æ¥æºï¼š<a href="https://www.python.org/dev/peps/pep-0498/">PEP 498 â€“ Literal String Interpolation</a>ã€‚</p><h4 id="å­—ç¬¦ä¸²åˆ‡åˆ†"><a href="#å­—ç¬¦ä¸²åˆ‡åˆ†" class="headerlink" title="å­—ç¬¦ä¸²åˆ‡åˆ†"></a>å­—ç¬¦ä¸²åˆ‡åˆ†</h4><p>ç”¨å­—ç¬¦ä¸²çš„ split æ–¹æ³•å¯ä»¥ä»¥æŒ‡å®šå­—ç¬¦ä¸²ä¸ºåˆ†å‰²åˆ‡åˆ†å­—ç¬¦ä¸²ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;a b   c&#x27;</span>.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;he-*-ll-*-o--&#x27;</span>.split(<span class="string">&#x27;-*-&#x27;</span>)</span><br><span class="line">[<span class="string">&#x27;he&#x27;</span>, <span class="string">&#x27;ll&#x27;</span>, <span class="string">&#x27;o--&#x27;</span>]</span><br></pre></td></tr></table></figure><h4 id="å­—ç¬¦ä¸²æ›¿æ¢"><a href="#å­—ç¬¦ä¸²æ›¿æ¢" class="headerlink" title="å­—ç¬¦ä¸²æ›¿æ¢"></a>å­—ç¬¦ä¸²æ›¿æ¢</h4><p>ç”¨å­—ç¬¦ä¸²çš„ replace æ–¹æ³•å¯ä»¥æ›¿æ¢å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;he-*-ll-*-o--&#x27;</span>.replace(<span class="string">&#x27;-*-&#x27;</span>, <span class="string">&#x27;...&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;he...ll...o--&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="å­—ç¬¦ä¸²ç´¢å¼•åŠåˆ‡ç‰‡"><a href="#å­—ç¬¦ä¸²ç´¢å¼•åŠåˆ‡ç‰‡" class="headerlink" title="å­—ç¬¦ä¸²ç´¢å¼•åŠåˆ‡ç‰‡"></a>å­—ç¬¦ä¸²ç´¢å¼•åŠåˆ‡ç‰‡</h4><ul><li><strong>ç´¢å¼•</strong></li></ul><table><thead><tr><th>å­—ç¬¦</th><th>P</th><th>y</th><th>t</th><th>h</th><th>o</th><th>n</th></tr></thead><tbody><tr><td>æ­£å‘ç´¢å¼•</td><td>0ï¼ˆ-0ï¼‰</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td></tr><tr><td>åå‘ç´¢å¼•</td><td>-6</td><td>-5</td><td>-4</td><td>-3</td><td>-2</td><td>-1</td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>word = <span class="string">&#x27;Python&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>word[<span class="number">0</span>]  <span class="comment"># character in position 0</span></span><br><span class="line"><span class="string">&#x27;P&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>word[-<span class="number">2</span>]  <span class="comment"># second-last character</span></span><br><span class="line"><span class="string">&#x27;o&#x27;</span></span><br></pre></td></tr></table></figure><ul><li><strong>åˆ‡ç‰‡</strong></li></ul><p>ç´¢å¼•ç”¨äºè·å¾—å•ä¸ªå­—ç¬¦ï¼Œåˆ‡ç‰‡ è®©ä½ è·å¾—ä¸€ä¸ªå­å­—ç¬¦ä¸²ã€‚</p><p>åˆ‡ç‰‡çš„è§„åˆ™æ˜¯ï¼š<code>str[èµ·å§‹:æœ«å°¾:é—´éš”]</code><br>    * èµ·å§‹ï¼šå¼€å§‹çš„ç´¢å¼•ï¼ˆå–ï¼‰ï¼Œç¼ºçœä¸º0<br>    * æœ«å°¾ï¼šç»“æŸçš„ç´¢å¼•(ä¸å–)ï¼Œç¼ºçœæ—¶ï¼Œå–åˆ°å­—ç¬¦ä¸²æœ€åä¸€ä¸ªå­—ç¬¦ï¼ˆå–å¾—åˆ°ï¼‰<br>    * é—´éš”ï¼šæ¯å–ä¸€ä¸ªä¹‹åé—´éš”å‡ ä¸ªï¼ˆ&gt;0ï¼‰ï¼Œç¼ºçœä¸º1ï¼Œä¸ºè´Ÿå€¼æ—¶å€’ç€å–</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>word[<span class="number">0</span>:<span class="number">2</span>]  <span class="comment"># characters from position 0 (included) to 2 (excluded)</span></span><br><span class="line"><span class="string">&#x27;Py&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># å‡ ä¸ªå¸¸ç”¨æ¨¡å¼ï¼š</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>word[<span class="number">1</span>:-<span class="number">1</span>]    <span class="comment"># å»æ‰é¦–ä½å­—ç¬¦ï¼ˆå¯ä»¥ç”¨æ¥å»æ‹¬å·ã€å¼•å·ï¼‰</span></span><br><span class="line"><span class="string">&#x27;ytho&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>word[::-<span class="number">1</span>]    <span class="comment"># å­—ç¬¦ä¸²åå‘</span></span><br><span class="line"><span class="string">&#x27;nohtyP&#x27;</span></span><br></pre></td></tr></table></figure><p>âš ï¸ã€æ³¨æ„ã€‘åˆ‡ç‰‡åŒ…å«èµ·å§‹çš„å­—ç¬¦ï¼Œä¸åŒ…å«æœ«å°¾çš„å­—ç¬¦ã€‚<br><code>s[:i] + s[i:] == s</code><br>âš ï¸ã€æ³¨æ„ã€‘å­—ç¬¦ä¸²<strong>ç´¢å¼•ã€åˆ‡ç‰‡</strong>éƒ½æ˜¯<strong>åªè¯»</strong>çš„ï¼Œä¸å¯ä»¥ç»™å­—ç¬¦ä¸²ç´¢å¼•ã€åˆ‡ç‰‡èµ‹å€¼ï¼</p><h3 id="æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a>æ­£åˆ™è¡¨è¾¾å¼</h3><p>å­—ç¬¦ä¸²çš„ä½¿ç”¨è‚¯å®šç»•ä¸è¿‡æ­£åˆ™è¡¨è¾¾å¼ï¼Œpython å†…ç½®äº†æ­£åˆ™è¡¨è¾¾å¼æ¨¡å—â€”â€” <code>re</code> ã€‚</p><p>æˆ‘ä¸åœ¨è¿™é‡Œä»‹ç»æ­£åˆ™è¡¨è¾¾å¼çš„å†™æ³•ï¼Œåªæ˜¯å±•ç¤ºæ€ä¹ˆç”¨ Python å®Œæˆå¸¸è§çš„æ­£åˆ™è¡¨è¾¾å¼æ“ä½œã€‚æ­£åˆ™æœ¬èº«æœ‰é—®é¢˜ï¼Œè¯·åˆ° <a href="https://regexr.com./">https://regexr.comã€‚</a></p><p><strong>åŒ¹é…</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">pattern = <span class="string">r&#x27;abc(.*?)def&#x27;</span><span class="comment"># æ­£åˆ™é‡Œæœ‰å¤§é‡&#x27;\&#x27;,ç”¨rå­—ç¬¦ä¸²å–æ¶ˆè½¬ä¹‰</span></span><br><span class="line">test = <span class="string">&#x27;abc123def&#x27;</span></span><br><span class="line"><span class="keyword">if</span> re.match(pattern, test):</span><br><span class="line">    print(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">&#x27;failed&#x27;</span>)</span><br></pre></td></tr></table></figure><p><strong>æå–</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">pattern = <span class="string">r&#x27;abc(.*?)def(\d+)&#x27;</span></span><br><span class="line">test = <span class="string">&#x27;abc123def456&#x27;</span></span><br><span class="line">m = re.match(pattern, test)</span><br><span class="line"><span class="keyword">if</span> m:</span><br><span class="line">    print(m.groups())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">&#x27;failed&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ç”¨ m.groups() å³å¯è·å–æå–åˆ°çš„ç»„ï¼š<code>(&#39;123&#39;, &#39;456&#39;)</code>ã€‚</p><p><strong>åˆ‡åˆ†</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ‡åˆ†</span></span><br><span class="line">re.split(<span class="string">r&#x27;[\s\,\;]+&#x27;</span>, <span class="string">&#x27;a,b;; c  d&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="é›†åˆç±»å‹"><a href="#é›†åˆç±»å‹" class="headerlink" title="é›†åˆç±»å‹"></a>é›†åˆç±»å‹</h2><p>å…¶å®ï¼Œåœ¨æˆ‘å¿ƒä¸­ï¼Œå­—ç¬¦ä¸²ä¹Ÿæ˜¯ç§é›†åˆç±»å‹ï¼ˆä½ å­¦è¿‡Cè¯­è¨€å°±ä¼šæœ‰åŒæ„Ÿäº†ï¼Œå­—ç¬¦ä¸²ä¸è¿‡æ˜¯å­—ç¬¦ç»„æˆçš„ list è€Œå·²ï¼‰ã€‚æ‰€ä»¥ï¼Œåˆšæ‰ä»‹ç»å­—ç¬¦ä¸²çš„å¾ˆå¤šæ“ä½œï¼Œåœ¨æ¥ä¸‹æ¥çš„ list ä¸­ä¹Ÿä¸€æ ·é€‚ç”¨ã€‚</p><h3 id="list"><a href="#list" class="headerlink" title="list"></a>list</h3><p>listï¼šåˆ—è¡¨ï¼Œå†™åœ¨ <code>[]</code> ä¸­ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>l0 = []</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l2 = <span class="built_in">list</span>(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(<span class="string">f&#x27;<span class="subst">&#123;l0&#125;</span>\n<span class="subst">&#123;l1&#125;</span>\n<span class="subst">&#123;l2&#125;</span>&#x27;</span>)</span><br><span class="line">[]</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">[<span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;o&#x27;</span>]</span><br></pre></td></tr></table></figure><p><strong>ç´¢å¼•&amp;åˆ‡ç‰‡</strong>ï¼š</p><ul><li>getï¼š<code>lst[ç´¢å¼• || åˆ‡ç‰‡]</code></li><li>setï¼š<code>lst[ç´¢å¼• || åˆ‡ç‰‡] = å€¼</code></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; l[0] &#x3D; 3.14</span><br><span class="line">&gt;&gt;&gt; l[0]</span><br><span class="line">3.14</span><br></pre></td></tr></table></figure><p>ç´¢å¼•&amp;åˆ‡ç‰‡ å’Œå­—ç¬¦ä¸²ä¸­ä»‹ç»çš„ç›¸åŒï¼Œä¸äº†è§£å¯ä»¥è¿™å›å»çœ‹ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ list çš„åŸºæœ¬æ“ä½œï¼š</p><p><strong>å°¾éƒ¨æ·»åŠ </strong>ï¼š<code>lst.append(å€¼)</code>, <code>lst.extend(iterable)</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>l = []</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l.append(<span class="number">12</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l.append(<span class="string">&quot;abc&quot;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l.append(<span class="number">999</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l.append([<span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l.extend([<span class="string">&#x27;ä½ &#x27;</span>, <span class="string">&#x27;å¥½&#x27;</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l.extend(&#123;<span class="string">&#x27;å†&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;è§&#x27;</span>: <span class="number">2</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l</span><br><span class="line">[<span class="number">12</span>, <span class="string">&#x27;abc&#x27;</span>, <span class="number">999</span>, [<span class="number">3</span>, <span class="number">4</span>], <span class="string">&#x27;ä½ &#x27;</span>, <span class="string">&#x27;å¥½&#x27;</span>, <span class="string">&#x27;å†&#x27;</span>, <span class="string">&#x27;è§&#x27;</span>]</span><br></pre></td></tr></table></figure><p>append å’Œ extend ä¸€ä¸ªæ˜¯æ·»åŠ å•ä¸ªå…ƒç´ ï¼Œä¸€ä¸ªæ˜¯æ·»åŠ ä¸€ç³»åˆ—å…ƒç´ ã€‚</p><p>åˆ©ç”¨åˆ‡ç‰‡ï¼Œappend æ–¹æ³•å°±ç­‰æ•ˆäº <code>lst[len(lst):] = [å€¼]</code>, è€Œ extend å³ <code>lst[len(lst):] = iterable</code>ã€‚</p><p><strong>æ’å…¥</strong>ï¼š<code>lst.insert(ç´¢å¼•, å€¼)</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>l = []</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l.insert(<span class="number">0</span>, <span class="number">100</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l.insert(<span class="built_in">len</span>(l), <span class="number">200</span>)       <span class="comment"># ç­‰æ•ˆäº l.append(200)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l.insert(<span class="number">1</span>, <span class="number">300</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l.insert(<span class="number">1</span>, <span class="number">400</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l</span><br><span class="line">[<span class="number">100</span>, <span class="number">400</span>, <span class="number">300</span>, <span class="number">200</span>]</span><br></pre></td></tr></table></figure><p><strong>åˆ </strong>ï¼š<code>lst.remove(å€¼)</code>, <code>lst.pop(ç´¢å¼•)</code>, <code>clear()</code></p><p>remove æ˜¯åˆ é™¤ list ä¸­å­˜åœ¨çš„ä¸€ä¸ªå€¼ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œä¼šæŠ¥ ValueErrorã€‚</p><p>pop æ˜¯åˆ é™¤ list ä¸­ç»™å®šç´¢å¼•å¤„çš„å€¼ï¼Œè‹¥ç´¢å¼•è¶Šç•Œï¼Œä¼šæŠ¥ IndexErrorã€‚</p><p>clear å°±æ˜¯æ¸…ç©ºï¼ˆåˆ é™¤ï¼‰æ‰€æœ‰å…ƒç´ ï¼›ä¹Ÿå¯ä»¥ç”¨ <code>del a[:]</code> å®Œæˆç±»ä¼¼çš„æ“ä½œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>l</span><br><span class="line">[<span class="number">100</span>, <span class="number">400</span>, <span class="number">300</span>, <span class="number">200</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l.remove(<span class="number">400</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l</span><br><span class="line">[<span class="number">100</span>, <span class="number">300</span>, <span class="number">200</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l.pop()<span class="comment"># pop ç¼ºçœå‚æ•°åˆ™å‡ºæœ€åä¸€ä¸ªï¼Œç­‰æ•ˆäº pop(-1) æˆ– pop(len(l)-1)</span></span><br><span class="line"><span class="number">200</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l.pop(<span class="number">0</span>)</span><br><span class="line"><span class="number">100</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l</span><br><span class="line">[<span class="number">300</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l.remove(<span class="string">&#x27;fool&#x27;</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">ValueError: <span class="built_in">list</span>.remove(x): x <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">list</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l.pop(<span class="number">999</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">IndexError: pop index out of <span class="built_in">range</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l.clear()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l</span><br><span class="line">[]</span><br></pre></td></tr></table></figure><p><strong>å…¶ä»–æ“ä½œ</strong>ï¼š</p><ul><li><code>list.index(x[, start[, end]])</code>: ä½ ç»™å€¼ï¼Œå®ƒè¿”ç´¢å¼•</li><li><code>list.count(x)</code>: ä½ ç»™å€¼ï¼Œå®ƒå‘Šè¯‰ä½ æœ‰å‡ ä¸ª</li><li><code>list.sort(key=None, reverse=False)</code>: ä¸€ç§æ¯”è¾ƒå¿«çš„åŸå€æ’åº</li><li><code>list.reverse()</code>: åˆ—è¡¨åè½¬ï¼Œè°ƒä¸ªä¸ªï¼ˆè¿™ä¸ªè¯å¥½æ€ªaï¼Œæˆ‘çš„é—®é¢˜å˜›ï¼Ÿï¼‰</li><li><code>list.copy()</code>: è¿”ä¸€ä¸ªè‡ªå·±çš„<em>æµ…æ‹·è´</em>ã€‚</li></ul><p>å…³äº list ï¼Œå¯ä»¥å†™çš„ä¸œè¥¿å®åœ¨å¤ªå¤šäº†ï¼Œéƒ½å¯ä»¥å•ç‹¬å†å†™ä¸€ç¯‡ï¼Œä¸“é—¨ç ”ç©¶äº†ã€‚ã€‚ã€‚ï¼ˆä»¥åå†è¯´å§ï¼Œå¯èƒ½æˆ‘ä¼šå†™å§ï¼Œç”¨äº†å¤ä¹ æ•°æ®ç»“æ„è¯¾ã€‚ï¼‰</p><h3 id="tuple"><a href="#tuple" class="headerlink" title="tuple"></a>tuple</h3><p>tupleï¼šå…ƒç»„ï¼Œå’Œ list ç±»ä¼¼ï¼Œåªæ˜¯å¸¸å†™åœ¨ <code>()</code> ä¸­ã€‚</p><p>tuple å¯ä»¥ getï¼Œ<strong>ä¸èƒ½set</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸èƒ½ appendã€ä¸èƒ½ popã€ä¸èƒ½ç´¢å¼•èµ‹å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t[<span class="number">1</span>] = <span class="string">&quot;sdfdsf&quot;</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: <span class="string">&#x27;tuple&#x27;</span> <span class="built_in">object</span> does <span class="keyword">not</span> support item assignment</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t.append(<span class="number">12</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">AttributeError: <span class="string">&#x27;tuple&#x27;</span> <span class="built_in">object</span> has no attribute <span class="string">&#x27;append&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t.pop()</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">AttributeError: <span class="string">&#x27;tuple&#x27;</span> <span class="built_in">object</span> has no attribute <span class="string">&#x27;pop&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t[<span class="number">1</span>:]</span><br><span class="line">(<span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œåˆšæ‰æˆ‘å†™äº†ä¸€å¥â€œtupleå¸¸å†™åœ¨<code>()</code>ä¸­â€ï¼Œä½•æ¥æ­¤â€œå¸¸â€ï¼Œtuple ä¸å°±æ˜¯å†™åœ¨åœ†æ‹¬å·é‡Œçš„å˜›ï¼Ÿå¦‚æœä½ æœ‰æ­¤ç–‘é—®ï¼Œä¸€å®šæ˜¯æ²¡æœ‰å¥½å¥½è¯»è¿‡æ–‡æ¡£ã€‚</p><p>ç»™ä½ ä¸ªæ”¹è¿‡è‡ªæ–°çš„æœºä¼šï¼š<a href="https://docs.python.org/3/tutorial/datastructures.html#tuples-and-sequences">https://docs.python.org/3/tutorial/datastructures.html#tuples-and-sequences</a>ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gdeo2dghg1j304j03mdfs.jpg" alt="RTFM"></p><p>æ–‡æ¡£é‡Œå†™äº†ï¼š</p><blockquote><p> A tuple consists of a number of values separated by commas.</p></blockquote><p>æ„æ€æ˜¯è¯´ï¼šâ€œå…ƒç»„(tuple)æ˜¯ä¸€ç³»åˆ—ç”¨é€—å·åˆ†å¼€çš„å€¼ï¼â€ï¼Œå¯æ²¡æç”¨åœ†æ‹¬å·æ‰©èµ·æ¥çš„å‘€ï¼Œå†çœ‹çœ‹è¿™ä¸ªä¾‹å­:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = <span class="number">12345</span>, <span class="number">54321</span>, <span class="string">&#x27;hello!&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t[<span class="number">0</span>]</span><br><span class="line"><span class="number">12345</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t</span><br><span class="line">(<span class="number">12345</span>, <span class="number">54321</span>, <span class="string">&#x27;hello!&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Tuples å¯ä»¥åµŒå¥—:</span></span><br><span class="line"><span class="meta">... </span>u = t, (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>u</span><br><span class="line">((<span class="number">12345</span>, <span class="number">54321</span>, <span class="string">&#x27;hello!&#x27;</span>), (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Tuples ä¸å¯å˜:</span></span><br><span class="line"><span class="meta">... </span>t[<span class="number">0</span>] = <span class="number">88888</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: <span class="string">&#x27;tuple&#x27;</span> <span class="built_in">object</span> does <span class="keyword">not</span> support item assignment</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># ä½†å¯ä»¥åŒ…å«å¯å˜çš„å…ƒç´ :</span></span><br><span class="line"><span class="meta">... </span>v = ([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>v</span><br><span class="line">([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>])</span><br></pre></td></tr></table></figure><p>å¯è§ï¼Œtuple å¯¹ Python ä¸­ä¾‹å¦‚å‡½æ•°å‚æ•°çš„ä¸€ç³»åˆ—å…ƒç´ çš„æ‰“åŒ…ä¼ é€’ç›¸å½“æœ‰ç”¨ï¼</p><h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><p><code>set</code> æ˜¯ä¿è¯<strong>å…ƒç´ å”¯ä¸€</strong>çš„<strong>æ— åº</strong>é›†åˆã€‚</p><p>æˆ‘ä»¬ä¸€èˆ¬ä¹Ÿå°±ç”¨å®ƒæ¥æ¶ˆé™¤é‡å¤ï¼Œä¿è¯å”¯ä¸€ã€‚å½“ç„¶ï¼Œä½ åº”è¯¥çŸ¥é“ï¼Œ<code>set</code> å°±å¤§æ¦‚å¯¹åº”äºæ•°å­¦é‡Œçš„ã€Œé›†åˆã€ï¼Œæ‰€ä»¥ <code>set</code> å¯ä»¥ç®— <del>ç—…å¨‡èŒ¶éƒ¨</del> å¹¶ã€äº¤ã€å·®ã€<del>è¡¥</del>ï¼ˆä½ å¯ä»¥æƒ³è±¡ï¼Œæ•°å­¦é‚£ç§è¡¥æ˜¯ä¸èƒ½ç®—çš„ï¼Œä½†å¯ä»¥ç®—ã€Œ<a href="https://en.wikipedia.org/wiki/Symmetric_difference">å¯¹ç§°å·®</a>ã€ï¼‰ã€‚</p><p>åˆ›å»ºä¸€ä¸ª set æœ‰ä¸¤ç§å†™æ³•ï¼š<code>set()</code> å‡½æ•°å’Œä½¿ç”¨èŠ±æ‹¬å· <code>&#123;ele1, ele2, ...&#125;</code>ã€‚ä½†å¦‚æœä½ è¦å»ºç©º setï¼Œåªèƒ½ç”¨ <code>set()</code>ï¼Œè€Œä¸èƒ½ç”¨ <code>&#123;&#125;</code>ï¼å› ä¸ºä½ åº”è¯¥çŸ¥é“ï¼Œ<code>&#123;&#125;</code> å»ºçš„æ˜¯ç©ºå­—å…¸ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = &#123;&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(s)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">dict</span>&#x27;&gt;</span></span><br><span class="line">&gt;&gt;&gt; s = set()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(s)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">set</span>&#x27;&gt;</span></span><br><span class="line">&gt;&gt;&gt; s1 = set([1, 2, 3])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s1</span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s2 = &#123;<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s2</span><br><span class="line">&#123;<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(s2)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">set</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b</span><br><span class="line">&#123;<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a | b    <span class="comment"># å¹¶ï¼Œç±»ä¼¼äºã€Œé€»è¾‘æˆ–ã€ï¼šåœ¨aæˆ–åœ¨bæˆ–éƒ½åœ¨</span></span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a &amp; b    <span class="comment"># äº¤ï¼Œç±»ä¼¼äºã€Œé€»è¾‘ä¸ã€ï¼šåœ¨aä¸”åœ¨b</span></span><br><span class="line">&#123;<span class="number">3</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a - b    <span class="comment"># å·®ï¼Œç±»ä¼¼äºã€Œé€»è¾‘å·®ã€ï¼šåœ¨aä¸åœ¨b</span></span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a ^ b    <span class="comment"># å¯¹ç§°å·®ï¼Œç±»ä¼¼äºã€Œé€»è¾‘å¼‚æˆ–ã€ï¼šåœ¨aæˆ–åœ¨bï¼Œä½†ä¸éƒ½åœ¨</span></span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="dict"><a href="#dict" class="headerlink" title="dict"></a>dict</h3><p>dictï¼šå­—å…¸ï¼Œé”®å€¼å¯¹ï¼Œåº•å±‚å®ç°æ˜¯å“ˆå¸Œè¡¨ã€‚å­—é¢å€¼å†™ä½œ <code>&#123;key1: value1, key2: value2, ...&#125;</code>ã€‚</p><p>æ—¢ç„¶ dict éƒ½å†™æˆå’Œ set ä¸€æ ·çš„ <code>&#123;&#125;</code> äº†ï¼Œé‚£ä½ çœ‹å¯ä»¥æƒ³è±¡ï¼Œdict ä¹Ÿå¯ä»¥ä¿è¯å”¯ä¸€æ€§ â€”â€” dictä¿è¯ key çš„å”¯ä¸€ã€‚</p><p>key å¯ä»¥æ˜¯ä»»ä½•ã€Œä¸å¯å˜ã€çš„å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°å­—ã€å­—ç¬¦ä¸²ã€ä¸åŒ…å«å¯å˜å…ƒç´ çš„å…ƒç»„éƒ½å¯ä»¥ä½œä¸º keyã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = &#123;<span class="number">1</span>: <span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;2&#x27;</span>: <span class="number">2.0001</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d[<span class="number">1</span>]</span><br><span class="line"><span class="string">&#x27;abc&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d[<span class="string">&#x27;2&#x27;</span>]</span><br><span class="line"><span class="number">2.0001</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>tel = &#123;<span class="string">&#x27;jack&#x27;</span>: <span class="number">4098</span>, <span class="string">&#x27;sape&#x27;</span>: <span class="number">4139</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tel[<span class="string">&#x27;guido&#x27;</span>] = <span class="number">4127</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tel</span><br><span class="line">&#123;<span class="string">&#x27;jack&#x27;</span>: <span class="number">4098</span>, <span class="string">&#x27;sape&#x27;</span>: <span class="number">4139</span>, <span class="string">&#x27;guido&#x27;</span>: <span class="number">4127</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tel[<span class="string">&#x27;jack&#x27;</span>]</span><br><span class="line"><span class="number">4098</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> tel[<span class="string">&#x27;sape&#x27;</span>]<span class="comment"># åˆ é™¤å…ƒç´ </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tel[<span class="string">&#x27;irv&#x27;</span>] = <span class="number">4127</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tel</span><br><span class="line">&#123;<span class="string">&#x27;jack&#x27;</span>: <span class="number">4098</span>, <span class="string">&#x27;guido&#x27;</span>: <span class="number">4127</span>, <span class="string">&#x27;irv&#x27;</span>: <span class="number">4127</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(tel)<span class="comment"># å–é”®</span></span><br><span class="line">[<span class="string">&#x27;jack&#x27;</span>, <span class="string">&#x27;guido&#x27;</span>, <span class="string">&#x27;irv&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">sorted</span>(tel)</span><br><span class="line">[<span class="string">&#x27;guido&#x27;</span>, <span class="string">&#x27;irv&#x27;</span>, <span class="string">&#x27;jack&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;guido&#x27;</span> <span class="keyword">in</span> tel<span class="comment"># é”®åœ¨ä¸åœ¨å­—å…¸é‡Œ</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;jack&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> tel</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure><p>ç”¨ <code>dict()</code> å‡½æ•°å¯ä»¥æœ‰æ›´å¤šåˆå§‹åŒ–å­—å…¸çš„æŠ€å·§ï¼Œæˆ‘éšä¾¿ä»æ–‡æ¡£æŠ„ä¸¤ä¸ªï¼Œä½ ç»†å“ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dict</span>([(<span class="string">&#x27;sape&#x27;</span>, <span class="number">4139</span>), (<span class="string">&#x27;guido&#x27;</span>, <span class="number">4127</span>), (<span class="string">&#x27;jack&#x27;</span>, <span class="number">4098</span>)])</span><br><span class="line">&#123;<span class="string">&#x27;sape&#x27;</span>: <span class="number">4139</span>, <span class="string">&#x27;guido&#x27;</span>: <span class="number">4127</span>, <span class="string">&#x27;jack&#x27;</span>: <span class="number">4098</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dict</span>(sape=<span class="number">4139</span>, guido=<span class="number">4127</span>, jack=<span class="number">4098</span>)</span><br><span class="line">&#123;<span class="string">&#x27;sape&#x27;</span>: <span class="number">4139</span>, <span class="string">&#x27;guido&#x27;</span>: <span class="number">4127</span>, <span class="string">&#x27;jack&#x27;</span>: <span class="number">4098</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¨å¯¼å¼"><a href="#æ¨å¯¼å¼" class="headerlink" title="æ¨å¯¼å¼"></a>æ¨å¯¼å¼</h3><p>æ¨å¯¼å¼ï¼ˆcomprehensionsï¼‰æ˜¯ç”¨æ¥åˆ›å»ºé›†åˆç±»å‹å®ä¾‹çš„ã€‚</p><p>æ¯”å¦‚ï¼Œä½ æƒ³å»ºä¸€ä¸ªâ€œ1åˆ°10çš„å¹³æ–¹ç»„æˆçš„listâ€ï¼Œä½ å¦‚ä½•æ¥å†™ä»£ç ï¼Ÿ</p><p>å½“ç„¶ï¼Œæ•°æ®é‡ä¸å¤§ï¼Œæˆ‘ä»¬è‚¯å®šå¯ä»¥è¿™æ ·ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>, <span class="number">36</span>, <span class="number">49</span>, <span class="number">64</span>, <span class="number">81</span>, <span class="number">100</span>]</span><br></pre></td></tr></table></figure><p>ä½†å¦‚æœæ˜¯1ï½100ï¼Œ1ï½100000å‘¢ï¼Ÿä½ æƒ³ç”¨å¾ªç¯å¯¹å§ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = []</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">101</span>):</span><br><span class="line"><span class="meta">... </span>    a.append(i**<span class="number">2</span>)</span><br><span class="line"><span class="meta">... </span></span><br></pre></td></tr></table></figure><p>ä½†è¿™æ ·ä¸å¤Ÿç®€æ´ï¼</p><p>â€œ1åˆ°10çš„å¹³æ–¹ç»„æˆçš„listâ€ï¼Œè¯´èµ·æ¥å°±ä¸€å¥è¯ï¼Œä»£ç ä¹Ÿåº”è¯¥ç®€ç®€å•å•ä¸€è¡Œå°±å®Œæˆï¼ã€Œæ¨å¯¼å¼ã€å°±æ˜¯å¹²è¿™ä¸ªçš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>)]</span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>, <span class="number">36</span>, <span class="number">49</span>, <span class="number">64</span>, <span class="number">81</span>, <span class="number">100</span>]</span><br></pre></td></tr></table></figure><p>æ¨å¯¼å¼çš„ä¸€èˆ¬å½¢å¼æ˜¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[è¡¨è¾¾å¼ ä»»æ„ä¸ª<span class="keyword">for</span>æˆ–<span class="keyword">if</span>å¥]</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­å¯ä»¥ç»™ä½ ä¸ªæ¯”è¾ƒå¥½çš„å°è±¡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[(x, y, x*y) <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>] <span class="keyword">for</span> y <span class="keyword">in</span> [<span class="number">3</span>,<span class="number">1</span>,<span class="number">4</span>] <span class="keyword">if</span> x != y]</span><br><span class="line">[(<span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>), (<span class="number">1</span>, <span class="number">4</span>, <span class="number">4</span>), (<span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>), (<span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>), (<span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>), (<span class="number">3</span>, <span class="number">1</span>, <span class="number">3</span>), (<span class="number">3</span>, <span class="number">4</span>, <span class="number">12</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># ç›¸å½“äºï¼š</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>combs = []</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">for</span> y <span class="keyword">in</span> [<span class="number">3</span>,<span class="number">1</span>,<span class="number">4</span>]:</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">if</span> x != y:</span><br><span class="line"><span class="meta">... </span>            combs.append((x, y, x*y))</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>combs</span><br><span class="line">[(<span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>), (<span class="number">1</span>, <span class="number">4</span>, <span class="number">4</span>), (<span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>), (<span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>), (<span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>), (<span class="number">3</span>, <span class="number">1</span>, <span class="number">3</span>), (<span class="number">3</span>, <span class="number">4</span>, <span class="number">12</span>)]</span><br></pre></td></tr></table></figure><p>å…¶å®å‡†ç¡®çš„è¯´ï¼Œæˆ‘ä»¬åˆšæ‰å†™çš„è¿™äº›éƒ½æ˜¯ã€Œåˆ—è¡¨æ¨å¯¼å¼ã€ã€‚æˆ‘ä»¬è¿˜æœ‰ã€Œsetæ¨å¯¼å¼ã€ç”šè‡³æ˜¯ã€Œdictæ¨å¯¼å¼ã€ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>&#123;x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="string">&#x27;abracadabra&#x27;</span> <span class="keyword">if</span> x <span class="keyword">not</span> <span class="keyword">in</span> <span class="string">&#x27;abc&#x27;</span>&#125;</span><br><span class="line">&#123;<span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;d&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>&#123;x: x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> (<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>)&#125;</span><br><span class="line">&#123;<span class="number">2</span>: <span class="number">4</span>, <span class="number">4</span>: <span class="number">16</span>, <span class="number">6</span>: <span class="number">36</span>&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯èƒ½è¿˜æƒ³å†™è¿™ä¸ªï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>(x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>))</span><br><span class="line">&lt;generator <span class="built_in">object</span> &lt;genexpr&gt; at <span class="number">0x107988bd0</span>&gt;</span><br></pre></td></tr></table></figure><p>å“ˆå“ˆï¼Œæœ‰ç‚¹ä¸ä¸€æ ·äº†ï¼Œè¿™æ¬¡å®ƒç»™ä½ è¿”äº†ä¸ª generatorâ€”â€”ç”Ÿæˆå™¨ï¼Œè¿™å°±ä¸æ˜¯æ¨å¯¼å¼äº†ï¼Œè¿™é‡Œä¸åšä»‹ç»ï¼Œåé¢æˆ‘ä»¬å†è®¨è®ºè¿™ä¸œè¥¿ã€‚</p><p>æœ€åï¼Œå†çœ‹ä¸¤ä¸ªå¾ˆæœ‰æ„æ€çš„ä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[[(j, i, j*i) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, i+<span class="number">1</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>)]</span><br><span class="line">æˆ–</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[(j, i, j*i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, i+<span class="number">1</span>)]</span><br><span class="line">[[(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)], [(<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>), (<span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>)], [(<span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>), (<span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>), (<span class="number">3</span>, <span class="number">3</span>, <span class="number">9</span>)], [(<span class="number">1</span>, <span class="number">4</span>, <span class="number">4</span>), (<span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>), (<span class="number">3</span>, <span class="number">4</span>, <span class="number">12</span>), (<span class="number">4</span>, <span class="number">4</span>, <span class="number">16</span>)], [(<span class="number">1</span>, <span class="number">5</span>, <span class="number">5</span>), (<span class="number">2</span>, <span class="number">5</span>, <span class="number">10</span>), (<span class="number">3</span>, <span class="number">5</span>, <span class="number">15</span>), (<span class="number">4</span>, <span class="number">5</span>, <span class="number">20</span>), (<span class="number">5</span>, <span class="number">5</span>, <span class="number">25</span>)], [(<span class="number">1</span>, <span class="number">6</span>, <span class="number">6</span>), (<span class="number">2</span>, <span class="number">6</span>, <span class="number">12</span>), (<span class="number">3</span>, <span class="number">6</span>, <span class="number">18</span>), (<span class="number">4</span>, <span class="number">6</span>, <span class="number">24</span>), (<span class="number">5</span>, <span class="number">6</span>, <span class="number">30</span>), (<span class="number">6</span>, <span class="number">6</span>, <span class="number">36</span>)], [(<span class="number">1</span>, <span class="number">7</span>, <span class="number">7</span>), (<span class="number">2</span>, <span class="number">7</span>, <span class="number">14</span>), (<span class="number">3</span>, <span class="number">7</span>, <span class="number">21</span>), (<span class="number">4</span>, <span class="number">7</span>, <span class="number">28</span>), (<span class="number">5</span>, <span class="number">7</span>, <span class="number">35</span>), (<span class="number">6</span>, <span class="number">7</span>, <span class="number">42</span>), (<span class="number">7</span>, <span class="number">7</span>, <span class="number">49</span>)], [(<span class="number">1</span>, <span class="number">8</span>, <span class="number">8</span>), (<span class="number">2</span>, <span class="number">8</span>, <span class="number">16</span>), (<span class="number">3</span>, <span class="number">8</span>, <span class="number">24</span>), (<span class="number">4</span>, <span class="number">8</span>, <span class="number">32</span>), (<span class="number">5</span>, <span class="number">8</span>, <span class="number">40</span>), (<span class="number">6</span>, <span class="number">8</span>, <span class="number">48</span>), (<span class="number">7</span>, <span class="number">8</span>, <span class="number">56</span>), (<span class="number">8</span>, <span class="number">8</span>, <span class="number">64</span>)], [(<span class="number">1</span>, <span class="number">9</span>, <span class="number">9</span>), (<span class="number">2</span>, <span class="number">9</span>, <span class="number">18</span>), (<span class="number">3</span>, <span class="number">9</span>, <span class="number">27</span>), (<span class="number">4</span>, <span class="number">9</span>, <span class="number">36</span>), (<span class="number">5</span>, <span class="number">9</span>, <span class="number">45</span>), (<span class="number">6</span>, <span class="number">9</span>, <span class="number">54</span>), (<span class="number">7</span>, <span class="number">9</span>, <span class="number">63</span>), (<span class="number">8</span>, <span class="number">9</span>, <span class="number">72</span>), (<span class="number">9</span>, <span class="number">9</span>, <span class="number">81</span>)]]</span><br></pre></td></tr></table></figure><p>ä¹˜æ³•è¡¨ï¼Œè¿™ä¸¤ç§å†™æ³•æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>matrix = [</span><br><span class="line"><span class="meta">... </span>    [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>],</span><br><span class="line"><span class="meta">... </span>    [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>],</span><br><span class="line"><span class="meta">... </span>    [<span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>],</span><br><span class="line"><span class="meta">... </span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[[row[i] <span class="keyword">for</span> row <span class="keyword">in</span> matrix] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">[[<span class="number">1</span>, <span class="number">5</span>, <span class="number">9</span>], [<span class="number">2</span>, <span class="number">6</span>, <span class="number">10</span>], [<span class="number">3</span>, <span class="number">7</span>, <span class="number">11</span>], [<span class="number">4</span>, <span class="number">8</span>, <span class="number">12</span>]]</span><br></pre></td></tr></table></figure><p>æ²¡é”™ï¼çŸ©é˜µè½¬ç½®ï¼Œåˆ©ç”¨æ¨å¯¼å¼ä¸­åªç”¨ä¸€è¡Œä»£ç å°±å¯ä»¥å®ç°ã€‚</p><hr><p>æœªå®Œå¾…ç»­â€¦</p><p>ï¼ˆæœ€è¿‘è¿™ä¸¤å¤©éƒ½åœ¨è¡¥ä½œä¸šå‘€ã€è¡¥ä½œä¸šå‘€ã€è¡¥ä½œä¸šå‘€â€¦ä¸è¡¥ä½œä¸šçš„æ—¶å€™è¿˜è¦æ‰“æ¸¸æˆâ€¦å¿™å¾—å¾ˆã€‚è€Œä¸”æœ€è¿‘ç»ƒä¹ åŒæ‹¼ï¼Œä¸­æ–‡æ‰“å­—é€Ÿåº¦ç›´çº¿ä¸‹é™ï¼Œæ‰€ä»¥è¿™ç¯‡å†™äº†å¥½ä¹…ã€‚ç°åœ¨ä½œä¸šå¤§æ¦‚è¡¥å®Œäº†ï¼ŒåŒæ‹¼ä¹Ÿå·²æœ‰äº†å°æˆï¼ˆå¤§æ¦‚ï¼Ÿï¼‰ï¼Œä»¥ååº”è¯¥ä¼šå¿«ä¸€äº›äº†ã€‚ï¼‰</p><p>Next: ã€Pythonæµç¨‹æ§åˆ¶ã€‘</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> åŸºç¡€æ‰‹å†Œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode 239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼</title>
      <link href="/2020/03/26/School/Leetcode_P239_sliding-window-maximum/"/>
      <url>/2020/03/26/School/Leetcode_P239_sliding-window-maximum/</url>
      
        <content type="html"><![CDATA[<h1 id="Leetcode-239-æ»‘åŠ¨çª—å£æœ€å¤§å€¼"><a href="#Leetcode-239-æ»‘åŠ¨çª—å£æœ€å¤§å€¼" class="headerlink" title="Leetcode 239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼"></a>Leetcode <a href="https://leetcode-cn.com/problems/sliding-window-maximum/">239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼</a></h1><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>ç»™å®šä¸€ä¸ªæ•°ç»„ <em>nums</em>ï¼Œæœ‰ä¸€ä¸ªå¤§å°ä¸º <em>k</em> çš„æ»‘åŠ¨çª—å£ä»æ•°ç»„çš„æœ€å·¦ä¾§ç§»åŠ¨åˆ°æ•°ç»„çš„æœ€å³ä¾§ã€‚ä½ åªå¯ä»¥çœ‹åˆ°åœ¨æ»‘åŠ¨çª—å£å†…çš„ <em>k</em> ä¸ªæ•°å­—ã€‚æ»‘åŠ¨çª—å£æ¯æ¬¡åªå‘å³ç§»åŠ¨ä¸€ä½ã€‚</p><p>è¿”å›æ»‘åŠ¨çª—å£ä¸­çš„æœ€å¤§å€¼ã€‚</p><p><strong>è¿›é˜¶ï¼š</strong></p><p>ä½ èƒ½åœ¨çº¿æ€§æ—¶é—´å¤æ‚åº¦å†…è§£å†³æ­¤é¢˜å—ï¼Ÿ</p><p><strong>ç¤ºä¾‹:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: nums &#x3D; [1,3,-1,-3,5,3,6,7], å’Œ k &#x3D; 3</span><br><span class="line">è¾“å‡º: [3,3,5,5,6,7] </span><br><span class="line">è§£é‡Š: </span><br><span class="line"></span><br><span class="line">  æ»‘åŠ¨çª—å£çš„ä½ç½®                æœ€å¤§å€¼</span><br><span class="line">---------------               -----</span><br><span class="line">[1  3  -1] -3  5  3  6  7       3</span><br><span class="line"> 1 [3  -1  -3] 5  3  6  7       3</span><br><span class="line"> 1  3 [-1  -3  5] 3  6  7       5</span><br><span class="line"> 1  3  -1 [-3  5  3] 6  7       5</span><br><span class="line"> 1  3  -1  -3 [5  3  6] 7       6</span><br><span class="line"> 1  3  -1  -3  5 [3  6  7]      7</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 &lt;= nums.length &lt;= 10^5</code></li><li><code>-10^4 &lt;= nums[i] &lt;= 10^4</code></li><li><code>1 &lt;= k &lt;= nums.length</code></li></ul><h2 id="åŒå‘é˜Ÿåˆ—æ³•"><a href="#åŒå‘é˜Ÿåˆ—æ³•" class="headerlink" title="åŒå‘é˜Ÿåˆ—æ³•"></a>åŒå‘é˜Ÿåˆ—æ³•</h2><p>æˆ‘ä»¬å¯ä»¥ç»´æŠ¤ä¸€ä¸ªä¸€ä¸ª<strong>åŒå‘é˜Ÿåˆ—</strong>ï¼Œåœ¨é‡Œé¢ç»´æŠ¤å­˜åœ¨äº<strong>å½“å‰çª—å£ä¸­çš„</strong>é€æ­¥æœ€å¤§å€¼ç´¢å¼• ï¼Œæ¯ä¸€æ­¥å³ç«¯å‹å…¥å½“å‰ç´¢å¼•ã€æ¸…é™¤æ¯”å½“å‰å°çš„å€¼çš„ç´¢å¼•ã€‚ä» k å¤„å¼€å§‹ï¼Œæ¯æ¬¡å–å·¦ç«¯å€¼å³å½“å‰æ»‘çª—çš„æœ€å¤§å€¼ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxSlidingWindow</span><span class="params">(nums []<span class="keyword">int</span>, k <span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(nums) &lt; k || k &lt;= <span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> nums</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    memo := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">var</span> e <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">    swMax := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">1</span>)</span><br><span class="line">    swMax[<span class="number">0</span>] = nums[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; k; i++ &#123;</span><br><span class="line">        <span class="keyword">for</span> e = <span class="built_in">len</span>(memo); e &gt; <span class="number">0</span> &amp;&amp; nums[i] &gt; nums[memo[e<span class="number">-1</span>]]; e-- &#123;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        memo = memo[:e]</span><br><span class="line">        memo = <span class="built_in">append</span>(memo, i)</span><br><span class="line">        <span class="keyword">if</span> nums[i] &gt; swMax[<span class="number">0</span>] &#123;</span><br><span class="line">            swMax[<span class="number">0</span>] = nums[i]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// fmt.Println(memo)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := k; i &lt; <span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">        <span class="comment">// leaving</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(memo) != <span class="number">0</span> &amp;&amp; memo[<span class="number">0</span>] == i - k &#123;</span><br><span class="line">            memo = memo[<span class="number">1</span>:]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// entering</span></span><br><span class="line">        <span class="keyword">for</span> e = <span class="built_in">len</span>(memo); e &gt; <span class="number">0</span> &amp;&amp; nums[i] &gt; nums[memo[e<span class="number">-1</span>]]; e-- &#123;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        memo = memo[:e]</span><br><span class="line">        memo = <span class="built_in">append</span>(memo, i)</span><br><span class="line">        <span class="comment">// ans</span></span><br><span class="line">        swMax = <span class="built_in">append</span>(swMax, nums[memo[<span class="number">0</span>]])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> swMax</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode 641. è®¾è®¡å¾ªç¯åŒç«¯é˜Ÿåˆ—</title>
      <link href="/2020/03/26/School/Leetcode_P641_design-circular-deque/"/>
      <url>/2020/03/26/School/Leetcode_P641_design-circular-deque/</url>
      
        <content type="html"><![CDATA[<h1 id="Leetcode-641-è®¾è®¡å¾ªç¯åŒç«¯é˜Ÿåˆ—"><a href="#Leetcode-641-è®¾è®¡å¾ªç¯åŒç«¯é˜Ÿåˆ—" class="headerlink" title="Leetcode 641. è®¾è®¡å¾ªç¯åŒç«¯é˜Ÿåˆ—"></a>Leetcode <a href="https://leetcode-cn.com/problems/design-circular-deque/">641. è®¾è®¡å¾ªç¯åŒç«¯é˜Ÿåˆ—</a></h1><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>è®¾è®¡å®ç°åŒç«¯é˜Ÿåˆ—ã€‚<br>ä½ çš„å®ç°éœ€è¦æ”¯æŒä»¥ä¸‹æ“ä½œï¼š</p><ul><li>MyCircularDeque(k)ï¼šæ„é€ å‡½æ•°,åŒç«¯é˜Ÿåˆ—çš„å¤§å°ä¸ºkã€‚</li><li>insertFront()ï¼šå°†ä¸€ä¸ªå…ƒç´ æ·»åŠ åˆ°åŒç«¯é˜Ÿåˆ—å¤´éƒ¨ã€‚ å¦‚æœæ“ä½œæˆåŠŸè¿”å› trueã€‚</li><li>insertLast()ï¼šå°†ä¸€ä¸ªå…ƒç´ æ·»åŠ åˆ°åŒç«¯é˜Ÿåˆ—å°¾éƒ¨ã€‚å¦‚æœæ“ä½œæˆåŠŸè¿”å› trueã€‚</li><li>deleteFront()ï¼šä»åŒç«¯é˜Ÿåˆ—å¤´éƒ¨åˆ é™¤ä¸€ä¸ªå…ƒç´ ã€‚ å¦‚æœæ“ä½œæˆåŠŸè¿”å› trueã€‚</li><li>deleteLast()ï¼šä»åŒç«¯é˜Ÿåˆ—å°¾éƒ¨åˆ é™¤ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœæ“ä½œæˆåŠŸè¿”å› trueã€‚</li><li>getFront()ï¼šä»åŒç«¯é˜Ÿåˆ—å¤´éƒ¨è·å¾—ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœåŒç«¯é˜Ÿåˆ—ä¸ºç©ºï¼Œè¿”å› -1ã€‚</li><li>getRear()ï¼šè·å¾—åŒç«¯é˜Ÿåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚ å¦‚æœåŒç«¯é˜Ÿåˆ—ä¸ºç©ºï¼Œè¿”å› -1ã€‚</li><li>isEmpty()ï¼šæ£€æŸ¥åŒç«¯é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºã€‚</li><li>isFull()ï¼šæ£€æŸ¥åŒç«¯é˜Ÿåˆ—æ˜¯å¦æ»¡äº†ã€‚</li></ul><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">MyCircularDeque circularDeque &#x3D; new MycircularDeque(3); &#x2F;&#x2F; è®¾ç½®å®¹é‡å¤§å°ä¸º3</span><br><span class="line">circularDeque.insertLast(1);        &#x2F;&#x2F; è¿”å› true</span><br><span class="line">circularDeque.insertLast(2);        &#x2F;&#x2F; è¿”å› true</span><br><span class="line">circularDeque.insertFront(3);        &#x2F;&#x2F; è¿”å› true</span><br><span class="line">circularDeque.insertFront(4);        &#x2F;&#x2F; å·²ç»æ»¡äº†ï¼Œè¿”å› false</span><br><span class="line">circularDeque.getRear();  &#x2F;&#x2F; è¿”å› 2</span><br><span class="line">circularDeque.isFull();        &#x2F;&#x2F; è¿”å› true</span><br><span class="line">circularDeque.deleteLast();        &#x2F;&#x2F; è¿”å› true</span><br><span class="line">circularDeque.insertFront(4);        &#x2F;&#x2F; è¿”å› true</span><br><span class="line">circularDeque.getFront();&#x2F;&#x2F; è¿”å› 4</span><br><span class="line"> </span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li>æ‰€æœ‰å€¼çš„èŒƒå›´ä¸º [1, 1000]</li><li>æ“ä½œæ¬¡æ•°çš„èŒƒå›´ä¸º [1, 1000]</li><li>è¯·ä¸è¦ä½¿ç”¨å†…ç½®çš„åŒç«¯é˜Ÿåˆ—åº“ã€‚</li></ul><h2 id="é“¾è¡¨å®ç°"><a href="#é“¾è¡¨å®ç°" class="headerlink" title="é“¾è¡¨å®ç°"></a>é“¾è¡¨å®ç°</h2><p>ç»å…¸çš„æ•°æ®ç»“æ„å°±ä¸è§£é‡Šäº†ï¼Œå¤§å®¶éƒ½æ‡‚ï¼Œç›´æ¥ä¸Šä»£ç ï¼ŒGolang å®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Node <span class="keyword">struct</span> &#123;</span><br><span class="line">Data <span class="keyword">int</span></span><br><span class="line">Next *Node</span><br><span class="line">Priv *Node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyCircularDeque <span class="keyword">struct</span> &#123;</span><br><span class="line">Front  *Node</span><br><span class="line">Last   *Node</span><br><span class="line">length <span class="keyword">int</span></span><br><span class="line">maxLen <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Initialize your data structure here. Set the size of the deque to be k. */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Constructor</span><span class="params">(k <span class="keyword">int</span>)</span> <span class="title">MyCircularDeque</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> MyCircularDeque&#123;</span><br><span class="line">length: <span class="number">0</span>,</span><br><span class="line">maxLen: k,</span><br><span class="line">Front:  <span class="literal">nil</span>,</span><br><span class="line">Last:   <span class="literal">nil</span>,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Adds an item at the front of Deque. Return true if the operation is successful. */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MyCircularDeque)</span> <span class="title">InsertFront</span><span class="params">(value <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> this.length == this.maxLen &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> this.length == <span class="number">0</span> &#123;</span><br><span class="line">this.Last = &amp;Node&#123;</span><br><span class="line">Data: value,</span><br><span class="line">&#125;</span><br><span class="line">this.Front = this.Last</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">this.Front.Priv = &amp;Node&#123;</span><br><span class="line">Data: value,</span><br><span class="line">Next: this.Front,</span><br><span class="line">&#125;</span><br><span class="line">this.Front = this.Front.Priv</span><br><span class="line">&#125;</span><br><span class="line">this.length++</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Adds an item at the Last of Deque. Return true if the operation is successful. */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MyCircularDeque)</span> <span class="title">InsertLast</span><span class="params">(value <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> this.length == this.maxLen &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> this.length == <span class="number">0</span> &#123;</span><br><span class="line">this.Front = &amp;Node&#123;</span><br><span class="line">Data: value,</span><br><span class="line">&#125;</span><br><span class="line">this.Last = this.Front</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">this.Last.Next = &amp;Node&#123;</span><br><span class="line">Data: value,</span><br><span class="line">Priv: this.Last,</span><br><span class="line">&#125;</span><br><span class="line">this.Last = this.Last.Next</span><br><span class="line">&#125;</span><br><span class="line">this.length++</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Deletes an item from the front of Deque. Return true if the operation is successful. */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MyCircularDeque)</span> <span class="title">DeleteFront</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> this.length == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">this.Front = this.Front.Next</span><br><span class="line"><span class="keyword">if</span> this.Front != <span class="literal">nil</span> &#123;</span><br><span class="line">this.Front.Priv = <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line">this.length--</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Deletes an item from the Last of Deque. Return true if the operation is successful. */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MyCircularDeque)</span> <span class="title">DeleteLast</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> this.length == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">this.Last = this.Last.Priv</span><br><span class="line"><span class="keyword">if</span> this.Last != <span class="literal">nil</span> &#123;</span><br><span class="line">this.Last.Next = <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line">this.length--</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Get the front item from the deque. */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MyCircularDeque)</span> <span class="title">GetFront</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> this.length == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> this.Front.Data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Get the last item from the deque. */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MyCircularDeque)</span> <span class="title">GetLast</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> this.length == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> this.Last.Data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Alias of GetLast for the foolish leetcode</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MyCircularDeque)</span> <span class="title">GetRear</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> this.length == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> this.Last.Data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Checks whether the circular deque is empty or not. */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MyCircularDeque)</span> <span class="title">IsEmpty</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> (this.length == <span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Checks whether the circular deque is full or not. */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MyCircularDeque)</span> <span class="title">IsFull</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> (this.length == this.maxLen)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your MyCircularDeque object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * obj := Constructor(k);</span></span><br><span class="line"><span class="comment"> * param_1 := obj.InsertFront(value);</span></span><br><span class="line"><span class="comment"> * param_2 := obj.InsertLast(value);</span></span><br><span class="line"><span class="comment"> * param_3 := obj.DeleteFront();</span></span><br><span class="line"><span class="comment"> * param_4 := obj.DeleteLast();</span></span><br><span class="line"><span class="comment"> * param_5 := obj.GetFront();</span></span><br><span class="line"><span class="comment"> * param_6 := obj.GetLast();</span></span><br><span class="line"><span class="comment"> * param_7 := obj.IsEmpty();</span></span><br><span class="line"><span class="comment"> * param_8 := obj.IsFull();</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p>åæ§½ä¸€ä¸‹Leetcodeï¼Œç»™ä½ çš„æ¨¡ç‰ˆé‡Œæ˜¯ä¸ª <code>GetLast</code>ï¼Œä½ å†™å¥½äº†ï¼Œè¿è¡Œçš„æ—¶å€™å°±ä¼šçˆ†å‡ºä¸ªé”™è¯´ä½ çš„ MyCircularDeque é‡Œæ–¹æ³• <code>GetRear</code> ç¼ºå¤±ï¼Œè¦æŠŠ GetLast çš„ä»£ç æŠ„ä¸€éå†™ä¸ª GetRear æ‰è¡Œï¼</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd730nmy30j31930u01kx.jpg" alt="image-20200326094017120"></p><p>ç”¨é“¾è¡¨åšç®—æ³•é¢˜è‚¯å®šæ—¶é—´ç©ºé—´ç»“æœéƒ½ä¸å¥½ï¼Œä½†æœ‰æ„æ€å˜›ï¼Œå†™ä¸ªåˆ‡ç‰‡å»å¥—å¿«æ˜¯å¿«äº†ã€ç©ºé—´ç”¨çš„ä¹Ÿå°ã€‚</p><h2 id="å¾ªç¯æ•°ç»„"><a href="#å¾ªç¯æ•°ç»„" class="headerlink" title="å¾ªç¯æ•°ç»„"></a>å¾ªç¯æ•°ç»„</h2><p>å‚è€ƒ <a href="https://blog.csdn.net/JoshuaTsui/article/details/105102674">JoshuaTsuiã€ŠLeetCode è®¾è®¡å¾ªç¯åŒç«¯é˜Ÿåˆ—ã€‹</a>ï¼ŒGolang å®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyCircularDeque <span class="keyword">struct</span> &#123;</span><br><span class="line">data   []<span class="keyword">int</span></span><br><span class="line">pFront <span class="keyword">int</span></span><br><span class="line">pAfterLast  <span class="keyword">int</span></span><br><span class="line">maxLen <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Initialize your data structure here. Set the size of the deque to be k. */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Constructor</span><span class="params">(k <span class="keyword">int</span>)</span> <span class="title">MyCircularDeque</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> MyCircularDeque&#123;</span><br><span class="line">maxLen: k+<span class="number">1</span>,</span><br><span class="line">pFront: <span class="number">0</span>,</span><br><span class="line">pAfterLast: <span class="number">0</span>,</span><br><span class="line">data: <span class="built_in">make</span>([]<span class="keyword">int</span>, k+<span class="number">1</span>),</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Adds an item at the front of Deque. Return true if the operation is successful. */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MyCircularDeque)</span> <span class="title">InsertFront</span><span class="params">(value <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> this.IsFull() &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">this.pFront = (this.pFront - <span class="number">1</span> + this.maxLen) % this.maxLen<span class="comment">// notice to promise &gt;= 0</span></span><br><span class="line">this.data[this.pFront] = value</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Adds an item at the Last of Deque. Return true if the operation is successful. */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MyCircularDeque)</span> <span class="title">InsertLast</span><span class="params">(value <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> this.IsFull() &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">this.data[this.pAfterLast] = value</span><br><span class="line">    this.pAfterLast = (this.pAfterLast + <span class="number">1</span>) % this.maxLen</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Deletes an item from the front of Deque. Return true if the operation is successful. */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MyCircularDeque)</span> <span class="title">DeleteFront</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> this.IsEmpty() &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">this.pFront = (this.pFront + <span class="number">1</span>) % this.maxLen</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Deletes an item from the Last of Deque. Return true if the operation is successful. */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MyCircularDeque)</span> <span class="title">DeleteLast</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> this.IsEmpty() &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">this.pAfterLast = (this.pAfterLast - <span class="number">1</span> + this.maxLen) % this.maxLen</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Get the front item from the deque. */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MyCircularDeque)</span> <span class="title">GetFront</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> this.IsEmpty() &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> this.data[this.pFront]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Get the last item from the deque. */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MyCircularDeque)</span> <span class="title">GetLast</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> this.IsEmpty() &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> this.data[(this.pAfterLast - <span class="number">1</span> + this.maxLen) % this.maxLen]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Alias of GetLast for the foolish leetcode</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MyCircularDeque)</span> <span class="title">GetRear</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> this.IsEmpty() &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> this.data[(this.pAfterLast - <span class="number">1</span> + this.maxLen) % this.maxLen]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Checks whether the circular deque is empty or not. */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MyCircularDeque)</span> <span class="title">IsEmpty</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> (this.pFront == this.pAfterLast)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Checks whether the circular deque is full or not. */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MyCircularDeque)</span> <span class="title">IsFull</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> (this.pAfterLast + <span class="number">1</span>) % this.maxLen == this.pFront</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd76ckm54wj31930u01kx.jpg" alt="image-20200326113533190"></p>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è´ªå¿ƒç®—æ³•</title>
      <link href="/2020/03/25/Algorithm/greedy_algorithm/"/>
      <url>/2020/03/25/Algorithm/greedy_algorithm/</url>
      
        <content type="html"><![CDATA[<h1 id="è´ªå¿ƒç®—æ³•"><a href="#è´ªå¿ƒç®—æ³•" class="headerlink" title="è´ªå¿ƒç®—æ³•"></a>è´ªå¿ƒç®—æ³•</h1><blockquote><p>è¿™æ˜¯ç¯‡å¾ˆè€çš„åšå®¢äº†ï¼Œæ˜¯æˆ‘åˆšå­¦è´ªå¿ƒçš„æ—¶å€™å†™çš„ç¬”è®°ã€‚ä»Šå¤©æ— æ„é—´ç¿»åˆ°ï¼Œå°±åˆ†äº«ä¸€ä¸‹ã€‚</p><p>å†…å®¹æ²¡å†™å¤šå°‘ï¼Œä¸»è¦æ˜¯çœ‹ä¾‹å­ï¼Œè¿™å‡ ä¸ªé¢˜éƒ½æ¯”è¾ƒç»å…¸ï¼Œéƒ½æ˜¯å½“æ—¶æˆ‘å‚è€ƒå¤§ä½¬çš„åšå®¢è‡ªå·±ç ”ç©¶äº†å†™çš„ï¼ˆéƒ½æ˜¯è¿è¡Œäº†æµ‹è¯•è¿‡çš„ï¼Œä½†æ—¶é—´é•¿äº†ï¼Œæˆ‘ä¸ä¿è¯éƒ½å¯¹ï¼‰ã€‚</p></blockquote><h3 id="ç®—æ³•æè¿°"><a href="#ç®—æ³•æè¿°" class="headerlink" title="ç®—æ³•æè¿°"></a>ç®—æ³•æè¿°</h3><p>è´ªå¿ƒé€‰æ‹©æ˜¯é‡‡ç”¨ä»é¡¶å‘ä¸‹ï¼ˆé—®é¢˜æ‹†åˆ†ï¼‰ã€ä»¥è¿­ä»£çš„æ–¹æ³•åšå‡ºç›¸ç»§é€‰æ‹©ï¼ˆå¾ªç¯å¤„ç†æ‹†åˆ†å‡ºçš„éƒ¨åˆ†ï¼‰ï¼Œæ¯åšä¸€æ¬¡è´ªå¿ƒé€‰æ‹©å°±å°†æ‰€æ±‚é—®é¢˜ç®€åŒ–ä¸ºä¸€ä¸ªè§„æ¨¡æ›´å°çš„å­é—®é¢˜ï¼ˆæ‰¾å‡ºè¿™ä¸ªéƒ¨åˆ†çš„è´ªå¿ƒæœ€ä¼˜è§£ï¼‰ã€‚</p><p>è´ªå¿ƒç®—æ³•è¿½æ±‚çš„ä¸æ˜¯é—®é¢˜æ•´ä½“ä¸Šçš„æœ€ä¼˜è§£ï¼Œåªæ˜¯è¿­ä»£æ‰¾åˆ°å„éƒ¨åˆ†è´ªå¿ƒè¾ƒä¼˜è§£ï¼ˆæœ€å…³æ³¨çš„é‚£ä¸€é¡¹ï¼‰ï¼Œå¹¶å°†å¾ªç¯ç»“æœä½œä¸ºè¾ƒä¸ºæ»¡æ„çš„è§£ï¼ˆè´ªå¿ƒç®—æ³•çš„æ¯ä¸€æ¬¡æ“ä½œéƒ½å¯¹ç»“æœäº§ç”Ÿç›´æ¥å½±å“ï¼‰ã€‚</p><p>æ‰¾åˆ°æœ€ä¼˜è§£è¦ç©·ä¸¾æ‰€æœ‰å¯èƒ½ï¼Œå› æ­¤ä¼šæ¶ˆè€—å¤§é‡æ—¶é—´ã€‚è€Œè´ªå¿ƒç®—æ³•å¸¸ä»¥æ¯ä¸€ä¸ªè¿­ä»£çš„æƒ…å†µä¸ºåŸºç¡€åšæœ€ä¼˜é€‰æ‹©ï¼Œè€Œä¸è€ƒè™‘æ•´ä½“æƒ…å†µï¼ˆè´ªå¿ƒç®—æ³•ä¸éœ€è¦å›æº¯ï¼‰ï¼Œå› æ­¤å¯ä»¥å¿«é€Ÿæ‰¾åˆ°è¾ƒä¼˜è§£ã€‚</p><h3 id="ç®—æ³•è¿‡ç¨‹"><a href="#ç®—æ³•è¿‡ç¨‹" class="headerlink" title="ç®—æ³•è¿‡ç¨‹"></a>ç®—æ³•è¿‡ç¨‹</h3><ul><li>å»ºç«‹æ•°å­¦æ¨¡å‹æ¥æè¿°é—®é¢˜ï¼›</li><li>æŠŠæ±‚è§£çš„é—®é¢˜åˆ†æˆè‹¥å¹²ä¸ªå­é—®é¢˜ï¼›</li><li>å¯¹æ¯ä¸€å­é—®é¢˜æ±‚è§£ï¼Œå¾—åˆ°å­é—®é¢˜çš„å±€éƒ¨æœ€ä¼˜è§£ï¼›</li><li>æŠŠå­é—®é¢˜çš„è§£å±€éƒ¨æœ€ä¼˜è§£åˆæˆåŸæ¥è§£é—®é¢˜çš„ä¸€ä¸ªè§£ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fat = é—®é¢˜</span><br><span class="line">sub = æ‹†åˆ†(fat)</span><br><span class="line"><span class="keyword">for</span> a_part <span class="keyword">in</span> sub:</span><br><span class="line">    res.append(è´ªå¿ƒæœ€ä¼˜è§£(a_part))</span><br><span class="line">    </span><br><span class="line">print(<span class="string">&quot;é—®é¢˜çš„è¾ƒä¼˜è§£&quot;</span>, res)</span><br></pre></td></tr></table></figure><h3 id="ç®—æ³•å®ä¾‹"><a href="#ç®—æ³•å®ä¾‹" class="headerlink" title="ç®—æ³•å®ä¾‹"></a>ç®—æ³•å®ä¾‹</h3><ol><li>èƒŒåŒ…é—®é¢˜</li></ol><p><em>æœ‰ä¸€ä¸ªèƒŒåŒ…ï¼ŒèƒŒåŒ…å®¹é‡æ˜¯M=150kgã€‚æœ‰å‡ ä¸ªç‰©å“ï¼Œã€‚è¦æ±‚å°½å¯èƒ½è®©è£…å…¥èƒŒåŒ…ä¸­çš„ç‰©å“æ€»ä»·å€¼æœ€å¤§ï¼Œä½†ä¸èƒ½è¶…è¿‡æ€»å®¹é‡ã€‚</em></p><pre><code>ï¼ˆ1ï¼‰ç‰©å“**ä¸å¯ä»¥**åˆ†å‰²æˆä»»æ„å¤§å°</code></pre><p>è¿™é‡Œä»¥ç‰©ä½“çš„ä»·å€¼ä¸è´¨é‡æ¯”ä½œä¸ºæ ‡å‡†ï¼Œæ¯æ¬¡è¿­ä»£éƒ½æ‰¾æ¯”å€¼è¾ƒä¼˜çš„ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//coding : c++ 11</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX 7</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WEIGHT_OF_BAG 150</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line"><span class="keyword">char</span> id;</span><br><span class="line"><span class="keyword">double</span> weight;</span><br><span class="line"><span class="keyword">double</span> value;</span><br><span class="line"><span class="keyword">double</span> value_pre_weight;</span><br><span class="line"><span class="keyword">bool</span> chosen;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Node arr[MAX];</span><br><span class="line"></span><br><span class="line"><span class="keyword">double</span> weights[MAX] = &#123;<span class="number">35</span>, <span class="number">30</span>, <span class="number">60</span>, <span class="number">50</span>, <span class="number">40</span>, <span class="number">15</span>, <span class="number">20</span>&#125;;</span><br><span class="line"><span class="keyword">double</span> values[MAX]  = &#123;<span class="number">10</span>, <span class="number">40</span>, <span class="number">30</span>, <span class="number">50</span>, <span class="number">35</span>, <span class="number">40</span>, <span class="number">30</span>&#125;;</span><br><span class="line">        <span class="comment">/*æ‹†åˆ†é—®é¢˜*/</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAX; ++i) &#123;</span><br><span class="line">arr[i].id = i;</span><br><span class="line">arr[i].weight = weights[i];</span><br><span class="line">arr[i].value = values[i];</span><br><span class="line">arr[i].value_pre_weight = values[i]/weights[i];</span><br><span class="line">arr[i].chosen = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*å¯»æ±‚éƒ¨åˆ†è´ªå¿ƒæœ€ä¼˜è§£*/</span></span><br><span class="line"><span class="keyword">double</span> total_weight = <span class="number">0</span>, total_value = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">vector</span>&lt;Node&gt; chosen_list;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (total_weight &lt; WEIGHT_OF_BAG) &#123;</span><br><span class="line"><span class="keyword">double</span> greatest = <span class="number">0.0</span>;</span><br><span class="line"><span class="keyword">int</span> choice = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MAX; ++i) &#123;</span><br><span class="line"><span class="keyword">if</span> (arr[i].chosen == <span class="literal">false</span> &amp;&amp; total_weight + arr[i].weight &lt;= <span class="number">150</span> &amp;&amp; arr[i].value_pre_weight &gt;= greatest) &#123;</span><br><span class="line">greatest = arr[i].value_pre_weight;</span><br><span class="line">choice = i;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">arr[choice].chosen = <span class="literal">true</span>;</span><br><span class="line">chosen_list.push_back(arr[choice]);</span><br><span class="line">total_weight += arr[choice].weight;</span><br><span class="line">total_value += arr[choice].value;</span><br><span class="line">greatest = arr[choice].value_pre_weight;</span><br><span class="line">&#125;</span><br><span class="line">        <span class="comment">/*å°†ç»“æœå¾ªç¯ä½œä¸ºé—®é¢˜çš„è¾ƒä¼˜è§£*/</span></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Chosen:\n&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> item : chosen_list)</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;\tThe &quot;</span> &lt;&lt; <span class="keyword">int</span>(item.id) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">cout</span>&lt;&lt; <span class="string">&quot;Total weight:\t&quot;</span> &lt;&lt; total_weight</span><br><span class="line">&lt;&lt; <span class="string">&quot;\nTotal value:\t&quot;</span> &lt;&lt; total_value</span><br><span class="line">&lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>   (2)ç‰©å“<strong>å¯ä»¥</strong>åˆ†å‰²æˆä»»æ„å¤§å°<br>   è¿™é‡Œä»¥ç‰©ä½“è´¨é‡ä¸ºæ ‡å‡†<br>   <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">   <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bag</span><span class="params">(<span class="keyword">double</span> m, <span class="keyword">double</span> *v, <span class="keyword">double</span> *w, <span class="keyword">double</span> *x)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">double</span> maxWeight = <span class="number">50</span>;</span><br><span class="line"><span class="keyword">double</span> wts[] = &#123; <span class="number">10</span>,  <span class="number">30</span>,  <span class="number">20</span>,  <span class="number">5</span>&#125;;</span><br><span class="line"><span class="keyword">double</span> vls[] = &#123;<span class="number">200</span>, <span class="number">400</span>, <span class="number">100</span>, <span class="number">10</span>&#125;;</span><br><span class="line"><span class="keyword">double</span> res[N] = &#123;<span class="number">0</span>&#125;;<span class="comment">// è®°å½•è£…ç‰©å“çš„æ¯”ä¾‹</span></span><br><span class="line"></span><br><span class="line">bag(maxWeight, vls, wts, res);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; ++i)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;--[%d]: %lf\n&quot;</span>, i, res[i]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* å¯»æ‰¾è´ªå¿ƒæœ€ä¼˜è§£*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bag</span><span class="params">(<span class="keyword">double</span> m, <span class="keyword">double</span> *v, <span class="keyword">double</span> *w, <span class="keyword">double</span> *x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line"><span class="keyword">if</span> (m - w[i] &lt; <span class="number">0</span>)</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">x[i] = <span class="number">1.0</span>;</span><br><span class="line">m -= w[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (i &lt; N)</span><br><span class="line">x[i] = m/w[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>2. æ¢é›¶é’±é—®é¢˜<br>å‡è®¾1å…ƒã€2å…ƒã€5å…ƒã€10å…ƒã€20å…ƒã€50å…ƒã€100å…ƒçš„çº¸å¸åˆ†åˆ«æœ‰c0, c1, c2, c3, c4, c5, c6å¼ ã€‚ç°åœ¨è¦ç”¨è¿™äº›é’±æ¥æ”¯ä»˜Kå…ƒï¼Œè‡³å°‘è¦ç”¨å¤šå°‘å¼ çº¸å¸ï¼Ÿç”¨è´ªå¿ƒç®—æ³•çš„æ€æƒ³ï¼Œå¾ˆæ˜¾ç„¶ï¼Œæ¯ä¸€æ­¥å°½å¯èƒ½ç”¨é¢å€¼å¤§çš„çº¸å¸å³å¯ã€‚åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­æˆ‘ä»¬è‡ªç„¶è€Œç„¶ä¹Ÿæ˜¯è¿™ä¹ˆåšçš„ã€‚åœ¨ç¨‹åºä¸­å·²ç»äº‹å…ˆå°†ValueæŒ‰ç…§ä»å°åˆ°å¤§çš„é¡ºåºæ’å¥½ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Chosen</span> &#123;</span></span><br><span class="line"><span class="keyword">int</span> value;</span><br><span class="line"><span class="keyword">int</span> count;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> Count[N] = &#123;<span class="number">3</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> Value[N] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">50</span>, <span class="number">100</span>&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;Chosen&gt; got;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> money)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = N - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line"><span class="keyword">int</span> c = min(money/Value[i], Count[i]);</span><br><span class="line">money = money - c * Value[i];</span><br><span class="line">num += c;</span><br><span class="line"></span><br><span class="line">Chosen temp;</span><br><span class="line">temp.value = Value[i];</span><br><span class="line">temp.count = c;</span><br><span class="line">got.push_back(temp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (money &gt; <span class="number">0</span>)</span><br><span class="line">num = <span class="number">-1</span>;</span><br><span class="line"><span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> money;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Enter money: &quot;</span>;</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; money;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> res = solve(money);</span><br><span class="line"><span class="keyword">if</span> (res != <span class="number">-1</span>) &#123;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;\nå…±&quot;</span>&lt;&lt; res &lt;&lt; <span class="string">&quot; å¼ ã€‚&quot;</span>&lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> i : got)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%2dä¸ª%2då…ƒ\t&quot;</span>, i.count, i.value);</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;\nCan&#x27;t solve!&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="3"><li>æ´»åŠ¨å®‰æ’<br>æœ‰nä¸ªéœ€è¦åœ¨åŒä¸€å¤©ä½¿ç”¨åŒä¸€ä¸ªæ•™å®¤çš„æ´»åŠ¨a1,a2,â€¦,anï¼Œæ•™å®¤åŒä¸€æ—¶åˆ»åªèƒ½ç”±ä¸€ä¸ªæ´»åŠ¨ä½¿ç”¨ã€‚æ¯ä¸ªæ´»åŠ¨aiéƒ½æœ‰ä¸€ä¸ªå¼€å§‹æ—¶é—´siå’Œç»“æŸæ—¶é—´fi ã€‚ä¸€æ—¦è¢«é€‰æ‹©åï¼Œæ´»åŠ¨aiå°±å æ®åŠå¼€æ—¶é—´åŒºé—´[si,fi)ã€‚å¦‚æœ[si,fi]å’Œ[sj,fj]äº’ä¸é‡å ï¼Œaiå’Œajä¸¤ä¸ªæ´»åŠ¨å°±å¯ä»¥è¢«å®‰æ’åœ¨è¿™ä¸€å¤©ã€‚è¯¥é—®é¢˜å°±æ˜¯è¦å®‰æ’è¿™äº›æ´»åŠ¨ä½¿å¾—å°½é‡å¤šçš„æ´»åŠ¨èƒ½ä¸å†²çªçš„ä¸¾è¡Œã€‚ä¾‹å¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ´»åŠ¨é›†åˆSï¼Œå…¶ä¸­å„é¡¹æ´»åŠ¨æŒ‰ç…§ç»“æŸæ—¶é—´å•è°ƒé€’å¢æ’åºã€‚</li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd68gim7rwj30x808w0z0.jpg" alt="å±å¹•å¿«ç…§ 2020-03-25 16.02.45"></p><p>è´ªå¿ƒç­–ç•¥åº”è¯¥æ˜¯æ¯æ¬¡é€‰å–ç»“æŸæ—¶é—´æœ€æ—©çš„æ´»åŠ¨ã€‚ç›´è§‚ä¸Šä¹Ÿå¾ˆå¥½ç†è§£ï¼ŒæŒ‰è¿™ç§æ–¹æ³•é€‰æ‹©ç›¸å®¹æ´»åŠ¨ä¸ºæœªå®‰æ’æ´»åŠ¨ç•™ä¸‹å°½å¯èƒ½å¤šçš„æ—¶é—´ã€‚è¿™ä¹Ÿæ˜¯æŠŠå„é¡¹æ´»åŠ¨æŒ‰ç…§ç»“æŸæ—¶é—´å•è°ƒé€’å¢æ’åºçš„åŸå› ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> N;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Action</span> &#123;</span></span><br><span class="line"><span class="keyword">int</span> start;</span><br><span class="line"><span class="keyword">int</span> end;</span><br><span class="line">&#125; act[<span class="number">100</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(struct Action a, struct Action b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a.end &lt; b.end;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">greedy</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> num = <span class="number">0</span>, i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= N; j++) &#123;</span><br><span class="line"><span class="keyword">if</span> (act[j].start &gt;= act[i].end) &#123;</span><br><span class="line">i = j;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;\t%2d : From %2d To %2d\n&quot;</span>, i, act[i].start, act[i].end);</span><br><span class="line">num++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> t;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;å‡ ç»„æµ‹è¯•æ•°æ®: &quot;</span>;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;t);</span><br><span class="line"><span class="keyword">while</span> (t--) &#123;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot; å…±å‡ ä¸ªæ´»åŠ¨: &quot;</span>;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;N);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++) &#123;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;æ´»åŠ¨&quot;</span> &lt;&lt; i &lt;&lt;<span class="string">&quot;çš„å§‹æœ«ï¼š&quot;</span>;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;act[i].start, &amp;act[i].end);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">act[<span class="number">0</span>].start = act[<span class="number">0</span>].end = <span class="number">-1</span>;</span><br><span class="line">sort(act + <span class="number">1</span>, act + N + <span class="number">1</span>, cmp);</span><br><span class="line"><span class="keyword">int</span> res = greedy();</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;å…±å¯å®‰æ’ï¼š&quot;</span>&lt;&lt; res &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>æœºå™¨å®‰æ’<br>nä¸ªä½œä¸šç»„æˆçš„ä½œä¸šé›†ï¼Œå¯ç”±må°ç›¸åŒæœºå™¨åŠ å·¥å¤„ç†ã€‚è¦æ±‚ç»™å‡ºä¸€ç§ä½œä¸šè°ƒåº¦æ–¹æ¡ˆï¼Œä½¿æ‰€ç»™çš„nä¸ªä½œä¸šåœ¨å°½å¯èƒ½çŸ­çš„æ—¶é—´å†…ç”±må°æœºå™¨åŠ å·¥å¤„ç†å®Œæˆã€‚ä½œä¸šä¸èƒ½æ‹†åˆ†æˆæ›´å°çš„å­ä½œä¸šï¼›æ¯ä¸ªä½œä¸šå‡å¯åœ¨ä»»ä½•ä¸€å°æœºå™¨ä¸ŠåŠ å·¥å¤„ç†ã€‚</li></ol><p>é¦–å…ˆå°†nä¸ªä½œä¸šä»å¤§åˆ°å°æ’åºï¼Œç„¶åä¾æ­¤é¡ºåºå°†ä½œä¸šåˆ†é…ç»™ç©ºé—²çš„å¤„ç†æœºã€‚ä¹Ÿå°±æ˜¯è¯´ä»å‰©ä¸‹çš„ä½œä¸šä¸­ï¼Œé€‰æ‹©éœ€è¦å¤„ç†æ—¶é—´æœ€é•¿çš„ï¼Œç„¶åä¾æ¬¡é€‰æ‹©å¤„ç†æ—¶é—´æ¬¡é•¿çš„ï¼Œç›´åˆ°æ‰€æœ‰çš„ä½œä¸šå…¨éƒ¨å¤„ç†å®Œæ¯•ï¼Œæˆ–è€…æœºå™¨ä¸èƒ½å†å¤„ç†å…¶ä»–ä½œä¸šä¸ºæ­¢ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> Work = <span class="keyword">int</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> m=<span class="number">0</span>, n=<span class="number">0</span>;</span><br><span class="line"><span class="built_in">vector</span>&lt;Work&gt; arr;</span><br><span class="line"></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;machines: &quot;</span>;</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; m;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Works: &quot;</span>;</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">vector</span>&lt;Work&gt; <span class="title">mch</span><span class="params">(m, <span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">Work temp;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;[%d].length: &quot;</span>, i);</span><br><span class="line"><span class="built_in">cin</span> &gt;&gt; temp;</span><br><span class="line">arr.push_back(temp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;-----\n&quot;</span>;</span><br><span class="line">sort(arr.begin(), arr.end(), [](<span class="keyword">auto</span> x,<span class="keyword">auto</span> y)&#123;<span class="keyword">return</span> x &gt; y;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ) &#123;</span><br><span class="line"><span class="keyword">int</span> flag = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span>(flag) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; ++j) &#123;<span class="comment">// Check each machine</span></span><br><span class="line"><span class="keyword">if</span> (mch[j] &lt;= <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Use (%d) to process [length_%d];\n&quot;</span>, j, arr[i]);</span><br><span class="line">mch[j] = arr[i];</span><br><span class="line">i++;</span><br><span class="line">flag = <span class="number">0</span>;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> &amp;p : mch)</span><br><span class="line">p--;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Algorithm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode P20 æœ‰æ•ˆçš„æ‹¬å·</title>
      <link href="/2020/03/24/School/Leetcode_P20_valid-parentheses/"/>
      <url>/2020/03/24/School/Leetcode_P20_valid-parentheses/</url>
      
        <content type="html"><![CDATA[<h1 id="Leetcode-20-æœ‰æ•ˆçš„æ‹¬å·"><a href="#Leetcode-20-æœ‰æ•ˆçš„æ‹¬å·" class="headerlink" title="Leetcode 20. æœ‰æ•ˆçš„æ‹¬å·"></a>Leetcode <a href="https://leetcode-cn.com/problems/valid-parentheses/">20. æœ‰æ•ˆçš„æ‹¬å·</a></h1><p>ç»™å®šä¸€ä¸ªåªåŒ…æ‹¬ <code>&#39;(&#39;</code>ï¼Œ<code>&#39;)&#39;</code>ï¼Œ<code>&#39;&#123;&#39;</code>ï¼Œ<code>&#39;&#125;&#39;</code>ï¼Œ<code>&#39;[&#39;</code>ï¼Œ<code>&#39;]&#39;</code> çš„å­—ç¬¦ä¸²ï¼Œåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æœ‰æ•ˆã€‚</p><p>æœ‰æ•ˆå­—ç¬¦ä¸²éœ€æ»¡è¶³ï¼š</p><ol><li>å·¦æ‹¬å·å¿…é¡»ç”¨ç›¸åŒç±»å‹çš„å³æ‹¬å·é—­åˆã€‚</li><li>å·¦æ‹¬å·å¿…é¡»ä»¥æ­£ç¡®çš„é¡ºåºé—­åˆã€‚</li></ol><p>æ³¨æ„ç©ºå­—ç¬¦ä¸²å¯è¢«è®¤ä¸ºæ˜¯æœ‰æ•ˆå­—ç¬¦ä¸²ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: &quot;()&quot;</span><br><span class="line">è¾“å‡º: true</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: &quot;()[]&#123;&#125;&quot;</span><br><span class="line">è¾“å‡º: true</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: &quot;(]&quot;</span><br><span class="line">è¾“å‡º: false</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 4:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: &quot;([)]&quot;</span><br><span class="line">è¾“å‡º: false</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 5:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: &quot;&#123;[]&#125;&quot;</span><br><span class="line">è¾“å‡º: true</span><br></pre></td></tr></table></figure><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>æ‹¬å·ä¸åŒ¹é…çš„æƒ…å†µå¾ˆå¤šï¼Œä½†åŒ¹é…çš„æƒ…å†µå°±3ç§ï¼š<code>()</code>ï¼Œ<code>[]</code>ï¼Œ<code>&#123;&#125;</code>ã€‚</p><p>ä»¥å‰åˆšå­¦ç®—æ³•çš„æ—¶å€™çœ‹è¿‡ä¸€ä¸ªå¤§ä½¬å†™çš„æš´åŠ›è§£æ³•ï¼Œä»–æŠŠä¸åŒ¹é…çš„æƒ…å†µçš„æƒ…å†µç©·ä¸¾å‡ºæ¥äº†ï¼ä»–é‚£ä¸ªè·‘çš„é£å¿«ï¼Œä½†å·¨å¤æ‚ã€‚</p><p>æˆ‘è„‘å­æ²¡é‚£ä¹ˆå¥½ï¼Œå†™ä¸å‡ºä»–é‚£ä¸ªæ¥ã€‚æ‰€ä»¥æˆ‘é€‰æ‹©è€è€å®å®ç”¨æ ˆã€‚æˆ‘çš„æ€è·¯å¾ˆç›´æ¥ï¼Œé‡åˆ°å‰æ‹¬å·å°±å…¥æ ˆï¼Œé‡åˆ°åæ‹¬å·å°±å‡ºæ ˆã€‚å¦‚æœæ¯ä¸€æ­¥éƒ½åŒ¹é…ï¼Œä¸”æœ€åæ ˆä¸ºç©ºï¼Œå°±åŒ¹é…æˆåŠŸã€‚è¿™ä¸ªæ€è·¯å’Œäººå»åˆ¤æ–­æ˜¯ä¸€è‡´çš„ã€‚</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isValid</span>(<span class="params">self, s: <span class="built_in">str</span></span>) -&gt; bool:</span></span><br><span class="line">        match = &#123;<span class="string">&#x27;)&#x27;</span>: <span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;]&#x27;</span>: <span class="string">&#x27;[&#x27;</span>, <span class="string">&#x27;&#125;&#x27;</span>: <span class="string">&#x27;&#123;&#x27;</span>&#125;</span><br><span class="line">        stack = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">            <span class="keyword">if</span> i <span class="keyword">in</span> match.values():</span><br><span class="line">                stack.append(i)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(stack) == <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">                front = stack.pop()</span><br><span class="line">                <span class="keyword">if</span> match.get(i) != front:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">len</span>(stack) == <span class="number">0</span>)</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd4p1lylnsj31r90u0dk8.jpg" alt="image-20200324080539922"></p><p>å…¶å®è¿™ä»£ç æ˜¯æˆ‘ä»¥å‰åˆšå­¦çš„æ—¶å€™å†™çš„äº†ï¼Œæ‰€ä»¥å¾ˆæ…¢ã€‚ã€‚ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PythonåŸºç¡€æ‰‹å†ŒP1 å¯åŠ¨ã€æ³¨é‡Šå’Œè¿ç®—ç¬¦</title>
      <link href="/2020/03/23/python_booklet/Python%E5%9F%BA%E7%A1%80%E6%89%8B%E5%86%8CP1%20%E5%90%AF%E5%8A%A8%E3%80%81%E6%B3%A8%E9%87%8A%E5%92%8C%E8%BF%90%E7%AE%97%E7%AC%A6/"/>
      <url>/2020/03/23/python_booklet/Python%E5%9F%BA%E7%A1%80%E6%89%8B%E5%86%8CP1%20%E5%90%AF%E5%8A%A8%E3%80%81%E6%B3%A8%E9%87%8A%E5%92%8C%E8%BF%90%E7%AE%97%E7%AC%A6/</url>
      
        <content type="html"><![CDATA[<h1 id="PythonåŸºç¡€æ‰‹å†ŒP1-å¯åŠ¨ã€æ³¨é‡Šå’Œè¿ç®—ç¬¦"><a href="#PythonåŸºç¡€æ‰‹å†ŒP1-å¯åŠ¨ã€æ³¨é‡Šå’Œè¿ç®—ç¬¦" class="headerlink" title="PythonåŸºç¡€æ‰‹å†ŒP1 å¯åŠ¨ã€æ³¨é‡Šå’Œè¿ç®—ç¬¦"></a>PythonåŸºç¡€æ‰‹å†ŒP1 å¯åŠ¨ã€æ³¨é‡Šå’Œè¿ç®—ç¬¦</h1><p>[TOC]</p><h2 id="å¼€å§‹ä¹‹å‰"><a href="#å¼€å§‹ä¹‹å‰" class="headerlink" title="å¼€å§‹ä¹‹å‰"></a>å¼€å§‹ä¹‹å‰</h2><p>æˆ‘å¾ˆé•¿æ—¶é—´ä¹‹å‰å°±æ‰“ç®—å†™ä¸€ä¸ªç³»åˆ—çš„æ–‡ç« ï¼Œä»¥ä¸€ä¸ªéåˆå­¦è€…çš„è§†è§’è®¨è®º Python åŸºç¡€ã€‚</p><p>ä»å…¥é—¨åˆ°è¿›é˜¶çš„åˆå­¦è€…æŒ‡å—å¾ˆå¤šï¼Œæœ‰çš„å†™çš„ä¹Ÿç›¸å½“å‡ºè‰²ï¼Œæ¯”å¦‚æˆ‘è‡ªå·±å…¥é—¨å­¦ä¹ çš„å»–é›ªå³°è€å¸ˆçš„Pythonæ•™ç¨‹ã€‚è¯´å®è¯ï¼Œè¦åœ¨è¿™äº›å…¥é—¨æ•™ç¨‹ä¸­å†æ·»ä¸€ç¬”ï¼Œä¸æ˜¯ä»¶å®¹æ˜“çš„äº‹ï¼Œæˆ‘ä¹Ÿæ— å¿ƒç ”ç©¶ç¼–ç¨‹å…¥é—¨æ•™å­¦ã€‚</p><p>æˆ‘å¸Œæœ›çš„æ˜¯ï¼Œæ•´ç†ä¸€ä¸‹ Python åŸºç¡€ï¼Œå¹¶å°‘é‡å¯¹ç…§æºç ï¼Œé€šè¿‡è‡ªå·±çš„ç ”ç©¶å†™ä¸€äº›ä¸œè¥¿ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¤¯å®åŸºç¡€ï¼Œæå‡æŠ€èƒ½ã€‚</p><p>è¿™ä¸ªç³»åˆ—æš‚å®šåä¸ºã€ŠPythonåŸºç¡€æ‰‹å†Œã€‹ã€‚è¿™æ›´åƒæ˜¯ä¸€æœ¬ç»™è‡ªå·±çš„ Python æ“ä½œæ‰‹å†Œï¼Œä¸€æœ¬ My version çš„ Python Cookbookã€‚</p><p>çœ‹çœ‹åŸºç¡€ï¼Œå†™å†™å®ä¾‹ï¼Œè¯»è¯»æºç ï¼Œå†ä½œæˆç¬”è®°ï¼Œå¸Œæœ›åŠ©æ›´å¤šå­¦ä¹  Python çš„æœ‹å‹ä¸€è‡‚ä¹‹åŠ›ã€‚</p><hr><p>æ—¢ç„¶ä¸æ˜¯é¢å‘åˆå­¦è€…ï¼Œé‚£å°±éœ€è¦è¯»è€…æœ‰ä¸€å®šçš„åŸºç¡€ã€‚æ¯”å¦‚ï¼Œåœ¨é˜…è¯»æœ¬æ–‡å‰ï¼Œæ‚¨åº”è¯¥æ‡‚å¾—å‘½ä»¤è¡Œçš„ä½¿ç”¨ï¼Œå¦‚æœè¿™æ–¹é¢çš„çŸ¥è¯†æ‚¨æœ‰æ‰€æ¬ ç¼ºï¼Œæˆ‘æ¨èå­¦ä¹  Zed A. Shaw çš„ã€Šå‘½ä»¤è¡Œå¿«é€Ÿå…¥é—¨ã€‹ï¼ˆæ‚¨å¯ä»¥åœ¨ <a href="https://learnpythonthehardway.org/book/appendixa.html">Zed A. Shaw çš„ç½‘ç«™</a> ä¸Šé˜…è¯»è¿™ä¸€å†…å®¹ï¼‰ã€‚</p><p>ï¼ˆä½ å¤§å¯ä¸çœ‹ã€‚æˆ‘å°è¯•è¿‡å¾ˆå¤šåŠæ³•åŠ›èèº«è¾¹çš„æœ‹å‹ï¼ˆé‚£äº›æƒ¯ç”¨Windowsçš„æœ‹å‹ï¼‰ä½¿ç”¨å‘½ä»¤è¡Œï¼Œä½†éƒ½åŸºæœ¬æ— æ•ˆã€‚æˆ‘ç°åœ¨ä¸æƒ³å†åšè¿™ä»¶äº‹äº†ï¼Œæ—¢ç„¶æœ‰äººå¯ä»¥å¿å—ä¸ä¼šä½¿ç”¨å‘½ä»¤è¡Œè€Œå¸¦æ¥çš„ä¸ä¾¿ï¼Œé‚£æˆ‘ä¹Ÿä¸å¥½è¯´ä»€ä¹ˆã€‚æ¯•ç«Ÿï¼Œæˆ‘ä¼šä½¿ç”¨å‘½ä»¤è¡Œï¼Œç”¨çš„ä¸å¥½ï¼Œä½†è¶³å¤Ÿåº”ä»˜æˆ‘é‡åˆ°çš„é—®é¢˜ï¼Œè€Œä½ ä¸ä¼šå‘½ä»¤è¡Œï¼Œéº»çƒ¦çš„ä¸æ˜¯æˆ‘ã€‚åœ¨äº«å—å‘½ä»¤è¡Œçš„å¼ºå¤§çš„åŒæ—¶ï¼Œå†·çœ¼å˜²è®½é‚£äº›çœ‹ç€è§†çª—ï¼Œå¯¹äºâ€œä»ç‰¹å®šæ–‡ä»¶ä¸­æå–ç‰¹å®šçš„å­—æ®µæ¥æ‰¹é‡é‡å‘½åæ•°ç™¾ä¸ªæ–‡ä»¶â€è¿™æ ·çš„ç®€å•å…¥é—¨çº§å‘½ä»¤è¡Œä»»åŠ¡æ— ä»ä¸‹æ‰‹ã€åªå¥½å¼€å§‹ç™¾åº¦â€œä¸€é”®æ‰¹é‡é‡å‘½åç¥å™¨.exeä¸‹è½½â€çš„å…¸å‹***ä¹Ÿæ˜¯ä¸€ä»¶ä»¤äººæ„‰æ‚¦çš„äº‹ï¼‰</p><p>å“ˆå“ˆï¼Œè¨€é‡äº†ï¼Œå…¶å® Python ä¹Ÿå¯ä»¥ç›¸å½“ä¼˜é›…çš„å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼Œæœ‰æœºä¼šçš„è¯ï¼Œæˆ‘ä¼šåœ¨ä»¥åçš„æ–‡ç« ä¸­ä»‹ç»å¦‚ä½•ç”¨ Python è§£å†³è¿™äº›çäº‹ã€‚ä½†è¿™éœ€è¦æˆ‘ä»¬ç°åœ¨å…ˆæ¥çœ‹ä¸€çœ‹ Python åˆ°åº•æ€ä¹ˆç”¨ğŸ‘‡ğŸ‘‡ğŸ‘‡</p><h2 id="Pythonè§£é‡Šå™¨"><a href="#Pythonè§£é‡Šå™¨" class="headerlink" title="Pythonè§£é‡Šå™¨"></a>Pythonè§£é‡Šå™¨</h2><p>ä½ çŸ¥é“ Python æ˜¯è§£é‡Šå‹è¯­è¨€å•¦ï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ªå« Python è§£é‡Šå™¨çš„ä¸œè¥¿å•¦ã€‚æˆ‘ä»¬å†™çš„ Python ä»£ç å°±æ˜¯é€šè¿‡è§£é‡Šå™¨è¿è¡Œèµ·æ¥çš„ã€‚</p><p>åºŸè¯ä¸å¤šè¯´ï¼Œæ¥çœ‹è¿™è§£é‡Šå™¨çš„ç”¨æ³•ï¼š</p><h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><ul><li><code>$ python</code>: è¿›å…¥äº¤äº’å¼ç¯å¢ƒã€‚</li><li><code>$ python -</code>: è„šæœ¬åæŒ‡å®šä¸º â€˜-â€˜ ï¼ˆè¡¨ç¤ºæ ‡å‡†è¾“å…¥ï¼‰ï¼Œä¸<code>$ python</code>ç­‰æ•ˆã€‚</li><li><code>$ python -c command [arg] ...</code>: åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ Python è¯­å¥ï¼Œç±»ä¼¼äº shell ä¸­çš„ -c é€‰é¡¹ã€‚ç”¨â€™å•å¼•å·â€™åŒ…è£¹commandï¼Œå…¶ä¸­å†™pythonè¯­å¥ï¼Œç±»ä¼¼äºawkã€‚</li><li><code>$ python -m module [arg] ...</code>: æœ‰ä¸€äº› Python æ¨¡å—ä¹Ÿå¯ä»¥å½“ä½œè„šæœ¬ä½¿ç”¨ã€‚è¿™ç±»ä¼¼åœ¨å‘½ä»¤è¡Œä¸­é”®å…¥å®Œæ•´çš„è·¯å¾„åæ‰§è¡Œæ¨¡å—æºæ–‡ä»¶ä¸€æ ·ã€‚</li><li><code>$ python filename</code>: æ‰§è¡Œpythonæºæ–‡ä»¶ã€‚</li><li><code>$ python -i filename</code>: æ‰§è¡Œpythonæºæ–‡ä»¶ï¼Œç„¶åä¸é€€å‡ºï¼Œç•™åœ¨pythonäº¤äº’å¼å‘½ä»¤è¡Œã€‚</li></ul><h3 id="é€€å‡º"><a href="#é€€å‡º" class="headerlink" title="é€€å‡º"></a>é€€å‡º</h3><ul><li>è¾“å…¥ä¸€ä¸ªæ–‡ä»¶ç»“æŸç¬¦ï¼ˆUnix ç³»ç»Ÿæ˜¯ <code>Control-D</code>ï¼ŒWindows ç³»ç»Ÿæ˜¯ <code>Control-Z</code>ï¼‰è®©è§£é‡Šå™¨ä»¥ 0 çŠ¶æ€ç é€€å‡ºã€‚</li><li>è¾“å…¥ <code>quit()</code> å‘½ä»¤é€€å‡ºè§£é‡Šå™¨ã€‚</li><li>è¾“å…¥ <code>exit()</code> å‘½ä»¤é€€å‡ºè§£é‡Šå™¨ã€‚</li></ul><h3 id="å‘½ä»¤è¡Œå‚æ•°ä¼ é€’"><a href="#å‘½ä»¤è¡Œå‚æ•°ä¼ é€’" class="headerlink" title="å‘½ä»¤è¡Œå‚æ•°ä¼ é€’"></a>å‘½ä»¤è¡Œå‚æ•°ä¼ é€’</h3><p>è°ƒç”¨è§£é‡Šå™¨æ—¶ï¼Œè„šæœ¬åå’Œé™„åŠ å‚æ•°ä¼ å…¥ä¸€ä¸ªåä¸º <code>sys.argv</code> çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œè¿™ç±»ä¼¼äºCè¯­è¨€mainå‡½æ•°çš„ <code>char *argv[]</code>ã€‚</p><p>å–ç”¨ <code>sys.argv</code> å‰è¦ <code>import sys</code>ã€‚</p><p>å…³äº argv çš„è¡Œä¸ºï¼Œæˆ‘ä»¬å€Ÿç”¨C/C++çš„ switch-case è¯­å¥çš„å½¢å¼æ¥è®¨è®ºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (è¾“å…¥å‘½ä»¤) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;$ python&quot;</span>: </span><br><span class="line">        <span class="comment">// sys.argv æœ‰ä¸€ä¸ªå…ƒç´ ï¼šsys.argv[0] æ­¤æ—¶ä¸ºç©ºå­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;$ python -&quot;</span>:</span><br><span class="line">        <span class="comment">// sys.argv[0] è¢«è®¾å®šä¸º &#x27;-&#x27;</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;$ python -c command [arg] ...&quot;</span>:</span><br><span class="line">        <span class="comment">// sys.argv[0] è¢«è®¾å®šä¸º &#x27;-c&#x27;</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;$ python -m module [arg] ...&quot;</span>:</span><br><span class="line">        <span class="comment">// sys.argv[0] è¢«è®¾å®šä¸ºæŒ‡å®šæ¨¡å—çš„å…¨å</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">æ³¨æ„C/C++çš„è¿™ä¸ªè¯­å¥switchåé¢æ‹¬å·å†…çš„â€œè¡¨è¾¾å¼â€å¿…é¡»æ˜¯æ•´æ•°ç±»å‹ï¼</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>âš ï¸ã€æ³¨æ„ã€‘ï¼š<code>-c</code> æŒ‡ä»¤ æˆ–è€… <code>-m</code> æ¨¡å— ä¹‹åçš„å‚æ•°ä¸ä¼šè¢« Python è§£é‡Šå™¨çš„é€‰é¡¹å¤„ç†æœºåˆ¶æ‰€æˆªè·ï¼Œè€Œæ˜¯ç•™åœ¨ <code>sys.argv</code> ä¸­ï¼Œä¾›è„šæœ¬å‘½ä»¤æ“ä½œã€‚<br>ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ python3 -i -c &#39;import sys&#39; 1 2 3</span><br><span class="line">&gt;&gt;&gt; sys.argv</span><br><span class="line">[&#39;-c&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;]</span><br></pre></td></tr></table></figure><h3 id="æŒ‡å®šæºç¨‹åºç¼–ç "><a href="#æŒ‡å®šæºç¨‹åºç¼–ç " class="headerlink" title="æŒ‡å®šæºç¨‹åºç¼–ç "></a>æŒ‡å®šæºç¨‹åºç¼–ç </h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒPython æºæ–‡ä»¶æ˜¯ UTF-8 ç¼–ç ã€‚<br>åœ¨ <code>#!</code> è¡Œï¼ˆé¦–è¡Œï¼‰åæ’å…¥è‡³å°‘ä¸€è¡Œç‰¹æ®Šçš„æ³¨é‡Šè¡Œæ¥å®šä¹‰æºæ–‡ä»¶çš„ç¼–ç :</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: encoding -*-</span><br></pre></td></tr></table></figure><p><a href="https://docs.python.org/3/library/codecs.html#module-codecs">å¯ç”¨çš„ encoding åˆ—è¡¨</a></p><p>âš ï¸ã€æ³¨æ„ã€‘å¦‚æœä½¿ç”¨ Microsoft Windows è‡ªå¸¦çš„ è®°äº‹æœ¬ï¼ˆâ€˜Notepadâ€™ï¼‰è¿›è¡Œ python æºç çš„ç¼–è¾‘ï¼Œæ³¨æ„ä½¿ç”¨ <code>utf-8 without BOM</code> ç¼–ç ï¼</p><h2 id="Pythonæ³¨é‡Š"><a href="#Pythonæ³¨é‡Š" class="headerlink" title="Pythonæ³¨é‡Š"></a>Pythonæ³¨é‡Š</h2><p>æ²¡æœ‰äººä¼šå¦è®¤æ³¨é‡Šçš„é‡è¦æ€§ã€‚åœ¨å¼€å§‹è®¨è®ºå…¶ä»–è¯­æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬æœ‰å¿…è¦çœ‹ä¸€çœ‹æ³¨é‡Šæ€ä¹ˆå†™ã€‚</p><p>Python ä¸­çš„æ³¨é‡Šä»¥ <code>#</code> å­—ç¬¦èµ·å§‹ï¼Œç›´è‡³å®é™…çš„è¡Œå°¾(physical line, è¡¨ç¤ºå®é™…çš„æ¢è¡Œè€Œéç¼–è¾‘å™¨çš„è‡ªåŠ¨æ¢è¡Œ)ã€‚<br>æ³¨é‡Šå¯ä»¥ä»è¡Œé¦–å¼€å§‹ï¼Œä¹Ÿå¯ä»¥åœ¨ç©ºç™½æˆ–ä»£ç ä¹‹åï¼Œä½†æ˜¯ä¸å‡ºç°åœ¨å­—ç¬¦ä¸²ä¸­ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™æ˜¯ä¸€ä¸ªæ³¨é‡Š</span></span><br></pre></td></tr></table></figure><p>å†™æ–‡æ¡£æ³¨é‡Šçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸¸å€Ÿç”¨å¤šè¡Œå­—ç¬¦ä¸²ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">a</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;å‡½æ•°funcæ˜¯ç”¨æ¥å¹²ä»€ä¹ˆçš„</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    è¯¦ç»†è¡Œä¸ºæè¿°...</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">    a: å‚æ•°aæ˜¯ä»€ä¹ˆ</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">    è¿”å›å€¼æ˜¯ä»€ä¹ˆ</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cls</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;ç±»çš„æ€»ç»“</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    è¯¦ç»†è¡Œä¸ºæè¿°...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Attributes:</span></span><br><span class="line"><span class="string">        a: å±æ€§açš„è¯´æ˜</span></span><br><span class="line"><span class="string">        b: å±æ€§bçš„è¯´æ˜</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>ã€æ³¨ã€‘å…³äºæ–‡æ¡£æ³¨é‡Šï¼Œæˆ‘ä»¬ä¼šåœ¨æœ¬ç³»åˆ—åé¢çš„ã€Pythonä»£ç é£æ ¼ã€‘ä¸€æ–‡ä¸­è¯¦ç»†ä»‹ç»ã€‚</p><h2 id="PythonåŸºæœ¬è¿ç®—ç¬¦"><a href="#PythonåŸºæœ¬è¿ç®—ç¬¦" class="headerlink" title="PythonåŸºæœ¬è¿ç®—ç¬¦"></a>PythonåŸºæœ¬è¿ç®—ç¬¦</h2><p>è®¡ç®—æœºï¼Œå¦‚å…¶åï¼Œæ˜¯è®¡ç®—çš„å¥½æ‰‹ï¼æ—¢ç„¶ç¼–ç¨‹è¯­è¨€æ˜¯äººç±»å’Œè®¡ç®—æœºæ²Ÿé€šçš„è¯­è¨€ï¼Œé‚£è¿™äº›è¯­è¨€å°±åº”è¯¥å¯ä»¥æ–¹ä¾¿ç®€ä»‹åœ°è®©è®¡ç®—æœºç®—èµ·æ¥â€”â€”ä»åŠ å‡ä¹˜é™¤å¼€å§‹ã€‚Python çš„åŠ å‡ä¹˜é™¤è¿ç®—æˆ‘ä»¬éƒ½å¾ˆç†Ÿæ‚‰ï¼ŒåŸºæœ¬å°±æ˜¯æˆ‘ä»¬åœ¨å°å­¦æ•°å­¦ä¸­çœ‹åˆ°çš„é‚£äº›å†™æ³•ï¼š</p><table><thead><tr><th>è¿ç®—ç¬¦</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>+</code> ï¼Œ<code>-</code> ï¼Œ<code>*</code></td><td>ç”¨äº åŠ ã€å‡ã€ä¹˜ è¿ç®—</td></tr><tr><td><code>/</code></td><td>é™¤è¿ç®—ï¼Œè¿”å›ä¸€ä¸ªæµ®ç‚¹æ•°</td></tr><tr><td><code>//</code></td><td>é™¤è¿è¾“ï¼Œè¿”å›ç»“æœå–æ•´(<a href="https://zh.wikipedia.org/wiki/%E5%8F%96%E6%95%B4%E5%87%BD%E6%95%B0">floor, å‘ä¸‹å–æ•´</a>)åçš„æ•´æ•°</td></tr><tr><td><code>%</code></td><td>å–ä½™è¿ç®—</td></tr><tr><td><code>**</code></td><td>ä¹˜æ–¹è¿ç®—</td></tr><tr><td><code>()</code></td><td>ç”¨äºåˆ†ç»„</td></tr><tr><td><code>=</code></td><td>ç”¨äºç»™å˜é‡èµ‹å€¼</td></tr><tr><td><code>==</code></td><td>ç”¨äºåˆ¤æ–­å€¼æ˜¯å¦ç›¸ç­‰</td></tr></tbody></table><p>âš ï¸ã€å‡ ç‚¹æ³¨æ„ã€‘ï¼š</p><ul><li>å˜é‡åœ¨ä½¿ç”¨å‰å¿…é¡» â€œå®šä¹‰â€(èµ‹å€¼)ï¼Œå¦åˆ™ä¼šå‡ºé”™ã€‚</li><li>äº¤äº’æ¨¡å¼ä¸­ï¼Œæœ€è¿‘ä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼èµ‹ç»™å˜é‡ <code>_</code>ã€‚</li><li>æµ®ç‚¹æ•°æœ‰å®Œæ•´çš„æ”¯æŒï¼›æ•´æ•°å’Œæµ®ç‚¹æ•°çš„æ··åˆè®¡ç®—ä¸­ï¼Œæ•´æ•°ä¼šè¢«è½¬æ¢ä¸ºæµ®ç‚¹æ•°ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">NameError: name <span class="string">&#x27;c&#x27;</span> <span class="keyword">is</span> <span class="keyword">not</span> defined</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a + b</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>_ + <span class="number">3</span>    <span class="comment"># (3) + 3</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c = _ * <span class="number">2</span>    <span class="comment"># c = (6) * 2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c</span><br><span class="line"><span class="number">12</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = <span class="number">0.3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a + d</span><br><span class="line"><span class="number">1.3</span></span><br></pre></td></tr></table></figure><p>å¯¹äºæ•´æ•°ç±»å‹ï¼Œä½ è¿˜å¯ä»¥åƒ C ä¸€æ ·ï¼Œåšä½è¿ç®—ï¼š</p><table><thead><tr><th>è¿ç®—</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>`x</td><td>y`</td></tr><tr><td><code>x &amp; y</code></td><td>xã€y æŒ‰ä½å–é€»è¾‘ä¸</td></tr><tr><td><code>x ^ y</code></td><td>xã€y æŒ‰ä½å–å¼‚æˆ–</td></tr><tr><td><code>x &lt;&lt; n</code></td><td>x å·¦ç§» n ä½</td></tr><tr><td><code>x &gt;&gt; n</code></td><td>x å³ç§» n ä½</td></tr><tr><td><code>~x</code></td><td>x æŒ‰ä½å–é€»è¾‘é</td></tr></tbody></table><hr><p>æœªå®Œå¾…ç»­â€¦</p><p>Next: ã€PythonåŸºæœ¬æ•°æ®ç±»å‹ã€‘</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> åŸºç¡€æ‰‹å†Œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonå­¦äº†é‚£ä¹ˆä¹…ï¼Œé‚£ä¹ˆå¤šåº“åˆ°åº•æ€ä¹ˆç”¨ï¼Ÿå¥½å“¥ä»¬å„¿é»˜é»˜ä»æ”¶è—å¤¹é‡Œæå‡ºè¿™ç¯‡ä¿å§†çº§æ•™ç¨‹</title>
      <link href="/2020/03/22/blog/Python-how2-use-packages/"/>
      <url>/2020/03/22/blog/Python-how2-use-packages/</url>
      
        <content type="html"><![CDATA[<h1 id="Pythonå­¦äº†é‚£ä¹ˆä¹…ï¼Œé‚£ä¹ˆå¤šåº“åˆ°åº•æ€ä¹ˆç”¨ï¼Ÿå¥½å“¥ä»¬å„¿é»˜é»˜ä»æ”¶è—å¤¹é‡Œæå‡ºè¿™ç¯‡ä¿å§†çº§æ•™ç¨‹"><a href="#Pythonå­¦äº†é‚£ä¹ˆä¹…ï¼Œé‚£ä¹ˆå¤šåº“åˆ°åº•æ€ä¹ˆç”¨ï¼Ÿå¥½å“¥ä»¬å„¿é»˜é»˜ä»æ”¶è—å¤¹é‡Œæå‡ºè¿™ç¯‡ä¿å§†çº§æ•™ç¨‹" class="headerlink" title="Pythonå­¦äº†é‚£ä¹ˆä¹…ï¼Œé‚£ä¹ˆå¤šåº“åˆ°åº•æ€ä¹ˆç”¨ï¼Ÿå¥½å“¥ä»¬å„¿é»˜é»˜ä»æ”¶è—å¤¹é‡Œæå‡ºè¿™ç¯‡ä¿å§†çº§æ•™ç¨‹"></a>Pythonå­¦äº†é‚£ä¹ˆä¹…ï¼Œé‚£ä¹ˆå¤šåº“åˆ°åº•æ€ä¹ˆç”¨ï¼Ÿå¥½å“¥ä»¬å„¿é»˜é»˜ä»æ”¶è—å¤¹é‡Œæå‡ºè¿™ç¯‡ä¿å§†çº§æ•™ç¨‹</h1><p>æœ¬æ–‡åˆåã€Šä¸€ç¯‡å†™ç»™ Python åˆå­¦è€…çš„ç”¨åŒ…æŒ‡å—ã€‹ã€‚</p><blockquote><p>ä¸€ä½ä¸æ„¿æ„é€éœ²å§“åçš„ç½‘å‹æ›¾ç»è¯´è¿‡ï¼šâ€œåšè½¯ä»¶å°±åƒæå»ºç­‘ã€‚å…¶ä¸­å¯¼åŒ…ç”¨åº“æŠ„ä»£ç å°±åƒåšæ¬è¿å·¥ï¼Œå¹¶ä¸å¯è€»ã€‚ç›–èµ·è´è¿é“­çš„æ˜¯æ¬è¿å·¥æ¬æ¥çš„ä¸€çŸ³ä¸€æœ¨ï¼Œå»ºèµ·å¡æ‹‰ç‰¹æ‹‰ç“¦çš„æ˜¯æ¬è¿å·¥è¿æ¥çš„ä¸€ç –ä¸€ç“¦ã€‚â€</p></blockquote><p>Python æœ‰é‚£ä¹ˆå¤šå†…ç½®çš„åº“ï¼Œè¿˜æœ‰æ›´å¤šçš„ç¬¬ä¸‰æ–¹åº“ã€‚åˆå­¦è€…åœ¨çœ‹ä¸€äº›ä»£ç çš„æ—¶å€™ï¼Œæ€»æ˜¯ä¼šæƒŠè®¶çš„å‘ç°ï¼Œåˆ«äººå†™çš„ä»£ç é‡Œè°ƒç”¨ä¸€å¤§å †çš„åº“ï¼Œæ¯”å¦‚ï¼Œè¿™æ˜¯æˆ‘éšæ‰‹å†™äº†ç©çš„ä¸€ä¸ªå°ç©å…·é¡¹ç›®ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd2janymihj31890u0ke4.jpg" alt="image-20200322111540766"></p><p>è¿™è¶³å¤Ÿè®©åˆå­¦è€…ç›®çªå£å‘†äº†â€”â€”è¿™ä¹ˆå¤šçš„åº“ï¼Œæ€ä¹ˆå­¦å¾—è¿‡æ¥å•Šï¼</p><p>å…¶å®åˆšæ‰é‚£ä¸ªè¿˜å¾ˆå°‘äº†ï¼Œè¿™æ˜¯æˆ‘çš„ä¸€ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹çš„é¡¹ç›®ä¸­ï¼Œå‡ åä¸ªæ–‡ä»¶ä¸­çš„ä¸€ä¸ªçš„ import éƒ¨åˆ†ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd2jf16dbej31890u0b29.jpg" alt="image-20200322111952115"></p><p>è¿™é‡Œæœ‰69æ¡importï¼Œå¯¼äº†69ä¸ªä¸åŒçš„åŒ…ï¼Œå…¨éƒ½ç”¨ä¸Šäº†â€”â€”è¿™ä¹ˆå¤šï¼Œæ€ä¹ˆè®°å¾—ä½ã€æå¾—æ¸…å•Šï¼</p><p>å…¶å®æˆ‘çš„æ–¹æ³•å¾ˆç®€å•â€”â€”å¯¹äºè¿™äº›åº“ï¼Œæˆ‘<strong>å…¨éƒ½ä¸å­¦ä¹ ã€ä¸è®°å¿†</strong>ã€‚æˆ‘åªéœ€è¦æœ‰ä¸€ä¸ªå°è±¡â€”â€”ä¸–ç•Œä¸Šæœ‰ä¸€ä¸ªåº“ï¼Œå¯ä»¥å®Œæˆæˆ‘æƒ³è¦çš„è¿™ä¸ªåŠŸèƒ½ã€‚<strong>å…·ä½“æ€ä¹ˆç”¨ï¼Œç”¨åˆ°å†è¯´ï¼›åˆ°åº•æ€ä¹ˆè¯´ï¼Œå¿…åº”è°·æ­Œ</strong>ã€‚</p><p>ï¼ˆè®°ä½è¿™ä¸¤å¥ç²—ä½“çš„è¯å•Šï¼Œè¿™å°±æ˜¯æœ¬æ–‡å¯ä»¥æ•™ç»™ä½ çš„æ‰€æœ‰ä¸œè¥¿ã€‚ï¼‰</p><p>åœ¨ç°å®ä¸­è®¤è¯†æˆ‘çš„æœ‹å‹éƒ½çŸ¥é“ï¼Œæˆ‘ä»ä¸èƒŒä¹¦ï¼Œï¼ˆå‡ ä¹ï¼‰ä»ä¸åˆ·é¢˜ã€‚æˆ‘æ˜¯ä¸ªæç«¯è®¨åŒè®°å¿†ã€é‡å¤ã€æ— æ•ˆå·¥ä½œçš„äººï¼ˆæ›¾ç»çš„æˆ‘å¥½åƒè¿˜ä¸ºæ­¤å½“ä¸­æ‹æ¡ˆè€Œèµ·è§¦æ€’è¿‡æˆ‘æœ€æ•¬çˆ±çš„ğŸ’è€å¸ˆï¼Ÿå‰å‡ å¤©æœ‹å‹ç»™æˆ‘è¯´å¥½åƒæœ‰è¿™ä¹ˆä¸€äº‹ï¼Œæˆ‘æœ‰ç‚¹è®°ä¸æ¸…äº†ï¼‰ï¼Œæ‰€ä»¥ï¼Œæˆ‘å½“ç„¶æ›´æ˜¯ä¸ä¼šå»è®°å¿†è¿™äº›åº“çš„ï¼Œè¿™ä¹ˆå¤šåº“è¿™ä¹ˆçƒ¦ï¼Œè°è®°å¾—å‘€ã€‚</p><p>å½“æˆ‘åœ¨é¡¹ç›®ä¸­é‡åˆ°ä¸€ä¸ªéœ€è¦çš„åŠŸèƒ½ï¼Œæˆ‘å°±ä¼šæ‰“å¼€è°·æ­Œæœç´¢è¿™ä¸ªä¸œè¥¿çš„å…³é”®è¯ï¼Œæ¯”å¦‚ <code>python gui</code>ï¼Œ<code>android å¼€å‘ äºŒç»´ç </code>ï¼Œ<code>docker wordpress</code>â€¦â€¦</p><p>ç„¶åï¼Œå‡ ä¹æ˜¯ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ éƒ½å¯ä»¥çœ‹åˆ°å¤§ä½¬çš„æ–‡ç« æœ‰ä»‹ç»ç”¨ä»€ä¹ˆåº“ã€è¦æ€ä¹ˆæï¼Œè·Ÿç€åšå°±è¡Œã€‚</p><p>ï¼ˆè‡³äºæœä¸åˆ°çš„æƒ…å†µï¼Œä½ å¯ä»¥æ›´æ”¹ä½ çš„å…³é”®è¯ã€‚å¦‚æœç¡®å®æ²¡æœ‰ï¼Œæˆ–æ˜¯æœå‡ºæ¥çš„éƒ½ä¸å–œæ¬¢ï¼Œè‡ªå·±å†™ä¸€ä¸ªå°±è¡Œï¼Œå°±è´¹ç‚¹äº‹å˜›ï¼Œé—®é¢˜ä¸å¤§ï¼‰</p><p>æ‰€ä»¥ï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œå…¶å®æˆ‘ä¸ä¼šå¤šå°‘åº“ï¼Œä½†æˆ‘ä¼šç”¨æœç´¢å¼•æ“ï¼Œè€Œä¸”ç”¨çš„æ¯”è®¸å¤šåˆå­¦è€…è¦å¥½ä¸€ç‚¹ç‚¹ã€‚</p><p>æ¯æ¬¡æˆ‘å†™é¡¹ç›®çš„æ—¶å€™ï¼Œæµè§ˆå™¨ç»å¯¹æ˜¯å·¥ä½œé‡ä»…æ¬¡äºæˆ‘çš„æ€ç»´ä»¥åŠ IDE çš„è½¯ä»¶ï¼ˆè¿™å›¾ç‰‡ä¸Šè¿˜åªæ˜¯ä¸€éƒ¨åˆ†ï¼Œå…¨éƒ¨æ‰“å¼€çš„æœ‰è¿™æ ·å¥½å‡ é¡µï¼Œæœ€å¤šçš„æ—¶å€™å¯ä»¥æœ‰å¤§æ¦‚100é¡µï¼‰ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd2khd8e36j31co0u0u0x.jpg" alt="image-20200322114451829"></p><p>åœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä¼šæ•™ä½ æ€ä¹ˆç”¨æœç´¢å¼•æ“å¸®åŠ©ä½ ä½¿ç”¨åº“ï¼ˆå½“ç„¶åªæ˜¯æœ€åŸºç¡€çš„éƒ¨åˆ†ï¼Œé«˜çº§çš„æŠ€å·§åˆæ˜¯å•ç‹¬çš„ä¸€ç¯‡é•¿æ–‡äº†ï¼‰ã€‚</p><p>æˆ‘ä»¬å‡è®¾ä¸€ä¸ªåœºæ™¯ï¼Œä½ çš„é¡¹ç›®ä¸­ï¼Œéœ€è¦ä½ ç”¨ Python åšä¸ª GUIï¼Œä½ å¯ä»¥å‚è€ƒä»¥ä¸‹æ­¥éª¤ï¼š</p><h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><p><strong>Step 1</strong>. æ‰“å¼€ Chrome æˆ–æ˜¯ä»»ä½•ä½ å–œæ¬¢çš„æµè§ˆå™¨ï¼ˆä½œä¸ºä¸€åWebå¼€å‘è€…ï¼Œæˆ‘çœŸæŒšåœ°æé†’æ‚¨ï¼ŒIEé™¤å¤–ï¼‰ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd2hvzdpddj31c00u0e81.jpg" alt="å±å¹•å¿«ç…§ 2020-03-22 10.07.38"></p><p><strong>Step 2</strong>. æ‰“å¼€ Google æˆ–æ˜¯ä»»ä½•ä½ ç†Ÿæ‚‰çš„æœç´¢å¼•æ“ï¼ˆç™¾åº¦é™¤å¤–ï¼‰ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd2hyzdzmvj316w0u0tpf.jpg" alt="å±å¹•å¿«ç…§ 2020-03-22 10.08.20"></p><p><strong>Step 3</strong>. åœ¨æµè§ˆå™¨çš„æœç´¢æ¡†ä¸­è¾“å…¥ <code>python + ç©ºæ ¼ + æ‚¨æ„Ÿå…´è¶£çš„é—®é¢˜</code>ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd2hz77p6ej316w0u0wxm.jpg" alt="å±å¹•å¿«ç…§ 2020-03-22 10.10.03"></p><p><strong>Step 4</strong>. çœ‹åˆ°è¿™æ ·çš„æœç´¢ç»“æœï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd2i2xx8lpj316w0u0e75.jpg" alt="å±å¹•å¿«ç…§ 2020-03-22 10.10.13"></p><p>P.S. æœ¬äººä¸æ­§è§†ä»»ä½•æœç´¢å¼•æ“ï¼Œä½†å¦‚æœä½ éè¦ç”¨ç™¾åº¦ï¼Œè¯·æ³¨æ„é‰´åˆ«å¹¿å‘Šã€‚äº‹å®ä¸Šï¼Œç¬¬ä¸€é¡µåŸºæœ¬éƒ½æ˜¯å¹¿å‘Šï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd2hs79g4pj316w0u0e81.jpg" alt="å±å¹•å¿«ç…§ 2020-03-22 10.15.52"></p><p><strong>Step 5</strong>. ç‚¹å¼€æœç´¢ç»“æœå‰ä¸€å±ä¸Šçš„æ¡ç›®ï¼Œçœ‹é‡Œé¢ç›¸ä¼¼çš„å•è¯ï¼Œä»¥åŠä¸­æ–‡å†…å®¹ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd2idhlpp5j31nf0u07q6.jpg" alt="å±å¹•å¿«ç…§ 2020-03-22 10.36.17"></p><p><strong>Step 6</strong>. æ–°å¼€ä¸€ä¸ªæœç´¢ï¼Œæœç´¢ <code>python + ç©ºæ ¼ + åˆšæ‰å‡ºç°æœ€å¤šçš„åº“å</code>ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd2if9tkuxj316w0u0kin.jpg" alt="image-20200322104530335"></p><p><strong>Step 7</strong>. éšä¾¿æ‰“å¼€ä¸€ä¸ªç»“æœï¼Œé‡Œé¢æœ‰æ•™ä½ æ€ä¹ˆå®‰è£…ï¼ˆè¿™ä¸ªtkinteræ˜¯å†…ç½®åº“ï¼Œä¸ç”¨å®‰è£…ï¼‰ã€å¯¼å…¥ã€å†™helloworldï¼Œç…§ç€åšä¸€éï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd2imfc2euj316w0u01kx.jpg" alt="å±å¹•å¿«ç…§ 2020-03-22 10.50.58"></p><p>ç»“æœï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd2iqiimxrj31cb0u0tgb.jpg" alt="image-20200322105619261"></p><p><strong>Step 8</strong>. æŠŠåˆšæ‰æ‰“å¼€çš„ç½‘é¡µé‡Œè¿™äº›ä¸œè¥¿é‡Œç¬¬ä¸€é¡µéšä¾¿çœ‹ä¸€ä¸‹ï¼Œæœ‰å°è±¡å°±è¡Œï¼ˆä¸ç”¨è®°å¿†ï¼Œä½†ä½ å¯ä»¥è·Ÿç€åšä¸€éï¼Œå¦‚æœä½ æ—¶é—´å……è¶³çš„è¯ï¼Œä½†ä¸€èˆ¬æˆ‘ä¹Ÿä¸ä¼šå»åšï¼Œåªæ˜¯çœ‹ï¼Œæœ‰å°è±¡å°±è¡Œï¼‰ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd2irldad5j30u00ytdni.jpg" alt="image-20200322105721864"></p><p><strong>Step 9</strong>. åœ¨é¡¹ç›®é‡Œä½¿ç”¨è¯¥åº“ï¼ˆçŸ¥é“äº†è¿™ä¸œè¥¿èƒ½ç”¨ï¼Œé‚£å°±å¼€å§‹ç”¨å®ƒäº†ï¼‰ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd2iurh59bj317b0u04qp.jpg" alt="image-20200322110023854"></p><p>é‡åˆ°ä½ æƒ³ç”¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚å¯¹è¯æ¡†ï¼ŒGoogle æœç´¢ <code>python + åº“å + åŠŸèƒ½</code>ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd2ix3mtsvj316w0u01kx.jpg" alt="image-20200322110238916"></p><p>çœ‹è§äº†æ²¡ï¼Œéƒ½æ˜¯ä¸­æ–‡ï¼éšä¾¿ç‚¹å¼€ä¸€ä¸ªçœ‹ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd2iyzm1qsj316w0u0b29.jpg" alt="image-20200322110427510"></p><p>ä»£ç æŠ„ä¸€ä¸‹ï¼Œæ•ˆæœå°±å‡ºæ¥äº†ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gd2j0y5yijj31950u0n6n.jpg" alt="å±å¹•å¿«ç…§ 2020-03-22 11.06.05"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç”¨åº“åŸºæœ¬ä¸Šå°±ç­‰äºä½¿ç”¨æœç´¢å¼•æ“ï¼Œä¸ç”¨è®°å¿†ï¼Œé‡åˆ°æƒ³è¦çš„åŠŸèƒ½æœç´¢ä¸€ä¸‹ã€æŠ„ä¸€ä¸‹å°±è¡Œã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode P150 é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼</title>
      <link href="/2020/03/19/School/Leetcode_P150_evaluate-reverse-polish-notation/"/>
      <url>/2020/03/19/School/Leetcode_P150_evaluate-reverse-polish-notation/</url>
      
        <content type="html"><![CDATA[<h1 id="Leetcode-P150-é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼"><a href="#Leetcode-P150-é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼" class="headerlink" title="Leetcode P150 é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼"></a>Leetcode P150 é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼</h1><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>æ ¹æ®<a href="https://baike.baidu.com/item/%E9%80%86%E6%B3%A2%E5%85%B0%E5%BC%8F/128437">é€†æ³¢å…°è¡¨ç¤ºæ³•</a>ï¼Œæ±‚è¡¨è¾¾å¼çš„å€¼ã€‚</p><p>æœ‰æ•ˆçš„è¿ç®—ç¬¦åŒ…æ‹¬ <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code> ã€‚æ¯ä¸ªè¿ç®—å¯¹è±¡å¯ä»¥æ˜¯æ•´æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯å¦ä¸€ä¸ªé€†æ³¢å…°è¡¨è¾¾å¼ã€‚</p><p><strong>è¯´æ˜ï¼š</strong></p><ul><li>æ•´æ•°é™¤æ³•åªä¿ç•™æ•´æ•°éƒ¨åˆ†ã€‚</li><li>ç»™å®šé€†æ³¢å…°è¡¨è¾¾å¼æ€»æ˜¯æœ‰æ•ˆçš„ã€‚æ¢å¥è¯è¯´ï¼Œè¡¨è¾¾å¼æ€»ä¼šå¾—å‡ºæœ‰æ•ˆæ•°å€¼ä¸”ä¸å­˜åœ¨é™¤æ•°ä¸º 0 çš„æƒ…å†µã€‚</li></ul><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: [&quot;2&quot;, &quot;1&quot;, &quot;+&quot;, &quot;3&quot;, &quot;*&quot;]</span><br><span class="line">è¾“å‡º: 9</span><br><span class="line">è§£é‡Š: ((2 + 1) * 3) &#x3D; 9</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: [&quot;4&quot;, &quot;13&quot;, &quot;5&quot;, &quot;&#x2F;&quot;, &quot;+&quot;]</span><br><span class="line">è¾“å‡º: 6</span><br><span class="line">è§£é‡Š: (4 + (13 &#x2F; 5)) &#x3D; 6</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: [&quot;10&quot;, &quot;6&quot;, &quot;9&quot;, &quot;3&quot;, &quot;+&quot;, &quot;-11&quot;, &quot;*&quot;, &quot;&#x2F;&quot;, &quot;*&quot;, &quot;17&quot;, &quot;+&quot;, &quot;5&quot;, &quot;+&quot;]</span><br><span class="line">è¾“å‡º: 22</span><br><span class="line">è§£é‡Š: </span><br><span class="line">  ((10 * (6 &#x2F; ((9 + 3) * -11))) + 17) + 5</span><br><span class="line">&#x3D; ((10 * (6 &#x2F; (12 * -11))) + 17) + 5</span><br><span class="line">&#x3D; ((10 * (6 &#x2F; -132)) + 17) + 5</span><br><span class="line">&#x3D; ((10 * 0) + 17) + 5</span><br><span class="line">&#x3D; (0 + 17) + 5</span><br><span class="line">&#x3D; 17 + 5</span><br><span class="line">&#x3D; 22</span><br></pre></td></tr></table></figure><p>From <a href="https://leetcode-cn.com/problems/evaluate-reverse-polish-notation/">https://leetcode-cn.com/problems/evaluate-reverse-polish-notation/</a></p><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>è¿™ä¸ªä¸œè¥¿åªè¦å†™è¿‡ç®€å•è®¡ç®—å™¨çš„è¯ï¼Œè‚¯å®šä¸åœ¨è¯ä¸‹ã€‚è¿™ä¸ªé¢˜ç›®é€†æ³¢å…°è¡¨è¾¾å¼æ±‚å€¼æœ€ç®€å•çš„æƒ…å†µäº†ï¼ŒåŸç†å¾ˆç®€å•ï¼š</p><blockquote><p> è¯»åˆ°æ•°å­—å°±å…¥æ ˆï¼›</p><p>è¯»åˆ°ç¬¦å·å°±å‡ºæ ˆä¸¤ä¸ªå…ƒç´ è¿ç®—ï¼Œç»“æœå…¥æ ˆã€‚</p></blockquote><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><h4 id="æ ‡å‡†æ ˆå®ç°"><a href="#æ ‡å‡†æ ˆå®ç°" class="headerlink" title="æ ‡å‡†æ ˆå®ç°"></a>æ ‡å‡†æ ˆå®ç°</h4><p>åŸºæœ¬ç‰ˆæœ¬ï¼Œå®ç°ä¸€ä¸ªæ ‡å‡†çš„æ ˆï¼Œè¿›è¡Œæ“ä½œï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;strconv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">evalRPN</span><span class="params">(tokens []<span class="keyword">string</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(tokens) == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">s := newStack()</span><br><span class="line"><span class="keyword">for</span> _, i := <span class="keyword">range</span> tokens &#123;</span><br><span class="line"><span class="keyword">switch</span> i &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;+&quot;</span>:</span><br><span class="line">a, b := s.pop(), s.pop()</span><br><span class="line">s.push(b + a)</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;-&quot;</span>:</span><br><span class="line">a, b := s.pop(), s.pop()</span><br><span class="line">s.push(b - a)</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;*&quot;</span>:</span><br><span class="line">a, b := s.pop(), s.pop()</span><br><span class="line">s.push(b * a)</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;/&quot;</span>:</span><br><span class="line">a, b := s.pop(), s.pop()</span><br><span class="line">s.push(b / a)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">n, _ := strconv.Atoi(i)</span><br><span class="line">s.push(n)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> s.pop()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> stack <span class="keyword">struct</span> &#123;</span><br><span class="line">data []<span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newStack</span><span class="params">()</span> *<span class="title">stack</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> &amp;stack&#123;</span><br><span class="line">data: <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>),</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *stack)</span> <span class="title">push</span><span class="params">(data <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">s.data = <span class="built_in">append</span>(s.data, data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *stack)</span> <span class="title">pop</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">top := s.data[<span class="built_in">len</span>(s.data)<span class="number">-1</span>]</span><br><span class="line">s.data = s.data[<span class="number">0</span> : <span class="built_in">len</span>(s.data)<span class="number">-1</span>]</span><br><span class="line"><span class="keyword">return</span> top</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="æˆç†Ÿçš„æ ˆåº”è¯¥å­¦ä¼šè‡ªå·±å®Œæˆè®¡ç®—"><a href="#æˆç†Ÿçš„æ ˆåº”è¯¥å­¦ä¼šè‡ªå·±å®Œæˆè®¡ç®—" class="headerlink" title="æˆç†Ÿçš„æ ˆåº”è¯¥å­¦ä¼šè‡ªå·±å®Œæˆè®¡ç®—"></a>æˆç†Ÿçš„æ ˆåº”è¯¥å­¦ä¼šè‡ªå·±å®Œæˆè®¡ç®—</h4><p>é‚£ä¸€å¤§å † <code>a, b := s.pop(), s.pop()</code> å’Œ <code> s.push(b * a)</code> å¾ˆçƒ¦ï¼Œä¼˜åŒ–ä¸€ä¸‹ï¼ŒæŠŠåˆšæ‰çš„æ ‡å‡† stack æ¢æˆä¸€ä¸ªâ€œå­ç±»â€ calcStackã€‚æˆ‘ä»¬çš„ calcStack æ˜¯ä¸ªæˆç†Ÿçš„æ ˆäº†ï¼Œåº”è¯¥å­¦ä¼šè‡ªå·±å®Œæˆè®¡ç®—ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;strconv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">evalRPN</span><span class="params">(tokens []<span class="keyword">string</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">s := newCalcStack()</span><br><span class="line"><span class="keyword">for</span> _, i := <span class="keyword">range</span> tokens &#123;</span><br><span class="line"><span class="keyword">switch</span> i &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;+&quot;</span>:</span><br><span class="line">s.calc(<span class="function"><span class="keyword">func</span> <span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123; <span class="keyword">return</span> b + a&#125;)</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;-&quot;</span>:</span><br><span class="line">s.calc(<span class="function"><span class="keyword">func</span> <span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123; <span class="keyword">return</span> b - a&#125;)</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;*&quot;</span>:</span><br><span class="line">s.calc(<span class="function"><span class="keyword">func</span> <span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123; <span class="keyword">return</span> b * a&#125;)</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;/&quot;</span>:</span><br><span class="line">s.calc(<span class="function"><span class="keyword">func</span> <span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123; <span class="keyword">return</span> b / a&#125;)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">n, _ := strconv.Atoi(i)</span><br><span class="line">s.push(n)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> s.pop()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> calcStack <span class="keyword">struct</span> &#123;</span><br><span class="line">data []<span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newCalcStack</span><span class="params">()</span> *<span class="title">calcStack</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> &amp;calcStack&#123;</span><br><span class="line">data: <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>),</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *calcStack)</span> <span class="title">push</span><span class="params">(data <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">s.data = <span class="built_in">append</span>(s.data, data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *calcStack)</span> <span class="title">pop</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">top := s.data[<span class="built_in">len</span>(s.data)<span class="number">-1</span>]</span><br><span class="line">s.data = s.data[<span class="number">0</span> : <span class="built_in">len</span>(s.data)<span class="number">-1</span>]</span><br><span class="line"><span class="keyword">return</span> top</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *calcStack)</span> <span class="title">calc</span><span class="params">(opt <span class="keyword">func</span>(<span class="keyword">int</span>, <span class="keyword">int</span>)</span><span class="title">int</span>)</span> &#123;</span><br><span class="line">s.push(opt(s.pop(), s.pop()))</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcz29bech9j31460u04ps.jpg" alt="å±å¹•å¿«ç…§ 2020-03-19 11.09.01"></p><h4 id="å¤šç”¨æŒ‡é’ˆ"><a href="#å¤šç”¨æŒ‡é’ˆ" class="headerlink" title="å¤šç”¨æŒ‡é’ˆ"></a>å¤šç”¨æŒ‡é’ˆ</h4><p>å¦‚æœä½ å–œæ¬¢ç”¨æŒ‡é’ˆï¼Œè¿˜å¯ä»¥å†ä¼˜åŒ–ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥ä¸éœ€è¦ pop äº†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;strconv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">evalRPN</span><span class="params">(tokens []<span class="keyword">string</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">s := newCalcStack()</span><br><span class="line"><span class="keyword">for</span> _, i := <span class="keyword">range</span> tokens &#123;</span><br><span class="line"><span class="keyword">switch</span> i &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;+&quot;</span>:</span><br><span class="line">s.calc(<span class="function"><span class="keyword">func</span> <span class="params">(a, b *<span class="keyword">int</span>)</span></span> &#123; *b += *a &#125;)</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;-&quot;</span>:</span><br><span class="line">s.calc(<span class="function"><span class="keyword">func</span> <span class="params">(a, b *<span class="keyword">int</span>)</span></span> &#123; *b -= *a &#125;)</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;*&quot;</span>:</span><br><span class="line">s.calc(<span class="function"><span class="keyword">func</span> <span class="params">(a, b *<span class="keyword">int</span>)</span></span> &#123; *b *= *a &#125;)</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;/&quot;</span>:</span><br><span class="line">s.calc(<span class="function"><span class="keyword">func</span> <span class="params">(a, b *<span class="keyword">int</span>)</span></span> &#123; *b /= *a &#125;)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">n, _ := strconv.Atoi(i)</span><br><span class="line">s.push(n)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// return s.pop()</span></span><br><span class="line"><span class="keyword">return</span> s.data[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> calcStack <span class="keyword">struct</span> &#123;</span><br><span class="line">data []<span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newCalcStack</span><span class="params">()</span> *<span class="title">calcStack</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> &amp;calcStack&#123;</span><br><span class="line">data: <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>),</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *calcStack)</span> <span class="title">push</span><span class="params">(data <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">s.data = <span class="built_in">append</span>(s.data, data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// func (s *calcStack) pop() int &#123;</span></span><br><span class="line"><span class="comment">// top := s.data[len(s.data)-1]</span></span><br><span class="line"><span class="comment">// s.data = s.data[0 : len(s.data)-1]</span></span><br><span class="line"><span class="comment">// return top</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *calcStack)</span> <span class="title">calc</span><span class="params">(opt <span class="keyword">func</span>(*<span class="keyword">int</span>, *<span class="keyword">int</span>)</span>)</span> &#123;</span><br><span class="line"><span class="comment">// s.push(opt(s.pop(), s.pop()))</span></span><br><span class="line">opt(&amp;s.data[<span class="built_in">len</span>(s.data)<span class="number">-1</span>], &amp;s.data[<span class="built_in">len</span>(s.data)<span class="number">-2</span>])</span><br><span class="line">s.data = s.data[<span class="number">0</span> : <span class="built_in">len</span>(s.data)<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode P155 æœ€å°æ ˆ</title>
      <link href="/2020/03/18/School/Leetcode_P155_min-stack/"/>
      <url>/2020/03/18/School/Leetcode_P155_min-stack/</url>
      
        <content type="html"><![CDATA[<h1 id="Leetcode-P155-æœ€å°æ ˆ"><a href="#Leetcode-P155-æœ€å°æ ˆ" class="headerlink" title="Leetcode P155 æœ€å°æ ˆ"></a>Leetcode P155 æœ€å°æ ˆ</h1><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>è®¾è®¡ä¸€ä¸ªæ”¯æŒ pushï¼Œpopï¼Œtop æ“ä½œï¼Œå¹¶èƒ½åœ¨å¸¸æ•°æ—¶é—´å†…æ£€ç´¢åˆ°æœ€å°å…ƒç´ çš„æ ˆã€‚</p><ul><li><code>push(x)</code> â€“ å°†å…ƒç´  x æ¨å…¥æ ˆä¸­ã€‚</li><li><code>pop()</code> â€“ åˆ é™¤æ ˆé¡¶çš„å…ƒç´ ã€‚</li><li><code>top()</code> â€“ è·å–æ ˆé¡¶å…ƒç´ ã€‚</li><li><code>getMin()</code> â€“ æ£€ç´¢æ ˆä¸­çš„æœ€å°å…ƒç´ ã€‚</li></ul><p><strong>ç¤ºä¾‹:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MinStack minStack &#x3D; new MinStack();</span><br><span class="line">minStack.push(-2);</span><br><span class="line">minStack.push(0);</span><br><span class="line">minStack.push(-3);</span><br><span class="line">minStack.getMin();   --&gt; è¿”å› -3.</span><br><span class="line">minStack.pop();</span><br><span class="line">minStack.top();      --&gt; è¿”å› 0.</span><br><span class="line">minStack.getMin();   --&gt; è¿”å› -2.</span><br></pre></td></tr></table></figure><hr><p>From <a href="https://leetcode-cn.com/problems/min-stack/">https://leetcode-cn.com/problems/min-stack/</a></p><h2 id="é¢å¤–æœ€å°æ ˆ"><a href="#é¢å¤–æœ€å°æ ˆ" class="headerlink" title="é¢å¤–æœ€å°æ ˆ"></a>é¢å¤–æœ€å°æ ˆ</h2><p>å…¶å®è¿™ä¸ªé—®é¢˜ï¼Œç›´æ¥ç”¨ä¸¤ä¸ªæ ˆï¼Œä¸€ä¸ªå­˜ç”¨æˆ·æ”¾å…¥çš„æ•°æ®ï¼Œä¸€ä¸ªå­˜å¯¹åº”å¦ä¸€ä¸ªæ ˆæ¯ä¸€ä¸ªä½ç½®çš„æœ€å°å€¼å°±å¯ä»¥äº†ï¼Œä¸¤ä¸ªæ ˆåŒæ—¶æ“ä½œï¼ŒåŒæ—¶ pushã€åŒæ—¶ popï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MinStack <span class="keyword">struct</span> &#123;</span><br><span class="line">    data []<span class="keyword">int</span></span><br><span class="line">    min []<span class="keyword">int</span></span><br><span class="line">    top <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** initialize your data structure here. */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Constructor</span><span class="params">()</span> <span class="title">MinStack</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> MinStack&#123;</span><br><span class="line">        data: <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>),</span><br><span class="line">        min: <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>),</span><br><span class="line">        top: <span class="number">0</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MinStack)</span> <span class="title">Push</span><span class="params">(x <span class="keyword">int</span>)</span></span>  &#123;</span><br><span class="line">    this.data = <span class="built_in">append</span>(this.data, x)</span><br><span class="line">    <span class="keyword">if</span> (this.top == <span class="number">0</span> || x &lt; this.min[this.top<span class="number">-1</span>]) &#123;</span><br><span class="line">        this.min = <span class="built_in">append</span>(this.min, x)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        this.min = <span class="built_in">append</span>(this.min, this.min[this.top<span class="number">-1</span>])</span><br><span class="line">    &#125;</span><br><span class="line">    this.top++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MinStack)</span> <span class="title">Pop</span><span class="params">()</span></span>  &#123;</span><br><span class="line">    this.data = this.data[<span class="number">0</span>: this.top<span class="number">-1</span>]</span><br><span class="line">    this.min = this.min[<span class="number">0</span>: this.top<span class="number">-1</span>]</span><br><span class="line">    this.top--</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MinStack)</span> <span class="title">Top</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> this.data[this.top<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MinStack)</span> <span class="title">GetMin</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> this.min[this.top<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your MinStack object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * obj := Constructor();</span></span><br><span class="line"><span class="comment"> * obj.Push(x);</span></span><br><span class="line"><span class="comment"> * obj.Pop();</span></span><br><span class="line"><span class="comment"> * param_3 := obj.Top();</span></span><br><span class="line"><span class="comment"> * param_4 := obj.GetMin();</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcyd9w7yf9j31460u0kir.jpg" alt="å±å¹•å¿«ç…§ 2020-03-18 20.43.23"></p><h2 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h2><p>åœ¨ min çš„è¿™ä¸ªå­˜æœ€å°å€¼çš„æ ˆé‡Œä¼šæœ‰å¤§é‡çš„é‡å¤çš„å…ƒç´ ï¼Œæ‰€ä»¥æˆ‘ä»¬å¹²è„†ä¸è¦ä¸€å¯¹ä¸€çš„å­˜æœ€å°å€¼ï¼Œè€Œæ˜¯æœ€å°å€¼å˜æ›´æ—¶å†å»æ“ä½œæœ€å°å€¼æ ˆï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MinStack <span class="keyword">struct</span> &#123;</span><br><span class="line">    data []<span class="keyword">int</span></span><br><span class="line">    min []<span class="keyword">int</span></span><br><span class="line">    top <span class="keyword">int</span></span><br><span class="line">    minTop <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Constructor</span><span class="params">()</span> <span class="title">MinStack</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> MinStack&#123;</span><br><span class="line">        data: <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>),</span><br><span class="line">        min: <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>),</span><br><span class="line">        top: <span class="number">0</span>,</span><br><span class="line">        minTop: <span class="number">0</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MinStack)</span> <span class="title">Push</span><span class="params">(x <span class="keyword">int</span>)</span></span>  &#123;</span><br><span class="line">    this.data = <span class="built_in">append</span>(this.data, x)</span><br><span class="line">    <span class="keyword">if</span> (this.top == <span class="number">0</span> || x &lt;= this.min[this.minTop<span class="number">-1</span>]) &#123;</span><br><span class="line">        this.min = <span class="built_in">append</span>(this.min, x)</span><br><span class="line">        this.minTop++</span><br><span class="line">    &#125;</span><br><span class="line">    this.top++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MinStack)</span> <span class="title">Pop</span><span class="params">()</span></span>  &#123;</span><br><span class="line">    <span class="comment">// ä¸‹é¢è¿™ä¸ªè¯­å¥å†™ä¼˜é›…ä¸€ç‚¹å°±æ˜¯ï¼Œä½†åˆ·é¢˜å˜›ï¼Œå°½é‡å‡å°‘å‡½æ•°è°ƒç”¨å¿«ä¸€ç‚¹ï¼šif t := this.Top(); t == this.Min() &#123;&#125;</span></span><br><span class="line">    <span class="keyword">if</span> t := this.data[this.top<span class="number">-1</span>]; t == this.min[this.minTop<span class="number">-1</span>] &#123;</span><br><span class="line">        this.min = this.min[<span class="number">0</span>: this.minTop<span class="number">-1</span>]</span><br><span class="line">        this.minTop--</span><br><span class="line">    &#125;</span><br><span class="line">    this.data = this.data[<span class="number">0</span>: this.top<span class="number">-1</span>]</span><br><span class="line">    this.top--</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MinStack)</span> <span class="title">Top</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> this.data[this.top<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MinStack)</span> <span class="title">GetMin</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> this.min[this.minTop<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcydgmblqvj31460u01kx.jpg" alt="å±å¹•å¿«ç…§ 2020-03-18 20.50.07"></p><p>å½“ç„¶ï¼ŒæŠŠ top å±æ€§å»æ‰ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†è°ƒç”¨ <code>len</code> å‡½æ•°çš„è¯ï¼Œæ¶ˆè€—ä¼šå¤§ä¸€ç‚¹ç‚¹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MinStack <span class="keyword">struct</span> &#123;</span><br><span class="line">    data []<span class="keyword">int</span></span><br><span class="line">    min  []<span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Constructor</span><span class="params">()</span> <span class="title">MinStack</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> MinStack&#123;</span><br><span class="line">        data: <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>),</span><br><span class="line">        min:  <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MinStack)</span> <span class="title">Push</span><span class="params">(x <span class="keyword">int</span>)</span></span>  &#123;</span><br><span class="line">    this.data = <span class="built_in">append</span>(this.data, x)</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">len</span>(this.min) == <span class="number">0</span> || x &lt;= this.min[<span class="built_in">len</span>(this.min)<span class="number">-1</span>]) &#123;</span><br><span class="line">        this.min = <span class="built_in">append</span>(this.min, x)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MinStack)</span> <span class="title">Pop</span><span class="params">()</span></span>  &#123;</span><br><span class="line">    <span class="keyword">if</span> t := this.data[<span class="built_in">len</span>(this.data)<span class="number">-1</span>]; t == this.min[<span class="built_in">len</span>(this.min)<span class="number">-1</span>] &#123;</span><br><span class="line">        this.min = this.min[<span class="number">0</span>: <span class="built_in">len</span>(this.min)<span class="number">-1</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    this.data = this.data[<span class="number">0</span>: <span class="built_in">len</span>(this.data)<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MinStack)</span> <span class="title">Top</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> this.data[<span class="built_in">len</span>(this.data)<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MinStack)</span> <span class="title">GetMin</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> this.min[<span class="built_in">len</span>(this.min)<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="In-Python-Way"><a href="#In-Python-Way" class="headerlink" title="In Python Way"></a>In Python Way</h2><p>å¯¹äºè¿™ç§é—®é¢˜ï¼Œæˆ‘è¿˜æ˜¯å–œæ¬¢ç”¨ Python çš„å†…ç½®å·¥å…·å»è§£å†³ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MinStack</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.data = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span>(<span class="params">self, x: <span class="built_in">int</span></span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        self.data.append(x)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pop</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        self.data.pop()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">top</span>(<span class="params">self</span>) -&gt; int:</span></span><br><span class="line">        <span class="keyword">return</span> self.data[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getMin</span>(<span class="params">self</span>) -&gt; int:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>(self.data)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcydvphv7pj31460u01kx.jpg" alt="image-20200318210602995"></p><p>è¿™ä¸ª <code>min</code> æ¶ˆè€—å¤ªå¤§äº†ï¼Œæˆ‘ä»¬æŠŠç­–ç•¥æ”¹æˆå’Œåˆšæ‰ç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„ Golang ä¸€æ ·ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MinStack</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.data = []</span><br><span class="line">        self.<span class="built_in">min</span> = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span>(<span class="params">self, x: <span class="built_in">int</span></span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        self.data.append(x)</span><br><span class="line">        self.<span class="built_in">min</span>.append(<span class="built_in">min</span>(x, self.<span class="built_in">min</span>[-<span class="number">1</span>] <span class="keyword">if</span> <span class="built_in">len</span>(self.<span class="built_in">min</span>) <span class="keyword">else</span> <span class="number">2147483648</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pop</span>(<span class="params">self</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        self.data.pop()</span><br><span class="line">        self.<span class="built_in">min</span>.pop()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">top</span>(<span class="params">self</span>) -&gt; int:</span></span><br><span class="line">        <span class="keyword">return</span> self.data[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getMin</span>(<span class="params">self</span>) -&gt; int:</span></span><br><span class="line">        <span class="keyword">return</span> self.<span class="built_in">min</span>[-<span class="number">1</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcye5sgkw7j31460u01kx.jpg" alt="image-20200318211544338"></p><p>è¿˜å¯ä»¥ç»§ç»­ä¼˜åŒ–ï¼Œä½†æ‡’å¾—å†™äº†ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”¨Dockeréƒ¨ç½²WordPress</title>
      <link href="/2020/03/16/blog/Docker-WordPress/"/>
      <url>/2020/03/16/blog/Docker-WordPress/</url>
      
        <content type="html"><![CDATA[<h1 id="ç”¨-Docker-éƒ¨ç½²-WordPress"><a href="#ç”¨-Docker-éƒ¨ç½²-WordPress" class="headerlink" title="ç”¨ Docker éƒ¨ç½² WordPress"></a>ç”¨ Docker éƒ¨ç½² WordPress</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æˆ‘ä»¬éƒ½çˆ±ç”¨ WordPressï¼Œ(å‡ ä¹)ä¸€è¡Œä»£ç éƒ½ä¸ç”¨å†™ï¼Œå°±èƒ½å¾—åˆ°ä¸€ä¸ªå¥½çœ‹ã€å®ç”¨çš„åŠ¨æ€ç½‘ç«™ã€‚</p><p>è¿™ä¸œè¥¿ç”¨æ¥<del>æ•·è¡</del>å¸®åŠ©å„ç§æ‰¾ä½ å†™å¥‡æ€ªå°ç½‘ç«™çš„æœ‹å‹å†å¥½ä¸è¿‡äº†ã€‚é€šå¸¸ï¼Œå¸®æœ‹å‹éƒ¨ç½² WordPress çš„è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œä½ å¯ä»¥æ‰¾æœ‹å‹å¼€ä¸€å°æ–°çš„æœåŠ¡å™¨ï¼Œåˆå§‹åŒ–ä¸€å¥— LAMPï¼Œç›´æ¥æŠŠ WordPress ç»™ wget è¿›å»ï¼Œå°±å¯ä»¥åœ¨ä½ çš„æµè§ˆå™¨é‡Œå®Œæˆé…ç½®äº†ã€‚ æœ‰æ—¶å€™ï¼Œæ¯”å¦‚æ‚¨çš„æœ‹å‹ä½¿ç”¨é˜¿é‡Œäº‘ã€ç™¾åº¦äº‘æˆ–æ˜¯å…¶ä»–æ¯”è¾ƒå¤§çš„äº‘æœåŠ¡å•†ï¼Œæ‚¨ç”šè‡³å¯ä»¥ç›´æ¥åˆå§‹åŒ–ä¸€ä¸ª WordPress åº”ç”¨é•œåƒï¼Œç›´æ¥åœ¨æµè§ˆå™¨é‡Œå¼€å§‹è®¾ç½®ã€‚</p><p>ä½†æ˜¯ï¼Œå‰ä¸¤å¤©æˆ‘éœ€è¦åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šéƒ¨ç½²ä¸€ä¸ª WordPress æœåŠ¡ã€‚æˆ‘è¿™æ ·çš„è’Ÿè’»å½“ç„¶æ˜¯æ— ç¼˜ä½¿ç”¨ä¸–ç•Œä¸Šæœ€å¥½çš„ç¼–ç¨‹è¯­è¨€â€”â€” PHP çš„å•¦ã€‚æ²¡æœ‰ PHPï¼Œè¿˜éƒ¨ç½²ä¸ªå±çš„ WordPressã€‚è£…ä¸€ä¸ª PHP å§ï¼Œå¹³æ—¶ä¹Ÿä¸ç”¨ï¼Œè¿˜å¢åŠ äº†å®‰å…¨é£é™©ï¼Œä¸åˆ’ç®—ã€‚</p><p>è¿˜æ˜¯æœ‰ä¸€å°å…¨æ–°çš„ LAMP æœåŠ¡å™¨å¥½å•Šï¼Œä½†ä¸å¯èƒ½å†ä¹°ä¸€å°æœåŠ¡å™¨å§ã€‚æ‰€ä»¥å°±æƒ³åˆ°äº†â€”â€” <strong>Docker</strong>ï¼Œç”¨å®¹å™¨å»æŠŠå®ƒè£…èµ·æ¥å°±å¥½äº†å˜›ã€‚</p><p>æƒ³åˆ°å°±åŠ¨æ‰‹åšï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±çœ‹çœ‹æ€ä¹ˆç”¨ Docker éƒ¨ç½² WordPressã€‚</p><p>æ‰€ä»¥ï¼Œç°åœ¨ï¼Œæ‚¨çš„æœåŠ¡å™¨æˆ–ä¸ªäººç”µè„‘ä¸Šåº”è¯¥å·²ç»å®‰è£…å¥½äº† Dockerï¼Œåœ¨ç»å¤§å¤šæ•°é Windows çš„å¸¸è§„ç³»ç»Ÿä¸‹ï¼Œå®‰è£… Docker å°±æ˜¯å‡ æ¡ç®€å•çš„å‘½ä»¤ã€‚</p><h2 id="åœ¨ç»§ç»­ä¹‹å‰â€¦â€¦"><a href="#åœ¨ç»§ç»­ä¹‹å‰â€¦â€¦" class="headerlink" title="åœ¨ç»§ç»­ä¹‹å‰â€¦â€¦"></a>åœ¨ç»§ç»­ä¹‹å‰â€¦â€¦</h2><p>æ ¹æ®æ³•å¾‹è§„å®šï¼Œä»»ä½•æ¢è®¨å®¹å™¨çš„æ–‡ç« éƒ½å¿…é¡»é™„ä¸Šæ»¡è½½é›†è£…ç®±çš„é›†è£…ç®±èˆ¹çš„å›¾ç‰‡ï¼Œæ­£å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcvuveckw8j30m80dfqfs.jpg" alt="image-20200316163711817"></p><p>ï¼ˆè¿™ä¸ªä¼ ç»Ÿæ˜¯ä» <a href="https://www.ibm.com/developerworks/cn/cloud/library/cl-getting-started-docker-and-kubernetes/index.html">IBM Developer ä¸Šçš„è¿™ç¯‡æ–‡ç« </a> å­¦çš„ï¼Œå’±ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œä½†éµçºªå®ˆæ³•çš„ä¼˜ç§€å…±é’å›¢å‘˜å½“ç„¶æ˜¯è¦éµå®ˆè§„å®šçš„å•¦ã€‚ï¼‰</p><h2 id="æ‹‰å–é•œåƒ"><a href="#æ‹‰å–é•œåƒ" class="headerlink" title="æ‹‰å–é•œåƒ"></a>æ‹‰å–é•œåƒ</h2><p>WordPress è¿™ä¹ˆå¸¸ç”¨çš„ä¸œè¥¿å½“ç„¶æ˜¯æœ‰ç°æˆçš„é•œåƒçš„ï¼Œæˆ‘ä»¬å°±ä¸ç”¨è‡ªå·±å»å»ºäº†ã€‚</p><p>æœæ–­æ‹‰ä¸€ä¸ª wordpress é•œåƒï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull wordpress:latest</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œæ‚¨åº”è¯¥çŸ¥é“ï¼ŒWordPress éœ€è¦ MySQLã€‚</p><p>è¿™é‡Œæˆ‘ä»¬æœ‰ä¸¤ç§é€‰æ‹©ï¼Œä¸€æ˜¯ä½¿ç”¨å®¿ä¸»æœºæˆ–æ˜¯å…¶ä»–ä»»ä½•æœåŠ¡å™¨ä¸Šçš„ MySQL æ•°æ®åº“ï¼›äºŒæ˜¯ç”¨ä¸€ä¸ª MySQL Docker é•œåƒã€‚ä¸ºäº†æ–¹ä¾¿ï¼ŒåŒæ—¶ä¹Ÿå¤šç»ƒä¹  Docker çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬å¹²è„†å†æ‹‰ä¸€ä¸ª mysql é•œåƒï¼Œè®©æ•´å¥—æœåŠ¡å®Œå…¨åœ¨ docker é‡Œè¿è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull mysql:latest</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œè¿™ç¯‡æ–‡ç« å†™åœ¨ 2020 å¹´æ˜¥ï¼Œæ‰€ä»¥è¿™é‡Œ <code>mysql:latest</code> æ˜¯ <code>MySQL V8.0.19 </code>ã€‚</p><h2 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h2><p>åºŸè¯ä¸å¤šè¯´ï¼Œæœ‰äº†é•œåƒï¼Œæˆ‘ä»¬ç›´æ¥å¼€æœåŠ¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d --privileged=<span class="literal">true</span> --name Mysql_Test -v /data/mysql:/var/lib/mysql -e MYSQL_DATABASE=wordpress -e MYSQL_ROOT_PASSWORD=233333  mysql</span><br><span class="line">$ docker run -d --name Wordpress_Test -e WORDPRESS_DB_HOST=mysql -e WORDPRESS_DB_PASSWORD=233333 -p 2020:80 --link Mysql_Test:mysql wordpress</span><br></pre></td></tr></table></figure><p>OKï¼Œè¿™å°±æ˜¯ Docker çš„é­”åŠ›ï¼Œä¸ç”¨è£… PHPï¼Œä¸ç”¨ä¸ºäº†å®‰å…¨æ‚‰å¿ƒè€ƒè™‘ã€å¤§è‚†è®¾ç½®ï¼Œå‰å‰ååå°± 4 ä¸ªå‘½ä»¤æçš„ï¼ï¼ˆå½“ç„¶ï¼Œæˆ‘åªæ˜¯å¼€ä¸€ä¸ªç®€å•çš„å°æœåŠ¡ï¼ŒåŸºæœ¬æ²¡äººç”¨ï¼Œæ‰€ä»¥ä¹Ÿå°±å‡ ä¹æ²¡æœ‰å®‰å…¨é£é™©ï¼Œä½†æ‚¨åœ¨éƒ¨ç½²çš„æ—¶å€™è¿˜æ˜¯è¦èŠ±ç‚¹æ—¶é—´è®¤çœŸè€ƒè™‘å®‰å…¨é—®é¢˜çš„ï¼‰</p><p>æ¥ä¸‹æ¥å°±æ˜¯åœ¨æ‚¨çš„æµè§ˆå™¨è®¿é—® <code>http://xxx:2020/wp-admin/index.php</code>ï¼Œå®Œæˆ â€œè‘—åçš„â€ wordpress 5åˆ†é’Ÿå®‰è£…äº†ï¼</p><h2 id="ä½†æ˜¯â€¦â€¦"><a href="#ä½†æ˜¯â€¦â€¦" class="headerlink" title="ä½†æ˜¯â€¦â€¦"></a>ä½†æ˜¯â€¦â€¦</h2><p>å½“ä½ æ»¡å¿ƒæ¬¢å–œæ‰“å¼€æ‚¨çš„æ–°ç½‘ç«™æ—¶ï¼Œï¼Œä½ ä¼šå‘ç°ï¼Œwordpress æé†’ä½ ï¼šè¿ä¸ä¸Š mysqlã€‚ï¼ˆæˆ‘å¿˜æˆªå›¾äº†ï¼Œå®ƒä¼šå†™ä¸€å †è‹±æ–‡å‘Šè¯‰ä½ è¿™ä¸ªäº‹ï¼Œä½ èƒ½çœ‹æ‡‚ï¼‰</p><p>Google ä¼šå‘Šè¯‰æ‚¨ï¼Œè¿™ä¸ªé—®é¢˜æ˜¯ç”±äº mysql 8 çš„é»˜è®¤ç”¨æˆ·è®¤è¯æ–¹å¼æ”¹äº†ï¼Œwordpress ä¸è®¤è¯†ã€‚è¦è§£å†³ä¸éš¾ï¼Œæ‰“å¼€ mysql è®¾ç½®ä¸€ä¸‹ï¼ŒæŠŠè®¤è¯æ–¹å¼æ”¹æˆ Wordpress è®¤è¯†çš„æ ·å­å°±è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -it Mysql_Test mysql -p</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ mysql å‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use mysql;</span><br><span class="line">mysql&gt; select host, user, plugin from user;</span><br><span class="line">mysql&gt; ALTER USER &#39;root&#39;@&#39;%&#39; IDENTIFIED WITH mysql_native_password BY &#39;233333&#39;;</span><br><span class="line">mysql&gt; select host, user, plugin from user;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æŠŠ root çš„ plugin ä» <code>caching_sha2_password</code> æ”¹æˆäº† <code>mysql_native_password</code>ï¼Œè¿™æ ·å°±æ²¡é—®é¢˜äº†ã€‚</p><p>ç„¶åå†æ¬¡æµè§ˆå™¨è®¿é—® <code>http://xxx:2020/wp-admin/index.php</code>ï¼Œè¿™æ¬¡å°±åº”è¯¥æ˜¯ â€œè‘—åçš„â€ wordpress 5åˆ†é’Ÿå®‰è£…äº†ï¼Œæ‚¨å¯ä»¥è‡ªè¡Œå®Œæˆ :)</p>]]></content>
      
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode P141 ç¯å½¢é“¾è¡¨</title>
      <link href="/2020/03/12/School/Leetcode_P141_linked-list-cycle/"/>
      <url>/2020/03/12/School/Leetcode_P141_linked-list-cycle/</url>
      
        <content type="html"><![CDATA[<h1 id="Leetcode-P141-ç¯å½¢é“¾è¡¨"><a href="#Leetcode-P141-ç¯å½¢é“¾è¡¨" class="headerlink" title="Leetcode P141 ç¯å½¢é“¾è¡¨"></a>Leetcode P141 ç¯å½¢é“¾è¡¨</h1><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚</p><p>ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•° pos æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚ å¦‚æœ pos æ˜¯ -1ï¼Œåˆ™åœ¨è¯¥é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚ </p><p>ç¤ºä¾‹ 1ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead &#x3D; [3,2,0,-4], pos &#x3D; 1</span><br><span class="line">è¾“å‡ºï¼štrue</span><br><span class="line">è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹ã€‚</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 2ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead &#x3D; [1,2], pos &#x3D; 0</span><br><span class="line">è¾“å‡ºï¼štrue</span><br><span class="line">è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 3ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead &#x3D; [1], pos &#x3D; -1</span><br><span class="line">è¾“å‡ºï¼šfalse</span><br><span class="line">è§£é‡Šï¼šé“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚</span><br></pre></td></tr></table></figure><p>è¿›é˜¶ï¼š</p><p>ä½ èƒ½ç”¨ O(1)ï¼ˆå³ï¼Œå¸¸é‡ï¼‰å†…å­˜è§£å†³æ­¤é—®é¢˜å—ï¼Ÿ</p><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/linked-list-cycle">https://leetcode-cn.com/problems/linked-list-cycle</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p><h2 id="å“ˆå¸Œè¡¨æ³•"><a href="#å“ˆå¸Œè¡¨æ³•" class="headerlink" title="å“ˆå¸Œè¡¨æ³•"></a>å“ˆå¸Œè¡¨æ³•</h2><p>é¦–å…ˆï¼Œæœ€ç®€å•ç›´æ¥çš„æƒ³æ³•ï¼Œç”¨å“ˆå¸Œè¡¨ï¼Œéå†ä¸€ä¸ªå­˜ä¸€ä¸ªï¼Œæ¯æ¬¡éƒ½æ£€æŸ¥å½“å‰èŠ‚ç‚¹æ˜¯å¦å·²ç»å­˜è¿‡ï¼Œå­˜è¿‡å°±è¯´æ˜æœ‰ç¯ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * type ListNode struct &#123;</span></span><br><span class="line"><span class="comment"> *     Val int</span></span><br><span class="line"><span class="comment"> *     Next *ListNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hasCycle</span><span class="params">(head *ListNode)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> nodes := <span class="keyword">map</span>[*ListNode]<span class="keyword">bool</span>&#123;&#125;; head != <span class="literal">nil</span>; head = head.Next &#123;</span><br><span class="line">        <span class="keyword">if</span> (nodes[head] == <span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            nodes[head] = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcr749hdvdj31d60u01kx.jpg" alt="å±å¹•å¿«ç…§ 2020-03-12 15.33.08"></p><h2 id="å¿«æ…¢æŒ‡é’ˆæ³•"><a href="#å¿«æ…¢æŒ‡é’ˆæ³•" class="headerlink" title="å¿«æ…¢æŒ‡é’ˆæ³•"></a>å¿«æ…¢æŒ‡é’ˆæ³•</h2><p>è¿˜å¯ä»¥ç”¨å¿«æ…¢æŒ‡é’ˆæ³•ã€‚</p><p>æƒ³è±¡è¿™æ ·çš„æƒ…æ™¯ï¼šä¸¤äººæ¯”èµ›è·‘æ­¥ï¼Œç”²å¿«ï¼Œä¹™æ…¢ã€‚å¦‚æœèµ›é“æ— ç¯ï¼Œç›¸å½“äºå°±ä¸€æ¡ç›´çº¿ï¼Œè‚¯å®šæ˜¯ç”²å…ˆåˆ°ç»ˆç‚¹ï¼›å¦‚æœèµ›é“æœ‰ç¯ï¼Œåœ¨ç¯ä¸Šè·‘ï¼Œé€Ÿåº¦ä¸ä¸€æ ·çš„ç”²ä¹™å¿…ç„¶åœ¨æŸä¸€æ—¶åˆ»ç›¸é‡ã€‚</p><p>åˆ©ç”¨è¿™ä¸ªæ€è·¯ï¼Œèµ›é“æ˜¯é“¾è¡¨ï¼Œç”²ä¹™åŒ–èº«å¿«æ…¢æŒ‡é’ˆï¼Œå°±å¾—åˆ°äº†ç©ºé—´æ¶ˆè€— $O(1)$ çš„è§£æ³•ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * type ListNode struct &#123;</span></span><br><span class="line"><span class="comment"> *     Val int</span></span><br><span class="line"><span class="comment"> *     Next *ListNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hasCycle</span><span class="params">(head *ListNode)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="literal">nil</span>) || (head.Next == <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    slow, fast := head, head.Next</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> slow != fast &#123;</span><br><span class="line">        <span class="keyword">if</span> fast == <span class="literal">nil</span> || fast.Next == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        fast, slow = fast.Next.Next, slow.Next</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcr730im9jj31d60u01kx.jpg" alt="image-20200312155153189"></p><hr><h2 id="é¢˜å¤–è¯"><a href="#é¢˜å¤–è¯" class="headerlink" title="é¢˜å¤–è¯"></a>é¢˜å¤–è¯</h2><p>æ€»æœ‰äººé—®æˆ‘æ¯å¤©å†™ä»£ç å¿«ä¹å—ï¼Ÿå›¾ä¸ªå•¥å‘€ï¼Ÿ</p><p>ä»Šå¤©çœ‹ä¹¦çš„æ—¶å€™ï¼Œçœ‹åˆ°ä¸€æ®µå¾ˆæœ‰æ„Ÿè§¦çš„è¯ï¼Œç®—æ˜¯å¯¹è¿™ä¸ªé—®é¢˜çš„å›ç­”å§ï¼Œæ”¶è—äº†ï¼š</p><blockquote><p>There is much joy in programming. There is joy in analyzing a problem, breaking it down into pieces, formulating a solution, mapping out a strategy, approaching it from different directions, and crafting the code. There is very much joy in seeing the program run for the first time, and then more joy in eagerly diving back into the code to make it better and faster.</p><p>There is also often joy in hunting down bugs, in ensuring that the program runs smoothly and predictably. Few occasions are quite as joyful as finally identifying a particularly recalcitrant bug and defin- itively stamping it out.</p><p>There is even joy in realizing that the original approach you took is not quite the best. Many developers discover that theyâ€™ve learned a lot while writing a program, including that thereâ€™s a better way to structure the code. Sometimes, a partial or even a total rewrite can result in a much better application, or simply one that is structurally more coherent and easier to maintain. The process is like standing on oneâ€™s own shoulders, and there is much joy in attaining that perspective and knowledge.</p><hr><p>â€‹    From <em>Creating Mobile Apps with Xamarin</em></p><p>â€‹            Chapter 1 <em>How does Xamarin.Forms fit in?</em></p></blockquote><p>å“ˆå“ˆï¼Œä¼Ÿäººç«™åœ¨å·¨äººè‚©è†€ä¸Šéšå’Œå¾®ç¬‘ï¼Œè’Ÿè’»ç«™åœ¨è‡ªå·±è‚©è†€ä¸Šçœ‹ç€ä»£ç å‚»ç¬‘ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode P83 åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ </title>
      <link href="/2020/03/11/School/Leetcode_P83_remove-duplicates-from-sorted-list/"/>
      <url>/2020/03/11/School/Leetcode_P83_remove-duplicates-from-sorted-list/</url>
      
        <content type="html"><![CDATA[<h1 id="Leetcode-P83-åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ "><a href="#Leetcode-P83-åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ " class="headerlink" title="Leetcode P83 åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ "></a>Leetcode P83 åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ </h1><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>ç»™å®šä¸€ä¸ªæ’åºé“¾è¡¨ï¼Œåˆ é™¤æ‰€æœ‰é‡å¤çš„å…ƒç´ ï¼Œä½¿å¾—æ¯ä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ã€‚</p><p>ç¤ºä¾‹ 1:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: 1-&gt;1-&gt;2</span><br><span class="line">è¾“å‡º: 1-&gt;2</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 2:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: 1-&gt;1-&gt;2-&gt;3-&gt;3</span><br><span class="line">è¾“å‡º: 1-&gt;2-&gt;3</span><br></pre></td></tr></table></figure><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/remove-duplicates-from-sorted-list">https://leetcode-cn.com/problems/remove-duplicates-from-sorted-list</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p><h2 id="åŒæŒ‡é’ˆæ³•"><a href="#åŒæŒ‡é’ˆæ³•" class="headerlink" title="åŒæŒ‡é’ˆæ³•"></a>åŒæŒ‡é’ˆæ³•</h2><p>è¿™é“é¢˜è¿˜æ˜¯å¾ˆå®¹æ˜“çš„ï¼ŒåŒæŒ‡é’ˆæ³•ï¼Œå’Œ <a href="https://blog.csdn.net/u012419550/article/details/104402182">Leetcode P26 åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹</a> ä¸€æ ·çš„ç®—æ³•ï¼Œåªæ˜¯æŠŠæ•°ç»„æ”¹æˆé“¾è¡¨ï¼ˆç”šè‡³æˆ‘è¿˜è§‰å¾—æ›´ç®€å•äº†ï¼Ÿï¼‰</p><p>å°±æä¸¤ä¸ªæŒ‡é’ˆ <code>current</code> å’Œ <code>toDel</code>ï¼Œ<code>current</code> éå†é“¾è¡¨ï¼Œç»´æŠ¤ <code>toDel</code> å‰çš„èŠ‚ç‚¹å€¼ä¸é‡å¤ã€‚ç›´æ¥ä¸Šä»£ç å§ï¼ŒGolangï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * type ListNode struct &#123;</span></span><br><span class="line"><span class="comment"> *     Val int</span></span><br><span class="line"><span class="comment"> *     Next *ListNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deleteDuplicates</span><span class="params">(head *ListNode)</span> *<span class="title">ListNode</span></span> &#123;</span><br><span class="line">    current := head</span><br><span class="line">    toDel := head</span><br><span class="line">    <span class="keyword">for</span> current != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> current.Val != toDel.Val &#123;</span><br><span class="line">            toDel.Next = current</span><br><span class="line">            toDel = current</span><br><span class="line">        &#125;</span><br><span class="line">        current = current.Next</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> toDel != <span class="literal">nil</span> &amp;&amp; toDel.Next != <span class="literal">nil</span> &amp;&amp; toDel.Next.Val == toDel.Val &#123;</span><br><span class="line">        toDel.Next = <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> head</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcq2u4ysbpj31d60u0e7f.jpg" alt="å±å¹•å¿«ç…§ 2020-03-11 16.36.36"></p><h2 id="ä¼˜åŒ–ï¼šå•æŒ‡é’ˆ"><a href="#ä¼˜åŒ–ï¼šå•æŒ‡é’ˆ" class="headerlink" title="ä¼˜åŒ–ï¼šå•æŒ‡é’ˆ"></a>ä¼˜åŒ–ï¼šå•æŒ‡é’ˆ</h2><p>è¿™ä¸ªé¢˜è¿˜å¯ä»¥åªç”¨ä¸€ä¸ªæŒ‡é’ˆå®Œæˆï¼Œå› ä¸ºé“¾è¡¨æ˜¯ç”¨æŒ‡é’ˆæŒ‡ä¸‹ä¸€ä¸ªçš„å˜›ï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°æŠŠä»»æ„èŠ‚ç‚¹çš„ä¸‹ä¸€èŠ‚ç‚¹æ”¹æˆå…¶åçš„æŸä¸€èŠ‚ç‚¹ï¼Œæ¥è¾¾åˆ°â€œåˆ é™¤â€ä¸­é—´çš„ä¸€äº›èŠ‚ç‚¹çš„ç›®çš„ã€‚æ¯”å¦‚<code>current.Next = current.Next.Next</code>ï¼Œå°±ç›¸å½“äºæŠŠ <code>current.Next</code> åˆ é™¤äº†ã€‚</p><p>ç”¨è¿™ä¸ªæ€è·¯å°±å¯ä»¥ç”¨ä¸€ä¸ªæŒ‡é’ˆæŠŠé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ åˆ é™¤ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * type ListNode struct &#123;</span></span><br><span class="line"><span class="comment"> *     Val int</span></span><br><span class="line"><span class="comment"> *     Next *ListNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deleteDuplicates</span><span class="params">(head *ListNode)</span> *<span class="title">ListNode</span></span> &#123;</span><br><span class="line">    current := head</span><br><span class="line">    <span class="keyword">for</span> (current != <span class="literal">nil</span>) &amp;&amp; (current.Next != <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> current.Next.Val == current.Val &#123;</span><br><span class="line">            current.Next = current.Next.Next</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            current = current.Next</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> head</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcq3j6dznqj31d60u04qp.jpg" alt="image-20200311170330484"></p><p>å“ˆå“ˆï¼Œä¸€å¼€å§‹æˆ‘æ²¡å†™ else åˆ†å¥ï¼Œ<code>current = current.Next</code> å†™åœ¨å¤–é¢ï¼Œè¿™ä¹ˆåšæ˜¯é”™çš„ï¼Œå¦‚æœè¾“å…¥æ˜¯ <code>[1,1,1,1]</code>ï¼Œå°±ä¼šè¾“å‡º <code>[1,1]</code>ï¼Œå°‘äº†å°¾éƒ¨æœ€åçš„å¤„ç†ã€‚ç„¶åæˆ‘æ”¹è¿™ä¸ªçš„æ—¶å€™é¡ºæ‰‹æŠŠ for æ¡ä»¶é‡Œçš„ <code>current != nil</code> ä¹Ÿåˆ äº†ï¼Œä½†ä»–æœ‰ <code>[]</code> çš„è¾“å…¥ï¼Œåˆé”™äº†ä¸€æ¬¡ğŸ¤¦â€â™‚ï¸</p>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode P21 åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨</title>
      <link href="/2020/03/10/School/Leetcode_P21_merge-two-sorted-lists/"/>
      <url>/2020/03/10/School/Leetcode_P21_merge-two-sorted-lists/</url>
      
        <content type="html"><![CDATA[<h1 id="Leetcode-P21-åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨"><a href="#Leetcode-P21-åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨" class="headerlink" title="Leetcode P21 åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨"></a>Leetcode P21 åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨</h1><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>å°†ä¸¤ä¸ªæœ‰åºé“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„æœ‰åºé“¾è¡¨å¹¶è¿”å›ã€‚æ–°é“¾è¡¨æ˜¯é€šè¿‡æ‹¼æ¥ç»™å®šçš„ä¸¤ä¸ªé“¾è¡¨çš„æ‰€æœ‰èŠ‚ç‚¹ç»„æˆçš„ã€‚ </p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š1-&gt;2-&gt;4, 1-&gt;3-&gt;4</span><br><span class="line">è¾“å‡ºï¼š1-&gt;1-&gt;2-&gt;3-&gt;4-&gt;4</span><br></pre></td></tr></table></figure><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/merge-two-sorted-lists">https://leetcode-cn.com/problems/merge-two-sorted-lists</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p><h2 id="ç›´è§‚è§£æ³•"><a href="#ç›´è§‚è§£æ³•" class="headerlink" title="ç›´è§‚è§£æ³•"></a>ç›´è§‚è§£æ³•</h2><p>é¦–å…ˆæˆ‘ä»¬å°è¯•ç”¨å½’å¹¶çš„æ–¹æ³•ï¼Œå’Œæˆ‘ä»¬åš <a href="https://blog.csdn.net/u012419550/article/details/104527464">Leetcode P88</a> çš„æ–¹æ³•ä¸€æ ·ï¼Œåªæ˜¯æŠŠæ•°ç»„æ¢æˆé“¾è¡¨ã€‚</p><p>Golang å®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * type ListNode struct &#123;</span></span><br><span class="line"><span class="comment"> *     Val int</span></span><br><span class="line"><span class="comment"> *     Next *ListNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mergeTwoLists</span><span class="params">(l1 *ListNode, l2 *ListNode)</span> *<span class="title">ListNode</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> l1 == <span class="literal">nil</span> &amp;&amp; l2 == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    merged := &amp;ListNode&#123;&#125;</span><br><span class="line">    head := merged</span><br><span class="line">    <span class="keyword">for</span> (l1 != <span class="literal">nil</span>) || (l2 != <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> l1 == <span class="literal">nil</span> &#123;</span><br><span class="line">            merged.Val = l2.Val</span><br><span class="line">            l2 = l2.Next</span><br><span class="line">            <span class="keyword">goto</span> NEXT_MERGED</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> l2 == <span class="literal">nil</span> &#123;</span><br><span class="line">            merged.Val = l1.Val</span><br><span class="line">            l1 = l1.Next</span><br><span class="line">            <span class="keyword">goto</span> NEXT_MERGED</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> l1.Val &lt;= l2.Val &#123;</span><br><span class="line">            merged.Val = l1.Val</span><br><span class="line">            l1 = l1.Next</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            merged.Val = l2.Val</span><br><span class="line">            l2 = l2.Next</span><br><span class="line">        &#125;</span><br><span class="line">NEXT_MERGED:</span><br><span class="line">        <span class="keyword">if</span> (l1 != <span class="literal">nil</span>) || (l2 != <span class="literal">nil</span>) &#123;</span><br><span class="line">            merged.Next = &amp;ListNode&#123;&#125;</span><br><span class="line">            merged = merged.Next</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> head</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ«ä»‹æ„æˆ‘çš„ <code>goto</code>ï¼Œéƒ½è¯´ä¸è¦ç”¨ gotoï¼Œä½†æˆ‘è§‰å¾—ç”¨åœ¨è¿™é‡Œå°±æŒºå¥½ï¼ä½ å†™ä¸ªæ­£å¸¸çš„æ¡ä»¶è·³è½¬ï¼Œå˜æˆæ±‡ç¼–çš„æ—¶å€™ä¸è¿˜æ˜¯ä¸ª goto ä¹ˆâ€¦â€¦</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcp3ipsv29j31d60u0e7r.jpg" alt="å±å¹•å¿«ç…§ 2020-03-10 20.09.22"></p><h2 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h2><p>Wocï¼Œæˆ‘åˆšæ‰å‚»äº†ï¼Œå±…ç„¶ä¸åœçš„ new å‡º <code> &amp;ListNode&#123;&#125;</code> æ¥ï¼Œç›´æ¥ç”¨åŸæ¥çš„èŠ‚ç‚¹ä¸å°±å¥½äº†ä¹ˆï¼Œéš¾æ€ªåˆšæ‰é‚£ä¹ˆé«˜ç©ºé—´å ç”¨ã€‚ã€‚ã€‚</p><p>ä¼˜åŒ–ä¸€ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * type ListNode struct &#123;</span></span><br><span class="line"><span class="comment"> *     Val int</span></span><br><span class="line"><span class="comment"> *     Next *ListNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mergeTwoLists</span><span class="params">(l1 *ListNode, l2 *ListNode)</span> *<span class="title">ListNode</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> l1 == <span class="literal">nil</span> &amp;&amp; l2 == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    merged := &amp;ListNode&#123;&#125;</span><br><span class="line">    head := merged</span><br><span class="line">    <span class="keyword">for</span> (l1 != <span class="literal">nil</span>) || (l2 != <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> l1 == <span class="literal">nil</span> &#123;</span><br><span class="line">            merged.Next = l2</span><br><span class="line">            l2 = l2.Next</span><br><span class="line">            <span class="keyword">goto</span> NEXT_MERGED</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> l2 == <span class="literal">nil</span> &#123;</span><br><span class="line">            merged.Next = l1</span><br><span class="line">            l1 = l1.Next</span><br><span class="line">            <span class="keyword">goto</span> NEXT_MERGED</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> l1.Val &lt;= l2.Val &#123;</span><br><span class="line">            merged.Next = l1</span><br><span class="line">            l1 = l1.Next</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            merged.Next = l2</span><br><span class="line">            l2 = l2.Next</span><br><span class="line">        &#125;</span><br><span class="line">NEXT_MERGED:</span><br><span class="line">        <span class="keyword">if</span> (l1 != <span class="literal">nil</span>) || (l2 != <span class="literal">nil</span>) &#123;</span><br><span class="line">            merged = merged.Next</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> head.Next</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcp3saqmlbj31d60u01kx.jpg" alt="image-20200310202641869"></p><p>â€¦â€¦</p><p>å¥½å§ï¼Œè¿™ Leetcode å°±è¿™æ ·ï¼Œç»å¸¸æ˜¯ä½ å»ä¼˜åŒ–ä¸€ä¸‹ä»£ç è¿˜æ›´æ…¢äº†ğŸ˜‚</p><h2 id="å†ä¼˜åŒ–"><a href="#å†ä¼˜åŒ–" class="headerlink" title="å†ä¼˜åŒ–"></a>å†ä¼˜åŒ–</h2><p>å…¶å®ï¼Œè¿˜å¯ä»¥å†ä¼˜åŒ–ä¸€ç‚¹ï¼Œå¦‚æœä¸€æ¡é“¾ä¸ºç©ºäº†ï¼Œé‚£ç›´æ¥æŠŠå¦ä¸€æ¡é“¾æ¥åˆ°åˆå¹¶åçš„é“¾ä¸Šå°±å¥½äº†ï¼Œä¸ç”¨å†è¿­ä»£ç€ä¸€ä¸ªä¸€ä¸ªèŠ‚ç‚¹åœ°æ¥ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * type ListNode struct &#123;</span></span><br><span class="line"><span class="comment"> *     Val int</span></span><br><span class="line"><span class="comment"> *     Next *ListNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mergeTwoLists</span><span class="params">(l1 *ListNode, l2 *ListNode)</span> *<span class="title">ListNode</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> l1 == <span class="literal">nil</span> &amp;&amp; l2 == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    merged := &amp;ListNode&#123;&#125;</span><br><span class="line">    head := merged</span><br><span class="line">    <span class="keyword">for</span> (l1 != <span class="literal">nil</span>) &amp;&amp; (l2 != <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> l1.Val &lt;= l2.Val &#123;</span><br><span class="line">            merged.Next = l1</span><br><span class="line">            l1 = l1.Next</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            merged.Next = l2</span><br><span class="line">            l2 = l2.Next</span><br><span class="line">        &#125;</span><br><span class="line">        merged = merged.Next</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> l1 == <span class="literal">nil</span> &#123;</span><br><span class="line">        merged.Next = l2</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> l2 == <span class="literal">nil</span> &#123;</span><br><span class="line">        merged.Next = l1</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> head.Next</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcp3xaldorj31d60u01kx.jpg" alt="image-20200310203129875"></p><p>å·®ä¸å¤šå°±è¿™æ ·äº†å§ğŸ¤·â€â™‚ï¸</p>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å•é“¾è¡¨å®è·µâ€”â€”åŸå¸‚åˆ—è¡¨</title>
      <link href="/2020/03/05/School/TrySLinkList_CityList/"/>
      <url>/2020/03/05/School/TrySLinkList_CityList/</url>
      
        <content type="html"><![CDATA[<h1 id="å•é“¾è¡¨å®è·µâ€”â€”åŸå¸‚åˆ—è¡¨"><a href="#å•é“¾è¡¨å®è·µâ€”â€”åŸå¸‚åˆ—è¡¨" class="headerlink" title="å•é“¾è¡¨å®è·µâ€”â€”åŸå¸‚åˆ—è¡¨"></a>å•é“¾è¡¨å®è·µâ€”â€”åŸå¸‚åˆ—è¡¨</h1><p>ï¼ˆå¤šå›¾è­¦å‘Šï¼æˆ‘æ”¾äº†ä¸€å¤§å †ç±»å›¾ã€æˆªå›¾ï¼‰</p><p>ï¼ˆå¤šåºŸè¯è­¦å‘Šï¼æˆ‘ä¸å°å¿ƒåœ¨å¿ƒæƒ…ä¸å¥½çš„æ—¶å€™å†™äº†ä¸€å¤§å †åºŸè¯è¿›æ¥ï¼‰</p><p>ï¼ˆå¤šä»£ç è­¦å‘Šï¼æˆ‘æ‡’å¾—æ‹£å…³é”®çš„ä»£ç äº†ï¼Œæˆ‘æŠŠæ•´ä¸ªå·¥ç¨‹é‡Œå’Œé¢˜ç›®ç›¸å…³çš„ä»£ç å…¨æ‰”è¿›æ¥äº†ï¼Œç¼–è¾‘çš„æ—¶å€™ Typora éƒ½æœ‰ç‚¹å¡äº†ï¼‰</p><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gciubwcduej30la0g1jta.jpg" alt="UNADJUSTEDNONRAW_thumb_28c8"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gciubzcavxj30lc0fymyl.jpg" alt="UNADJUSTEDNONRAW_thumb_28c9"></p><h2 id="ï¼ˆè’Ÿè’»çš„æŠ±æ€¨ï¼‰"><a href="#ï¼ˆè’Ÿè’»çš„æŠ±æ€¨ï¼‰" class="headerlink" title="ï¼ˆè’Ÿè’»çš„æŠ±æ€¨ï¼‰"></a>ï¼ˆè’Ÿè’»çš„æŠ±æ€¨ï¼‰</h2><p>â€œè¿™å¯å¤ªéš¾äº†å‘€ï¼â€</p><p>ç”µè„‘å‰çš„è’Ÿè’»çŒ›åœ°åç›´äº†èº«å­ï¼Œé‚£åŒé¢¤å·å·çš„æ‰‹åƒæ˜¯æ¥è‡ªç½¹æ‚£å¸•é‡‘æ£®çš„è€äººï¼Œå‡ ç»å°è¯•ï¼Œæ‰ä¸€åªæŠ“èµ·äº†ä¹±æ‰”çš„æŠ¹å¸ƒï¼Œç‹ ç‹ åœ°æ“¦æ‹­ç€å¹¶ä¸è„çš„å±å¹•ï¼›å¦ä¸€åªæ‰èµ·äº†è‡ªå·±çš„çœ¼ç›â€”â€”è’Ÿè’»ç›¸ä¿¡ï¼Œè¿™ä¸æ˜¯å¹»è§‰å°±æ˜¯å±å¹•å‡ºäº†é—®é¢˜ã€‚</p><p>çª—ä½“åº”ç”¨å‘ï¼åˆæ˜¯çª—ä½“åº”ç”¨ï¼è’Ÿè’»è¿˜è®°å¾—å‡ ä¸ªæœˆå‰è‡ªå·±ä¸ºäº†å®Œæˆè¦æ±‚ç”¨ C# å†™çš„çª—ä½“å°é—¹é’Ÿï¼Œå…³æ‰äº† IDEAã€é€€å‡ºäº† Xcodeï¼Œç¿»è¶Šäº†ä¿æŠ¤ç€ä»–ç”Ÿå‘½è´¢äº§å®‰å…¨çš„é«˜å¢™ï¼Œä¸‹è½½äº† dotnet coreï¼Œå®‰è£…äº† Visual Studio for Macï¼Œå¼€å§‹åœ¨ Xamarin çš„ä¸–ç•Œé‡Œå››å¤„ç¢°å£ï¼Œç¢°å¾—é¼»é’è„¸è‚¿ã€ç¢°å¾—å¤´ç ´è¡€æµã€‚æœ€åè™½ç„¶å¦‚æœŸæŠŠä¸œè¥¿åšäº†å‡ºæ¥ï¼Œå´è½å¾—ä¸ª128GBçš„ MacBook ç¡¬ç›˜çˆ†æ»¡çš„ä¸‹åœºã€‚</p><p>å¦‚ä»Šä¼¤ç—›æœªæ„ˆã€ç£ç›˜æœªæ¸…ï¼Œåˆæƒ¨é­çª—ä½“ä½œä¸šå½“å¤´ä¸€æ£’ï¼è’Ÿè’»é™¤äº†æ€€ç–‘è‡ªå·±çš„çœ¼ç›æˆ–å±å¹•è¿˜æœ‰å…¶ä»–é€‰æ‹©å˜›ï¼Ÿ</p><p>â€œæˆ‘***ä¸å†™ C# äº†ï¼Swing è¿‡æ°”äº†ä¹ˆï¼ŸPyTk ä¸èƒ½ç”¨ä¹ˆï¼ŸWeb å¼€å‘ä¸é¦™ä¹ˆï¼Ÿâ€ï¼Œè’Ÿè’»æ— å£°åœ°åœ¨å†…å¿ƒå’†å“®ç€ï¼Œâ€œiOS è™½ç„¶è¿˜ä¸ç†Ÿï¼Œä½†å°è¯•å†™ä¹Ÿæ²¡é—®é¢˜ï¼å†ä¸æµï¼Œæˆ‘è¿˜ä¼š Android å¼€å‘â€¦â€¦â€</p><p>â€¦â€¦ï¼ˆğŸ‘†ä¸€ä¸ªè®©äººæ„å¤–çš„å¼ºè¡Œè½¬æŠ˜ğŸ‘‡ï¼‰â€¦â€¦</p><p>ä¸‰æœˆçš„æ˜†æ˜ä¾ç„¶è¿·äººã€‚æ˜¨å¤©ä¸‹äº†é›¨ï¼Œä»Šå¤©åˆæ˜¯è‰³é˜³é«˜ç…§ï¼Œçª—å¤–é•¿äº†7å±‚æ¥¼é«˜çš„è¡Œé“æ ‘éšé£æ¬¢èˆâ€”â€”æ˜¥é£æ—¶è€Œå’Œç…¦ã€å¿½åˆæš´èºï¼Œè°çŸ¥é“æ˜¯å“ªæ¥çš„åŠ›æ°”ï¼Œå®ƒä¼¼ä¹ä»ä¸ç–²æƒ«ï¼Œå®ƒä¸æ–­åœ°æŠŠæœªæ•£å°½æ³¥åœŸèŠ³é¦™çš„ç”˜ç”œç©ºæ°”é€è¿›è’Ÿè’»å¡æ»¡äº†çº¸å¼ ã€ä¹¦ç±å’Œç”µå­äº§å“çš„æˆ¿é—´ã€‚è°ƒçš®çš„<del>é£å…ƒç´ </del>é£å„¿èµ°æ—¶è¿˜ä¸å¿˜åœ¨è’Ÿè’»çš„æ¸…èŒ¶ä¸Šæ¼¾èµ·ä¸€ä¸ªå¾®ç¬‘ã€‚</p><p>â€œå‘¼â€”â€”â€ï¼Œä¸€æ—¶è¢«è¿™æ™¯è±¡å¸å–äº†é­‚é­„çš„è’Ÿè’»è¿™æ‰ç¼“ç¼“å›ç¥ï¼Œçœ‹ç€ä¸çŸ¥ä¸è§‰åœ¨ Typora é‡Œæ•²ä¸‹çš„è¿™å †æ–‡å­—ï¼Œä¸€æ—¶å¿ƒé‡Œä¸æ˜¯æ»‹å‘³ã€‚</p><p>æ˜¯å•Šï¼Œæœ€è¿‘è’Ÿè’»æœ‰äº›è¿·èŒ«ï¼Œä¸çŸ¥é“è¯¥ç”¨ä»€ä¹ˆè¯­è¨€ã€ä»€ä¹ˆæ¡†æ¶å†™ä½œä¸šæˆ–æ˜¯è‡ªå·±çš„é¡¹ç›®äº†ã€‚è’Ÿè’»å­¦çš„å¤ªæ‚äº†ï¼Œæ¯æ¬¡å¼€å‘éƒ½å¿…é¡»ä»é‚£ä¹ˆå¤šç§æŠ€æœ¯ä¸­æŒ‘ä¸€ä¸ªå‡ºæ¥ç”¨ï¼Œè¿™æ—¶çš„è’Ÿè’»æ€»æ˜¯ä¸å ªæ‰¿å—æŠ›å¼ƒå…¶ä»–è¯­è¨€çš„ç—›è‹¦ã€‚</p><p>â€œä½†æ˜¯æ²¡åŠæ³•ï¼Œè°è®©æˆ‘ä¹æ„å‘¢â€¦â€¦â€</p><p>è’Ÿè’»æ²¡æœ‰åŠæ³•ï¼Œåªå¥½è®©ä¸Šå¤©æ¥å†³å®šè¿™ä¸€åˆ‡äº†ã€‚è’Ÿè’»é—­ä¸Šäº†çœ¼ç›ï¼Œä»¿ä½›è¿™æ ·èƒ½å‡è½»å†…å¿ƒçš„ç—›è‹¦ã€‚æ‘¸èµ·æ¡Œä¸Šçš„ D12ï¼Œè’Ÿè’»çš„æ‰‹é¢¤æŠ–åœ°æ›´å‰å®³äº†ï¼Œç°åœ¨æ˜¯çº¿æ€§é©¬è¾¾è€Œä¸æ˜¯å¸•é‡‘æ£®äº†â€”â€”æ·éª°å­çš„ç»“æœç€å®è®©è’Ÿè’»åƒäº†ä¸€æƒŠâ€”â€”</p><p>æ˜¯ Xamarinï¼</p><p>ä¸è¿‡ Xamarin å°± Xamarin å§ï¼Œä¸Šå¤©æ€»æ˜¯å¯¹è’Ÿè’»åšäº›å¥‡å¥‡æ€ªæ€ªçš„äº‹æƒ…ï¼Œè’Ÿè’»å·²ç»ä¸ç›¸ä¿¡ä¸Šå¸æˆ–ä»»ä½•ç¥çµäº†ã€‚</p><p>åŒçœ¼çš„ç„¦è·åœ¨æ…¢æ…¢æ¢å¤ï¼Œæ‰‹æŒ‡çš„é¢¤åŠ¨åƒæ˜¯æ–­äº†ç”µèˆ¬éª¤ç„¶æ­¢ä½ï¼Œåœ¨è§¦æ§æ¿ä¸Šä¸€åˆ’ä¸€ç‚¹ï¼Œåˆ†æ¯«ä¸å·®ï¼ŒVisual Studio for Mac åœ¨è’Ÿè’»çœ¼å‰æµ®ç°ã€‚</p><hr><p>ï¼ˆè¿™ä¸¤å¤©å¿ƒé‡Œé¢‡ä¸å®é™â€¦â€¦ä¸€ä¸å°å¿ƒå°±å†™äº†è¿™ä¹ˆå¤šæœ‰çš„æ²¡çš„ï¼Œæµªè´¹äº†è‡ªå·±çš„æ—¶é—´ï¼Œæ²¡æœ‰ä»»ä½•æ„ä¹‰â€¦â€¦ï¼‰</p><p>ï¼ˆç”Ÿæ´»ã€æ¢¦å¢ƒã€å­¦ä¹ ä¸­çš„äº‹éƒ½è®©äººå¤´ç–¼ï¼Œè¿˜æ˜¯å†™ä»£ç è®©äººæ„‰å¿«å•Šï¼æ‰€ä»¥å†™ä»£ç å»äº†ï¼Œä¸€ä¼šå„¿å†æ¥ç€å†™è¿™ç¯‡æ–‡ç« ã€‚ï¼‰</p><h2 id="æˆæœå±•ç¤º"><a href="#æˆæœå±•ç¤º" class="headerlink" title="æˆæœå±•ç¤º"></a>æˆæœå±•ç¤º</h2><p>Okï¼Œä»£ç æˆ‘å†™å¥½äº†ï¼Œå›æ¥æ¥ç€æ°´åšå®¢ã€‚ç°åœ¨è·ç¦»å†™ä¸Šé¢é‚£ä¸€æ®µä¸œè¥¿è¿‡å»äº†ä¸¤å¤©ã€‚ä¸­é—´é‡åˆ°äº†ä¸€äº›é—®é¢˜ä¸¥é‡æ‹–å»¶äº†è¿›åº¦ï¼Œæœ€åè¿˜æ˜¯æˆ–ä¼˜é›…æˆ–ç¬¨æ‹™åœ°è§£å†³äº†ï¼Œä¸€ä¼šå„¿æˆ‘ä»¬ä¼šæåˆ°ã€‚</p><p>è¯ä¸å¤šè¯´ï¼Œå…ˆçœ‹æˆæœï¼</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcmbm5cgscj32b50u0hac.jpg" alt="IMG_467"></p><p>ï¼ˆæ˜¯çš„ï¼Œè¿™ä¸ªåŸå¸‚é“¾è¡¨åªæ˜¯è¿™ä¸ª App é‡Œçš„ä¸€ä¸ªåŠŸèƒ½ï¼æˆ‘æƒ³æŠŠè¿™ä¸ª App å†™æˆä¸€ä¸ªæ¯”è¾ƒå…¨çš„æ•°æ®ç»“æ„ä¸ç®—æ³•æ¼”ç¤ºã€‚ï¼‰</p><p>å†çœ‹çœ‹ Android ä¸­çš„æ•ˆæœï¼ˆæˆ‘è®¾è®¡ UI çš„æ—¶å€™æ˜¯æŒ‰å…¨é¢å±æ¥çš„ï¼Œæˆ‘çš„è€ Android æ‰‹æœºå±å¹•å°ï¼Œæ•ˆæœä¸å¤ªå¥½ï¼‰ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gclnjf1t53j32ce0u0n5o.jpg" alt="IMG_455"></p><p>è¿™å°±æ˜¯æ¯”èµ· Flutterï¼Œæˆ‘æœ‰æ—¶æ›´å–œæ¬¢ Xamarin çš„åœ°æ–¹ï¼Œæˆ‘å‡ ä¹å®Œå…¨æ²¡æœ‰è‡ªå®šä¹‰å¸ƒå±€ï¼Œå¾—åˆ°çš„ App åœ¨ iOS ä¸Šå°±æ˜¯éµå®ˆ Human Interface Guidelines çš„åŸç”Ÿ iOS çš„æ„Ÿè§‰ï¼Œåœ¨ Android ä¸Šå°±æ˜¯ç¬¦åˆ Material Design çš„è°·æ­ŒåŸç”Ÿçš„æ„Ÿè§‰ï¼æˆ‘ç”¨ Mac ä¸èƒ½ç”Ÿæˆ UWPï¼Œä¸ç„¶è¿™å¥—ä»£ç è¿˜å¯ä»¥ç”Ÿæˆä¸€ä¸ªåœ¨ Windows 10 ä¸Šå®ç° Fluent Design çš„å¾®è½¯åŸç”Ÿçš„ç‰ˆæœ¬ï¼</p><p>è€Œä¸”åœ¨è¿™é‡Œæˆ‘è¿˜æœ‰æ„å¤–çš„å‘ç°ï¼Œåœ¨ iOS 13 ä¸Šï¼ŒXamarin ç”Ÿæˆçš„ App è‡ªåŠ¨æ”¯æŒ Dark Modeï¼åªè¦æ˜¯æ²¡æŒ‡å®šé¢œè‰²çš„æ§ä»¶ï¼Œéƒ½ä¼šè‡ªåŠ¨æŒ‰ç…§ Apple çš„è®¾è®¡å‡†åˆ™æ”¯æŒæš—è‰²æ¨¡å¼ã€‚ä½†ç”±äºæˆ‘ä¸€å¼€å§‹å†™äº†å‡ ä¸ª <code>Background=&quot;#FAFAFA&quot;</code> ä¹‹ç±»çš„ç»†èŠ‚é¢œè‰²æŒ‡å®šï¼Œå°±ä¼šåœ¨æš—è‰²ä¸­å¤¹æ‚ä¸€å—çº¯ç™½ï¼Œå¾ˆä¸‘ï¼Œæˆ‘ä¹‹åå†æƒ³åŠæ³•è§£å†³ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è®¨è®ºå¦‚ä½•å®ç°è¿™æ ·çš„ä¸€ä¸ª Demo Appï¼ˆæˆ‘ä»¬åªç€é‡è®¨è®ºé¢˜ç›®éƒ¨åˆ†çš„ä¸œè¥¿ï¼Œä¹Ÿå°±æ˜¯â€œåŸå¸‚é“¾è¡¨â€ç‚¹è¿›å»çš„å…·ä½“ Demo éƒ¨åˆ†ï¼‰ã€‚</p><h2 id="åŸå¸‚åˆ—è¡¨è®¾è®¡å®ç°"><a href="#åŸå¸‚åˆ—è¡¨è®¾è®¡å®ç°" class="headerlink" title="åŸå¸‚åˆ—è¡¨è®¾è®¡å®ç°"></a>åŸå¸‚åˆ—è¡¨è®¾è®¡å®ç°</h2><p>å› ä¸ºæˆ‘ä»¬çš„ç›®æ ‡å¾ˆæ˜ç¡®ï¼Œå°±æ˜¯ä¸€ä¸ªé“¾è¡¨æ”¾åŸå¸‚ï¼Œå®ç°å¢åˆ æ”¹æŸ¥ã€‚æ¶‰åŠåˆ°çš„åŠŸèƒ½ä¹Ÿä¸å¤šï¼Œæ‰€ä»¥è®¾è®¡è¿™ä¸ªä¸œè¥¿ä¸éš¾ã€‚æˆ‘ä»¬å…ˆä»æ•°æ®ç»“æ„è®²èµ·ã€‚</p><p>æ•°æ®ç»“æ„è¿™ä¸€å—å¤§ä½“ä¸Šå°±æ˜¯æŒ‰ç…§ä¸Šè¯¾è®²çš„å†™ã€‚ä¸è¿‡æŒ‰ç…§è‡ªå·±çš„å‘½åä¹ æƒ¯ï¼Œæˆ‘ä¿®æ”¹äº†ä¸€äº›å‘½åï¼Œè¿˜æœ‰å†…éƒ¨çš„å®ç°ä¹Ÿæ˜¯æŒ‰ç…§æˆ‘è‡ªå·±çš„å–œå¥½å†™çš„ï¼Œå’Œè€å¸ˆçš„ç¨å¾®æœ‰ç‚¹åŒºåˆ«ã€‚</p><h3 id="çº¿æ€§è¡¨"><a href="#çº¿æ€§è¡¨" class="headerlink" title="çº¿æ€§è¡¨"></a>çº¿æ€§è¡¨</h3><p>åœ¨è¿™ä¸ª Demo é‡Œï¼Œæˆ‘ä»¬ç”¨åˆ°äº†é¡ºåºè¡¨ <code>SeqList</code>ã€å•é“¾è¡¨ <code>SLinkList</code>ã€‚è¿™ä¸¤ä¸ªä¸œè¥¿éƒ½å®ç°äº†çº¿æ€§è¡¨æ¥å£ <code>ILinearList</code>ï¼Œæä¾› <code>Insert</code>ï¼Œ<code>Remove</code>ï¼Œ<code>IsEmpty</code>ï¼Œ<code>Clear</code>ï¼Œ<code>Search</code> å’Œå–ä¸‹æ ‡ç­‰æ“ä½œï¼Œå…·ä½“çš„ç±»å›¾å¦‚ä¸‹ï¼ˆç”¨è½¯ä»¶ç”Ÿæˆçš„å¥½åƒæœ‰ç‚¹é”™ï¼Œä¸ç®¡äº†ï¼Œä»¥å®é™…ä»£ç ä¸ºå‡†ï¼‰ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcmn3fojbaj311u0qw79h.jpg" alt="LinearList"></p><p><strong>ä»£ç å®ç°</strong>ï¼ˆç”±äºæ–‡ç« ç©ºé—´æœ‰é™ï¼Œä»£ç æˆ‘åšè¿‡ä¸€äº›è°ƒæ•´ï¼‰ï¼š</p><p>çº¿æ€§è¡¨æ¥å£ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DataStructureAlgorithm/LinearList/ILinearList.cs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DataStructureAlgorithm.LinearList</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ILinearList</span>&lt;<span class="title">T</span>&gt; <span class="keyword">where</span> <span class="title">T</span> : <span class="title">IComparable</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span> Length &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">        T <span class="keyword">this</span>[<span class="built_in">int</span> index] &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Insert</span>(<span class="params"><span class="built_in">int</span> index, T data</span>)</span>;</span><br><span class="line">        <span class="function"><span class="built_in">int</span> <span class="title">Search</span>(<span class="params">T data</span>)</span>;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">RemoveAt</span>(<span class="params"><span class="built_in">int</span> index</span>)</span>;</span><br><span class="line">        <span class="function"><span class="built_in">bool</span> <span class="title">IsEmpty</span>(<span class="params"></span>)</span>;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Clear</span>(<span class="params"></span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¡ºåºè¡¨ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DataStructureAlgorithm/LinearList/SeqList.cs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DataStructureAlgorithm.LinearList</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SeqList</span>&lt;<span class="title">T</span>&gt; : <span class="title">ILinearList</span>&lt;<span class="title">T</span>&gt; <span class="keyword">where</span> <span class="title">T</span> : <span class="title">IComparable</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> T[] dataSet;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Length &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> MaxLength &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">SeqList</span>(<span class="params"><span class="built_in">int</span> maxLength</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (maxLength &lt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentOutOfRangeException(<span class="string">&quot;max Length should &gt;= 0.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            MaxLength = maxLength;</span><br><span class="line">            dataSet = <span class="keyword">new</span> T[MaxLength];</span><br><span class="line">            Length = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> T <span class="keyword">this</span>[<span class="built_in">int</span> index]</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; Length - <span class="number">1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfRangeException();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> dataSet[index];</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">set</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; Length - <span class="number">1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfRangeException();</span><br><span class="line">                &#125;</span><br><span class="line">                dataSet[index] = <span class="keyword">value</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Clear</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Length = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Insert</span>(<span class="params"><span class="built_in">int</span> index, T data</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; Length)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfRangeException();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (Length == MaxLength)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;Failed to Insert: SeqList is already full (Length == MaxLength)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = Length; i &gt; index; i--)</span><br><span class="line">            &#123;</span><br><span class="line">                dataSet[i] = dataSet[i - <span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            dataSet[index] = data;</span><br><span class="line">            Length++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">IsEmpty</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> (Length == <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RemoveAt</span>(<span class="params"><span class="built_in">int</span> index</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; Length - <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfRangeException();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = index; i &lt; Length - <span class="number">1</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                dataSet[i] = dataSet[i + <span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            Length--;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">Search</span>(<span class="params">T data</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; Length; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (data.CompareTo(dataSet[i]) == <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> i;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å•é“¾è¡¨ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DataStructureAlgorithm/LinearList/SLinkList.cs + SNode.cs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.ComponentModel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DataStructureAlgorithm.LinearList</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SNode</span>&lt;<span class="title">T</span>&gt; <span class="keyword">where</span> <span class="title">T</span> : <span class="title">IComparable</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> T Data &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> SNode&lt;T&gt; Next &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">SNode</span>(<span class="params">T data, SNode&lt;T&gt; next</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Data = data;</span><br><span class="line">            Next = (next != <span class="literal">null</span> ? next : <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">SNode</span>(<span class="params">T data</span>) : <span class="title">this</span>(<span class="params">data, <span class="literal">null</span></span>)</span> &#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SLinkList</span>&lt;<span class="title">T</span>&gt; : <span class="title">ILinearList</span>&lt;<span class="title">T</span>&gt;, <span class="title">INotifyPropertyChanged</span> <span class="keyword">where</span> <span class="title">T</span> : <span class="title">IComparable</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Length &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">protected</span> <span class="built_in">string</span> LengthStr = <span class="string">&quot;Length&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> SNode&lt;T&gt; HeadNode &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">protected</span> <span class="built_in">string</span> HeadNodeStr = <span class="string">&quot;HeadNode&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">SLinkList</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Length = <span class="number">0</span>;</span><br><span class="line">            HeadNode = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">event</span> PropertyChangedEventHandler PropertyChanged;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> SNode&lt;T&gt; <span class="title">NodeAt</span>(<span class="params"><span class="built_in">int</span> index</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; Length - <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfRangeException();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            SNode&lt;T&gt; node = HeadNode;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; index; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                node = node.Next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> T <span class="keyword">this</span>[<span class="built_in">int</span> index]</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> NodeAt(index).Data;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">set</span></span><br><span class="line">            &#123;</span><br><span class="line">                NodeAt(index).Data = <span class="keyword">value</span>;</span><br><span class="line">                OnPropertyChanged(IndexerName);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">protected</span> <span class="built_in">string</span> IndexerName = <span class="string">&quot;this[]&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Clear</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            HeadNode = <span class="literal">null</span>;</span><br><span class="line">            Length = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Insert</span>(<span class="params"><span class="built_in">int</span> index, T data</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; Length)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfRangeException();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            SNode&lt;T&gt; current = <span class="keyword">new</span> SNode&lt;T&gt;(data);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (index == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                current.Next = HeadNode;</span><br><span class="line">                HeadNode = current;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                SNode&lt;T&gt; prev = NodeAt(index - <span class="number">1</span>);</span><br><span class="line">                current.Next = prev.Next;</span><br><span class="line">                prev.Next = current;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Length++;</span><br><span class="line">            OnPropertyChanged(LengthStr);</span><br><span class="line">            OnPropertyChanged(IndexerName);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">InsertAtHead</span>(<span class="params">T data</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Insert(<span class="number">0</span>, data);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">InsertAtRear</span>(<span class="params">T data</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Insert(Length, data);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">IsEmpty</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> (Length == <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RemoveAt</span>(<span class="params"><span class="built_in">int</span> index</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; Length - <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfRangeException();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (index == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                HeadNode = HeadNode.Next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                SNode&lt;T&gt; prev = NodeAt(index - <span class="number">1</span>);</span><br><span class="line">                prev.Next = prev.Next.Next;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Length--;</span><br><span class="line"></span><br><span class="line">            OnPropertyChanged(LengthStr);</span><br><span class="line">            OnPropertyChanged(IndexerName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">Search</span>(<span class="params">T data</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="built_in">int</span> index = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> current = HeadNode; current != <span class="literal">null</span>; current = current.Next)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (data.CompareTo(current.Data) == <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> index;</span><br><span class="line">                &#125;</span><br><span class="line">                index++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">event</span> PropertyChangedEventHandler INotifyPropertyChanged.PropertyChanged</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">add</span></span><br><span class="line">            &#123;</span><br><span class="line">                PropertyChanged += <span class="keyword">value</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">remove</span></span><br><span class="line">            &#123;</span><br><span class="line">                PropertyChanged -= <span class="keyword">value</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnPropertyChanged</span>(<span class="params"><span class="built_in">string</span> propertyName</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            OnPropertyChanged(<span class="keyword">new</span> PropertyChangedEventArgs(propertyName));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnPropertyChanged</span>(<span class="params">PropertyChangedEventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (PropertyChanged != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                PropertyChanged(<span class="keyword">this</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(é‡Œé¢æœ‰äº›çœ‹ä¸æ‡‚çš„ä»£ç å¯¹å§ï¼Œæ¯”å¦‚ <code>INotifyPropertyChanged</code> ä»€ä¹ˆçš„ï¼Œè¿™äº›å…ˆä¸ç®¡ï¼Œä¹‹åå†è®¨è®ºã€‚)</p><p>å†™å®Œè¿™äº›ä¸œè¥¿ï¼Œéšæ‰‹åšä¸ªå•å…ƒæµ‹è¯•ï¼Œç„¶åå°±å¯ä»¥å¼€å§‹è€ƒè™‘æ€ä¹ˆç”¨å®ƒä»¬äº†ã€‚</p><h3 id="åŸå¸‚ã€åæ ‡"><a href="#åŸå¸‚ã€åæ ‡" class="headerlink" title="åŸå¸‚ã€åæ ‡"></a>åŸå¸‚ã€åæ ‡</h3><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å†™åŸå¸‚åˆ—è¡¨ï¼Œé‚£å½“ç„¶ä¸€ä¸ª <code>City</code> ç±»æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œè¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„ data ç±»ï¼Œä½†æ˜¯å› ä¸ºé¢˜ç›®æœ‰ä¸ªç”¨è·ç¦»å»æœç´¢çš„è¦æ±‚ï¼Œæˆ‘è§‰å¾—è®© <code>City</code> ç±»æˆ–æ˜¯ä½¿ç”¨ <code>City</code> ç±»çš„å…¶ä»–ä¸œè¥¿å»å®ç°ä¸¤ç‚¹ä¹‹é—´è·ç¦»çš„è®¡ç®—ä¸å¤Ÿä¼˜é›…ï¼Œæ‰€ä»¥å†æŠ½è±¡å‡ºä¸€ä¸ª <code>Point2D</code> ç±»æ¥æè¿°ä¸€ä¸ªå¹³é¢ç‚¹ï¼ŒåŒæ—¶æä¾›ç‚¹é—´è·ç¦»çš„è®¡ç®—æ–¹æ³•ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcmn2v20aej30ew0kmwgd.jpg" alt="CityAndPoint2D"></p><p><strong>ä»£ç å®ç°</strong>ï¼š</p><p>City:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DataStructureAlgorithm/LinearList/City.cs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DataStructDemo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">City</span> : <span class="title">IComparable</span>&lt;<span class="title">City</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> Point2D Location &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> LocationStr</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> Location.ToString();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">City</span>(<span class="params"><span class="built_in">string</span> name, Point2D location</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Name = name;</span><br><span class="line">            Location = location;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">CompareTo</span>(<span class="params">City other</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.Location.CompareTo(other.Location);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> <span class="title">ToString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">$&quot;<span class="subst">&#123;Name&#125;</span> <span class="subst">&#123;Location&#125;</span>&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Point2D:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DataStructureAlgorithm/LinearList/Point2D.cs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DataStructDemo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Point2D</span> : <span class="title">IComparable</span>&lt;<span class="title">Point2D</span>&gt;, <span class="title">IEquatable</span>&lt;<span class="title">Point2D</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">double</span> X &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">double</span> Y &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Point2D</span>(<span class="params"><span class="built_in">double</span> x, <span class="built_in">double</span> y</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            X = x;</span><br><span class="line">            Y = y;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">double</span> <span class="title">DistanceTo</span>(<span class="params">Point2D other</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="built_in">double</span> xd = <span class="keyword">this</span>.X - other.X;</span><br><span class="line">            <span class="built_in">double</span> yd = <span class="keyword">this</span>.Y - other.Y;</span><br><span class="line">            <span class="keyword">return</span> Math.Sqrt(xd * xd + yd * yd);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">CompareTo</span>(<span class="params">Point2D other</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> ((<span class="keyword">this</span>.X == other.Y) &amp;&amp; (<span class="keyword">this</span>.Y == other.Y))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((<span class="keyword">this</span>.X &lt;= other.X) || (<span class="keyword">this</span>.Y == other.Y))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Equals</span>(<span class="params">Point2D other</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">this</span>.CompareTo(other) == <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> <span class="title">ToString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">$&quot;(<span class="subst">&#123;X&#125;</span>, <span class="subst">&#123;Y&#125;</span>)&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬è¡¨ç¤ºå‡ºäº†åŸå¸‚ã€‚ç»“åˆåˆšæ‰çš„çº¿æ€§è¡¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‚¨å­˜æ»¡è¶³é¢˜ç›®éœ€è¦çš„è‹¥å¹²åŸå¸‚æ•°æ®äº†ï¼ä½†æ˜¯ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨ <code>ILinearList&lt;City&gt;</code> çš„è¯ï¼Œè¿˜æœ‰ä¸€ç‚¹ä¸è¶³ã€‚é—®é¢˜æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé¢˜ç›®éœ€è¦æˆ‘ä»¬å®Œæˆé€šè¿‡åŸå¸‚åå’Œé€šè¿‡ä¸­å¿ƒåŠå¾„ä¸¤ç§æ–¹å¼è¿›è¡Œæœç´¢ã€‚è€Œæˆ‘ä»¬çš„ <code>ILinearList</code> åªèƒ½å®Œæˆç»™å®šå®Œæ•´çš„ object çš„æœç´¢ï¼Œä¹Ÿå°±æ˜¯è¯´åªèƒ½åŒæ—¶ç»™å‡ºåŸå¸‚åã€åæ ‡å»æŸ¥æ‰¾è¿™ä¸ªåŸå¸‚åœ¨ä¸åœ¨æˆ‘ä»¬çš„çº¿æ€§è¡¨ä¸­ã€‚</p><h3 id="åŸå¸‚åˆ—è¡¨"><a href="#åŸå¸‚åˆ—è¡¨" class="headerlink" title="åŸå¸‚åˆ—è¡¨"></a>åŸå¸‚åˆ—è¡¨</h3><p>è¦å®ç°é¢˜ç›®è¦æ±‚çš„ä¸¤ç§æœç´¢ï¼Œæˆ‘ä»¬å°±è¦å¾€å·²ç»å®ç°çš„åŸºç¡€çº¿æ€§è¡¨ä¸­åŠ æ–¹æ³•ã€‚æ‰€ä»¥æˆ‘ä»¬è€ƒè™‘æ„å»ºä¸€ä¸ªæ–°çš„ <code>CityList</code> å»ç»§æ‰¿å·²ç»å®ç°å¥½çš„ <code>SLinkList</code>ï¼ŒåŒæ—¶æ·»åŠ åŸå¸‚é“¾è¡¨æ‰€ç‰¹éœ€çš„ä¸¤ç§æœç´¢æ“ä½œã€‚</p><p>æˆ‘ä»¬çš„ ILinearList æ¥å£é‡Œçš„ Search æ˜¯è¿”å›ä¸€ä¸ªæ•´æ•°çš„ï¼Œä½†è¿™é‡Œæˆ‘ä»¬çš„æœç´¢ç»“æœå¯ä¸ä¸€å®šæ˜¯åªæœ‰ä¸€ä¸ªæ•°ï¼Œæ‰€ä»¥æœç´¢çš„ç»“æœè¿˜å¾—ç”¨ä¸€ä¸ªé›†åˆå»å­˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°è¯•åœ¨è¿™é‡Œä½¿ç”¨æˆ‘ä»¬å®ç°çš„å¦ä¸€ç§çº¿æ€§è¡¨â€”â€”<code>SeqList</code>ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcmn4rlejcj30mq0ayq45.jpg" alt="CityList"></p><p><strong>ä»£ç å®ç°ï¼š</strong>(è¿™é‡Œæˆ‘ä»¬é¢å¤–è¿˜å®ç°äº†IEnumerable, INotifyPropertyChangedè¿™ä¸¤ä¸ªæ¥å£ï¼Œç†ç”±åé¢å†è®¨è®º)</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo/DataStructDemo/CityListPage.xaml.cs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> DataStructureAlgorithm.LinearList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System.ComponentModel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DataStructDemo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CityList</span> : <span class="title">SLinkList</span>&lt;<span class="title">City</span>&gt;, <span class="title">IEnumerable</span>, <span class="title">INotifyPropertyChanged</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// SearchByName é€šè¿‡åŸå¸‚åæœç´¢ï¼Œè¿”å›ç»™å®šåç§°çš„åŸå¸‚ç´¢å¼•åˆ—è¡¨(SeqList&lt;int&gt;)</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> SeqList&lt;<span class="built_in">int</span>&gt; <span class="title">SearchByName</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            SeqList&lt;<span class="built_in">int</span>&gt; find = <span class="keyword">new</span> SeqList&lt;<span class="built_in">int</span>&gt;(Length);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">int</span> index = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> current = HeadNode; current != <span class="literal">null</span>; current = current.Next)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (name.CompareTo(current.Data.Name) == <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    find.Insert(<span class="number">0</span>, index);</span><br><span class="line">                &#125;</span><br><span class="line">                index++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> find;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// SearchByLocation é€šè¿‡ç»™å®šä¸­å¿ƒç‚¹ã€æœç´¢åŠå¾„æœç´¢åŸå¸‚ï¼Œè¿”å›ç»™å®šèŒƒå›´å†…çš„åŸå¸‚ç´¢å¼•åˆ—è¡¨(SeqList&lt;int&gt;)</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> SeqList&lt;<span class="built_in">int</span>&gt; <span class="title">SearchByLocation</span>(<span class="params">Point2D center, <span class="built_in">double</span> radius</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            SeqList&lt;<span class="built_in">int</span>&gt; find = <span class="keyword">new</span> SeqList&lt;<span class="built_in">int</span>&gt;(Length);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">int</span> index = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> current = HeadNode; current != <span class="literal">null</span>; current = current.Next)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (center.DistanceTo(current.Data.Location) &lt;= radius)</span><br><span class="line">                &#123;</span><br><span class="line">                    find.Insert(<span class="number">0</span>, index);</span><br><span class="line">                &#125;</span><br><span class="line">                index++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> find;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> IEnumerator&lt;City&gt; <span class="title">GetEnumerator</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> current = HeadNode; current != <span class="literal">null</span>; current = current.Next)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">yield</span> <span class="keyword">return</span> current.Data;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        IEnumerator IEnumerable.GetEnumerator()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> (IEnumerator)GetEnumerator();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> ArrayList <span class="title">ToArrayList</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            ArrayList arrayList = <span class="keyword">new</span> ArrayList();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> current = HeadNode; current != <span class="literal">null</span>; current = current.Next)</span><br><span class="line">            &#123;</span><br><span class="line">                arrayList.Add(current.Data);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> arrayList;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæ ¸å¿ƒçš„æ•°æ®è¡¨ç¤ºã€å­˜å‚¨éƒ¨åˆ†å°±å…¨éƒ¨æå®šäº†ï¼šæˆ‘ä»¬å¯ä»¥è¡¨ç¤ºäº†åŸå¸‚ï¼Œç„¶åæŠŠå®ƒä»¬å‚¨å­˜åˆ°é“¾è¡¨ä¸­ï¼Œå¹¶æä¾›äº†è¦æ±‚çš„å‡ ç§å¢åˆ æ”¹æŸ¥æ“ä½œã€‚</p><p>æ¥ä¸‹æ¥å°±æ˜¯å®è¡Œä¸€ä¸ª UI ç•Œé¢å»å±•ç¤ºè¿™ä¸ªåŸå¸‚é“¾è¡¨ï¼Œå¹¶ç»™ç”¨æˆ·æä¾›å®Œæˆå„ç§æ“ä½œçš„æ¥å£äº†ã€‚</p><h3 id="UI"><a href="#UI" class="headerlink" title="UI"></a>UI</h3><p>ä¹‹å‰è®¨è®ºè¿‡äº†ï¼Œç”±äºä¸€äº›ä¸çŸ¥åçš„åŸå› ï¼Œæˆ‘ä»¬é€‰æ‹©äº†ä½¿ç”¨ Xamarin å®Œæˆ UIï¼ˆå‡†ç¡®åœ°è¯´æ˜¯è·¨å¹³å°çš„ Xamarin.Formsï¼‰ã€‚</p><p>å¾ˆè‡ªç„¶çš„ï¼Œå±•ç°ä¸€ä¸ªåˆ—è¡¨ï¼Œæˆ‘ä»¬å½“ç„¶æ˜¯ä½¿ç”¨ <code>ListView</code>ï¼Œè€Œç”¨æˆ·è¦æ“ä½œæ•°æ®ï¼Œå°±éœ€è¦æœ‰æ¥æ”¶ç”¨æˆ·è¾“å…¥çš„ <code>Entry</code> ä»¥åŠå‘èµ·æ“ä½œçš„ <code>Button</code> äº†ã€‚</p><p>è¿˜æœ‰å¦‚æœæˆ‘ä»¬ç»™æ¯ä¸ªå¢åˆ æ”¹æŸ¥æ“ä½œéƒ½åœ¨ç•Œé¢ä¸Šåˆ†é…ä¸€ä¸ªæŒ‰é’®çš„è¯æ‰‹æœºå±å¹•è‚¯å®šæ”¾ä¸ä¸‹ï¼ˆæ”¾ä¸‹äº†ä¹Ÿæç«¯ä¸å¥½çœ‹ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘åœ¨è¿è¡Œæ—¶ç”¨ <code>DisplayActionSheet</code> æ¥è®©ç”¨æˆ·é€‰æ‹©æ“ä½œï¼Œè¿™æ ·ç•Œé¢å°±æ¯”è¾ƒæ¸…çˆ½äº†ã€‚</p><p>è‡³äºæœç´¢åŠŸèƒ½ï¼Œå› ä¸ºæ¶‰åŠåˆ°ä¸¤ç§æœç´¢ï¼Œæ¯”è¾ƒå¤æ‚ã€‚å¦‚æœæˆ‘ä»¬åœ¨ä¸€ä¸ªé¡µé¢é‡Œåˆè¦å®ŒæˆåŸå¸‚æ˜¾ç¤ºï¼Œåˆè¦æä¾›å¢åˆ æ”¹æŸ¥æ“ä½œï¼Œè¿˜æœ‰æœ‰ä¸¤ç§ä¸åŒçš„æœç´¢ï¼Œç•Œé¢å°±ä¼šå˜å¾—å’Œè€å¸ˆæä¾›çš„å‚è€ƒé¡µé¢ä¸€æ‘¸ä¸€æ ·ï¼Œå¾ˆå¤æ‚ï¼Œå¾€ä½ æ‰‹æœºé‚£å‡ å¯¸å±å¹•é‡Œå¡è¿™ä¹ˆå¤šä¸œè¥¿æ˜¯ä¸ä¼˜é›…ã€ä¸ç®€æ´ã€ä¸æ˜“ç”¨çš„ã€‚æ‰€ä»¥æˆ‘ä»¬æŠŠæœç´¢åŠŸèƒ½å•ç‹¬æ”¾åˆ°ä¸€ä¸ª Page é‡Œï¼Œåœ¨ City List Page åªç•™ä¸‹ä¸€ä¸ªè¿›å…¥ Search Page æŒ‰é’®ã€‚å®Œæˆè¿™äº›ä¹‹åï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†è¿™æ ·çš„ City List Pageï¼Œå·®å¼ºäººæ„ï¼Œä½†æˆ‘å¯ä»¥æ¥å—äº†ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gclsi51c5vj30u00whq4x.jpg" alt="IMG_448"></p><p><strong>ä»£ç å®ç°</strong>ï¼š</p><p>ç•Œé¢ï¼š<code>Demo/DataStructDemo/CityListPage.xaml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ContentPage</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xamarin.com/schemas/2014/forms&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">xmlns:x</span>=<span class="string">&quot;http://schemas.microsoft.com/winfx/2009/xaml&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">x:Class</span>=<span class="string">&quot;DataStructDemo.CityListPage&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">Title</span>=<span class="string">&quot;City List&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ContentPage.ToolbarItems</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ToolbarItem</span> <span class="attr">Text</span>=<span class="string">&quot;Search&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">Clicked</span>=<span class="string">&quot;OnSearchClicked&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ContentPage.ToolbarItems</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">StackLayout</span> <span class="attr">BackgroundColor</span>=<span class="string">&quot;#FAFAFA&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ListView</span> <span class="attr">x:Name</span>=<span class="string">&quot;CityListView&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">Margin</span>=<span class="string">&quot;20&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">BackgroundColor</span>=<span class="string">&quot;#FAFAFA&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">ItemSelected</span>=<span class="string">&quot;OnListViewItemSelected&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ListView.ItemTemplate</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">DataTemplate</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">TextCell</span> <span class="attr">Text</span>=<span class="string">&quot;&#123;Binding Name&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                          <span class="attr">Detail</span>=<span class="string">&quot;&#123;Binding LocationStr&#125;&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">DataTemplate</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ListView.ItemTemplate</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ListView</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">StackLayout</span> <span class="attr">BackgroundColor</span>=<span class="string">&quot;#FFF&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">x:Name</span>=<span class="string">&quot;SelectedAndOperate&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">BoxView</span> <span class="attr">Color</span>=<span class="string">&quot;#000000&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">WidthRequest</span>=<span class="string">&quot;10000&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">HeightRequest</span>=<span class="string">&quot;0.17&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Label</span> <span class="attr">Text</span>=<span class="string">&quot;Selected:&quot;</span> </span></span><br><span class="line"><span class="tag">                   <span class="attr">HorizontalOptions</span>=<span class="string">&quot;Start&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">VerticalOptions</span>=<span class="string">&quot;CenterAndExpand&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">Margin</span>=<span class="string">&quot;20, 5, 20, 5&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">StackLayout</span> <span class="attr">Orientation</span>=<span class="string">&quot;Horizontal&quot;</span></span></span><br><span class="line"><span class="tag">                         <span class="attr">HorizontalOptions</span>=<span class="string">&quot;Center&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Placeholder</span>=<span class="string">&quot;City Name&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">x:Name</span>=<span class="string">&quot;InputCityName&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">HorizontalTextAlignment</span>=<span class="string">&quot;Center&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">WidthRequest</span>=<span class="string">&quot;125&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">Margin</span>=<span class="string">&quot;5, 0, 5, 0&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Placeholder</span>=<span class="string">&quot;Index&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">x:Name</span>=<span class="string">&quot;InputIndex&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">WidthRequest</span>=<span class="string">&quot;125&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">HorizontalTextAlignment</span>=<span class="string">&quot;Center&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">Margin</span>=<span class="string">&quot;5, 0, 5, 0&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">StackLayout</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">StackLayout</span> <span class="attr">Orientation</span>=<span class="string">&quot;Horizontal&quot;</span> </span></span><br><span class="line"><span class="tag">                         <span class="attr">HorizontalOptions</span>=<span class="string">&quot;Center&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Placeholder</span>=<span class="string">&quot;Location X&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">x:Name</span>=<span class="string">&quot;InputLocationX&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">HorizontalTextAlignment</span>=<span class="string">&quot;Center&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">WidthRequest</span>=<span class="string">&quot;125&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">Margin</span>=<span class="string">&quot;5, 0, 5, 0&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Placeholder</span>=<span class="string">&quot;Location Y&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">x:Name</span>=<span class="string">&quot;InputLocationY&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">HorizontalTextAlignment</span>=<span class="string">&quot;Center&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">WidthRequest</span>=<span class="string">&quot;125&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">Margin</span>=<span class="string">&quot;5, 0, 5, 0&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">StackLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span> <span class="attr">Text</span>=<span class="string">&quot;<span class="symbol">&amp;gt;</span><span class="symbol">&amp;gt;</span> Operate <span class="symbol">&amp;lt;</span><span class="symbol">&amp;lt;</span>&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">Clicked</span>=<span class="string">&quot;OnOperateClicked&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">Margin</span>=<span class="string">&quot;10, 10, 10, 10&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">StackLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">StackLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ContentPage</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é€»è¾‘ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo/DataStructDemo/CityListPage.xaml.cs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> Xamarin.Forms;</span><br><span class="line"><span class="keyword">using</span> System.Collections.ObjectModel;</span><br><span class="line"><span class="keyword">using</span> System.Threading;</span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DataStructDemo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">CityListPage</span> : <span class="title">ContentPage</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> CityList cities;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//private ObservableCollection&lt;City&gt; lst;</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">CityListPage</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line"></span><br><span class="line">            cities = <span class="keyword">new</span> CityList();</span><br><span class="line">            AddSomeCitys(cities);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// lst = new ObservableCollection&lt;City&gt;();</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// lst.Add(new City(&quot;Foo&quot;, new Point2D(500, 500)));</span></span><br><span class="line">            <span class="comment">// lst.Add(new City(&quot;Bar&quot;, new Point2D(703, 500)));</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnAppearing</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">base</span>.OnAppearing();</span><br><span class="line"></span><br><span class="line">            CityListView.ItemsSource = cities;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> <span class="keyword">void</span> <span class="title">OnSearchClicked</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="comment">// DisplayAlert(&quot;æœªå®Œæˆçš„åŠŸèƒ½&quot;, &quot;ç°åœ¨è¿˜ä¸èƒ½ç”¨å“¦&quot;, &quot;å–æ¶ˆ&quot;);</span></span><br><span class="line">            <span class="keyword">await</span> Navigation.PushAsync(<span class="keyword">new</span> CitySearchPage(cities));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnListViewItemSelected</span>(<span class="params"><span class="built_in">object</span> sender, SelectedItemChangedEventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            InputCityName.Text = (e.SelectedItem <span class="keyword">as</span> City).Name;</span><br><span class="line">            InputIndex.Text = (e.SelectedItemIndex).ToString();</span><br><span class="line">            InputLocationX.Text = ((e.SelectedItem <span class="keyword">as</span> City).Location.X).ToString();</span><br><span class="line">            InputLocationY.Text = ((e.SelectedItem <span class="keyword">as</span> City).Location.Y).ToString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> <span class="keyword">void</span> <span class="title">OnOperateClicked</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (InputCityName.Text == <span class="string">&quot;&quot;</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;City Name cannot be empty.&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (InputLocationX.Text == <span class="string">&quot;&quot;</span> || InputLocationY.Text == <span class="string">&quot;&quot;</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;Location X/Y cannot be empty.&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">string</span> cityName = InputCityName.Text;</span><br><span class="line">                <span class="built_in">double</span> locX = <span class="built_in">double</span>.Parse(InputLocationX.Text);</span><br><span class="line">                <span class="built_in">double</span> locY = <span class="built_in">double</span>.Parse(InputLocationY.Text);</span><br><span class="line">                <span class="built_in">int</span> index = <span class="built_in">int</span>.Parse(InputIndex.Text);</span><br><span class="line"></span><br><span class="line">                <span class="built_in">string</span> action = <span class="keyword">await</span> DisplayActionSheet(<span class="string">$&quot;ä»¥é€‰æ‹© <span class="subst">&#123;cityName&#125;</span> (<span class="subst">&#123;locX&#125;</span>, <span class="subst">&#123;locY&#125;</span>), index=<span class="subst">&#123;index&#125;</span>&quot;</span>, <span class="string">&quot;Cancel&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;å¤´æ’&quot;</span>, <span class="string">&quot;å°¾æ’&quot;</span>, <span class="string">&quot;æ’å…¥åˆ°indexå¤„&quot;</span>, <span class="string">&quot;åˆ é™¤indexå¤„çš„åŸå¸‚&quot;</span>, <span class="string">&quot;æ›´æ–°indexå¤„çš„åŸå¸‚&quot;</span>);</span><br><span class="line">                <span class="keyword">await</span> HandOperateAction(action, cityName, locX, locY, index);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            catch (Exception ex)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">await</span> DisplayActionSheet(<span class="string">&quot;è¾“å…¥æœ‰è¯¯ï¼Œæ— æ³•ç»§ç»­æ“ä½œ: \n&quot;</span> + ex.Message, <span class="string">&quot;Cancel&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">async</span> Task&lt;<span class="built_in">bool</span>&gt; <span class="title">HandOperateAction</span>(<span class="params"><span class="built_in">string</span> action, <span class="built_in">string</span> cityName, <span class="built_in">double</span> locX, <span class="built_in">double</span> locY, <span class="built_in">int</span> index</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="built_in">bool</span> ok = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                City city = <span class="keyword">new</span> City(cityName, <span class="keyword">new</span> Point2D(locX, locY));</span><br><span class="line">                <span class="keyword">switch</span> (action)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&quot;å¤´æ’&quot;</span>:</span><br><span class="line">                        cities.InsertAtHead(city);</span><br><span class="line">                        <span class="comment">// lst.Insert(0, city);</span></span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&quot;å°¾æ’&quot;</span>:</span><br><span class="line">                        cities.InsertAtRear(city);</span><br><span class="line">                        <span class="comment">// lst.Add(city);</span></span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&quot;æ’å…¥åˆ°indexå¤„&quot;</span>:</span><br><span class="line">                        cities.Insert(index, city);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&quot;åˆ é™¤indexå¤„çš„åŸå¸‚&quot;</span>:</span><br><span class="line">                        cities.RemoveAt(index);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&quot;æ›´æ–°indexå¤„çš„åŸå¸‚&quot;</span>:</span><br><span class="line">                        cities[index] = city;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                ok = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            catch (Exception ex)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">await</span> DisplayAlert(<span class="string">&quot;å‡ºé”™å•¦!&quot;</span>, <span class="string">&quot;ä¸èƒ½å®Œæˆæ“ä½œ:\n&quot;</span> + ex.Message, <span class="string">&quot;å–æ¶ˆ&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">finally</span></span><br><span class="line">            &#123;</span><br><span class="line">                RefreshCityListView();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> ok;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">RefreshCityListView</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            CityListView.BeginRefresh();</span><br><span class="line">            CityListView.ItemsSource = <span class="literal">null</span>;</span><br><span class="line">            CityListView.EndRefresh();</span><br><span class="line">            CityListView.ItemsSource = cities;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AddSomeCitys</span>(<span class="params">CityList cities</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            cities.InsertAtRear(<span class="keyword">new</span> City(<span class="string">&quot;Foo&quot;</span>, <span class="keyword">new</span> Point2D(<span class="number">500</span>, <span class="number">500</span>)));</span><br><span class="line">            cities.InsertAtRear(<span class="keyword">new</span> City(<span class="string">&quot;Bar&quot;</span>, <span class="keyword">new</span> Point2D(<span class="number">703</span>, <span class="number">500</span>)));</span><br><span class="line">            cities.InsertAtRear(<span class="keyword">new</span> City(<span class="string">&quot;Gophers&#x27; City&quot;</span>, <span class="keyword">new</span> Point2D(<span class="number">600</span>, <span class="number">1200</span>)));</span><br><span class="line">            cities.InsertAtRear(<span class="keyword">new</span> City(<span class="string">&quot;å·å¨&quot;</span>, <span class="keyword">new</span> Point2D(<span class="number">100</span>, <span class="number">20</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­ï¼Œå†™æˆ‘ä»¬åˆšæ‰è½ä¸‹çš„æœç´¢é¡µé¢ã€‚å…¶å®è¿™é‡Œè¦å®ç°çš„å¥½çœ‹å¾ˆéº»çƒ¦äº†ï¼Œä½ å¯ä»¥å»æ ¹æ®ç”¨æˆ·é€‰æ‹©æœåå­—è¿˜æ˜¯æœåæ ‡è€ŒåŠ¨æ€å“åº”ï¼Œç»™å‡ºä¸åŒçš„æœç´¢æ¡†ï¼Œç„¶åè¿›è¡Œæœç´¢ã€ç»“æœå±•ç¤ºã€‚æˆ‘ä¸æƒ³è¿™ä¹ˆåšï¼ˆæˆ‘è¿˜æ˜¯ä¸ª Xamarin æ–°æ‰‹ï¼Œæˆ‘æœ‰ç‚¹å®³æ€•è¿™ä¹ˆå¤æ‚çš„é¡µé¢ï¼‰ï¼Œè¿˜æ˜¯ç®€å•æš´åŠ›ä¸€ç‚¹ï¼Œç›´æ¥æŠŠä¸¤ç§è¾“å…¥åšåˆ°ä¸€èµ·æ¯”è¾ƒæ–¹ä¾¿ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gclstvjqawj30u00whgn8.jpg" alt="IMG_449"></p><p><strong>ä»£ç å®ç°ï¼š</strong></p><p>ç•Œé¢ï¼š<code>Demo/DataStructDemo/CitySearchPage.xaml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ContentPage</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xamarin.com/schemas/2014/forms&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">xmlns:x</span>=<span class="string">&quot;http://schemas.microsoft.com/winfx/2009/xaml&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">x:Class</span>=<span class="string">&quot;DataStructDemo.CitySearchPage&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">Title</span>=<span class="string">&quot;City Search&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">StackLayout</span> <span class="attr">Margin</span>=<span class="string">&quot;20&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Grid</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Grid.ColumnDefinitions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ColumnDefinition</span> <span class="attr">Width</span>=<span class="string">&quot;0.2*&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ColumnDefinition</span> <span class="attr">Width</span>=<span class="string">&quot;0.2*&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ColumnDefinition</span> <span class="attr">Width</span>=<span class="string">&quot;0.2*&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ColumnDefinition</span> <span class="attr">Width</span>=<span class="string">&quot;0.25*&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Grid.ColumnDefinitions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Grid.RowDefinitions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">RowDefinition</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">RowDefinition</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">RowDefinition</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">RowDefinition</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Grid.RowDefinitions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Label</span> <span class="attr">Text</span>=<span class="string">&quot;é€šè¿‡åŸå¸‚åæœç´¢ï¼š&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">HeightRequest</span>=<span class="string">&quot;25&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">Grid.Row</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">Grid.ColumnSpan</span>=<span class="string">&quot;4&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Placeholder</span>=<span class="string">&quot;City Name&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">x:Name</span>=<span class="string">&quot;InputName&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">HorizontalTextAlignment</span>=<span class="string">&quot;Center&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">Grid.Row</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">Grid.Column</span>=<span class="string">&quot;0&quot;</span> <span class="attr">Grid.ColumnSpan</span>=<span class="string">&quot;3&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span> <span class="attr">Text</span>=<span class="string">&quot;Search&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">Clicked</span>=<span class="string">&quot;SearchByNameClicked&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">Grid.Row</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">Grid.Column</span>=<span class="string">&quot;3&quot;</span> <span class="attr">Grid.ColumnSpan</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Label</span> <span class="attr">Text</span>=<span class="string">&quot;æˆ– é€šè¿‡ä¸­å¿ƒåæ ‡ã€åŠå¾„æœç´¢ï¼š&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">Margin</span>=<span class="string">&quot;0,10,0,10&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">HeightRequest</span>=<span class="string">&quot;25&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">Grid.Row</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">Grid.ColumnSpan</span>=<span class="string">&quot;4&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Placeholder</span>=<span class="string">&quot;X&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">x:Name</span>=<span class="string">&quot;InputX&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">HorizontalTextAlignment</span>=<span class="string">&quot;Center&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">Grid.Row</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">Grid.Column</span>=<span class="string">&quot;0&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Placeholder</span>=<span class="string">&quot;Y&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">x:Name</span>=<span class="string">&quot;InputY&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">HorizontalTextAlignment</span>=<span class="string">&quot;Center&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">Grid.Row</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">Grid.Column</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Entry</span> <span class="attr">Placeholder</span>=<span class="string">&quot;Radius&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">x:Name</span>=<span class="string">&quot;InputRadius&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">HorizontalTextAlignment</span>=<span class="string">&quot;Center&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">Grid.Row</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">Grid.Column</span>=<span class="string">&quot;2&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span> <span class="attr">Text</span>=<span class="string">&quot;Search&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">Clicked</span>=<span class="string">&quot;SearchByLocationClicked&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">Grid.Row</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">Grid.Column</span>=<span class="string">&quot;3&quot;</span> <span class="attr">Grid.ColumnSpan</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Grid</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">BoxView</span> <span class="attr">Color</span>=<span class="string">&quot;#000000&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">WidthRequest</span>=<span class="string">&quot;10000&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">HeightRequest</span>=<span class="string">&quot;0.17&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Label</span> <span class="attr">Text</span>=<span class="string">&quot;æœç´¢ç»“æœ:&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">HeightRequest</span>=<span class="string">&quot;25&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">Margin</span>=<span class="string">&quot;0,10,0,10&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ListView</span> <span class="attr">x:Name</span>=<span class="string">&quot;CitySearchListView&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">HeightRequest</span>=<span class="string">&quot;300&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">ItemSelected</span>=<span class="string">&quot;OnListViewItemSelected&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ListView.ItemTemplate</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">DataTemplate</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">TextCell</span> <span class="attr">Text</span>=<span class="string">&quot;&#123;Binding Name&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                          <span class="attr">Detail</span>=<span class="string">&quot;&#123;Binding LocationStr&#125;&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">DataTemplate</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ListView.ItemTemplate</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ListView</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">StackLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">ContentPage</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é€»è¾‘ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo/DataStructDemo/CitySearchPage.xaml.cs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> DataStructureAlgorithm.LinearList;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> Xamarin.Forms;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DataStructDemo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">CitySearchPage</span> : <span class="title">ContentPage</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> CityList cities;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">CitySearchPage</span>(<span class="params">CityList cityList</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">            cities = cityList;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnListViewItemSelected</span>(<span class="params"><span class="built_in">object</span> sender, SelectedItemChangedEventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            DisplayAlert(<span class="string">&quot;æœªå®Œæˆçš„åŠŸèƒ½&quot;</span>, <span class="string">&quot;ä½ ç‚¹å®ƒå¹²å˜›å•Šï¼Œæˆ‘æƒ³ä¸å‡ºè¿™é‡Œè¦åšä»€ä¹ˆæ“ä½œã€‚&quot;</span>, <span class="string">&quot;å–æ¶ˆ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">SearchByNameClicked</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (InputName.Text == <span class="string">&quot;&quot;</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;è¦æœç´¢çš„åŸå¸‚åä¸èƒ½ä¸ºç©ºã€‚&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                SeqList&lt;<span class="built_in">int</span>&gt; indices = cities.SearchByName(InputName.Text);</span><br><span class="line">                ShowFoundCities(indices);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            catch (Exception ex)</span><br><span class="line">            &#123;</span><br><span class="line">                DisplayActionSheet(<span class="string">&quot;å‘ç”Ÿé”™è¯¯ï¼Œæœªèƒ½å®Œæˆæœç´¢: \n&quot;</span> + ex.Message, <span class="string">&quot;Cancel&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">SearchByLocationClicked</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> ((InputX.Text == <span class="string">&quot;&quot;</span>) || (InputY.Text == <span class="string">&quot;&quot;</span>) || (InputRadius.Text == <span class="string">&quot;&quot;</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;è¦æœç´¢çš„ä¸­å¿ƒåæ ‡Xã€Yä»¥åŠæœç´¢åŠå¾„Radiusä¸èƒ½ä¸ºç©ºã€‚&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Point2D center = <span class="keyword">new</span> Point2D(<span class="built_in">double</span>.Parse(InputX.Text), <span class="built_in">double</span>.Parse(InputY.Text));</span><br><span class="line">                <span class="built_in">double</span> radius = <span class="built_in">double</span>.Parse(InputRadius.Text);</span><br><span class="line"></span><br><span class="line">                SeqList&lt;<span class="built_in">int</span>&gt; indices = cities.SearchByLocation(center, radius);</span><br><span class="line">                ShowFoundCities(indices);</span><br><span class="line">            &#125;</span><br><span class="line">            catch (Exception ex)</span><br><span class="line">            &#123;</span><br><span class="line">                DisplayActionSheet(<span class="string">&quot;å‘ç”Ÿé”™è¯¯ï¼Œæœªèƒ½å®Œæˆæœç´¢: \n&quot;</span> + ex.Message, <span class="string">&quot;Cancel&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">ShowFoundCities</span>(<span class="params">SeqList&lt;<span class="built_in">int</span>&gt; indices</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            CityList foundCities = <span class="keyword">new</span> CityList();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; indices.Length; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                foundCities.InsertAtHead(cities[indices[i]]);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            CitySearchListView.ItemsSource = foundCities;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (foundCities.IsEmpty())</span><br><span class="line">            &#123;</span><br><span class="line">                NoResultFound();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">NoResultFound</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            DisplayAlert(<span class="string">&quot;æ— ç»“æœ&quot;</span>, <span class="string">&quot;æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„åŸå¸‚ã€‚&quot;</span>, <span class="string">&quot;å–æ¶ˆ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>OKäº†ï¼Œç•Œé¢çš„è®¾è®¡ä¹Ÿå®Œæˆäº†ï¼Œï¼Œï¼Œè¿™ä¸ªä¸œè¥¿å¥½åƒå·²ç»å…¨éƒ¨ä»‹ç»å®Œäº†ï¼Œå› ä¸ºç®€å•å˜›ï¼Œæ²¡å¤šå°‘å¥½è¯´çš„ã€‚æˆ‘å…ˆå»ç¡ä¸ªè§‰å†æ¥ç€ä»‹ç»ä¸€ä¸‹æˆ‘é‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚</p><p>â€¦â€¦ Me.Sleep(11 * time.Hour);    // å‡ ä¸ªå°æ—¶è¿‡å»äº†</p><h2 id="å®ç°éš¾ç‚¹"><a href="#å®ç°éš¾ç‚¹" class="headerlink" title="å®ç°éš¾ç‚¹"></a>å®ç°éš¾ç‚¹</h2><p>æˆ‘å‰é¢ç»™å‡ºä»£ç çš„é‡Œé¢æœ‰äº› IEnumerable, INotifyPropertyChanged ä¹‹ç±»çš„ä¸œè¥¿ï¼Œæˆ‘æ²¡æœ‰è§£é‡Šè¿™æ˜¯å¹²ä»€ä¹ˆçš„ï¼Œæ˜¯å› ä¸ºè¿™ä¸ªé—®é¢˜æ¯”è¾ƒå¤æ‚ï¼ˆæ˜¯å› ä¸ºæˆ‘è¿˜æ²¡æœ‰ä¼˜é›…åœ°è§£å†³é—®é¢˜ï¼‰ï¼Œç•™åˆ°è¿™é‡Œæ¥å•ç‹¬è®¨è®ºã€‚</p><p>åœ¨æˆ‘ä»¬å®ç°çš„è®¾è®¡çš„æ—¶å€™ï¼ŒåŸå¸‚æ”¾åˆ°äº†ç»§æ‰¿è‡ª <code>SLinkList</code> çš„ <code>CityList</code>ï¼Œç„¶åæˆ‘ä»¬æŠŠè¿™ä¸ª <code>CityList</code> æ”¾åˆ°äº† Xamarin æä¾›çš„ <code>ListView</code> ä¸­æ˜¾ç¤ºå‡ºæ¥ã€‚æ³¨æ„åˆ°äº†æ²¡æœ‰ï¼Ÿé—®é¢˜å°±æ˜¯äººå®¶ Xamarin çš„ç»„ä»¶ä¸ºä»€ä¹ˆæ”¯æŒå’±è‡ªå·±å®ç°çš„é‡ç”Ÿæ•°æ®ç»“æ„ï¼Ÿ</p><p><code>ListView</code> æ˜¯é€šè¿‡ set <code>ItemsSource</code> æ¥ç»™å®šè¦æ˜¾ç¤ºçš„åˆ—è¡¨çš„ï¼Œè€Œè¿™ä¸ª <code>ItemsSource</code> çš„æ¥æ”¶çš„æ˜¯ <code>IEnumerable</code> æ¥å£çš„å®ç°ã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦è®© <code>CityList</code> å®ç°ä¸€ä¸ª <code>IEnumerable</code> å°±å¯ä»¥æ˜¾ç¤ºå‡ºæ¥äº†ã€‚</p><p>ä½†ï¼Œä»…ä»…æ˜¯ç°å®å‡ºæ¥ï¼å¦‚æœä½ å»å°è¯•è¿è¡Œï¼Œä¼šå‘ç°ï¼Œåœ¨ <code>CityList</code> åœ¨å±å¹•ä¸Šæ˜¾ç¤ºå‡ºæ¥åï¼Œä½ å°½ç®¡å¾€é‡Œé¢æ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹ï¼Œæ˜¾ç¤ºå‡ºæ¥çš„åˆ—è¡¨æ€»æ˜¯çº¹ä¸ä¸åŠ¨ï¼</p><p>è¿™çœ‹ä¸Šå»å¥½åƒæ˜¯æˆ‘ä»¬è‡ªå·±å®ç°çš„ <code>CityList</code> è¿˜æ˜¯æœ‰ç¼ºé™·ï¼Œä¸èƒ½æ”¯æŒ ListView çš„è‡ªåŠ¨æ›´æ–°ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¢ä¸€ä¸ªç³»ç»Ÿçš„åˆ—è¡¨å®ç°ï¼Œç”¨ <code>List&lt;City&gt;</code> ä»£æ›¿ <code>CityList</code>ã€‚å†æ¬¡å°è¯•ï¼Œä½ è¿˜æ˜¯ä¼šå‘ç° ListView ä¸ä¼šè‡ªåŠ¨æ›´æ–°ï¼</p><p>è¿™å°±æœ‰ç‚¹ç¦»è°±äº†å•Šï¼ŒListView ä¸æ”¯æŒç³»ç»Ÿæ ‡å‡†å®ç°çš„ List!</p><p>äº‹å·²è‡³æ­¤ï¼Œæˆ‘ä»¬åªå¥½çœ‹è°·æ­Œçœ¼è‰²è¡Œäº‹ã€‚ç½‘ä¸Šä¸€äº›å¤§ä½¬ç»™å‡ºçš„ Xamarin.Forms ListView æœ€ä½³å®è·µä¸­ï¼Œæ€»æ˜¯ä¼šåœ¨ä»£ç é‡Œç»™ <code>ItemsSource</code> ä¼ ä¸€ä¸ª <code>List&lt;&gt;</code> çš„æ•°æ®ï¼Œç„¶åé¡ºä¾¿æé‚£ä¹ˆä¸€å¥ï¼šâ€œè¿™é‡Œæ›´æ¨èç”¨ ObservableCollectionï¼Œä»¥å®ç°æ•°æ®åˆ·æ–°ååˆ—è¡¨çš„æ›´æ–°æ˜¾ç¤ºâ€¦â€¦â€</p><p>é‚£å¥½å§ï¼Œçœ‹æ¥æˆ‘ä»¬æŒ‰ç…§å¤§ä½¬çš„å»ºè®® æŠŠ List æ¢æˆ <code>ObservableCollection</code>ï¼Œç„¶åæ•°æ®æ›´æ–°çœŸçš„ä¼šè‡ªåŠ¨æ˜¾ç¤ºäº†ï¼</p><p>æˆ‘ç»§ç»­ç ”ç©¶äº†ä¸€ä¸‹è¿™ä¸ª <code>ObservableCollection</code>ï¼Œç½‘ä¸Šè¯´å› ä¸º ObservableCollection å®ç°äº†<code>INotifyPropertyChanged</code>ï¼Œæ‰€ä»¥ ListView æ‰å¯ä»¥è‡ªåŠ¨æ›´æ–°ã€‚</p><p>ä»¿ç…§ <a href="https://docs.microsoft.com/en-us/dotnet/api/system.componentmodel.inotifypropertychanged?view=netframework-4.8">INotifyPropertyChanged Interfaceçš„æ–‡æ¡£</a> æˆ‘å®ç°çš„ INotifyPropertyChanged å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">event</span> PropertyChangedEventHandler PropertyChanged;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">NotifyPropertyChanged</span>(<span class="params">String info</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.PropertyChanged != <span class="literal">null</span>)<span class="comment">// è¿™é‡Œè¿˜å¯ä»¥ç®€åŒ–æˆå§”æ‰˜ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.PropertyChanged(<span class="keyword">this</span>, <span class="keyword">new</span> PropertyChangedEventArgs(info));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Remove</span>(<span class="params"><span class="built_in">int</span> index</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    NotifyPropertyChanged(<span class="string">&quot;remove&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Insert</span>(<span class="params"><span class="built_in">int</span> index, T data</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    NotifyPropertyChanged(<span class="string">&quot;insert&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œè¿™æ ·ä¹Ÿä¸è¡Œï¼æ•°æ®è¿˜æ˜¯ä¸ä¼šè‡ªåŠ¨åˆ·æ–°ã€‚</p><p>ç„¶åæˆ‘æŸ¥äº† <a href="https://referencesource.microsoft.com/#System/compmod/system/collections/objectmodel/observablecollection.cs,4eb38b95b10327e7">ObservableCollectionçš„æºç </a> ï¼Œæˆ‘å°è¯•æŠ„ä»–çš„ä»£ç ï¼Œå¾—åˆ°äº†ä¸€ä¸ªè¿™æ ·çš„ SLinkListï¼ˆè¿™é‡Œç®€åŒ–ç»†èŠ‚äº†ï¼Œè¯¦ç»†çš„ä»£ç å°±æ˜¯ä¹‹å‰è®¾è®¡å®ç°éƒ¨åˆ†ç»™å‡ºçš„ SLinkList æºç ï¼‰ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.ComponentModel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DataStructureAlgorithm.LinearList</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SLinkList</span>&lt;<span class="title">T</span>&gt; : <span class="title">ILinearList</span>&lt;<span class="title">T</span>&gt;, <span class="title">INotifyPropertyChanged</span> <span class="keyword">where</span> <span class="title">T</span> : <span class="title">IComparable</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Length &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">protected</span> <span class="built_in">string</span> LengthStr = <span class="string">&quot;Length&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> SNode&lt;T&gt; HeadNode &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">protected</span> <span class="built_in">string</span> HeadNodeStr = <span class="string">&quot;HeadNode&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">SLinkList</span>(<span class="params"></span>)</span> &#123;...&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">event</span> PropertyChangedEventHandler PropertyChanged;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> SNode&lt;T&gt; <span class="title">NodeAt</span>(<span class="params"><span class="built_in">int</span> index</span>)</span> &#123; ... &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> T <span class="keyword">this</span>[<span class="built_in">int</span> index]</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> &#123;...&#125;</span><br><span class="line">            <span class="keyword">set</span></span><br><span class="line">            &#123;</span><br><span class="line">                ...</span><br><span class="line">                OnPropertyChanged(IndexerName);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">protected</span> <span class="built_in">string</span> IndexerName = <span class="string">&quot;this[]&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Clear</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            ...</span><br><span class="line">            OnPropertyChanged(LengthStr);</span><br><span class="line">            OnPropertyChanged(IndexerName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Insert</span>(<span class="params"><span class="built_in">int</span> index, T data</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            ...</span><br><span class="line">            OnPropertyChanged(LengthStr);</span><br><span class="line">            OnPropertyChanged(IndexerName);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">InsertAtHead</span>(<span class="params">T data</span>)</span> &#123; Insert(<span class="number">0</span>, data); &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">InsertAtRear</span>(<span class="params">T data</span>)</span> &#123; Insert(Length, data); &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">IsEmpty</span>(<span class="params"></span>)</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Remove</span>(<span class="params"><span class="built_in">int</span> index</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            ...</span><br><span class="line">            OnPropertyChanged(LengthStr);</span><br><span class="line">            OnPropertyChanged(IndexerName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">Search</span>(<span class="params">T data</span>)</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">event</span> PropertyChangedEventHandler INotifyPropertyChanged.PropertyChanged</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">add</span></span><br><span class="line">            &#123;</span><br><span class="line">                PropertyChanged += <span class="keyword">value</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">remove</span></span><br><span class="line">            &#123;</span><br><span class="line">                PropertyChanged -= <span class="keyword">value</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnPropertyChanged</span>(<span class="params"><span class="built_in">string</span> propertyName</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            OnPropertyChanged(<span class="keyword">new</span> PropertyChangedEventArgs(propertyName));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnPropertyChanged</span>(<span class="params">PropertyChangedEventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (PropertyChanged != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                PropertyChanged(<span class="keyword">this</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œè¿™æ ·è¿˜æ˜¯ä¸è¡Œã€‚ã€‚ã€‚ã€‚ã€‚ã€‚æˆ‘è§‰å¾—é—®é¢˜å¯èƒ½æ˜¯å‡ºåœ¨æˆ‘å†™çš„ <code>OnPropertyChanged(IndexerName)</code>ã€<code>protected string IndexerName = &quot;this[]&quot;;</code> è¿™é‡Œï¼Œæˆ‘è§‰å¾—ä¸åº”è¯¥æ˜¯ <code>this[]</code>ï¼Œä½†æˆ‘å®Œå…¨ä¸çŸ¥é“è¿™ä¸ª <code>propertyName</code> æ˜¯ä»€ä¹ˆä¸œè¥¿ã€åº”è¯¥å†™ä»€ä¹ˆã€‚ã€‚ã€‚</p><hr><p>ç›®å‰ï¼Œæˆ‘è§£å†³çš„æ–¹æ³•æ˜¯ï¼Œå¼ºåˆ¶ ListView å»é‡æ–°è½½å…¥æ•°æ®æºï¼Œè¿™è‚¯å®šä¸æ˜¯ä¸ªå¥½åŠæ³•ï¼Œè¿™æ ·å»åˆ·æ–°ç•Œé¢ä¼šå¿«é€Ÿé—ªå‡ºæ–°æ•°æ®ï¼Œè€Œä¸æ˜¯åƒä½¿ç”¨ ObservableCollection ä½œä¸ºæ•°æ®æºé‚£æ ·ä¿®æ”¹æ•°æ®åä¼šè‡ªåŠ¨æœ‰å¹³æ»‘çš„åŠ¨ç”»å»å±•ç¤ºåˆ—è¡¨å˜åŠ¨ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">refreshCityListView</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// CityListView.BeginRefresh();</span></span><br><span class="line">    CityListView.ItemsSource = <span class="literal">null</span>;</span><br><span class="line">    CityListView.ItemsSource = cities;</span><br><span class="line">    <span class="comment">// CityListView.EndRefresh();</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¹ˆåšå®åœ¨ç¬¨æ‹™ï¼Œä½†ä¸€æ—¶åŠä¼šæˆ‘ç¡®å®æ— èƒ½è§£å†³å¦‚ä½•å®ç°ä¸€ä¸ª <code>ObservableCollection</code> çš„é—®é¢˜ã€‚å¦‚æœä½ æœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆè¯·åŠ¡å¿…ä¸æˆ‘åˆ†äº«ğŸ¥º</p><h2 id="å…³äºæ•´ä½“-App-è®¾è®¡ä¸å±•æœ›"><a href="#å…³äºæ•´ä½“-App-è®¾è®¡ä¸å±•æœ›" class="headerlink" title="å…³äºæ•´ä½“ App è®¾è®¡ä¸å±•æœ›"></a>å…³äºæ•´ä½“ App è®¾è®¡ä¸å±•æœ›</h2><p>åœ¨ä¸€å¼€å§‹æˆ‘æåˆ°è¿‡æˆ‘æŠŠè¿™ä¸ªåŸå¸‚é“¾è¡¨åªå†™æˆäº†è¿™ä¸ª App é‡Œçš„ä¸€ä¸ªåŠŸèƒ½ï¼æˆ‘æƒ³æŠŠè¿™ä¸ª App å†™æˆä¸€ä¸ªæ¯”è¾ƒå…¨çš„æ•°æ®ç»“æ„ä¸ç®—æ³•æ¼”ç¤ºã€‚</p><p>ä½†å…¶å®è¿™ä¹ŸæŒºéš¾çš„ï¼Œæ˜¯ä¸ªä¸å°çš„å·¥ç¨‹äº†ï¼åœ¨æˆ‘çš„æ„æƒ³ä¸­ï¼Œè¿™ä¸ª App çš„å®Œæ•´å½¢æ€åº”è¯¥æ˜¯åˆ†æˆ 4 ä¸ªæ¿å—çš„ï¼š</p><ul><li><em>å­¦ä¹ </em>ï¼šå°±æ˜¯æ”¾æ•°æ®ç»“æ„ä¸ç®—æ³•å­¦ä¹ çš„èµ„æ–™ï¼Œå‚è€ƒâ€œç®—æ³•åŠ¨ç”»å›¾è§£â€ï¼›</li><li><em>è¯•éªŒ</em>ï¼šå°±æ˜¯æ”¾æ¯”å¦‚æˆ‘ä»¬è¿™æ¬¡çš„åŸå¸‚é“¾è¡¨è¿™æ ·çš„æ•°æ®ç»“æ„ä½¿ç”¨å®è·µçš„åœ°æ–¹ï¼Œå³ç°åœ¨å·²ç»å®ç°çš„â€œç›®å½•â€é¡µï¼›</li><li><em>äº¤æµ</em>ï¼šå°±æ˜¯ä¸€ä¸ª WebView æ‰“å¼€ä¸ª Wordpress è®ºå›äº†ï¼›</li><li><em>æˆ‘çš„</em>ï¼šç™»å½•ã€æ”¶è—ã€è®¾ç½®ã€å…³äºã€åé¦ˆè¿™ä¸€å¥—ã€‚</li></ul><p>è¿™ä¸ªè¦åšèµ·æ¥æ—¶é—´å°±æ¯”è¾ƒé•¿äº†ï¼Œæ…¢æ…¢æ¥å§ï¼Œæœ‰æœºä¼šå°±æŠŠå®ƒåšå‡ºæ¥ã€‚(ä¸»è¦æ˜¯å’±äº¤ä¸èµ·99ç¾å…ƒçš„å¹´è´¹ï¼Œä¸ç„¶è¿™ä¸œè¥¿åšå‡ºæ¥æ„Ÿè§‰éƒ½å¯ä»¥ä¸Šæ¶ App Store äº†:)</p><hr><p>è¯¥ App çš„å¼€å‘æ—¥åä¼šæ”¾åˆ° Github å¼€æºè¿›è¡Œï¼ˆåœ¨æˆ‘æŠŠåŸºæœ¬çš„æ¡†æ¶é‡æ„å‡ºæ¥ä¹‹åï¼‰ï¼Œæ¬¢è¿å‚ä¸ã€‚</p><h2 id="ï¼ˆè’Ÿè’»çš„æŠ±æ€¨-Part2ï¼‰"><a href="#ï¼ˆè’Ÿè’»çš„æŠ±æ€¨-Part2ï¼‰" class="headerlink" title="ï¼ˆè’Ÿè’»çš„æŠ±æ€¨-Part2ï¼‰"></a>ï¼ˆè’Ÿè’»çš„æŠ±æ€¨-Part2ï¼‰</h2><p><del>â€œè¿™ App å¼€å‘è¿˜æ˜¯ä¸å®¹æ˜“å•Šâ€¦â€¦â€, ç˜«ååœ¨æ¤…å­ä¸Šçš„è’Ÿè’»æŠ±æ€¨åˆ°ã€‚</del></p><p>â€œè¿™ App å¼€å‘è¿˜æ˜¯å¾ˆæœ‰æ„æ€çš„ï½â€ï¼Œè’Ÿè’»å…´é«˜é‡‡çƒˆåœ°å†™ä¸‹è¿™ç¯‡æ–‡ç« çš„æœ€åä¸€å¥ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode P122 ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II</title>
      <link href="/2020/03/04/School/Leetcode_P122_best-time-to-buy-and-sell-stock-ii/"/>
      <url>/2020/03/04/School/Leetcode_P122_best-time-to-buy-and-sell-stock-ii/</url>
      
        <content type="html"><![CDATA[<h1 id="Leetcode-P122-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº-II"><a href="#Leetcode-P122-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº-II" class="headerlink" title="Leetcode P122 ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II"></a>Leetcode P122 ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II</h1><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œå®ƒçš„ç¬¬ i ä¸ªå…ƒç´ æ˜¯ä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚</p><p>è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚ä½ å¯ä»¥å°½å¯èƒ½åœ°å®Œæˆæ›´å¤šçš„äº¤æ˜“ï¼ˆå¤šæ¬¡ä¹°å–ä¸€æ”¯è‚¡ç¥¨ï¼‰ã€‚</p><p>æ³¨æ„ï¼šä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰ã€‚</p><p>ç¤ºä¾‹ 1:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: [7,1,5,3,6,4]</span><br><span class="line">è¾“å‡º: 7</span><br><span class="line">è§£é‡Š: åœ¨ç¬¬ 2 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ &#x3D; 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 3 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ &#x3D; 5ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ &#x3D; 5-1 &#x3D; 4 ã€‚</span><br><span class="line">     éšåï¼Œåœ¨ç¬¬ 4 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ &#x3D; 3ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ &#x3D; 6ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ &#x3D; 6-3 &#x3D; 3 ã€‚</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 2:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: [1,2,3,4,5]</span><br><span class="line">è¾“å‡º: 4</span><br><span class="line">è§£é‡Š: åœ¨ç¬¬ 1 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ &#x3D; 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤© ï¼ˆè‚¡ç¥¨ä»·æ ¼ &#x3D; 5ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ &#x3D; 5-1 &#x3D; 4 ã€‚</span><br><span class="line">     æ³¨æ„ä½ ä¸èƒ½åœ¨ç¬¬ 1 å¤©å’Œç¬¬ 2 å¤©æ¥è¿è´­ä¹°è‚¡ç¥¨ï¼Œä¹‹åå†å°†å®ƒä»¬å–å‡ºã€‚</span><br><span class="line">     å› ä¸ºè¿™æ ·å±äºåŒæ—¶å‚ä¸äº†å¤šç¬”äº¤æ˜“ï¼Œä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ã€‚</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 3:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: [7,6,4,3,1]</span><br><span class="line">è¾“å‡º: 0</span><br><span class="line">è§£é‡Š: åœ¨è¿™ç§æƒ…å†µä¸‹, æ²¡æœ‰äº¤æ˜“å®Œæˆ, æ‰€ä»¥æœ€å¤§åˆ©æ¶¦ä¸º 0ã€‚</span><br></pre></td></tr></table></figure><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-ii">https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-ii</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p><h2 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h2><p>æœ‰ç‚¹å¿™ï¼Œæ²¡ç©ºå¥½å¥½ç ”ç©¶äº†ï¼Œä¸€éä»£ç æŠŠå®ƒè¿‡äº†ã€‚</p><p>è¿™ä¸ªé¢˜å°±ä¸€å¥è¯ï¼Œ<strong>ä½ä¹°é«˜å–</strong>ï¼å…·ä½“ä¸€ç‚¹ï¼Œæ˜¯<strong>æœ€ä½ä¹°ï¼Œæœ€é«˜å–</strong>ã€‚</p><p>éµå¾ªè¿™ä¸ªåŸåˆ™ï¼Œä»£ç ç›´æ¥å°±å‡ºæ¥äº†ï¼ŒGolangå®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxProfit</span><span class="params">(prices []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    prices = <span class="built_in">append</span>(prices, <span class="number">-1</span>)</span><br><span class="line">    in := <span class="number">0</span></span><br><span class="line">    profit := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(prices); i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> prices[i] &lt; prices[in] &#123;</span><br><span class="line">            in = i  <span class="comment">// ä½ä¹°</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> prices[i] &gt; prices[in] &amp;&amp; prices[i+<span class="number">1</span>] &lt; prices[i] &#123;</span><br><span class="line">            profit += prices[i] - prices[in]    <span class="comment">// é«˜å–</span></span><br><span class="line">            in = i</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> profit</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gci0b5zipvj318t0u0qu4.jpg" alt="å±å¹•å¿«ç…§ 2020-03-04 17.03.51"></p><p>é€Ÿåº¦è¿˜è¡Œï¼Œä¸€æ¬¡éå†å˜›ï¼Œ$O(n)$ï¼Œç©ºé—´ä¸Šä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘åŠ äº†ä¸€ä¸ªå°¾å“¨å…µï¼ˆå½“ç„¶æ˜¯å¯ä»¥é¿å…çš„ï¼Œå®Œå…¨å¯ä»¥å»æ‰ï¼Œå°±ä¸ä¼šæ‰ 8.12% äº†ï¼‰ã€‚</p><h2 id="ä¸€è¡Œä»£ç è§£æ³•"><a href="#ä¸€è¡Œä»£ç è§£æ³•" class="headerlink" title="ä¸€è¡Œä»£ç è§£æ³•"></a>ä¸€è¡Œä»£ç è§£æ³•</h2><p>è¿™æ¬¡æˆ‘ä¸æƒ³å†™ä¸€è¡Œä»£ç è§£æ³•äº†ï¼Œæ²¡æ—¶é—´æã€‚</p><p>åæ­£åŸºæœ¬ä¸Šï¼Œåªè¦æ˜¯ä½ èƒ½ç”¨ä¸€æ¬¡è¿­ä»£å®Œæˆçš„ç®—æ³•ä½ éƒ½å¯ä»¥ç”¨ Python å†™å‡½æ•°å¼ç¼–ç¨‹ï¼Œç”¨ä¸‹é¢è¿™ä¸ªæ¨¡å¼ä¸€è¡Œä»£ç è§£å†³ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">map</span>/reduce/<span class="built_in">filter</span>(<span class="keyword">lambda</span>å‡½æ•°, [åˆ—è¡¨ç”Ÿæˆå™¨])</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang å®æˆ˜â€”â€”å¾®ä¿¡å…¬ä¼—å·è¯¾ç¨‹æé†’ç³»ç»Ÿ</title>
      <link href="/2020/03/04/blog/WechatCourseNotifierInGolang/"/>
      <url>/2020/03/04/blog/WechatCourseNotifierInGolang/</url>
      
        <content type="html"><![CDATA[<h1 id="Golang-å®æˆ˜â€”â€”å¾®ä¿¡å…¬ä¼—å·è¯¾ç¨‹æé†’ç³»ç»Ÿ"><a href="#Golang-å®æˆ˜â€”â€”å¾®ä¿¡å…¬ä¼—å·è¯¾ç¨‹æé†’ç³»ç»Ÿ" class="headerlink" title="Golang å®æˆ˜â€”â€”å¾®ä¿¡å…¬ä¼—å·è¯¾ç¨‹æé†’ç³»ç»Ÿ"></a>Golang å®æˆ˜â€”â€”å¾®ä¿¡å…¬ä¼—å·è¯¾ç¨‹æé†’ç³»ç»Ÿ</h1><h2 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h2><p>æœ€æ—©å¼€å§‹å­¦ Golang å·²ç»æ˜¯æ•´æ•´ä¸€å¹´å‰äº†ï¼Œå½“æ—¶å°±æŠŠåŸºç¡€è¯­æ³•é‚£ä¸€å—å­¦å®Œäº†ï¼Œç„¶åæ‹¿ Golang å†™äº†ç‚¹ leetcode é¢˜ã€‚ä¹‹åç”±äºé¡¹ç›®é‡Œä¸€ç›´ç”¨ Python å’Œ Javaï¼ŒGolang è¿™ä¸€å—å°±æç½®ä¸‹æ¥æ²¡å­¦äº†ã€‚</p><p>ä¹‹å‰å¯’å‡æœ¬æ¥æ˜¯æ‰“ç®—å­¦ iOSã€Mac å¼€å‘è¿™ä¸€å—çš„ï¼Œæäº†ä¸¤ä¸ªæ˜ŸæœŸï¼Œæ„Ÿè§‰æš‚æ—¶ä¸æƒ³å­¦ä¸‹å»äº†ã€‚ï¼ˆæˆ‘æƒ³å­¦ SwiftUIï¼Œæˆ‘è§‰å¾—è¿™æ‰å¤Ÿé…·ï¼Œä½†æˆ‘ä¸æƒ³æ‹¿èµ–ä»¥ç”Ÿå­˜çš„è€ Macbook å°è¯• Catalinaï¼ŒMojave å†™ SwiftUI æ²¡æœ‰åŠæ—¶é¢„è§ˆï¼Œæ„Ÿè§‰æ²¡æœ‰çµé­‚äº†ã€‚ï¼‰</p><p>æ‰€ä»¥å°±æ¬å‡º Golang æ¥æ¥ç€å­¦äº†ã€‚çœ‹å®Œäº†å‡½æ•°ã€æ¥å£ã€å¹¶å‘è¿™ä¸€å—ï¼Œç„¶åå°±å­¦äº†ä¸€äº› Web å¼€å‘æ–¹é¢çš„ã€‚ï¼ˆè¿™æ‰å®åœ¨ï¼Œä¸ç„¶è¯­è¨€å­¦å®Œå°±åªèƒ½åˆ· leetcodeã€‚ï¼‰</p><p>å­¦å®Œäº†å·®ä¸å¤šå°±å¼€å­¦äº†ï¼Œåˆšå¥½æˆ‘ä¸€ç›´æ†æ¶è¶…çº§è¯¾ç¨‹è¡¨å¹¿å‘Šçš„çƒ¦æ‰°ï¼Œæ‰€ä»¥å°±æ‰“ç®—å†™ä¸€ä¸ªå¯ä»¥è‡ªåŠ¨ä»æ•™åŠ¡ç³»ç»Ÿè·å–è¯¾ç¨‹è¡¨ã€åœ¨ä¸Šè¯¾å‰æé†’çš„è¯¾ç¨‹è¡¨é¡¹ç›®ã€‚è¿™ä¸ªç…§ç†æ¥è¯´æ˜¯ä¸ªå‰ç«¯é¡¹ç›®ï¼Œä½† iOS å¼€å‘è¿™ä¸€å—è¿˜æ²¡å­¦å®Œã€‚æœ¬æ¥ Android ä¹Ÿè¡Œï¼Œä½†æˆ‘ç”¨ iPhone å•Šã€‚æ‰€ä»¥æƒ³äº†ä¸ªæ›²çº¿æ•‘å›½çš„æ–¹æ³•â€”â€”å¾®ä¿¡å…¬ä¼—å·å¼€å‘ï¼Œçº¯åç«¯ï¼Œæ‹¿æ¥ç»ƒä¹  Golang å†å¥½ä¸è¿‡ã€‚</p><hr><p>ç”±äºæ—¶é—´ã€ç©ºé—´æœ‰é™å¾ˆå¤šåœ°æ–¹æˆ‘å†™çš„ä¸å¤ªæ¸…æ™°ã€‚æ‰€ä»¥åœ¨å¼€å§‹é˜…è¯»æœ¬æ–‡ä¹‹å‰ï¼Œæˆ‘å»ºè®®ä½ æ‰“å¼€æºç ï¼Œå¯¹ç…§é˜…è¯»ã€‚ï¼š<a href="https://github.com/cdfmlr/CoursesNotifier">https://github.com/cdfmlr/CoursesNotifier</a>ï¼ˆæˆ‘ä»åœ¨æŒç»­å¯¹è¯¥é¡¹ç›®è¿›è¡Œå…¶è°ƒæ•´å’Œæ‹“å±•ï¼Œæœ¬æ–‡æ‰€è¿°è¯•ç”¨äº <code>72e6165</code> ç‰ˆæœ¬ï¼Œwhich is committed on Mar 25, 2020ï¼‰</p><hr><p>æˆ‘åœ¨è¿™ä¸ªé¡¹ç›®ä¸­çš„å¾ˆå¤šåœ°æ–¹å°è¯•äº† Golang çš„â€œé¢å‘å¯¹è±¡â€ã€‚Go ä¸æ˜¯ä¸€ä¸ªé¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œè¿™ç»™å†™æƒ¯äº† Javaã€Python çš„æˆ‘ä»¬è¿˜æ˜¯å¸¦æ¥äº†ä¸€äº›ä¸é€‚åº”çš„ã€‚ä½†æ²¡å…³ç³»ï¼Œæ­£å¦‚å®ƒçš„å‘æ˜è€…ä»¬æ‰€è¯´ï¼ŒGo æ˜¯ç”¨æ¥æ„å»ºç³»ç»Ÿçš„å®ç”¨è¯­è¨€ã€‚é¢å‘å¯¹è±¡ä¸å¯å¦è®¤æ˜¯æ„å»ºç³»ç»Ÿçš„å¼ºæœ‰åŠ›å·¥å…·ï¼ŒGolang å½“ç„¶ä¼šæœ‰æ‰€æ”¯æŒã€‚å½“ç„¶ï¼Œä¹Ÿåªæ˜¯æœ‰æ‰€æ”¯æŒï¼Œè€Œä¸æ˜¯çœŸæ­£çš„é¢å‘å¯¹è±¡ï¼Œæˆ‘åœ¨ coding çš„æ—¶å€™ï¼Œå°±åœ¨ä¸€ä¸ªéœ€è¦å¤šæ€çš„åœ°æ–¹ç¢°åˆ°äº†å›°éš¾ï¼Œæœ€åä¸å¾—ä¸æ›´æ”¹è®¾è®¡ï¼Œç¨å¾®æ²¡é‚£ä¹ˆä¼˜é›…äº†ã€‚</p><p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°è¯•è®°å½•æˆ‘å¼€å‘è¿™ä¸ªç³»ç»Ÿçš„æ•´ä¸ªè¿‡ç¨‹ã€è§£é‡Šå°½å¯èƒ½å¤šçš„ä»£ç è®¾è®¡ã€‚ä½†å› ä¸ºæ¯•ç«Ÿæ•´ä¸ªé¡¹ç›®æœ‰æ¥è¿‘3000è¡Œä»£ç ï¼Œæˆ‘ä¸å¯èƒ½é€ä¸€è§£é‡Šåˆ°ä½ã€‚å¦‚æœä½ æƒ³çœ‹æ‡‚æ‰€æœ‰ä¸œè¥¿ï¼Œè¯·å» GitHub æ‰“å¼€è¿™ä¸ªé¡¹ç›®çš„æºç å¯¹ç…§æ¥çœ‹ï¼Œæˆ‘ä¹Ÿæ˜¯ä¸ªåˆå­¦è€…ï¼Œå†™å‡ºçš„ä»£ç åº”è¯¥è¿˜æ˜¯å¾ˆç®€å•çš„ã€‚</p><p>å¦å¤–ï¼Œè¿™ç¯‡æ–‡ç« ä¸æ˜¯ Golang çš„å…¥é—¨ï¼Œåœ¨å¼€å§‹é˜…è¯»å‰è¯·ç¡®ä¿ä½ æŒæ¡äº†ï¼ˆèµ·ç æ˜¯æœ‰æ‰€äº†è§£ï¼‰ä»¥ä¸‹æŠ€èƒ½ï¼š</p><ul><li>Goè¯­è¨€åŸºç¡€ï¼š<a href="https://tour.go-zh.org/welcome/1">A Tour of Go</a> ï¼šå…¨éƒ¨å†…å®¹ï¼›</li><li>Goè¯­è¨€Webå¼€å‘åŸºç¡€ï¼š<a href="https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/preface.md">astaxie/build-web-application-with-golang</a> ï¼š1ï½7ç« ï¼›</li><li>å¾®ä¿¡å…¬ä¼—å·å¼€å‘åŸºç¡€ï¼š<a href="https://developers.weixin.qq.com/doc/offiaccount/Getting_Started/Getting_Started_Guide.html">å¾®ä¿¡å…¬ä¼—å·å…¥é—¨æŒ‡å¼•</a> ï¼š1ã€2ã€4èŠ‚ï¼›</li></ul><h2 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h2><p>æˆ‘çš„ç›®çš„å¾ˆæ˜ç¡®ï¼Œå°±æ˜¯åšä¸€ä¸ªå¾®ä¿¡å…¬ä¼—å·ç³»ç»Ÿï¼Œåœ¨ä¸Šè¯¾å‰å‘ä¸ªé€šçŸ¥æé†’å¿«ä¸Šè¯¾äº†ã€‚ä½†æˆ‘ä¸æƒ³æ‰‹åŠ¨è¾“å…¥è¯¾ç¨‹ä¿¡æ¯ï¼Œä¸ç„¶ iDaily Corp å¼€å‘çš„ã€Šè¯¾ç¨‹è¡¨Â·ClassTableã€‹å°±å·²ç»å¾ˆå¥½äº†ã€‚</p><p>æ‰€ä»¥è¿˜éœ€è¦è‡ªåŠ¨ä»æ•™åŠ¡ç³»ç»Ÿè·å–è¯¾ç¨‹è¡¨ï¼Œå­¦æ ¡ç”¨çš„æ–°æ•™åŠ¡ç³»ç»Ÿæ˜¯ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcnh3mn82nj318t0u07wh.jpg" alt="å±å¹•å¿«ç…§ 2020-03-09 10.35.24"></p><p>å—¯ï¼Œæˆ‘ç ”ç©¶äº†ä¸€ä¸‹ï¼Œä»–è¿™ä¸ªwebç«¯åçˆ¬è™«è¿˜æ˜¯åšçš„ä¸é”™çš„ï¼Œå¯ä»¥çˆ¬ï¼Œä½†ä¸å¥½çˆ¬ï¼é‚£æˆ‘ä»¬æ€ä¹ˆæåˆ°è¯¾è¡¨ï¼Ÿ</p><p>è¿˜å¥½æˆ‘å‘ç°äº†è¿™ä¸ªé¡¹ç›®ï¼š<a href="https://github.com/TLingC">TLingC</a>/**<a href="https://github.com/TLingC/QZAPI">QZAPI</a>**ã€‚è¿™ä½å¤§ä½¬çˆ¬äº†å¼ºæ™ºçš„ Appï¼ŒæŠ“å‡ºäº†è¿™å…¬å¸çš„ APIã€‚å¯ä»¥ç›´æ¥è°ƒç”¨è¿™ä¸ªæ¥å£è·å–è¯¾è¡¨äº†ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcnse0hy1gj318t0u0kcz.jpg" alt="image-20200309170649126"></p><p>è¿™ä¸ª API æ–‡æ¡£åšçš„æŒºå¥½ï¼Œæ— å¯æŒ‘å‰”ï¼›ä½†è¿™ä¸ª API ç€å®å¾ˆæ¶å¿ƒï¼Œçœ‹çœ‹ä»–è¿”å›çš„è¯¾è¡¨ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcnhjlijzyj30t0090dii.jpg" alt="image-20200309105136147"></p><p>è¿™å°±æ˜¯æˆ‘ä»¬â€œé¢†å…ˆçš„æ•™å­¦ä¸€ä½“åŒ–å¹³å°â€â€”â€”å¼º(ruo)æ™ºæ•™åŠ¡ç³»ç»Ÿï¼</p><p>æˆ‘æ‰¾ä¸åˆ°ä¸€ä¸ªåˆé€‚çš„ã€ä¸å¸¦ä¸ªäººæ„Ÿæƒ…è‰²å½©çš„è¯è¯­æ¥å®¢è§‚å…¬æ­£åœ°è¯„ä»·è¿™ä¸ªè®¾è®¡ã€‚ä¸ç®¡äº†ï¼Œä¹Ÿåªèƒ½å°†å°±ç€ç”¨äº†ã€‚</p><hr><p>è‚¿çš„æ¥è¯´ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿæœ‰ä¸¤æ–¹é¢ï¼š</p><ul><li>ä¸€ä¸ªæ˜¯è¾“å…¥(I)ï¼šè‡ªåŠ¨ä»æ•™åŠ¡ç³»ç»Ÿè·å–è¯¾è¡¨ï¼›</li><li>è¿˜æœ‰æ˜¯è¾“å‡º(O)ï¼šè‡ªåŠ¨æé†’å­¦ç”Ÿä¸Šè¯¾ã€‚</li></ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±ä¸€æ­¥ä¸€æ­¥æŠŠè¿™ä¸ªç³»ç»Ÿå®ç°ï¼š</p><h2 id="è®¾è®¡ä¸å®ç°"><a href="#è®¾è®¡ä¸å®ç°" class="headerlink" title="è®¾è®¡ä¸å®ç°"></a>è®¾è®¡ä¸å®ç°</h2><h3 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h3><p>é¦–å…ˆæ˜¯æ•°æ®åº“è®¾è®¡ã€‚</p><p>æœ¬æ¥å†™è¿™ä¸œè¥¿ MongoDB ç”¨æŒºæ–¹ä¾¿çš„ï¼Œä½†è¿™å­¦æœŸæœ‰æ•°æ®åº“è¯¾å˜›ï¼Œè‚¯å®šä¸å­¦è¿™äº› NoSQLï¼Œæ‰€ä»¥è¿˜æ˜¯å¤ä¹ ä¸€ä¸‹ SQLï¼Œç”¨ä¸€ä¸‹å…³ç³»å‹æ•°æ®åº“ã€‚</p><p>å…¶å®è¿™ä¸ªä¸œè¥¿æŒºä¼ ç»Ÿå•Šï¼Œå°±æ˜¯æ•°æ®åº“ä¹¦ä¸Šçš„ä¾‹å­å˜›ï¼Œä¸»è¦å°±ä¸‰ä¸ªè¡¨ï¼š</p><ul><li>ä¸€ä¸ª Student è¡¨ï¼Œå­˜å­¦å·ã€å¾®ä¿¡å·ï¼ˆå…¬ä¼—å·é‡Œçš„openidï¼‰è¿˜æœ‰æ•™åŠ¡å¯†ç ï¼ˆè¿™ä¸ªå¯ä»¥ä¸å­˜çš„ï¼Œå­˜äº†è¿˜ä¸å®‰å…¨ï¼Œæˆ‘ä¸çŸ¥é“æˆ‘è®¾è®¡çš„æ—¶å€™æ˜¯æ€ä¹ˆæƒ³çš„ï¼Œåæ‚”äº†ï¼Œä½†æ‡’å¾—æ”¹ğŸ˜‚ï¼‰</li><li>ä¸€ä¸ª Course è¡¨ï¼Œå­˜è¯¾ç¨‹åã€ä¸Šè¯¾æ—¶é—´ã€æ•™å®¤åœ°ç‚¹ã€æˆè¯¾è€å¸ˆâ€¦â€¦ï¼ˆå°±æ˜¯å¼ºæ™ºAPIè¿”å›çš„é‚£äº›ï¼‰</li><li>è¿˜æœ‰å°±æ˜¯ S-C é€‰è¯¾å…³ç³»è¡¨ã€‚</li><li>æœ€åï¼Œè¿˜æœ‰ä¸€ä¸ªå‚¨å­˜å½“å‰æ˜¯é‚£ä¸ªå­¦æœŸä¹‹ç±»çš„ä¿¡æ¯çš„è¡¨ã€‚</li></ul><p>æ¥çœ‹æœ€åè®¾è®¡å¥½çš„è¡¨ç»“æ„ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gchylz4iwyj30ra0f20vl.jpg" alt="å±å¹•å¿«ç…§ 2020-03-04 16.03.36"></p><h3 id="æ•°æ®æ¨¡å‹"><a href="#æ•°æ®æ¨¡å‹" class="headerlink" title="æ•°æ®æ¨¡å‹"></a>æ•°æ®æ¨¡å‹</h3><p>æœ‰äº†æ•°æ®åº“ï¼Œæˆ‘ä»¬è¿˜è¦åœ¨ç¨‹åºé‡Œä½¿ç”¨æ•°æ®åº“ã€‚ä¹Ÿå°±è¦æŠŠæ•°æ®åº“é‡Œçš„è®°å½•å¯¹åº”åˆ°ç¨‹åºé‡Œçš„ç»“æ„ä½“ï¼ˆModelsï¼‰ä¸­ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿ï¼ˆæ‡’ï¼‰ï¼Œæˆ‘ä»¬ç›´æ¥æŠŠæ•°æ®åº“é‡Œçš„ä¸œè¥¿å¯¹åº”è¿‡æ¥ï¼Œå¼„æˆè¿™å‡ ä¸ªæ¨¡å‹ï¼Œé‡Œé¢çš„å±æ€§å’Œæ•°æ®åº“çš„å±æ€§ä¸€ä¸€å¯¹åº”ï¼ˆé‚£ä¸ªcurrentå¤ªç®€å•äº†ï¼Œå°±æ˜¯ä¸€ä¸ªæ—¶é—´å˜›ï¼Œ <code>time.Time</code>ç›´æ¥å°±å¯ä»¥ç”¨äº†ï¼Œä¸ç”¨å†å»å°è£…äº†ï¼‰ï¼šÂ·Student</p><ul><li>Course</li><li>Relationship</li></ul><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gchz85gatjj313m0kq0w7.jpg" alt="å±å¹•å¿«ç…§ 2020-03-04 16.28.03 2"></p><blockquote><p><code>è“T</code>æ˜¯ç»“æ„ä½“ï¼Œä¸‹é¢çš„<code>é»„f</code>æ˜¯å±æ€§ï¼Œ<code>çº¢f</code>æ˜¯å‡½æ•°/æ–¹æ³•</p></blockquote><p>ï¼ˆè¿™äº›å›¾éƒ½æ˜¯ä» IDEA æˆªå›¾å‡ºæ¥è‡ªå·±éšæ‰‹æ‹¼çš„ï¼Œæ²¡æ—¶é—´å¥½å¥½è°ƒï¼Œæ‰€ä»¥æœ‰ç‚¹ä¸‘ï¼‰</p><p>ï¼ˆå¯¹ï¼Œæ²¡é”™ï¼Œæˆ‘ç”¨ IDEA å†™ Golangï¼ŒMacBook ç¡¬ç›˜å°é¸­ï¼Œæ²¡åŠæ³•ï¼Œå’±åšå¼ºçš„ IDEA å¸¦ä¸Šå‡ ä¸ªæ’ä»¶å°±è‚©è´Ÿèµ·äº†æˆ‘å®¶ Javaã€Androidã€Pythonã€Go çš„æ‰€æœ‰â€œå¤§å‹â€œé¡¹ç›®å¼€å‘ï¼‰</p><p>æ³¨æ„è¿™é‡Œå¼ºæ™ºç³»ç»ŸAPIè¯·æ±‚æ¥çš„è¯¾ç¨‹æ˜¯æ²¡æœ‰ <code>cid</code> çš„ï¼Œä½†æˆ‘ä»¬ä¸ºäº†å”¯ä¸€è¯†åˆ«ä¸€ä¸ªè¯¾ç¨‹ï¼Œæ‰€ä»¥åœ¨æ„é€ å‡½æ•° <code>NewCourse</code> é‡Œè‡ªåŠ¨é€šè¿‡è®¡ç®— Name,Teacher,Location,Begin,End,Week,When çš„ md5 å’Œå¾—å‡ºã€‚</p><p>æœ‰äº†æ¨¡å‹ï¼Œæˆ‘ä»¬å†å®ç°æ•°æ®æ“ä½œ(Data) :<code>StudentDatabase</code>ã€<code>CourseDatabase</code>ã€<code>StudentCourseRelationshipDatabase</code>ã€‚</p><p>è¿™å‡ ä¸ªä¸œè¥¿å®ç°æ•°æ®åº“ä¸æ¨¡å‹çš„è½¬åŒ–ï¼Œæä¾›å¢åˆ æ”¹æŸ¥æ“ä½œã€‚</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcnj23azd8j319y0q6tor.jpg" alt="å±å¹•å¿«ç…§ 2020-03-04 16.28.03 3"></p><p>(è¿™é‡Œæœ‰å¾ˆå¤šæ–¹æ³•å…¶å®éƒ½æ˜¯ä¸å¿…è¦çš„ï¼Œéƒ½æ˜¯ä¸€æ ·çš„æ“ä½œï¼Œæˆ‘åªæ˜¯ä¸€å¼€å§‹ä¸ºäº†å›¾æ–¹ä¾¿ï¼Œå¤åˆ¶ç²˜è´´å‡ºæ¥çš„)</p><h3 id="æ•™åŠ¡API-amp-Client"><a href="#æ•™åŠ¡API-amp-Client" class="headerlink" title="æ•™åŠ¡API&amp;Client"></a>æ•™åŠ¡API&amp;Client</h3><p>æœ‰äº†è¿™äº›æ•°æ®æ¨¡å‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¿é—®å¼ºæ™ºæ•™åŠ¡ç³»ç»Ÿäº†ã€‚</p><p>æˆ‘ä»¬å…ˆç”¨ Golang æŠŠã€å¼ºæ™ºæ•™åŠ¡ç³»ç»ŸAPIæ–‡æ¡£ã€‘(<a href="https://github.com/TLingC">TLingC</a>/<strong><a href="https://github.com/TLingC/QZAPI">QZAPI</a></strong>)é‡Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°çš„æ¥å£å°è£…ä¸€ä¸‹ã€‚æˆ‘ä»¬éœ€è¦ç”¨åˆ°çš„åªæ˜¯â€œè¯¾ç¨‹ä¿¡æ¯â€ï¼Œä½†ä½¿ç”¨â€œè¯¾ç¨‹ä¿¡æ¯â€ï¼Œåˆéœ€è¦æˆ‘ä»¬è¯·æ±‚â€œç™»å½•â€å’Œâ€œæ—¶é—´ä¿¡æ¯â€ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å°è£…è¿™ä¸‰ä¸ªè¯·æ±‚ã€‚</p><p>é˜…è¯»è¿™ä¸ªå¼ºæ™ºæ•™åŠ¡ç³»ç»ŸAPIæ–‡æ¡£ï¼Œæˆ‘ä»¬ä¼šå‘ç°æ‰€æœ‰è¯·æ±‚éƒ½æ˜¯ç±»ä¼¼çš„ GETï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET http:&#x2F;&#x2F;jwxt.xxxx.edu.cn&#x2F;app.do?method&#x3D;...&amp;...</span><br><span class="line"></span><br><span class="line">request.header&#123;token:&#39;è¿è¡Œèº«ä»½éªŒè¯authUseræ—¶è·å–åˆ°çš„tokenï¼Œæœ‰è¿‡æœŸæœºåˆ¶&#39;&#125;,</span><br><span class="line">request.data&#123;</span><br><span class="line">    &#39;method&#39;:&#39;ç™»å½•&#x2F;æ—¶é—´&#x2F;è¯¾ç¨‹ä¿¡æ¯ç­‰çš„æ–¹æ³•å&#39;,</span><br><span class="line">    &#39;...&#39;:  &#39;ä¸€äº›ç‰¹å®šçš„å‚æ•°&#39;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠè¿™ç§ â€œå¼ºæ™º API GETâ€ å°è£…èµ·æ¥ï¼Œåšæˆä¸€ä¸ª <code>qzApiGet</code> å‡½æ•°ï¼Œç®€åŒ–åé¢çš„å·¥ä½œã€‚è¿™ä¸ªå‡½æ•°é€šè¿‡ç»™å®šå­¦æ ¡åŸŸåï¼ˆå°±æ˜¯<code>jwxt.xxxx.edu.cn</code>çš„<code>xxxx</code>ï¼Œä¾‹å¦‚åç”µæ˜¯<code>ncepu</code>ï¼‰ã€tokenï¼ˆå¦‚æœæ˜¯ç™»å½•ä¸éœ€è¦tokenå°±ä¼ ç©ºå­—ç¬¦ä¸²<code>&quot;&quot;</code>ï¼‰ã€è¿˜æœ‰è§£æè¯·æ±‚ç»“æœçš„ç»“æ„ä½“å®ä¾‹resã€ä»¥åŠä¸€ä¸ªè¯·æ±‚å‚æ•°çš„mapï¼ˆå°±æ˜¯methodé‚£äº›ï¼‰ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">qzApiGet</span><span class="params">(school <span class="keyword">string</span>, token <span class="keyword">string</span>, res <span class="keyword">interface</span>&#123;&#125;, a <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="comment">// Make URL</span></span><br><span class="line">rawUrl := fmt.Sprintf(<span class="string">&quot;http://jwxt.%s.edu.cn/app.do&quot;</span>, school)</span><br><span class="line">Url, err := url.Parse(rawUrl)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add params</span></span><br><span class="line">params := url.Values&#123;&#125;</span><br><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> a &#123;</span><br><span class="line">params.Set(k, v)</span><br><span class="line">&#125;</span><br><span class="line">Url.RawQuery = params.Encode()</span><br><span class="line">urlPath := Url.String()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Make Request</span></span><br><span class="line">client := &amp;http.Client&#123;&#125;</span><br><span class="line">req, err := http.NewRequest(<span class="string">&quot;GET&quot;</span>, urlPath, <span class="literal">nil</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Add token</span></span><br><span class="line"><span class="keyword">if</span> token != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">req.Header.Add(<span class="string">&quot;token&quot;</span>, token)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GET and Parse Response</span></span><br><span class="line">resp, err := client.Do(req)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Println(err)</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line">body, err := ioutil.ReadAll(resp.Body)</span><br><span class="line">err = json.Unmarshal(body, res)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Handle Error and Return</span></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Println(err)</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰äº†è¿™ä¸ª <code>qzApiGet</code>ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ–¹ä¾¿åœ°å°è£…å‡ºæˆ‘ä»¬éœ€è¦çš„ä¸‰ä¸ªè¯·æ±‚äº†ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcnssefvudj319y0q6tga.jpg" alt="å±å¹•å¿«ç…§ 2020-03-04 16.28.03 4"></p><p>è¿™é‡Œé¢çš„ä¸ªå‡½æ•°å¤§åŒå°å¼‚ï¼Œæˆ‘ä¸¾å…¶ä¸­ä¸€ä¸ªä¾‹å­å°±å¥½äº†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetCurrentTime</span><span class="params">(school, token, currDate <span class="keyword">string</span>)</span> <span class="params">(*GetCurrentTimeRespBody, error)</span></span> &#123;</span><br><span class="line">resp := &amp;GetCurrentTimeRespBody&#123;&#125;</span><br><span class="line">q := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;</span><br><span class="line"><span class="string">&quot;method&quot;</span>:   <span class="string">&quot;getCurrentTime&quot;</span>,</span><br><span class="line"><span class="string">&quot;currDate&quot;</span>: currDate,</span><br><span class="line">&#125;</span><br><span class="line">err := qzApiGet(school, token, resp, q)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Println(err)</span><br><span class="line"><span class="keyword">return</span> &amp;GetCurrentTimeRespBody&#123;&#125;, err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> resp, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™äº›éƒ½æ˜¯ä¸€äº›ç›¸å½“äºé¢å‘å¯¹è±¡é‡Œçš„ <code>public static</code> çš„æ–¹æ³•å•Šï¼Œè°ƒç”¨èµ·æ¥è¿˜æ˜¯ä¸æ–¹ä¾¿ã€‚</p><p>æˆ‘ä»¬å¸Œæœ›æœ‰ä¸€ä¸ª <code>QzClient</code>ï¼Œè¿™ä¸ªä¸œè¥¿çš„å®ä¾‹å°±åƒæˆ‘ä»¬ä½¿ç”¨ app ä¸€æ ·çš„ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œç»™è¿™ä¸ªå®¢æˆ·ç«¯ç”¨æˆ·åã€å¯†ç ä»–å°±å¯ä»¥ç™»å½•äº†ï¼Œç„¶åä½ è¦è¯¾è¡¨å°±ç›´æ¥å–è¿™ä¸ªå®ä¾‹çš„ <code>Courses</code> å±æ€§ï¼Œä¸€åˆ‡è¯·æ±‚éƒ½åœ¨é»‘ç®±é‡Œå®Œæˆã€‚</p><p>æˆ‘ä»¬æŠŠè¿™ä¸ª Client å†™å‡ºæ¥ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcnt5k5hgrj30si0iaq6h.jpg" alt="image-20200309173318272"></p><p>ã€‚ã€‚ã€‚è¿™ä¹ä¸€çœ‹ï¼Œè¿˜æ˜¯å¾ˆå¯æ€•çš„ã€‚æ²¡å…³ç³»ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸ªæ…¢æ…¢è§£é‡Šã€‚</p><p>é¦–å…ˆè¯´å±æ€§ï¼Œ</p><ul><li><code>Student</code>ï¼šå°±æ˜¯æ¥ç”¨è¿™ä¸ªå¼ºæ™ºå®¢æˆ·ç«¯çš„å­¦ç”Ÿï¼Œ</li><li><code>token</code>ï¼šæ˜¯è¯¥å­¦ç”Ÿç™»å½•åè·å–çš„ tokenï¼Œ</li><li><code>CurrentXnxqId</code>ï¼šè¡¨ç¤ºå½“å‰å­¦å¹´å­¦æœŸIdï¼ˆåˆ«é—®æˆ‘ä¸ºä»€ä¹ˆè¿™ä¹ˆå‘½åï¼Œæ‰¾å¼ºæ™ºå…¬å¸å»ï¼ï¼‰ï¼Œ</li><li><code>CurrentWeek</code>ï¼šå½“å‰å‘¨æ¬¡</li><li><code>Courses</code>ï¼šå°±æ˜¯å½“å‰å­¦æœŸè¿™ä¸ªåŒå­¦çš„æ‰€æœ‰è¯¾ç¨‹å•¦ï¼Œå› ä¸ºéœ€è¦å»é‡ï¼Œæ‰€ä»¥æˆ‘ç›´æ¥ç”¨äº†ä¸€ä¸ª mapï¼Œkey æ”¾æˆ‘ä»¬çš„ <code>Cid</code>ï¼ˆmd5å’Œï¼‰ï¼Œvalue æ˜¯ <code>Course</code> ï¼Œè¿™æ ·å°±ä¿è¯äº†æ•°æ®ä¸é‡å¤ã€‚</li></ul><p>å†æ¥çœ‹æ–¹æ³•ï¼š</p><ul><li><code>AuthUser</code>ï¼šè°ƒç”¨æˆ‘ä»¬ å¼ºæ™º api é‡Œçš„ <code>AuthUser</code>ï¼Œç™»å½•å¼ºæ™ºç³»ç»Ÿï¼Œè·å–æ“ä½œ tokenï¼Œåœ¨è¯¥ token è¿‡æœŸä¹‹å‰å¯ä»¥åšå…¶ä»–æ“ä½œ;</li><li><code>FetchCurrentTime</code>ï¼šè°ƒç”¨ å¼ºæ™ºapi è·å–å½“å‰å­¦æœŸã€å‘¨æ¬¡ï¼Œå‚¨å­˜åœ¨ <code>CurrentXnxqId</code>ã€<code>CurrentWeek</code> é‡Œï¼›</li><li><code>FetchWeekCoursesSlowly</code>ï¼šè·å–æŸä¸ªæ˜ŸæœŸçš„è¯¾è¡¨ï¼Œè¦åçˆ¬è™«ï¼Œæ‰€ä»¥é‡Œé¢æ”¾äº†ä¸€ä¸ªSleepï¼Œé€Ÿåº¦å¾ˆæ…¢ï¼Œç”¨ chan å»â€œè¿”å›â€ç»“æœã€‚</li><li><code>FetchAllTermCourses</code>ï¼Œå¯¹ä¸€ä¸ªå­¦æœŸçš„æ¯ä¸ªå‘¨è°ƒç”¨ <code>FetchWeekCoursesSlowly</code>ï¼Œè·å–çœŸå­¦æœŸçš„è¯¾è¡¨ï¼Œå¹¶é€šè¿‡ <code>appendCourse</code> æŠŠè¿™äº›è¯¾ç¨‹æ·»åŠ åˆ°ç»“æ„ä½“çš„ <code>Courses</code> å±æ€§ä¸­ã€‚</li><li><code>Save</code>ï¼šåˆ†åˆ«è°ƒç”¨ <code>saveStudent</code>, <code>saveCourses</code>, <code>saveSCRelationships</code> æŠŠè¿™ä¸ªå®¢æˆ·ç«¯çš„å­¦ç”Ÿã€è¯¾ç¨‹ã€é€‰è¯¾å…³ç³»å†™å…¥åº“ï¼è¿™å°±æ˜¯æˆ‘ä»¬å”¯ä¸€å†™å…¥æ•°æ®çš„åœ°æ–¹ï¼</li></ul><p>å‘¼â€”â€”ç»ˆäºå†™å®Œè¿™äº›äº†ï¼Œè¿™é‡Œæœ‰ç‚¹æ¯ç‡¥ï¼Œç”¨å¼ºæ™ºçƒ‚ç³»ç»Ÿçš„æ¶å¿ƒ API å˜›ï¼Œæ²¡å¤šå°‘æ„æ€ã€‚</p><p>å°ç»“ä¸€ä¸‹ï¼Œåˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬æœ‰äº†æ•°æ®æ¨¡å‹ã€æ•°æ®åº“ï¼Œå¯ä»¥è®¿é—®æ•™åŠ¡ç³»ç»Ÿã€ä»æ•™åŠ¡ç³»ç»Ÿè‡ªåŠ¨è·å–ç»™å®šå­¦ç”Ÿçš„è¯¾è¡¨ï¼Œå¹¶æŠŠå­¦ç”Ÿã€è¯¾ç¨‹ã€é€‰è¯¾å…³ç³»å†™å…¥æ•°æ®åº“äº†ã€‚</p><p>æ¥ä¸‹æ¥å°±æ¯”è¾ƒæœ‰æ„æ€äº†ï¼Œæˆ‘ä»¬æ¥çœ‹è¯¾ç¨‹æ—¶é’Ÿçš„è®¾è®¡ã€‚</p><h3 id="è¯¾ç¨‹æ—¶é’Ÿ"><a href="#è¯¾ç¨‹æ—¶é’Ÿ" class="headerlink" title="è¯¾ç¨‹æ—¶é’Ÿ"></a>è¯¾ç¨‹æ—¶é’Ÿ</h3><p>å•¥ï¼Ÿè¯¾ç¨‹æ—¶é’Ÿï¼Ÿä»€ä¹ˆæ˜¯è¯¾ç¨‹æ—¶é’Ÿï¼Ÿå°±æ˜¯è¯´ï¼Œå’±ä»¬è¦åœ¨ä¸Šè¯¾å‰æé†’åŒå­¦ä»¬ä¸Šè¯¾ï¼Œè¿™å°±éœ€è¦æœåŠ¡å™¨çŸ¥é“ç°åœ¨æ˜¯ä»€ä¹ˆæ—¶é—´ã€ä¸Šè¯¾åœ¨ä»€ä¹ˆæ—¶é—´ã€‚ä¹Ÿå°±æ˜¯ä¸€ä¸ªåƒâ€œé’Ÿâ€ä¸€æ ·çš„ä¸œè¥¿ï¼Œä¸åœåœ°èµ°ï¼Œåœ¨æŒ‡å®šçš„å‡ ä¸ªæ—¶é—´ç‚¹â€œå“â€ï¼ˆæé†’ä¸Šè¯¾ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠè¿™ä¸ªæ¨¡å—å«åšè¯¾ç¨‹æ—¶é’Ÿâ€”â€”CourseTickerã€‚</p><p>è¿™ä¸ª CourseTicker çš„å®ç°å¾ˆç®€å•ä¹Ÿå¾ˆç›´è§‚ï¼Œå°±åƒé’Ÿâ€œæ»´ç­”æ»´ç­”â€åœ°èµ°å˜›ã€‚CourseTicker éœ€è¦å®šæ—¶å¯åŠ¨ï¼Œæ£€æµ‹å½“å‰æ˜¯ä¸æ˜¯å¿«ä¸Šè¯¾äº†ï¼Œå¦‚æœæ˜¯ï¼Œå°±æé†’å­¦ç”Ÿï¼Œä¸æ˜¯å°±ä»€ä¹ˆéƒ½ä¸åšã€‚</p><p>åœ¨ Go ä¸­ï¼Œè¦å®ç°è¿™æ ·çš„å®šæ—¶å¯åŠ¨ä»»åŠ¡å¾ˆæ–¹ä¾¿ï¼Œåªéœ€è¦åœ¨ä¸€ä¸ª for æ— é™å¾ªç¯ä¸­ç¡çœ ä¸€æ®µæ—¶é—´ï¼Œç„¶åå¯åŠ¨æ‰§è¡Œä»»åŠ¡å³å¯ï¼Œå½“ç„¶ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›è¿™æ ·æ°¸ä¸åœæ­¢çš„ä»»åŠ¡è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œæ‰€ä»¥ç”¨ä¸€ä¸ªã€ŒåŒ¿åå‡½æ•°ç«‹å³æ‰§è¡Œã€æ‰‹æ³•æŠŠå®ƒåŒ…è£…èµ·æ¥ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="comment">// è®¡ç®—ä¸‹ä¸€ä¸ªæ‰§è¡Œæ—¶é—´</span></span><br><span class="line">        now := time.Now()</span><br><span class="line">        next := now.Add(t.period)</span><br><span class="line">        <span class="comment">// ç­‰å¾…åˆ°æ—¶é—´</span></span><br><span class="line">        timer := time.NewTimer(next.Sub(now))</span><br><span class="line">        &lt;-timer.C</span><br><span class="line">        <span class="comment">// æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">        RunTickTask()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure><h4 id="æŠ½è±¡å‘¨æœŸè¿è¡Œå™¨"><a href="#æŠ½è±¡å‘¨æœŸè¿è¡Œå™¨" class="headerlink" title="æŠ½è±¡å‘¨æœŸè¿è¡Œå™¨"></a>æŠ½è±¡å‘¨æœŸè¿è¡Œå™¨</h4><p>ä¸Šé¢è¿™ä¸ªæ–¹æ³•è™½ç„¶åšåˆ°äº†ä¸åœè¿è¡Œã€å®šæ—¶æ‰§è¡Œï¼Œä½†æ˜¯æˆ‘ä»¬ä¸æ–¹ä¾¿æ§åˆ¶å®ƒçš„å¼€å§‹ã€ç»“æŸï¼Œè€Œä¸”è¿™æ®µä»£ç ä¹Ÿä¸æ–¹ä¾¿å¤ç”¨ã€‚æ‰€ä»¥æˆ‘ä»¬è€ƒè™‘å°è£…ä¸€ä¸ªå¯ä»¥æ§åˆ¶å¼€å§‹ã€ç»“æŸï¼Œèƒ½ä¸åœè¿è¡Œã€å®šæ—¶æ‰§è¡Œçš„ Ticker ç»“æ„ä½“ï¼ˆç›¸å½“äº OOP çš„ç±»ï¼‰ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcjx4wz2sbj30e609k3z9.jpg" alt="image-20200306084846495"></p><p>è§£é‡Šä¸€ä¸‹å®ƒæ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼š</p><ul><li><code>tickerId</code>: åªæ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œå› ä¸ºæˆ‘ä»¬å®Œå…¨å¯ä»¥åœ¨ä¸€ä¸ªç³»ç»Ÿä¸­ä½¿ç”¨å¤šä¸ªè¿™æ ·çš„ Ticker å®ä¾‹ï¼Œæ‰€ä»¥æä¸€ä¸ª tickerId ï¼Œæ‰“æ—¥å¿—çš„æ—¶å€™åšåŒºåˆ†ã€‚</li><li><code>period</code>: å°±æ˜¯é—´éš”çš„æ—¶é—´äº†ï¼Œæ¯éš”è¿™ä¹ˆä¹…å°±è·‘ä¸€æ¬¡ <code>RunTickTask</code> æ–¹æ³•ã€‚</li><li><code>end</code>: è¿™æ˜¯ç”¨æ¥æ§åˆ¶ç»“æŸçš„ channelï¼Œå¾€é‡Œé¢ä¼ å€¼å°±ä»£è¡¨ç»“æŸ Ticker çš„å‘¨æœŸæ€§è¿è¡Œäº†ã€‚</li><li><code>task</code>: å°±æ˜¯ä½ è¦ç”¨è¿™ä¸ª Ticker å‘¨æœŸæ€§å®Œæˆçš„å·¥ä½œï¼Œç›´æ¥ä¼ ä¸€ä¸ªå‡½æ•°è¿›æ¥ï¼ˆå‡½æ•°æ˜¯ Go çš„ä¸€ç­‰å…¬æ°‘å˜›ï¼‰</li><li><code>Start</code>: å¼€å§‹å‘¨æœŸæ€§ä»»åŠ¡ã€‚ä¼ ä¸€ä¸ªæ—¶é—´è¿›æ¥ï¼Œä»£è¡¨ä»è¿™ä¸ªæ—¶å€™å†å¼€å§‹ï¼Œè¿™ä¹ˆåšæ˜¯å› ä¸ºæˆ‘ä»¬å¯èƒ½å¸Œæœ›æ¯”å¦‚æ¯ä¸ªå°æ—¶æ•´ç‚¹çš„æ—¶å€™è·‘ä»»åŠ¡ï¼Œä½†æˆ‘ä»¬ä¸æƒ³ç­‰åˆ°æ­£ç‚¹å†å»å¼€å¯è¿™ä¸ªæœåŠ¡ï¼Œå°±å¯ä»¥é€šè¿‡ç»™ Start ä¼ ä¸€ä¸ª <code>08:00</code>(è¿™é‡Œåªæ˜¯ä¸¾ä¸ªä¾‹å­ï¼Œä½ è¦ä¼ çš„æ˜¯å®Œæ•´çš„æ—¶é—´ï¼Œæ¯”å¦‚ <code>time.Now()</code> å“¦)ï¼Œè¿™æ ·å®ƒç¬¬ä¸€æ¬¡å¼€å§‹å°±æ˜¯æ­£ç‚¹ï¼Œç¡çœ ä¸€ä¸ªå°æ—¶åå†è¿è¡Œï¼Œè¿˜æ˜¯æ­£ç‚¹â€¦â€¦è¿™æ ·å°±æ¯”è¾ƒæ–¹ä¾¿äº†ã€‚</li><li><code>RunTickTask</code>: è¦å‘¨æœŸæ€§è¿è¡Œçš„ä»»åŠ¡ï¼Œå…¶å®å°±æ˜¯æ‰“ä¸ªæ—¥å¿—ï¼Œç„¶åè°ƒç”¨å±æ€§é‡Œçš„ <code>task</code>ã€‚å•ç‹¬æä¸€ä¸ªå‡½æ•°å‡ºæ¥åšè¿™ä¸ªï¼Œä¸€ä¸ªæ˜¯æŠŠåŠŸèƒ½åˆ’åˆ†ç»†ï¼Œä¸åœ¨ Start é‡Œå†™å…·ä½“è¿è¡Œçš„é€»è¾‘ï¼Œè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯æ–¹ä¾¿ä½ å¯ä»¥åœ¨éå‘¨æœŸåˆ°çš„æ—¶å€™æ‰‹åŠ¨è°ƒç”¨ä»»åŠ¡ã€‚</li><li><code>End</code>: é€šçŸ¥ TickTask ç»ˆæ­¢è¿è¡Œã€‚å®é™…ä¸Šå°±æ˜¯å¾€ <code>end</code> é‡Œä¼ ä¸ªå€¼ï¼Œè®© Start é‡Œå¼€å§‹çš„å‘¨æœŸæ€§åŒ¿åå‡½æ•°æ”¶åˆ°è¿™ä¸ªæ¶ˆæ¯ï¼Œç»ˆæ­¢è¿è¡Œã€‚</li></ul><p>æ¥çœ‹ä¸€ä¸‹å¤§æ¦‚çš„ä»£ç å®ç°ï¼ˆç©ºé—´æœ‰é™ï¼Œæˆ‘åˆ äº†ä¸å¿…è¦çš„æ³¨é‡Šå’Œç©ºè¡Œï¼Œçœ‹èµ·æ¥å¯èƒ½æœ‰ç‚¹ä¸‘ï¼‰ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Ticker <span class="keyword">struct</span> &#123;</span><br><span class="line">tickerId <span class="keyword">string</span></span><br><span class="line">period   time.Duration</span><br><span class="line">end      <span class="keyword">chan</span> <span class="keyword">bool</span></span><br><span class="line">task     <span class="function"><span class="keyword">func</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *Ticker)</span> <span class="title">Start</span><span class="params">(time2Start time.Time)</span></span> &#123;</span><br><span class="line">time2Start = time2Start.Add(t.period * <span class="number">-1</span>)</span><br><span class="line"><span class="keyword">if</span> time2Start.Sub(time.Now()) &gt; <span class="number">0</span> &#123;</span><br><span class="line">timer := time.NewTimer(time2Start.Sub(time.Now()))</span><br><span class="line">&lt;-timer.C</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> &lt;-t.end:</span><br><span class="line">log.Printf(<span class="string">&quot;(Ticker &#123;%s&#125;) TickTask End Exed...\n&quot;</span>, t.tickerId)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">now := time.Now()</span><br><span class="line">next := now.Add(t.period)</span><br><span class="line">timer := time.NewTimer(next.Sub(now))</span><br><span class="line">&lt;-timer.C</span><br><span class="line">t.RunTickTask()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *Ticker)</span> <span class="title">RunTickTask</span><span class="params">()</span></span> &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;(Ticker &#123;%s&#125;) TickTask Run...\n&quot;</span>, t.tickerId)</span><br><span class="line"><span class="keyword">if</span> t.task != <span class="literal">nil</span> &#123;</span><br><span class="line">t.task()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *Ticker)</span> <span class="title">End</span><span class="params">()</span></span> &#123;</span><br><span class="line">t.end &lt;- <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è¯¾ç¨‹æ—¶é’Ÿ-1"><a href="#è¯¾ç¨‹æ—¶é’Ÿ-1" class="headerlink" title="è¯¾ç¨‹æ—¶é’Ÿ"></a>è¯¾ç¨‹æ—¶é’Ÿ</h4><p>ç°åœ¨æœ‰äº†å‘¨æœŸè¿è¡Œå™¨ Tickerï¼Œå†æ¥çœ‹ä¹‹å‰è¯´çš„ CourseTickerï¼Œä¸è¿‡å°±æ˜¯ä¸€ä¸ªç®€å•çš„ç»§æ‰¿å˜›ã€‚æˆ‘ä»¬è®© CourseTicker â€œç»§æ‰¿â€ Tickerï¼Œè¿™æ ·å®ƒå°±æœ‰äº†å‘¨æœŸæ€§è¿è¡Œçš„æŠ€èƒ½ï¼Œå†ç»™ä»–ä¸€äº›å…·ä½“çš„æ£€æŸ¥æ˜¯å¦å¿«è¦ä¸Šè¯¾äº†ã€ä»¥åŠæé†’ä¸Šè¯¾çš„åŠŸèƒ½å°±è¡Œäº†ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcnianyzkaj30t40dwju8.jpg" alt="image-20200309111736674"></p><p>å“ˆå“ˆï¼Œè¯´èµ·æ¥ç®€å•ï¼Œå®ç°èµ·æ¥è¿˜æ˜¯ä¸å®¹æ˜“çš„ã€‚ç”±äºå¼ºæ™ºæ•™åŠ¡ç³»ç»Ÿçš„é¬¼ç•œè®¾è®¡ï¼Œæˆ‘ä»¬ä¸å¾—ä¸æŠŠä»£ç å†™å¾—å¾ˆæ¶å¿ƒäº†ã€‚</p><p>è¿™é‡Œå¤§æ¦‚çš„æ€è·¯å°±æ˜¯ CoursesTicker çš„ <code>NotifyApproachingCourses</code> æ–¹æ³•ä½œä¸º Ticker çš„å‘¨æœŸæ€§ taskï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæŸ¥è¯¢ç°åœ¨æœ‰æ²¡æœ‰è¯¾å¿«å¼€å§‹äº†ï¼ˆå°±æ˜¯ <code>å¼€å§‹ä¸Šè¯¾æ—¶é—´ - å½“å‰æ—¶é—´ &lt;= minuteBeforeCourseToNotify</code>ï¼‰ï¼Œå¦‚æœæœ‰è¯¾å¿«å¼€å§‹äº†ï¼Œå°±æ‰¾å‡ºä¸Šè¿™äº›è¯¾çš„å­¦ç”Ÿï¼Œå»å‘é€šçŸ¥ç»™ä»–ä»¬ã€‚</p><p>å…·ä½“çš„å®ç°é‡Œæˆ‘ä»¬éœ€è¦è¿™å‡ ä¸ªè¾…åŠ©çš„å‡½æ•°ï¼š</p><ul><li><code>getNearestBeginTime</code> è·å–è·ç¦»å½“å‰æœ€è¿‘çš„è¯¾ç¨‹æ—¶é—´ï¼Œå°±æ˜¯ç”¨ <code>SELECT DISTINCT begin FROM course</code> æŸ¥è¯¢å‡ºæ‰€æœ‰å¯èƒ½çš„ä¸Šè¯¾æ—¶é—´ï¼Œæ‰¾å‡ºæœ€è¿‘çš„ä¸€ä¸ªã€‚</li><li><code>getCurrentWeek</code> è·å–å½“å‰æ•™å­¦å‘¨æ¬¡</li><li><code>isCourseInWeek</code> åˆ¤æ–­ä¸€ä¸ª models.Course æ˜¯å¦åœ¨æŒ‡å®šå‘¨æ¬¡(week) æœ‰è¯¾</li></ul><p>è€Œè¿™å‡ ä¸ªè¾…åŠ©å‡½æ•°çš„å®ç°åˆä¼šè°ƒç”¨è¿™å‡ ä¸ªè¾…åŠ©è¾…åŠ©å‡½æ•°(è¿™é‡Œæˆ‘ç›´æ¥æŠ„äº†ä»£ç é‡Œçš„æ–‡æ¡£æ³¨é‡Š)ï¼š</p><ul><li><code>_getPossibleCourseBeginTime</code>: è¿”å›æ•°æ®åº“ä¸­ä»Šã€æ˜ä¸¤å¤©çš„æ‰€æœ‰å¯èƒ½ä¸Šè¯¾æ—¶é—´</li><li><code>_durationToWeek</code>: convert a duration into week</li><li><code>_roundTime</code>: helps getting a reasonable int from a float, which is of great help when converting the duration into week</li></ul><p><code>NotifyApproachingCourses</code> çš„å†…éƒ¨å®ç°å°±æ˜¯é¦–å…ˆè°ƒç”¨ <code>getCurrentWeek</code> è·å–ä»Šå¤©æ˜¯ç¬¬å‡ å‘¨ã€è°ƒç”¨ <code>time.Now().Weekday()</code> è·å–ä»Šå¤©æ˜¯æ˜ŸæœŸå‡ ï¼ˆè¿™é‡Œè¿˜éœ€è¦æŠŠç³»ç»Ÿçš„æ˜ŸæœŸè¡¨ç¤ºæ–¹å¼æ¢ç®—æˆå¼ºæ™ºç³»ç»Ÿå†…çš„æ˜ŸæœŸè¡¨ç¤ºæ–¹å¼ï¼‰ï¼Œç„¶åè°ƒç”¨ <code>getNearestBeginTime</code> æœ€è¿‘ä¸€ä¸ªå¯èƒ½ä¸Šè¯¾çš„æ—¶é—´ï¼Œå¦‚æœè¿™ä¸ªæ—¶é—´è·ç¦»ç°åœ¨å·²ç» <code>&lt;= minuteBeforeCourseToNotify</code> äº†ï¼Œå°±è¦æ‰¾å‡ºåœ¨è¿™ä¸ªæ—¶é—´å¼€å§‹çš„æ‰€æœ‰è¯¾ç¨‹ï¼Œå¹¶é€šè¿‡ <code>isCourseInWeek</code> è¿‡æ»¤å‡ºæœ¬å‘¨è¿™ä¸ªæ—¶é—´è¦ä¸Šçš„è¯¾ï¼Œæœ€åå°±æ‰¾ä¸Šè¿™äº›è¯¾çš„å­¦ç”Ÿï¼Œé€šçŸ¥taä»¬è¦å¼€å§‹ä¸Šè¯¾äº†ã€‚</p><p>åˆ°è¿™é‡Œ CourseTicker è¦åšçš„äº‹å°±å®Œäº†ï¼Œæˆ‘ä»¬å¯ä¸æƒ³åœ¨å·²ç»è¿™ä¹ˆå¤æ‚çš„ä¸€ä¸ªæ¨¡å—é‡Œå†å®ç°ä¸€ä¸ªå¾®ä¿¡é€šçŸ¥çš„åŠŸèƒ½äº†ï¼Œé‚£æ ·è¿™ä¸ªâ€œç±»â€å°±é•¿åˆ°çˆ†ç‚¸äº†å‘€ã€‚</p><p>é€šçŸ¥åº”è¯¥æ˜¯ä¸€ä¸ªé€šçŸ¥æ¨¡å—åšçš„äº‹ã€‚ä½†åœ¨ CourseTicker é‡Œæˆ‘ä»¬è¦å®Œæˆé€šçŸ¥å‘€ï¼æ€ä¹ˆåŠï¼Ÿ</p><p>è°ƒç”¨æš‚æ—¶æ²¡æœ‰å…·ä½“å®ç°çš„ä¸œè¥¿â€”â€”å½“ç„¶æ˜¯ä½¿ç”¨<strong>æ¥å£</strong>äº†ã€‚</p><h3 id="é€šçŸ¥æ¥å£"><a href="#é€šçŸ¥æ¥å£" class="headerlink" title="é€šçŸ¥æ¥å£"></a>é€šçŸ¥æ¥å£</h3><p>è¿™ä¸ªé€šçŸ¥æ¥å£å¾ˆç®€å•å°±ä¸¤ä¸‰è¡Œä»£ç ï¼Œåªéœ€è¦æä¾›ä¸€ä¸ªé€šçŸ¥å‡½æ•° <code>Notify</code>ã€‚é€šè¿‡ç»™å®šè¦é€šçŸ¥çš„å­¦ç”Ÿã€è¦é€šçŸ¥çš„è¯¾ç¨‹ï¼Œè¿™ä¸ª <code>Notify</code> å‡½æ•°å»å®Œæˆé€šçŸ¥ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Notifier <span class="keyword">interface</span> &#123;</span><br><span class="line">Notify(student *models.Student, course *models.Course)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜å¯ä»¥é¡ºæ‰‹å®ç°ä¸€ä¸ª <code>Notifier</code> æ¥å£çš„å®ç°â€”â€” <code>LogNotifier</code>ï¼ŒæŠŠé€šçŸ¥çš„å­¦ç”Ÿã€è¯¾ç¨‹æ‰“å°åˆ° Log é‡Œï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> LogNotifier <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l LogNotifier)</span> <span class="title">Notify</span><span class="params">(student *models.Student, course *models.Course)</span></span> &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;(LogNotifier %s) Course Notify:\n\t|--&gt; student: %s\n\t|--&gt; course: %s (%s)&quot;</span>, l, student.Sid, course.Cid, course.Name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³äºå¾®ä¿¡æé†’ï¼Œå°±æ¯”è¾ƒå¤æ‚äº†ï¼Œæˆ‘ä»¬åœ¨ä¸‹é¢å•ç‹¬æ¥è¯´ã€‚</p><h3 id="å¾®ä¿¡ç³»ç»Ÿ"><a href="#å¾®ä¿¡ç³»ç»Ÿ" class="headerlink" title="å¾®ä¿¡ç³»ç»Ÿ"></a>å¾®ä¿¡ç³»ç»Ÿ</h3><p>æˆ‘ä»¬è¿™ä¸ªç³»ç»Ÿæ˜¯åŸºäºå¾®ä¿¡å…¬ä¼—å·çš„ï¼Œç°åœ¨æˆ‘ä»¬ç»ˆäºè®²åˆ°å¾®ä¿¡ç³»ç»Ÿäº†ã€‚æˆ‘ä»¬éœ€è¦çš„å¾®ä¿¡ç³»ç»Ÿæœ‰ä¸¤ä¸ªæ–¹é¢ï¼Œä¸€ä¸ªæ˜¯å¾®ä¿¡å…¬ä¼—å·çš„è¢«åŠ¨æœåŠ¡ï¼Œå°±æ˜¯æ¥å—ç”¨æˆ·å‘æ¥çš„æ¶ˆæ¯ï¼Œå®Œæˆè¯¾ç¨‹æé†’çš„è®¢é˜…ã€é€€è®¢æ“ä½œçš„ï¼›è¿˜æœ‰ä¸€æ–¹é¢å°±æ˜¯é€šè¿‡å¾®ä¿¡å…¬ä¼—å·å‘é€ä¸Šè¯¾æé†’ç»™ç”¨æˆ·äº†ã€‚</p><h4 id="å¾®ä¿¡ä¸Šè¯¾é€šçŸ¥"><a href="#å¾®ä¿¡ä¸Šè¯¾é€šçŸ¥" class="headerlink" title="å¾®ä¿¡ä¸Šè¯¾é€šçŸ¥"></a>å¾®ä¿¡ä¸Šè¯¾é€šçŸ¥</h4><p>æˆ‘ä»¬ç»§ç»­åˆšæ‰çš„é€šçŸ¥æ¥å£ï¼Œå…ˆçœ‹å¾®ä¿¡æé†’çš„å®ç°ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcolo3lgl3j31kk07swg8.jpg" alt="image-20200310095953835"></p><p>è¿™ä¸ª <code>WxNotifier</code> åªæœ‰ä¸€ä¸ª public çš„æ–¹æ³•ï¼Œå°±æ˜¯å®ç° Notifier çš„ <code>Notify</code>ã€‚è°ƒç”¨è¿™ä¸ª <code>Notify</code> çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦å®Œæˆå¾®ä¿¡é€šçŸ¥çš„æ„é€ å’Œå‘é€ï¼Œè¿™ä¸¤ä¸ªä»»åŠ¡åˆ†åˆ«ç”± <code>makeCourseNoticeBody</code> å’Œ <code>postCourseNotify</code> å®Œæˆã€‚</p><p>è®©æˆ‘ä»¬ç ”ç©¶ä¸€ä¸‹æ€ä¹ˆé€šè¿‡å¾®ä¿¡å…¬ä¼—å·å‘æ¶ˆæ¯ï¼Œæ¶ˆæ¯ä½“åˆéœ€è¦æ„é€ æˆä»€ä¹ˆæ ·çš„ï¼š</p><p>é€šè¿‡å¾®ä¿¡å…¬ä¼—å·ä¸»åŠ¨å‘é€æ¶ˆæ¯ç»™ç”¨æˆ·ï¼Œæˆ‘å¤§æ¦‚çœ‹äº†ä¸€éæ–‡æ¡£ï¼Œæœ€ç®€å•çš„åº”è¯¥å°±æ˜¯<a href="https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Template_Message_Interface.html">å‘é€æ¨¡ç‰ˆæ¶ˆæ¯</a>äº†ã€‚æ‰€ä»¥æˆ‘ä»¬æ¥å®ç°è¿™ä¸ªã€‚</p><hr><p>ï¼ˆå…ˆæ¥è¯»æ–‡æ¡£ï¼šï¼‰</p><p>è¦ä½¿ç”¨æ¨¡ç‰ˆæ¶ˆæ¯ï¼Œè¦å…ˆå®šä¹‰ä¸€ä¸ªæ¨¡ç‰ˆï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&#123; &#123;result.DATA&#125; &#125;\n\né¢†å¥–é‡‘é¢:&#123; &#123;withdrawMoney.DATA&#125; &#125;\né¢†å¥–  æ—¶é—´:    &#123; &#123;withdrawTime.DATA&#125; &#125;\né“¶è¡Œä¿¡æ¯:&#123; &#123;cardInfo.DATA&#125; &#125;\nåˆ°è´¦æ—¶é—´:  &#123; &#123;arrivedTime.DATA&#125; &#125;\n&#123; &#123;remark.DATA&#125; &#125;</span><br></pre></td></tr></table></figure><p>å‘é€æ¨¡ç‰ˆæ¶ˆæ¯çš„ http è¯·æ±‚æ–¹å¼:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST https:&#x2F;&#x2F;api.weixin.qq.com&#x2F;cgi-bin&#x2F;message&#x2F;template&#x2F;send?access_token&#x3D;ACCESS_TOKEN</span><br></pre></td></tr></table></figure><p>POST è¯·æ±‚ä½“ JSONï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;touser&quot;</span>:<span class="string">&quot;OPENID&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;template_id&quot;</span>:<span class="string">&quot;ngqIpbwh8bUfcSsECmogfXcV14J0tQlEpBO27izEYtY&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;url&quot;</span>:<span class="string">&quot;http://weixin.qq.com/download&quot;</span>,  </span><br><span class="line">    <span class="attr">&quot;miniprogram&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;appid&quot;</span>:<span class="string">&quot;xiaochengxuappid12345&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;pagepath&quot;</span>:<span class="string">&quot;index?foo=bar&quot;</span></span><br><span class="line">    &#125;,          </span><br><span class="line">    <span class="attr">&quot;data&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;first&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;value&quot;</span>:<span class="string">&quot;æ­å–œä½ è´­ä¹°æˆåŠŸï¼&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;color&quot;</span>:<span class="string">&quot;#173177&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;keyword1&quot;</span>:&#123;</span><br><span class="line">            <span class="attr">&quot;value&quot;</span>:<span class="string">&quot;å·§å…‹åŠ›&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;color&quot;</span>:<span class="string">&quot;#173177&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;keyword2&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;value&quot;</span>:<span class="string">&quot;39.8å…ƒ&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;color&quot;</span>:<span class="string">&quot;#173177&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;keyword3&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;value&quot;</span>:<span class="string">&quot;2014å¹´9æœˆ22æ—¥&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;color&quot;</span>:<span class="string">&quot;#173177&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;remark&quot;</span>:&#123;</span><br><span class="line">            <span class="attr">&quot;value&quot;</span>:<span class="string">&quot;æ¬¢è¿å†æ¬¡è´­ä¹°ï¼&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;color&quot;</span>:<span class="string">&quot;#173177&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆï¼šæ–‡æ¡£è¯»å®Œäº†ï¼Œæ¥ä¸‹æ¥å®ç°å’±è‡ªå·±çš„ï¼‰</p><hr><p>æˆ‘ä»¬é¦–å…ˆæ¥å†™ä¸€ä¸ªè‡ªå·±çš„æ¶ˆæ¯æ¨¡ç‰ˆï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;first.DATA&#125;&#125;</span><br><span class="line">è¯¾ç¨‹ï¼š&#123;&#123;course.DATA&#125;&#125;</span><br><span class="line">åœ°ç‚¹ï¼š&#123;&#123;location.DATA&#125;&#125;</span><br><span class="line">è€å¸ˆï¼š&#123;&#123;teacher.DATA&#125;&#125;</span><br><span class="line">æ—¶é—´ï¼š&#123;&#123;time.DATA&#125;&#125;</span><br><span class="line">æ•™å­¦å‘¨ï¼š&#123;&#123;week.DATA&#125;&#125;</span><br><span class="line">--- </span><br><span class="line">&#123;&#123;bullshit.DATA&#125;&#125;</span><br><span class="line">&#123;&#123;remark.DATA&#125;&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ¨¡ç‰ˆæ¶ˆæ¯çš„æ•ˆæœå¤§æ¦‚æ˜¯è¿™æ ·ï¼ˆè¿™ä¸ªæˆªå›¾æ˜¯å¼€å‘è¿‡ç¨‹ä¸­çš„è€ç‰ˆæœ¬çš„ï¼Œå’Œä¸Šé¢çš„æ¨¡ç‰ˆç¨æœ‰åŒºåˆ«ï¼‰ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcomni4m6ij30go0h97hi.jpg" alt="IMG_0486"></p><p>ç„¶åå°±æ˜¯åœ¨ Golang é‡Œå°è£…è¿™ä¸ªè¯·æ±‚äº†ã€‚è¿™éœ€è¦æˆ‘ä»¬æŠŠJSONå†™æˆç»“æ„ä½“ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcolkz8llzj31iq0ey436.jpg" alt="å±å¹•å¿«ç…§ 2020-03-10 09.55.50"></p><p>ç„¶åå°±å¯ä»¥å†™ä¸€ä¸ª <code>makeCourseNoticeBody</code> æ–¹æ³•æ¥å¡«å……æ•°æ®äº†(ä¸ºäº†èŠ‚çœç©ºé—´æˆ‘åˆ äº†ä¸€äº›ä»£ç ï¼Œå¾ˆç®€å•ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œè„‘è¡¥å‡ºæ¥)ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// makeCourseNoticeBody æ„å»ºå¾®ä¿¡ä¸Šè¯¾é€šçŸ¥ json</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w WxNotifier)</span> <span class="title">makeCourseNoticeBody</span><span class="params">(toUser, course, location, teacher, begin, end, week <span class="keyword">string</span>)</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span> &#123;</span><br><span class="line">notice := WxNotice&#123;</span><br><span class="line">ToUser:     toUser,</span><br><span class="line">TemplateId: w.courseNoticeTemplateID,</span><br><span class="line">Data: CourseData&#123;</span><br><span class="line">First: NoticeItem&#123;</span><br><span class="line">Value: <span class="string">&quot;æ»šå»ä¸Šè¯¾&quot;</span> + <span class="string">&quot;\n\n&quot;</span>,</span><br><span class="line">Color: <span class="string">&quot;#e51c23&quot;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">Course: NoticeItem&#123;</span><br><span class="line">Value: course + <span class="string">&quot;\n\n&quot;</span>,</span><br><span class="line">Color: <span class="string">&quot;#173177&quot;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">Location: NoticeItem&#123;...&#125;,</span><br><span class="line">Teacher: NoticeItem&#123;...&#125;,</span><br><span class="line">BETime: NoticeItem&#123;...&#125;,</span><br><span class="line">Week: NoticeItem&#123;...&#125;,</span><br><span class="line">Bullshit: NoticeItem&#123;...&#125;,</span><br><span class="line">Remark: NoticeItem&#123;</span><br><span class="line">Value: <span class="string">&quot;ä½†è¿˜æ˜¯è¦å¥½å¥½å¬è¯¾å“¦ğŸ’ª&quot;</span> + <span class="string">&quot;\n\n&quot;</span>,</span><br><span class="line">Color: <span class="string">&quot;#000000&quot;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> json.MarshalIndent(notice, <span class="string">&quot; &quot;</span>, <span class="string">&quot;  &quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ„å»ºå‡ºäº†æ¶ˆæ¯ï¼Œç„¶åå°±æ˜¯ POST å‘é€äº†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// postCourseNotify å‘é€å¾®ä¿¡å…¬ä¼—å·ä¸Šè¯¾é€šçŸ¥è¯·æ±‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w WxNotifier)</span> <span class="title">postCourseNotify</span><span class="params">(CourseNoticeBody []<span class="keyword">byte</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">url := fmt.Sprintf(</span><br><span class="line"><span class="string">&quot;https://api.weixin.qq.com/cgi-bin/message/template/send?access_token=%s&quot;</span>,</span><br><span class="line">w.wxTokenHolder.Get(),</span><br><span class="line">)</span><br><span class="line">resp, err := http.Post(url, <span class="string">&quot;application/json&quot;</span>, bytes.NewBuffer(CourseNoticeBody))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Println(<span class="string">&quot;postCourseNotify Failed:&quot;</span>, err)</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line"><span class="keyword">if</span> resp.StatusCode != <span class="number">200</span> &#123;</span><br><span class="line">body, _ := ioutil.ReadAll(resp.Body)</span><br><span class="line">err = NotifyFailed(<span class="string">&quot;postCourseNotify Failed&quot;</span>)</span><br><span class="line">log.Println(err)</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NotifyFailed è¯·æ±‚è¿”å›çŠ¶æ€å€¼ä¸ä¸º200æ—¶æŠ›å‡ºçš„é”™è¯¯</span></span><br><span class="line"><span class="keyword">type</span> NotifyFailed <span class="keyword">string</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(n NotifyFailed)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">string</span>(n)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç é‡Œæœ‰ä¸€ä¸ª <code>wxTokenHolder.Get()</code>ï¼Œçœ‹ä¸Šå»æ˜¯è·å– Token ç”¨çš„ï¼Œå…¶å®å®ƒè¿˜çœŸæ˜¯è·å– Token çš„ã€‚</p><h4 id="å…¨å±€å¾®ä¿¡-Token-Holder"><a href="#å…¨å±€å¾®ä¿¡-Token-Holder" class="headerlink" title="å…¨å±€å¾®ä¿¡ Token Holder"></a>å…¨å±€å¾®ä¿¡ Token Holder</h4><p>å¾®ä¿¡å…¬ä¼—å¹³å°<a href="https://developers.weixin.qq.com/doc/offiaccount/Basic_Information/Get_access_token.html">å…³äº access_token çš„æ–‡æ¡£</a>é‡Œè¯´äº†ï¼š</p><blockquote><p>å»ºè®®å…¬ä¼—å·å¼€å‘è€…ä½¿ç”¨ä¸­æ§æœåŠ¡å™¨ç»Ÿä¸€è·å–å’Œåˆ·æ–°access_tokenï¼Œå…¶ä»–ä¸šåŠ¡é€»è¾‘æœåŠ¡å™¨æ‰€ä½¿ç”¨çš„access_tokenå‡æ¥è‡ªäºè¯¥ä¸­æ§æœåŠ¡å™¨ï¼Œä¸åº”è¯¥å„è‡ªå»åˆ·æ–°ï¼Œå¦åˆ™å®¹æ˜“é€ æˆå†²çªï¼Œå¯¼è‡´access_tokenè¦†ç›–è€Œå½±å“ä¸šåŠ¡ã€‚</p></blockquote><p>æ‰€ä»¥å’±ä»¬å°±æŒ‰ç…§è¿™ä¸ªæ€è·¯ï¼Œåšä¸€ä¸ªå…¨å±€çš„ Token Holderã€‚</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcoly3zu7qj30l20ba3zu.jpg" alt="image-20200310100931107"></p><p>è¿™ä¸ª Token Holder åªåœ¨å’±ä»¬çš„æ•´ä¸ªç³»ç»Ÿä¸­å®ä¾‹åŒ–ä¸€æ¬¡ï¼ˆå…¶å®å°±æ˜¯ä¸ªå•ä¾‹ï¼Œä½†æˆ‘æ²¡æœ‰å°è¯•æ€ä¹ˆç”¨ Go å†™å•ä¾‹æ¨¡å¼ï¼‰ï¼Œåœ¨éœ€è¦ç”¨åˆ° å¾®ä¿¡ access_token çš„åœ°æ–¹ï¼Œå°±é€šè¿‡è¿™ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ Token Holder è·å–ã€‚</p><p>è°ƒç”¨ Get çš„æ—¶å€™ï¼ŒHolder ä¼šè‡ªåŠ¨æ£€æµ‹ä¸Šä¸€æ¬¡è·å–çš„ token æœ‰æ²¡æœ‰è¿‡æœŸï¼Œæ²¡æœ‰çš„è¯å°±ç›´æ¥è¿”å›ä¸Šä¸€æ¬¡è·å–çš„ï¼Œå¦‚æœè¿‡æœŸäº†é‚£å°±é‡æ–°è·å–ä¸€ä¸ªï¼Œè¿™æ ·å°±å®Œæˆäº†å¾®ä¿¡æ–‡æ¡£é‡Œå»ºè®®çš„ç»Ÿä¸€ token è·å–æœºåˆ¶ã€‚</p><h4 id="å¾®ä¿¡å‰å°æœåŠ¡"><a href="#å¾®ä¿¡å‰å°æœåŠ¡" class="headerlink" title="å¾®ä¿¡å‰å°æœåŠ¡"></a>å¾®ä¿¡å‰å°æœåŠ¡</h4><p>ç°åœ¨æˆ‘ä»¬å·²ç»å®ç°äº†è‡ªåŠ¨ä»æ•™åŠ¡ç³»ç»Ÿè·å–è¯¾è¡¨ï¼Œè‡ªåŠ¨åœ¨ä¸Šè¯¾å‰å‘é€å¾®ä¿¡æé†’ã€‚å…¶å®è¿™ä¸ªç³»ç»Ÿç°åœ¨å·²ç»å¯ä»¥ä½¿ç”¨äº†ï¼ä½ éšä¾¿å†™ä¸ª <code>main</code>ï¼Œåœ¨é‡Œé¢ New ä¸€ä¸ª Student æŠŠè‡ªå·±çš„å­¦å·ã€æ•™åŠ¡å¯†ç ã€å¾®ä¿¡open_id ä¼ è¿›å»ï¼Œç„¶åå®ä¾‹åŒ–ä¸€ä¸ªå¼ºæ™º Clientï¼Œç™»å½•ã€è·å–æ—¶é—´ã€è·å–è¯¾è¡¨ã€ä¿å­˜ï¼Œç„¶åå¼€ä¸€ä¸ª CourseTickerï¼Œä½ å°±å¯ä»¥æ”¶åˆ°è¯¾ç¨‹æé†’äº†ï¼</p><p>è¿™ä¹ˆåšå¯¹å’±ä»¬å¼€å‘è€…æ¥è¯´å€’æ˜¯æ–¹ä¾¿äº†ï¼Œä½†å¯¹ç”¨æˆ·å¯ä¸å¤ªå‹å¥½ã€æˆ–è€…è¯´æ˜¯å®Œå…¨æ²¡æœ‰å¯ç”¨æ€§ï¼ç”¨æˆ·éœ€è¦ä¸€å¥—å¯ä»¥çœ‹å¾—æ‡‚ã€å®Œå¾—æˆçš„æ“ä½œç•Œé¢ã€‚æ‰€ä»¥è¿˜æœ‰æœ€åä¸€æ­¥â€”â€”å¾®ä¿¡çš„å‰å°æœåŠ¡ã€‚</p><p>è¿™æœ€åä¸€æ­¥å¯ä¸å®¹æ˜“ã€‚è¿™ä¸€æ­¥æ‰çœŸæ­£å¼€å§‹äº†WebæœåŠ¡å¼€å‘å‘¢ã€‚</p><p>å…ˆçœ‹çœ‹æˆ‘ä»¬æƒ³è¦è¾¾åˆ°çš„ç›®çš„ï¼ˆä¹Ÿå°±æ˜¯æœ€åå®Œæˆåçš„ç»“æœï¼‰ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gconlhwh9jj31nr0u07wh.jpg" alt="å±å¹•å¿«ç…§ 2020-03-10 11.06.18"></p><p>æ˜¯ä¸æ˜¯æœ‰ç§10086çš„æ„Ÿè§‰ğŸ˜‚</p><p>æ²¡åŠæ³•ï¼Œè¿™ç§å®ç°æ˜¯æœ€ç®€å•æ–¹ä¾¿çš„äº†ï¼Œè€Œä¸”å°±è¿™ä¸ªçœ‹ä¼¼ç®€å•çš„æœåŠ¡éƒ½è¦èŠ±ä¸Šä¸å°‘ä»£ç æ¥å®ç°å‘¢ï¼</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªåŸºæœ¬çš„å¾®ä¿¡å…¬ä¼—å·æœåŠ¡ï¼š</p><h5 id="å¾®ä¿¡å…¬ä¼—å·æœåŠ¡Hello-World"><a href="#å¾®ä¿¡å…¬ä¼—å·æœåŠ¡Hello-World" class="headerlink" title="å¾®ä¿¡å…¬ä¼—å·æœåŠ¡Hello World"></a>å¾®ä¿¡å…¬ä¼—å·æœåŠ¡Hello World</h5><p>åœ¨è¿™é‡Œæˆ‘ä¸æƒ³è¯¦ç»†ä»‹ç»æ€ä¹ˆå†™ä¸€ä¸ªå¾®ä¿¡å…¬ä¼—å·Hello Worldï¼Œæˆ‘åªæ˜¯æŠŠä»£ç è´´å‡ºæ¥ï¼ˆæˆ‘ä¹Ÿæ˜¯åˆ°å¤„ä¸œæ‹¼è¥¿å‡‘åˆšå­¦æ¥çš„ï¼‰ï¼Œä½ å¦‚æœä¸ç†Ÿæ‚‰å¾®ä¿¡å…¬ä¼—å·æœåŠ¡ï¼Œå¯ä»¥ç»“åˆç€æˆ‘åœ¨æ–‡ç« ä¸€å¼€å§‹åˆ—å‡ºçš„é‚£ç‰‡å¾®ä¿¡å…¬ä¼—å·å…¥é—¨æ•™ç¨‹ï¼Œå¯¹åº”ç€çœ‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;bytes&quot;</span></span><br><span class="line"><span class="string">&quot;crypto/sha1&quot;</span></span><br><span class="line"><span class="string">&quot;encoding/json&quot;</span></span><br><span class="line"><span class="string">&quot;encoding/xml&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;io&quot;</span></span><br><span class="line"><span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line"><span class="string">&quot;sort&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼€å¾®ä¿¡æœåŠ¡ï¼š</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">WxToken = <span class="string">&quot;wwwwwww&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">http.HandleFunc(<span class="string">&quot;/wx&quot;</span>, weixinSer)</span><br><span class="line">http.ListenAndServe(<span class="string">&quot;:80&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">weixinSer</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">r.ParseForm()</span><br><span class="line"><span class="keyword">if</span> !validateWechatRequest(w, r) &#123;</span><br><span class="line">log.Println(<span class="string">&quot;Wechat Service: this http request is not from Wechat platform!&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> r.Method == <span class="string">&quot;POST&quot;</span> &#123;</span><br><span class="line">textRequestBody := parseTextRequestBody(r)</span><br><span class="line"><span class="keyword">if</span> textRequestBody != <span class="literal">nil</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">&quot;Wechat Service: Recv text msg [%s] form user [%s]\n&quot;</span>,</span><br><span class="line">textRequestBody.Content,</span><br><span class="line">textRequestBody.FromUserName,</span><br><span class="line">)</span><br><span class="line">responseTextBody, err := makeTextResponseBody(</span><br><span class="line">textRequestBody.ToUserName,</span><br><span class="line">textRequestBody.FromUserName,</span><br><span class="line"><span class="string">&quot;Hello, &quot;</span>+textRequestBody.FromUserName,</span><br><span class="line">)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Println(<span class="string">&quot;Wechat Service: makeTextResponseBody error: &quot;</span>, err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Fprint(w, <span class="keyword">string</span>(responseTextBody))</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éªŒè¯æ¶ˆæ¯æ˜¯å¦æ¥è‡ªå¾®ä¿¡ï¼š</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">validateWechatRequest</span><span class="params">(w http.ResponseWriter, r *http.Request)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">r.ParseForm()</span><br><span class="line"></span><br><span class="line">signature := r.FormValue(<span class="string">&quot;signature&quot;</span>)</span><br><span class="line"></span><br><span class="line">timestamp := r.FormValue(<span class="string">&quot;timestamp&quot;</span>)</span><br><span class="line">nonce := r.FormValue(<span class="string">&quot;nonce&quot;</span>)</span><br><span class="line"></span><br><span class="line">echostr := r.FormValue(<span class="string">&quot;echostr&quot;</span>)</span><br><span class="line"></span><br><span class="line">hashcode := makeSignature(WxToken, timestamp, nonce)</span><br><span class="line"></span><br><span class="line">log.Printf(<span class="string">&quot;Try validateWechatRequest: hashcode: %s, signature: %s\n&quot;</span>, hashcode, signature)</span><br><span class="line"><span class="keyword">if</span> hashcode == signature &#123;</span><br><span class="line">fmt.Fprintf(w, <span class="string">&quot;%s&quot;</span>, echostr)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">fmt.Fprintf(w, <span class="string">&quot;hashcode != signature&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makeSignature</span><span class="params">(token, timestamp, nonce <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">sl := []<span class="keyword">string</span>&#123;token, timestamp, nonce&#125;</span><br><span class="line">sort.Strings(sl)</span><br><span class="line"></span><br><span class="line">s := sha1.New()</span><br><span class="line">io.WriteString(s, strings.Join(sl, <span class="string">&quot;&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;%x&quot;</span>, s.Sum(<span class="literal">nil</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¾®ä¿¡æ¶ˆæ¯è§£æï¼š</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TextRequestBody <span class="keyword">struct</span> &#123;</span><br><span class="line">XMLName      xml.Name <span class="string">`xml:&quot;xml&quot;`</span></span><br><span class="line">ToUserName   <span class="keyword">string</span></span><br><span class="line">FromUserName <span class="keyword">string</span></span><br><span class="line">CreateTime   time.Duration</span><br><span class="line">MsgType      <span class="keyword">string</span></span><br><span class="line">Content      <span class="keyword">string</span></span><br><span class="line">MsgId        <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">parseTextRequestBody</span><span class="params">(r *http.Request)</span> *<span class="title">TextRequestBody</span></span> &#123;</span><br><span class="line">body, err := ioutil.ReadAll(r.Body)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(<span class="keyword">string</span>(body))</span><br><span class="line">requestBody := &amp;TextRequestBody&#123;&#125;</span><br><span class="line">xml.Unmarshal(body, requestBody)</span><br><span class="line"><span class="keyword">return</span> requestBody</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¾®ä¿¡æ¶ˆæ¯å“åº”ï¼š</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TextResponseBody <span class="keyword">struct</span> &#123;</span><br><span class="line">XMLName      xml.Name <span class="string">`xml:&quot;xml&quot;`</span></span><br><span class="line">ToUserName   CDATAText</span><br><span class="line">FromUserName CDATAText</span><br><span class="line">CreateTime   time.Duration</span><br><span class="line">MsgType      CDATAText</span><br><span class="line">Content      CDATAText</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> CDATAText <span class="keyword">struct</span> &#123;</span><br><span class="line">Text <span class="keyword">string</span> <span class="string">`xml:&quot;,innerxml&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">value2CDATA</span><span class="params">(v <span class="keyword">string</span>)</span> <span class="title">CDATAText</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> CDATAText&#123;<span class="string">&quot;&lt;![CDATA[&quot;</span> + v + <span class="string">&quot;]]&gt;&quot;</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makeTextResponseBody</span><span class="params">(fromUserName, toUserName, content <span class="keyword">string</span>)</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span> &#123;</span><br><span class="line">textResponseBody := &amp;TextResponseBody&#123;&#125;</span><br><span class="line">textResponseBody.FromUserName = value2CDATA(fromUserName)</span><br><span class="line">textResponseBody.ToUserName = value2CDATA(toUserName)</span><br><span class="line">textResponseBody.MsgType = value2CDATA(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">textResponseBody.Content = value2CDATA(content)</span><br><span class="line">textResponseBody.CreateTime = time.Duration(time.Now().Unix())</span><br><span class="line"><span class="keyword">return</span> xml.MarshalIndent(textResponseBody, <span class="string">&quot; &quot;</span>, <span class="string">&quot;  &quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åˆ«è¢«è¿™äº›ä»£ç å“åˆ°å‘€ï¼Œå…¶å®æ€è·¯å¾ˆç®€å•çš„ï¼Œåªæ˜¯å®ç°æœ‰äº›ç¹çï¼šå…¶å®å°±æ˜¯å¼€ä¸€ä¸ªwebæœåŠ¡ï¼Œè¿™ä¸ªæœåŠ¡æ¥æ”¶åˆ°è¯·æ±‚çš„æ—¶å€™è°ƒç”¨ <code>validateWechatRequest</code> æ¥éªŒè¯è¯¥è¯·æ±‚æ˜¯å¦å‘è‡ªå¾®ä¿¡ï¼Œè‹¥éªŒè¯é€šè¿‡ç¡®å®æ˜¯å¾®ä¿¡ï¼Œé‚£ä¹ˆå°±ç”¨ <code>parseTextRequestBody</code> è§£æè¿™ä¸ªæ¶ˆæ¯(æˆ‘ä»¬åªå¤„ç†æ–‡æœ¬æ¶ˆæ¯)ï¼Œè§£æå‡ºæ¥æœ‰äº›å‘é€ç”¨æˆ·å•Šã€æ¶ˆæ¯å†…å®¹å•Šè¿™äº›ä¸œè¥¿ï¼Œç„¶åå°±å¯ä»¥ç”¨ <code>makeTextResponseBody</code> æ„é€ ä¸€ä¸ªå“åº”è¿”å›ç»™å¾®ä¿¡äº†ã€‚</p><p>ä»è¿™ä¸ª HelloWorld é‡Œï¼Œæˆ‘ä»¬å¯ä»¥æƒ³åˆ°ï¼Œåªè¦æˆ‘ä»¬æ ¹æ® <code>parseTextRequestBody</code> å‡ºæ¥çš„ä¸œè¥¿å¤„ç†åä¼ ä¸€ä¸ªåˆé€‚çš„ <code>content</code> ç»™ <code>makeTextResponseBody</code>ï¼Œå°±å¯ä»¥å®ç°å¾®ä¿¡æ¶ˆæ¯çš„å“åº”äº†ã€‚</p><p>æŒ‰ç…§è¿™ä¸ªæ€è·¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥åšå‡ºä¸€ä¸ª<strong>é€šç”¨</strong>çš„å¾®ä¿¡å…¬ä¼—å·æœåŠ¡æ¡†æ¶ã€‚</p><h5 id="é€šç”¨å¾®ä¿¡å…¬ä¼—å·æœåŠ¡æ¡†æ¶"><a href="#é€šç”¨å¾®ä¿¡å…¬ä¼—å·æœåŠ¡æ¡†æ¶" class="headerlink" title="é€šç”¨å¾®ä¿¡å…¬ä¼—å·æœåŠ¡æ¡†æ¶"></a>é€šç”¨å¾®ä¿¡å…¬ä¼—å·æœåŠ¡æ¡†æ¶</h5><p>å…¶å®è¿™ä¸ªæœåŠ¡æ¡†æ¶åŸºæœ¬å°±æ˜¯ä¸Šé¢çš„ HelloWorld åšä¸€ä¸ªæŠ½è±¡ã€‚</p><p>æˆ‘ä»¬ä¸æ˜¯éœ€è¦å¯¹ <code>parseTextRequestBody</code> å‡ºæ¥çš„ç»“æœåšä¸€äº›å¤„ç†ç„¶åå¾—åˆ°è¦ <code>makeTextResponseBody</code> çš„ content å˜›ã€‚æ‰€ä»¥æˆ‘ä»¬è¦åšä¸€äº›æ“ä½œï¼Œä½†æˆ‘ä»¬æš‚æ—¶è¿˜æ²¡æœ‰å†™å‡ºè¿™ä¸ªæ“ä½œæ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æƒ³ï¼š</p><p>â€œå•Šï½å¦‚æœè¿™é‡Œæœ‰ä¸€ä¸ªå†™å¥½çš„å‡½æ•°å°±å¥½äº†ï¼Œæˆ‘ä»¬ç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼ŒæŠŠè¯·æ±‚ä¼ ç»™å®ƒï¼Œå®ƒå°±æŠŠéœ€è¦çš„ content è¿”å›å‡ºæ¥â€</p><p>è¿™ä¸ªé—®é¢˜æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œè§£å†³æ–¹æ³•å‘¼ä¹‹æ¬²å‡º â€”â€” å’Œæˆ‘ä»¬å†™ CourseTicker çš„æ—¶å€™ä¸€æ · â€”â€” <strong>æ¥å£</strong>ï¼</p><p>æ¥æŠŠ helloworld é‡Œçš„ä»£ç æ”¹ä¸€æ”¹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">textRequestBody := parseTextRequestBody(r)</span><br><span class="line"><span class="keyword">if</span> textRequestBody != <span class="literal">nil</span> &#123;</span><br><span class="line">    thisSer := textRequestBody.ToUserName</span><br><span class="line">    reqUser := textRequestBody.FromUserName</span><br><span class="line">    reqContent := textRequestBody.Content</span><br><span class="line"></span><br><span class="line">    respContent := responser.Do(reqUser, reqContent)</span><br><span class="line">    <span class="comment">// ğŸ‘†ä¸Šé¢è¿™è¡Œä»£ç æœ‰ä¸ªä¸çŸ¥é“å“ªæ¥çš„ responser</span></span><br><span class="line"></span><br><span class="line">    responseTextBody, err := makeTextResponseBody(thisSer, reqUser, respContent)</span><br><span class="line">    _, err = fmt.Fprint(w, <span class="keyword">string</span>(responseTextBody))</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>å°±æ˜¯è¿™æ ·ï¼æˆ‘ä»¬å¸Œæœ›æœ‰ä¸€ä¸ª <code>responser.Do(reqUser, reqContent)</code> ï¼Œè°ƒç”¨å®ƒè¦è¿”å›çš„å“åº”ç»“æœå°±å‡ºæ¥äº†ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å°±å†™å‡ºè¿™æ ·çš„æ¥å£ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Responser <span class="keyword">interface</span> &#123;</span><br><span class="line">Do(reqUser <span class="keyword">string</span>, reqContent <span class="keyword">string</span>) (respContent <span class="keyword">string</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Okï¼Œé™¤äº†ä¸€ä¸ª responserï¼Œæˆ‘ä»¬å†æ¥æƒ³æƒ³æˆ‘ä»¬çš„ Helloworld é‡Œè·‘èµ·å¾®ä¿¡æœåŠ¡è¿˜éœ€å“ªäº›ä¸œè¥¿ã€‚æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªæœåŠ¡tokenï¼ˆä¸æ˜¯æˆ‘ä»¬å†™äº† holder çš„é‚£ç§ access_token å•Šï¼Œæ˜¯éªŒè¯è¯·æ±‚çš„ tokenï¼‰ã€‚</p><p>ä»¥ responser å’Œ token ä¸ºå±æ€§ï¼Œhelloworld é‡Œé‚£ä¸€å¤§å †éªŒè¯ã€æ¶ˆæ¯è§£æ/æ„é€ å‡½æ•°ä¸ºç§æœ‰æ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™å‡ºå¾®ä¿¡æœåŠ¡æ¡†æ¶â€œç±»â€äº†ï¼Œæ¥çœ‹ç»“æ„å›¾ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcooc46z5lj310t0u00yf.jpg" alt="image-20200310113210047"></p><p>å“ˆå“ˆï¼Œè¿™ä¸ªä¸œè¥¿ä¹Ÿæ˜¯è¯´èµ·æ¥ç®€å•ï¼Œå®ç°èµ·æ¥ä¸€å¤§å †ä¸œè¥¿æŒºå“äººçš„ã€‚ä¸è¿‡ï¼Œè¿™å°±æ˜¯ helloworld åŠ äº†ä¸ª responserï¼Œå†™æˆäº†ç»“æ„ä½“ï¼Œä½ ç»†å“ã€‚</p><blockquote><p>ã€å‹˜è¯¯ã€‘è¿™é‡Œæœ‰ä¸ª<code>databaseSource</code>å±æ€§ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯ä¸€ä¸ªé€šç”¨çš„å¾®ä¿¡æœåŠ¡æ¡†æ¶è¯¥æœ‰çš„ï¼Œå¾®ä¿¡æœåŠ¡æ¡†æ¶æœ¬èº«å¯ä¸ä¼šå»è¯»å†™æ•°æ®åº“ï¼Œæ•°æ®åº“æ“ä½œåº”è¯¥æ˜¯ Responser çš„ç§äº‹ï¼Œè¿™æ˜¯æˆ‘å®ç°çš„é”™è¯¯ã€‚</p><p>äº‹å®ä¸Šï¼Œå¥½åƒæˆ‘ä¹Ÿæ²¡æœ‰åœ¨é™¤äº†æ„é€ å‡½æ•°çš„åœ°æ–¹ä½¿ç”¨è¿™ä¸ª<code>databaseSource</code>ï¼Œæ‰€ä»¥å®ƒæ˜¯æ²¡ç”¨çš„ã€åº”è¯¥åˆ é™¤æ‰çš„ï¼‰</p></blockquote><p>æˆ‘ä»¬å…ˆä¸ç®¡å®ç°ï¼Œæ¥çœ‹ä»–çš„ä½¿ç”¨ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">WxToken := <span class="string">&quot;wwwwwww&quot;</span></span><br><span class="line">responser := NewSomething();</span><br><span class="line">databaseSource := <span class="string">&quot;who:psd@where/database?charset=utf8&quot;</span>;</span><br><span class="line">    </span><br><span class="line">WxSer = wxPlatformServer.New(WxToken, responser, databaseSource)</span><br><span class="line">    </span><br><span class="line">http.HandleFunc(<span class="string">&quot;/wx&quot;</span>, WxSer.Handle)</span><br><span class="line">http.ListenAndServe(<span class="string">&quot;:80&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç”¨èµ·æ¥å¯ä»¥è¯´æ˜¯å¾ˆæ–¹ä¾¿çš„äº†ã€‚</p><h5 id="å®ç°CourseNotifierResponser"><a href="#å®ç°CourseNotifierResponser" class="headerlink" title="å®ç°CourseNotifierResponser"></a>å®ç°CourseNotifierResponser</h5><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªå…·ä½“çš„ Responserã€‚æˆ‘ä»¬çš„ç³»ç»Ÿå«åš CoruseNotifierï¼Œæ‰€ä»¥è¿™ä¸ªç³»ç»Ÿçš„ Responser å°±å«åš <code>CourseNotifierResponser</code> å¥½äº†ã€‚</p><p>è¿™ä¸ª<code>CourseNotifierResponser</code>åº”è¯¥è¦å¯ä»¥æ¥å—ç”¨æˆ·çš„æ¶ˆæ¯ï¼Œå®Œæˆè¯¾ç¨‹æé†’çš„<strong>è®¢é˜…</strong>ã€<strong>é€€è®¢</strong>æ“ä½œã€‚</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcotpt3g8cj30v209a0uh.jpg" alt="image-20200310143818625"></p><p>è¿™ä¸ªä¸œè¥¿è¿˜æ˜¯æ¯”è¾ƒæœ‰æ„æ€çš„ï¼Œæˆ‘ä»¬æ¥çœ‹å·¥ä½œæµç¨‹å›¾ï¼ˆæˆ‘ä¸æ“…é•¿ç”»è¿™ä¸ªï¼Œå¯èƒ½è¡¨è¾¾çš„ä¸æ˜¯å¾ˆæ¸…æ™°ï¼‰ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcow9pl2aqj30rt0dtjsl.jpg" alt="Untitled Diagram-3"></p><p>æ¥è§£é‡Šä¸€ä¸‹ï¼Œæˆ‘ä»¬æƒ³è€ƒè™‘è®¢é˜…ã€é€€è®¢åˆ°åº•æ˜¯ä¸ªä»€ä¹ˆæµç¨‹ï¼š</p><p><strong>è®¢é˜…</strong>è¯¾è¡¨é¦–å…ˆæ˜¯ç²—ç•¥åˆ¤æ–­ç”¨æˆ·è¾“å…¥æ˜¯å¦åˆæ³•ï¼Œç„¶åå°è¯•æ‹¿ç”¨æˆ·çš„è¾“å…¥ç™»å½•å¼ºæ™ºç³»ç»Ÿï¼Œå¦‚æœç™»å½•æˆåŠŸï¼Œåˆ™è¿”å›çœŸå®å§“åã€ç³»ã€è¯¾è¡¨ä»¥åŠä¸€ä¸ªéªŒè¯ç ç»™ç”¨æˆ·ï¼Œé—®ä»–æ­£ä¸æ­£ç¡®ã€è¦ä¸è¦åŠã€‚ç„¶åæˆ‘ä»¬å°±ç­‰å¾…ç”¨æˆ·è¿”å›éªŒè¯ç ï¼Œå¦‚æœè¿™æ—¶æ¥æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯æ˜¯ä¹‹å‰çš„ç”¨æˆ·å‘çš„ï¼ŒåŒæ—¶å†…å®¹æ˜¯åˆšæ‰é‚£ä¸ªéªŒè¯ç ï¼Œå°±ç»™ä»–å†™å…¥åº“ï¼Œå‘Šè¯‰ä»–æœåŠ¡å¼€å¥½äº†ã€‚</p><p><strong>é€€è®¢</strong>ä¹Ÿå·®ä¸å¤šè¿™ä¸ªæµç¨‹ï¼šåˆ¤æ–­ -&gt; é¢„æ“ä½œ -&gt; éªŒè¯ç  -&gt; å†™åº“ã€‚</p><p>æˆ‘æŠŠè¿™ä¸ªæ“ä½œæ¨¡å¼æ€»ç»“æˆä¸‰ä¸ªæ–¹æ³•ï¼šVerifyã€GenerateVerificationã€Continueã€‚</p><p>è¿˜æ˜¯ä»¥è®¢é˜…ä¸ºä¾‹ï¼Œåœ¨ Verify ä¸­ï¼Œæˆ‘ä»¬å®Œæˆç™»å½•å¼ºæ™ºç³»ç»Ÿï¼Œå¦‚æœç™»å½•æˆåŠŸï¼Œåˆ™è¿”å›çœŸå®å§“åã€ç³»ã€è¯¾è¡¨çš„æ“ä½œï¼Œç„¶åè¿”å›ä¸€ä¸ª GenerateVerification ç”Ÿæˆçš„éªŒè¯ç ï¼Œç„¶åè¿™æ—¶ï¼Œå¦‚æœ<em>æ¥æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯æ˜¯ä¹‹å‰çš„ç”¨æˆ·å‘</em>ï¼Œç„¶åå°±è°ƒç”¨ Continue æ£€æµ‹éªŒè¯ç æ˜¯å¦æ­£ç¡®ï¼Œæ˜¯åˆ™å®Œæˆæ•°æ®åº“æ“ä½œã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„æ“ä½œæµç¨‹ä¸ºï¼š <code>Verify() -&gt; return GenerateVerification() -&gt; Continue()</code></p><p>æ—¢ç„¶è®¢é˜…å’Œé€€è®¢çš„æ“ä½œç±»ä¼¼ï¼Œæˆ‘ä»¬å°±æŠŠå®ƒä»¬ç›¸ä¼¼çš„åœ°æ–¹æŠ½è±¡å‡ºæ¥ï¼Œåšæˆä¸€ä¸ªâ€œè™šæ‹Ÿç±»â€ï¼Œç„¶åå»ç»§æ‰¿å®ç°å®ƒã€‚</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcovabfugbj31dw0ev143.jpg" alt="Untitled Diagram"></p><p>è¿™é‡Œæˆ‘ä»¬æ˜¯çœŸçš„è¦ç»§æ‰¿äº†ï¼ç”¨ Go å®ç°è™šæ‹Ÿç±»ç»§æ‰¿ï¼Œæˆ‘è®¤ä¸ºæ¯”è¾ƒæ–¹ä¾¿çš„ä¸€ç§æ–¹å¼æ˜¯ã€Œç»“æ„ä½“ + æ¥å£ã€ï¼Œæˆ‘ä»¬æ¥å®ç°è¿™æ ·çš„ä¸€ä¸ªç»“æ„ä½“å’Œä¸€ä¸ªæ¥å£ä½œä¸ºâ€œçˆ¶ç±»â€ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> CoursesSerSession <span class="keyword">struct</span> &#123;<span class="comment">// ç»“æ„ä½“</span></span><br><span class="line">verification   <span class="keyword">string</span></span><br><span class="line">databaseSource <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *CoursesSerSession)</span> <span class="title">GenerateVerification</span><span class="params">()</span></span> &#123;</span><br><span class="line">randI := rand.New(rand.NewSource(time.Now().UnixNano())).Int31n(<span class="number">10000</span>) <span class="comment">// 4ä½éšæœºæ•°</span></span><br><span class="line">randS4 := fmt.Sprintf(<span class="string">&quot;%04v&quot;</span>, randI)                                   <span class="comment">// 4ä½éšæœºæ•°å­—å­—ç¬¦ä¸²</span></span><br><span class="line">s.verification = randS4</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> VerifySerSession <span class="keyword">interface</span> &#123;<span class="comment">// æ¥å£</span></span><br><span class="line">GenerateVerification()</span><br><span class="line">Verify() <span class="keyword">string</span><span class="comment">// è™šæ–¹æ³•ï¼Œéœ€è¦åœ¨â€œå­ç±»â€ä¸­å®ç°</span></span><br><span class="line">Continue(verificationCode <span class="keyword">string</span>) <span class="keyword">string</span><span class="comment">// è™šæ–¹æ³•ï¼Œéœ€è¦åœ¨â€œå­ç±»â€ä¸­å®ç°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå»â€œç»§æ‰¿â€è¿™ä¸ªâ€œçˆ¶ç±»â€ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> CoursesSubscribeSession <span class="keyword">struct</span> &#123;</span><br><span class="line">CoursesSerSession<span class="comment">// ç»§æ‰¿ç»“æ„ä½“ï¼ŒåŒæ—¶ä¹Ÿå°±ç»§æ‰¿äº†çˆ¶ç±»ä¸­å®ç°çš„æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">reqUser    <span class="keyword">string</span></span><br><span class="line">reqContent <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">qzClient     *qzclient.Client</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewCoursesSubscribeSession</span><span class="params">(reqUser <span class="keyword">string</span>, reqContent <span class="keyword">string</span>, databaseSource <span class="keyword">string</span>)</span> *<span class="title">CoursesSubscribeSession</span></span> &#123;</span><br><span class="line">s := &amp;CoursesSubscribeSession&#123;reqUser: reqUser, reqContent: reqContent&#125;</span><br><span class="line">s.CoursesSerSession.databaseSource = databaseSource<span class="comment">// åˆå§‹åŒ–çˆ¶ç±»</span></span><br><span class="line"><span class="keyword">return</span> s</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">///////////////////////</span></span><br><span class="line"><span class="comment">// ä¸‹é¢å®ç°æ¥å£ä¸­çš„æ–¹æ³• //</span></span><br><span class="line"><span class="comment">//////////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Verify å°è¯•æ‹¿ç”¨æˆ·è¯·æ±‚ä¸­çš„ä¿¡æ¯ç™»å½•å¼ºæ™ºç³»ç»Ÿï¼Œæ£€æµ‹æ˜¯å¦å…·æœ‰åŠç†è®¢é˜…è¯¾è¡¨çš„èµ„æ ¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *CoursesSubscribeSession)</span> <span class="title">Verify</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="comment">// å°è¯•ç™»å½•å¼ºæ™ºç³»ç»Ÿï¼Œå¦‚æœç™»å½•æˆåŠŸï¼Œåˆ™è¿”å›çœŸå®å§“åã€ç³»ã€è¯¾è¡¨</span></span><br><span class="line">    <span class="comment">// å‡ºé”™å°±åœ°è¿”å›</span></span><br><span class="line">s.GenerateVerification()</span><br><span class="line"><span class="keyword">return</span> <span class="comment">// çœŸå®å§“åã€ç³»ã€è¯¾è¡¨ å’Œ éªŒè¯ç ï¼Œæç¤ºç”¨æˆ·ç»§ç»­æ“ä½œ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Continue ä¸ºç”¨æˆ·åŠç†è¯¾ç¨‹æé†’ç™»è®°ï¼Œå®Œæˆæ•°æ®åº“æ“ä½œ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *CoursesSubscribeSession)</span> <span class="title">Continue</span><span class="params">(verificationCode <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="comment">// å®Œæˆæ•°æ®åº“æ“ä½œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€€è®¢æ˜¯ç±»ä¼¼çš„ï¼Œè¿™é‡Œå°±ä¸å†™äº†ã€‚</p><p>æœ‰äº†è¿™ä¸ªæˆ‘ä»¬å°±å¯ä»¥ç»§ç»­å®ç° CourseNotifierResponser äº†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> CourseNotifierResponser <span class="keyword">struct</span> &#123;</span><br><span class="line">sessionMap     <span class="keyword">map</span>[<span class="keyword">string</span>]VerifySerSession<span class="comment">// è¿™é‡Œæ˜¯æˆ‘ä»¬çš„â€œçˆ¶ç±»â€é‡Œçš„æ¥å£</span></span><br><span class="line">databaseSource <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewCourseNotifierResponser</span><span class="params">(databaseSource <span class="keyword">string</span>)</span> *<span class="title">CourseNotifierResponser</span></span> &#123;</span><br><span class="line">c := &amp;CourseNotifierResponser&#123;databaseSource: databaseSource&#125;</span><br><span class="line">c.sessionMap = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]VerifySerSession)</span><br><span class="line"><span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c CourseNotifierResponser)</span> <span class="title">Do</span><span class="params">(reqUser <span class="keyword">string</span>, reqContent <span class="keyword">string</span>)</span> <span class="params">(respContent <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">switch</span> &#123;</span><br><span class="line"><span class="keyword">case</span> isReqSubscribe(reqContent):</span><br><span class="line">c.sessionMap[reqUser] = NewCoursesSubscribeSession(reqUser, reqContent, c.databaseSource)</span><br><span class="line"><span class="keyword">return</span> c.sessionMap[reqUser].Verify()</span><br><span class="line"><span class="keyword">case</span> isReqUnsubscribe(reqContent):</span><br><span class="line">c.sessionMap[reqUser] = NewCoursesUnsubscribeSession(reqUser, reqContent, c.databaseSource)</span><br><span class="line"><span class="keyword">return</span> c.sessionMap[reqUser].Verify()</span><br><span class="line"><span class="keyword">case</span> isReqVerification(reqContent):</span><br><span class="line"><span class="keyword">if</span> c.sessionMap[reqUser] != <span class="literal">nil</span> &#123;</span><br><span class="line">ret := c.sessionMap[reqUser].Continue(reqContent)</span><br><span class="line">c.sessionMap[reqUser] = <span class="literal">nil</span></span><br><span class="line"><span class="keyword">return</span> ret</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;æ— æ³•å¤„ç†çš„ä¿¡æ¯&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="string">`æ¬¢è¿ã€æ“ä½œæç¤º`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isReqSubscribe åˆ¤æ–­è¯·æ±‚æ˜¯å¦ä¸º**è®¢é˜…**æ“ä½œï¼Œæ˜¯åˆ™è¿”å› trueï¼Œå¦åˆ™ false</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isReqSubscribe</span><span class="params">(reqContent <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isReqSubscribe åˆ¤æ–­è¯·æ±‚æ˜¯å¦ä¸º**é€€è®¢**æ“ä½œï¼Œæ˜¯åˆ™è¿”å› trueï¼Œå¦åˆ™ false</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isReqUnsubscribe</span><span class="params">(reqContent <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// isReqVerification åˆ¤æ–­è¯·æ±‚æ˜¯å¦ä¸º**éªŒè¯ç **ï¼Œæ˜¯åˆ™è¿”å› trueï¼Œå¦åˆ™ false</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isReqVerification</span><span class="params">(reqContent <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸å¥½æ„æ€ï¼Œè¿™ä¸€å—å˜é‡åå–å¤ªé•¿äº†ï¼Œçœ‹èµ·æ¥æ¯”è¾ƒåƒåŠ›ã€‚</p><p>æ€»ç®—å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬æŠŠè¿™ä¸ªç³»ç»Ÿçš„æ‰€æœ‰ç»„ä»¶éƒ½å®Œæˆäº†ï¼æˆ‘ä»¬å¯ä»¥ä»å¾®ä¿¡å…¬ä¼—å·å‰å°æœåŠ¡è·å–å¤„ç†ç”¨æˆ·è®¢é˜…ã€é€€è®¢æ“ä½œï¼Œé€šè¿‡å¼ºæ™ºClientå¯ä»¥è·å–ã€ä¿å­˜è¯¾è¡¨ï¼Œç„¶åè¿˜æœ‰ CourseTicker å®Œæˆä¸Šè¯¾çš„æé†’ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬åªè¦æŠŠè¿™äº›ä¸œè¥¿é›†æˆåœ¨ä¸€èµ·ï¼Œè®©ä»–ä»¬æœ‰åˆ†å·¥ã€æœ‰åˆä½œåœ°å·¥ä½œèµ·æ¥ï¼Œæ•´ä¸ªè¯¾ç¨‹æé†’ç³»ç»Ÿå°±å®Œæˆäº†ï¼</p><h3 id="é›†æˆ"><a href="#é›†æˆ" class="headerlink" title="é›†æˆ"></a>é›†æˆ</h3><p>è¦è®©è¿™äº›æ¨¡å—åœ¨ä¸€èµ·å·¥ä½œï¼Œæœ€ç›´æ¥çš„æ–¹å¼ï¼Œå°±æ˜¯åœ¨ main å‡½æ•°é‡Œè°ƒç”¨ã€‚ä½†æ˜¯ï¼Œä¸ºäº†è®©ç³»ç»Ÿçš„å¯åŠ¨ã€é…ç½®ã€æ‹“å±•æ›´ä¸ºæ–¹ä¾¿ï¼Œç»è¿‡è€ƒè™‘ï¼Œæˆ‘è®¾è®¡äº†è¿™æ ·çš„ä¸€ä¸ª App â€œç±»â€ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcowy32x5bj31lt0c64aj.jpg" alt="Untitled Diagram-4"></p><p>å®ä¾‹åŒ–è¿™ä¸ª App ç±»åï¼Œå…¶ä¸­çš„é…ç½®éƒ¨åˆ†â€”â€”AppConf å¯ä»¥ç›´æ¥è§£æ JSON é…ç½®æ–‡ä»¶è·å–é…ç½®ï¼›ç„¶å App ç±»é€šè¿‡ init å’Œ runï¼ŒæŒ‰ç…§é…ç½®æ–‡ä»¶çš„ä¿¡æ¯åˆå§‹åŒ–å¹¶å¯åŠ¨æˆ‘ä»¬çš„å„ä¸ªè¿è¡Œç»„ä»¶ã€‚</p><p>è¿™æ ·å®Œæˆä¸€ä¸ª App ç±»ä¹‹åï¼Œæˆ‘ä»¬çš„ <code>main.go</code> å°±å¯ä»¥å¾ˆç®€æ´äº†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;example.com/CoursesNotifier/app&quot;</span></span><br><span class="line"><span class="string">&quot;flag&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line"><span class="string">&quot;os&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">flag.Usage = usage</span><br><span class="line"><span class="comment">// è¯»å–å‘½ä»¤è¡Œå‚æ•°</span></span><br><span class="line">confFile := flag.String(<span class="string">&quot;c&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;set configuration `file`&quot;</span>)</span><br><span class="line">flag.Parse()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> *confFile == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">fmt.Fprintln(os.Stderr, <span class="string">&quot;Cannot run without configuration file given.&quot;</span>)</span><br><span class="line">flag.Usage()</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åˆå§‹åŒ– App</span></span><br><span class="line">coursesNotifier := app.New(*confFile)</span><br><span class="line"><span class="keyword">if</span> err := coursesNotifier.Test(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(err)</span><br><span class="line">fmt.Println(<span class="string">&quot;Cannot run app with error config.&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">// è¿è¡Œ App</span></span><br><span class="line">coursesNotifier.Run()</span><br><span class="line"></span><br><span class="line">log.Println(<span class="string">&quot;CoursesNotifier Running...&quot;</span>)</span><br><span class="line"></span><br><span class="line">http.HandleFunc(<span class="string">&quot;/&quot;</span>, greet)</span><br><span class="line">http.ListenAndServe(<span class="string">&quot;:9001&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">greet</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">fmt.Fprintf(w, <span class="string">&quot;Hello World! %s&quot;</span>, time.Now())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">usage</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Fprintf(os.Stderr, <span class="string">`</span></span><br><span class="line"><span class="string">CoursesNotifier v0.1.0 for NCEPU(Baoding)</span></span><br><span class="line"><span class="string">All rights reserved (c) 2020 CDFMLR</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Usage: CoursesNotifier [-c filename]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Options:</span></span><br><span class="line"><span class="string">`</span>)</span><br><span class="line">flag.PrintDefaults()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çš„ main å®Œæˆäº†ä»è·å–å‘½ä»¤è¡Œå‚æ•°ã€åˆå§‹åŒ–å¹¶å¯åŠ¨appã€‚æˆ‘æƒ³è¿™å°±æ˜¯ä¸€ä¸ª main å‡½æ•°çš„æ„ä¹‰â€”â€”ç¨‹åºçš„å…¥å£ã€‚</p><p>å†æ¥å°ç»“ä¸€ä¸‹ï¼Œè¿™æ¬¡æˆ‘ä»¬ä» main å‡½æ•°å¼€å§‹ï¼ŒæŠŠè‡ªå·±å½“ä½œè¿™ä¸ªè¯¾ç¨‹æé†’ç³»ç»Ÿï¼Œçœ‹çœ‹è‡ªå·±ä»è¢«ç®¡ç†å‘˜å¯åŠ¨å¼€å§‹éƒ½åœ¨åšäº›ä»€ä¹ˆï¼š</p><ol><li>ç®¡ç†å‘˜åœ¨æœåŠ¡å™¨ä¸Šæ•²ä¸‹è¿™è¡Œå‘½ä»¤ï¼Œå¯åŠ¨æœåŠ¡ï¼š<code>nohup ./coursesNotifier -c ./config.json &amp;</code></li><li><code>main</code> å‡½æ•°å¯åŠ¨ï¼Œè§£æå‘½ä»¤è¡Œå‚æ•°ï¼Œå°è¯•è¯»å–é…ç½®æ–‡ä»¶ï¼Œè‹¥ä¸æˆåŠŸï¼Œåˆ™é€€å‡ºï¼›</li><li>åˆå§‹åŒ–ä¸€ä¸ª App å¯¹è±¡ï¼ŒæŠŠé…ç½®æ–‡ä»¶ä¼ ç»™è¿™ä¸ª App å¯¹è±¡ï¼›</li><li>App å¯¹è±¡æ‹¿åˆ°é…ç½®æ–‡ä»¶ï¼Œå°è¯•å°†å…¶ä¸­å†…å®¹è¯»å–åˆ°è‡ªå·±çš„ conf å±æ€§ä¸­ï¼›</li><li>éªŒè¯é…ç½®æ˜¯å¦é½å…¨ï¼Œè‹¥æ²¡æœ‰é—®é¢˜ï¼Œåˆ™åˆå§‹åŒ–å„è¿è¡Œæ—¶ç»„ä»¶ï¼ˆå…¨å±€å¾®ä¿¡access_token Holderï¼ŒCourseTickerã€å¾®ä¿¡å‰å°æœåŠ¡ï¼‰ï¼›è‹¥é…ç½®ä¸è¶³ï¼Œæ— æ³•å¯åŠ¨ï¼Œåˆ™å…ˆ main å‡½æ•°è¿”å›é”™è¯¯ï¼Œè¿›è€Œç”± main é€€å‡ºï¼›</li><li>é…ç½®ã€æ£€æµ‹å®Œæˆï¼Œmain å‡½æ•°è°ƒç”¨ <code>app.Run()</code>ï¼Œapp å¯åŠ¨ CourseTickerã€å¾®ä¿¡å‰å°æœåŠ¡ï¼›</li><li>CourseTicker å®šæ—¶æ£€æŸ¥æœ‰æ²¡æœ‰å¿«å¼€å§‹ä¸Šçš„è¯¾ï¼Œæœ‰åˆ™é€šè¿‡å¾®ä¿¡é€šçŸ¥ç³»ç»Ÿé€šçŸ¥è¦ä¸Šè¯¾çš„å­¦ç”Ÿã€‚</li><li>å¾®ä¿¡å‰å°æœåŠ¡ç­‰å¾…ç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œä¸ºç”¨æˆ·åŠç†è®¢é˜…ã€é€€è®¢ä¸šåŠ¡ã€‚</li></ol><h2 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h2><p>ç»ˆäºå†™å®Œäº†ï¼è¿™ç¯‡æ–‡ç« å¯æ˜¯èŠ±äº†ä¸å°‘æ—¶é—´çš„ã€‚æˆ‘ä¸è®¤ä¸ºæœ‰å¾ˆå¤šäººå¯ä»¥çœ‹åˆ°è¿™é‡Œï¼Œå› ä¸ºæˆ‘æ¸…æ¥šåœ°çŸ¥é“è‡ªå·±çš„å†™ä½œèƒ½åŠ›æœ‰é™ï¼Œå¯èƒ½è®¸å¤šåœ°æ–¹éƒ½è¡¨è¿°åœ°ä¸å¤Ÿæ¸…æ™°ï¼Œä¸å¤Ÿå¸å¼•äººã€‚ä½†æ˜¯æˆ‘å¸Œæœ›æ¯ä¸ªçœ‹è¿™ç¯‡æ–‡ç« çš„äººéƒ½æœ‰æ‰€æ”¶è·å§ã€‚Golang æ¯å¹´éƒ½æ˜¯ç¨‹åºçŒ¿ä»¬æœ€æƒ³å­¦ä¹ çš„æŠ€æœ¯ä¹‹ä¸€ï¼ˆè¿™æ˜¯å¦æ„å‘³ç€å¤§å®¶æ¯å¹´éƒ½å¹¶æ²¡æœ‰å®é™…å»å­¦å®ƒğŸ˜‚ï¼‰ï¼Œå¸Œæœ›æˆ‘è¿™ä¸ªä¸œè¥¿å¯ä»¥ç»™ä½ å­¦ä¹  Go å¢æ·»ä¸€ç‚¹ä¹è¶£ã€‚</p><p>é™¤äº†è¿™ä¸ªç³»ç»Ÿæœ¬èº«çš„åŠŸèƒ½ï¼ˆæˆ‘ç°åœ¨æ¯å¤©éƒ½åœ¨ç”¨ï¼‰ï¼Œæˆ‘è‡ªå·±å†™è¿™ä¸ªç³»ç»Ÿæœ€å¤§çš„æ”¶è·æ˜¯ã€ŒGo çš„é¢å‘å¯¹è±¡ã€ï¼Œæˆ‘è§‰å¾—è¿˜æ˜¯å¾ˆè¿·äººçš„ã€‚Go ä¸æ˜¯é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œä½†æˆ‘ä»¬ä¹Ÿèƒ½ç”¨ Go å†™å‡ºç¡®å®èƒ½è§£å†³é—®é¢˜ã€ç”šè‡³è¿˜è§£å†³åœ°æ¯”è¾ƒä¼˜é›…çš„ OOP ä»£ç ã€‚</p><p>å…¶å®è¿™ä¸ªç³»ç»Ÿè¿˜æœ‰å¾ˆå¤šéœ€è¦å»å®Œå–„ã€æ”¹è¿›çš„åœ°æ–¹ï¼Œå¦‚æœä½ æ„Ÿå…´è¶£ï¼Œæ¬¢è¿å‚ä¸è¿™ä¸ªç³»ç»Ÿçš„å¼€å‘ï¼š<a href="https://github.com/cdfmlr/CoursesNotifier">https://github.com/cdfmlr/CoursesNotifier</a>ã€‚</p><p>å†™å®Œè¿™ä¹ˆä¸€ä¸ªä¸œè¥¿ï¼Œæˆ‘è§‰å¾—è‡ªå·±å¤§æ¦‚å‹‰å¼ºå¯èƒ½ç®—æ˜¯åŸºæœ¬å®Œæˆ Golang å…¥é—¨äº†å§ã€‚Go ç»™æˆ‘çš„æ„Ÿå—è¿˜æ˜¯å¾ˆå¥½çš„â€”â€”æˆ‘çˆ±ç”¨ Go ç¼–ç¨‹ï¼Œå°±åƒæˆ‘çˆ± C å’Œ Pythonã€‚</p><p>å°±è¿™æ ·å§ï¼ŒåºŸè¯ä¸å¤šè¯´äº†ï¼Œè¿˜æœ‰ä»£ç è¦å†™å‘¢ï¼</p><p><strong>å…¨æ–‡ç»ˆ</strong></p>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çŒœæµ‹éšæœºæ•°</title>
      <link href="/2020/03/03/School/GuessANumber/"/>
      <url>/2020/03/03/School/GuessANumber/</url>
      
        <content type="html"><![CDATA[<h1 id="çŒœæµ‹éšæœºæ•°"><a href="#çŒœæµ‹éšæœºæ•°" class="headerlink" title="çŒœæµ‹éšæœºæ•°"></a>çŒœæµ‹éšæœºæ•°</h1><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcgr2q1foqj31qc0u0wps.jpg" alt="2271583200846_.pic_hd"></p><p>ä»Šå¤©è¿™ä¸ªé¢˜ç›®å¾ˆåˆ«è‡´å•Šã€‚ã€‚ã€‚</p><h2 id="æ˜”æ—¥æ—§è§£"><a href="#æ˜”æ—¥æ—§è§£" class="headerlink" title="æ˜”æ—¥æ—§è§£"></a>æ˜”æ—¥æ—§è§£</h2><p>å¤§ä¸€çš„æ—¶å€™å†™è¿‡è¿™ä¸ªé¢˜ï¼Œç¿»ä¸€ä¸‹é‚£ä¸ªæ—¶å€™çš„æºç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">unsigned</span> randNum, usersNum;</span><br><span class="line"><span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//char *tip;// GCC warning: ISO C++ forbids converting a string constant to &#x27;char*&#x27;</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> tip;<span class="comment">// ä½¿ç”¨C++ 11çš„stringç±»</span></span><br><span class="line"></span><br><span class="line">srand(time(<span class="literal">NULL</span>));<span class="comment">// ç”¨å½“å‰æ—¶é—´ä½œéšæœºæ•°ç§å­</span></span><br><span class="line">randNum = rand() &lt;&lt; <span class="number">2</span> + rand() &lt;&lt; <span class="number">4</span>;<span class="comment">// rand()æä¾›çš„å€¼åœ¨0ï½RAND_MAX == 32767ä¹‹é—´, é€šè¿‡è¿ç®—é˜²æ­¢æ¯æ¬¡ç»“æœå¤ªæ¥è¿‘</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(randNum &gt; <span class="number">100</span>)<span class="comment">// ä¿è¯randNumçš„å€¼åœ¨0ï½100</span></span><br><span class="line">randNum /= <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Please enter a int to guess:&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">cnt++;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cin</span> &gt;&gt; usersNum;</span><br><span class="line"><span class="keyword">if</span> (usersNum == randNum)&#123;</span><br><span class="line">tip = <span class="string">&quot;You are RIGHT!&quot;</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">usersNum &gt; randNum ? tip = <span class="string">&quot;Yours is bigger!&quot;</span> : tip = <span class="string">&quot;Yours is too small!&quot;</span>;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Try &quot;</span> &lt;&lt; cnt &lt;&lt; <span class="string">&quot;: &quot;</span>&lt;&lt; tip &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125; <span class="keyword">while</span>(cnt &lt; <span class="number">10</span>);</span><br><span class="line"><span class="keyword">if</span> (cnt &lt;= <span class="number">10</span>)<span class="comment">//å½“çŒœä¸­ç»ˆæ­¢å¾ªç¯æ—¶ï¼Œè¡¥å……breakè·³è¿‡çš„è¾“å‡º</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Try &quot;</span> &lt;&lt; cnt &lt;&lt; <span class="string">&quot;: &quot;</span>&lt;&lt; tip &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Gussing over!&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä»£ç å¥½æ€ªï¼Œåˆæ…¢åˆä¸å®‰å…¨ï¼Œè¿˜æœ‰bugï¼Œï¼Œä¸ç®¡äº†ï¼Œç›´æ¥ç¼–è¯‘å§ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> g++ guess.cc</span></span><br></pre></td></tr></table></figure><p>ç»“æœä¸€å¤§å †æŠ¥é”™ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcgr7yimr3j31ey0u07wi.jpg" alt="å±å¹•å¿«ç…§ 2020-03-03 15.07.02"></p><p>å“å¾—æˆ‘æ»¡å¤´<del>å¤§æ±‰</del>å¤§æ±—ï¼Œå®šç›ä¸€çœ‹ä¸»è¦æ˜¯æˆ‘å†™çš„æ˜¯ <code>C++11</code>ï¼Œç¼–è¯‘å™¨å¥½åƒä¸è®¤è¯†<code>C++11</code>ä»£ç â€¦â€¦å…ˆçœ‹ä¸€ä¸‹gccç‰ˆæœ¬ï¼Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[c@My-MacBook:] guess !549 $ g++ --version</span><br><span class="line">Configured with: --prefix=/Applications/Xcode.app/Contents/Developer/usr --with-gxx-include-dir=/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/c++/4.2.1</span><br><span class="line">Apple clang version 11.0.0 (clang-1100.0.33.12)</span><br><span class="line">Target: x86_64-apple-darwin18.7.0</span><br><span class="line">Thread model: posix</span><br><span class="line">InstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin</span><br></pre></td></tr></table></figure><p>4.2.1çš„ gccï¼Œè¿˜æ˜¯ Xcode çš„ clangï¼ç¼–è¯‘ä¸äº† <code>C++11</code> ä¹Ÿå°±ä¸å¥‡æ€ªäº†ã€‚é‚£æˆ‘ä»¥å‰æ˜¯æ€ä¹ˆæçš„ï¼Ÿï¼Ÿï¼Ÿ</p><p>æˆ‘è‚¯å®šä¸æ˜¯ç”¨è¿™ä¸ªå‘€ï¼Œç¿»äº†å¥½ä¹…æ‰ç¿»åˆ°äº†æ­£å®—çš„ <code>GNU GCC</code> ï¼Œä»–åŸæœ¬çš„ <code>gcc</code> é“¾æ¥éƒ½è¢« xcode è¦†ç›–äº†ï¼Œè¦ <code>gcc-9</code> æ‰æ˜¯ä»–ğŸ˜‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[c@My-MacBook:] guess !551 $ g++-9 --version</span><br><span class="line">g++-9 (Homebrew GCC 9.2.0) 9.2.0</span><br><span class="line">Copyright (C) 2019 Free Software Foundation, Inc.</span><br><span class="line">This is free software; see the <span class="built_in">source</span> <span class="keyword">for</span> copying conditions.  There is NO</span><br><span class="line">warranty; not even <span class="keyword">for</span> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå°±è‚¯å®šæ²¡é—®é¢˜äº†ï¼Œç¼–è¯‘è¿è¡Œï¼š</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcgrhgp86dj31di0u0h8x.jpg" alt="image-20200303151634979"></p><h2 id="æ­£å¸¸è§£å†³æ–¹æ¡ˆ"><a href="#æ­£å¸¸è§£å†³æ–¹æ¡ˆ" class="headerlink" title="æ­£å¸¸è§£å†³æ–¹æ¡ˆ"></a>æ­£å¸¸è§£å†³æ–¹æ¡ˆ</h2><p>åˆšæ‰é‚£ä¸ªä»£ç æœ‰ç‚¹æ€ªï¼Œè€Œä¸”æ²¡åšå¼‚å¸¸å¤„ç†ï¼Œå†å¥½å¥½å†™ä¸€ä¸ªã€‚</p><p>è¿™æ®µæ—¶é—´éƒ½åœ¨ç”¨ Golangï¼Œæ‰€ä»¥ä»Šå¤©å†™ä¸€ä¸ªå¤§å®¶å–œé—»ä¹è§çš„ Python3 ç‰ˆæœ¬:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    num = random.randint(<span class="number">0</span>, <span class="number">100</span>)</span><br><span class="line">    cnt = <span class="number">0</span></span><br><span class="line">    print(<span class="string">&quot;çŒœæµ‹ä¸€ä¸ª0åˆ°100ä¹‹é—´çš„æ•´æ•°.&quot;</span>)</span><br><span class="line">    <span class="keyword">while</span> cnt &lt; <span class="number">100</span>:</span><br><span class="line">        cnt += <span class="number">1</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            inp = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">f&quot;ç¬¬ <span class="subst">&#123;cnt&#125;</span> æ¬¡çŒœï¼Œè¯·è¾“å…¥ä¸€ä¸ªæ•´å½¢æ•°å­—: &quot;</span>))</span><br><span class="line">            <span class="keyword">if</span> inp == num:</span><br><span class="line">                print(<span class="string">&quot;æ­å–œä½ çŒœå¯¹äº†ï¼Œè¿™ä¸ªæ•°æ˜¯ %dã€‚&quot;</span> % num)</span><br><span class="line">                exit(<span class="number">0</span>)</span><br><span class="line">            print(<span class="string">&quot;å¤ªå¤§&quot;</span> <span class="keyword">if</span> inp &gt; num <span class="keyword">else</span> <span class="string">&quot;å¤ªå°&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> ValueError:</span><br><span class="line">            print(<span class="string">&quot;è¾“å…¥æ— æ•ˆï¼Œè¿™æ¬¡ä¸ç®—ã€‚&quot;</span>)</span><br><span class="line">            cnt -= <span class="number">1</span></span><br><span class="line">    print(<span class="string">&quot;ä½ æ€•ä¸æ˜¯ä¸ªå‚»å­ï¼&quot;</span>)</span><br></pre></td></tr></table></figure><p>é¡ºä¾¿æä¸€ä¸‹ï¼Œè¿™é‡Œæˆ‘å†™äº†å¹³æ—¶åŸºæœ¬è§ä¸åˆ°å¤§å®¶å†™çš„ <code>f-String</code>ã€‚<code>f-String</code> æ˜¯ Python 3.6 å¼•å…¥çš„ï¼Œæ›´ä¼˜é›…çš„å­—ç¬¦ä¸²æ’å€¼æ–¹æ¡ˆï¼Œæƒ³è¦äº†è§£æ›´å¤šæˆ‘æ¨è <a href="https://realpython.com/python-f-strings/">è¿™ç¯‡æ–‡ç« </a>ï¼ˆè¿™ä¸ªç½‘ç«™æŒºä¸é”™çš„ï¼‰ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ç›´æ¥è¯» <a href="https://www.python.org/dev/peps/pep-0498/">PEP 498</a> è¿™æ˜¯ f-String çš„æ¥æºã€‚</p><h2 id="ä¸€è¡Œä»£ç è§£æ³•"><a href="#ä¸€è¡Œä»£ç è§£æ³•" class="headerlink" title="ä¸€è¡Œä»£ç è§£æ³•"></a>ä¸€è¡Œä»£ç è§£æ³•</h2><p>è¿™ä¸ªè¦ä¸€è¡Œä»£ç è§£å†³å°±éº»çƒ¦äº†ï¼Œä½†è¿˜æ˜¯å€¼å¾—ä¸€è¯•ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿é˜…è¯»ï¼Œå…ˆæ‹†æˆå‡ ä¸ªéƒ¨åˆ†æ¥å†™ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">d</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> [x[<span class="number">0</span>], print(<span class="string">&quot;çŒœä¸­äº†&quot;</span>) <span class="keyword">if</span> x[<span class="number">3</span>]==x[<span class="number">0</span>] <span class="keyword">else</span> <span class="literal">None</span>, exit(<span class="number">0</span>) <span class="keyword">if</span> x[<span class="number">3</span>]==x[<span class="number">0</span>] <span class="keyword">else</span> <span class="literal">None</span>, <span class="built_in">int</span>(<span class="built_in">input</span>((<span class="string">&quot;å¤ªå¤§&quot;</span> <span class="keyword">if</span> x[<span class="number">3</span>] &gt; x[<span class="number">0</span>] <span class="keyword">else</span> <span class="string">&quot;å¤ªå°&quot;</span>) + <span class="string">&quot;\nå†è¯•ä¸€æ¬¡: &quot;</span>))]</span><br><span class="line"></span><br><span class="line">reduce(d, [[random.randint(<span class="number">0</span>,<span class="number">100</span>), <span class="literal">None</span>, <span class="literal">None</span>, -<span class="number">1</span>] <span class="keyword">if</span> x == <span class="number">0</span> <span class="keyword">else</span> [<span class="number">0</span>, <span class="literal">None</span>, <span class="literal">None</span>, -<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>)])</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;ä½ å‚»äº†&quot;</span>)</span><br></pre></td></tr></table></figure><p>åªæ˜¯è¿™ä¹ˆåšæœ‰ä¸ªå° bugï¼Œä¸€å¼€å§‹ä¼šè¾“å‡ºä¸€ä¸ªâ€œå¤ªå°â€ï¼Œè¿™å½“ç„¶ä¹Ÿæ˜¯å¯ä»¥è§£å†³çš„ï¼Œä½†ä¼šè®©ä»£ç æ›´æ¶å¿ƒä¸€ç‚¹ï¼Œæˆ‘ä»¬åœ¨æŠŠä»£ç å‹ç¼©åˆ°ä¸€è¡Œçš„åŒæ—¶è§£å†³ä¸€ä¸‹å®ƒï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;ä½ å‚»äº†å§&quot;</span> <span class="keyword">if</span> reduce(<span class="keyword">lambda</span> x, y: [x[<span class="number">0</span>], print(<span class="string">&quot;çŒœä¸­äº†&quot;</span>) <span class="keyword">if</span> x[<span class="number">3</span>]==x[<span class="number">0</span>] <span class="keyword">else</span> <span class="literal">None</span>, exit(<span class="number">0</span>) <span class="keyword">if</span> x[<span class="number">3</span>]==x[<span class="number">0</span>] <span class="keyword">else</span> <span class="literal">None</span>, <span class="built_in">int</span>(<span class="built_in">input</span>((<span class="string">&quot;å¤ªå¤§&quot;</span> <span class="keyword">if</span> x[<span class="number">3</span>] &gt; x[<span class="number">0</span>] <span class="keyword">else</span> (<span class="string">&quot;å¤ªå°&quot;</span> <span class="keyword">if</span> x[<span class="number">3</span>]&gt;=<span class="number">0</span> <span class="keyword">else</span> <span class="string">&quot;çŒœæµ‹ä¸€ä¸ª0åˆ°100ä¹‹é—´çš„æ•´æ•°.&quot;</span>)) + <span class="string">&quot;\nä½ çš„çŒœæµ‹: &quot;</span>))], [[random.randint(<span class="number">0</span>,<span class="number">100</span>), <span class="literal">None</span>, <span class="literal">None</span>, -<span class="number">1</span>] <span class="keyword">if</span> x == <span class="number">0</span> <span class="keyword">else</span> [<span class="number">0</span>, <span class="literal">None</span>, <span class="literal">None</span>, -<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)])[-<span class="number">1</span>] &lt; <span class="number">50</span> <span class="keyword">else</span> <span class="string">&quot;ä½ å‚»äº†å‘€&quot;</span>)</span><br></pre></td></tr></table></figure><p>è¿™å°±å®Œæˆäº†ä¸€è¡Œä»£ç è§£æ³•ï¼Œä½†æ˜¯è¿™ä¹ˆåšå°±ä¸èƒ½åˆ¤æ–­ç”¨æˆ·è¾“å…¥æ˜¯å¦å¼‚å¸¸äº†ã€‚è¿˜æ˜¯ä¸æ¨èå†™è¿™ç§ä»£ç ï¼Œçœ‹èµ·æ¥çœ‹ä¸æ‡‚ã€ç”¨èµ·æ¥ä¹Ÿæœ‰éšæ‚£ï¼Œåªæ˜¯å¨±ä¹ä¸€ä¸‹äº†ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äº Golang if err != nil æ³›æ»¥æˆç¾çš„ä¼˜åŒ–æ–¹æ¡ˆ</title>
      <link href="/2020/02/27/blog/Golang-if-err-nil-awkward/"/>
      <url>/2020/02/27/blog/Golang-if-err-nil-awkward/</url>
      
        <content type="html"><![CDATA[<h1 id="å…³äº-Golang-if-err-nil-æ³›æ»¥æˆç¾çš„ä¼˜åŒ–æ–¹æ¡ˆ"><a href="#å…³äº-Golang-if-err-nil-æ³›æ»¥æˆç¾çš„ä¼˜åŒ–æ–¹æ¡ˆ" class="headerlink" title="å…³äº Golang if err != nil æ³›æ»¥æˆç¾çš„ä¼˜åŒ–æ–¹æ¡ˆ"></a>å…³äº Golang <code>if err != nil</code> æ³›æ»¥æˆç¾çš„ä¼˜åŒ–æ–¹æ¡ˆ</h1><p>åˆšæ‰æˆ‘å°è¯•ç”¨ Golang å†™ä¸€ä¸ªé¡¹ç›®ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå¹¶ä¸å¤æ‚çš„æ–¹æ³•ï¼Œä¸»è¦æ¶‰åŠåˆ°ä¸¤æ¬¡æ­£åˆ™åŒ¹é…å’Œä¸¤ä¸ªå­—ç¬¦ä¸²è¯»å–ï¼Œç„¶åï¼Œæˆ‘å‘ç°è¿™ä¸ªæ–¹æ³•é‡Œæˆ‘å†™äº†å››æ®µä¸€æ¨¡ä¸€æ ·çš„ä»£ç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Println(err)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>, err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¡ºæ‰‹æœäº†ä¸€ä¸‹ï¼Œå‘ç°æ•´ä¸ªå·¥ç¨‹é‡Œæœ‰ 78 ä¸ª <code>if err != nil</code>ï¼Œè¦çŸ¥é“ï¼Œè¿™æ˜¯ä¸ªåˆšåˆšèµ·æ­¥çš„å·¥ç¨‹ï¼Œæ€»å…±æ‰å·®ä¸å¤š2Kçš„ä»£ç å‘€ï¼å·®ä¸å¤šæ¯äºŒåå‡ è¡Œä»£ç å°±è¦æ¥ä¸€å‘ <code>if err != nil</code>ï¼Œï¼Œï¼Œå¤ªå¯æ€•äº†ã€‚</p><p>ä½†æˆ‘å°è¯•åœ¨ Google è¾“å…¥ <code>if err</code> çš„æ—¶å€™ï¼Œæˆ‘çœ‹åˆ°äº†æœç´¢å»ºè®®é‡Œçš„è¿™è¡Œä»£ç ï¼Œäºæ˜¯å°¬ç¬‘ç€ç‚¹å¼€äº†å®ƒï¼Œç„¶åå‘ç°ï¼Œè¿™æ˜¯ä¸ªæ–°æ‰‹å¸¸çŠ¯çš„å°´å°¬ï¼Œä¹Ÿæœ‰å¾ˆå¤šç§ä¼˜åŒ–æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘å½“ç„¶æ˜¯é€‰æ‹©â€”â€”æŠ„å®˜æ–¹çš„ä½œä¸šäº†ï¼</p><p>è¿™æ˜¯ <a href="https://blog.golang.org/errors-are-values">ä¸€ç¯‡å®˜æ–¹çš„blog</a> é‡Œä»‹ç»çš„è§£å†³ <code>if err != nil</code> å°´å°¬çš„æ–¹æ³•ï¼š</p><p>Lamentï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">_, err = fd.Write(p0[a:b])</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">_, err = fd.Write(p1[c:d])</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">_, err = fd.Write(p2[e:f])</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// and so on</span></span><br></pre></td></tr></table></figure><p>Grace:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> err error</span><br><span class="line">write := <span class="function"><span class="keyword">func</span><span class="params">(buf []<span class="keyword">byte</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    _, err = w.Write(buf)</span><br><span class="line">&#125;</span><br><span class="line">write(p0[a:b])</span><br><span class="line">write(p1[c:d])</span><br><span class="line">write(p2[e:f])</span><br><span class="line"><span class="comment">// and so on</span></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>More cleaner:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> errWriter <span class="keyword">struct</span> &#123;</span><br><span class="line">    w   io.Writer</span><br><span class="line">    err error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ew *errWriter)</span> <span class="title">write</span><span class="params">(buf []<span class="keyword">byte</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ew.err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    _, ew.err = ew.w.Write(buf)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ew := &amp;errWriter&#123;w: fd&#125;</span><br><span class="line">ew.write(p0[a:b])</span><br><span class="line">ew.write(p1[c:d])</span><br><span class="line">ew.write(p2[e:f])</span><br><span class="line"><span class="comment">// and so on</span></span><br><span class="line"><span class="keyword">if</span> ew.err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ew.err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang SQL æŸ¥è¯¢ä½¿ç”¨ LIKE åˆ†å¥çš„å‘</title>
      <link href="/2020/02/27/blog/Golang-SQL-LIKE-Query/"/>
      <url>/2020/02/27/blog/Golang-SQL-LIKE-Query/</url>
      
        <content type="html"><![CDATA[<h1 id="Golang-SQL-æŸ¥è¯¢ä½¿ç”¨-LIKE-åˆ†å¥çš„å‘"><a href="#Golang-SQL-æŸ¥è¯¢ä½¿ç”¨-LIKE-åˆ†å¥çš„å‘" class="headerlink" title="Golang SQL æŸ¥è¯¢ä½¿ç”¨ LIKE åˆ†å¥çš„å‘"></a>Golang SQL æŸ¥è¯¢ä½¿ç”¨ LIKE åˆ†å¥çš„å‘</h1><p>æˆ‘æƒ³åœ¨ golang é‡Œæ‰§è¡Œä¸€ä¸ªæ¶‰åŠåˆ°æ¨¡ç³ŠæŸ¥è¯¢çš„ SQL Queryã€‚</p><p>ä½¿ç”¨ LIKE åˆ†å¥çš„ SQL è¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name,<span class="type">time</span> <span class="keyword">FROM</span> course <span class="keyword">WHERE</span> <span class="type">time</span> <span class="keyword">LIKE</span> <span class="string">&#x27;4%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘å†™äº†å¦‚ä¸‹ Golang ä»£ç ï¼Œä¸“é—¨æäº†ä¸€ä¸‹ <code>&#39;&#39;</code>ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BUG</span></span><br><span class="line">timeLike := fmt.Sprintf(<span class="string">&quot;&#x27;%d%%&#x27;&quot;</span>, day)</span><br><span class="line">rows, err := db.Query(<span class="string">&quot;SELECT name,time FROM course WHERE time LIKE ?&quot;</span>, timeLike)</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢å‡ºæ¥çš„æ˜¯ç©ºã€‚</p><p>ä¹‹åï¼Œå‚è€ƒ <a href="https://www.cnblogs.com/huangliang-hb/p/10048666.html%EF%BC%8C%E6%88%91%E5%8F%91%E7%8E%B0%E4%B8%8D%E8%83%BD%E5%86%99">https://www.cnblogs.com/huangliang-hb/p/10048666.htmlï¼Œæˆ‘å‘ç°ä¸èƒ½å†™</a> <code>&#39;&#39;</code>ï¼ŒæŠŠè¿™ä¸œè¥¿å»æ‰å°±è¡Œäº†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CORRECT</span></span><br><span class="line">timeLike := fmt.Sprintf(<span class="string">&quot;%d%%&quot;</span>, day)</span><br><span class="line">rows, err := db.Query(<span class="string">&quot;SELECT name,time FROM course time LIKE ?&quot;</span>, timeLike)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode P121 ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº</title>
      <link href="/2020/02/27/School/Leetcode_P121_BestTimeToBuyAndSellStock/"/>
      <url>/2020/02/27/School/Leetcode_P121_BestTimeToBuyAndSellStock/</url>
      
        <content type="html"><![CDATA[<h1 id="Leetcode-P121-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº"><a href="#Leetcode-P121-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº" class="headerlink" title="Leetcode P121 ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº"></a>Leetcode P121 ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº</h1><p>TODO: æŒ‰ç…§ç»™å®šè¦é¢†å®Œæˆæ–‡ä¸­ TODOã€‚</p><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œå®ƒçš„ç¬¬ i ä¸ªå…ƒç´ æ˜¯ä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚</p><p>å¦‚æœä½ æœ€å¤šåªå…è®¸å®Œæˆä¸€ç¬”äº¤æ˜“ï¼ˆå³ä¹°å…¥å’Œå–å‡ºä¸€æ”¯è‚¡ç¥¨ï¼‰ï¼Œè®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚</p><p>æ³¨æ„ä½ ä¸èƒ½åœ¨ä¹°å…¥è‚¡ç¥¨å‰å–å‡ºè‚¡ç¥¨ã€‚</p><p>ç¤ºä¾‹ 1:</p><p>è¾“å…¥: [7,1,5,3,6,4]<br>è¾“å‡º: 5<br>è§£é‡Š: åœ¨ç¬¬ 2 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 6ï¼‰çš„æ—¶å€™å–å‡ºï¼Œæœ€å¤§åˆ©æ¶¦ = 6-1 = 5 ã€‚<br>     æ³¨æ„åˆ©æ¶¦ä¸èƒ½æ˜¯ 7-1 = 6, å› ä¸ºå–å‡ºä»·æ ¼éœ€è¦å¤§äºä¹°å…¥ä»·æ ¼ã€‚<br>ç¤ºä¾‹ 2:</p><p>è¾“å…¥: [7,6,4,3,1]<br>è¾“å‡º: 0<br>è§£é‡Š: åœ¨è¿™ç§æƒ…å†µä¸‹, æ²¡æœ‰äº¤æ˜“å®Œæˆ, æ‰€ä»¥æœ€å¤§åˆ©æ¶¦ä¸º 0ã€‚</p><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock">https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p><h2 id="æŸç§ä¸çŸ¥åçš„é‡ç”Ÿè§£æ³•ï¼ˆä¹Ÿè®¸æ˜¯è´ªå¿ƒï¼Ÿï¼‰"><a href="#æŸç§ä¸çŸ¥åçš„é‡ç”Ÿè§£æ³•ï¼ˆä¹Ÿè®¸æ˜¯è´ªå¿ƒï¼Ÿï¼‰" class="headerlink" title="æŸç§ä¸çŸ¥åçš„é‡ç”Ÿè§£æ³•ï¼ˆä¹Ÿè®¸æ˜¯è´ªå¿ƒï¼Ÿï¼‰"></a>æŸç§ä¸çŸ¥åçš„é‡ç”Ÿè§£æ³•ï¼ˆä¹Ÿè®¸æ˜¯è´ªå¿ƒï¼Ÿï¼‰</h2><p>TODOï¼šbullshit hereã€‚è¦é¢†ï¼šæ€»è€Œè¨€ä¹‹å°±æ˜¯éå†ä¸­æ›´æ–°æœ€å¤§å€¼ã€æœ€å°å€¼ã€æå¤§å€¼ã€æå°å€¼ï¼Œæœ€åè¾“å‡ºæœ€å¤§å€¼å‡æœ€å°å€¼ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxProfit</span><span class="params">(prices []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(prices) &lt;=<span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    lowest := <span class="number">0</span></span><br><span class="line">    highest := <span class="number">0</span></span><br><span class="line">    l := prices[<span class="number">0</span>]</span><br><span class="line">    h := prices[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> _, current := <span class="keyword">range</span> prices &#123;</span><br><span class="line">        <span class="keyword">if</span> current &lt; l &#123;</span><br><span class="line">            l = current</span><br><span class="line">            h = current</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> current &gt; h &#123;</span><br><span class="line">            h = current</span><br><span class="line">            <span class="keyword">if</span> h - l &gt; highest - lowest &#123;</span><br><span class="line">                highest, lowest = h, l</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> highest - lowest</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gcanzsukqqj319s0u01kx.jpg" alt="å±å¹•å¿«ç…§ 2020-02-27 08.38.49"></p><p>è¿™ä¸ªç®—æ³•åªéå†ä¸€æ¬¡æ•°ç»„ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦æ˜¯ $O(n)$ï¼Œç©ºé—´æ¶ˆè€—æ˜¯å¸¸æ•°ï¼Œ$O(1)$ã€‚</p><h2 id="ä¼˜åŒ–åçš„ä¸çŸ¥åçš„é‡ç”Ÿç®—æ³•"><a href="#ä¼˜åŒ–åçš„ä¸çŸ¥åçš„é‡ç”Ÿç®—æ³•" class="headerlink" title="ä¼˜åŒ–åçš„ä¸çŸ¥åçš„é‡ç”Ÿç®—æ³•"></a>ä¼˜åŒ–åçš„ä¸çŸ¥åçš„é‡ç”Ÿç®—æ³•</h2><p>TODO: bullshit +1ã€‚è¦é¢†ï¼špure bullshitã€‚</p><p>è¿™ä¹ˆåšæ•ˆç‡ä¸ŠåŒºåˆ«ä¸å¤§ï¼Œä½†ä»£ç ç®€æ´ä¸€äº›ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxProfit</span><span class="params">(prices []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(prices) &lt;=<span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    lowest := prices[<span class="number">0</span>]</span><br><span class="line">    bestProfit := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _, current := <span class="keyword">range</span> prices &#123;</span><br><span class="line">        <span class="keyword">if</span> current &lt; lowest &#123;</span><br><span class="line">            lowest = current</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> current - lowest &gt; bestProfit &#123;</span><br><span class="line">            bestProfit = current - lowest</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bestProfit</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gcao6m00isj319s0u01kx.jpg" alt="å±å¹•å¿«ç…§ 2020-02-27 08.47.47"></p><h2 id="ä¸¤è¡Œä»£ç è§£æ³•"><a href="#ä¸¤è¡Œä»£ç è§£æ³•" class="headerlink" title="ä¸¤è¡Œä»£ç è§£æ³•"></a>ä¸¤è¡Œä»£ç è§£æ³•</h2><p>å› ä¸ºå®ƒè¿™ä¸ªé¢˜æœ‰ç‚¹æ¶å¿ƒï¼Œä¼šç»™ä¸ª <code>[]</code> çš„æµ‹è¯•æ•°æ®ï¼Œè¦åˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œæ‰€ä»¥ä¸€è¡Œä»£ç å¯¹è¿™ç§ç‰¹æ®Šæƒ…å†µä¸å¥½å¤„ç†ï¼Œè¦å†™ä¸¤è¡Œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span>(<span class="params">self, prices: List[<span class="built_in">int</span>]</span>) -&gt; int:</span></span><br><span class="line">        r = reduce(<span class="keyword">lambda</span> x, y: (<span class="built_in">min</span>(x[<span class="number">0</span>], y[<span class="number">0</span>]), <span class="built_in">max</span>(y[<span class="number">0</span>]-x[<span class="number">0</span>],x[<span class="number">1</span>])), [(i, <span class="number">0</span>) <span class="keyword">for</span> i <span class="keyword">in</span> prices])[<span class="number">1</span>] <span class="keyword">if</span> prices <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> r</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gcaosnz1uyj319s0u01kx.jpg" alt="image-20200227091010143"></p><p>TODO: Final bullshitã€‚è¦é¢†ï¼šè‡ªå·±æ„ä¼šã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode P88 åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„</title>
      <link href="/2020/02/26/School/Leetcode_P88_MergeSortedArray/"/>
      <url>/2020/02/26/School/Leetcode_P88_MergeSortedArray/</url>
      
        <content type="html"><![CDATA[<h1 id="Leetcode-P88-åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„"><a href="#Leetcode-P88-åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„" class="headerlink" title="Leetcode P88 åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„"></a>Leetcode P88 åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„</h1><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>ç»™å®šä¸¤ä¸ªæœ‰åºæ•´æ•°æ•°ç»„ nums1 å’Œ nums2ï¼Œå°† nums2 åˆå¹¶åˆ° nums1 ä¸­ï¼Œä½¿å¾— num1 æˆä¸ºä¸€ä¸ªæœ‰åºæ•°ç»„ã€‚</p><p>è¯´æ˜:</p><p>åˆå§‹åŒ– nums1 å’Œ nums2 çš„å…ƒç´ æ•°é‡åˆ†åˆ«ä¸º m å’Œ nã€‚<br>ä½ å¯ä»¥å‡è®¾ nums1 æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼ˆç©ºé—´å¤§å°å¤§äºæˆ–ç­‰äº m + nï¼‰æ¥ä¿å­˜ nums2 ä¸­çš„å…ƒç´ ã€‚<br>ç¤ºä¾‹:</p><p>è¾“å…¥:<br>nums1 = [1,2,3,0,0,0], m = 3<br>nums2 = [2,5,6],       n = 3</p><p>è¾“å‡º: [1,2,2,3,5,6]</p><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/merge-sorted-array">https://leetcode-cn.com/problems/merge-sorted-array</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p><h2 id="ä¸€è¡Œä»£ç è§£æ³•"><a href="#ä¸€è¡Œä»£ç è§£æ³•" class="headerlink" title="ä¸€è¡Œä»£ç è§£æ³•"></a>ä¸€è¡Œä»£ç è§£æ³•</h2><p>è¿™é“é¢˜å¥½ç®€å•çš„å•Šï¼Œå¦‚æœæ˜¯åœ¨ç°å®ä¸­é‡åˆ°ï¼Œæˆ‘è‚¯å®šç›´æ¥ä¸€è¡Œä»£ç ä¸Šäº†ï¼š</p><p>Python3 å®ç°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">merge</span>(<span class="params">self, nums1: List[<span class="built_in">int</span>], m: <span class="built_in">int</span>, nums2: List[<span class="built_in">int</span>], n: <span class="built_in">int</span></span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Do not return anything, modify nums1 in-place instead.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        nums1[:] = <span class="built_in">sorted</span>(nums1[<span class="number">0</span>:m] + nums2[<span class="number">0</span>:n])</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gc9w4t8dazj31d90u0hch.jpg" alt="å±å¹•å¿«ç…§ 2020-02-26 16.32.16"></p><p>ç›´æ¥æäº†ä¸ªæ’åºå±…ç„¶è¿˜å‡»è´¥äº† 96% ğŸ˜‚ é—®é¢˜æ˜¯ python çš„ sorted å®ç°æ˜¯ä»€ä¹ˆï¼Ÿå¥½åƒæ²¡ç ”ç©¶è¿‡å™¢ğŸ‘€</p><p>æˆ‘å»æœäº†ä¸€ä¸‹ï¼Œpython çš„ document é‡Œé¢å¥½åƒæ²¡å†™ï¼Œæ‡’å¾—æŸ¥æºç äº†ï¼Œå¤§ä½¬ä»¬è¯´é‚£ä¸ªæ˜¯ Timsortï¼Œæ˜¯ä¸ªç»“åˆäº†åˆå¹¶æ’åºï¼ˆmerge sortï¼‰å’Œæ’å…¥æ’åºï¼ˆinsertion sortï¼‰è€Œå¾—å‡ºçš„æ’åºç®—æ³•ã€‚ã€‚ã€‚</p><p>å¥½å§ï¼Œè¿™å°±è¶…å‡ºå’±çš„è®¤çŸ¥èŒƒå›´äº†ï¼Œæœ‰æ—¶é—´å†ç ”ç©¶äº†ã€‚æˆ‘ä»¬è¿˜æ˜¯æ¥ç€å†™è¿™é“é¢˜çš„æ­£ç»è§£æ³•å§ã€‚</p><h2 id="å½’å¹¶"><a href="#å½’å¹¶" class="headerlink" title="å½’å¹¶"></a>å½’å¹¶</h2><p>åˆšæ‰çš„é‚£ä¸ª merge sort ç»™äº†æˆ‘ä»¬è¶³å¤Ÿå®Œæˆè¿™é“é¢˜çš„å¯ç¤ºå•Šï¼Œè¿™é“é¢˜è¦å¹²çš„å°±æ˜¯å½’å¹¶æ’åºé‡Œåšçš„é‚£ç§å½’å¹¶ï¼</p><p>ç®—æ³•çš„æ€è·¯å¤§æ¦‚æ˜¯è¿™æ ·ï¼šç”±äºä¸¤ä¸ªæ•°ç»„éƒ½å·²ç»æ’å¥½åºäº†ï¼Œé‚£ä¹ˆè¦åˆæˆä¸€ä¸ªæ•°ç»„ï¼Œå°±æ˜¯ä¸æ–­æ¯”è¾ƒä¸¤ä¸ªæ•°ç»„çš„å¤´éƒ¨ï¼Œçœ‹å“ªä¸ªå¤´éƒ¨å…ƒç´ æ¯”è¾ƒå°å°±æŠŠå®ƒæ‹¿åˆ°ç›®æ ‡æ•°ç»„é‡Œçš„ä¸‹ä¸€ä¸ªä½ç½®ã€‚</p><p>e.g. </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">step1: t&#x3D;[],            n1&#x3D;[1,2,3],  n2&#x3D;[2,5,6] # 1æ¯”2å°ï¼ŒæŠŠ1ç§»åˆ°té‡Œ</span><br><span class="line">step2: t&#x3D;[1],           n1&#x3D;[2,3],    n2&#x3D;[2,5,6] # 2å’Œ2ä¸€æ ·å¤§å•Šï¼Œéšä¾¿æ”¾ä¸€ä¸ª</span><br><span class="line">step3: t&#x3D;[1,2],         n1&#x3D;[3],      n2&#x3D;[2,5,6] # 2æ¯”3å°ï¼Œæ”¾2</span><br><span class="line">step4: t&#x3D;[1,2,2],       n1&#x3D;[3],      n2&#x3D;[5,6]   # 3æ¯”5å°ï¼Œæ”¾3</span><br><span class="line">step5: t&#x3D;[1,2,2,3],     n1&#x3D;[],       n2&#x3D;[5,6]   # n1ç©ºäº†ï¼Œæ”¾n2çš„</span><br><span class="line">step6: t&#x3D;[1,2,2,3,5],   n1&#x3D;[],       n2&#x3D;[6]     # n1ç©ºäº†ï¼Œæ”¾n2çš„</span><br><span class="line">step6: t&#x3D;[1,2,2,3,5,6], n1&#x3D;[],       n2&#x3D;[]      # å®Œæˆ</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ€ä¹ˆåˆ¤æ–­ç©ºï¼Œæœ‰å¾ˆå¤šç§æ–¹æ³•ï¼Œæˆ‘æ¯”è¾ƒå–œæ¬¢çš„ä¸€ç§æ–¹æ³•æ˜¯ï¼šåœ¨ä¸¤ä¸ªæ•°ç»„çš„æœ«å°¾éƒ½æ”¾ä¸Šä¸€ä¸ªè¶…çº§å¤§çš„å…ƒç´ ï¼Œè¦ä¿è¯å®ƒä»¬æ¯”æ‰€æœ‰æ•°æ®å…ƒç´ éƒ½å¤§ï¼Œè¿™æ ·çš„è¯ï¼Œéšä¾¿å’Œè°æ¯”è¾ƒï¼Œå°çš„éƒ½ä¸å¯èƒ½æ˜¯å®ƒä»¬ï¼Œæ‰€ä»¥åªè¦è§„å®šå¥½ç›®æ ‡æ•°ç»„çš„é•¿åº¦ï¼Œå®ƒä»¬å°±ä¸ä¼šè¢«åŠ åˆ°æœ€åçš„ç›®æ ‡æ•°ç»„é‡Œã€‚è€Œä¸”è¿™ä¹ˆåšè¿˜é¿å…äº†å†™åˆ¤æ–­è¯­å¥ï¼Œåˆ¤æ–­åœ¨æ¯ä¸€æ¬¡è¿­ä»£é‡Œéƒ½è¦æ‰§è¡Œï¼Œæ—¶é—´æ¶ˆè€—å¾ˆå¯èƒ½å¤§äºæˆ‘ä»¬æ·»åŠ å¤§æ•°æ‰€ç”¨çš„å¸¸æ•°æ—¶é—´ã€‚</p><p>Golang å®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">merge</span><span class="params">(nums1 []<span class="keyword">int</span>, m <span class="keyword">int</span>, nums2 []<span class="keyword">int</span>, n <span class="keyword">int</span>)</span></span>  &#123;</span><br><span class="line">    nums1Copy := <span class="built_in">make</span>([]<span class="keyword">int</span>, m+<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">copy</span>(nums1Copy, nums1)</span><br><span class="line">    nums1Copy[m] = math.MaxInt32</span><br><span class="line">    nums2 = <span class="built_in">append</span>(nums2, math.MaxInt32)</span><br><span class="line">    i, j := <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> k := <span class="number">0</span>; k &lt; m + n; k++ &#123;</span><br><span class="line">        <span class="keyword">if</span> nums1Copy[i] &lt;= nums2[j] &#123;</span><br><span class="line">            nums1[k] = nums1Copy[i]</span><br><span class="line">            i++</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            nums1[k] = nums2[j]</span><br><span class="line">            j++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gc9x8pno43j31ag0u07w5.jpg" alt="å±å¹•å¿«ç…§ 2020-02-26 17.15.34"></p><p>åˆ†æä¸€ä¸‹è¿™ä¸ªç®—æ³•ï¼šæ—¶é—´å¤æ‚åº¦ : $O(n+m)$ï¼Œç©ºé—´å¤æ‚åº¦ : $O(m)$ã€‚</p><h2 id="é€†åºå½’å¹¶"><a href="#é€†åºå½’å¹¶" class="headerlink" title="é€†åºå½’å¹¶"></a>é€†åºå½’å¹¶</h2><p>åœ¨åˆšæ‰çš„å½’å¹¶è§£æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œåœ¨ä¸€å¼€å§‹ï¼ˆè¿­ä»£ä¹‹å‰ï¼‰ï¼Œéœ€è¦æ‹·è´ <code>nums1</code> çš„æœ‰æ•ˆæ•°æ®éƒ¨åˆ†ï¼Œè¿™ä¸€æ­¥ä¼šæ¶ˆè€—æ—¶é—´ã€ç©ºé—´ï¼›è€Œ <code>nums1</code> åé¢å´æœ‰ç€å¤§é‡çš„ç©ºç™½ç©ºé—´æ²¡æœ‰å¾ˆå¥½çš„åˆ©ç”¨èµ·æ¥ã€‚</p><p>æˆ‘ä»¬æ¥è€ƒè™‘æ˜¯å¦å¯ä»¥æŠŠåé¢çš„ç©ºé—´åˆ©ç”¨èµ·æ¥ï¼ŒåŒæ—¶é¿å…æ•°æ®çš„æ‹·è´ã€‚</p><p>äº‹å®ä¸Šï¼Œå¦‚æœæˆ‘ä»¬<strong>ä»å¤§åˆ°å°</strong>é€†åºå»å®Œæˆå½’å¹¶ï¼Œå°±å¯ä»¥è¾¾æˆè¿™ä¸¤ä¸ªç›®çš„ã€‚</p><p>åœ¨é€†åºçš„å½’å¹¶ä¸­ï¼Œæˆ‘ä»¬ä¾æ¬¡æŠŠä¸¤ä¸ªæœ‰åºæ•°ç»„ä¸­çš„<strong>è¾ƒå¤§è€…</strong>ï¼Œ<strong>ä»å°¾åˆ°å¤´</strong>æ”¾å…¥ç›®æ ‡æ•°ç»„ã€‚è¿™æ ·ï¼Œ<code>nums1</code> åé¢çš„ç©ºç™½ç©ºé—´å°±åˆ©ç”¨èµ·æ¥äº†ï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬è¿˜ä¸ç”¨æ‹·è´ <code>nums1</code> çš„æ•°æ®éƒ¨åˆ†äº†ï¼ˆå› ä¸ºé¢˜ç›®ä¿è¯äº† <code>nums1</code> çš„å°¾éƒ¨å¯ä»¥æ”¾ä¸‹æ•´ä¸ª <code>nums2</code>ï¼Œä¹Ÿå°±ä¸å¯èƒ½å‡ºç°æ•°æ®è¢«è¦†ç›–çš„æƒ…å†µäº†ï¼‰ã€‚</p><p>Golang å®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">merge</span><span class="params">(nums1 []<span class="keyword">int</span>, m <span class="keyword">int</span>, nums2 []<span class="keyword">int</span>, n <span class="keyword">int</span>)</span></span>  &#123;</span><br><span class="line">    i, j := m<span class="number">-1</span>, n<span class="number">-1</span></span><br><span class="line">    <span class="keyword">for</span> k := m+n<span class="number">-1</span>; k &gt;= <span class="number">0</span>; k-- &#123;</span><br><span class="line">        <span class="keyword">if</span> i &lt; <span class="number">0</span> &#123;</span><br><span class="line">            nums1[k] = nums2[j]</span><br><span class="line">            j--</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> j &lt; <span class="number">0</span> &#123;</span><br><span class="line">            nums1[k] = nums1[i]</span><br><span class="line">            i--</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> nums1[i] &gt;= nums2[j] &#123;</span><br><span class="line">            nums1[k] = nums1[i]</span><br><span class="line">            i--</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            nums1[k] = nums2[j]</span><br><span class="line">            j--</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç”¨åˆ°äº†å¦å¤–ä¸€ç§åˆ¤æ–­æ•°ç»„æ˜¯å¦å·²ç»åˆ°ç©ºçš„æ–¹æ³•ã€‚</p><p>æ¥çœ‹çœ‹è¿è¡Œç»“æœï¼š</p><p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gca528ctr9j31ag0u01kx.jpg" alt="å±å¹•å¿«ç…§ 2020-02-26 21.43.46"></p><p>åœ¨ç©ºé—´ä¸Šæ˜æ˜¾æœ‰äº†å¾ˆå¤§çš„è¿›æ­¥ï¼Œæ—¶é—´ä¸Šçœ‹ä¸å‡ºæ¥åŒºåˆ«ã€‚äº‹å®ä¸Šï¼Œè¿™ä¸ªç®—æ³•æ—¶é—´å¤æ‚åº¦ä¾ç„¶æ˜¯ $O(n+m)$ã€‚ç©ºé—´å¤æ‚åº¦é™åˆ°äº† $O(1)$ã€‚</p><hr><p>å…¶å®ï¼Œæˆ‘æ„Ÿè§‰è¿˜å¯ä»¥å†™çš„æ›´å¥½ä¸€ç‚¹ï¼Œä½†æˆ‘åšäº†å¤§é‡çš„å°è¯•ï¼ˆéƒ½æ˜¯è‡ªå·±æ„Ÿè§‰å¯ä»¥äº†ï¼Œç„¶åæäº¤ä¸Šå»å°± runtime errorğŸ˜‚ï¼‰æœ€åå‘ç°æ ¹æœ¬æ²¡æœ‰æå‡ï¼Œæœ€åé€šè¿‡çš„è¿™ä¸ªç‰ˆæœ¬çš„ä»£ç å·¨ä¸‘å°±ä¸æ”¾åˆ°è¿™é‡Œæ±¡æŸ“ç¯å¢ƒäº†ã€‚ã€‚ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gca74mcylkj30ru0gmjtn.jpg" alt="image-20200226225852251"></p>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode P53 æœ€å¤§å­åºå’Œ</title>
      <link href="/2020/02/25/School/Leetcode_P53_maxSubArray/"/>
      <url>/2020/02/25/School/Leetcode_P53_maxSubArray/</url>
      
        <content type="html"><![CDATA[<h1 id="Leetcode-P53-æœ€å¤§å­åºå’Œ"><a href="#Leetcode-P53-æœ€å¤§å­åºå’Œ" class="headerlink" title="Leetcode P53 æœ€å¤§å­åºå’Œ"></a>Leetcode P53 æœ€å¤§å­åºå’Œ</h1><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾åˆ°ä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚</p><p>ç¤ºä¾‹:</p><p>è¾“å…¥: [-2,1,-3,4,-1,2,1,-5,4],<br>è¾“å‡º: 6<br>è§£é‡Š: è¿ç»­å­æ•°ç»„ [4,-1,2,1] çš„å’Œæœ€å¤§ï¼Œä¸º 6ã€‚<br>è¿›é˜¶:</p><p>å¦‚æœä½ å·²ç»å®ç°å¤æ‚åº¦ä¸º O(n) çš„è§£æ³•ï¼Œå°è¯•ä½¿ç”¨æ›´ä¸ºç²¾å¦™çš„åˆ†æ²»æ³•æ±‚è§£ã€‚</p><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/maximum-subarray">https://leetcode-cn.com/problems/maximum-subarray</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p><h2 id="è´ªå¿ƒ"><a href="#è´ªå¿ƒ" class="headerlink" title="è´ªå¿ƒ"></a>è´ªå¿ƒ</h2><p>emmmï¼Œä¸€çœ‹åˆæ˜¯åŠ¨è§„é¢˜ã€‚ä½†æˆ‘ä¸ï¼ˆbuï¼‰çˆ±ï¼ˆhuiï¼‰å†™åŠ¨è§„ï¼Œæ¯æ¬¡å†™åŠ¨è§„éƒ½è¦çˆ†ç‚¸å¥½ä¹…ã€‚ã€‚ã€‚å…ˆè¯•è¯•èƒ½ä¸èƒ½è´ªå¿ƒè´ªå‡ºæ¥å§ã€‚</p><p>æˆ‘ä»¬æ¥è€ƒè™‘è¿™æ ·çš„è´ªå¿ƒç­–ç•¥ï¼š</p><blockquote><p>ä»å¤´åˆ°å°¾éå†æ•°ç»„ï¼Œåœ¨æ¯ä¸€ä¸ªå…ƒç´  <code>i</code> å¤„ï¼Œè´ªæœ€å¤§å’Œã€‚</p></blockquote><p>ä¹Ÿå°±æ˜¯åœ¨æ¯æ¬¡è¿­ä»£é‡Œï¼Œä¸€ä¸ªéƒ¨åˆ†æœ€å¤§å’Œè¦ä¹ˆæ˜¯<em>å‰é¢çš„æŸä¸€éƒ¨åˆ†å’Œ</em> + <em>å½“å‰å…ƒç´ å€¼</em>ï¼Œè¦ä¹ˆæ˜¯å½“å‰å…ƒç´ ä¸€ä¸ªå°±æ¯”å‰é¢è¾›è‹¦ç§¯ç´¯èµ·æ¥çš„å’Œå¤§äº†ï¼Œé‚£éƒ¨åˆ†æœ€å¤§å’Œå°±å˜æˆå½“å‰å…ƒç´ ä¸€ä¸ªäººçš„å€¼äº†ï¼›ä¹‹åï¼Œå¦‚æœæˆ‘ä»¬æ–°å¾—åˆ°çš„è¿™ä¸ªéƒ¨åˆ†å’Œæ¯”ä¹‹å‰çš„å…¨å±€çš„æœ€ä¼˜è§£è¿˜å¤§ï¼Œé‚£ä¹ˆå…¨å±€æœ€ä¼˜è§£å°±å˜æˆç°åœ¨çš„è¿™ä¸ªéƒ¨åˆ†å’Œäº†ã€‚</p><p>ç”¨ä»£ç æ¥è¡¨ç¤ºï¼Œå³å½“å‰éƒ¨åˆ†æœ€å¤§å’Œ <code>part = Max(part + nums[i], nums[i])</code>ï¼Œä»¥åŠå…¨å±€æœ€å¤§å’Œ <code>max = Max(max, part)</code>ï¼Œè¿™æ ·æˆ‘ä»¬æ¯ä¸€æ­¥éƒ½ä¿è¯ <code>part</code>ã€<code>max</code> éƒ½æ˜¯æœ€ä¼˜çš„ï¼Œå®Œæˆéå†å°±å¾—åˆ°äº†å…¨å±€æœ€ä¼˜è§£ã€‚</p><p>Golang å®ç°ï¼Œé¦–å…ˆä¸ºäº†çªå‡ºè´ªå¿ƒç­–ç•¥ï¼Œæˆ‘ä»¬å®ç°ä¸€ä¸ªè¾…åŠ©çš„ <code>MaxI()</code> æ¥è¿”å›ä¸¤ä¸ª <code>int</code> çš„æœ€å¤§å€¼ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// V1 (è®°ä½è¿™äº›ä»£ç ç‰ˆæœ¬çš„æ ‡å·å‘€ã€‚æœ¬æ–‡ä»£ç ç‰ˆæœ¬æ¯”è¾ƒå¤šï¼Œè€Œä¸”æœ‰ç›¸äº’æ¯”è¾ƒ)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">MaxI</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> a &gt; b &#123;</span><br><span class="line"><span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxSubArray</span><span class="params">(nums []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">part, max := nums[<span class="number">0</span>], nums[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">part = MaxI(nums[i], part + nums[i])</span><br><span class="line">max = MaxI(part, max)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> max</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gc8om3s4ngj319q0u0hc0.jpg" alt="å±å¹•å¿«ç…§ 2020-02-25 15.15.03"></p><p>Niceï¼Œè¿‡äº†ï¼Œéš¾å¾—æœ‰è¿™ç§æ‡’å¾—åŠ¨è§„æ‹¿è´ªå¿ƒè¿™ä¹ˆç®€å•å°±è´ªåˆ°çš„é¢˜ç›®ã€‚</p><p>å†æ•´ç†ä¸€ä¸‹ä»£ç ï¼Œå»æ‰ <code>MaxI</code>ï¼Œå‡å°‘å‡½æ•°è°ƒç”¨çš„æ¶ˆè€—ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// V2</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxSubArray</span><span class="params">(nums []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">part, max := nums[<span class="number">0</span>], nums[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">        part += nums[i]</span><br><span class="line">        <span class="keyword">if</span> nums[i] &gt; part &#123;</span><br><span class="line">            part = nums[i]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> part &gt; max &#123;</span><br><span class="line">            max = part</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> max</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gc8om9mpytj319q0u01kx.jpg" alt="å±å¹•å¿«ç…§ 2020-02-25 15.17.46"></p><p>Emmmï¼Œä¸ä½†æ²¡æœ‰ä¼˜åŒ–ï¼Œè¿˜æ›´å·®äº†ï¼Œä¸ç®¡äº†ï¼Œè¿™ä¸ªæ˜¯è¿æ°”é—®é¢˜ã€‚</p><p>åˆ†æä¸€ä¸‹è¿™ä¸ªç®—æ³•ï¼Œæ—¶é—´ä¸Šåªéå†äº†ä¸€æ¬¡æ•°ç»„ï¼Œ$O(n)$ï¼›ç©ºé—´ä¸Šéƒ½æ˜¯å¸¸é‡ç©ºé—´ï¼Œ$O(1)$ã€‚åº”è¯¥è¯´è¿™ä¸ªç®—æ³•è¿˜æ˜¯ä¸é”™çš„ã€‚</p><h2 id="åŠ¨è§„"><a href="#åŠ¨è§„" class="headerlink" title="åŠ¨è§„"></a>åŠ¨è§„</h2><p>è™½ç„¶ä¸å–œæ¬¢ï¼Œä½†è¿˜æ˜¯è¦ç»ƒä¹ å˜›ï¼ŒåŠ¨è§„è‚èµ·ã€‚</p><p>å»ºä¸€ä¸ªå¤‡å¿˜å½• <code>memo</code> æ¥è®°å½•å„ä¸ªå¯èƒ½çš„éƒ¨åˆ†å’Œï¼Œæœ€åè¿”å› <code>memo</code> ä¸­æœ€å¤§çš„å°±å¥½äº†ã€‚</p><p>è¿™é‡Œâ€œå„ä¸ªå¯èƒ½çš„éƒ¨åˆ†å’Œâ€ï¼Œæˆ‘ä»¬é‡‡å–å’Œåˆšæ‰è´ªå¿ƒç±»ä¼¼çš„æ€è·¯ï¼Œè®°å½•æ¯ä¸€ä¸ªå…ƒç´ å¤„çš„æœ€å¤§å€¼ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨è¿™æ ·çš„æ–¹æ³•ï¼šçœ‹çœ‹å¤‡å¿˜å½• <code>memo</code> ä¸­å‰é¢ä¸€ä¸ªå…ƒç´ å¤„çš„æœ€å¤§å€¼å¦‚æœè¿™ä¸ªå€¼æ˜¯è´Ÿçš„äº†ï¼Œé‚£å½“å‰å…ƒç´ åŠ ä¸Šå®ƒè‚¯å®šæ›´å°äº†ï¼Œæ‰€ä»¥å½“å‰æœ€å¤§å’Œå°±æ˜¯å½“å‰å…ƒç´ æœ¬èº«ï¼›å¦‚æœè®°å½•ä¸­å‰é¢çš„å€¼æ˜¯æ­£çš„ï¼Œé‚£åŠ ä¸Šå°±æ›´å¤§äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åŠ¡å¿…æŠŠå®ƒåŠ ä¸Šã€‚</p><p>ç»§ç»­ Golang å®ç°ï¼šï¼ˆGolang å†™æœåŠ¡å’Œå†™é¢˜éƒ½æ˜¯å¾ˆèˆ’æœçš„ğŸ˜Œï¼‰</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// V3</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;sort&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxSubArray</span><span class="params">(nums []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">memo := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="built_in">len</span>(nums))</span><br><span class="line">memo[<span class="number">0</span>] = nums[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line"><span class="keyword">if</span> memo[i<span class="number">-1</span>] &lt; <span class="number">0</span> &#123;</span><br><span class="line">memo[i] = nums[i]</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">memo[i] = memo[i<span class="number">-1</span>] + nums[i]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">sort.Ints(memo)</span><br><span class="line"><span class="keyword">return</span> memo[<span class="built_in">len</span>(memo)<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gc8prg5j7dj319q0u01kx.jpg" alt="å±å¹•å¿«ç…§ 2020-02-25 16.06.33"></p><p>ã€‚ã€‚ã€‚æˆ‘ä»¬è¿™é‡Œç”¨äº†ä¸€ä¸ªæ ‡å‡†åº“é‡Œçš„ <code>sort.Ints</code>ï¼Œå®ƒçš„ä»£ç å®ç°æ˜¯ä¸ª quick sortã€‚è¿™å±…ç„¶æ²¡æœ‰å½±å“é€Ÿåº¦ï¼Œç©ºé—´çš„å½±å“å€’æ˜¯çœ‹å‡ºæ¥äº†ã€‚</p><p>ï¼ˆå…¶å®è¿™ä¸ªåŠ¨è§„ä¹Ÿä¸éš¾ï¼‰</p><p>åˆ†æä¸€ä¸‹è¿™ä¸ªç®—æ³•ï¼Œæ—¶é—´ä¸»è¦æ˜¯ä¸€ä¸ªè¿­ä»£ï¼ˆ$n$ï¼‰è¿˜æœ‰ä¸€ä¸ªå¿«æ’ï¼ˆ$n\log n$ï¼‰ï¼Œåˆèµ·æ¥æ˜¯ $O(n\log n)$ï¼›ç©ºé—´ä¸Šï¼Œå†™äº†ä¸€ä¸ª $n$ çš„å¤‡å¿˜å½•ï¼Œ$O(n)$ã€‚</p><p>å…¶å®è¿™ä¸€ä¸ªç‰ˆæœ¬çš„ä»£ç é‡Œæœ‰å¥½å‡ ä¸ªåœ°æ–¹å¯ä»¥ä¼˜åŒ–ï¼Œç¬¬ä¸€è¿™ä¸ªå¿«æ’å®Œå…¨æ˜¯å¯ä»¥é¿å…çš„ï¼Œç”¨ä¹‹å‰è´ªå¿ƒæ—¶çš„ç­–ç•¥ï¼Œç”¨ä¸€ä¸ª <code>max</code> å–è®°å½•æ¯ä¸€æ­¥åçš„å…¨å±€æœ€ä¼˜è§£:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// V4</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxSubArray</span><span class="params">(nums []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">memo := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="built_in">len</span>(nums))</span><br><span class="line">memo[<span class="number">0</span>] = nums[<span class="number">0</span>]</span><br><span class="line">max := nums[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line"><span class="keyword">if</span> memo[i<span class="number">-1</span>] &lt; <span class="number">0</span> &#123;</span><br><span class="line">memo[i] = nums[i]</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">memo[i] = memo[i<span class="number">-1</span>] + nums[i]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> memo[i] &gt; max &#123;</span><br><span class="line">max = memo[i]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> max</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆä¸å¿™è·‘è¿™ä¸ªç‰ˆæœ¬ï¼Œè¿˜å¯ä»¥ç»§ç»­ä¼˜åŒ–ï¼Œå†è§‚å¯Ÿä»£ç ï¼Œæˆ‘ä»¬è‡ªå§‹è‡³ç»ˆåªä½¿ç”¨äº† <code>memo[i-1]</code> è¿™ä¸€ä¸ªè®°å½•å€¼æ¥æ›´æ–°ä¸‹ä¸€ä¸ªè®°å½•å€¼ <code>memo[i]</code>ï¼Œä¹‹å‰çš„æ‰€æœ‰è®°å½•éƒ½ä¸ä¼šç”¨åˆ°ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œä½•ä¸ç›´æ¥ç”¨ä¸€ä¸ª <code>int</code> å˜é‡æŠŠä¹‹å‰çš„æ•°ç»„å–ä»£æ‰ï¼Œç©ºé—´å°±ä» $O(n)$ é™åˆ° $O(1)$ äº†ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// V5</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxSubArray</span><span class="params">(nums []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">memo := nums[<span class="number">0</span>]</span><br><span class="line">max := nums[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line"><span class="keyword">if</span> memo &lt; <span class="number">0</span> &#123;</span><br><span class="line">memo = nums[i]</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">memo += nums[i]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> memo &gt; max &#123;</span><br><span class="line">max = memo</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> max</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gc8qbpo8axj319q0u01kx.jpg" alt="å±å¹•å¿«ç…§ 2020-02-25 16.30.49"></p><p>è¿™ä¸ªç»“æœæ¯”è¾ƒå¥½ï¼Œæ—¶é—´ä¸Šæ¯”ä¹‹å‰çš„æ‰€æœ‰ç‰ˆæœ¬éƒ½è¦å¿«ã€‚</p><p>æ¥ä¸‹æ¥å†ç ”ç©¶ä¸€ä¸‹èƒ½ä¸èƒ½æå‡ºåˆ†æ²»ã€‚ï¼Œï¼Œå—¯ï¼Ÿï¼Ÿï¼ï¼ç­‰ä¸€ä¸‹ï¼å‘ç°ä¸€ä¸ªæœ‰æ„æ€çš„ä¸œè¥¿ï¼</p><p>æˆ‘ä»¬å†æ¥è§‚å¯Ÿä¸€ä¸‹ <code>V5</code> å’Œ <code>V2</code> è¿™ä¸¤ä¸ªç‰ˆæœ¬çš„ä»£ç ï¼Œä¸€ä¸ªæ˜¯ä¼˜åŒ–åçš„è´ªå¿ƒï¼Œä¸€ä¸ªæ˜¯ä¼˜åŒ–åçš„åŠ¨è§„ã€‚ä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿï¼Œæˆ‘ä»¬ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ä»£ç è¡¨è¿°ï¼ˆç®—æ³•ã€å¤§ä½“æ¡†æ¶éƒ½ä¸åŠ¨ï¼‰ï¼Œç„¶åæŠŠå®ƒä»¬è‚©å¹¶è‚©æ¯”è¾ƒä¸€ä¸‹ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gc8qmkxcpvj31yi0tm7bl.jpg" alt="å±å¹•å¿«ç…§ 2020-02-25 16.42.05"></p><p>æˆ‘ä»¬ä¼šå‘ç°ï¼Œè¿™ä¸¤ä¸ªç‰ˆæœ¬çš„å¤§ä½“æ¡†æ¶æ˜¯ä¸€æ ·çš„ï¼ŒåŒºåˆ«åœ¨äºè¿­ä»£é‡Œçš„å¤„ç†ã€‚è€Œä¸”ï¼Œè¿™ä¸ä¸€æ ·çš„ä»£ç éƒ½æ˜¯ç”¨æ¥è¿™ä¸€æ­¥å½“å‰çš„æœ€å¤§éƒ¨åˆ†å’Œçš„ï¼ç¨å¾®æ€è€ƒä¸€ä¸‹è¿™ä¸¤ä¸ªæ–¹æ³•ï¼ŒV5 é‡Œå¦‚æœå‰é¢çš„è®°å½•æ˜¯æ­£çš„æˆ‘ä»¬æ‰åŠ ï¼Œè´Ÿçš„å°±ä¸åŠ äº†ï¼›V2 é‡Œæˆ‘ä»¬æ˜¯å…ˆåŠ ä¸Šå»è¯•è¯•çœ‹ï¼Œå¦‚æœåŠ ä¸Šå»å˜å°äº†å°±ä¸åŠ äº†ã€‚è€Œæˆ‘ä»¬çŸ¥é“ç”± $a + b &lt; a$ å¯ä»¥æ¨å‡º $b &lt; 0$ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çš„è¿™ä¸¤ç§å¤„ç†åœ¨æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ï¼</p><p>å“ˆï¼Œä¸€ä¸ªæ˜¯ä¼˜åŒ–åçš„è´ªå¿ƒï¼Œä¸€ä¸ªæ˜¯ä¼˜åŒ–åçš„åŠ¨è§„ï¼Œä»ä¸åŒçš„æ€æƒ³å‡ºå‘ï¼Œå±…ç„¶æ®Šé€”åŒå½’ï¼è¿˜æ˜¯å¾ˆæœ‰æ„æ€çš„ã€‚</p><h2 id="åˆ†æ²»"><a href="#åˆ†æ²»" class="headerlink" title="åˆ†æ²»"></a>åˆ†æ²»</h2><p><del>ã€16:46ã€‘ï¼šåˆ†æ²»å¥½éš¾çš„ï¼Œå¹³æ—¶ç”¨çš„ä¹Ÿä¸å¤šï¼Œå¥½å¤šä¸œè¥¿æˆ‘éƒ½å¿˜äº†ã€‚ã€‚ã€‚</del></p><p><del>ã€16:49ã€‘: å”‰ï¼Œæ—©çŸ¥ä¸èƒ½å›å­¦æ ¡å°±åº”è¯¥æŠŠã€Šç®—æ³•å¯¼è®ºã€‹ï¼ˆè¿˜æœ‰æˆ‘çš„ç´23333ï¼‰å¸¦å›æ¥çš„ï¼Œçœ‹æ‰«æç‰ˆçš„ PDF å¥½éš¾å—å•Šã€‚ğŸ˜­</del></p><p><del>ã€17:26ã€‘ï¼šå•Šï¼Œå¤©å‘ï¼Œæˆ‘å‘ç°æˆ‘å®Œå…¨å¿˜äº†ï¼Œåªä¼šå½’å¹¶æ’åºäº†ï¼ˆå½’å¹¶å¯èƒ½éƒ½ä¸èƒ½å®Œå…¨æµç•…æ‰‹å†™äº†ï¼‰ï¼Œä¸æƒ³åšäº†ã€‚</del></p><p><del>ã€17:39ã€‘ï¼šæˆ‘ç›´æ¥çœ‹äº†é¢˜è§£ã€‚ã€‚ã€‚è¯•ç€è‡ªå·±å¤è¿°ä¸€éå§ã€‚</del></p><hr><p>ç”¨ç±»ä¼¼äºäºŒåˆ†æ³•çš„æ€æƒ³å•Šï¼Œæœ€å¤§å’Œå­ä¸²çš„æ‰€æœ‰å…ƒç´ å¯èƒ½åœ¨è¿™ä¸‰ä¸ªä½ç½®ï¼š</p><ul><li>å…¨åœ¨æ•°ç»„ä¸­å¿ƒå·¦è¾¹</li><li>è·¨è¿‡æ•°ç»„ä¸­å¿ƒ</li><li>å…¨åœ¨æ•°ç»„ä¸­å¿ƒå³è¾¹</li></ul><p>æˆ‘ä»¬â€œåˆ†æ²»â€œå°±æ˜¯â€åˆ†â€œè¿™å‡ ç§æƒ…å†µäº†ã€‚å…¶ä¸­æ¯”è¾ƒç‰¹æ®Šçš„æ˜¯è·¨ä¸­å¿ƒçš„ï¼Œè·¨ä¸­å¿ƒçš„éœ€è¦ä»ä¸­å¿ƒå·¦ä¾§å’Œä¸­å¿ƒå³ä¾§åˆ†åˆ«ç”¨è´ªå¿ƒï¼Œæ±‚å¾—è·¨ä¸­å¿ƒçš„æœ€å¤§å’Œã€‚</p><p>è€Œéè·¨ä¸­å¿ƒçš„æƒ…å†µå°±åˆ†å·¦å³å»é€’å½’å˜›ï¼ŒæŠŠé—®é¢˜çœ‹æˆåªæœ‰å·¦è¾¹ä¸€åŠã€å³è¾¹ä¸€åŠåˆ†åˆ«æ±‚è§£ã€‚</p><p>æˆ‘ä»¬çš„é€’å½’éœ€è¦æœ‰åŸºç¡€æƒ…å†µï¼Œé‚£è¿™ä¸ªé—®é¢˜ä¸­çš„åŸºç¡€æƒ…å†µå°±æ˜¯é€’å½’åˆ°å­ä¸²åªæ˜¯å•ç‹¬çš„ä¸€ä¸ªå…ƒç´ äº†ï¼Œé‚£è¿™ä¸ªå…ƒç´ è‡ªå·±å°±æ˜¯è¿™ä¸ªå­åºçš„æœ€å¤§å­åºäº†ï¼Œç›´æ¥è¿”å›å®ƒæœ¬èº«ã€‚è€ŒéåŸºç¡€æƒ…å†µçš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯å­ä¸²é•¿åº¦&gt;1æ—¶ï¼Œå°±åƒåˆšæ‰è¯´çš„é‚£æ ·é€’å½’ä¸‹å»ï¼Œç»§ç»­ç”¨ä¸Šé¢è®¨è®ºçš„ä¸‰ç§æƒ…å†µæ‰¾å­ä¸²å•Šã€‚</p><p>é€’å½’åˆ°å¤´åï¼Œè¿”å›æ¥æ—¶æœ‰ç‚¹åƒæ£µæ ‘ï¼Œæ¯”è¾ƒå…„å¼Ÿï¼ˆå·¦åŠã€å³åŠã€è·¨ä¸­ ä¸‰ç§æƒ…å†µåˆ†åˆ«å–å¾—çš„æœ€å¤§å’Œï¼‰çš„å€¼ï¼Œæ‰¾åˆ°æœ€å¤§çš„å¾€ä¸Šè¿”å›â€¦â€¦è¿™æ ·è¿”å›åˆ°å¤´é—®é¢˜å°±è§£å†³äº†ã€‚</p><p>ï¼ˆå¥½ä¹±å•Šï¼Œæ²¡å†™ä»£ç ï¼Œè¾¹æ€è€ƒè¾¹æ¥å†™æ€è·¯å¥½æ€ªï¼Œå…¶å®æˆ‘è¿˜æ²¡å®Œå…¨ææ‡‚è¿™ä¸ªç®—æ³•æ˜¯åœ¨å¹²ä»€ä¹ˆï¼Œä¸ç®¡äº†ï¼Œæ¥è¯•ä¸€ä¸‹ä»£ç å®ç°ï¼Œä»£ç å‡ºæ¥æ€è·¯å°±æ¸…æ™°äº†ã€‚ï¼‰</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// V6</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxSubArray</span><span class="params">(nums []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> getMaxSubArray(nums, <span class="number">0</span>, <span class="built_in">len</span>(nums)<span class="number">-1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getMaxSubArray</span><span class="params">(nums []<span class="keyword">int</span>, left, right <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> left == right &#123;</span><br><span class="line"><span class="keyword">return</span> nums[right]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">center := (left + right) / <span class="number">2</span></span><br><span class="line">    </span><br><span class="line">leftSum := getMaxSubArray(nums, left, center)</span><br><span class="line">crossSum := getCrossSum(nums, left, center, right)</span><br><span class="line">rightSum := getMaxSubArray(nums, center+<span class="number">1</span>, right)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">return</span> maxI(leftSum, crossSum, rightSum)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getCrossSum</span><span class="params">(nums []<span class="keyword">int</span>, left, center, right <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> left == right &#123;</span><br><span class="line"><span class="keyword">return</span> nums[right]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">leftSubMaxSum := nums[center]</span><br><span class="line">memo := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i := center; i &gt;= left; i-- &#123;</span><br><span class="line">memo += nums[i]</span><br><span class="line"><span class="keyword">if</span> memo &gt;= leftSubMaxSum &#123;</span><br><span class="line">leftSubMaxSum = memo</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">rightSubMaxSum := nums[center+<span class="number">1</span>]</span><br><span class="line">memo = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i := center + <span class="number">1</span>; i &lt;= right; i++ &#123;</span><br><span class="line">memo += nums[i]</span><br><span class="line"><span class="keyword">if</span> memo &gt;= rightSubMaxSum &#123;</span><br><span class="line">rightSubMaxSum = memo</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> leftSubMaxSum + rightSubMaxSum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxI</span><span class="params">(a, b, c <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">switch</span> &#123;</span><br><span class="line"><span class="keyword">case</span> a &gt;= b &amp;&amp; a &gt;= c:</span><br><span class="line"><span class="keyword">return</span> a</span><br><span class="line"><span class="keyword">case</span> b &gt;= a &amp;&amp; b &gt;= c:</span><br><span class="line"><span class="keyword">return</span> b</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gc9110gn6pj319q0u01kx.jpg" alt="å±å¹•å¿«ç…§ 2020-02-25 22.38.51"></p><p>è¿™æ ·ï¼Œåˆ†æ²»æ³•å°±è¿‡äº†ï¼Œå…¶å®åˆ†æ²»æ²¡æœ‰ä¹‹å‰çš„é‚£äº›ç®—æ³•å¿«ï¼Œè¿™ä¸ªåˆ†æ²»æ˜¯ä¸ª $O(n\log n)$ï¼Œé€’å½’è°ƒç”¨ä¹Ÿä¼šæ¯”è¾ƒè€—æ—¶ï¼Œè¿˜æœ‰ç©ºé—´æ¶ˆè€—ä¹Ÿä¼šæ¯”è¾ƒå¤§ï¼Œå› ä¸ºå¼€é€’å½’æ ˆè¦äº† $O(\log n)$ï¼Œä½†æ•´ä¸ªé—®é¢˜è§£å†³çš„æ¯”è¾ƒç²¾å¦™ï¼Œä»£ç å¾ˆæ¼‚äº®ã€‚</p><p>P.S. æˆ‘å‰é¢å†™çš„æ€è·¯ä¸å¤ªæ¸…æ¥šï¼Œæ‰€ä»¥è¡¥ä¸€å¼ å›¾æ¥è¯´æ˜è¿™ä¸ªç®—æ³•æ˜¯åœ¨å¹²ä»€ä¹ˆï¼ˆæˆ‘æ€è€ƒçš„æ—¶å€™éšæ‰‹ç”»çš„ï¼Œä¸ä¸€å®šæ­£ç¡®ï¼Œä»…ä¾›å‚è€ƒï¼‰ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gc91o1k64ij30u00yegro.jpg" alt="image-20200225230422143"></p><h2 id="æš´åŠ›"><a href="#æš´åŠ›" class="headerlink" title="æš´åŠ›"></a>æš´åŠ›</h2><p>å†è¡¥ä¸€ä¸ªæš´åŠ›è§£æ³•å§ï¼ŒæŠŠè¿™é“é¢˜ä¸»è¦çš„å‡ ç§æ–¹æ³•éƒ½å†™å…¨ã€‚</p><p>æš´åŠ›æ³•å°±æ˜¯æŠŠæ‰€æœ‰çš„å¯èƒ½å­åºéƒ½æå‡ºæ¥ï¼Œæ¯”è¾ƒå®ƒä»¬çš„å’Œï¼Œè¿”å›æœ€å¤§çš„ã€‚</p><p>Golang å®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// V7</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxSubArray</span><span class="params">(nums []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">maxSubSum := nums[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> l := <span class="number">0</span>; l &lt; <span class="built_in">len</span>(nums); l++ &#123;</span><br><span class="line">part := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> r := l; r &lt; <span class="built_in">len</span>(nums); r++ &#123;</span><br><span class="line">part += nums[r]</span><br><span class="line"><span class="keyword">if</span> part &gt; maxSubSum &#123;</span><br><span class="line">maxSubSum = part</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> maxSubSum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gc9ibdwblmj319q0u04qg.jpg" alt="å±å¹•å¿«ç…§ 2020-02-26 08.37.10"></p><h2 id="ä¸€è¡Œä»£ç çš„è§£æ³•"><a href="#ä¸€è¡Œä»£ç çš„è§£æ³•" class="headerlink" title="ä¸€è¡Œä»£ç çš„è§£æ³•"></a>ä¸€è¡Œä»£ç çš„è§£æ³•</h2><p>æŒ‰ç…§ä¼ ç»Ÿï¼Œæˆ‘è¿˜æ˜¯å°½åŠ›æƒ³å‡ºä¸€ä¸ªä½¿ç”¨æœ€çŸ­ä»£ç è¡Œæ•°çš„è§£æ³•ã€‚</p><p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸€ä¸ªä¸¤è¡Œä»£ç çš„ Python3 è§£æ³•ï¼šï¼ˆä¸ç®—<code>import</code>ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># V8</span></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxSubArray</span>(<span class="params">self, nums: List[<span class="built_in">int</span>]</span>) -&gt; int:</span></span><br><span class="line">        nums[<span class="number">0</span>] = (nums[<span class="number">0</span>], nums[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">return</span> reduce(<span class="keyword">lambda</span> x, y: (<span class="built_in">max</span>(x[<span class="number">0</span>]+y, y), <span class="built_in">max</span>(x[<span class="number">1</span>], x[<span class="number">0</span>]+y, y)), nums)[<span class="number">1</span>]</span><br></pre></td></tr></table></figure><p>å…¶å®è¿™å°±æ˜¯æˆ‘ä»¬çš„è´ªå¿ƒ/åŠ¨è§„è§£æ³•å˜›ï¼Œåªæ˜¯åˆ©ç”¨äº† reduce æ¥åœ¨ä¸€è¡Œä»£ç é‡Œå®Œæˆæ‰€æœ‰æ“ä½œï¼ˆå¦ä¸€è¡Œä»£ç ä¸ºè¿™ä¸€è¡Œä»£ç åšäº†å¿…è¦çš„å‡†å¤‡ï¼‰ï¼Œæˆ‘æŒºå–œæ¬¢è¿™ä¸ªè§£æ³•çš„ï¼Œè¿˜æ˜¯å¾ˆä¼˜é›…çš„ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gc9jkwzn71j319q0u04pc.jpg" alt="å±å¹•å¿«ç…§ 2020-02-26 09.21.26"></p><p>å†æ¥æŠŠä»£ç å‡å°‘åˆ°ä¸€è¡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># V9</span></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxSubArray</span>(<span class="params">self, nums: List[<span class="built_in">int</span>]</span>) -&gt; int:</span></span><br><span class="line">        <span class="keyword">return</span> reduce(<span class="keyword">lambda</span> x, y: (<span class="built_in">max</span>(x[<span class="number">0</span>]+y[<span class="number">0</span>], y[<span class="number">0</span>]), <span class="built_in">max</span>(x[<span class="number">1</span>], x[<span class="number">0</span>]+y[<span class="number">0</span>], y[<span class="number">0</span>])), [(i, i) <span class="keyword">for</span> i <span class="keyword">in</span> nums])[<span class="number">1</span>]</span><br></pre></td></tr></table></figure><p>ä¸ºäº†å®Œæˆä¸€è¡Œä»£ç çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬ç”¨äº†ä¸€ä¸ªç”Ÿæˆå™¨ç”Ÿæˆäº†å¥½å¤šæ— ç”¨çš„æ•°æ®ï¼Œé€ æˆäº†æ—¶é—´ã€ç©ºé—´çš„æµªè´¹ï¼Œç»“æœå°±ä¸å¤ªå¥½äº†ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gc9k4h6ab8j31d90u01kx.jpg" alt="image-20200226094257065"></p><h2 id="æœ€åçš„åºŸè¯"><a href="#æœ€åçš„åºŸè¯" class="headerlink" title="æœ€åçš„åºŸè¯"></a>æœ€åçš„åºŸè¯</h2><p>è¿™ä¸€é“é¢˜ï¼Œæˆ‘ä»¬å†™å‡ºæ¥ 9 ä¸ªç‰ˆæœ¬çš„ä»£ç ï¼Œè¿˜æ˜¯å¾ˆæœ‰æ„æ€çš„ï¼Œä»è´ªå¿ƒã€åŠ¨è§„åˆ°åˆ†æ²»ï¼Œæœ€åå±…ç„¶è¿˜ç”¨ä¸€è¡Œä»£ç è§£å†³äº†å®ƒï¼ä¸åŒçš„æ€è€ƒè§’åº¦å‡ºå‘ï¼Œæˆ‘ä»¬å†™å‡ºè¿‡å‡ ä¹ç›¸åŒçš„ä»£ç ï¼›ç”¨ç›¸åŒçš„æ€æƒ³å»å®ç°ï¼Œæˆ‘ä»¬åˆå†™å‡ºäº†ä¸åŒçš„ç¨‹åºâ€¦â€¦è¿™æˆ–è®¸å°±æ˜¯ç¼–ç¨‹çš„é­…åŠ›å§ã€‚æˆ‘ä¸å–œæ¬¢ç¼–ç¨‹ï¼Œä½†ç¼–ç¨‹çš„è¿™ç§é­…åŠ›æ·±æ·±åœ°å¸å¼•ç€æˆ‘ï¼Œä¸ºæˆ‘æŒ‡å¼•ç€æœªæ¥æˆ–è®¸æ²¡æœ‰å¸Œæœ›çš„æ–¹å‘ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQL åŸºæœ¬ä½¿ç”¨</title>
      <link href="/2020/02/20/blog/SQL_CRUD/"/>
      <url>/2020/02/20/blog/SQL_CRUD/</url>
      
        <content type="html"><![CDATA[<h1 id="SQL-åŸºæœ¬ä½¿ç”¨"><a href="#SQL-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="SQL åŸºæœ¬ä½¿ç”¨"></a>SQL åŸºæœ¬ä½¿ç”¨</h1><p>æœ€è¿‘åŠå¹´å¤šä¸€ç›´éƒ½æ˜¯ç”¨ MongoDBï¼Œå¥½ä¹…æ²¡ SQL äº†ã€‚</p><p>è¿™å­¦æœŸæœ‰ä¸ªæ•°æ®åº“è¯¾ï¼Œï¼Œä¸Šäº†å‡ èŠ‚è¯¾äº†ï¼Œè¿˜æ²¡çœ‹è¿‡è¯¾æœ¬ğŸ˜‚ï¼Œä½†æƒ³æ¥åé¢è‚¯å®šæ˜¯å­¦ SQLï¼Œè¦å¤ä¹ ä¸€ä¸‹äº†ã€‚</p><p>æ‰€ä»¥æƒ³åœ¨ä¸‹ä¸€ä¸ªé¡¹ç›®é‡Œç”¨ç”¨ SQLï¼Œæ‰€ä»¥å…ˆæ¥å¤ä¹ ä¸€ä¸‹åŸºæœ¬çš„ SQL CRUDã€‚</p><h2 id="SQL-åŸºæœ¬æ¦‚å¿µ"><a href="#SQL-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="SQL åŸºæœ¬æ¦‚å¿µ"></a>SQL åŸºæœ¬æ¦‚å¿µ</h2><p>SQLï¼šStructured Query Languageï¼Œç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼Œè®¿é—®å’Œå¤„ç†æ•°æ®åº“ç”¨çš„ã€‚</p><p>SQL æœ‰è¿™å‡ ç§èƒ½åŠ›ï¼š</p><ul><li><strong>DDL</strong>ï¼šData Definition Languageï¼Œå®šä¹‰æ•°æ®çš„ï¼šå»ºè¡¨ã€åˆ è¡¨ã€ä¿®æ”¹è¡¨ç»“æ„çš„ï¼›</li><li><strong>DQL</strong>ï¼šData Query Languageï¼ŒæŸ¥è¯¢æ•°æ®çš„ï¼›</li><li><strong>DML</strong>ï¼šData Manipulation Languageï¼Œä¿®æ”¹æ•°æ®çš„ï¼šæ·»åŠ ã€åˆ é™¤ã€æ›´æ–°æ•°æ®çš„ï¼›</li></ul><h2 id="SQL-è¯­æ³•ç‰¹ç‚¹"><a href="#SQL-è¯­æ³•ç‰¹ç‚¹" class="headerlink" title="SQL è¯­æ³•ç‰¹ç‚¹"></a>SQL è¯­æ³•ç‰¹ç‚¹</h2><ul><li><p>è¯­å¥æœ«è¦å†™åˆ†å·</p></li><li><p>å…³é”®å­—ä¸åŒºåˆ†å¤§å°å†™ï¼›</p><p>è¡¨åã€åˆ—åã€(å¯èƒ½)åŒºåˆ†å¤§å°å†™ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ SQL å…³é”®å­—å¤§å†™ï¼Œè¡¨åã€åˆ—åç­‰ä½¿ç”¨å°å†™ã€‚</p></li><li><p>æ–‡æœ¬å­—æ®µç”¨å•å¼•å·åŒ…è£¹ï¼ˆe.g. <code>&#39;String&#39;</code>ï¼‰ï¼Œæ•°å€¼å­—æ®µä¸èƒ½åŠ å¼•å·ã€‚</p></li></ul><h2 id="SQL-æ•°æ®ç±»å‹"><a href="#SQL-æ•°æ®ç±»å‹" class="headerlink" title="SQL æ•°æ®ç±»å‹"></a>SQL æ•°æ®ç±»å‹</h2><table><thead><tr><th align="left">åç§°</th><th align="left">ç±»å‹</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left">INT</td><td align="left">æ•´å‹</td><td align="left">4å­—èŠ‚æ•´æ•°ç±»å‹ï¼ŒèŒƒå›´çº¦+/-21äº¿</td></tr><tr><td align="left">BIGINT</td><td align="left">é•¿æ•´å‹</td><td align="left">8å­—èŠ‚æ•´æ•°ç±»å‹ï¼ŒèŒƒå›´çº¦+/-922äº¿äº¿</td></tr><tr><td align="left">REAL</td><td align="left">æµ®ç‚¹å‹</td><td align="left">4å­—èŠ‚æµ®ç‚¹æ•°ï¼ŒèŒƒå›´çº¦+/-1038</td></tr><tr><td align="left">DOUBLE</td><td align="left">æµ®ç‚¹å‹</td><td align="left">8å­—èŠ‚æµ®ç‚¹æ•°ï¼ŒèŒƒå›´çº¦+/-10308</td></tr><tr><td align="left">DECIMAL(M,N)</td><td align="left">é«˜ç²¾åº¦å°æ•°</td><td align="left">ç”±ç”¨æˆ·æŒ‡å®šç²¾åº¦çš„å°æ•°ï¼Œä¾‹å¦‚ï¼ŒDECIMAL(20,10)è¡¨ç¤ºä¸€å…±20ä½ï¼Œå…¶ä¸­å°æ•°10ä½ï¼Œé€šå¸¸ç”¨äºè´¢åŠ¡è®¡ç®—</td></tr><tr><td align="left">CHAR(N)</td><td align="left">å®šé•¿å­—ç¬¦ä¸²</td><td align="left">å­˜å‚¨æŒ‡å®šé•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼ŒCHAR(100)æ€»æ˜¯å­˜å‚¨100ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²</td></tr><tr><td align="left">VARCHAR(N)</td><td align="left">å˜é•¿å­—ç¬¦ä¸²</td><td align="left">å­˜å‚¨å¯å˜é•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼ŒVARCHAR(100)å¯ä»¥å­˜å‚¨0~100ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²</td></tr><tr><td align="left">BOOLEAN</td><td align="left">å¸ƒå°”ç±»å‹</td><td align="left">å­˜å‚¨Trueæˆ–è€…False</td></tr><tr><td align="left">DATE</td><td align="left">æ—¥æœŸç±»å‹</td><td align="left">å­˜å‚¨æ—¥æœŸï¼Œä¾‹å¦‚ï¼Œ2018-06-22</td></tr><tr><td align="left">TIME</td><td align="left">æ—¶é—´ç±»å‹</td><td align="left">å­˜å‚¨æ—¶é—´ï¼Œä¾‹å¦‚ï¼Œ12:20:59</td></tr><tr><td align="left">DATETIME</td><td align="left">æ—¥æœŸå’Œæ—¶é—´ç±»å‹</td><td align="left">å­˜å‚¨æ—¥æœŸ+æ—¶é—´ï¼Œä¾‹å¦‚ï¼Œ2018-06-22 12:20:59</td></tr></tbody></table><h2 id="SQL-åŸºæœ¬è¯­å¥"><a href="#SQL-åŸºæœ¬è¯­å¥" class="headerlink" title="SQL åŸºæœ¬è¯­å¥"></a>SQL åŸºæœ¬è¯­å¥</h2><h3 id="DDL"><a href="#DDL" class="headerlink" title="DDL"></a>DDL</h3><h4 id="åº“"><a href="#åº“" class="headerlink" title="åº“"></a>åº“</h4><h5 id="CREATE"><a href="#CREATE" class="headerlink" title="- CREATE"></a>- CREATE</h5><blockquote><p><code>CREATE DATABASE</code> ç”¨æ¥å»ºæ•°æ®åº“ã€‚</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE database_name;</span><br></pre></td></tr></table></figure><h5 id="DROP"><a href="#DROP" class="headerlink" title="- DROP"></a>- DROP</h5><blockquote><p><code>DROP DATABASE</code> ç”¨æ¥åˆ åº“ã€‚</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> DATABASE database_name;</span><br></pre></td></tr></table></figure><h5 id="USE"><a href="#USE" class="headerlink" title="- USE"></a>- USE</h5><blockquote><p><code>USE</code> ç”¨æ¥é€‰æ‹©è¦æ“ä½œçš„æ•°æ®åº“ã€‚</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USE database_name;</span><br></pre></td></tr></table></figure><h4 id="è¡¨"><a href="#è¡¨" class="headerlink" title="è¡¨"></a>è¡¨</h4><h5 id="CREATE-1"><a href="#CREATE-1" class="headerlink" title="- CREATE"></a>- CREATE</h5><blockquote><p><code>CREATE TABLE</code> åˆ›å»ºæ•°æ®è¡¨ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE [IF NOT EXISTS] table_name (</span><br><span class="line">    &#96;column_name&#96; column_type,</span><br><span class="line">    &#96;column_name&#96; column_type,</span><br><span class="line">    ...,</span><br><span class="line">    PRIMARY KEY ( &#96;key_column_name&#96; )</span><br><span class="line">)[ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8];</span><br></pre></td></tr></table></figure><p>æ³¨ï¼š<code>[]</code>é‡Œçš„æ˜¯å¯é€‰çš„ã€‚</p><h5 id="DROP-1"><a href="#DROP-1" class="headerlink" title="- DROP"></a>- DROP</h5><blockquote><p><code>DROP TABLE</code> ç”¨æ¥åˆ é™¤è¡¨ã€‚</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> table_name ;</span><br></pre></td></tr></table></figure><h3 id="DQL"><a href="#DQL" class="headerlink" title="DQL"></a>DQL</h3><h4 id="SELECT"><a href="#SELECT" class="headerlink" title="SELECT"></a>SELECT</h4><blockquote><p> <code>SELECT</code> è¯­å¥ç”¨äºä»æ•°æ®åº“ä¸­é€‰å–æ•°æ®ã€‚</p></blockquote><p>SELECT ä»æ•°æ®åº“ä¸­é€‰å–å­—æ®µï¼ŒæŠŠç»“æ„æ”¾åˆ°ä¸€ä¸ªç»“æœè¡¨ä¸­ï¼Œæˆä¸ºç»“æœé›†ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name,column_name</span><br><span class="line"><span class="keyword">FROM</span> table_name;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> table_name;</span><br></pre></td></tr></table></figure><h4 id="SELECT-DISTINCT"><a href="#SELECT-DISTINCT" class="headerlink" title="SELECT DISTINCT"></a>SELECT DISTINCT</h4><blockquote><p><code>SELECT DISTINCT</code> è¯­å¥ç”¨äºè¿”å›åˆ—é‡Œå”¯ä¸€ä¸åŒçš„å€¼</p></blockquote><p>SELECT DISTINCT æ˜¯æŠŠæ‰€é€‰åˆ—å»é‡è¾“å‡ºï¼Œç»™ä½ çœ‹è¿™ä¸€åˆ—é‡Œæœ‰å¤šå°‘ç§ä¸åŒæƒ…å†µçš„ï¼Œå¦‚æœæŸ¥è¯¢çš„æ˜¯å¤šåˆ—ä¼šè¾“å‡ºæ¯ä¸€ç§ä¸åŒç»„åˆã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> column_name,column_name</span><br><span class="line"><span class="keyword">FROM</span> table_name;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ä¸€å¼ æ”¾äº†å…¨å›½äººåçš„è¡¨ï¼Œ<code>SELECT DISTINCT sex FROM people</code> ä¼šè¾“å‡º <code>ç”·</code>ï¼Œ<code>å¥³</code> ä¸¤é¡¹ï¼‰</p><p>å†ä¸¾ä¸ªğŸŒ°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM userinfo;</span><br><span class="line">+-----+----------+-------------+------------+</span><br><span class="line">| uid | username | department  | created    |</span><br><span class="line">+-----+----------+-------------+------------+</span><br><span class="line">|   2 | Foo      | Bar         | 2020-02-20 |</span><br><span class="line">|   3 | Fuzz     | Bar         | 2020-02-09 |</span><br><span class="line">|   4 | Joe      | Development | 2020-02-02 |</span><br><span class="line">|   5 | Ann      | Development | 2020-02-20 |</span><br><span class="line">+-----+----------+-------------+------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT DISTINCT department FROM userinfo;</span><br><span class="line">+-------------+</span><br><span class="line">| department  |</span><br><span class="line">+-------------+</span><br><span class="line">| Bar         |</span><br><span class="line">| Development |</span><br><span class="line">+-------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT DISTINCT department,created FROM userinfo;</span><br><span class="line">+-------------+------------+</span><br><span class="line">| department  | created    |</span><br><span class="line">+-------------+------------+</span><br><span class="line">| Bar         | 2020-02-20 |</span><br><span class="line">| Bar         | 2020-02-09 |</span><br><span class="line">| Development | 2020-02-02 |</span><br><span class="line">| Development | 2020-02-20 |</span><br><span class="line">+-------------+------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h4 id="WHERE"><a href="#WHERE" class="headerlink" title="WHERE"></a>WHERE</h4><blockquote><p><code>WHERE</code> å­å¥ç”¨äºè¿‡æ»¤è®°å½•ï¼Œæå–æ»¡è¶³æŒ‡å®šæ¡ä»¶çš„è®°å½•ã€‚</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name,column_name</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> column_name operator <span class="keyword">value</span>;</span><br></pre></td></tr></table></figure><p>operator è¿ç®—ç¬¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><table><thead><tr><th align="left">è¿ç®—ç¬¦</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">=</td><td align="left">ç­‰äº</td></tr><tr><td align="left">&lt;&gt;</td><td align="left">ä¸ç­‰äºã€‚<strong>æ³¨é‡Šï¼š</strong>åœ¨ SQL çš„ä¸€äº›ç‰ˆæœ¬ä¸­ï¼Œè¯¥æ“ä½œç¬¦å¯è¢«å†™æˆ !=</td></tr><tr><td align="left">&gt;</td><td align="left">å¤§äº</td></tr><tr><td align="left">&lt;</td><td align="left">å°äº</td></tr><tr><td align="left">&gt;=</td><td align="left">å¤§äºç­‰äº</td></tr><tr><td align="left">&lt;=</td><td align="left">å°äºç­‰äº</td></tr><tr><td align="left">BETWEEN</td><td align="left">åœ¨æŸä¸ªèŒƒå›´å†…</td></tr><tr><td align="left">LIKE</td><td align="left">æœç´¢æŸç§æ¨¡å¼</td></tr><tr><td align="left">IN</td><td align="left">æŒ‡å®šé’ˆå¯¹æŸä¸ªåˆ—çš„å¤šä¸ªå¯èƒ½å€¼</td></tr></tbody></table><p>æ —å­ğŸŒ°ï¼ˆè¿˜æ˜¯ä¸Šé¢é‚£ä¸ªä¾‹å­çš„è¡¨ï¼‰ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> userinfo <span class="keyword">WHERE</span> department<span class="operator">=</span><span class="string">&#x27;Bar&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----+----------+------------+------------+</span></span><br><span class="line"><span class="operator">|</span> uid <span class="operator">|</span> username <span class="operator">|</span> department <span class="operator">|</span> created    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+----------+------------+------------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">2</span> <span class="operator">|</span> Foo      <span class="operator">|</span> Bar        <span class="operator">|</span> <span class="number">2020</span><span class="number">-02</span><span class="number">-20</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">3</span> <span class="operator">|</span> Fuzz     <span class="operator">|</span> Bar        <span class="operator">|</span> <span class="number">2020</span><span class="number">-02</span><span class="number">-09</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+----------+------------+------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><h4 id="AND-amp-OR"><a href="#AND-amp-OR" class="headerlink" title="AND &amp; OR"></a>AND &amp; OR</h4><blockquote><p><code>AND</code> &amp; <code>OR</code> è¿ç®—ç¬¦ç”¨äºåŸºäºä¸€ä¸ªä»¥ä¸Šçš„æ¡ä»¶å¯¹è®°å½•è¿›è¡Œè¿‡æ»¤ï¼ˆç”¨åœ¨ WHERE é‡Œï¼‰ã€‚</p></blockquote><p>e.g.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> userinfo <span class="keyword">WHERE</span> department<span class="operator">=</span><span class="string">&#x27;Bar&#x27;</span> <span class="keyword">AND</span> created<span class="operator">=</span><span class="string">&#x27;2020-02-20&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----+----------+------------+------------+</span></span><br><span class="line"><span class="operator">|</span> uid <span class="operator">|</span> username <span class="operator">|</span> department <span class="operator">|</span> created    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+----------+------------+------------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">2</span> <span class="operator">|</span> Foo      <span class="operator">|</span> Bar        <span class="operator">|</span> <span class="number">2020</span><span class="number">-02</span><span class="number">-20</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+----------+------------+------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> userinfo <span class="keyword">WHERE</span> department<span class="operator">=</span><span class="string">&#x27;Bar&#x27;</span> <span class="keyword">OR</span> created<span class="operator">=</span><span class="string">&#x27;2020-02-20&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----+----------+-------------+------------+</span></span><br><span class="line"><span class="operator">|</span> uid <span class="operator">|</span> username <span class="operator">|</span> department  <span class="operator">|</span> created    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+----------+-------------+------------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">2</span> <span class="operator">|</span> Foo      <span class="operator">|</span> Bar         <span class="operator">|</span> <span class="number">2020</span><span class="number">-02</span><span class="number">-20</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">3</span> <span class="operator">|</span> Fuzz     <span class="operator">|</span> Bar         <span class="operator">|</span> <span class="number">2020</span><span class="number">-02</span><span class="number">-09</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">5</span> <span class="operator">|</span> Ann      <span class="operator">|</span> Development <span class="operator">|</span> <span class="number">2020</span><span class="number">-02</span><span class="number">-20</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+----------+-------------+------------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><h4 id="ORDER-BY"><a href="#ORDER-BY" class="headerlink" title="ORDER BY"></a>ORDER BY</h4><blockquote><p><code>ORDER BY</code> ç”¨äºå¯¹ç»“æœé›†è¿›è¡Œæ’åºã€‚</p></blockquote><p>ORDER BY é»˜è®¤æŒ‰ç…§<strong>å‡åº</strong>(ASC)å¯¹è®°å½•è¿›è¡Œæ’åºã€‚é™åºè¦ä½¿ç”¨ <code>DESC</code> å…³é”®å­—ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name,column_name</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> column_name,column_name <span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure><h4 id="LIMIT"><a href="#LIMIT" class="headerlink" title="LIMIT"></a>LIMIT</h4><blockquote><p><code>LIMIT</code> æˆ– <code>ROWNUM</code> æˆ– <code>TOP</code> ç”¨äºè§„å®šè¦è¿”å›çš„è®°å½•çš„æ•°ç›®ã€‚</p></blockquote><p>TOPã€LIMITã€ROWNUM æ˜¯ä¸åŒå®¶çš„æ•°æ®åº“é‡Œä¸åŒçš„å†™æ³•ã€‚</p><ul><li><p><code>LIMIT</code>ï¼šMySQL</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s)</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line">LIMIT number;</span><br></pre></td></tr></table></figure></li><li><p><code>ROWNUM</code>ï¼šOracle</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s)</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> ROWNUM <span class="operator">&lt;=</span> number;</span><br></pre></td></tr></table></figure></li><li><p><code>TOP</code>ï¼šSQL Serverï¼ŒAccess</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TOP number<span class="operator">|</span><span class="keyword">percent</span> column_name(s)</span><br><span class="line"><span class="keyword">FROM</span> table_name;</span><br></pre></td></tr></table></figure><h3 id="DML"><a href="#DML" class="headerlink" title="DML"></a>DML</h3></li></ul><h4 id="INSERT-INTO"><a href="#INSERT-INTO" class="headerlink" title="INSERT INTO"></a>INSERT INTO</h4><blockquote><p><code>INSERT INTO</code> è¯­å¥ç”¨äºå‘è¡¨ä¸­æ’å…¥æ–°è®°å½•ã€‚</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table_name (column1,column2,column3,...)</span><br><span class="line"><span class="keyword">VALUES</span> (value1,value2,value3,...);</span><br></pre></td></tr></table></figure><p>æˆ–ä¸æŒ‡å®šè¦æ’å…¥æ•°æ®çš„åˆ—åï¼Œéœ€è¦åˆ—å‡ºæ’å…¥è¡Œçš„æ¯ä¸€åˆ—æ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table_name</span><br><span class="line"><span class="keyword">VALUES</span> (value1,value2,value3,...);</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">INSERT</span> <span class="keyword">INTO</span> userinfo (username, department, created) <span class="keyword">VALUES</span> (<span class="string">&#x27;WhoKnown&#x27;</span>,<span class="string">&#x27;Market&#x27;</span>,<span class="string">&#x27;2001-10-12&#x27;</span>);</span><br><span class="line"></span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.03</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> userinfo <span class="keyword">WHERE</span> created <span class="operator">&lt;</span> <span class="string">&#x27;2020-01-01&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----+----------+------------+------------+</span></span><br><span class="line"><span class="operator">|</span> uid <span class="operator">|</span> username <span class="operator">|</span> department <span class="operator">|</span> created    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+----------+------------+------------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">6</span> <span class="operator">|</span> WhoKnown <span class="operator">|</span> Market     <span class="operator">|</span> <span class="number">2001</span><span class="number">-10</span><span class="number">-12</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+----------+------------+------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><h4 id="UPDATE"><a href="#UPDATE" class="headerlink" title="UPDATE"></a>UPDATE</h4><blockquote><p><code>UPDATE</code> è¯­å¥ç”¨äºæ›´æ–°è¡¨ä¸­å·²å­˜åœ¨çš„è®°å½•ã€‚</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> table_name</span><br><span class="line"><span class="keyword">SET</span> column1<span class="operator">=</span>value1,column2<span class="operator">=</span>value2,...</span><br><span class="line"><span class="keyword">WHERE</span> some_column<span class="operator">=</span>some_value;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡å†™ WHEREï¼Œè¡¨ç¤ºæ›´æ–°<strong>æ‰€æœ‰è®°å½•</strong>ã€‚</p><p>e.g.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">UPDATE</span> userinfo </span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">SET</span> username<span class="operator">=</span><span class="string">&#x27;Jack&#x27;</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> uid<span class="operator">=</span><span class="number">6</span>;</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.03</span> sec)</span><br><span class="line"><span class="keyword">Rows</span> matched: <span class="number">1</span>  Changed: <span class="number">1</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> userinfo <span class="keyword">WHERE</span> created <span class="operator">&lt;</span> <span class="string">&#x27;2020-01-01&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----+----------+------------+------------+</span></span><br><span class="line"><span class="operator">|</span> uid <span class="operator">|</span> username <span class="operator">|</span> department <span class="operator">|</span> created    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+----------+------------+------------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">6</span> <span class="operator">|</span> Jack     <span class="operator">|</span> Market     <span class="operator">|</span> <span class="number">2001</span><span class="number">-10</span><span class="number">-12</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+----------+------------+------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><h4 id="DELETE"><a href="#DELETE" class="headerlink" title="DELETE"></a>DELETE</h4><blockquote><p><code>DELETE</code> ç”¨äºåˆ é™¤è¡¨ä¸­çš„è®°å½•ã€‚</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> some_column<span class="operator">=</span>some_value;</span><br></pre></td></tr></table></figure><p>âš ï¸æ³¨æ„ï¼Œæ¼å†™ WHERE å°±<strong>åˆ é™¤æ‰€æœ‰è®°å½•</strong>äº†ï¼ˆä¸å¦‚ <code>sudo rm -rf /*</code> å¾—åŠ²ğŸ¤ªï¼‰ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode P27 ç§»é™¤å…ƒç´ </title>
      <link href="/2020/02/20/School/Leetcode_P27_RemoveElement/"/>
      <url>/2020/02/20/School/Leetcode_P27_RemoveElement/</url>
      
        <content type="html"><![CDATA[<h1 id="Leetcode-P27-ç§»é™¤å…ƒç´ "><a href="#Leetcode-P27-ç§»é™¤å…ƒç´ " class="headerlink" title="Leetcode P27 ç§»é™¤å…ƒç´ "></a>Leetcode P27 ç§»é™¤å…ƒç´ </h1><p>è¿˜æ˜¯ä½œä¸šé¢˜ï¼Œleetcode ç®€å•é¢˜+1ã€‚</p><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>ç»™å®šä¸€ä¸ªæ•°ç»„ nums å’Œä¸€ä¸ªå€¼ valï¼Œä½ éœ€è¦åŸåœ°ç§»é™¤æ‰€æœ‰æ•°å€¼ç­‰äº val çš„å…ƒç´ ï¼Œè¿”å›ç§»é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚</p><p>ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»åœ¨åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„å¹¶åœ¨ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´çš„æ¡ä»¶ä¸‹å®Œæˆã€‚</p><p>å…ƒç´ çš„é¡ºåºå¯ä»¥æ”¹å˜ã€‚ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</p><p>ç¤ºä¾‹ 1:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç»™å®š nums &#x3D; [3,2,2,3], val &#x3D; 3,</span><br><span class="line"></span><br><span class="line">å‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 2, å¹¶ä¸” nums ä¸­çš„å‰ä¸¤ä¸ªå…ƒç´ å‡ä¸º 2ã€‚</span><br><span class="line"></span><br><span class="line">ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 2:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ç»™å®š nums &#x3D; [0,1,2,2,3,0,4,2], val &#x3D; 2,</span><br><span class="line"></span><br><span class="line">å‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 5, å¹¶ä¸” nums ä¸­çš„å‰äº”ä¸ªå…ƒç´ ä¸º 0, 1, 3, 0, 4ã€‚</span><br><span class="line"></span><br><span class="line">æ³¨æ„è¿™äº”ä¸ªå…ƒç´ å¯ä¸ºä»»æ„é¡ºåºã€‚</span><br><span class="line"></span><br><span class="line">ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</span><br></pre></td></tr></table></figure><p>è¯´æ˜:</p><p>ä¸ºä»€ä¹ˆè¿”å›æ•°å€¼æ˜¯æ•´æ•°ï¼Œä½†è¾“å‡ºçš„ç­”æ¡ˆæ˜¯æ•°ç»„å‘¢?</p><p>è¯·æ³¨æ„ï¼Œè¾“å…¥æ•°ç»„æ˜¯ä»¥â€œå¼•ç”¨â€æ–¹å¼ä¼ é€’çš„ï¼Œè¿™æ„å‘³ç€åœ¨å‡½æ•°é‡Œä¿®æ”¹è¾“å…¥æ•°ç»„å¯¹äºè°ƒç”¨è€…æ˜¯å¯è§çš„ã€‚</p><p>ä½ å¯ä»¥æƒ³è±¡å†…éƒ¨æ“ä½œå¦‚ä¸‹:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nums æ˜¯ä»¥â€œå¼•ç”¨â€æ–¹å¼ä¼ é€’çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å¯¹å®å‚ä½œä»»ä½•æ‹·è´</span></span><br><span class="line"><span class="keyword">int</span> len = removeElement(nums, val);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨å‡½æ•°é‡Œä¿®æ”¹è¾“å…¥æ•°ç»„å¯¹äºè°ƒç”¨è€…æ˜¯å¯è§çš„ã€‚</span></span><br><span class="line"><span class="comment">// æ ¹æ®ä½ çš„å‡½æ•°è¿”å›çš„é•¿åº¦, å®ƒä¼šæ‰“å°å‡ºæ•°ç»„ä¸­è¯¥é•¿åº¦èŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ ã€‚</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">    print(nums[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/remove-element">https://leetcode-cn.com/problems/remove-element</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p><h2 id="åŒæŒ‡é’ˆæ³•"><a href="#åŒæŒ‡é’ˆæ³•" class="headerlink" title="åŒæŒ‡é’ˆæ³•"></a>åŒæŒ‡é’ˆæ³•</h2><p>emmmmï¼Œè¿™ä¸ªé¢˜åŸºæœ¬å’Œæ˜¨å¤©åšçš„ <a href="https://leetcode-cn.com/problems/remove-duplicates-from-sorted-array/">leetcode P26 åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹</a> ä¸€æ¨¡ä¸€æ ·ï¼Œç›´æ¥å¥—ç”¨é‚£ä¸ªé¢˜çš„æ–¹æ³•å°±å¥½äº†ï¼Œå…·ä½“ç®—æ³•è§æ˜¨ä¸Šä¸€ç¯‡æ–‡ç« ã€‚</p><p>åŒæŒ‡é’ˆæ³•ï¼ŒGolang å®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">removeElement</span><span class="params">(nums []<span class="keyword">int</span>, val <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(nums) == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    t := <span class="number">-1</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> nums[i] != val &#123;</span><br><span class="line">            t++</span><br><span class="line">            nums[t] = nums[i]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> t + <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gc2olfvu1uj30mc05kmxz.jpg" alt="å±å¹•å¿«ç…§ 2020-02-20 10.57.43"></p><p>å¥½çš„ï¼Œ0msã€2.1MBï¼Œå‡»è´¥ 100%ã€99.78%ï¼Œå·²ç»æ˜¯æœ€ä¼˜äº†ã€‚</p><p>ä½†çœ‹äº†ä¸€ä¸‹é¢˜è§£ï¼Œè¿˜æœ‰å…¶ä»–æ–¹æ³•ï¼Œå­¦ä¹ äº†ï¼š</p><h2 id="åŒæŒ‡é’ˆ-â€”â€”-åŠ¨æ€æ•°ç»„é•¿åº¦"><a href="#åŒæŒ‡é’ˆ-â€”â€”-åŠ¨æ€æ•°ç»„é•¿åº¦" class="headerlink" title="åŒæŒ‡é’ˆ â€”â€” åŠ¨æ€æ•°ç»„é•¿åº¦"></a>åŒæŒ‡é’ˆ â€”â€” åŠ¨æ€æ•°ç»„é•¿åº¦</h2><p>è¿™ä¸ªä¼˜åŒ–çš„æ€è·¯æ˜¯è¿™æ ·å•Šï¼Œå› ä¸ºä»æ•°ç»„é‡Œç§»é™¤ç‰¹å®šçš„å…ƒç´ ï¼Œè¿™ä¸ªå…ƒç´ ä¸€èˆ¬æ¯”è¾ƒå°‘å˜›ï¼Œä½†æˆ‘ä»¬éœ€è¦ä¸ºæ­¤å®Œæ•´éå†æ•´ä¸ªæ•°ç»„ï¼Œä¸å¤ªåˆ’ç®—ã€‚</p><p>æ—¢ç„¶é¢˜ç›®ä¸è¦æ±‚æ’åºï¼Œæ‰€ä»¥æˆ‘ä»¬è€ƒè™‘ä¸æŠŠå¾…åˆ é™¤çš„ç”¨ä¸‹ä¸€ä¸ªä¸ç›¸ç­‰çš„è¦†ç›–ï¼Œè€Œæ˜¯ç”¨æ•°ç»„æœ«å°¾å…ƒç´ è¦†ç›–ï¼Œè¿™æ ·å°±ä¸ç”¨éå†åˆ°åŸæ¥æœ€åä¸€ä¸ªå“ªé‡Œäº†ï¼Œç›¸å½“äºæŠŠå…ƒç´ åé¢çš„ä¸ç¡®å®šæ˜¯å¦è¦åˆ çš„æåˆ°å‰é¢æ¥ã€æŠŠæ˜ç¡®è¦åˆ çš„æ‰”åˆ°åé¢ã€‚è¿™æ ·å°±ç›¸å½“äºå¹²æ‰äº†ä¸€ä¸ªé•¿åº¦ï¼Œå‡å°‘äº†ä¸€æ¬¡è¿­ä»£å˜›ã€‚</p><p>Golang å®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">removeElement</span><span class="params">(nums []<span class="keyword">int</span>, val <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    l := <span class="built_in">len</span>(nums)</span><br><span class="line">    <span class="keyword">if</span> l == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; l; &#123;</span><br><span class="line">        <span class="keyword">if</span> nums[i] == val &#123;</span><br><span class="line">            nums[i] = nums[l - <span class="number">1</span>]</span><br><span class="line">            l--</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            i++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> l</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªçš„ç»“æœå’Œæˆ‘ä»¬çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬ä¹Ÿå·®ä¸å¤šï¼Œ<del>å†…å­˜æ’åè¿˜ä¸‹å»äº†ä¸€äº›</del>ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gc2p2ppnccj30lk05ct9i.jpg" alt="image-20200220111518525"></p><h2 id="ä¸€è¡Œä»£ç è§£æ³•"><a href="#ä¸€è¡Œä»£ç è§£æ³•" class="headerlink" title="ä¸€è¡Œä»£ç è§£æ³•"></a>ä¸€è¡Œä»£ç è§£æ³•</h2><p>æ—¢ç„¶ä¼˜åŒ–ä¸äº†äº†ï¼Œå°±è¯•ç‚¹å¥½ç©çš„å˜›ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿæœ‰åªç”¨ä¸€è¡Œä»£ç çš„è§£æ³•ã€‚</p><p>æ–¹æ³•æ˜¯åˆ©ç”¨å‡½æ•°å¼ç¼–ç¨‹çš„ <code>filter</code> æ¥æŠŠç­‰äºè¦åˆ é™¤çš„é‚£ä¸ªå€¼çš„å…ƒç´ ç›´æ¥å…¨éƒ¨è¿‡æ»¤æ‰ã€‚</p><p>Python3 å®ç°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">removeElement</span>(<span class="params">self, nums: List[<span class="built_in">int</span>], val: <span class="built_in">int</span></span>) -&gt; int:</span></span><br><span class="line">        nums[:] = <span class="built_in">filter</span>(<span class="keyword">lambda</span> x: x != val, nums)</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gc2q35ak4nj30ni056aaw.jpg" alt="image-20200220115019134"></p><p>å½“ç„¶ï¼Œåœ¨ Python ä¸­ï¼Œè¿˜æœ‰å¦ä¸€ç§å†™æ³•ï¼Œç”¨åˆ—è¡¨ç”Ÿæˆå™¨å®Œæˆè¿‡æ»¤ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">removeElement</span>(<span class="params">self, nums: List[<span class="built_in">int</span>], val: <span class="built_in">int</span></span>) -&gt; int:</span></span><br><span class="line">        nums[:] = [x <span class="keyword">for</span> x <span class="keyword">in</span> nums <span class="keyword">if</span> x != val]</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gc2v9wfloqj30nq05egmh.jpg" alt="image-20200220144948410"></p>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode P26 åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹</title>
      <link href="/2020/02/19/School/Leetcode_P26_RemoveDuplicatesFromSortedArray/"/>
      <url>/2020/02/19/School/Leetcode_P26_RemoveDuplicatesFromSortedArray/</url>
      
        <content type="html"><![CDATA[<h1 id="Leetcode-P26-åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹"><a href="#Leetcode-P26-åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹" class="headerlink" title="Leetcode P26 åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹"></a>Leetcode P26 åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹</h1><p>è¿˜æ˜¯å†™å­¦æ ¡ä½œä¸šï¼Œä¾ç„¶æ˜¯ leetcode ç®€å•é¢˜ã€‚</p><h2 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>ç»™å®šä¸€ä¸ªæ’åºæ•°ç»„ï¼Œä½ éœ€è¦åœ¨åŸåœ°åˆ é™¤é‡å¤å‡ºç°çš„å…ƒç´ ï¼Œä½¿å¾—æ¯ä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ï¼Œè¿”å›ç§»é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚</p><p>ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»åœ¨åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„å¹¶åœ¨ä½¿ç”¨ $O(1)$ é¢å¤–ç©ºé—´çš„æ¡ä»¶ä¸‹å®Œæˆã€‚</p><p><strong>ç¤ºä¾‹ 1</strong>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç»™å®šæ•°ç»„ nums &#x3D; [1,1,2], </span><br><span class="line"></span><br><span class="line">å‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 2, å¹¶ä¸”åŸæ•°ç»„ nums çš„å‰ä¸¤ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º 1, 2ã€‚ </span><br><span class="line"></span><br><span class="line">ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2</strong>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç»™å®š nums &#x3D; [0,0,1,1,1,2,2,3,3,4],</span><br><span class="line"></span><br><span class="line">å‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 5, å¹¶ä¸”åŸæ•°ç»„ nums çš„å‰äº”ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º 0, 1, 2, 3, 4ã€‚</span><br><span class="line"></span><br><span class="line">ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜</strong>:</p><p>ä¸ºä»€ä¹ˆè¿”å›æ•°å€¼æ˜¯æ•´æ•°ï¼Œä½†è¾“å‡ºçš„ç­”æ¡ˆæ˜¯æ•°ç»„å‘¢?</p><p>è¯·æ³¨æ„ï¼Œè¾“å…¥æ•°ç»„æ˜¯ä»¥â€œå¼•ç”¨â€æ–¹å¼ä¼ é€’çš„ï¼Œè¿™æ„å‘³ç€åœ¨å‡½æ•°é‡Œä¿®æ”¹è¾“å…¥æ•°ç»„å¯¹äºè°ƒç”¨è€…æ˜¯å¯è§çš„ã€‚</p><p>ä½ å¯ä»¥æƒ³è±¡å†…éƒ¨æ“ä½œå¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; nums æ˜¯ä»¥â€œå¼•ç”¨â€æ–¹å¼ä¼ é€’çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å¯¹å®å‚åšä»»ä½•æ‹·è´</span><br><span class="line">int len &#x3D; removeDuplicates(nums);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; åœ¨å‡½æ•°é‡Œä¿®æ”¹è¾“å…¥æ•°ç»„å¯¹äºè°ƒç”¨è€…æ˜¯å¯è§çš„ã€‚</span><br><span class="line">&#x2F;&#x2F; æ ¹æ®ä½ çš„å‡½æ•°è¿”å›çš„é•¿åº¦, å®ƒä¼šæ‰“å°å‡ºæ•°ç»„ä¸­è¯¥é•¿åº¦èŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ ã€‚</span><br><span class="line">for (int i &#x3D; 0; i &lt; len; i++) &#123;</span><br><span class="line">    print(nums[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/remove-duplicates-from-sorted-array">https://leetcode-cn.com/problems/remove-duplicates-from-sorted-array</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p><h2 id="ä¸€è¡Œä»£ç çš„è§£æ³•"><a href="#ä¸€è¡Œä»£ç çš„è§£æ³•" class="headerlink" title="ä¸€è¡Œä»£ç çš„è§£æ³•"></a>ä¸€è¡Œä»£ç çš„è§£æ³•</h2><p>è¿™ä¸ªé—®é¢˜å¾ˆï¼ç®€ï¼å•ï¼å°±æ˜¯è¿‡æ»¤é‡å¤é¡¹å˜›ï¼Œè¿™ä¸ªé—®é¢˜åœ¨ç”Ÿæ´»ä¸­å¾ˆå¸¸è§ï¼Œæˆ‘ä¸€èˆ¬æ˜¯ç”¨ <code>Set</code> ä¿è¯å…ƒç´ ä¸é‡å¤çš„æ€§è´¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Œå…·ä½“å®ç°æ˜¯æŠŠåˆ—è¡¨è½¬æˆé›†åˆå†è½¬å›æ¥å°±å®Œæˆäº†ã€‚ä½†è¿™ä¸ªé¢˜ç›®è¿˜è¦è¦æ±‚æ’åºï¼Œ<code>Set</code> ä¸ä¸€å®šèƒ½ä¿è¯æœ‰åºæ€§ï¼Œé‚£å°±å†å¥—ä¸€ä¸ªæ’åºå¥½äº†ã€‚</p><p>è™½ç„¶è¿™ä¸ªæ–¹æ³•åœ¨æ—¶é—´ã€ç©ºé—´ä¸Šæ¶ˆè€—éƒ½ä¸å°ï¼Œä½†ä»£ç ååˆ†ç®€æ´ï¼Œemmmmï¼Œå†åˆ©ç”¨åˆé€‚çš„è¯­è¨€ + ä¸€å°ç‚¹å¥‡æŠ€æ·«å·§ï¼Œå¤§æ¦‚å°±ä¸€è¡Œä»£ç ï¼š</p><p>Python3 è§£æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">removeDuplicates</span>(<span class="params">self, nums: List[<span class="built_in">int</span>]</span>) -&gt; int:</span></span><br><span class="line">        nums[:] = <span class="built_in">sorted</span>(<span class="built_in">set</span>(nums))</span><br></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç”¨æ—¶ :248 ms, åœ¨æ‰€æœ‰ Python3 æäº¤ä¸­å‡»è´¥äº†11.22%çš„ç”¨æˆ·</p><p>å†…å­˜æ¶ˆè€— :30.7 MB, åœ¨æ‰€æœ‰ Python3 æäº¤ä¸­å‡»è´¥äº†5.05%çš„ç”¨æˆ·</p></blockquote><p>ğŸ˜‚</p><p>ä½†æ˜¯è¿™ç§æ–¹æ³•æœ‰ä¸ªå°é—®é¢˜ï¼Œåœ¨ Golang é‡Œæ²¡æœ‰ <code>Set</code> æ€ä¹ˆåŠï¼Ÿç”¨ç±»ä¼¼çš„æ€æƒ³ï¼Œå“ˆå¸Œè¡¨å¯ä»¥ä¿è¯é”®å”¯ä¸€ï¼ŒæŠŠ <code>nums</code> é‡Œçš„å€¼åš keyï¼Œå…¨æ”¾å…¥ä¸€ä¸ª <code>map</code> é‡Œï¼Œè¿­ä»£å‡ºæ¥å†æ’åºä¹Ÿå°±å®Œäº†ã€‚</p><hr><p>ä»¥ä¸Šçº¯å±å¨±ä¹ï¼Œä¸‹é¢å¼€å§‹æ­£è§£ï¼š</p><h2 id="åŒæŒ‡é’ˆæ³•"><a href="#åŒæŒ‡é’ˆæ³•" class="headerlink" title="åŒæŒ‡é’ˆæ³•"></a>åŒæŒ‡é’ˆæ³•</h2><p>å› ä¸ºé¢˜ç›®ç»™çš„æ•°ç»„æ˜¯å·²ç»æ’å¥½åºçš„ï¼Œæ‰€ä»¥æŸä¸€å…ƒç´ è¦ä¹ˆç­‰äºå…¶å‰é¢ä¸€ä¸ªå…ƒç´ ï¼Œè¦ä¹ˆå¤§äºå‰é¢ä¸€ä¸ªå…ƒç´ ã€‚</p><p>å¯¹æŸä¸€å…ƒç´ ï¼Œè‹¥ç­‰äºå‰ä¸€å…ƒç´ ï¼Œåˆ™è¯´æ˜æ”¹é¡¹é‡å¤ï¼Œå³éœ€è¦â€œåˆ é™¤â€ã€‚</p><p>æˆ‘ä»¬ä¸å®¹æ˜“ä»æ•°ç»„ä¸­ç›´æ¥â€œåˆ é™¤â€ä¸€ä¸ªå…ƒç´ ï¼Œä½†å¯ä»¥è€ƒè™‘ç”¨å…¶ä»–åˆé€‚çš„å…ƒç´ æ¥è¦†ç›–å®ƒã€‚åœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œ æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªä¸é‡å¤çš„å…ƒç´ æ¥è¦†ç›–æ‰ä¸€ä¸ªé‡å¤çš„å…ƒç´ ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬ç®—æ³•çš„æ€è·¯å°±æ˜¯ï¼šç”¨æŒ‡é’ˆ <code>i</code> éå†æ•°ç»„ï¼Œç»´æŠ¤æŒ‡é’ˆ <code>t</code> ä¿è¯ <code>t</code> å‰çš„æ•°ç»„ä¸é‡å¤ï¼Œè‹¥ <code>i</code> éå†åˆ°çš„å…ƒç´ ä¸åœ¨ <code>t</code> å‰çš„ä¸é‡å¤éƒ¨åˆ†ï¼ˆç”±äºå·²ç»æ’åºï¼Œä¹Ÿå°±æ˜¯ <code>elementAt(i) != elementAt(t)</code> ï¼‰ï¼Œåˆ™å°†å…¶åŠ å…¥ï¼ˆå³ç”¨å®ƒè¦†ç›– <code>t</code> åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶ä¸” <code>t</code> è‡ªå¢ 1ï¼‰ã€‚</p><p>å…·ä½“çš„å®ç°ä¸Šï¼Œï¼Œï¼Œemmmï¼Œæˆ‘ä¸æƒ³å†™äº†ï¼Œç›´æ¥æŠ„ä¸€ä¸‹é¢˜è§£å§ã€‚ï¼ˆéš¾å¾—è‡ªå·±çš„ç®—æ³•å‡ ä¹å’Œé¢˜è§£<strong>ä¸€æ‘¸ä¸€æ ·</strong>ï¼‰</p><blockquote><p>æ•°ç»„å®Œæˆæ’åºåï¼Œæˆ‘ä»¬å¯ä»¥æ”¾ç½®ä¸¤ä¸ªæŒ‡é’ˆ <code>i</code> å’Œ <code>j</code>ï¼Œå…¶ä¸­ <code>i</code> æ˜¯æ…¢æŒ‡é’ˆï¼Œè€Œ <code>j</code> æ˜¯å¿«æŒ‡é’ˆã€‚åªè¦ <code>nums[i]=nums[j]</code>ï¼Œæˆ‘ä»¬å°±å¢åŠ  <code>j</code> ä»¥è·³è¿‡é‡å¤é¡¹ã€‚å½“æˆ‘ä»¬é‡åˆ° <code>nums[j] != nums[i]</code> æ—¶ï¼Œè·³è¿‡é‡å¤é¡¹çš„è¿è¡Œå·²ç»ç»“æŸï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»æŠŠå®ƒï¼ˆ<code>nums[j]</code>ï¼‰çš„å€¼å¤åˆ¶åˆ° <code>nums[i+1]</code>ã€‚ç„¶åé€’å¢ <code>i</code>ï¼Œæ¥ç€æˆ‘ä»¬å°†å†æ¬¡é‡å¤ç›¸åŒçš„è¿‡ç¨‹ï¼Œç›´åˆ° <code>j</code> åˆ°è¾¾æ•°ç»„çš„æœ«å°¾ä¸ºæ­¢ã€‚</p><p>ä½œè€…ï¼šLeetCode<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/remove-duplicates-from-sorted-array/solution/shan-chu-pai-xu-shu-zu-zhong-de-zhong-fu-xiang-by-/">https://leetcode-cn.com/problems/remove-duplicates-from-sorted-array/solution/shan-chu-pai-xu-shu-zu-zhong-de-zhong-fu-xiang-by-/</a><br>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p></blockquote><p>Golang å®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">removeDuplicates</span><span class="params">(nums []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(nums) &lt;= <span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(nums)</span><br><span class="line">    &#125;</span><br><span class="line">    t := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> nums[i] != nums[t] &#123;</span><br><span class="line">            t++</span><br><span class="line">            nums[t] = nums[i]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> t + <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç”¨æ—¶ :8 ms, åœ¨æ‰€æœ‰ Go æäº¤ä¸­å‡»è´¥äº†93.95%çš„ç”¨æˆ·</p><p>å†…å­˜æ¶ˆè€— :4.6 MB, åœ¨æ‰€æœ‰ Go æäº¤ä¸­å‡»è´¥äº†62.06%çš„ç”¨æˆ·</p></blockquote><hr><p>åæ§½ä¸€å¥ï¼Œæˆ‘ä¸è®¤ä¸ºæˆ‘å†™çš„æ¯”è¿™æ²¡æœ‰ç¼©è¿›çš„ä¸‘é™‹ 0 ms çš„å†™çš„å·®ï¼</p><p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gc21h8o0kqj31to0n479r.jpg" alt="image-20200219213850376"></p><p>å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯æˆ‘æŠŠé•¿åº¦ä¸º 1 çš„ä¹Ÿç›´æ¥è¿”å›äº†ï¼Œä¸€ä¸ªå…ƒç´ è‚¯å®šä¹Ÿä¸é‡å¤å˜›ï¼ä½†å°±å¤šä¸€ä¸ª <code>len()</code> çš„è°ƒç”¨æˆ‘ä¸è®¤ä¸ºå¯ä»¥æŠŠæ—¶é—´æ‹‰æ…¢è¿™ä¹ˆå¤šï¼Œäº‹å®ä¸Šï¼Œæˆ‘æŠŠæˆ‘çš„ä»£ç æ”¹æˆå’Œä»–ä¸€æ¨¡ä¸€æ ·çš„ä¾ç„¶æ˜¯ 8 msã€‚</p><p>è¿˜æœ‰åœ¨æ—¶é—´ä¸Šï¼Œæˆ‘è·‘äº†å¥½å‡ æ¬¡ï¼Œæœ‰çš„æ—¶å€™æ˜¯ 4.5 MB å‡»è´¥ 100%ï¼Œæœ‰çš„æ—¶å€™æ˜¯ 4.6 MB å‡»è´¥ 62.06%ã€‚å’±ä¹Ÿä¸çŸ¥é“è¿™ä¸ªè¿æ°”é—®é¢˜è¦æ€ä¹ˆè§£å†³ğŸ¤·â€â™‚ï¸ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode P1 ä¸¤æ•°ä¹‹å’Œ</title>
      <link href="/2020/02/18/School/Leetcode_P1_TwoSum/"/>
      <url>/2020/02/18/School/Leetcode_P1_TwoSum/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸¤æ•°ä¹‹å’Œ"><a href="#ä¸¤æ•°ä¹‹å’Œ" class="headerlink" title="ä¸¤æ•°ä¹‹å’Œ"></a>ä¸¤æ•°ä¹‹å’Œ</h1><p>Emmmmï¼Œå†™ä¸€ç¯‡å­¦æ ¡ä½œä¸šã€‚</p><blockquote><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªç›®æ ‡å€¼ targetï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡ºå’Œä¸ºç›®æ ‡å€¼çš„é‚£ ä¸¤ä¸ª æ•´æ•°ï¼Œå¹¶è¿”å›ä»–ä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚</p><p>ä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆã€‚ä½†æ˜¯ï¼Œä½ ä¸èƒ½é‡å¤åˆ©ç”¨è¿™ä¸ªæ•°ç»„ä¸­åŒæ ·çš„å…ƒç´ ã€‚</p><p>ç¤ºä¾‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç»™å®š nums &#x3D; [2, 7, 11, 15], target &#x3D; 9</span><br><span class="line"></span><br><span class="line">å› ä¸º nums[0] + nums[1] &#x3D; 2 + 7 &#x3D; 9</span><br><span class="line">æ‰€ä»¥è¿”å› [0, 1]</span><br></pre></td></tr></table></figure><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/two-sum">https://leetcode-cn.com/problems/two-sum</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p></blockquote><h2 id="æš´åŠ›æ±‚è§£"><a href="#æš´åŠ›æ±‚è§£" class="headerlink" title="æš´åŠ›æ±‚è§£"></a>æš´åŠ›æ±‚è§£</h2><p>è¿™æ˜¯ Leetcode çš„ç¬¬ä¸€é¢˜ï¼Œæœ€ç®€å•çš„é¢˜ï¼Œå…¶å®æ²¡ä»€ä¹ˆå¥½å†™çš„ï¼Œæœ€ç®€å•çš„æ–¹æ³•ï¼Œæš´åŠ›æ±‚è§£ç›´æ¥ä¸Šï¼Œéå†ä¸¤æ¬¡æ•°ç»„ï¼Œæ‰¾åˆ°å°±è¿”å›ã€‚</p><p>æ›¾ç»å†™çš„ C++ ä»£ç ï¼ˆæˆ‘åˆšå¼€å§‹åˆ·é¢˜çš„æ—¶å€™å†™çš„ï¼‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">twoSum</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i+<span class="number">1</span>; j &lt; nums.size(); j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (nums[i] + nums[j] == target) &#123;</span><br><span class="line">                    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">result</span><span class="params">(&#123;i, j&#125;)</span></span>;</span><br><span class="line">                    <span class="keyword">return</span> result;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ—¶é—´ $O(n^2)$ï¼Œç©ºé—´ $O(1)$ã€‚é€šè¿‡ç”¨äº† 200msï¼Œ9.2MBã€‚æ—¶é—´ä¸Šåªæˆ˜èƒœäº†29.63%ã€‚ã€‚ã€‚</p><p>Emmmmï¼Œæ¯•ç«Ÿæ˜¯å¾ˆé•¿æ—¶é—´ä¹‹å‰å†™çš„äº†ï¼Œä¸èƒ½è´£å¤‡è¿‡å»çš„è‡ªå·±ï¼Œä½†æ˜¯è¿™ä¸ªæˆç»©å®åœ¨çœ‹ä¸ä¸‹å»äº†ï¼Œé‡æ–°å†™ä¸€ä¸ªå§ã€‚</p><h2 id="å“ˆå¸Œè¡¨"><a href="#å“ˆå¸Œè¡¨" class="headerlink" title="å“ˆå¸Œè¡¨"></a>å“ˆå¸Œè¡¨</h2><p>ç¨å¾®è€ƒè™‘ä¸€ä¸‹ä¸Šé¢çš„æš´åŠ›è§£æ³•ï¼Œæˆ‘ä»¬åšäº†è¿™æ ·çš„ä¸€ä»¶äº‹ï¼šéå†æ•°ç»„ï¼Œæ‰¾æœ‰æ²¡æœ‰å’Œå½“å‰å…ƒç´ å¯¹åº”çš„è¡¥ï¼Œæ‰¾åˆ°å°±è¿”å›å½“å‰å…ƒç´ å’Œä»–çš„è¡¥çš„ç´¢å¼•ï¼Œæ²¡æ‰¾åˆ°å°±ç»§ç»­ã€‚</p><p>å†…éƒ¨çš„é‚£ä¸ªå¾ªç¯å°±æ˜¯ç”¨æ¥æ‰¾ <code>nums</code> ä¸­æœ‰æ²¡æœ‰ä¸€ä¸ª <code>nums[i]</code> çš„è¡¥ï¼Œå³ç­‰äº <code>target - nums[i]</code> çš„å…ƒç´ ã€‚</p><p>æ—¢ç„¶æ˜¯è¦ä»ä¸€å †ä¸œè¥¿é‡Œå¿«é€Ÿæ‰¾ä¸€ä¸ªæ˜ç¡®çš„ï¼Œé‚£å°±ä¸Šå“ˆå¸Œè¡¨å˜›ã€‚ç©ºé—´å¤æ‚åº¦åŠ ä¸ª $n$ï¼Œæ¢æ¥æ—¶é—´ä¸Šå‡ä¸ª $n$ï¼Œå°±è¿™ä¸ªé—®é¢˜æ¥è¯´è¿˜è¡Œå§ã€‚</p><p>Golang å®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">twoSum</span><span class="params">(nums []<span class="keyword">int</span>, target <span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">    numsMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">        cmpl := target - nums[i]</span><br><span class="line">        <span class="keyword">if</span> v, ok := numsMap[cmpl]; ok &#123;</span><br><span class="line">            <span class="keyword">return</span> []<span class="keyword">int</span>&#123;v, i&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        numsMap[nums[i]] = i</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> []<span class="keyword">int</span>&#123;<span class="number">-1</span>, <span class="number">-1</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå°±å‹‰å¼ºçœ‹å¾—è¿‡å»äº†ï¼Œæ—¶é—´ $O(n)$ï¼Œç©ºé—´ $O(n)$ã€‚é€šè¿‡ç”¨äº† 4msã€3.8MBã€‚æ—¶é—´ä¸Šæˆ˜èƒœäº† 96.76%ã€ç©ºé—´æ˜¯ 44.82%ï¼Œï¼Œï¼Œè¿˜è¡Œã€‚</p><hr><p>å“ˆï¼Œçœ‹äº†ä¸€çœ¼å®˜æ–¹é¢˜è§£ï¼Œä¸Šè¿°ä¸¤ä¸ªè§£æ³•åˆšå¥½æ˜¯é¢˜è§£çš„ç¬¬ä¸€ä¸ªæ–¹æ³•å’Œæœ€åä¸€ä¸ªæ–¹æ³•ã€‚</p><p>å…¶å®æˆ‘å†™å“ˆå¸Œè¡¨çš„æ—¶å€™å·®ç‚¹å†™æˆäº†å®˜æ–¹é¢˜è§£çš„<em>æ–¹æ³•äºŒ</em>ï¼Œå…ˆæ„å»ºä¸€å¼ å®Œæ•´çš„è¡¨å†æ‰¾ç¬¦åˆçš„ä¸¤æ•°ï¼Œåæ¥å‘ç°å®ƒè¿™ä¸ªé¢˜ç›®è¯´ï¼š</p><blockquote><p>æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆã€‚ä½†æ˜¯ï¼Œä½ ä¸èƒ½é‡å¤åˆ©ç”¨è¿™ä¸ªæ•°ç»„ä¸­åŒæ ·çš„å…ƒç´ ã€‚</p></blockquote><p>å…ˆæ„å»ºä¸€å¼ è¡¨å‡ºæ¥æˆ‘è·‘äº†ä¸€ä¸‹æ‰§è¡Œä¼šæœ‰é‡å¤ğŸ˜‚ï¼Œkeyå·²ç»æœ‰äº†çš„æ—¶å€™ï¼Œä¼šæ›´æ–°å€¼å˜›ï¼Œç¢°åˆ°è¾“å…¥ <code>[1, 1, 1], target=2</code>ï¼Œè¿™ç§å°±ä¼šè¿”å› <code>[2, 2]</code>ï¼Œç‚¸äº†ã€‚</p><p>è¦é¿å…è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åƒé¢˜è§£é‡Œæ–¹æ³•äºŒé‚£ç§ã€‚ä½†è¿˜å¯ä»¥æ›´å¥½ï¼Œå°±æœ‰ç‚¹ç±»ä¼¼ä¸åŠ¨è§„é‚£ç§æ„Ÿè§‰å˜›ï¼Œæ”¾ä¸€ä¸ª for é‡Œè¿­ä»£ï¼Œæœ‰äº†è¿”å›ï¼Œæ²¡æœ‰å†æ›´æ–°è¡¨å°±å¥½äº†â€”â€”å®ç°å°±æ˜¯ä¸Šé¢å†™çš„ç¬¬äºŒç‰ˆæœ¬ä»£ç ã€‚</p><h2 id="æœ€çŸ­ä»£ç è§£æ³•ï¼ˆJust-for-funï¼‰"><a href="#æœ€çŸ­ä»£ç è§£æ³•ï¼ˆJust-for-funï¼‰" class="headerlink" title="æœ€çŸ­ä»£ç è§£æ³•ï¼ˆJust for funï¼‰"></a>æœ€çŸ­ä»£ç è§£æ³•ï¼ˆJust for funï¼‰</h2><p>æ—¢ç„¶æ˜¯ leetcode çš„ç¬¬ä¸€é“é¢˜ï¼Œæˆ‘è§‰å¾—æˆ‘ä»¬åº”è¯¥å¯ä»¥ç”¨æ›´å°‘çš„ä»£ç æ¥å®Œæˆå®ƒã€‚</p><p>è™½ç„¶ä¸æƒ³ <a href="https://blog.csdn.net/u012419550/article/details/104402182">P26</a>ã€<a href="https://blog.csdn.net/u012419550/article/details/104411279">P27</a> é‚£ç§å¯ä»¥ç›´æ¥ä¸€è¡Œä»£ç è§£å†³ï¼Œä½†æˆ‘æƒ³åˆ°äº†ä¸€ä¸ªæ¯”è¾ƒæœ‰è¶£çš„ 4 è¡Œä»£ç çš„ Python3 è§£æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">twoSum</span>(<span class="params">self, nums: List[<span class="built_in">int</span>], target: <span class="built_in">int</span></span>) -&gt; List[int]:</span></span><br><span class="line">        <span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(nums):</span><br><span class="line">            cis = [nums.index(c) <span class="keyword">for</span> c <span class="keyword">in</span> nums <span class="keyword">if</span> c == target - v]</span><br><span class="line">            <span class="keyword">if</span> cis <span class="keyword">and</span> cis[-<span class="number">1</span>] <span class="keyword">is</span> <span class="keyword">not</span> i:</span><br><span class="line">                <span class="keyword">return</span> [i, cis[-<span class="number">1</span>]]</span><br></pre></td></tr></table></figure><blockquote><p>è¡Œç”¨æ—¶ :4972 ms, åœ¨æ‰€æœ‰ Python3 æäº¤ä¸­å‡»è´¥äº†17.35%çš„ç”¨æˆ·</p><p>å†…å­˜æ¶ˆè€— :29.6 MB, åœ¨æ‰€æœ‰ Python3 æäº¤ä¸­å‡»è´¥äº†5.04%çš„ç”¨æˆ·</p></blockquote><p>ä½ å¯èƒ½è¯´ç”¨ä½ ç”¨ Python æä¸€ä¸ªæš´åŠ›è§£æ³•ä¹Ÿæ˜¯ 4 è¡Œä»£ç ï¼Œä½†æ˜¯ï¼Œæˆ‘è§‰å¾—ç”¨åˆ—è¡¨ç”Ÿæˆå™¨æ›´å¯çˆ±ğŸ˜•ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> School </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»€ä¹ˆï¼Ÿå¯¼è‡´æˆ‘leetcodeè¶…æ—¶çš„ä¸æ˜¯ç®—æ³•æ˜¯å¹¶å‘ï¼Ÿ</title>
      <link href="/2020/02/15/blog/goroutines_cause_leetcode_timeout/"/>
      <url>/2020/02/15/blog/goroutines_cause_leetcode_timeout/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆï¼Ÿå¯¼è‡´æˆ‘leetcodeè¶…æ—¶çš„ä¸æ˜¯ç®—æ³•æ˜¯å¹¶å‘ï¼Ÿ"><a href="#ä»€ä¹ˆï¼Ÿå¯¼è‡´æˆ‘leetcodeè¶…æ—¶çš„ä¸æ˜¯ç®—æ³•æ˜¯å¹¶å‘ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆï¼Ÿå¯¼è‡´æˆ‘leetcodeè¶…æ—¶çš„ä¸æ˜¯ç®—æ³•æ˜¯å¹¶å‘ï¼Ÿ"></a>ä»€ä¹ˆï¼Ÿå¯¼è‡´æˆ‘leetcodeè¶…æ—¶çš„ä¸æ˜¯ç®—æ³•æ˜¯å¹¶å‘ï¼Ÿ</h1><p>ï¼ˆæˆ‘å†™è¿™ç¯‡æ–‡ç« çœŸçš„åªæ˜¯ä¸ºäº†<strong>æ‰“å‘æ—¶é—´</strong>ï¼Œå†…å®¹ä¸¥é‡<em>é€»è¾‘ä¸æ¸…</em>ï¼Œæ—¢<em>ä¸æ˜“æ‡‚</em>ä¹Ÿ<em>ä¸æ·±å…¥</em>ï¼Œæˆ‘ä¸è®¤ä¸ºè¿™ç¯‡æ–‡ç« å…·æœ‰é˜…è¯»ä»·å€¼ï¼Œæ‰€ä»¥çœ‹åˆ°è¿™é‡Œå°±å¯ä»¥<strong>æŠŠå®ƒå…³æ‰</strong>äº†ï¼ï¼‰</p><h2 id="é—®é¢˜çš„æå‡º"><a href="#é—®é¢˜çš„æå‡º" class="headerlink" title="é—®é¢˜çš„æå‡º"></a>é—®é¢˜çš„æå‡º</h2><p>Emmmmï¼Œæˆ‘å¾ˆä¹…å¾ˆä¹…ï¼ˆå¿«åŠå¹´äº†å§ï¼‰æ²¡æœ‰åˆ·è¿‡é¢˜äº†ï¼Œæ˜¨å¤©æ™šä¸Šæ— èŠå°±æ‰“å¼€äº† leetcode éšä¾¿å†™äº†ä¸€é“é¢˜ï¼š</p><blockquote><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œæ‰¾åˆ° s ä¸­æœ€é•¿çš„å›æ–‡å­ä¸²ã€‚ä½ å¯ä»¥å‡è®¾ s çš„æœ€å¤§é•¿åº¦ä¸º 1000ã€‚</p><p>ç¤ºä¾‹ 1ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: &quot;babad&quot;</span><br><span class="line">è¾“å‡º: &quot;bab&quot;</span><br><span class="line">æ³¨æ„: &quot;aba&quot; ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰æ•ˆç­”æ¡ˆã€‚</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ 2ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: &quot;cbbd&quot;</span><br><span class="line">è¾“å‡º: &quot;bb&quot;</span><br></pre></td></tr></table></figure><p>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>é“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/longest-palindromic-substring">https://leetcode-cn.com/problems/longest-palindromic-substring</a><br>è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p></blockquote><p>emmmmï¼Œé¦–å…ˆçš„æƒ³æ³•æ˜¯<strong>åŠ¨è§„</strong>ï¼Œæˆ‘ä¸€èˆ¬éƒ½ä¸çˆ±ç”¨åŠ¨è§„ï¼Œç©ºé—´æ¶ˆè€—å¤§ã€‚åšäº†é‚£ä¹ˆä¹…å¼€å‘å†å›æ¥çœ‹ç®—æ³•ï¼Œå°±è§‰å¾—ï¼Œæ—¶é—´ç¨å¾®æ…¢ç‚¹å¯ä»¥ç­‰ï¼Œå†…å­˜ä¸€æ»¡å°±å½»åº•ç‚¸äº†ã€‚</p><p>ç„¶åï¼Œæˆ‘æƒ³åˆ°äº†æœ€é•¿å…¬å…±å­ä¸²ï¼ŒæŠŠè¿™ä¸ªå­—ç¬¦ä¸²å’Œå®ƒçš„åä¸²æ±‚ä¸€ä¸ªæœ€é•¿å…¬å…±å­ä¸²å°±æ˜¯æœ€é•¿å›æ–‡å­ä¸²äº†ã€‚ã€‚ã€‚æœ€é•¿å…¬å…±å­ä¸²åˆæ˜¯åŠ¨è§„ã€‚ğŸ˜ </p><p>ä¸æƒ³ç”¨åŠ¨è§„ï¼Œåˆä¸é½¿äºæš´åŠ›ï¼Œé‚£å°±ç¡¬å†™å§ã€‚</p><p>æˆ‘çš„æ€è·¯æ˜¯éå†ä¸€æ¬¡å­—ç¬¦ä¸²ï¼Œå°è¯•ä»¥æ¯ä¸ªå­—ç¬¦ä¸ºå›æ–‡ä¸­å¿ƒï¼Œå°½é‡å»å¾€ä¸¤è¾¹â€œæ‹“å±•â€ï¼Œå¾—åˆ°ä»¥æ¯ä¸ªå­—ç¬¦ä¸ºä¸­å¿ƒçš„æœ€é•¿å›æ–‡ä¸²ï¼Œå–è¿™äº›æ‹“å±•å¾—çš„å›æ–‡ä¸²ä¸­æœ€é•¿çš„è¾“å‡ºã€‚</p><p>æˆ‘è¿™ä¸ªæ€è·¯æ—¶é—´åº”è¯¥ä¹Ÿè®¸å¤§æ¦‚æ˜¯ $O(n^2)$ å§ï¼ˆé¢“åºŸåˆ°è¿è¿™ä¸ªéƒ½ä¸ä¼šç®—äº†ğŸ˜­ï¼‰ï¼›ç©ºé—´å¯èƒ½æ¯”è¾ƒå¥½ï¼Œéƒ½æ˜¯è°ƒæ•´æŒ‡é’ˆçš„å€¼ï¼Œ$O(1)$ å§ã€‚</p><p>ç„¶åï¼Œæˆ‘å‡†å¤‡å¼€å§‹å†™ä»£ç ï¼Œçªç„¶æ„è¯†åˆ°å›æ–‡æœ‰ä¸¤ï¼ç§ï¼æƒ…ï¼å†µï¼</p><ul><li>ç¬¬ä¸€ç§ï¼Œå½¢å¦‚ <code>aba</code>ï¼Œä¸­å¿ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ <code>b</code>ï¼›</li><li>ç¬¬äºŒç§ï¼Œå½¢å¦‚ <code>abba</code>ï¼Œä¸­å¿ƒåœ¨ä¸¤ä¸ªå­—ç¬¦ <code>b</code> ä¹‹é—´ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥çœ‹ä½œä¸­å¿ƒæ˜¯ä¸¤ä¸ªå­—ç¬¦ <code>bb</code></li></ul><p>æ‰€ä»¥ï¼Œéå†å­—ç¬¦ä¸²æ—¶ï¼Œæ¯ä¸ªè¿­ä»£è¦æ‹“å±•ä¸¤æ¬¡ï¼Œä¸€æ¬¡æ˜¯ä»¥å½“å‰å­—ç¬¦ä¸ºä¸­å¿ƒï¼ˆ<code>aba</code> å‹ï¼‰ï¼Œä¸€æ¬¡æ˜¯ä»¥å½“å‰å­—ç¬¦+åä¸€ä¸ªå­—ç¬¦ä¸ºä¸­å¿ƒï¼ˆ<code>abba</code> å‹ï¼‰ã€‚</p><p>Golang å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">longestPalindrome</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> s == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line"><span class="keyword">return</span> s</span><br><span class="line">&#125;</span><br><span class="line">b := []<span class="keyword">byte</span>(s)</span><br><span class="line">l, r := <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(b); i++ &#123;</span><br><span class="line">laba := ext(b, i, i)</span><br><span class="line">labba := ext(b, i, i+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> m <span class="keyword">int</span></span><br><span class="line"><span class="keyword">if</span> laba &gt; labba &#123;</span><br><span class="line">m = laba</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">m = labba</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> m &gt; r-l+<span class="number">1</span> &#123;</span><br><span class="line">l = i - (m<span class="number">-1</span>)/<span class="number">2</span></span><br><span class="line">r = i + m/<span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">string</span>(b[l : r+<span class="number">1</span>])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ext</span><span class="params">(b []<span class="keyword">byte</span>, l, r <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> l &gt;= <span class="number">0</span> &amp;&amp; r &lt; <span class="built_in">len</span>(b) &amp;&amp; b[l] == b[r] &#123;</span><br><span class="line">l--</span><br><span class="line">r++</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> r - l - <span class="number">1</span> <span class="comment">// r - l + 1 - 2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æäº¤è·‘ä¸€ä¸‹ï¼Œ4msï¼ˆå‡»è´¥91.02%ï¼‰ï¼Œ2.3MBï¼ˆå‡»è´¥49.75%ï¼‰ã€‚</p><p>emmmï¼Œæˆ‘ä¸ç†è§£ä¸ºä»€ä¹ˆç©ºé—´å ç”¨è¿™ä¹ˆé«˜ï¼Œä¼ å‚åˆ°æ—¶å€™ Golang é‡Œçš„ <code>[]byte</code> åº”è¯¥æ˜¯ä¼ äº†å¼•ç”¨å‘€ï¼ˆå¯ä»¥ç†è§£æˆä¹Ÿå°±æ˜¯ä¼ æŒ‡é’ˆï¼‰ï¼Œå…¶ä»–çš„åŸºæœ¬éƒ½æ˜¯ <code>int</code> äº†ï¼Œæˆ‘æš‚æ—¶æƒ³ä¸åˆ°å¥½åŠæ³•ç»§ç»­åœ¨ç©ºé—´ä¸Šåšä¼˜åŒ–ã€‚</p><p>æ‰€ä»¥æˆ‘è€ƒè™‘äº†ä¸€ä¸‹èƒ½ä¸èƒ½åœ¨æ—¶é—´ä¸Šæ›´è¿›ä¸€æ­¥ã€‚è€ƒè™‘è¿™ä¸€æ®µä»£ç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">laba := ext(b, i, i)</span><br><span class="line">labba := ext(b, i, i+<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>å°±æ˜¯åˆ†åˆ«è®¡ç®— <code>aba</code> å‹å’Œ <code>abba</code> å‹çš„å›æ–‡æ‹“å±•ã€‚å…ˆç®—å®Œä¸€ä¸ªï¼Œå†ç®—å¦ä¸€ä¸ªï¼Œæˆ‘æƒ³è¿™é‡Œä¼šæ¯”è¾ƒè€—æ—¶ã€‚å¦‚æœè®©ä»–ä»¬åŒæ—¶ç®—ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><p>è¯•è¯•çœ‹ï¼Œä¸»è¦çš„æ”¹åŠ¨å°±æ˜¯å¼€ä¸¤ä¸ª goroutine å»æ‰§è¡Œè¿™ä¸¤ä¸ªå‡½æ•°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ext</span><span class="params">(b []<span class="keyword">byte</span>, l, r <span class="keyword">int</span>, cl <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> l &gt;= <span class="number">0</span> &amp;&amp; r &lt; <span class="built_in">len</span>(b) &amp;&amp; b[l] == b[r] &#123;</span><br><span class="line">l--;</span><br><span class="line">r++;</span><br><span class="line">&#125;</span><br><span class="line">cl &lt;- r - l <span class="number">-1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">longestPalindrome</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> s == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line"><span class="keyword">return</span> s</span><br><span class="line">&#125;</span><br><span class="line">b := []<span class="keyword">byte</span>(s )</span><br><span class="line">l, r := <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(b); i++ &#123;</span><br><span class="line">        </span><br><span class="line">cl1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">cl2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> ext(b, i, i, cl1)</span><br><span class="line"><span class="keyword">go</span> ext(b, i, i+<span class="number">1</span>, cl2)</span><br><span class="line"></span><br><span class="line">laba := &lt;- cl1</span><br><span class="line">labba := &lt;- cl2</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> m <span class="keyword">int</span></span><br><span class="line"><span class="keyword">if</span> laba &gt; labba &#123;</span><br><span class="line">m = laba</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">m = labba</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> m &gt; r - l + <span class="number">1</span> &#123;</span><br><span class="line">l = i - (m - <span class="number">1</span>) / <span class="number">2</span></span><br><span class="line">r = i + m / <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">string</span>(b[l: r + <span class="number">1</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æäº¤ï¼ŒğŸ˜±ğŸ˜±ğŸ˜±ï¼Œ40msï¼Œ6.2MBï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p><p>æˆ‘ä»¥ä¸ºé—®é¢˜å‡ºåœ¨è¿™é‡Œï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">laba := &lt;- cl1</span><br><span class="line">labba := &lt;- cl2</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯å…ˆé˜»å¡åœ¨ <code>laba</code> è¿™é‡Œç­‰ <code>cl1</code> ä¼ å‡ºæ¥ï¼Œç„¶åå†ç­‰ <code>cl2</code> å‡ºæ¥ã€‚ä¸‡ä¸€ <code>cl2</code> å…ˆç®—å®Œå‡ºæ¥äº†ï¼Œè¿˜æ˜¯è¦é˜»å¡åˆ° <code>cl1</code> å‡ºæ¥ï¼Œå¯èƒ½è¿™é‡Œè€—æ—¶äº†ã€‚æ‰€ä»¥å†æ”¹ä¸€ä¸‹ <code>longestPalindrome</code>çš„ç­–ç•¥ï¼Œç”¨ä¸€ä¸ª <code>for-select</code>ï¼š</p><p><code>select</code> ä¸èƒ½ <code>fallthrough</code>ï¼Œæ‰€ä»¥ä¸ºäº†åŠæ—¶ breakï¼Œå‡å°‘ä¸€æ¬¡é˜»å¡æŠŠæ¯ä¸ª <code>case</code> é‡Œéƒ½å†™äº†é€€å‡ºåˆ¤æ–­ï¼Œæ¶å¿ƒäº†ä¸€ç‚¹ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">longestPalindrome</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> s == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line"><span class="keyword">return</span> s</span><br><span class="line">&#125;</span><br><span class="line">b := []<span class="keyword">byte</span>(s )</span><br><span class="line">l, r := <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(b); i++ &#123;</span><br><span class="line"><span class="comment">// laba := ext(b, i, i)</span></span><br><span class="line"><span class="comment">// labba := ext(b, i, i+1)</span></span><br><span class="line">cl1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">cl2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> ext(b, i, i, cl1)</span><br><span class="line"><span class="keyword">go</span> ext(b, i, i+<span class="number">1</span>, cl2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> laba <span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> labba <span class="keyword">int</span></span><br><span class="line">cnt := <span class="number">0</span></span><br><span class="line">LOOP:<span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> laba = &lt;- cl1:</span><br><span class="line">cnt++</span><br><span class="line"><span class="keyword">if</span> (cnt &gt;= <span class="number">2</span>) &#123;</span><br><span class="line"><span class="keyword">break</span> LOOP</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> labba = &lt;- cl2:</span><br><span class="line">cnt++</span><br><span class="line"><span class="keyword">if</span> (cnt &gt;= <span class="number">2</span>) &#123;</span><br><span class="line"><span class="keyword">break</span> LOOP</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">if</span> (cnt &gt;= <span class="number">2</span>) &#123;</span><br><span class="line"><span class="keyword">break</span> LOOP</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> m <span class="keyword">int</span></span><br><span class="line"><span class="keyword">if</span> laba &gt; labba &#123;</span><br><span class="line">m = laba</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">m = labba</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> m &gt; r - l + <span class="number">1</span> &#123;</span><br><span class="line">l = i - (m - <span class="number">1</span>) / <span class="number">2</span></span><br><span class="line">r = i + m / <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">string</span>(b[l: r + <span class="number">1</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æäº¤ï¼Œåº”è¯¥ä¼šå¿«ä¸€ç‚¹å§ï¼Œç»“æœæ˜¯â€”â€”<strong>è¶…ã€‚å‡ºã€‚æ—¶ã€‚é—´ã€‚é™ã€‚åˆ¶</strong>ã€‚è€Œä¸”è¶…çš„è¿˜å¾ˆå¤šï¼Œåªè¿‡äº†22ä¸ªæµ‹è¯•ç”¨ä¾‹ã€‚</p><p>æˆ‘å“­äº†ï¼Œå¹¶å‘äº†ä¸æ˜¯åº”è¯¥æ›´å¿«å—ï¼Ÿæ˜¯ leetcode çš„é”…å§ã€‚</p><p>è¿˜æ˜¯åœ¨æœ¬åœ°æµ‹è¯•ä¸€ä¸‹å§ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">s := []<span class="keyword">string</span>&#123;<span class="string">&quot;babad&quot;</span>, <span class="string">&quot;cbbd&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;aa&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;aaaa&quot;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++ &#123;</span><br><span class="line">longestPalindrome(s[i%<span class="number">7</span>])</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éšä¾¿æå‡ ä¸ªä¾‹å­å¾ªç¯ç€è·‘10000æ¬¡ï¼Œ<code>$ time go run</code> çœ‹ä¸€ä¸‹ã€‚</p><p>ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼ˆä¸å¹¶å‘ï¼‰:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">real    0m0.246s</span><br><span class="line">user    0m0.216s</span><br><span class="line">sys     0m0.137s</span><br></pre></td></tr></table></figure><p>æœ€åä¸€ä¸ªç‰ˆæœ¬ï¼ˆ<code>for-select</code>ï¼‰:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">real    0m1.005s</span><br><span class="line">user    0m1.036s</span><br><span class="line">sys     0m0.518s</span><br></pre></td></tr></table></figure><p>\æ‹æ¡Œ è¿˜çœŸçš„æ˜¯å¹¶å‘å¯¼è‡´äº†æ…¢å•Šï¼</p><p>ä½†æ˜¯ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p><h2 id="é—®é¢˜çš„åˆ†æ"><a href="#é—®é¢˜çš„åˆ†æ" class="headerlink" title="é—®é¢˜çš„åˆ†æ"></a>é—®é¢˜çš„åˆ†æ</h2><p>ä¸ºäº†ç ”ç©¶è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æŠŠåˆšæ‰ä¸‰ä¸ªç‰ˆæœ¬çš„ä»£ç éƒ½ç®€åŒ–ä¸€ä¸‹ï¼š</p><p>v1ï¼Œä¸å¹¶å‘ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// v1.go</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;math/rand&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">somethingCost</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="comment">// time.Sleep(time.Duration(rand.Intn(10)) * time.Millisecond)</span></span><br><span class="line">time.Sleep(<span class="number">1</span> * time.Millisecond)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">rand.Seed(time.Now().UnixNano())</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">foo := somethingCost()</span><br><span class="line">bar := somethingCost()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> foo == bar &#123;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>v2ï¼Œå¹¶å‘ï¼Œé˜»å¡åœ¨ç¬¬ä¸€ä¸ª channelï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// v2.go</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;math/rand&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">somethingCost</span><span class="params">(ch <span class="keyword">chan</span> <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line"><span class="comment">// time.Sleep(time.Duration(rand.Intn(10)) * time.Millisecond)</span></span><br><span class="line">time.Sleep(<span class="number">1</span> * time.Millisecond)</span><br><span class="line">ch &lt;- <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">rand.Seed(time.Now().UnixNano())</span><br><span class="line"></span><br><span class="line">ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>)</span><br><span class="line">ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line"><span class="keyword">go</span> somethingCost(ch1)</span><br><span class="line"><span class="keyword">go</span> somethingCost(ch2)</span><br><span class="line"></span><br><span class="line">foo := &lt;-ch1</span><br><span class="line">bar := &lt;-ch2</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> foo == bar &#123;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>v3ï¼Œè¿ç”¨ <code>select</code>ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// v3.go</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;math/rand&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">somethingCost</span><span class="params">(ch <span class="keyword">chan</span> <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line"><span class="comment">// time.Sleep(time.Duration(rand.Intn(10)) * time.Millisecond)</span></span><br><span class="line">time.Sleep(<span class="number">1</span> * time.Millisecond)</span><br><span class="line">ch &lt;- <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">rand.Seed(time.Now().UnixNano())</span><br><span class="line"></span><br><span class="line">ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>)</span><br><span class="line">ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">cnt := <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> somethingCost(ch1)</span><br><span class="line"><span class="keyword">go</span> somethingCost(ch2)</span><br><span class="line"></span><br><span class="line">LOOP:</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> &lt;-ch1:</span><br><span class="line">cnt++</span><br><span class="line"><span class="keyword">case</span> &lt;-ch2:</span><br><span class="line">cnt++</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">if</span> cnt &gt;= <span class="number">2</span> &#123;</span><br><span class="line"><span class="keyword">break</span> LOOP</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é¦–å…ˆåœ¨ <code>somethingCost</code> é‡Œç¡çœ äº†ç›¸åŒçš„æ—¶é—´ï¼Œæ¥æ¨¡æ‹Ÿæ‰§è¡Œä¸€ä¸ªæ…¢é€Ÿä»»åŠ¡ï¼Œè¿è¡Œä»£ç å¾—åˆ°ç±»ä¼¼å¦‚ä¸‹çš„ç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ time go run v1.go</span><br><span class="line"></span><br><span class="line">real    0m0.553s</span><br><span class="line">user    0m0.204s</span><br><span class="line">sys     0m0.159s</span><br><span class="line"></span><br><span class="line">$ time go run v2.go</span><br><span class="line"></span><br><span class="line">real    0m0.379s</span><br><span class="line">user    0m0.182s</span><br><span class="line">sys     0m0.135s</span><br><span class="line"></span><br><span class="line">$ time go run v3.go</span><br><span class="line"></span><br><span class="line">real    0m0.362s</span><br><span class="line">user    0m0.314s</span><br><span class="line">sys     0m0.138s</span><br></pre></td></tr></table></figure><blockquote><p>ã€è¡¥å……ã€‘realæ—¶é—´ã€useræ—¶é—´å’Œsysæ—¶é—´ã€‚</p><ul><li>realæ—¶é—´æ˜¯æŒ‡æŒ‚é’Ÿæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯å‘½ä»¤å¼€å§‹æ‰§è¡Œåˆ°ç»“æŸçš„æ—¶é—´ã€‚è¿™ä¸ªçŸ­æ—¶é—´åŒ…æ‹¬å…¶ä»–è¿›ç¨‹æ‰€å ç”¨çš„æ—¶é—´ç‰‡ï¼Œå’Œè¿›ç¨‹è¢«é˜»å¡æ—¶æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚</li><li>useræ—¶é—´æ˜¯æŒ‡è¿›ç¨‹èŠ±è´¹åœ¨ç”¨æˆ·æ¨¡å¼ä¸­çš„CPUæ—¶é—´ï¼Œè¿™æ˜¯å”¯ä¸€çœŸæ­£ç”¨äºæ‰§è¡Œè¿›ç¨‹æ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œå…¶ä»–è¿›ç¨‹å’ŒèŠ±è´¹é˜»å¡çŠ¶æ€ä¸­çš„æ—¶é—´æ²¡æœ‰è®¡ç®—åœ¨å†…ã€‚</li><li>sysæ—¶é—´æ˜¯æŒ‡èŠ±è´¹åœ¨å†…æ ¸æ¨¡å¼ä¸­çš„CPUæ—¶é—´ï¼Œä»£è¡¨åœ¨å†…æ ¸ä¸­æ‰§ç³»ç»Ÿè°ƒç”¨æ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œè¿™ä¹Ÿæ˜¯çœŸæ­£ç”±è¿›ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´ã€‚</li></ul><p>å‚è€ƒï¼š Linuxå‘½ä»¤å¤§å…¨. timeå‘½ä»¤[OL].<a href="https://man.linuxde.net/time">https://man.linuxde.net/time</a>, 2020</p></blockquote><p>ç”¨<strong>ç‰©ç†å®éªŒ</strong>çš„æ–¹æ³•ï¼Œå¤šæ¬¡é‡å¤å®éªŒï¼Œå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p><p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gbx40vkouzj30u00xxtd1.jpg" alt="å±å¹•å¿«ç…§ 2020-02-15 15.18.22"></p><p> <img src="https://tva1.sinaimg.cn/large/0082zybpgy1gbx415ayr5j30tu0yo78f.jpg" alt="å±å¹•å¿«ç…§ 2020-02-15 15.18.33"></p><p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gbx419iuzqj30tw0ysq77.jpg" alt="å±å¹•å¿«ç…§ 2020-02-15 15.18.40"></p><blockquote><p>ã€æ³¨ã€‘å®éªŒç¯å¢ƒï¼š</p><ul><li><p>Computer: MacBook Pro (13-inch, 2017, Two Thunderbolt 3 ports)</p></li><li><p>CPU: 2.3 GHz Intel Core i5</p></li><li><p>RAM: 8 GB 2133 MHz LPDDR3</p></li><li><p>OS: macOS Mojave 10.14.6</p></li><li><p>Golang: go version go1.12 darwin/amd64</p></li></ul></blockquote><p>å®éªŒæ¬¡æ•°å°‘ï¼Œæ•°æ®ä¸å¤ªå¥½ï¼Œä¸ç®¡äº†ï¼Œæˆ‘æ‡’å¾—æå¤§è§„æ¨¡çš„å®éªŒï¼ˆå…¶å®æˆ‘åªæ˜¯è¾¹ç ”ç©¶è¾¹å†™è¿™ç¯‡æ–‡ç« æ‰“å‘æ—¶é—´ï¼‰ã€‚</p><p>ä»å®éªŒçš„ç»“æœæ¥çœ‹ï¼Œæœ‰ä¸¤ç‚¹æ¯”è¾ƒè‚¯å®šï¼š</p><ol><li>Real æ—¶é—´ä¸Šï¼Œv3 ç•¥ä¼˜äº v2 ä¼˜äº v1</li><li>User æ—¶é—´ä¸Šï¼Œv1 çº¦ç­‰äº v2 ä¼˜äº v3</li></ol><p>ç”±æ­¤ï¼Œå¯ä»¥æ¨çŸ¥ï¼š</p><ol><li>åœ¨ç°å®ç¯å¢ƒï¼ˆæ­£å¸¸çš„å¤šæ ¸è®¡ç®—æœºï¼‰ä½¿ç”¨ä¸­ï¼Œå¦‚ v3 ç‰ˆæœ¬çš„ç¨‹åºï¼Œä½¿ç”¨ <code>goroutine-for-select</code> çš„æ–¹æ¡ˆå¯ä»¥è¿è¡Œå¾—æ¯”è¾ƒå¿«ï¼ˆreal timeï¼Œä¸ä¸å¹¶å‘ç›¸æ¯”ï¼‰ï¼Œä½†åœ¨ç­‰å¾…è¿”å›çš„ channel ä¸å¤šæ—¶ä¸ä¸ä½¿ç”¨ <code>for-select</code> åŒºåˆ«ä¸å¤§ã€‚</li><li>åœ¨ goroutine å’Œ channel æ¯”è¾ƒå°‘çš„æ—¶å€™ä½¿ç”¨ <code>for-select</code> çš„ç­–ç•¥ï¼Œè¿›ç¨‹æ‰€èŠ±è´¹çš„æ—¶é—´ï¼ˆuser timeï¼‰ä¼šæ˜æ˜¾åŠ å¤§ã€‚</li></ol><p>æ³¨æ„ï¼Œæ˜¯åœ¨ goroutine å’Œ channel æ¯”è¾ƒå°‘çš„æ—¶å€™ v2 çš„ user time ä¼˜äº v3ã€‚å½“æˆ‘ä»¬å¢å¤š goroutineï¼Œæ¯”å¦‚å¼€åˆ° 1000 ä¸ªï¼Œç»“æœå°±ä¸ä¸€æ ·äº†ï¼ˆæˆ‘ä¸æƒ³ç”¨ v1 ä¾æ¬¡æ‰§è¡Œ1000æ¬¡å‡½æ•°ï¼Œç»“æœå¯æƒ³è€ŒçŸ¥ï¼Œæ²¡æœ‰å¯æ¯”æ€§äº†ï¼‰ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ time <span class="keyword">go</span> run v2.<span class="keyword">go</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">real</span>    <span class="number">0</span>m5<span class="number">.824</span>s</span><br><span class="line">user    <span class="number">0</span>m8<span class="number">.036</span>s</span><br><span class="line">sys     <span class="number">0</span>m3<span class="number">.967</span>s</span><br><span class="line"></span><br><span class="line">$ time <span class="keyword">go</span> run v3.<span class="keyword">go</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">real</span>    <span class="number">0</span>m1<span class="number">.919</span>s</span><br><span class="line">user    <span class="number">0</span>m3<span class="number">.006</span>s</span><br><span class="line">sys     <span class="number">0</span>m0<span class="number">.244</span>s</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œåœ¨æ…¢é€Ÿä»»åŠ¡æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œä½¿ç”¨ç±»ä¼¼äº v3 çš„ <code>for-select</code> ä¼šå¤§å¹…åº¦æé«˜æ•ˆç‡ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹å¦‚æœä»»åŠ¡é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œä¾‹å¦‚æˆ‘ä»¬ç›´æ¥æŠŠ Sleep æ³¨é‡Šæ‰ï¼Œç„¶åå¼€æœ€å¤–å±‚çš„å¾ªç¯æ¬¡åŠ åˆ°100æ¬¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ time go run v1.go</span><br><span class="line"></span><br><span class="line">real    0m0.302s</span><br><span class="line">user    0m0.168s</span><br><span class="line">sys     0m0.127s</span><br><span class="line"></span><br><span class="line">$ time go run v2.go</span><br><span class="line"></span><br><span class="line">real    0m0.373s</span><br><span class="line">user    0m0.198s</span><br><span class="line">sys     0m0.149s</span><br><span class="line"></span><br><span class="line">$ time go run v3.go</span><br><span class="line"></span><br><span class="line">real    0m0.353s</span><br><span class="line">user    0m0.301s</span><br><span class="line">sys     0m0.142s</span><br></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸‹ v2ã€ v3 å°±æ˜¾å¾—æ²¡æœ‰ä¼˜åŠ¿äº†ï¼Œè¿™æ—¶å¤šçº¿ç¨‹ä¸Šä¸‹åˆåˆ‡æ¢ç­‰ç­‰çš„å¼€æ”¯ä¼šé€ æˆæ¯”è¾ƒå¤§çš„é¢å¤–å¼€æ”¯ï¼Œå¯¼è‡´æ•´ä½“è¿è¡Œæ•ˆç‡ä½ä¸‹ã€‚è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬æäº¤åˆ° leetcode çš„ä»£ç è¶…æ—¶çš„é—®é¢˜æ‰€åœ¨ã€‚</p><h2 id="é—®é¢˜çš„æ€»ç»“"><a href="#é—®é¢˜çš„æ€»ç»“" class="headerlink" title="é—®é¢˜çš„æ€»ç»“"></a>é—®é¢˜çš„æ€»ç»“</h2><p>è¿™ä¸ªæ•…äº‹å‘Šè¯‰æˆ‘ä»¬ï¼Œä¸è¦åœ¨éœ€è¦å¹¶å‘çš„ä»»åŠ¡å°‘ï¼Œé€šä¿¡ä¸å¤æ‚çš„æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚åˆ· leetcode çš„ç®—æ³•é¢˜ï¼‰å°è¯•ä½¿ç”¨å¤„ç†é«˜å¹¶å‘çš„æ‰‹æ®µï¼Œå¼‚æ­¥çš„æ–¹æ³•è¿˜æ˜¯ç”¨æ¥å¤„ç†æ¯”è¾ƒæ…¢çš„ä»»åŠ¡æ¯”è¾ƒå¥½ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>golang-å¹¶å‘</title>
      <link href="/2020/02/07/Golang/go-5-Concurrency/"/>
      <url>/2020/02/07/Golang/go-5-Concurrency/</url>
      
        <content type="html"><![CDATA[<h2 id="å¹¶å‘"><a href="#å¹¶å‘" class="headerlink" title="å¹¶å‘"></a>å¹¶å‘</h2><h3 id="Go-ç¨‹"><a href="#Go-ç¨‹" class="headerlink" title="Go ç¨‹"></a>Go ç¨‹</h3><p>Go ç¨‹ï¼ˆgoroutineï¼‰æ˜¯ç”± Go è¿è¡Œæ—¶ç®¡ç†çš„è½»é‡çº§çº¿ç¨‹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go f(x, y, z)</span><br></pre></td></tr></table></figure><p>ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„ Go ç¨‹å¹¶æ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f(x, y, z)</span><br></pre></td></tr></table></figure><p><code>f</code>, <code>x</code>, <code>y</code> å’Œ <code>z</code> çš„æ±‚å€¼å‘ç”Ÿåœ¨å½“å‰çš„ Go ç¨‹ä¸­ï¼Œè€Œ <code>f</code> çš„æ‰§è¡Œå‘ç”Ÿåœ¨æ–°çš„ Go ç¨‹ä¸­ã€‚</p><p>Go ç¨‹åœ¨ç›¸åŒçš„åœ°å€ç©ºé—´ä¸­è¿è¡Œï¼Œå› æ­¤åœ¨è®¿é—®å…±äº«çš„å†…å­˜æ—¶å¿…é¡»è¿›è¡ŒåŒæ­¥ã€‚<a href="https://golang.org/pkg/sync/"><code>sync</code></a> åŒ…æä¾›äº†è¿™ç§èƒ½åŠ›ï¼Œä¸è¿‡åœ¨ Go ä¸­å¹¶ä¸ç»å¸¸ç”¨åˆ°ï¼Œå› ä¸ºè¿˜æœ‰å…¶å®ƒçš„åŠæ³•ï¼ˆè§ä¸‹ä¸€èŠ‚ï¼‰ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">say</span><span class="params">(s <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">time.Sleep(<span class="number">100</span> * time.Millisecond)</span><br><span class="line">fmt.Println(s)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">go</span> say(<span class="string">&quot;world&quot;</span>)</span><br><span class="line">say(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hello</span><br><span class="line">world</span><br><span class="line">hello</span><br><span class="line">world</span><br><span class="line">world</span><br><span class="line">hello</span><br><span class="line">hello</span><br><span class="line">world</span><br><span class="line">hello</span><br></pre></td></tr></table></figure><h3 id="ä¿¡é“"><a href="#ä¿¡é“" class="headerlink" title="ä¿¡é“"></a>ä¿¡é“</h3><p>ä¿¡é“æ˜¯å¸¦æœ‰ç±»å‹çš„ç®¡é“ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒç”¨ä¿¡é“æ“ä½œç¬¦ <code>&lt;-</code> æ¥å‘é€æˆ–è€…æ¥æ”¶å€¼ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ch &lt;- v    &#x2F;&#x2F; å°† v å‘é€è‡³ä¿¡é“ chã€‚</span><br><span class="line">v :&#x3D; &lt;-ch  &#x2F;&#x2F; ä» ch æ¥æ”¶å€¼å¹¶èµ‹äºˆ vã€‚</span><br></pre></td></tr></table></figure><p>ï¼ˆâ€œç®­å¤´â€å°±æ˜¯æ•°æ®æµçš„æ–¹å‘ã€‚ï¼‰</p><p>å’Œæ˜ å°„ä¸åˆ‡ç‰‡ä¸€æ ·ï¼Œä¿¡é“åœ¨ä½¿ç”¨å‰å¿…é¡»åˆ›å»ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ch :&#x3D; make(chan int)</span><br></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå‘é€å’Œæ¥æ”¶æ“ä½œåœ¨å¦ä¸€ç«¯å‡†å¤‡å¥½ä¹‹å‰éƒ½ä¼šé˜»å¡ã€‚è¿™ä½¿å¾— Go ç¨‹å¯ä»¥åœ¨æ²¡æœ‰æ˜¾å¼çš„é”æˆ–ç«æ€å˜é‡çš„æƒ…å†µä¸‹è¿›è¡ŒåŒæ­¥ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹å¯¹åˆ‡ç‰‡ä¸­çš„æ•°è¿›è¡Œæ±‚å’Œï¼Œå°†ä»»åŠ¡åˆ†é…ç»™ä¸¤ä¸ª Go ç¨‹ã€‚ä¸€æ—¦ä¸¤ä¸ª Go ç¨‹å®Œæˆäº†å®ƒä»¬çš„è®¡ç®—ï¼Œå®ƒå°±èƒ½ç®—å‡ºæœ€ç»ˆçš„ç»“æœã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(s []<span class="keyword">int</span>, c <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">sum := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> _, v := <span class="keyword">range</span> s &#123;</span><br><span class="line">sum += v</span><br><span class="line">&#125;</span><br><span class="line">c &lt;- sum <span class="comment">// å°†å’Œé€å…¥ c</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">s := []<span class="keyword">int</span>&#123;<span class="number">7</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">-9</span>, <span class="number">4</span>, <span class="number">0</span>&#125;</span><br><span class="line"></span><br><span class="line">c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"><span class="keyword">go</span> sum(s[:<span class="built_in">len</span>(s)/<span class="number">2</span>], c)</span><br><span class="line"><span class="keyword">go</span> sum(s[<span class="built_in">len</span>(s)/<span class="number">2</span>:], c)</span><br><span class="line">x, y := &lt;-c, &lt;-c <span class="comment">// ä» c ä¸­æ¥æ”¶</span></span><br><span class="line"></span><br><span class="line">fmt.Println(x, y, x+y)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¸¦ç¼“å†²çš„ä¿¡é“"><a href="#å¸¦ç¼“å†²çš„ä¿¡é“" class="headerlink" title="å¸¦ç¼“å†²çš„ä¿¡é“"></a>å¸¦ç¼“å†²çš„ä¿¡é“</h4><p>ä¿¡é“å¯ä»¥æ˜¯ <em>å¸¦ç¼“å†²çš„</em>ã€‚å°†ç¼“å†²é•¿åº¦ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°æä¾›ç»™ <code>make</code> æ¥åˆå§‹åŒ–ä¸€ä¸ªå¸¦ç¼“å†²çš„ä¿¡é“ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ch :&#x3D; make(chan int, 100)</span><br></pre></td></tr></table></figure><p>ä»…å½“ä¿¡é“çš„ç¼“å†²åŒºå¡«æ»¡åï¼Œå‘å…¶å‘é€æ•°æ®æ—¶æ‰ä¼šé˜»å¡ã€‚å½“ç¼“å†²åŒºä¸ºç©ºæ—¶ï¼Œæ¥å—æ–¹ä¼šé˜»å¡ã€‚</p><p>ä¿®æ”¹ç¤ºä¾‹å¡«æ»¡ç¼“å†²åŒºï¼Œç„¶åçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">2</span>)</span><br><span class="line">ch &lt;- <span class="number">1</span></span><br><span class="line">ch &lt;- <span class="number">2</span></span><br><span class="line">fmt.Println(&lt;-ch)</span><br><span class="line">fmt.Println(&lt;-ch)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç´§è·Ÿ <code>ch &lt;- 2</code> åŠ ä¸€è¡Œ <code>ch &lt;- 3</code> ä¼šæŠ›å‡º <code>fatal error: all goroutines are asleep - deadlock!</code>ã€‚</p><h3 id="range-å’Œ-close"><a href="#range-å’Œ-close" class="headerlink" title="range å’Œ close"></a>range å’Œ close</h3><p>å‘é€è€…å¯é€šè¿‡ <code>close</code> å…³é—­ä¸€ä¸ªä¿¡é“æ¥è¡¨ç¤ºæ²¡æœ‰éœ€è¦å‘é€çš„å€¼äº†ã€‚æ¥æ”¶è€…å¯ä»¥é€šè¿‡ä¸ºæ¥æ”¶è¡¨è¾¾å¼åˆ†é…ç¬¬äºŒä¸ªå‚æ•°æ¥æµ‹è¯•ä¿¡é“æ˜¯å¦è¢«å…³é—­ï¼šè‹¥æ²¡æœ‰å€¼å¯ä»¥æ¥æ”¶ä¸”ä¿¡é“å·²è¢«å…³é—­ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œå®Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v, ok :&#x3D; &lt;-ch</span><br></pre></td></tr></table></figure><p>ä¹‹å <code>ok</code> ä¼šè¢«è®¾ç½®ä¸º <code>false</code>ã€‚</p><p>å¾ªç¯ <code>for i := range c</code> ä¼šä¸æ–­ä»ä¿¡é“æ¥æ”¶å€¼ï¼Œç›´åˆ°å®ƒè¢«å…³é—­ã€‚å¦‚æœä¸€ç›´ä¸å…³é—­ä¿¡é“ï¼Œfor range è¿™é‡Œä¼šå‡ºç° <code>fatal error: all goroutines are asleep - deadlock!</code>ã€‚</p><p><strong>æ³¨æ„</strong>ï¼š åªæœ‰å‘é€è€…æ‰èƒ½å…³é—­ä¿¡é“ï¼Œè€Œæ¥æ”¶è€…ä¸èƒ½ã€‚å‘ä¸€ä¸ªå·²ç»å…³é—­çš„ä¿¡é“å‘é€æ•°æ®ä¼šå¼•å‘ç¨‹åºææ…Œï¼ˆpanicï¼‰ã€‚</p><p><strong>è¿˜è¦æ³¨æ„</strong>ï¼š ä¿¡é“ä¸æ–‡ä»¶ä¸åŒï¼Œé€šå¸¸æƒ…å†µä¸‹æ— éœ€å…³é—­å®ƒä»¬ã€‚åªæœ‰åœ¨å¿…é¡»å‘Šè¯‰æ¥æ”¶è€…ä¸å†æœ‰éœ€è¦å‘é€çš„å€¼æ—¶æ‰æœ‰å¿…è¦å…³é—­ï¼Œä¾‹å¦‚ç»ˆæ­¢ä¸€ä¸ª <code>range</code> å¾ªç¯ã€‚ </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fibonacci</span><span class="params">(n <span class="keyword">int</span>, c <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">x, y := <span class="number">0</span>, <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">c &lt;- x</span><br><span class="line">x, y = y, x+y</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">close</span>(c)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line"><span class="keyword">go</span> fibonacci(<span class="built_in">cap</span>(c), c)</span><br><span class="line"><span class="keyword">for</span> i := <span class="keyword">range</span> c &#123;</span><br><span class="line">fmt.Println(i)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">5</span><br><span class="line">8</span><br><span class="line">13</span><br><span class="line">21</span><br><span class="line">34</span><br></pre></td></tr></table></figure><h3 id="select-è¯­å¥"><a href="#select-è¯­å¥" class="headerlink" title="select è¯­å¥"></a>select è¯­å¥</h3><p><code>select</code> è¯­å¥ä½¿ä¸€ä¸ª Go ç¨‹å¯ä»¥ç­‰å¾…å¤šä¸ªé€šä¿¡æ“ä½œã€‚</p><p><code>select</code> ä¼šé˜»å¡åˆ°æŸä¸ªåˆ†æ”¯å¯ä»¥ç»§ç»­æ‰§è¡Œä¸ºæ­¢ï¼Œè¿™æ—¶å°±ä¼šæ‰§è¡Œè¯¥åˆ†æ”¯ã€‚å½“å¤šä¸ªåˆ†æ”¯éƒ½å‡†å¤‡å¥½æ—¶ä¼šéšæœºé€‰æ‹©ä¸€ä¸ªæ‰§è¡Œã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fibonacci</span><span class="params">(c, quit <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">x, y := <span class="number">0</span>, <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> c &lt;- x:</span><br><span class="line">x, y = y, x+y</span><br><span class="line"><span class="keyword">case</span> &lt;-quit:</span><br><span class="line">fmt.Println(<span class="string">&quot;quit&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">quit := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">fmt.Println(&lt;-c)</span><br><span class="line">&#125;</span><br><span class="line">quit &lt;- <span class="number">0</span></span><br><span class="line">&#125;()</span><br><span class="line">fibonacci(c, quit)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">5</span><br><span class="line">8</span><br><span class="line">13</span><br><span class="line">21</span><br><span class="line">34</span><br><span class="line">quit</span><br></pre></td></tr></table></figure><h4 id="é»˜è®¤é€‰æ‹©"><a href="#é»˜è®¤é€‰æ‹©" class="headerlink" title="é»˜è®¤é€‰æ‹©"></a>é»˜è®¤é€‰æ‹©</h4><p>å½“ <code>select</code> ä¸­çš„å…¶å®ƒåˆ†æ”¯éƒ½æ²¡æœ‰å‡†å¤‡å¥½æ—¶ï¼Œ<code>default</code> åˆ†æ”¯å°±ä¼šæ‰§è¡Œã€‚</p><p>ä¸ºäº†åœ¨å°è¯•å‘é€æˆ–è€…æ¥æ”¶æ—¶ä¸å‘ç”Ÿé˜»å¡ï¼Œå¯ä½¿ç”¨ <code>default</code> åˆ†æ”¯ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> i := &lt;-c:</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ i</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="comment">// ä» c ä¸­æ¥æ”¶ä¼šé˜»å¡æ—¶æ‰§è¡Œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">tick := time.Tick(<span class="number">100</span> * time.Millisecond)</span><br><span class="line">boom := time.After(<span class="number">500</span> * time.Millisecond)</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> &lt;-tick:</span><br><span class="line">fmt.Println(<span class="string">&quot;tick.&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> &lt;-boom:</span><br><span class="line">fmt.Println(<span class="string">&quot;BOOM!&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">fmt.Println(<span class="string">&quot;    .&quot;</span>)</span><br><span class="line">time.Sleep(<span class="number">50</span> * time.Millisecond)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">tick.</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">tick.</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">tick.</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">tick.</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">tick.</span><br><span class="line">BOOM!</span><br></pre></td></tr></table></figure><h3 id="ç»ƒä¹ ï¼šç­‰ä»·äºŒå‰æŸ¥æ‰¾æ ‘"><a href="#ç»ƒä¹ ï¼šç­‰ä»·äºŒå‰æŸ¥æ‰¾æ ‘" class="headerlink" title="ç»ƒä¹ ï¼šç­‰ä»·äºŒå‰æŸ¥æ‰¾æ ‘"></a>ç»ƒä¹ ï¼šç­‰ä»·äºŒå‰æŸ¥æ‰¾æ ‘</h3><p>ä¸åŒäºŒå‰æ ‘çš„å¶èŠ‚ç‚¹ä¸Šå¯ä»¥ä¿å­˜ç›¸åŒçš„å€¼åºåˆ—ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ä¸¤ä¸ªäºŒå‰æ ‘éƒ½ä¿å­˜äº†åºåˆ— <code>1ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ5ï¼Œ8ï¼Œ13</code>ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/0082zybpgy1gbo70c7fd7j30dn0513ym.jpg" alt="img"></p><p>åœ¨å¤§å¤šæ•°è¯­è¨€ä¸­ï¼Œæ£€æŸ¥ä¸¤ä¸ªäºŒå‰æ ‘æ˜¯å¦ä¿å­˜äº†ç›¸åŒåºåˆ—çš„å‡½æ•°éƒ½ç›¸å½“å¤æ‚ã€‚ æˆ‘ä»¬å°†ä½¿ç”¨ Go çš„å¹¶å‘å’Œä¿¡é“æ¥ç¼–å†™ä¸€ä¸ªç®€å•çš„è§£æ³•ã€‚</p><p>æœ¬ä¾‹ä½¿ç”¨äº† <code>tree</code> åŒ…ï¼Œå®ƒå®šä¹‰äº†ç±»å‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">type Tree struct &#123;</span><br><span class="line">    Left  *Tree</span><br><span class="line">    Value int</span><br><span class="line">    Right *Tree</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>TODOï¼š</p><p><strong>1.</strong> å®ç° <code>Walk</code> å‡½æ•°ã€‚</p><p><strong>2.</strong> æµ‹è¯• <code>Walk</code> å‡½æ•°ã€‚</p><p>å‡½æ•° <code>tree.New(k)</code> ç”¨äºæ„é€ ä¸€ä¸ªéšæœºç»“æ„çš„å·²æ’åºäºŒå‰æŸ¥æ‰¾æ ‘ï¼Œå®ƒä¿å­˜äº†å€¼ <code>k</code>, <code>2k</code>, <code>3k</code>, â€¦, <code>10k</code>ã€‚</p><p>åˆ›å»ºä¸€ä¸ªæ–°çš„ä¿¡é“ <code>ch</code> å¹¶ä¸”å¯¹å…¶è¿›è¡Œæ­¥è¿›ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go Walk(tree.New(1), ch)</span><br></pre></td></tr></table></figure><p>ç„¶åä»ä¿¡é“ä¸­è¯»å–å¹¶æ‰“å° 10 ä¸ªå€¼ã€‚åº”å½“æ˜¯æ•°å­— <code>1, 2, 3, ..., 10</code>ã€‚</p><p><strong>3.</strong> ç”¨ <code>Walk</code> å®ç° <code>Same</code> å‡½æ•°æ¥æ£€æµ‹ <code>t1</code> å’Œ <code>t2</code> æ˜¯å¦å­˜å‚¨äº†ç›¸åŒçš„å€¼ã€‚</p><p><strong>4.</strong> æµ‹è¯• <code>Same</code> å‡½æ•°ã€‚</p><p><code>Same(tree.New(1), tree.New(1))</code> åº”å½“è¿”å› <code>true</code>ï¼Œè€Œ <code>Same(tree.New(1), tree.New(2))</code> åº”å½“è¿”å› <code>false</code>ã€‚</p><p><code>Tree</code> çš„æ–‡æ¡£å¯åœ¨<a href="https://godoc.org/golang.org/x/tour/tree#Tree">è¿™é‡Œ</a>æ‰¾åˆ°ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;./tree&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Walk æ­¥è¿› tree t å°†æ‰€æœ‰çš„å€¼ä» tree å‘é€åˆ° channel chã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Walk</span><span class="params">(t *tree.Tree, ch <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> t != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="comment">// Note: ä¸èƒ½ go Walk â€œé€’å½’â€ï¼</span></span><br><span class="line">Walk(t.Left, ch)</span><br><span class="line">ch &lt;- t.Value</span><br><span class="line">Walk(t.Right, ch)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Same æ£€æµ‹æ ‘ t1 å’Œ t2 æ˜¯å¦å«æœ‰ç›¸åŒçš„å€¼ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Same</span><span class="params">(t1, t2 *tree.Tree)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">c1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line">c2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line"><span class="keyword">go</span> Walk(t1, c1)</span><br><span class="line"><span class="keyword">go</span> Walk(t2, c2)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line"><span class="keyword">if</span> &lt;-c1 != &lt;-c2 &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">testWalk()</span><br><span class="line">testSame()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testWalk</span><span class="params">()</span></span> &#123;</span><br><span class="line">c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line"><span class="keyword">go</span> Walk(tree.New(<span class="number">1</span>), c)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">cap</span>(c); i++ &#123;</span><br><span class="line">fmt.Println(&lt;-c)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testSame</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(Same(tree.New(<span class="number">1</span>), tree.New(<span class="number">1</span>)))</span><br><span class="line">fmt.Println(Same(tree.New(<span class="number">1</span>), tree.New(<span class="number">2</span>)))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">true</span><br><span class="line">false</span><br></pre></td></tr></table></figure><p>P.S. æŠŠæ ‘çš„èŠ‚ç‚¹æ•°å¢åŠ åˆ°10000000ï¼Œåœ¨åŒä¸€æœºå™¨ä¸Šï¼Œæ‰§è¡ŒåŒæ ·çš„testSameå‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨ goç¨‹ï¼Œæ¯”ä¸ä½¿ç”¨è¦å¿«ä¸Šä¸€äº›ï¼ˆæˆ‘çš„ä¸ä½¿ç”¨goç¨‹çš„å®ç°æ˜¯æŠŠä¿¡é“æ”¹ä¸ºç”¨<code>*[]int</code>ä¼ é€’æ•°æ®ï¼‰ï¼š</p><p>ä½¿ç”¨Goç¨‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">real1m4.306s</span><br><span class="line">user1m20.332s</span><br><span class="line">sys0m1.277s</span><br></pre></td></tr></table></figure><p>ä¸ä½¿ç”¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">real1m7.141s</span><br><span class="line">user1m24.107s</span><br><span class="line">sys0m1.851s</span><br></pre></td></tr></table></figure><h3 id="sync-Mutex"><a href="#sync-Mutex" class="headerlink" title="sync.Mutex"></a>sync.Mutex</h3><p>æˆ‘ä»¬å·²ç»çœ‹åˆ°ä¿¡é“éå¸¸é€‚åˆåœ¨å„ä¸ª Go ç¨‹é—´è¿›è¡Œé€šä¿¡ã€‚</p><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬å¹¶ä¸éœ€è¦é€šä¿¡å‘¢ï¼Ÿæ¯”å¦‚è¯´ï¼Œè‹¥æˆ‘ä»¬åªæ˜¯æƒ³ä¿è¯æ¯æ¬¡åªæœ‰ä¸€ä¸ª Go ç¨‹èƒ½å¤Ÿè®¿é—®ä¸€ä¸ªå…±äº«çš„å˜é‡ï¼Œä»è€Œé¿å…å†²çªï¼Ÿ</p><p>è¿™é‡Œæ¶‰åŠçš„æ¦‚å¿µå«åš <em>äº’æ–¥</em>ï¼ˆmutual exclusionï¼‰ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ <em>äº’æ–¥é”</em>ï¼ˆMutexï¼‰è¿™ä¸€æ•°æ®ç»“æ„æ¥æä¾›è¿™ç§æœºåˆ¶ã€‚</p><p>Go æ ‡å‡†åº“ä¸­æä¾›äº† <a href="https://golang.org/pkg/sync/#Mutex"><code>sync.Mutex</code></a> äº’æ–¥é”ç±»å‹åŠå…¶ä¸¤ä¸ªæ–¹æ³•ï¼š</p><ul><li><code>Lock</code></li><li><code>Unlock</code></li></ul><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ä»£ç å‰è°ƒç”¨ <code>Lock</code> æ–¹æ³•ï¼Œåœ¨ä»£ç åè°ƒç”¨ <code>Unlock</code> æ–¹æ³•æ¥ä¿è¯ä¸€æ®µä»£ç çš„äº’æ–¥æ‰§è¡Œã€‚å‚è§ä¸‹ä¾‹ <code>Inc</code> æ–¹æ³•ã€‚</p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ <code>defer</code> è¯­å¥æ¥ä¿è¯äº’æ–¥é”ä¸€å®šä¼šè¢«è§£é”ã€‚å‚è§ä¸‹ä¾‹ <code>Value</code> æ–¹æ³•ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;sync&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// SafeCounter çš„å¹¶å‘ä½¿ç”¨æ˜¯å®‰å…¨çš„ã€‚</span></span><br><span class="line"><span class="keyword">type</span> SafeCounter <span class="keyword">struct</span> &#123;</span><br><span class="line">v   <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span></span><br><span class="line">mux sync.Mutex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Inc å¢åŠ ç»™å®š key çš„è®¡æ•°å™¨çš„å€¼ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SafeCounter)</span> <span class="title">Inc</span><span class="params">(key <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">c.mux.Lock()</span><br><span class="line"><span class="comment">// Lock ä¹‹ååŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ª goroutine èƒ½è®¿é—® c.v</span></span><br><span class="line">c.v[key]++</span><br><span class="line">c.mux.Unlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Value è¿”å›ç»™å®š key çš„è®¡æ•°å™¨çš„å½“å‰å€¼ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SafeCounter)</span> <span class="title">Value</span><span class="params">(key <span class="keyword">string</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">c.mux.Lock()</span><br><span class="line"><span class="comment">// Lock ä¹‹ååŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ª goroutine èƒ½è®¿é—® c.v</span></span><br><span class="line"><span class="keyword">defer</span> c.mux.Unlock()</span><br><span class="line"><span class="keyword">return</span> c.v[key]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">c := SafeCounter&#123;v: <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>)&#125;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line"><span class="keyword">go</span> c.Inc(<span class="string">&quot;somekey&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">time.Sleep(time.Second)</span><br><span class="line">fmt.Println(c.Value(<span class="string">&quot;somekey&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1000</span><br></pre></td></tr></table></figure><h3 id="ç»ƒä¹ ï¼šWeb-çˆ¬è™«"><a href="#ç»ƒä¹ ï¼šWeb-çˆ¬è™«" class="headerlink" title="ç»ƒä¹ ï¼šWeb çˆ¬è™«"></a>ç»ƒä¹ ï¼šWeb çˆ¬è™«</h3><p>åœ¨è¿™ä¸ªç»ƒä¹ ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šä½¿ç”¨ Go çš„å¹¶å‘ç‰¹æ€§æ¥å¹¶è¡ŒåŒ–ä¸€ä¸ª Web çˆ¬è™«ã€‚</p><p>ä¿®æ”¹ <code>Crawl</code> å‡½æ•°æ¥å¹¶è¡Œåœ°æŠ“å– URLï¼Œå¹¶ä¸”ä¿è¯ä¸é‡å¤ã€‚</p><p><em>æç¤º</em>ï¼šä½ å¯ä»¥ç”¨ä¸€ä¸ª map æ¥ç¼“å­˜å·²ç»è·å–çš„ URLï¼Œä½†æ˜¯è¦æ³¨æ„ map æœ¬èº«å¹¶ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;sync&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Fetcher <span class="keyword">interface</span> &#123;</span><br><span class="line"><span class="comment">// Fetch è¿”å› URL çš„ body å†…å®¹ï¼Œå¹¶ä¸”å°†åœ¨è¿™ä¸ªé¡µé¢ä¸Šæ‰¾åˆ°çš„ URL æ”¾åˆ°ä¸€ä¸ª slice ä¸­ã€‚</span></span><br><span class="line">Fetch(url <span class="keyword">string</span>) (body <span class="keyword">string</span>, urls []<span class="keyword">string</span>, err error)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SafeCrawler <span class="keyword">struct</span> &#123;</span><br><span class="line">fetched <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">bool</span></span><br><span class="line">mux     sync.Mutex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Crawl ä½¿ç”¨ fetcher ä»æŸä¸ª URL å¼€å§‹é€’å½’çš„çˆ¬å–é¡µé¢ï¼Œç›´åˆ°è¾¾åˆ°æœ€å¤§æ·±åº¦ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SafeCrawler)</span> <span class="title">Crawl</span><span class="params">(url <span class="keyword">string</span>, depth <span class="keyword">int</span>, fetcher Fetcher)</span></span> &#123;</span><br><span class="line">c.mux.Lock()</span><br><span class="line"><span class="keyword">defer</span> c.mux.Unlock()</span><br><span class="line"><span class="keyword">if</span> depth &lt;= <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> c.fetched[url] &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c.fetched[url] = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">body, urls, err := fetcher.Fetch(url)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(err)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">&quot;found: %s %q\n&quot;</span>, url, body)</span><br><span class="line"><span class="keyword">for</span> _, u := <span class="keyword">range</span> urls &#123;</span><br><span class="line"><span class="keyword">if</span> !c.fetched[u] &#123;</span><br><span class="line"><span class="keyword">go</span> c.Crawl(u, depth<span class="number">-1</span>, fetcher)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">c := SafeCrawler&#123;fetched: <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">bool</span>)&#125;</span><br><span class="line">c.Crawl(<span class="string">&quot;https://golang.org/&quot;</span>, <span class="number">4</span>, fetcher)</span><br><span class="line">time.Sleep(time.Second)</span><br><span class="line"><span class="comment">// fmt.Println(c.fetched)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// fakeFetcher æ˜¯è¿”å›è‹¥å¹²ç»“æœçš„ Fetcherã€‚</span></span><br><span class="line"><span class="keyword">type</span> fakeFetcher <span class="keyword">map</span>[<span class="keyword">string</span>]*fakeResult</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> fakeResult <span class="keyword">struct</span> &#123;</span><br><span class="line">body <span class="keyword">string</span></span><br><span class="line">urls []<span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f fakeFetcher)</span> <span class="title">Fetch</span><span class="params">(url <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">string</span>, []<span class="keyword">string</span>, error)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> res, ok := f[url]; ok &#123;</span><br><span class="line"><span class="keyword">return</span> res.body, res.urls, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;not found: %s&quot;</span>, url)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// fetcher æ˜¯å¡«å……åçš„ fakeFetcherã€‚</span></span><br><span class="line"><span class="keyword">var</span> fetcher = fakeFetcher&#123;</span><br><span class="line"><span class="string">&quot;https://golang.org/&quot;</span>: &amp;fakeResult&#123;</span><br><span class="line"><span class="string">&quot;The Go Programming Language&quot;</span>,</span><br><span class="line">[]<span class="keyword">string</span>&#123;</span><br><span class="line"><span class="string">&quot;https://golang.org/pkg/&quot;</span>,</span><br><span class="line"><span class="string">&quot;https://golang.org/cmd/&quot;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;https://golang.org/pkg/&quot;</span>: &amp;fakeResult&#123;</span><br><span class="line"><span class="string">&quot;Packages&quot;</span>,</span><br><span class="line">[]<span class="keyword">string</span>&#123;</span><br><span class="line"><span class="string">&quot;https://golang.org/&quot;</span>,</span><br><span class="line"><span class="string">&quot;https://golang.org/cmd/&quot;</span>,</span><br><span class="line"><span class="string">&quot;https://golang.org/pkg/fmt/&quot;</span>,</span><br><span class="line"><span class="string">&quot;https://golang.org/pkg/os/&quot;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;https://golang.org/pkg/fmt/&quot;</span>: &amp;fakeResult&#123;</span><br><span class="line"><span class="string">&quot;Package fmt&quot;</span>,</span><br><span class="line">[]<span class="keyword">string</span>&#123;</span><br><span class="line"><span class="string">&quot;https://golang.org/&quot;</span>,</span><br><span class="line"><span class="string">&quot;https://golang.org/pkg/&quot;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;https://golang.org/pkg/os/&quot;</span>: &amp;fakeResult&#123;</span><br><span class="line"><span class="string">&quot;Package os&quot;</span>,</span><br><span class="line">[]<span class="keyword">string</span>&#123;</span><br><span class="line"><span class="string">&quot;https://golang.org/&quot;</span>,</span><br><span class="line"><span class="string">&quot;https://golang.org/pkg/&quot;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">found: https:&#x2F;&#x2F;golang.org&#x2F; &quot;The Go Programming Language&quot;</span><br><span class="line">not found: https:&#x2F;&#x2F;golang.org&#x2F;cmd&#x2F;</span><br><span class="line">found: https:&#x2F;&#x2F;golang.org&#x2F;pkg&#x2F; &quot;Packages&quot;</span><br><span class="line">found: https:&#x2F;&#x2F;golang.org&#x2F;pkg&#x2F;os&#x2F; &quot;Package os&quot;</span><br><span class="line">found: https:&#x2F;&#x2F;golang.org&#x2F;pkg&#x2F;fmt&#x2F; &quot;Package fmt&quot;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang-æ–¹æ³•å’Œæ¥å£</title>
      <link href="/2020/02/07/Golang/go-4-MethodsInterfaces/"/>
      <url>/2020/02/07/Golang/go-4-MethodsInterfaces/</url>
      
        <content type="html"><![CDATA[<h2 id="æ–¹æ³•å’Œæ¥å£"><a href="#æ–¹æ³•å’Œæ¥å£" class="headerlink" title="æ–¹æ³•å’Œæ¥å£"></a>æ–¹æ³•å’Œæ¥å£</h2><h3 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h3><p>Go æ²¡æœ‰ç±»ã€‚ä¸è¿‡ä½ å¯ä»¥ä¸ºç»“æ„ä½“ç±»å‹å®šä¹‰æ–¹æ³•ã€‚</p><p>æ–¹æ³•å°±æ˜¯ä¸€ç±»å¸¦ç‰¹æ®Šçš„ <strong>æ¥æ”¶è€…</strong> å‚æ•°çš„å‡½æ•°ã€‚</p><p>æ–¹æ³•æ¥æ”¶è€…åœ¨å®ƒè‡ªå·±çš„å‚æ•°åˆ—è¡¨å†…ï¼Œä½äº <code>func</code> å…³é”®å­—å’Œæ–¹æ³•åä¹‹é—´ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">X, Y <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Vertex)</span> <span class="title">Abs</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> math.Sqrt(v.X*v.X + v.Y*v.Y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">v := Vertex&#123;<span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">fmt.Println(v.Abs())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5</span><br></pre></td></tr></table></figure><p>åœ¨æ­¤ä¾‹ä¸­ï¼Œ<code>Abs</code> æ–¹æ³•æ‹¥æœ‰ä¸€ä¸ªåä¸º <code>v</code>ï¼Œç±»å‹ä¸º <code>Vertex</code> çš„æ¥æ”¶è€…ã€‚</p><h4 id="æ–¹æ³•å³å‡½æ•°"><a href="#æ–¹æ³•å³å‡½æ•°" class="headerlink" title="æ–¹æ³•å³å‡½æ•°"></a>æ–¹æ³•å³å‡½æ•°</h4><p>è®°ä½ï¼šæ–¹æ³•åªæ˜¯ä¸ªå¸¦æ¥æ”¶è€…å‚æ•°çš„å‡½æ•°ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">X, Y <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Abs</span><span class="params">(v Vertex)</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> math.Sqrt(v.X*v.X + v.Y*v.Y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">v := Vertex&#123;<span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">fmt.Println(Abs(v))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­ä¸­ <code>Abs</code> çš„å†™æ³•å°±æ˜¯ä¸ªæ­£å¸¸çš„å‡½æ•°ï¼ŒåŠŸèƒ½å¹¶æ²¡æœ‰ä»€ä¹ˆå˜åŒ–ã€‚</p><h4 id="æ–¹æ³•ï¼ˆç»­ï¼‰"><a href="#æ–¹æ³•ï¼ˆç»­ï¼‰" class="headerlink" title="æ–¹æ³•ï¼ˆç»­ï¼‰"></a>æ–¹æ³•ï¼ˆç»­ï¼‰</h4><p>ä½ ä¹Ÿå¯ä»¥ä¸ºéç»“æ„ä½“ç±»å‹å£°æ˜æ–¹æ³•ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyFloat <span class="keyword">float64</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f MyFloat)</span> <span class="title">Abs</span><span class="params">()</span> <span class="title">MyFloat</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> f &lt; <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> -f</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> f</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">f := MyFloat(-math.Sqrt2)</span><br><span class="line">fmt.Println(f.Abs())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.4142135623730951</span><br></pre></td></tr></table></figure><p>åœ¨æ­¤ä¾‹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ªå¸¦ <code>Abs</code> æ–¹æ³•çš„æ•°å€¼ç±»å‹ <code>MyFloat</code>ã€‚</p><p>ä½ åªèƒ½ä¸ºåœ¨åŒä¸€åŒ…å†…å®šä¹‰çš„ç±»å‹çš„æ¥æ”¶è€…å£°æ˜æ–¹æ³•ï¼Œè€Œä¸èƒ½ä¸ºå…¶å®ƒåŒ…å†…å®šä¹‰çš„ç±»å‹ï¼ˆåŒ…æ‹¬ <code>int</code> ä¹‹ç±»çš„å†…å»ºç±»å‹ï¼‰çš„æ¥æ”¶è€…å£°æ˜æ–¹æ³•ã€‚</p><p>ï¼ˆè¯‘æ³¨ï¼šå°±æ˜¯æ¥æ”¶è€…çš„ç±»å‹å®šä¹‰å’Œæ–¹æ³•å£°æ˜å¿…é¡»åœ¨åŒä¸€åŒ…å†…ï¼›ä¸èƒ½ä¸ºå…¶ä»–åŒ…ä¸­å£°æ˜çš„ç±»å‹å£°æ˜æ–¹æ³•ã€‚ï¼‰</p><h4 id="æŒ‡é’ˆæ¥æ”¶è€…"><a href="#æŒ‡é’ˆæ¥æ”¶è€…" class="headerlink" title="æŒ‡é’ˆæ¥æ”¶è€…"></a>æŒ‡é’ˆæ¥æ”¶è€…</h4><p>ä½ å¯ä»¥ä¸ºæŒ‡é’ˆæ¥æ”¶è€…å£°æ˜æ–¹æ³•ã€‚</p><p>è¿™æ„å‘³ç€å¯¹äºæŸç±»å‹ <code>T</code>ï¼Œæ¥æ”¶è€…çš„ç±»å‹å¯ä»¥ç”¨ <code>*T</code> çš„æ–‡æ³•ã€‚ï¼ˆæ­¤å¤–ï¼Œ<code>T</code> ä¸èƒ½æ˜¯åƒ <code>*int</code>è¿™æ ·çš„æŒ‡é’ˆã€‚ï¼‰</p><p>ä¾‹å¦‚ï¼Œè¿™é‡Œä¸º <code>*Vertex</code> å®šä¹‰äº† <code>Scale</code> æ–¹æ³•ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">X, Y <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Vertex)</span> <span class="title">Abs</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> math.Sqrt(v.X*v.X + v.Y*v.Y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *Vertex)</span> <span class="title">Scale</span><span class="params">(f <span class="keyword">float64</span>)</span></span> &#123;</span><br><span class="line">v.X = v.X * f</span><br><span class="line">v.Y = v.Y * f</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">v := Vertex&#123;<span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">v.Scale(<span class="number">10</span>)</span><br><span class="line">fmt.Println(v.Abs())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">50</span><br></pre></td></tr></table></figure><p>æŒ‡é’ˆæ¥æ”¶è€…çš„æ–¹æ³•å¯ä»¥ä¿®æ”¹æ¥æ”¶è€…æŒ‡å‘çš„å€¼ï¼ˆå°±åƒ <code>Scale</code> åœ¨è¿™åšçš„ï¼‰ã€‚ç”±äºæ–¹æ³•ç»å¸¸éœ€è¦ä¿®æ”¹å®ƒçš„æ¥æ”¶è€…ï¼ŒæŒ‡é’ˆæ¥æ”¶è€…æ¯”å€¼æ¥æ”¶è€…æ›´å¸¸ç”¨ã€‚</p><p>è¯•ç€ç§»é™¤ç¬¬ 16 è¡Œ <code>Scale</code> å‡½æ•°å£°æ˜ä¸­çš„ <code>*</code>ï¼Œè§‚å¯Ÿæ­¤ç¨‹åºçš„è¡Œä¸ºå¦‚ä½•å˜åŒ–ã€‚</p><p>è‹¥ä½¿ç”¨å€¼æ¥æ”¶è€…ï¼Œé‚£ä¹ˆ <code>Scale</code> æ–¹æ³•ä¼šå¯¹åŸå§‹ <code>Vertex</code> å€¼çš„å‰¯æœ¬è¿›è¡Œæ“ä½œã€‚ï¼ˆå¯¹äºå‡½æ•°çš„å…¶å®ƒå‚æ•°ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ï¼‰<code>Scale</code> æ–¹æ³•å¿…é¡»ç”¨æŒ‡é’ˆæ¥å—è€…æ¥æ›´æ”¹ <code>main</code> å‡½æ•°ä¸­å£°æ˜çš„ <code>Vertex</code> çš„å€¼ã€‚</p><h4 id="æŒ‡é’ˆä¸å‡½æ•°"><a href="#æŒ‡é’ˆä¸å‡½æ•°" class="headerlink" title="æŒ‡é’ˆä¸å‡½æ•°"></a>æŒ‡é’ˆä¸å‡½æ•°</h4><p>ç°åœ¨æˆ‘ä»¬è¦æŠŠ <code>Abs</code> å’Œ <code>Scale</code> æ–¹æ³•é‡å†™ä¸ºå‡½æ•°ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">X, Y <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Abs</span><span class="params">(v Vertex)</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> math.Sqrt(v.X*v.X + v.Y*v.Y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Scale</span><span class="params">(v *Vertex, f <span class="keyword">float64</span>)</span></span> &#123;</span><br><span class="line">v.X = v.X * f</span><br><span class="line">v.Y = v.Y * f</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">v := Vertex&#123;<span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">Scale(&amp;v, <span class="number">10</span>)</span><br><span class="line">fmt.Println(Abs(v))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">50</span><br></pre></td></tr></table></figure><p>åŒæ ·ï¼Œæˆ‘ä»¬å…ˆè¯•ç€ç§»é™¤æ‰ç¬¬ 16 è¡Œ <code>Scale</code> å‡½æ•°å£°æ˜ä¸­çš„ <code>*</code>ã€‚å°è¯•ç¼–è¯‘ï¼Œä¼šå¾—åˆ° <code>./src.go:23:8: cannot use &amp;v (type *Vertex) as type Vertex in argument to Scale</code>ï¼ŒæŒ‰ç…§æç¤ºï¼Œæˆ‘ä»¬å†æŠŠ <code>main</code> å‡½æ•°ä¸­ <code>Scale</code> å‡½æ•°çš„è°ƒç”¨é‡Œçš„ <code>&amp;v</code> æ”¹æˆ <code>v</code>ï¼Œå†å°è¯•ç¼–è¯‘ï¼Œé€šè¿‡äº†ï¼Œè¾“å‡ºç»“æœä¸º <code>5</code>ã€‚</p><h4 id="æ–¹æ³•ä¸æŒ‡é’ˆé‡å®šå‘"><a href="#æ–¹æ³•ä¸æŒ‡é’ˆé‡å®šå‘" class="headerlink" title="æ–¹æ³•ä¸æŒ‡é’ˆé‡å®šå‘"></a>æ–¹æ³•ä¸æŒ‡é’ˆé‡å®šå‘</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">X, Y <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *Vertex)</span> <span class="title">Scale</span><span class="params">(f <span class="keyword">float64</span>)</span></span> &#123;</span><br><span class="line">v.X *= f</span><br><span class="line">v.Y *= f</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ScaleFunc</span><span class="params">(v *Vertex, f <span class="keyword">float64</span>)</span></span> &#123;</span><br><span class="line">v.X *= f</span><br><span class="line">v.Y *= f</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">v := Vertex&#123;<span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">v.Scale(<span class="number">2</span>)</span><br><span class="line">ScaleFunc(&amp;v, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">p := &amp;Vertex&#123;<span class="number">4</span>, <span class="number">3</span>&#125;</span><br><span class="line">p.Scale(<span class="number">3</span>)</span><br><span class="line">ScaleFunc(p, <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">fmt.Println(v, p)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;60 80&#125; &amp;&#123;96 72&#125;</span><br></pre></td></tr></table></figure><p>æ¯”è¾ƒå‰ä¸¤ä¸ªç¨‹åºï¼Œä½ å¤§æ¦‚ä¼šæ³¨æ„åˆ°å¸¦æŒ‡é’ˆå‚æ•°çš„å‡½æ•°å¿…é¡»æ¥å—ä¸€ä¸ªæŒ‡é’ˆï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> v Vertex</span><br><span class="line">ScaleFunc(v, <span class="number">5</span>)  <span class="comment">// ç¼–è¯‘é”™è¯¯ï¼</span></span><br><span class="line">ScaleFunc(&amp;v, <span class="number">5</span>) <span class="comment">// OK</span></span><br></pre></td></tr></table></figure><p>è€Œä»¥æŒ‡é’ˆä¸ºæ¥æ”¶è€…çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œæ¥æ”¶è€…æ—¢èƒ½ä¸ºå€¼åˆèƒ½ä¸ºæŒ‡é’ˆï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> v Vertex</span><br><span class="line">v.Scale(<span class="number">5</span>)  <span class="comment">// OK</span></span><br><span class="line">p := &amp;v</span><br><span class="line">p.Scale(<span class="number">10</span>) <span class="comment">// OK</span></span><br></pre></td></tr></table></figure><p>å¯¹äºè¯­å¥ <code>v.Scale(5)</code>ï¼Œå³ä¾¿ <code>v</code> æ˜¯ä¸ªå€¼è€ŒéæŒ‡é’ˆï¼Œå¸¦æŒ‡é’ˆæ¥æ”¶è€…çš„æ–¹æ³•ä¹Ÿèƒ½è¢«ç›´æ¥è°ƒç”¨ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œç”±äº <code>Scale</code> æ–¹æ³•æœ‰ä¸€ä¸ªæŒ‡é’ˆæ¥æ”¶è€…ï¼Œä¸ºæ–¹ä¾¿èµ·è§ï¼ŒGo ä¼šå°†è¯­å¥ <code>v.Scale(5)</code> è§£é‡Šä¸º <code>(&amp;v).Scale(5)</code>ã€‚</p><h4 id="æ–¹æ³•ä¸æŒ‡é’ˆé‡å®šå‘ï¼ˆç»­ï¼‰"><a href="#æ–¹æ³•ä¸æŒ‡é’ˆé‡å®šå‘ï¼ˆç»­ï¼‰" class="headerlink" title="æ–¹æ³•ä¸æŒ‡é’ˆé‡å®šå‘ï¼ˆç»­ï¼‰"></a>æ–¹æ³•ä¸æŒ‡é’ˆé‡å®šå‘ï¼ˆç»­ï¼‰</h4><p>åŒæ ·çš„äº‹æƒ…ä¹Ÿå‘ç”Ÿåœ¨ç›¸åçš„æ–¹å‘ã€‚</p><p>æ¥å—ä¸€ä¸ªå€¼ä½œä¸ºå‚æ•°çš„å‡½æ•°å¿…é¡»æ¥å—ä¸€ä¸ªæŒ‡å®šç±»å‹çš„å€¼ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> v Vertex</span><br><span class="line">fmt.Println(AbsFunc(v))  <span class="comment">// OK</span></span><br><span class="line">fmt.Println(AbsFunc(&amp;v)) <span class="comment">// ç¼–è¯‘é”™è¯¯ï¼</span></span><br></pre></td></tr></table></figure><p>è€Œä»¥å€¼ä¸ºæ¥æ”¶è€…çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œæ¥æ”¶è€…æ—¢èƒ½ä¸ºå€¼åˆèƒ½ä¸ºæŒ‡é’ˆï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> v Vertex</span><br><span class="line">fmt.Println(v.Abs()) <span class="comment">// OK</span></span><br><span class="line">p := &amp;v</span><br><span class="line">fmt.Println(p.Abs()) <span class="comment">// OK</span></span><br></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸‹ï¼Œæ–¹æ³•è°ƒç”¨ <code>p.Abs()</code> ä¼šè¢«è§£é‡Šä¸º <code>(*p).Abs()</code>ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">X, Y <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Vertex)</span> <span class="title">Abs</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> math.Sqrt(v.X*v.X + v.Y*v.Y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AbsFunc</span><span class="params">(v Vertex)</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> math.Sqrt(v.X*v.X + v.Y*v.Y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">v := Vertex&#123;<span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">fmt.Println(v.Abs())</span><br><span class="line">fmt.Println(AbsFunc(v))</span><br><span class="line"></span><br><span class="line">p := &amp;Vertex&#123;<span class="number">4</span>, <span class="number">3</span>&#125;</span><br><span class="line">fmt.Println(p.Abs())</span><br><span class="line">fmt.Println(AbsFunc(*p))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">5</span><br><span class="line">5</span><br><span class="line">5</span><br></pre></td></tr></table></figure><h4 id="é€‰æ‹©å€¼æˆ–æŒ‡é’ˆä½œä¸ºæ¥æ”¶è€…"><a href="#é€‰æ‹©å€¼æˆ–æŒ‡é’ˆä½œä¸ºæ¥æ”¶è€…" class="headerlink" title="é€‰æ‹©å€¼æˆ–æŒ‡é’ˆä½œä¸ºæ¥æ”¶è€…"></a>é€‰æ‹©å€¼æˆ–æŒ‡é’ˆä½œä¸ºæ¥æ”¶è€…</h4><p>ä½¿ç”¨æŒ‡é’ˆæ¥æ”¶è€…çš„åŸå› æœ‰äºŒï¼š</p><ol><li><p>æ–¹æ³•èƒ½å¤Ÿä¿®æ”¹å…¶æ¥æ”¶è€…æŒ‡å‘çš„å€¼ã€‚</p></li><li><p>è¿™æ ·å¯ä»¥é¿å…åœ¨æ¯æ¬¡è°ƒç”¨æ–¹æ³•æ—¶å¤åˆ¶è¯¥å€¼ã€‚è‹¥å€¼çš„ç±»å‹ä¸ºå¤§å‹ç»“æ„ä½“æ—¶ï¼Œè¿™æ ·åšä¼šæ›´åŠ é«˜æ•ˆã€‚</p></li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">X, Y <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *Vertex)</span> <span class="title">Scale</span><span class="params">(f <span class="keyword">float64</span>)</span></span> &#123;</span><br><span class="line">v.X = v.X * f</span><br><span class="line">v.Y = v.Y * f</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *Vertex)</span> <span class="title">Abs</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> math.Sqrt(v.X*v.X + v.Y*v.Y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">v := &amp;Vertex&#123;<span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">fmt.Printf(<span class="string">&quot;Before scaling: %+v, Abs: %v\n&quot;</span>, v, v.Abs())</span><br><span class="line">v.Scale(<span class="number">5</span>)</span><br><span class="line">fmt.Printf(<span class="string">&quot;After scaling: %+v, Abs: %v\n&quot;</span>, v, v.Abs())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Before scaling: &amp;&#123;X:3 Y:4&#125;, Abs: 5</span><br><span class="line">After scaling: &amp;&#123;X:15 Y:20&#125;, Abs: 25</span><br></pre></td></tr></table></figure><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ<code>Scale</code> å’Œ <code>Abs</code> æ¥æ”¶è€…çš„ç±»å‹ä¸º <code>*Vertex</code>ï¼Œå³ä¾¿ <code>Abs</code> å¹¶ä¸éœ€è¦ä¿®æ”¹å…¶æ¥æ”¶è€…ã€‚</p><p>é€šå¸¸æ¥è¯´ï¼Œæ‰€æœ‰ç»™å®šç±»å‹çš„æ–¹æ³•éƒ½åº”è¯¥æœ‰å€¼æˆ–æŒ‡é’ˆæ¥æ”¶è€…ï¼Œä½†å¹¶ä¸åº”è¯¥äºŒè€…æ··ç”¨ã€‚ï¼ˆæˆ‘ä»¬ä¼šåœ¨æ¥ä¸‹æ¥å‡ èŠ‚ä¸­æ˜ç™½ä¸ºä»€ä¹ˆã€‚ï¼‰</p><h3 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h3><p><strong>æ¥å£ç±»å‹</strong> æ˜¯ç”±ä¸€ç»„æ–¹æ³•ç­¾åå®šä¹‰çš„é›†åˆã€‚</p><p>æ¥å£ç±»å‹çš„å˜é‡å¯ä»¥ä¿å­˜ä»»ä½•å®ç°äº†è¿™äº›æ–¹æ³•çš„å€¼ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Abser <span class="keyword">interface</span> &#123;</span><br><span class="line">Abs() <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> a Abser</span><br><span class="line">f := MyFloat(-math.Sqrt2)</span><br><span class="line">v := Vertex&#123;<span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line"></span><br><span class="line">a = f  <span class="comment">// a MyFloat implements Abser</span></span><br><span class="line">a = &amp;v <span class="comment">// a *Vertex implements Abser</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// In the following line, v is a Vertex (not *Vertex)</span></span><br><span class="line"><span class="comment">// and does NOT implement Abser.</span></span><br><span class="line">a = v</span><br><span class="line"></span><br><span class="line">fmt.Println(a.Abs())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyFloat <span class="keyword">float64</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f MyFloat)</span> <span class="title">Abs</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> f &lt; <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">float64</span>(-f)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">float64</span>(f)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">X, Y <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *Vertex)</span> <span class="title">Abs</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> math.Sqrt(v.X*v.X + v.Y*v.Y)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„:</strong> ç¤ºä¾‹ä»£ç çš„ 22 è¡Œå­˜åœ¨ä¸€ä¸ªé”™è¯¯ã€‚ç”±äº <code>Abs</code> æ–¹æ³•åªä¸º <code>*Vertex</code> ï¼ˆæŒ‡é’ˆç±»å‹ï¼‰å®šä¹‰ï¼Œå› æ­¤ <code>Vertex</code>ï¼ˆå€¼ç±»å‹ï¼‰å¹¶æœªå®ç° <code>Abser</code>ã€‚</p><p>å°†ç¬¬22è¡Œæ³¨é‡Šåï¼Œè¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5</span><br></pre></td></tr></table></figure><h4 id="æ¥å£æ˜¯éšå¼å®ç°çš„"><a href="#æ¥å£æ˜¯éšå¼å®ç°çš„" class="headerlink" title="æ¥å£æ˜¯éšå¼å®ç°çš„"></a>æ¥å£æ˜¯éšå¼å®ç°çš„</h4><p>ç±»å‹é€šè¿‡å®ç°ä¸€ä¸ªæ¥å£çš„æ‰€æœ‰æ–¹æ³•æ¥å®ç°è¯¥æ¥å£ã€‚æ—¢ç„¶æ— éœ€ä¸“é—¨æ˜¾å¼å£°æ˜ï¼Œä¹Ÿå°±æ²¡æœ‰â€œimplementsâ€å…³é”®å­—ã€‚</p><p>éšå¼æ¥å£å°†æ¥å£çš„å®šä¹‰ä¸å…¶å®ç°åˆ†ç¦»ï¼Œè¿™æ ·éšåçš„æ¥å£å®ç°å¯ä»¥å‡ºç°åœ¨ä»»ä½•åŒ…ä¸­ï¼Œè€Œæ— éœ€æå‰å‡†å¤‡ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> I <span class="keyword">interface</span> &#123;</span><br><span class="line">M()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> T <span class="keyword">struct</span> &#123;</span><br><span class="line">S <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­¤æ–¹æ³•è¡¨ç¤ºç±»å‹ T å®ç°äº†æ¥å£ Iï¼Œä½†æˆ‘ä»¬æ— éœ€æ˜¾å¼å£°æ˜æ­¤äº‹ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t T)</span> <span class="title">M</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(t.S)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> i I = T&#123;<span class="string">&quot;hello&quot;</span>&#125;</span><br><span class="line">i.M()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello</span><br></pre></td></tr></table></figure><h4 id="æ¥å£å€¼"><a href="#æ¥å£å€¼" class="headerlink" title="æ¥å£å€¼"></a>æ¥å£å€¼</h4><p>æ¥å£ä¹Ÿæ˜¯å€¼ã€‚å®ƒä»¬å¯ä»¥åƒå…¶å®ƒå€¼ä¸€æ ·ä¼ é€’ã€‚</p><p>æ¥å£å€¼å¯ä»¥ç”¨ä½œå‡½æ•°çš„å‚æ•°æˆ–è¿”å›å€¼ã€‚</p><p>åœ¨å†…éƒ¨ï¼Œæ¥å£å€¼å¯ä»¥çœ‹åšåŒ…å«å€¼å’Œå…·ä½“ç±»å‹çš„å…ƒç»„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(value, type)</span><br></pre></td></tr></table></figure><p>æ¥å£å€¼ä¿å­˜äº†ä¸€ä¸ªå…·ä½“åº•å±‚ç±»å‹çš„å…·ä½“å€¼ã€‚</p><p>æ¥å£å€¼è°ƒç”¨æ–¹æ³•æ—¶ä¼šæ‰§è¡Œå…¶åº•å±‚ç±»å‹çš„åŒåæ–¹æ³•ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> I <span class="keyword">interface</span> &#123;</span><br><span class="line">M()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> T <span class="keyword">struct</span> &#123;</span><br><span class="line">S <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *T)</span> <span class="title">M</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(t.S)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> F <span class="keyword">float64</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f F)</span> <span class="title">M</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(f)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> i I</span><br><span class="line"></span><br><span class="line">i = &amp;T&#123;<span class="string">&quot;Hello&quot;</span>&#125;</span><br><span class="line">describe(i)</span><br><span class="line">i.M()</span><br><span class="line"></span><br><span class="line">i = F(math.Pi)</span><br><span class="line">describe(i)</span><br><span class="line">i.M()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">describe</span><span class="params">(i I)</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;(%v, %T)\n&quot;</span>, i, i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(&amp;&#123;Hello&#125;, *main.T)</span><br><span class="line">Hello</span><br><span class="line">(3.141592653589793, main.F)</span><br><span class="line">3.141592653589793</span><br></pre></td></tr></table></figure><h4 id="åº•å±‚å€¼ä¸º-nil-çš„æ¥å£å€¼"><a href="#åº•å±‚å€¼ä¸º-nil-çš„æ¥å£å€¼" class="headerlink" title="åº•å±‚å€¼ä¸º nil çš„æ¥å£å€¼"></a>åº•å±‚å€¼ä¸º nil çš„æ¥å£å€¼</h4><p>å³ä¾¿æ¥å£å†…çš„å…·ä½“å€¼ä¸º nilï¼Œæ–¹æ³•ä»ç„¶ä¼šè¢« nil æ¥æ”¶è€…è°ƒç”¨ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> I <span class="keyword">interface</span> &#123;</span><br><span class="line">M()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> T <span class="keyword">struct</span> &#123;</span><br><span class="line">S <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *T)</span> <span class="title">M</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> t == <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;&lt;nil&gt;&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(t.S)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> i I</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> t *T</span><br><span class="line"></span><br><span class="line">i = t</span><br><span class="line">describe(i)</span><br><span class="line">i.M()</span><br><span class="line"></span><br><span class="line">i = &amp;T&#123;<span class="string">&quot;hello&quot;</span>&#125;</span><br><span class="line">describe(i)</span><br><span class="line">i.M()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">describe</span><span class="params">(i I)</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;(%v, %T)\n&quot;</span>, i, i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(&lt;nil&gt;, *main.T)</span><br><span class="line">&lt;nil&gt;</span><br><span class="line">(&amp;&#123;hello&#125;, *main.T)</span><br><span class="line">hello</span><br></pre></td></tr></table></figure><p>åœ¨ä¸€äº›è¯­è¨€ä¸­ï¼Œè¿™ä¼šè§¦å‘ä¸€ä¸ªç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œä½†åœ¨ Go ä¸­é€šå¸¸ä¼šå†™ä¸€äº›æ–¹æ³•æ¥ä¼˜é›…åœ°å¤„ç†å®ƒï¼ˆå¦‚æœ¬ä¾‹ä¸­çš„ <code>M</code> æ–¹æ³•ï¼‰ã€‚</p><p><strong>æ³¨æ„:</strong> ä¿å­˜äº† nil å…·ä½“å€¼çš„æ¥å£å…¶è‡ªèº«å¹¶ä¸ä¸º nilã€‚</p><h4 id="nil-æ¥å£å€¼"><a href="#nil-æ¥å£å€¼" class="headerlink" title="nil æ¥å£å€¼"></a>nil æ¥å£å€¼</h4><p>nil æ¥å£å€¼æ—¢ä¸ä¿å­˜å€¼ä¹Ÿä¸ä¿å­˜å…·ä½“ç±»å‹ã€‚</p><p>ä¸º nil æ¥å£è°ƒç”¨æ–¹æ³•ä¼šäº§ç”Ÿè¿è¡Œæ—¶é”™è¯¯ï¼Œå› ä¸ºæ¥å£çš„å…ƒç»„å†…å¹¶æœªåŒ…å«èƒ½å¤ŸæŒ‡æ˜è¯¥è°ƒç”¨å“ªä¸ª <strong>å…·ä½“</strong> æ–¹æ³•çš„ç±»å‹ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> I <span class="keyword">interface</span> &#123;</span><br><span class="line">M()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> i I</span><br><span class="line">describe(i)</span><br><span class="line">i.M()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">describe</span><span class="params">(i I)</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;(%v, %T)\n&quot;</span>, i, i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(&lt;nil&gt;, &lt;nil&gt;)</span><br><span class="line">panic: runtime error: invalid memory address or nil pointer dereference</span><br><span class="line">[signal SIGSEGV: segmentation violation code&#x3D;0x1 addr&#x3D;0x0 pc&#x3D;0x1093e31]</span><br><span class="line"></span><br><span class="line">goroutine 1 [running]:</span><br><span class="line">main.main()</span><br><span class="line">&#x2F;a-tour-of-go&#x2F;Nil-interface-values&#x2F;src.go:12 +0x91</span><br><span class="line">exit status 2</span><br></pre></td></tr></table></figure><h4 id="ç©ºæ¥å£"><a href="#ç©ºæ¥å£" class="headerlink" title="ç©ºæ¥å£"></a>ç©ºæ¥å£</h4><p>æŒ‡å®šäº†é›¶ä¸ªæ–¹æ³•çš„æ¥å£å€¼è¢«ç§°ä¸º <em>ç©ºæ¥å£ï¼š</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">interface&#123;&#125;</span><br></pre></td></tr></table></figure><p>ç©ºæ¥å£å¯ä¿å­˜ä»»ä½•ç±»å‹çš„å€¼ã€‚ï¼ˆå› ä¸ºæ¯ä¸ªç±»å‹éƒ½è‡³å°‘å®ç°äº†é›¶ä¸ªæ–¹æ³•ã€‚ï¼‰</p><p>ç©ºæ¥å£è¢«ç”¨æ¥å¤„ç†æœªçŸ¥ç±»å‹çš„å€¼ã€‚ä¾‹å¦‚ï¼Œ<code>fmt.Print</code> å¯æ¥å—ç±»å‹ä¸º <code>interface&#123;&#125;</code> çš„ä»»æ„æ•°é‡çš„å‚æ•°ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> i <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">describe(i)</span><br><span class="line"></span><br><span class="line">i = <span class="number">42</span></span><br><span class="line">describe(i)</span><br><span class="line"></span><br><span class="line">i = <span class="string">&quot;hello&quot;</span></span><br><span class="line">describe(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">describe</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;(%v, %T)\n&quot;</span>, i, i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(&lt;nil&gt;, &lt;nil&gt;)</span><br><span class="line">(42, int)</span><br><span class="line">(hello, string)</span><br></pre></td></tr></table></figure><h4 id="ç±»å‹æ–­è¨€"><a href="#ç±»å‹æ–­è¨€" class="headerlink" title="ç±»å‹æ–­è¨€"></a>ç±»å‹æ–­è¨€</h4><p><strong>ç±»å‹æ–­è¨€</strong> æä¾›äº†è®¿é—®æ¥å£å€¼åº•å±‚å…·ä½“å€¼çš„æ–¹å¼ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t :&#x3D; i.(T)</span><br></pre></td></tr></table></figure><p>è¯¥è¯­å¥æ–­è¨€æ¥å£å€¼ <code>i</code> ä¿å­˜äº†å…·ä½“ç±»å‹ <code>T</code>ï¼Œå¹¶å°†å…¶åº•å±‚ç±»å‹ä¸º <code>T</code> çš„å€¼èµ‹äºˆå˜é‡ <code>t</code>ã€‚</p><p>è‹¥ <code>i</code> å¹¶æœªä¿å­˜ <code>T</code> ç±»å‹çš„å€¼ï¼Œè¯¥è¯­å¥å°±ä¼šè§¦å‘ä¸€ä¸ª panicã€‚</p><p>ä¸ºäº† <strong>åˆ¤æ–­</strong> ä¸€ä¸ªæ¥å£å€¼æ˜¯å¦ä¿å­˜äº†ä¸€ä¸ªç‰¹å®šçš„ç±»å‹ï¼Œç±»å‹æ–­è¨€å¯è¿”å›ä¸¤ä¸ªå€¼ï¼šå…¶åº•å±‚å€¼ä»¥åŠä¸€ä¸ªæŠ¥å‘Šæ–­è¨€æ˜¯å¦æˆåŠŸçš„å¸ƒå°”å€¼ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t, ok :&#x3D; i.(T)</span><br></pre></td></tr></table></figure><p>è‹¥ <code>i</code> ä¿å­˜äº†ä¸€ä¸ª <code>T</code>ï¼Œé‚£ä¹ˆ <code>t</code> å°†ä¼šæ˜¯å…¶åº•å±‚å€¼ï¼Œè€Œ <code>ok</code> ä¸º <code>true</code>ã€‚</p><p>å¦åˆ™ï¼Œ<code>ok</code> å°†ä¸º <code>false</code> è€Œ <code>t</code> å°†ä¸º <code>T</code> ç±»å‹çš„é›¶å€¼ï¼Œç¨‹åºå¹¶ä¸ä¼šäº§ç”Ÿææ…Œã€‚</p><p>è¯·æ³¨æ„è¿™ç§è¯­æ³•å’Œè¯»å–ä¸€ä¸ªæ˜ å°„æ—¶çš„ç›¸åŒä¹‹å¤„ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> i <span class="keyword">interface</span>&#123;&#125; = <span class="string">&quot;hello&quot;</span></span><br><span class="line"></span><br><span class="line">s := i.(<span class="keyword">string</span>)</span><br><span class="line">fmt.Println(s)</span><br><span class="line"></span><br><span class="line">s, ok := i.(<span class="keyword">string</span>)</span><br><span class="line">fmt.Println(s, ok)</span><br><span class="line"></span><br><span class="line">f, ok := i.(<span class="keyword">float64</span>)</span><br><span class="line">fmt.Println(f, ok)</span><br><span class="line"></span><br><span class="line">f = i.(<span class="keyword">float64</span>) <span class="comment">// panic</span></span><br><span class="line">fmt.Println(f)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hello</span><br><span class="line">hello true</span><br><span class="line">0 false</span><br><span class="line">panic: interface conversion: interface &#123;&#125; is string, not float64</span><br><span class="line"></span><br><span class="line">goroutine 1 [running]:</span><br><span class="line">main.main()</span><br><span class="line">&#x2F;go-tour&#x2F;Type-assertions&#x2F;src.go:17 +0x1f7</span><br><span class="line">exit status 2</span><br></pre></td></tr></table></figure><h4 id="ç±»å‹é€‰æ‹©"><a href="#ç±»å‹é€‰æ‹©" class="headerlink" title="ç±»å‹é€‰æ‹©"></a>ç±»å‹é€‰æ‹©</h4><p><strong>ç±»å‹é€‰æ‹©</strong>(Type switches)æ˜¯ä¸€ç§æŒ‰é¡ºåºä»å‡ ä¸ªç±»å‹æ–­è¨€ä¸­é€‰æ‹©åˆ†æ”¯çš„ç»“æ„ã€‚</p><p>ç±»å‹é€‰æ‹©ä¸ä¸€èˆ¬çš„ switch è¯­å¥ç›¸ä¼¼ï¼Œä¸è¿‡ç±»å‹é€‰æ‹©ä¸­çš„ case ä¸ºç±»å‹ï¼ˆè€Œéå€¼ï¼‰ï¼Œ å®ƒä»¬é’ˆå¯¹ç»™å®šæ¥å£å€¼æ‰€å­˜å‚¨çš„å€¼çš„ç±»å‹è¿›è¡Œæ¯”è¾ƒã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">switch v :&#x3D; i.(type) &#123;</span><br><span class="line">case T:</span><br><span class="line">    &#x2F;&#x2F; v çš„ç±»å‹ä¸º T</span><br><span class="line">case S:</span><br><span class="line">    &#x2F;&#x2F; v çš„ç±»å‹ä¸º S</span><br><span class="line">default:</span><br><span class="line">    &#x2F;&#x2F; æ²¡æœ‰åŒ¹é…ï¼Œv ä¸ i çš„ç±»å‹ç›¸åŒ</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç±»å‹é€‰æ‹©ä¸­çš„å£°æ˜ä¸ç±»å‹æ–­è¨€ <code>i.(T)</code> çš„è¯­æ³•ç›¸åŒï¼Œåªæ˜¯å…·ä½“ç±»å‹ <code>T</code> è¢«æ›¿æ¢æˆäº†å…³é”®å­— <code>type</code>ã€‚</p><p>æ­¤é€‰æ‹©è¯­å¥åˆ¤æ–­æ¥å£å€¼ <code>i</code> ä¿å­˜çš„å€¼ç±»å‹æ˜¯ <code>T</code> è¿˜æ˜¯ <code>S</code>ã€‚åœ¨ <code>T</code> æˆ– <code>S</code> çš„æƒ…å†µä¸‹ï¼Œå˜é‡ <code>v</code> ä¼šåˆ†åˆ«æŒ‰ <code>T</code> æˆ– <code>S</code> ç±»å‹ä¿å­˜ <code>i</code> æ‹¥æœ‰çš„å€¼ã€‚åœ¨é»˜è®¤ï¼ˆå³æ²¡æœ‰åŒ¹é…ï¼‰çš„æƒ…å†µä¸‹ï¼Œå˜é‡ <code>v</code> ä¸ <code>i</code> çš„æ¥å£ç±»å‹å’Œå€¼ç›¸åŒã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">do</span><span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line"><span class="keyword">switch</span> v := i.(<span class="keyword">type</span>) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">int</span>:</span><br><span class="line">fmt.Printf(<span class="string">&quot;Twice %v is %v\n&quot;</span>, v, v*<span class="number">2</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">string</span>:</span><br><span class="line">fmt.Printf(<span class="string">&quot;%q is %v bytes long\n&quot;</span>, v, <span class="built_in">len</span>(v))</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">fmt.Printf(<span class="string">&quot;I don&#x27;t know about type %T!\n&quot;</span>, v)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">do(<span class="number">21</span>)</span><br><span class="line">do(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">do(<span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Twice 21 is 42</span><br><span class="line">&quot;hello&quot; is 5 bytes long</span><br><span class="line">I don&#39;t know about type bool!</span><br></pre></td></tr></table></figure><h4 id="Stringer"><a href="#Stringer" class="headerlink" title="Stringer"></a>Stringer</h4><p><a href="https://go-zh.org/pkg/fmt/"><code>fmt</code></a> åŒ…ä¸­å®šä¹‰çš„ <a href="https://go-zh.org/pkg/fmt/#Stringer"><code>Stringer</code></a> æ˜¯æœ€æ™®éçš„æ¥å£ä¹‹ä¸€ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">type Stringer interface &#123;</span><br><span class="line">    String() string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Stringer</code> æ˜¯ä¸€ä¸ªå¯ä»¥ç”¨å­—ç¬¦ä¸²æè¿°è‡ªå·±çš„ç±»å‹ã€‚<code>fmt</code> åŒ…ï¼ˆè¿˜æœ‰å¾ˆå¤šåŒ…ï¼‰éƒ½é€šè¿‡æ­¤æ¥å£æ¥æ‰“å°å€¼ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">Name <span class="keyword">string</span></span><br><span class="line">Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Person)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;%v (%v years)&quot;</span>, p.Name, p.Age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">a := Person&#123;<span class="string">&quot;Foo&quot;</span>, <span class="number">12</span>&#125;</span><br><span class="line">b := Person&#123;<span class="string">&quot;Buzz&quot;</span>, <span class="number">23</span>&#125;</span><br><span class="line">fmt.Println(a, b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Foo (12 years) Buzz (23 years)</span><br></pre></td></tr></table></figure><h5 id="ç»ƒä¹ ï¼šStringer"><a href="#ç»ƒä¹ ï¼šStringer" class="headerlink" title="ç»ƒä¹ ï¼šStringer"></a>ç»ƒä¹ ï¼šStringer</h5><p>é€šè¿‡è®© <code>IPAddr</code> ç±»å‹å®ç° <code>fmt.Stringer</code> æ¥æ‰“å°ç‚¹å·åˆ†éš”çš„åœ°å€ã€‚</p><p>ä¾‹å¦‚ï¼Œ<code>IPAddr&#123;1, 2, 3, 4&#125;</code> åº”å½“æ‰“å°ä¸º <code>&quot;1.2.3.4&quot;</code>ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IPAddr [<span class="number">4</span>]<span class="keyword">byte</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i IPAddr)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;%v.%v.%v.%v&quot;</span>, i[<span class="number">0</span>], i[<span class="number">1</span>], i[<span class="number">2</span>], i[<span class="number">3</span>])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">hosts := <span class="keyword">map</span>[<span class="keyword">string</span>]IPAddr&#123;</span><br><span class="line"><span class="string">&quot;loopback&quot;</span>:  &#123;<span class="number">127</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>&#125;,</span><br><span class="line"><span class="string">&quot;googleDNS&quot;</span>: &#123;<span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> name, ip := <span class="keyword">range</span> hosts &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;%v: %v\n&quot;</span>, name, ip)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é”™è¯¯"><a href="#é”™è¯¯" class="headerlink" title="é”™è¯¯"></a>é”™è¯¯</h4><p>Go ç¨‹åºä½¿ç”¨ <code>error</code> å€¼æ¥è¡¨ç¤ºé”™è¯¯çŠ¶æ€ã€‚</p><p>ä¸ <code>fmt.Stringer</code> ç±»ä¼¼ï¼Œ<code>error</code> ç±»å‹æ˜¯ä¸€ä¸ªå†…å»ºæ¥å£ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">type error interface &#123;</span><br><span class="line">    Error() string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆä¸ <code>fmt.Stringer</code> ç±»ä¼¼ï¼Œ<code>fmt</code> åŒ…åœ¨æ‰“å°å€¼æ—¶ä¹Ÿä¼šçœ‹çœ‹å€¼æ˜¯å¦æ»¡è¶³ <code>error</code> æ¥å£ã€‚ï¼‰</p><p>é€šå¸¸å‡½æ•°ä¼šè¿”å›ä¸€ä¸ª <code>error</code> å€¼ï¼Œè°ƒç”¨çš„å®ƒçš„ä»£ç åº”å½“åˆ¤æ–­è¿™ä¸ªé”™è¯¯æ˜¯å¦ç­‰äº <code>nil</code> æ¥è¿›è¡Œé”™è¯¯å¤„ç†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">i, err :&#x3D; strconv.Atoi(&quot;42&quot;)</span><br><span class="line">if err !&#x3D; nil &#123;</span><br><span class="line">    fmt.Printf(&quot;couldn&#39;t convert number: %v\n&quot;, err)</span><br><span class="line">    return</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(&quot;Converted integer:&quot;, i)</span><br></pre></td></tr></table></figure><p><code>error</code> ä¸º nil æ—¶è¡¨ç¤ºæˆåŠŸï¼›é nil çš„ <code>error</code> è¡¨ç¤ºå¤±è´¥ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyError <span class="keyword">struct</span> &#123;</span><br><span class="line">When time.Time</span><br><span class="line">What <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *MyError)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;at %v, %s&quot;</span>, e.When, e.What)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">run</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> &amp;MyError&#123;</span><br><span class="line">time.Now(),</span><br><span class="line"><span class="string">&quot;it didn&#x27;t work&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> err := run(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">at 2020-02-07 17:26:08.694498 +0800 CST m&#x3D;+0.000541141, it didn&#39;t work</span><br></pre></td></tr></table></figure><h5 id="ç»ƒä¹ ï¼šé”™è¯¯"><a href="#ç»ƒä¹ ï¼šé”™è¯¯" class="headerlink" title="ç»ƒä¹ ï¼šé”™è¯¯"></a>ç»ƒä¹ ï¼šé”™è¯¯</h5><p>ä»<a href="https://tour.golang.org/flowcontrol/8">ä¹‹å‰çš„ç»ƒä¹ </a>ä¸­å¤åˆ¶ <code>Sqrt</code> å‡½æ•°ï¼Œä¿®æ”¹å®ƒä½¿å…¶è¿”å› <code>error</code> å€¼ã€‚</p><p><code>Sqrt</code> æ¥å—åˆ°ä¸€ä¸ªè´Ÿæ•°æ—¶ï¼Œåº”å½“è¿”å›ä¸€ä¸ªé nil çš„é”™è¯¯å€¼ã€‚å¤æ•°åŒæ ·ä¹Ÿä¸è¢«æ”¯æŒã€‚</p><p>åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»å‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type ErrNegativeSqrt float64</span><br></pre></td></tr></table></figure><p>å¹¶ä¸ºå…¶å®ç°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func (e ErrNegativeSqrt) Error() string</span><br></pre></td></tr></table></figure><p>æ–¹æ³•ä½¿å…¶æ‹¥æœ‰ <code>error</code> å€¼ï¼Œé€šè¿‡ <code>ErrNegativeSqrt(-2).Error()</code> è°ƒç”¨è¯¥æ–¹æ³•åº”è¿”å› <code>&quot;cannot Sqrt negative number: -2&quot;</code>ã€‚</p><p><strong>æ³¨æ„:</strong> åœ¨ <code>Error</code> æ–¹æ³•å†…è°ƒç”¨ <code>fmt.Sprint(e)</code> ä¼šè®©ç¨‹åºé™·å…¥æ­»å¾ªç¯ã€‚å¯ä»¥é€šè¿‡å…ˆè½¬æ¢ <code>e</code>æ¥é¿å…è¿™ä¸ªé—®é¢˜ï¼š<code>fmt.Sprint(float64(e))</code>ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ä¿®æ”¹ <code>Sqrt</code> å‡½æ•°ï¼Œä½¿å…¶æ¥å—ä¸€ä¸ªè´Ÿæ•°æ—¶ï¼Œè¿”å› <code>ErrNegativeSqrt</code> å€¼ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sqrt</span><span class="params">(x <span class="keyword">float64</span>)</span> <span class="params">(<span class="keyword">float64</span>, error)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> x &lt; <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>, ErrNegativeSqrt&#123;x&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> math.Sqrt(x), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ErrNegativeSqrt <span class="keyword">struct</span> &#123;</span><br><span class="line">val<span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e ErrNegativeSqrt)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;Error Negative Sqrt of %v&quot;</span>, e.val)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> a <span class="keyword">float64</span> = <span class="number">-1</span></span><br><span class="line"><span class="keyword">if</span> res, err := Sqrt(a); err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(err)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;Sqrt(&quot;</span>, a, <span class="string">&quot;) is &quot;</span>, res)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error Negative Sqrt of -1</span><br></pre></td></tr></table></figure><h4 id="Reader"><a href="#Reader" class="headerlink" title="Reader"></a>Reader</h4><p><code>io</code> åŒ…æŒ‡å®šäº† <code>io.Reader</code> æ¥å£ï¼Œå®ƒè¡¨ç¤ºä»æ•°æ®æµçš„æœ«å°¾è¿›è¡Œè¯»å–ã€‚</p><p>Go æ ‡å‡†åº“åŒ…å«äº†è¯¥æ¥å£çš„<a href="https://golang.org/search?q=Read#Global">è®¸å¤šå®ç°</a>ï¼ŒåŒ…æ‹¬æ–‡ä»¶ã€ç½‘ç»œè¿æ¥ã€å‹ç¼©å’ŒåŠ å¯†ç­‰ç­‰ã€‚</p><p><code>io.Reader</code> æ¥å£æœ‰ä¸€ä¸ª <code>Read</code> æ–¹æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func (T) Read(b []byte) (n int, err error)</span><br></pre></td></tr></table></figure><p><code>Read</code> ç”¨æ•°æ®å¡«å……ç»™å®šçš„å­—èŠ‚åˆ‡ç‰‡å¹¶è¿”å›å¡«å……çš„å­—èŠ‚æ•°å’Œé”™è¯¯å€¼ã€‚åœ¨é‡åˆ°æ•°æ®æµçš„ç»“å°¾æ—¶ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª <code>io.EOF</code> é”™è¯¯ã€‚</p><p>ç¤ºä¾‹ä»£ç åˆ›å»ºäº†ä¸€ä¸ª <a href="https://golang.org/pkg/strings/#Reader"><code>strings.Reader</code></a> å¹¶ä»¥æ¯æ¬¡ 8 å­—èŠ‚çš„é€Ÿåº¦è¯»å–å®ƒçš„è¾“å‡ºã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;io&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">r := strings.NewReader(<span class="string">&quot;Hello, Reader!&quot;</span>)</span><br><span class="line"></span><br><span class="line">b := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">8</span>)</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">n, err := r.Read(b)</span><br><span class="line">fmt.Printf(<span class="string">&quot;n=%v err=%v b=%v\n&quot;</span>, n, err, b)</span><br><span class="line">fmt.Printf(<span class="string">&quot;b[:n]=%q\n&quot;</span>, b[:n])</span><br><span class="line"><span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">n&#x3D;8 err&#x3D;&lt;nil&gt; b&#x3D;[72 101 108 108 111 44 32 82]</span><br><span class="line">b[:n]&#x3D;&quot;Hello, R&quot;</span><br><span class="line">n&#x3D;6 err&#x3D;&lt;nil&gt; b&#x3D;[101 97 100 101 114 33 32 82]</span><br><span class="line">b[:n]&#x3D;&quot;eader!&quot;</span><br><span class="line">n&#x3D;0 err&#x3D;EOF b&#x3D;[101 97 100 101 114 33 32 82]</span><br><span class="line">b[:n]&#x3D;&quot;&quot;</span><br></pre></td></tr></table></figure><h5 id="ç»ƒä¹ ï¼šReader"><a href="#ç»ƒä¹ ï¼šReader" class="headerlink" title="ç»ƒä¹ ï¼šReader"></a>ç»ƒä¹ ï¼šReader</h5><p>å®ç°ä¸€ä¸ª <code>Reader</code> ç±»å‹ï¼Œå®ƒäº§ç”Ÿä¸€ä¸ª ASCII å­—ç¬¦ <code>&#39;A&#39;</code> çš„æ— é™æµã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./reader&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyReader <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r MyReader)</span> <span class="title">Read</span><span class="params">(b []<span class="keyword">byte</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(b); i++ &#123;</span><br><span class="line">b[i] = <span class="string">&#x27;A&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">len</span>(b), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">reader.Validate(MyReader&#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ç»ƒä¹ ï¼šrot13Reader"><a href="#ç»ƒä¹ ï¼šrot13Reader" class="headerlink" title="ç»ƒä¹ ï¼šrot13Reader"></a>ç»ƒä¹ ï¼šrot13Reader</h5><p>æœ‰ç§å¸¸è§çš„æ¨¡å¼æ˜¯ä¸€ä¸ª <a href="https://go-zh.org/pkg/io/#Reader"><code>io.Reader</code></a> åŒ…è£…å¦ä¸€ä¸ª <code>io.Reader</code>ï¼Œç„¶åé€šè¿‡æŸç§æ–¹å¼ä¿®æ”¹å…¶æ•°æ®æµã€‚</p><p>ä¾‹å¦‚ï¼Œ<a href="https://go-zh.org/pkg/compress/gzip/#NewReader"><code>gzip.NewReader</code></a> å‡½æ•°æ¥å—ä¸€ä¸ª <code>io.Reader</code>ï¼ˆå·²å‹ç¼©çš„æ•°æ®æµï¼‰å¹¶è¿”å›ä¸€ä¸ªåŒæ ·å®ç°äº† <code>io.Reader</code> çš„ <code>*gzip.Reader</code>ï¼ˆè§£å‹åçš„æ•°æ®æµï¼‰ã€‚</p><p>ç¼–å†™ä¸€ä¸ªå®ç°äº† <code>io.Reader</code> å¹¶ä»å¦ä¸€ä¸ª <code>io.Reader</code> ä¸­è¯»å–æ•°æ®çš„ <code>rot13Reader</code>ï¼Œé€šè¿‡åº”ç”¨ <a href="http://en.wikipedia.org/wiki/ROT13">rot13</a> ä»£æ¢å¯†ç å¯¹æ•°æ®æµè¿›è¡Œä¿®æ”¹ã€‚</p><p><code>rot13Reader</code> ç±»å‹å·²ç»æä¾›ã€‚å®ç° <code>Read</code> æ–¹æ³•ä»¥æ»¡è¶³ <code>io.Reader</code>ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;io&quot;</span></span><br><span class="line"><span class="string">&quot;os&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> rot13Reader <span class="keyword">struct</span> &#123;</span><br><span class="line">r io.Reader</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a rot13Reader)</span> <span class="title">Read</span><span class="params">(b []<span class="keyword">byte</span>)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span> &#123;</span><br><span class="line">bt := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(b); i++ &#123;</span><br><span class="line">_, erra := a.r.Read(bt)</span><br><span class="line"><span class="keyword">if</span> erra != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> i, erra</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">switch</span> &#123;</span><br><span class="line"><span class="keyword">case</span> (bt[<span class="number">0</span>] &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; bt[<span class="number">0</span>] &lt;= <span class="string">&#x27;M&#x27;</span>) || (bt[<span class="number">0</span>] &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; bt[<span class="number">0</span>] &lt;= <span class="string">&#x27;m&#x27;</span>):</span><br><span class="line">b[i] = bt[<span class="number">0</span>] + <span class="number">13</span></span><br><span class="line"><span class="keyword">case</span> (bt[<span class="number">0</span>] &gt;= <span class="string">&#x27;N&#x27;</span> &amp;&amp; bt[<span class="number">0</span>] &lt;= <span class="string">&#x27;Z&#x27;</span>) || (bt[<span class="number">0</span>] &gt;= <span class="string">&#x27;n&#x27;</span> &amp;&amp; bt[<span class="number">0</span>] &lt;= <span class="string">&#x27;z&#x27;</span>):</span><br><span class="line">b[i] = bt[<span class="number">0</span>] - <span class="number">13</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">b[i] = bt[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">len</span>(b), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">s := strings.NewReader(<span class="string">&quot;Lbh penpxrq gur pbqr!&quot;</span>)</span><br><span class="line">r := rot13Reader&#123;s&#125;</span><br><span class="line">io.Copy(os.Stdout, &amp;r)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You cracked the code!</span><br></pre></td></tr></table></figure><h4 id="å›¾åƒ"><a href="#å›¾åƒ" class="headerlink" title="å›¾åƒ"></a>å›¾åƒ</h4><p><a href="https://golang.org/pkg/image/#Image"><code>image</code></a> åŒ…å®šä¹‰äº† <code>Image</code> æ¥å£ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> image</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Image <span class="keyword">interface</span> &#123;</span><br><span class="line">    ColorModel() color.Model</span><br><span class="line">    Bounds() Rectangle</span><br><span class="line">    At(x, y <span class="keyword">int</span>) color.Color</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„:</strong> <code>Bounds</code> æ–¹æ³•çš„è¿”å›å€¼ <code>Rectangle</code> å®é™…ä¸Šæ˜¯ä¸€ä¸ª <a href="https://golang.org/pkg/image/#Rectangle"><code>image.Rectangle</code></a>ï¼Œå®ƒåœ¨ <code>image</code> åŒ…ä¸­å£°æ˜ã€‚</p><p>ï¼ˆè¯·å‚é˜…<a href="https://golang.org/pkg/image/#Image">æ–‡æ¡£</a>äº†è§£å…¨éƒ¨ä¿¡æ¯ã€‚ï¼‰</p><p><code>color.Color</code> å’Œ <code>color.Model</code> ç±»å‹ä¹Ÿæ˜¯æ¥å£ï¼Œä½†æ˜¯é€šå¸¸å› ä¸ºç›´æ¥ä½¿ç”¨é¢„å®šä¹‰çš„å®ç° <code>image.RGBA</code> å’Œ <code>image.RGBAModel</code> è€Œè¢«å¿½è§†äº†ã€‚è¿™äº›æ¥å£å’Œç±»å‹ç”± <a href="https://golang.org/pkg/image/color/"><code>image/color</code></a>åŒ…å®šä¹‰ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;image&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">m := image.NewRGBA(image.Rect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>))</span><br><span class="line">fmt.Println(m.Bounds())</span><br><span class="line">fmt.Println(m.At(<span class="number">0</span>, <span class="number">0</span>).RGBA())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(0,0)-(100,100)</span><br><span class="line">0 0 0 0</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Swift æ å½±</title>
      <link href="/2020/01/28/blog/a-swift-tour-cn-md/"/>
      <url>/2020/01/28/blog/a-swift-tour-cn-md/</url>
      
        <content type="html"><![CDATA[<h1 id="Swift-æ å½±"><a href="#Swift-æ å½±" class="headerlink" title="Swift æ å½±"></a>Swift æ å½±</h1><blockquote><p>æœ¬æ–‡ç¿»è¯‘è‡ª Swift å®˜ç½‘çš„ <a href="https://docs.swift.org/swift-book/GuidedTour/GuidedTour.html#">A Swift Tour</a> (Swift 5.1)ã€‚</p></blockquote><p>æŒ‰ç…§ä¼ ç»Ÿï¼Œå­¦ä¹ ä¸€é—¨æ–°çš„ç¼–ç¨‹è¯­è¨€æ—¶ï¼Œæˆ‘ä»¬å†™çš„ç¬¬ä¸€ä¸ªç¨‹åºåº”è¯¥æ˜¯åœ¨å±å¹•ä¸Šæ‰“å°å‡ºâ€œHello, world!â€ã€‚åœ¨ Swift ä¸­ï¼Œåªè¦ä¸€è¡Œä»£ç å°±å¯ä»¥å®Œæˆè¿™ä¸ªä»ªå¼ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Hello, world!&quot;</span>)</span><br><span class="line"><span class="comment">// Prints &quot;Hello, world!&quot;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä½ å†™è¿‡ C æˆ–è€… Objective-Cï¼Œä¸€å®šä¼šè§‰å¾— Swift çš„è¯­æ³•å¾ˆäº²åˆ‡ã€‚åœ¨ Swift ä¸­ï¼Œè¿™ä¸€è¡Œä»£ç å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¨‹åºäº†ã€‚ä½ ä¸å¿…å¯¼å…¥ä»»ä½•åº“å°±å¯ä»¥å®Œæˆè¾“å…¥è¾“å‡ºä»¥åŠå­—ç¬¦ä¸²å¤„ç†ã€‚åœ¨å…¨å±€ä½œç”¨åŸŸä¸­å†™çš„ä»£ç å°±æ˜¯ç¨‹åºçš„å…¥å£ç‚¹ï¼Œæ‰€ä»¥ä½ ä¸åœ¨éœ€è¦å†™ <code>main</code> å‡½æ•°äº†ã€‚åœ¨æ¯ä¸€ä¸ªè¯­å¥çš„æœ«å°¾ï¼Œä¹Ÿä¸ç”¨å†™åˆ†å·ã€‚</p><p>æœ¬æ–‡ä¼šæä¾›è¶³å¤Ÿå¤šçš„ä¿¡æ¯è®©ä½ å¯ä»¥å¼€å§‹ç”¨ Swift å†™ä»£ç ï¼Œæˆ‘ä»¬ä¼šä¸ºä½ å±•ç°å¦‚ä½•ç”¨ Swift å®Œæˆå„ç§ç¼–ç¨‹ä»»åŠ¡ã€‚å¦‚æœä½ æœ‰åœ°æ–¹æ²¡æœ‰ç†è§£ï¼Œè¯·ä¸è¦æ‹…å¿ƒï¼Œè¿™é‡Œä»‹ç»çš„æ‰€æœ‰ä¸œè¥¿åœ¨æœ¬ä¹¦åç»­çš„ç« èŠ‚ä¸­éƒ½æœ‰è¯¦å°½çš„è®¨è®ºã€‚</p><blockquote><p>ã€æ³¨ã€‘</p><p>ä¸ºè·å¾—æœ€å¥½çš„ä½“éªŒï¼Œä½ å¯ä»¥åœ¨ Xcode ä¸­æ‰“å¼€è¯¥èŠ‚çš„ playgroundã€‚Playground è®©ä½ å¯ä»¥ç¼–è¾‘è¿™é‡Œçš„ä»£ç å¹¶åŠæ—¶çœ‹åˆ°è¿è¡Œçš„ç»“æœã€‚</p><p><a href="https://docs.swift.org/swift-book/GuidedTour/GuidedTour.playground.zip">ä¸‹è½½ Playground</a></p></blockquote><h2 id="ç®€å•å€¼"><a href="#ç®€å•å€¼" class="headerlink" title="ç®€å•å€¼"></a>ç®€å•å€¼</h2><p>Swift ç”¨ <code>let</code> å£°æ˜å¸¸é‡ï¼Œç”¨ <code>var</code> å£°æ˜å˜é‡ã€‚è™½ç„¶å¸¸é‡çš„å€¼åœ¨å˜å¼‚çš„è¿‡ç¨‹ä¸­æ˜¯ä¸éœ€è¦çŸ¥é“çš„ï¼Œä½†ä½ å¿…é¡»åœ¨å£°æ˜æ—¶ç«‹åˆ»ä¸ºå…¶èµ‹å€¼ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ç”¨å¸¸é‡æ¥å‘½åä¸€ä¸ªä½ å†³å®šå¥½ä¸åœ¨æ”¹å˜ã€éœ€è¦åœ¨å¤šå¤„ä½¿ç”¨çš„å€¼ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myVariable <span class="operator">=</span> <span class="number">42</span></span><br><span class="line">myVariable <span class="operator">=</span> <span class="number">50</span></span><br><span class="line"><span class="keyword">let</span> myConstant <span class="operator">=</span> <span class="number">42</span></span><br></pre></td></tr></table></figure><p>å¸¸é‡æˆ–å˜é‡ä¼šæ‹¥æœ‰ä¸ä½ æœŸæœ›èµ‹ç»™å®ƒçš„å€¼ç›¸åŒçš„ç±»å‹ï¼Œä½†ä½ ä¸å¿…æ¯æ¬¡éƒ½æŒ‡æ˜ç±»å‹ï¼Œåœ¨åˆ›å»ºå˜é‡æˆ–å¸¸é‡æ—¶ï¼Œæä¾›ä¸€ä¸ªå€¼å°±å¯ä»¥è®©ç¼–è¯‘å™¨è‡ªåŠ¨æ¨æ–­å®ƒçš„ç±»å‹ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œç¼–è¯‘å™¨ä¼šæ¨æµ‹ <code>myVariable</code> æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œå› ä¸ºèµ‹ç»™å®ƒçš„åˆå€¼æ˜¯ä¸€ä¸ªæ•´æ•°ã€‚</p><p>å¦‚æœé€šè¿‡åˆå€¼ä¸èƒ½æä¾›è¶³å¤Ÿçš„ä¿¡æ¯ï¼ˆæˆ–ä¸æ‰“ç®—èµ‹åˆå€¼ï¼‰ï¼Œä½ å¯ä»¥è‡ªå·±æŒ‡æ˜ç±»å‹ï¼Œåœ¨å˜é‡ååé¢å†™ä¸Šç±»å‹ï¼Œç”¨å†’å·éš”å¼€å³å¯ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> implicitInteger <span class="operator">=</span> <span class="number">70</span></span><br><span class="line"><span class="keyword">let</span> implicitDouble <span class="operator">=</span> <span class="number">70.0</span></span><br><span class="line"><span class="keyword">let</span> explicitDouble: <span class="type">Double</span> <span class="operator">=</span> <span class="number">70</span></span><br></pre></td></tr></table></figure><blockquote><p>ã€å®éªŒã€‘</p><p>åˆ›å»ºä¸€ä¸ªå¸¸é‡ï¼Œæ˜¾å¼åœ°æŒ‡æ˜ç±»å‹ä¸º <code>Float</code>ï¼Œå€¼ä¸º <code>4</code>ã€‚</p></blockquote><p>ä¸€ä¸ªå€¼æ°¸è¿œä¸ä¼šè¢«éšå¼è½¬åŒ–ä¸ºå…¶ä»–ç±»å‹çš„ã€‚å¦‚æœä½ éœ€è¦æŠŠæŸä¸ªå€¼è½¬æ¢æˆå…¶ä»–ç±»å‹çš„ï¼Œéœ€è¦æ˜¾å¼åœ°åˆ›å»ºä¸€ä¸ªç›®æ ‡ç±»å‹å®ä¾‹ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> label <span class="operator">=</span> <span class="string">&quot;The width is &quot;</span></span><br><span class="line"><span class="keyword">let</span> width <span class="operator">=</span> <span class="number">94</span></span><br><span class="line"><span class="keyword">let</span> widthLabel <span class="operator">=</span> label <span class="operator">+</span> <span class="type">String</span>(width)</span><br></pre></td></tr></table></figure><blockquote><p>ã€å®éªŒã€‘</p><p>å°è¯•åœ¨ä¸Šé¢ä»£ç çš„æœ€åä¸€æŠŠåˆ° <code>String</code> çš„è½¬åŒ–åˆ é™¤ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p></blockquote><p>Swift ä¸­ï¼Œæœ‰ä¸€ä¸ªç®€å•çš„åŠæ³•è®©ä½ åœ¨å­—ç¬¦ä¸²ä¸­åŒ…å«ä¸€äº›å€¼ï¼šåœ¨å°æ‹¬å·é‡Œå†™ä¸Šéœ€è¦çš„å€¼ï¼Œå¹¶åœ¨æ‹¬å·å‰é¢åŠ ä¸€ä¸ªåæ–œæ ï¼ˆ<code>\</code>ï¼‰ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> apples <span class="operator">=</span> <span class="number">3</span></span><br><span class="line"><span class="keyword">let</span> oranges <span class="operator">=</span> <span class="number">5</span></span><br><span class="line"><span class="keyword">let</span> appleSummary <span class="operator">=</span> <span class="string">&quot;I have <span class="subst">\(apples)</span> apples.&quot;</span></span><br><span class="line"><span class="keyword">let</span> fruitSummary <span class="operator">=</span> <span class="string">&quot;I have <span class="subst">\(apples <span class="operator">+</span> oranges)</span> pieces of fruit.&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>ã€å®éªŒã€‘</p><p>åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ä½¿ç”¨ <code>\()</code> å»åŒ…å«ä¸€ä¸ªæµ®ç‚¹æ•°è®¡ç®—ï¼Œå†åŒ…å«æŸäººçš„åå­—æ¥å’Œä»–æ‰“ä¸ªæ‹›å‘¼ã€‚</p></blockquote><p>ç”¨ä¸‰ä¸ªåŒå¼•å·ï¼ˆ<code>&quot;&quot;&quot;</code>ï¼‰å¯ä»¥å†™å¤šè¡Œçš„å­—ç¬¦ä¸²ã€‚å…¶ä¸­æ¯è¡Œå‰é¢çš„ã€å¯¹é½ç»“æŸå¼•å·çš„ç¼©è¿›ä¼šè¢«è‡ªåŠ¨ç§»é™¤ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> quotation <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">I said &quot;I have <span class="subst">\(apples)</span> apples.&quot;</span></span><br><span class="line"><span class="string">And then I said &quot;I have <span class="subst">\(apples <span class="operator">+</span> oranges)</span> pieces of fruit.&quot;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>ç”¨æ–¹æ‹¬å·ï¼ˆ<code>[]</code>ï¼‰å¯ä»¥åˆ›å»ºæ•°ç»„æˆ–å­—å…¸ã€‚é€šè¿‡åœ¨æ–¹æ‹¬å·ä¸­å†™ç´¢å¼•æˆ–é”®ï¼Œå¯ä»¥å–å‡ºå…¶ä¸­å…ƒç´ ã€‚åœ¨æœ€åä¸€ä¸ªå…ƒç´ åé¢åŠ ä¸ªé€—å·ä¹Ÿæ˜¯è¢«å…è®¸çš„ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> shoppingList <span class="operator">=</span> [<span class="string">&quot;catfish&quot;</span>, <span class="string">&quot;water&quot;</span>, <span class="string">&quot;tulips&quot;</span>]</span><br><span class="line">shoppingList[<span class="number">1</span>] <span class="operator">=</span> <span class="string">&quot;bottle of water&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> occupations <span class="operator">=</span> [</span><br><span class="line">    <span class="string">&quot;Malcolm&quot;</span>: <span class="string">&quot;Captain&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Kaylee&quot;</span>: <span class="string">&quot;Mechanic&quot;</span>,</span><br><span class="line">]</span><br><span class="line">occupations[<span class="string">&quot;Jayne&quot;</span>] <span class="operator">=</span> <span class="string">&quot;Public Relations&quot;</span></span><br></pre></td></tr></table></figure><p>å½“æ·»åŠ å…ƒç´ æ—¶ï¼Œæ•°ç»„ä¼šè‡ªåŠ¨å¢é•¿ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shoppingList.append(<span class="string">&quot;blue paint&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(shoppingList)</span><br></pre></td></tr></table></figure><p>å¦‚æœè¦åˆ›å»ºç©ºæ•°ç»„æˆ–å­—å…¸ï¼Œéœ€è¦ä½¿ç”¨æ„é€ å™¨è¯­æ³•ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> emptyArray <span class="operator">=</span> [<span class="type">String</span>]()</span><br><span class="line"><span class="keyword">let</span> emptyDictionary <span class="operator">=</span> [<span class="type">String</span>: <span class="type">Float</span>]()</span><br></pre></td></tr></table></figure><p>å¦‚æœç±»å‹å¯ä»¥è¢«æ¨æ–­å‡ºæ¥ï¼Œé‚£ä½ å°±å¯ä»¥æŠŠç©ºæ•°ç»„å†™æˆ <code>[]</code>ï¼ŒæŠŠç©ºå­—å…¸å†™æˆ <code>[:]</code>â€”â€”ä¾‹å¦‚ï¼Œå½“ä½ ç»™å˜é‡è®¾ç½®æ–°çš„å€¼ï¼Œæˆ–ç»™å‡½æ•°ä¼ å‚æ•°çš„æ—¶å€™å°±å¯ä»¥è¿™ä¹ˆåšã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shoppingList <span class="operator">=</span> []</span><br><span class="line">occupations <span class="operator">=</span> [:]</span><br></pre></td></tr></table></figure><h2 id="æ§åˆ¶æµ"><a href="#æ§åˆ¶æµ" class="headerlink" title="æ§åˆ¶æµ"></a>æ§åˆ¶æµ</h2><p>ç”¨ <code>if</code> å’Œ <code>switch</code> æ¥å†™æ¡ä»¶è¯­å¥ï¼Œç”¨ <code>for-in</code>ã€<code>while</code> å’Œ <code>repeat-while</code> æ¥å†™è¿­ä»£è¯­å¥ã€‚æ¡ä»¶æˆ–å¾ªç¯å˜é‡å‰åçš„å°æ‹¬å·æ˜¯å¯é€‰çš„ï¼Œå¾ªç¯/æ¡ä»¶ä¸»ä½“å‰åçš„å¤§æ‹¬å·æ˜¯å¿…é¡»çš„ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> individualScores <span class="operator">=</span> [<span class="number">75</span>, <span class="number">43</span>, <span class="number">103</span>, <span class="number">87</span>, <span class="number">12</span>]</span><br><span class="line"><span class="keyword">var</span> teamScore <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> score <span class="keyword">in</span> individualScores &#123;</span><br><span class="line">    <span class="keyword">if</span> score <span class="operator">&gt;</span> <span class="number">50</span> &#123;</span><br><span class="line">        teamScore <span class="operator">+=</span> <span class="number">3</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        teamScore <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(teamScore)</span><br><span class="line"><span class="comment">// Prints &quot;11&quot;</span></span><br></pre></td></tr></table></figure><p>åœ¨ <code>if</code> è¯­å¥ä¸­ï¼Œæ¡ä»¶å¿…é¡»æ˜¯å€¼ä¸ºå¸ƒå°”å‹çš„è¡¨è¾¾å¼â€”â€”è¿™æ„å‘³ç€ç±»ä¼¼äº <code>if score &#123;...&#125;</code> è¿™æ ·çš„ä»£ç æ˜¯é”™è¯¯çš„ï¼Œå…¶ä»–ç±»å‹çš„å€¼ä¸ä¼šè‡ªåŠ¨è½¬åŒ–ä¸ºå¸ƒå°”å€¼ã€‚</p><p>ä½ å¯ä»¥ä½¿ç”¨ <code>if</code> å’Œ <code>let</code> é…åˆå·¥ä½œï¼Œæ¥å¤„ç†å¯èƒ½ç¼ºå¤±çš„å€¼ã€‚è¿™äº›å€¼ä½¿ç”¨å¯é€‰é¡¹è¡¨ç¤ºã€‚ä¸€ä¸ªå¯é€‰çš„å€¼è¦ä¹ˆæ˜¯ä¸€ä¸ªæ˜ç¡®çš„å€¼ï¼Œè¦ä¹ˆæ˜¯ <code>nil</code> æ¥ä»£è¡¨è¯¥å€¼ç¼ºå¤±ã€‚åœ¨å€¼çš„ç±»å‹åé¢åŠ ä¸€ä¸ªé—®å·ï¼ˆ <code>?</code>ï¼‰æ¥è¡¨ç¤ºè¯¥å€¼å¯é€‰ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> optionalString: <span class="type">String</span>? <span class="operator">=</span> <span class="string">&quot;Hello&quot;</span></span><br><span class="line"><span class="built_in">print</span>(optionalString <span class="operator">==</span> <span class="literal">nil</span>)</span><br><span class="line"><span class="comment">// Prints &quot;false&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> optionalName: <span class="type">String</span>? <span class="operator">=</span> <span class="string">&quot;John Appleseed&quot;</span></span><br><span class="line"><span class="keyword">var</span> greeting <span class="operator">=</span> <span class="string">&quot;Hello!&quot;</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> name <span class="operator">=</span> optionalName &#123;</span><br><span class="line">    greeting <span class="operator">=</span> <span class="string">&quot;Hello, <span class="subst">\(name)</span>&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ã€å®éªŒã€‘</p><p>å°†ä¸Šè¿°ä»£ç ä¸­çš„ <code>optionalName</code> å€¼æ”¹ä¸º <code>nil</code>ï¼Œçœ‹çœ‹ä½ ä¼šå¾—åˆ°ä»€ä¹ˆã€‚åŠ ä¸€ä¸ª <code>else</code> æƒ…å†µæ¥å½“ <code>optionalName</code> ä¸º <code>nil</code> æ—¶ä¸ºé—®å€™è®¾ç½®ä¸€ä¸ªé»˜è®¤å€¼ã€‚</p></blockquote><p>å¦‚æœå¯é€‰å€¼ä¸º <code>nil</code>ï¼Œåˆ™æ¡ä»¶ä¸º <code>false</code>ï¼Œåœ¨å¤§æ‹¬å·ä¸­çš„ä»£ç ä¼šè¢«è·³è¿‡ã€‚å¦åˆ™ï¼Œå¯é€‰å€¼ä¼šæŠŠå…¶ä»£è¡¨çš„å€¼èµ‹ç»™ <code>let</code> åé¢çš„å¸¸é‡ï¼Œè¿™æ ·è¿™ä¸ªå€¼å°±å¯ä»¥åœ¨å¤§æ‹¬å·é‡Œä½¿ç”¨äº†ã€‚</p><p>å¦ä¸€ç§å¯¹å¯é€‰å€¼çš„å¤„ç†æ˜¯ä½¿ç”¨ <code>??</code> è¿ç®—ç¬¦æ¥æä¾›é»˜è®¤å€¼ã€‚åˆ©ç”¨è¿™ç§æ–¹æ³•ï¼Œä¸€æ—¦å¯é€‰å€¼ç¼ºå¤±ï¼Œåˆ™é»˜è®¤å€¼å°±ä¼šæ›¿ä»£å®ƒã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> nickName: <span class="type">String</span>? <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line"><span class="keyword">let</span> fullName: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;John Appleseed&quot;</span></span><br><span class="line"><span class="keyword">let</span> informalGreeting <span class="operator">=</span> <span class="string">&quot;Hi <span class="subst">\(nickName <span class="operator">??</span> fullName)</span>&quot;</span></span><br></pre></td></tr></table></figure><p><code>switch</code> è¯­å¥å¯ä»¥æ¥å—ä»»ä½•ç±»å‹çš„æ•°æ®ä»¥åŠå¤šæ ·çš„æ¯”è¾ƒè¿ç®—â€”â€”ä¸å±€é™äºæ•´æ•°å’Œæµ‹è¯•ç›¸ç­‰ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> vegetable <span class="operator">=</span> <span class="string">&quot;red pepper&quot;</span></span><br><span class="line"><span class="keyword">switch</span> vegetable &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;celery&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Add some raisins and make ants on a log.&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;cucumber&quot;</span>, <span class="string">&quot;watercress&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;That would make a good tea sandwich.&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> x <span class="keyword">where</span> x.hasSuffix(<span class="string">&quot;pepper&quot;</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Is it a spicy <span class="subst">\(x)</span>?&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Everything tastes good in soup.&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Prints &quot;Is it a spicy red pepper?&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>ã€å®éªŒã€‘</p><p>å°è¯•ç§»é™¤ <code>default</code> é€‰é¡¹ï¼Œçœ‹çœ‹ä¼šå¾—åˆ°ä»€ä¹ˆé”™è¯¯ã€‚</p></blockquote><p>æ³¨æ„ <code>let</code> å¯ä»¥ä½¿åŒ¹é…æŸä¸ªæ¨¡å¼çš„å€¼èµ‹ç»™ä¸€ä¸ªå¸¸é‡ã€‚</p><p>åœ¨ <code>switch</code> è¯­å¥ä¸­ï¼Œæ‰§è¡Œäº†åŒ¹é…çš„ <code>case</code> æƒ…å†µåï¼Œç¨‹åºä¼šè‡ªåŠ¨é€€å‡º <code>switch</code> è¯­å¥ï¼Œè€Œä¸ä¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ª <code>case</code> çš„ä»£ç ã€‚æ‰€ä»¥ï¼Œä¸å¿…åœ¨æ¯ä¸ª <code>case</code> çš„ä»£ç ç»“å°¾å†™ <code>break</code>ã€‚</p><p>ç”¨ <code>for-in</code> æ¥è¿­ä»£å­—å…¸ä¸­çš„å…ƒç´ ï¼Œæä¾›ä¸€å¯¹åå­—æ¥å–ç”¨æ¯ä¸€ä¸ª key-value å¯¹ã€‚å­—å…¸æ˜¯æ— åºé›†åˆï¼Œæ‰€ä»¥é”®å€¼å¯¹ä¼šä»¥éšæœºé¡ºåºè¿›è¡Œè¿­ä»£ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> interestingNumbers <span class="operator">=</span> [</span><br><span class="line">    <span class="string">&quot;Prime&quot;</span>: [<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>],</span><br><span class="line">    <span class="string">&quot;Fibonacci&quot;</span>: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>],</span><br><span class="line">    <span class="string">&quot;Square&quot;</span>: [<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>],</span><br><span class="line">]</span><br><span class="line"><span class="keyword">var</span> largest <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> (kind, numbers) <span class="keyword">in</span> interestingNumbers &#123;</span><br><span class="line">    <span class="keyword">for</span> number <span class="keyword">in</span> numbers &#123;</span><br><span class="line">        <span class="keyword">if</span> number <span class="operator">&gt;</span> largest &#123;</span><br><span class="line">            largest <span class="operator">=</span> number</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(largest)</span><br><span class="line"><span class="comment">// Prints &quot;25&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>ã€å®éªŒã€‘</p><p>æ·»åŠ ä¸€ä¸ªå˜é‡æ¥è®°å½•å“ªä¸€ç±»æ•°æœ€å¤§ã€æœ€å¤§çš„æ•°æ˜¯å¤šå°‘ã€‚</p></blockquote><p>ç”¨ <code>while</code> é‡å¤ä¸€å—ä»£ç ï¼Œç›´åˆ°æ¡ä»¶æ”¹å˜ã€‚å¾ªç¯çš„æ¡ä»¶ä¹Ÿå¯ä»¥è¢«æ”¾åœ¨æœ«å°¾ï¼Œä»¥ç¡®ä¿å¾ªç¯è¢«è¿è¡Œè‡³å°‘ä¸€æ¬¡ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> n <span class="operator">=</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">while</span> n <span class="operator">&lt;</span> <span class="number">100</span> &#123;</span><br><span class="line">    n <span class="operator">*=</span> <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="comment">// Prints &quot;128&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> m <span class="operator">=</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">repeat</span> &#123;</span><br><span class="line">    m <span class="operator">*=</span> <span class="number">2</span></span><br><span class="line">&#125; <span class="keyword">while</span> m <span class="operator">&lt;</span> <span class="number">100</span></span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="comment">// Prints &quot;128&quot;</span></span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥ç”¨ <code>..&lt;</code> æ¥åˆ›å»ºä¸€ç³»åˆ—åœ¨é¡ºåºçš„ç´¢å¼•ï¼Œå¹¶åœ¨ <code>for</code> å¾ªç¯ä¸­è¿­ä»£ä¹‹ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> total <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span><span class="number">4</span> &#123;</span><br><span class="line">    total <span class="operator">+=</span> i</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(total)</span><br><span class="line"><span class="comment">// Prints &quot;6&quot;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>..&lt;</code> åˆ›å»ºçš„åºåˆ—ä¸åŒ…æ‹¬ä¸Šç•Œï¼Œç”¨ <code>...</code> åˆ›å»ºçš„åºåˆ—åŒ…æ‹¬ä¸Šä¸‹ç•Œã€‚</p><h2 id="å‡½æ•°å’Œé—­åŒ…"><a href="#å‡½æ•°å’Œé—­åŒ…" class="headerlink" title="å‡½æ•°å’Œé—­åŒ…"></a>å‡½æ•°å’Œé—­åŒ…</h2><p>ç”¨ <code>func</code> æ¥å£°æ˜å‡½æ•°ã€‚è°ƒç”¨å‡½æ•°æ—¶ï¼Œå†™å‡½æ•°çš„åå­—ï¼Œå¹¶åœ¨å…¶åå†™ä¸€å¯¹åœ†æ‹¬å·ï¼Œæ‹¬å·é‡Œé¢æ˜¯ä¸€ç³»åˆ—å‚æ•°ã€‚ç”¨ <code>-&gt;</code> æ¥åˆ†éš”å‚æ•°åˆ—è¡¨å’Œè¿”å›å€¼ç±»å‹ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">greet</span><span class="params">(person: String, day: String)</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello <span class="subst">\(person)</span>, today is <span class="subst">\(day)</span>.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">greet(person: <span class="string">&quot;Bob&quot;</span>, day: <span class="string">&quot;Tuesday&quot;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>ã€å®éªŒã€‘</p><p>æŠŠå‚æ•° <code>day</code> ç§»é™¤ï¼Œæ·»åŠ ä¸€ä¸ªåŒ…å«ä»Šå¤©åˆé¤åƒä»€ä¹ˆçš„å‚æ•°ï¼Œå°†å…¶æ·»åŠ åˆ°æ¬¢è¿è¯­å¥é‡Œã€‚</p></blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå‡½æ•°ç”¨å½¢å¼å‚æ•°çš„åç§°ä½œä¸ºå®é™…å‚æ•°çš„æ ‡ç­¾ã€‚ä¹Ÿå¯ä»¥åœ¨å½¢å‚å‰é¢åŠ ä¸Šè‡ªå®šä¹‰çš„å®å‚æ ‡ç­¾ï¼Œæˆ–è€…å†™ <code>_</code> æ¥æŒ‡æ˜æ— éœ€æ ‡ç­¾ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">greet</span><span class="params">(<span class="keyword">_</span> person: String, on day: String)</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello <span class="subst">\(person)</span>, today is <span class="subst">\(day)</span>.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">greet(<span class="string">&quot;John&quot;</span>, on: <span class="string">&quot;Wednesday&quot;</span>)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å…ƒç»„å¯ä»¥åˆ›å»ºå¤åˆå€¼â€”â€”ä¾‹å¦‚ï¼Œä»å‡½æ•°ä¸­è¿”å›å¤šä¸ªå€¼ã€‚å…ƒç»„ä¸­çš„å…ƒç´ å¯ä»¥é€šè¿‡åå­—æˆ–ç´¢å¼•è°ƒç”¨ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calculateStatistics</span><span class="params">(scores: [Int])</span></span> -&gt; (min: <span class="type">Int</span>, max: <span class="type">Int</span>, sum: <span class="type">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> min <span class="operator">=</span> scores[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">var</span> max <span class="operator">=</span> scores[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">var</span> sum <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> score <span class="keyword">in</span> scores &#123;</span><br><span class="line">        <span class="keyword">if</span> score <span class="operator">&gt;</span> max &#123;</span><br><span class="line">            max <span class="operator">=</span> score</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> score <span class="operator">&lt;</span> min &#123;</span><br><span class="line">            min <span class="operator">=</span> score</span><br><span class="line">        &#125;</span><br><span class="line">        sum <span class="operator">+=</span> score</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (min, max, sum)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> statistics <span class="operator">=</span> calculateStatistics(scores: [<span class="number">5</span>, <span class="number">3</span>, <span class="number">100</span>, <span class="number">3</span>, <span class="number">9</span>])</span><br><span class="line"><span class="built_in">print</span>(statistics.sum)</span><br><span class="line"><span class="comment">// Prints &quot;120&quot;</span></span><br><span class="line"><span class="built_in">print</span>(statistics.<span class="number">2</span>)</span><br><span class="line"><span class="comment">// Prints &quot;120&quot;</span></span><br></pre></td></tr></table></figure><p>å‡½æ•°å¯ä»¥åµŒå¥—ã€‚åµŒå¥—çš„å†…éƒ¨å‡½æ•°å¯ä»¥è®¿é—®å¤–éƒ¨å‡½æ•°ä¸­çš„å˜é‡ã€‚ä½ å¯ä»¥ç”¨åµŒå¥—å‡½æ•°æ¥ç»„ç»‡ä»£ç ï¼Œä»¥å…ä¸€ä¸ªå‡½æ•°å¤ªé•¿ã€å¤ªå¤æ‚ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">returnFifteen</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> y <span class="operator">=</span> <span class="number">10</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">()</span></span> &#123;</span><br><span class="line">        y <span class="operator">+=</span> <span class="number">5</span></span><br><span class="line">    &#125;</span><br><span class="line">    add()</span><br><span class="line">    <span class="keyword">return</span> y</span><br><span class="line">&#125;</span><br><span class="line">returnFifteen()</span><br></pre></td></tr></table></figure><p>å‡½æ•°æ˜¯<em>ç¬¬ä¸€ç±»å¯¹è±¡</em>ã€‚è¿™æ„å‘³ç€ä¸€ä¸ªå‡½æ•°å¯ä»¥è¿”å›å¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºè¿”å›å€¼ã€‚</p><blockquote><p>ã€è¯‘è€…æ³¨ã€‘From Wikipedia</p><p><strong>ç¬¬ä¸€ç±»å¯¹è±¡</strong>ï¼ˆè‹±è¯­ï¼šFirst-class objectï¼‰åœ¨<a href="https://zh.wikipedia.org/wiki/%E9%9B%BB%E8%85%A6%E7%A7%91%E5%AD%B8">è®¡ç®—æœºç§‘å­¦</a>ä¸­æŒ‡å¯ä»¥åœ¨<a href="https://zh.wikipedia.org/wiki/%E5%9F%B7%E8%A1%8C%E6%9C%9F">æ‰§è¡ŒæœŸ</a>åˆ›é€ å¹¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°æˆ–å­˜å…¥ä¸€ä¸ª<a href="https://zh.wikipedia.org/wiki/%E8%AE%8A%E6%95%B8">å˜æ•°</a>çš„å®ä½“[<a href="https://zh.wikipedia.org/wiki/%E7%AC%AC%E4%B8%80%E9%A1%9E%E7%89%A9%E4%BB%B6#cite_note-1">1]</a>ã€‚å°†ä¸€ä¸ªå®ä½“å˜ä¸ºç¬¬ä¸€ç±»å¯¹è±¡çš„è¿‡ç¨‹å«åšâ€œ<a href="https://zh.wikipedia.org/wiki/%E7%89%A9%E4%BB%B6%E5%8C%96">ç‰©ä»¶åŒ–</a>â€ï¼ˆReificationï¼‰[<a href="https://zh.wikipedia.org/wiki/%E7%AC%AC%E4%B8%80%E9%A1%9E%E7%89%A9%E4%BB%B6#cite_note-2">2]</a>ã€‚</p></blockquote><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makeIncrementer</span><span class="params">()</span></span> -&gt; ((<span class="type">Int</span>) -&gt; <span class="type">Int</span>) &#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">addOne</span><span class="params">(number: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> <span class="operator">+</span> number</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> addOne</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> increment <span class="operator">=</span> makeIncrementer()</span><br><span class="line">increment(<span class="number">7</span>)</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªå‡½æ•°ä¹Ÿå¯ä»¥æ¥å—å…¶ä»–å‡½æ•°ä½œä¸ºå‚æ•°ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hasAnyMatches</span><span class="params">(list: [Int], condition: <span class="params">(Int)</span></span></span> -&gt; <span class="type">Bool</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> list &#123;</span><br><span class="line">        <span class="keyword">if</span> condition(item) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">lessThanTen</span><span class="params">(number: Int)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> number <span class="operator">&lt;</span> <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> numbers <span class="operator">=</span> [<span class="number">20</span>, <span class="number">19</span>, <span class="number">7</span>, <span class="number">12</span>]</span><br><span class="line">hasAnyMatches(list: numbers, condition: lessThanTen)</span><br></pre></td></tr></table></figure><p>å‡½æ•°å…¶å®æ˜¯ä¸€ç§ç‰¹æ®Šæƒ…å½¢çš„é—­åŒ…ï¼šä¸€å—å¯ä»¥è¢«ç¨åè°ƒç”¨çš„ä»£ç ã€‚åœ¨é—­åŒ…ä¸­çš„ä»£ç å¯ä»¥è®¿é—®å­˜åœ¨äºå…¶å£°æ˜æ—¶çš„ä½œç”¨åŸŸçš„å˜é‡æˆ–å‡½æ•°ç­‰ä¸œè¥¿ï¼Œå“ªæ€•è¿™ä¸ªé—­åŒ…åœ¨å…¶ä»–ä½œç”¨åŸŸä¸­è¢«è°ƒç”¨æ‰§è¡Œâ€”â€”åµŒå¥—å‡½æ•°æ­£æ˜¯è¿™æ ·çš„ä¾‹å­ã€‚ä½ å¯ä»¥è¿™æ ·å†™ä¸€ä¸ªé—­åŒ…ï¼šå†™ä¸€æ®µæ²¡æœ‰åå­—çš„ã€ç”¨èŠ±æ‹¬å·ï¼ˆ<code>&#123;&#125;</code>ï¼‰åŒ…è£¹çš„ä»£ç ã€‚ç”¨ <code>in</code> æ¥å°†å‚æ•°ã€è¿”å›å€¼åŒä¸»ä½“ä»£ç åˆ†ç¦»ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">numbers.map(&#123; (number: <span class="type">Int</span>) -&gt; <span class="type">Int</span> <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">let</span> result <span class="operator">=</span> <span class="number">3</span> <span class="operator">*</span> number</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>ã€å®éªŒã€‘</p><p>é‡å†™é—­åŒ…ï¼Œä½¿æ‰€æœ‰çš„å¥‡æ•°è¿”å›é›¶ã€‚</p></blockquote><p>ä½ è¿˜æœ‰æ›´å¤šçš„é€‰æ‹©æ¥æŠŠé—­åŒ…å†™å¾—æ›´ç®€æ´ã€‚å½“é—­åŒ…çš„ç±»å‹æ˜ç¡®æ—¶ï¼Œä¾‹å¦‚ä¸€ä¸ªå§”æ‰˜çš„å›è°ƒï¼Œä½ å¯ä»¥çœç•¥å‚æ•°çš„ç±»å‹ï¼Œæˆ–çœç•¥è¿”å›å€¼çš„ç±»å‹ï¼Œæˆ–ä¸¤è€…éƒ½çœç•¥ã€‚å•è¯­å¥çš„é—­åŒ…éšå¼åœ°è¿”å›è¯¥è¯­å¥çš„å€¼ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mappedNumbers <span class="operator">=</span> numbers.map(&#123; number <span class="keyword">in</span> <span class="number">3</span> <span class="operator">*</span> number &#125;)</span><br><span class="line"><span class="built_in">print</span>(mappedNumbers)</span><br><span class="line"><span class="comment">// Prints &quot;[60, 57, 21, 36]&quot;</span></span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥ç”¨æ•°å­—è€Œéåç§°æ¥ä½¿ç”¨å‚æ•°â€”â€”è¿™ä¸ªæ–¹æ³•åœ¨æå…¶ç®€çŸ­çš„é—­åŒ…ä¸­å°¤ä¸ºå®ç”¨ã€‚ä¸€ä¸ªé—­åŒ…ä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°ä¼ ç»™å‡½æ•°æ—¶ï¼Œå¯ä»¥ç›´æ¥å†™åœ¨åœ†æ‹¬å·åé¢ã€‚å½“ä¸€ä¸ªé—­åŒ…æ˜¯ä¸€ä¸ªå‡½æ•°å”¯ä¸€çš„å‚æ•°æ—¶ï¼Œå¯ä»¥ç›´æ¥çœç•¥åœ†æ‹¬å·ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sortedNumbers <span class="operator">=</span> numbers.sorted &#123; <span class="variable">$0</span> <span class="operator">&gt;</span> <span class="variable">$1</span> &#125;</span><br><span class="line"><span class="built_in">print</span>(sortedNumbers)</span><br><span class="line"><span class="comment">// Prints &quot;[20, 19, 12, 7]&quot;</span></span><br></pre></td></tr></table></figure><h2 id="å¯¹è±¡å’Œç±»"><a href="#å¯¹è±¡å’Œç±»" class="headerlink" title="å¯¹è±¡å’Œç±»"></a>å¯¹è±¡å’Œç±»</h2><p>åœ¨å…³é”®å­— <code>class</code> ååŠ ä¸Šç±»çš„åå­—æ¥åˆ›å»ºä¸€ä¸ªç±»ã€‚ç±»ä¸­å±æ€§çš„å£°æ˜å’Œå¸¸é‡ã€å˜é‡çš„å£°æ˜æ–¹å¼æ˜¯ç›¸åŒçš„ï¼Œå”¯ä¸€çš„ä¸€å®šåŒºåˆ«æ˜¯å±æ€§å£°æ˜æ˜¯å†™åœ¨ä¸€ä¸ªç±»é‡Œé¢çš„ã€‚åŒæ ·åœ°ï¼Œæ–¹æ³•å’Œå‡½æ•°çš„å£°æ˜ä¹Ÿæ˜¯åŒä¹‹å‰çš„å†™æ³•ä¸€æ ·ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> numberOfSides <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">simpleDescription</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;A shape with <span class="subst">\(numberOfSides)</span> sides.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ã€å®éªŒã€‘</p><p>ç”¨ <code>let</code> æ·»åŠ ä¸€ä¸ªå¸¸é‡å±æ€§ï¼Œå†å†™ä¸€ä¸ªæ¥å—å‚æ•°çš„æ–¹æ³•ã€‚</p></blockquote><p>åœ¨ç±»ååé¢æ”¾ä¸€å¯¹åœ†æ‹¬å·æ¥åˆ›å»ºç±»çš„å®ä¾‹ã€‚ç”¨<em>ç‚¹</em>è¯­æ³•æ¥å–å®ä¾‹ä¸­çš„å±æ€§å’Œæ–¹æ³•ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> shape <span class="operator">=</span> <span class="type">Shape</span>()</span><br><span class="line">shape.numberOfSides <span class="operator">=</span> <span class="number">7</span></span><br><span class="line"><span class="keyword">var</span> shapeDescription <span class="operator">=</span> shape.simpleDescription()</span><br></pre></td></tr></table></figure><p>åœ¨åˆšæ‰å†™çš„è¿™ä¸€ç‰ˆæœ¬ <code>Shape</code> ç±»ä¸­ï¼Œç¼ºå°‘äº†ä¸€ä¸ªé‡è¦çš„ä¸œè¥¿ï¼šç”¨æ¥åœ¨å®ä¾‹è¢«åˆ›å»ºæ—¶å¯¹ç±»è¿›è¡Œè®¾ç½®çš„<strong>æ„é€ å™¨</strong>ã€‚ç”¨ <code>init</code> æ¥åˆ›å»ºä¸€ä¸ªæ„é€ å™¨ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NamedShape</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> numberOfSides: <span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(name: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name <span class="operator">=</span> name</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">simpleDescription</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;A shape with <span class="subst">\(numberOfSides)</span> sides.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ <code>self</code> çš„ä½¿ç”¨åŒºåˆ†äº†æ„é€ å™¨çš„å‚æ•° <code>name</code> ä¸ç±»çš„å±æ€§ <code>name</code>ã€‚åœ¨åˆ›å»ºç±»çš„å®ä¾‹æ—¶ï¼Œä¼ å…¥æ„é€ å™¨çš„å‚æ•°å’Œè°ƒç”¨å‡½æ•°æ—¶çš„ä¼ å‚å¾ˆç±»ä¼¼ã€‚æ¯ä¸€ä¸ªå±æ€§éƒ½éœ€è¦è¢«èµ‹å€¼â€”â€”è¦ä¹ˆåœ¨å£°æ˜æ—¶èµ‹å€¼ï¼ˆæ¯”å¦‚ <code>numberOfSides</code>ï¼‰ï¼Œè¦ä¹ˆåœ¨æ„é€ å™¨ä¸­èµ‹å€¼ï¼ˆæ¯”å¦‚ <code>name</code>ï¼‰ã€‚</p><p>å¦‚æœä½ éœ€è¦åœ¨å¯¹è±¡è¢«é”€æ¯å‰æ‰§è¡Œä¸€äº›æ¸…ç†å·¥ä½œçš„è¯ï¼Œç”¨ <code>deinit</code> æ¥åˆ›å»ºä¸€ä¸ªææ„å™¨ï¼ˆè¯‘æ³¨ï¼Œä¸ºä¿æŒç®€æ´ï¼Œæˆ‘å€Ÿç”¨äº†C++é‡Œæ„é€ å‡½æ•°/ææ„å‡½æ•°çš„è¯´æ³•ï¼Œdeinitializer ç›´è¯‘ä¸ºåæ„é€ å™¨ï¼‰ã€‚</p><p>å­ç±»åº”è¯¥åœ¨å…¶ç±»ååé¢å†™ä¸Šçˆ¶ç±»çš„åç§°ï¼Œç”¨åˆ†å·åˆ†éš”ã€‚Swift ä¸è¦æ±‚ä¸€ä¸ªç±»å¿…é¡»ä»æŸä¸ªæ ‡å‡†çš„æ ¹ç±»å¼€å§‹ç»§æ‰¿ï¼Œæ‰€ä»¥ä½ å¯ä»¥æŒ‰éœ€æ±‚åŒ…æ‹¬æˆ–çœç•¥çˆ¶ç±»ã€‚</p><p>å¦‚æœå­ç±»ä¸­éœ€è¦é‡å†™çˆ¶ç±»ä¸­å®ç°çš„æ–¹æ³•ï¼Œéœ€è¦æ ‡æ³¨ <code>override</code> ä»¥å¼ºè°ƒæ˜¯é‡å†™ï¼Œå¦åˆ™ä¼šè¢«ç¼–è¯‘å™¨è®¤ä¸ºæ˜¯é”™è¯¯ã€‚ç¼–è¯‘å™¨åŒæ ·ä¼šæ£€æµ‹å‡ºæ ‡è®°äº† <code>override</code> ä½†åœ¨çˆ¶ç±»ä¸­æ²¡æœ‰å®ç°çš„æ–¹æ³•ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span>: <span class="title">NamedShape</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> sideLength: <span class="type">Double</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(sideLength: <span class="type">Double</span>, name: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.sideLength <span class="operator">=</span> sideLength</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(name: name)</span><br><span class="line">        numberOfSides <span class="operator">=</span> <span class="number">4</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">area</span><span class="params">()</span></span> -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sideLength <span class="operator">*</span> sideLength</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">simpleDescription</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;A square with sides of length <span class="subst">\(sideLength)</span>.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> test <span class="operator">=</span> <span class="type">Square</span>(sideLength: <span class="number">5.2</span>, name: <span class="string">&quot;my test square&quot;</span>)</span><br><span class="line">test.area()</span><br><span class="line">test.simpleDescription()</span><br></pre></td></tr></table></figure><blockquote><p>ã€å®éªŒã€‘</p><p>åˆ›å»º <code>NamedShape</code> çš„å¦ä¸€ä¸ªå­ç±» <code>Circle</code>ï¼Œè¯¥ç±»çš„æ„é€ å™¨æ¥å—åŠå¾„radius å’Œ åå­—name ä¸¤ä¸ªå‚æ•°ã€‚åœ¨ <code>Circle</code> ä¸­å®ç° <code>area()</code> å’Œ <code>simpleDescription()</code> æ–¹æ³•ã€‚</p></blockquote><p>é™¤äº†å·²ç»æåŠçš„ç®€å•å±æ€§ï¼Œå±æ€§è¿˜å¯ä»¥æ‹¥æœ‰ getter å’Œ setterã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EquilateralTriangle</span>: <span class="title">NamedShape</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> sideLength: <span class="type">Double</span> <span class="operator">=</span> <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(sideLength: <span class="type">Double</span>, name: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.sideLength <span class="operator">=</span> sideLength</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(name: name)</span><br><span class="line">        numberOfSides <span class="operator">=</span> <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> perimeter: <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">3.0</span> <span class="operator">*</span> sideLength</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            sideLength <span class="operator">=</span> newValue <span class="operator">/</span> <span class="number">3.0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">simpleDescription</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;An equilateral triangle with sides of length <span class="subst">\(sideLength)</span>.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> triangle <span class="operator">=</span> <span class="type">EquilateralTriangle</span>(sideLength: <span class="number">3.1</span>, name: <span class="string">&quot;a triangle&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(triangle.perimeter)</span><br><span class="line"><span class="comment">// Prints &quot;9.3&quot;</span></span><br><span class="line">triangle.perimeter <span class="operator">=</span> <span class="number">9.9</span></span><br><span class="line"><span class="built_in">print</span>(triangle.sideLength)</span><br><span class="line"><span class="comment">// Prints &quot;3.3000000000000003&quot;</span></span><br></pre></td></tr></table></figure><p>åœ¨ <code>perimeter</code> çš„ setter ä¸­ï¼Œæ–°çš„å€¼è¢«è‡ªåŠ¨å‘½åä¸º <code>newValue</code>ã€‚ä½ ä¹Ÿå¯ä»¥æä¾›ä¸€ä¸ªè‡ªå®šä¹‰çš„åç§°ï¼Œè¿™ä¸ªåç§°åœ¨ <code>set</code> åé¢æ·»åŠ çš„ä¸€å¯¹åœ†æ‹¬å·é‡Œå†™æ˜ã€‚</p><p>æ³¨æ„ï¼Œåœ¨ <code>EquilateralTriangle</code> ç±»çš„æ„é€ å™¨ä¸­æœ‰ä¸‰ä¸ªä¸åŒçš„æ­¥éª¤ï¼š</p><ol><li>è®¾ç½®å­ç±»ä¸­å£°æ˜çš„å±æ€§å€¼ï¼›</li><li>è°ƒç”¨çˆ¶ç±»çš„æ„é€ å™¨ï¼›</li><li>ä¿®æ”¹çˆ¶ç±»ä¸­å®šä¹‰çš„å±æ€§å€¼ã€‚å…¶ä»–å„ç§éœ€è¦çš„ä½¿ç”¨æ–¹æ³•ã€getterã€setterçš„é™„åŠ è®¾ç½®ä¹Ÿåœ¨è¿™ä¸€æ­¥å®Œæˆã€‚</li></ol><p>å¦‚æœä½ ä¸éœ€è¦è®¡ç®—å±æ€§ï¼Œä½†æ˜¯éœ€è¦åœ¨è®¾ç½®ä¸€ä¸ªæ–°çš„å€¼çš„å‰åè¿è¡Œä¸€äº›ä»£ç ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>willSet</code> å’Œ <code>didSet</code>ã€‚åœ¨æ„é€ å™¨æ„å¤–æ”¹å˜å€¼æ—¶ï¼Œå…¶ä¸­çš„ä»£ç å°±ä¼šè¢«æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ç±»ä¿è¯ä¸‰è§’å½¢çš„è¾¹é•¿å§‹ç»ˆç­‰äºæ­£æ–¹å½¢çš„è¾¹é•¿ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TriangleAndSquare</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> triangle: <span class="type">EquilateralTriangle</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            square.sideLength <span class="operator">=</span> newValue.sideLength</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> square: <span class="type">Square</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            triangle.sideLength <span class="operator">=</span> newValue.sideLength</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">init</span>(size: <span class="type">Double</span>, name: <span class="type">String</span>) &#123;</span><br><span class="line">        square <span class="operator">=</span> <span class="type">Square</span>(sideLength: size, name: name)</span><br><span class="line">        triangle <span class="operator">=</span> <span class="type">EquilateralTriangle</span>(sideLength: size, name: name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> triangleAndSquare <span class="operator">=</span> <span class="type">TriangleAndSquare</span>(size: <span class="number">10</span>, name: <span class="string">&quot;another test shape&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(triangleAndSquare.square.sideLength)</span><br><span class="line"><span class="comment">// Prints &quot;10.0&quot;</span></span><br><span class="line"><span class="built_in">print</span>(triangleAndSquare.triangle.sideLength)</span><br><span class="line"><span class="comment">// Prints &quot;10.0&quot;</span></span><br><span class="line">triangleAndSquare.square <span class="operator">=</span> <span class="type">Square</span>(sideLength: <span class="number">50</span>, name: <span class="string">&quot;larger square&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(triangleAndSquare.triangle.sideLength)</span><br><span class="line"><span class="comment">// Prints &quot;50.0&quot;</span></span><br></pre></td></tr></table></figure><p>å½“ä½¿ç”¨å¯é€‰å€¼æ—¶ï¼Œä½ å¯ä»¥åœ¨æ–¹æ³•ã€å±æ€§ã€ä¸‹æ ‡ç­‰æ“ä½œå‰é¢å†™ <code>?</code>ã€‚å¦‚æœ <code>?</code> å‰é¢çš„å€¼æ˜¯ <code>nil</code>ï¼Œåˆ™ <code>?</code> åçš„ä¸€åˆ‡éƒ½ä¼šè¢«å¿½ç•¥ï¼Œæ•´ä¸ªè¡¨è¾¾å¼çš„å€¼ä¸º <code>nil</code>ã€‚å¦åˆ™ï¼Œå¯é€‰å€¼ä¼šè¢«å±•å¼€ï¼Œ<code>?</code> åçš„æ´»åŠ¨ä½œç”¨äºå±•å¼€çš„å€¼ã€‚åœ¨ä¸¤ç§æƒ…å†µä¸‹ï¼Œæ•´ä¸ªè¡¨è¾¾å¼çš„å€¼éƒ½æ˜¯å¯é€‰å€¼ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> optionalSquare: <span class="type">Square</span>? <span class="operator">=</span> <span class="type">Square</span>(sideLength: <span class="number">2.5</span>, name: <span class="string">&quot;optional square&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> sideLength <span class="operator">=</span> optionalSquare<span class="operator">?</span>.sideLength</span><br></pre></td></tr></table></figure><h2 id="æšä¸¾å’Œç»“æ„ä½“"><a href="#æšä¸¾å’Œç»“æ„ä½“" class="headerlink" title="æšä¸¾å’Œç»“æ„ä½“"></a>æšä¸¾å’Œç»“æ„ä½“</h2><p>ç”¨ <code>enum</code> æ¥åˆ›å»ºæšä¸¾ã€‚å’Œç±»ä»¥åŠå…¶ä»–æœ‰åå­—çš„ç±»å‹ä¸€æ ·ï¼Œæšä¸¾å¯ä»¥åŒ…å«å±äºè‡ªå·±çš„æ–¹æ³•ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Rank</span>: <span class="title">Int</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> ace <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">case</span> two, three, four, five, six, seven, eight, nine, ten</span><br><span class="line">    <span class="keyword">case</span> jack, queen, king</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">simpleDescription</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> .ace:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;ace&quot;</span></span><br><span class="line">        <span class="keyword">case</span> .jack:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;jack&quot;</span></span><br><span class="line">        <span class="keyword">case</span> .queen:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;queen&quot;</span></span><br><span class="line">        <span class="keyword">case</span> .king:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;king&quot;</span></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="type">String</span>(<span class="keyword">self</span>.rawValue)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> ace <span class="operator">=</span> <span class="type">Rank</span>.ace</span><br><span class="line"><span class="keyword">let</span> aceRawValue <span class="operator">=</span> ace.rawValue</span><br></pre></td></tr></table></figure><blockquote><p>ã€å®éªŒã€‘</p><p>å†™ä¸€ä¸ªé€šè¿‡åŸå§‹å€¼æ¥æ¯”è¾ƒä¸¤ä¸ª Rank å€¼çš„å‡½æ•°ã€‚</p></blockquote><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œswift ä¼šä»é›¶å¼€å§‹ä¸ºæšä¸¾æƒ…å†µèµ‹å€¼ï¼Œé€ä¸ªé€’å¢ã€‚ä½†ä½ å¯ä»¥é€šè¿‡ç›´æ¥æŒ‡å®šå€¼æ¥æ‰“ç ´è¿™ä¸€è§„å¾‹ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>Ace</code> è¢«ç›´æ¥èµ‹äºˆäº†åŸå§‹å€¼ <code>1</code>ï¼Œå…¶ä½™çš„å…ƒç´ éšå³è¢«é¡ºåºä¾æ¬¡èµ‹å€¼ã€‚ä½ ä¹Ÿå¯ä»¥åˆ›å»ºç”¨å­—ç¬¦ä¸²æˆ–æµ®ç‚¹æ•°æ¥ä½œä¸ºåŸå§‹å€¼çš„æšä¸¾ã€‚ç”¨ <code>rawValue</code> å±æ€§æ¥å–å‡ºä¸€ä¸ªæšä¸¾æƒ…å†µçš„åŸå§‹å€¼ã€‚</p><p>ç”¨æ„é€ å™¨ <code>init?(rawValue:)</code> æ¥ä»åŸå§‹å€¼å®ä¾‹åŒ–æšä¸¾å®ä¾‹ã€‚å½“æä¾›çš„åŸå§‹å€¼åŒ¹é…ä¸ŠæŸæšä¸¾æƒ…å†µæ—¶ï¼Œå®ƒè¿”å›è¯¥åŒ¹é…çš„æšä¸¾æƒ…å†µå®ä¾‹ï¼›å¦åˆ™ï¼Œæ²¡æœ‰åŒ¹é…çš„é¡¹å°±è¿”å› <code>nil</code>ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Suit</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> spades, hearts, diamonds, clubs</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">simpleDescription</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> .spades:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;spades&quot;</span></span><br><span class="line">        <span class="keyword">case</span> .hearts:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;hearts&quot;</span></span><br><span class="line">        <span class="keyword">case</span> .diamonds:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;diamonds&quot;</span></span><br><span class="line">        <span class="keyword">case</span> .clubs:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;clubs&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> hearts <span class="operator">=</span> <span class="type">Suit</span>.hearts</span><br><span class="line"><span class="keyword">let</span> heartsDescription <span class="operator">=</span> hearts.simpleDescription()</span><br></pre></td></tr></table></figure><blockquote><p>ã€å®éªŒã€‘</p><p>ä¸º <code>Suit</code> æ·»åŠ ä¸€ä¸ª <code>color()</code> å‡½æ•°ï¼Œå½“æšä¸¾æƒ…å†µæ˜¯ spades æˆ– clubs æ—¶è¯¥å‡½æ•°è¿”å› <code>black</code> ï¼Œå½“æšä¸¾æƒ…å†µæ˜¯ hearts æˆ– diamonds æ—¶è¯¥å‡½æ•°è¿”å› <code>red</code> ã€‚</p></blockquote><p>æ³¨æ„ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæšä¸¾æƒ…å†µ <code>hearts</code> çš„ä¸¤ç§è¡¨ç¤ºæ–¹å¼ï¼šå½“å°†è‡³èµ‹ç»™ <code>hearts</code> å¸¸é‡æ—¶ï¼Œæšä¸¾æƒ…å†µ <code>Suit.hearts</code> æ˜¯ç”¨å…¨åæ¥å–ç”¨çš„ï¼Œå› ä¸ºè¿™ä¸ªå¸¸é‡æ²¡æœ‰ç›´æ¥çš„ç±»å‹æŒ‡æ˜ã€‚åœ¨<code> switch</code> ä¸­ï¼Œæšä¸¾æƒ…å†µçš„å–ç”¨æ˜¯ç”¨äº†ç¼©å†™ <code>.hearts</code>ï¼Œå› ä¸ºå·²ç»çŸ¥é“å€¼ <code>self</code> æ˜¯ä¸€ä¸ª <code>Suit</code>ã€‚å¯¹äºä»»ä½•å·²çŸ¥å€¼çš„ç±»å‹çš„æƒ…å†µï¼Œä½ éƒ½å¯ä»¥ä½¿ç”¨è¿™æ ·çš„ç¼©å†™ã€‚</p><p>å¦‚æœä¸€ä¸ªæšä¸¾æœ‰åŸå§‹å€¼ï¼Œåˆ™åŸå§‹å€¼åœ¨å£°æ˜æ—¶å³è¢«ç¡®å®šï¼Œå› æ­¤ï¼Œæ¯ä¸ªç‰¹å®šæšä¸¾æƒ…å†µçš„å®ä¾‹æ€»æ˜¯æ‹¥æœ‰ç›¸åŒçš„åŸå§‹å€¼ã€‚è¿˜æœ‰å¦ä¸€ç§æšä¸¾æƒ…å†µå¯ä»¥ä½¿æƒ…å†µä¸å€¼ç›¸å…³è”â€”â€”è¿™äº›å€¼åœ¨åˆ›å»ºå®ä¾‹æ—¶è¢«ç¡®å®šï¼Œè¿™ç§æƒ…å†µä¸‹åŒä¸€æšä¸¾æƒ…å†µçš„ä¸åŒå®ä¾‹å¯èƒ½æ‹¥æœ‰ä¸åŒçš„å…³è”å€¼ã€‚ä½ å¯ä»¥è®¤ä¸ºè¿™äº›å…³è”å€¼å°±åƒæ˜¯å‚¨å­˜åœ¨æšä¸¾æƒ…å†µå®ä¾‹ä¸­çš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä»æœåŠ¡å™¨è¯·æ±‚æ—¥å‡ºæ—¥è½æ—¶é—´çš„åœºæ™¯ï¼ŒæœåŠ¡å™¨è¦ä¹ˆè¿”å›è¢«è¯·æ±‚çš„ä¿¡æ¯ï¼Œè¦ä¹ˆè¿”å›å‘ç”Ÿé”™è¯¯æ—¶çš„æè¿°ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">ServerResponse</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> result(<span class="type">String</span>, <span class="type">String</span>)</span><br><span class="line">    <span class="keyword">case</span> failure(<span class="type">String</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> success <span class="operator">=</span> <span class="type">ServerResponse</span>.result(<span class="string">&quot;6:00 am&quot;</span>, <span class="string">&quot;8:09 pm&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> failure <span class="operator">=</span> <span class="type">ServerResponse</span>.failure(<span class="string">&quot;Out of cheese.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> success &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> .result(sunrise, sunset):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Sunrise is at <span class="subst">\(sunrise)</span> and sunset is at <span class="subst">\(sunset)</span>.&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> .failure(message):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Failure...  <span class="subst">\(message)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Prints &quot;Sunrise is at 6:00 am and sunset is at 8:09 pm.&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>ã€å®éªŒã€‘</p><p>æ·»åŠ ç¬¬ä¸‰ç§æƒ…å†µåˆ° <code>ServerResponse</code> å’Œ switchã€‚</p></blockquote><p>æ³¨æ„ sunrise å’Œ sunset æ—¶é—´æ˜¯å¦‚ä½•ä» <code>ServerResponse</code> ä»¥åŒ¹é… switch case çš„å½¢å¼ä¸­æå–å‡ºæ¥çš„ã€‚</p><p>ç”¨ <code>struct</code> æ¥åˆ›å»ºç»“æ„ä½“ã€‚ç»“æ„ä½“æ”¯æŒè®¸å¤šä¸ç±»ç›¸ä¼¼çš„è¡Œä¸ºï¼ŒåŒ…æ‹¬æ–¹æ³•å’Œæ„é€ å™¨ã€‚ç»“æ„ä½“å’Œç±»æœ€é‡è¦çš„åŒºåˆ«ä¹‹ä¸€æ˜¯ï¼šå½“åœ¨ä»£ç ä¸­è¢«ä¼ é€’æ—¶ï¼Œç»“æ„ä½“æ€»æ˜¯ä¼šè¢«å¤åˆ¶ï¼Œè€Œç±»é‡è§†è¢«å¼•ç”¨ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Card</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> rank: <span class="type">Rank</span></span><br><span class="line">    <span class="keyword">var</span> suit: <span class="type">Suit</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">simpleDescription</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;The <span class="subst">\(rank.simpleDescription())</span> of <span class="subst">\(suit.simpleDescription())</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> threeOfSpades <span class="operator">=</span> <span class="type">Card</span>(rank: .three, suit: .spades)</span><br><span class="line"><span class="keyword">let</span> threeOfSpadesDescription <span class="operator">=</span> threeOfSpades.simpleDescription()</span><br></pre></td></tr></table></figure><blockquote><p>ã€å®éªŒã€‘</p><p>å†™ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›ä¸€å¥—å®Œæ•´çš„æ‰‘å…‹ç‰Œï¼Œå¹¶æŠŠæ¯å¼ ç‰Œçš„ rank å’Œ suit å¯¹åº”èµ·æ¥ã€‚</p></blockquote><h2 id="åè®®å’Œæ‹“å±•"><a href="#åè®®å’Œæ‹“å±•" class="headerlink" title="åè®®å’Œæ‹“å±•"></a>åè®®å’Œæ‹“å±•</h2><p>ç”¨ <code>protocol</code> æ¥å£°æ˜åè®®ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">ExampleProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> simpleDescription: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">adjust</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç±»ã€æšä¸¾å’Œç»“æ„ä½“éƒ½å¯ä»¥é‡‡ç”¨åè®®ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleClass</span>: <span class="title">ExampleProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> simpleDescription: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;A very simple class.&quot;</span></span><br><span class="line">    <span class="keyword">var</span> anotherProperty: <span class="type">Int</span> <span class="operator">=</span> <span class="number">69105</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">adjust</span><span class="params">()</span></span> &#123;</span><br><span class="line">        simpleDescription <span class="operator">+=</span> <span class="string">&quot;  Now 100% adjusted.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a <span class="operator">=</span> <span class="type">SimpleClass</span>()</span><br><span class="line">a.adjust()</span><br><span class="line"><span class="keyword">let</span> aDescription <span class="operator">=</span> a.simpleDescription</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SimpleStructure</span>: <span class="title">ExampleProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> simpleDescription: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;A simple structure&quot;</span></span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">adjust</span><span class="params">()</span></span> &#123;</span><br><span class="line">        simpleDescription <span class="operator">+=</span> <span class="string">&quot; (adjusted)&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> b <span class="operator">=</span> <span class="type">SimpleStructure</span>()</span><br><span class="line">b.adjust()</span><br><span class="line"><span class="keyword">let</span> bDescription <span class="operator">=</span> b.simpleDescription</span><br></pre></td></tr></table></figure><blockquote><p>ã€å®éªŒã€‘</p><p>åœ¨ <code>ExampleProtocol</code> é‡Œæ·»åŠ ä¸€ä¸ªè¦æ±‚ï¼Œçœ‹çœ‹éœ€è¦æ€ä¹ˆä¿®æ”¹ <code>SimpleClass</code> å’Œ <code>SimpleStructure</code> æ¥ä½¿å®ƒä»¬ä»ç„¶éµä»åè®®ã€‚</p></blockquote><p>æ³¨æ„ï¼Œç”¨å…³é”®å­— <code>mutating</code> æ¥åœ¨ <code>SimpleStructure</code> ä¸­å£°æ˜ä¸€ä¸ªä¼šä¿®æ”¹ç»“æ„ä½“çš„æ–¹æ³•ã€‚è€Œåœ¨ <code>SimpleClass</code> çš„å£°æ˜ä¸­ï¼Œä¸éœ€è¦æ ‡è®° <code>mutating</code> æ˜¯å› ä¸ºç±»ä¸­çš„ä»»æ„æ–¹æ³•æ€»æ˜¯å¯ä»¥ä¿®æ”¹æ”¹ç±»çš„ã€‚</p><p>ç”¨å…³é”®è¯ <code>extension</code> æ¥ç»™ç°æœ‰çš„ç±»æ·»åŠ ä¸€äº›åŠŸèƒ½ï¼Œä¾‹å¦‚æ–°çš„æ–¹æ³•ã€è®¡ç®—å±æ€§ã€‚ä½ å¯ä»¥ç”¨ <code>extension</code> ç»™åœ¨å…¶ä»–åœ°æ–¹å£°æ˜çš„ï¼ˆç”šè‡³æ˜¯ä½ åœ¨ä½ å¯¼å…¥çš„åŒ…ä¸­çš„ï¼‰ç±»å‹æ·»åŠ æ‹“å±•ï¼Œä½¿å…¶éµå®ˆä½ æŒ‡å®šçš„åè®®ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Int</span>: <span class="title">ExampleProtocol</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> simpleDescription: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;The number <span class="subst">\(<span class="keyword">self</span>)</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">adjust</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span> <span class="operator">+=</span> <span class="number">42</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="number">7</span>.simpleDescription)</span><br><span class="line"><span class="comment">// Prints &quot;The number 7&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>ã€å®éªŒã€‘</p><p>ç»™ <code>Double</code> ç±»å‹æ·»åŠ ä¸€ä¸ª <code>absoluteValue</code> å±æ€§ã€‚</p></blockquote><p>ä½ å¯ä»¥åƒå…¶ä»–ä»»ä½•å‘½åç±»å‹ä¸€æ ·ä½¿ç”¨åè®®â€”â€”ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªé›†åˆæ¥å­˜æ”¾éµå®ˆç›¸åŒåè®®ä½†äº’ä¸ç›¸åŒçš„ç±»å‹çš„å¯¹è±¡ã€‚å½“ä½ å¤„ç†åè®®ç±»å‹çš„å€¼æ—¶ï¼Œåè®®ä¹‹å¤–çš„å±æ€§éƒ½æ˜¯ä¸å¯ç”¨çš„ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> protocolValue: <span class="type">ExampleProtocol</span> <span class="operator">=</span> a</span><br><span class="line"><span class="built_in">print</span>(protocolValue.simpleDescription)</span><br><span class="line"><span class="comment">// Prints &quot;A very simple class.  Now 100% adjusted.&quot;</span></span><br><span class="line"><span class="comment">// print(protocolValue.anotherProperty)  // Uncomment to see the error</span></span><br></pre></td></tr></table></figure><p>å³æ—¶å˜é‡ <code>protocolValue</code> åœ¨è¿è¡Œæ—¶æ‹¥æœ‰ç±»å‹ <code>SimpleClass</code>ï¼Œ ç¼–è¯‘å™¨è¿˜æ˜¯ä¼šæŒ‰ç…§ç»™å®šçš„ç±»å‹ <code>ExampleProtocol</code> æ¥çœ‹å¾…å®ƒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ ä¸å¯ä»¥è¿™ä¸ªç±»åœ¨åè®®è§„å®šä»¥å¤–é¢å¤–å®ç°çš„æ–¹æ³•å’Œå±æ€§ã€‚</p><h2 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h2><p>ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•éµå®ˆäº† <code>Error</code> åè®®çš„ç±»å‹æ¥ä»£è¡¨é”™è¯¯ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">PrinterError</span>: <span class="title">Error</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> outOfPaper</span><br><span class="line">    <span class="keyword">case</span> noToner</span><br><span class="line">    <span class="keyword">case</span> onFire</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨ <code>throw</code> æ¥æŠ›å‡ºé”™è¯¯ï¼Œç”¨ <code>throws</code> æ¥æ ‡è®°ä¸€ä¸ªå‡½æ•°æœ‰å¯èƒ½ä¼šæŠ›å‡ºé”™è¯¯ã€‚å¦‚æœä½ åœ¨ä¸€ä¸ªå‡½æ•°ä¸­æŠ›å‡ºäº†é”™è¯¯ï¼Œé‚£ä¹ˆå‡½æ•°å°±ä¼šç«‹åˆ»è¿”å›ï¼Œè°ƒç”¨å‡½æ•°çš„ä»£ç ä¼šè¦å¤„ç†é”™è¯¯ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">send</span><span class="params">(job: Int, toPrinter printerName: String)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> printerName <span class="operator">==</span> <span class="string">&quot;Never Has Toner&quot;</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="type">PrinterError</span>.noToner</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Job sent&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Swift ä¸­æœ‰å¤šç§æ–¹æ³•å¯ä»¥å¤„ç†é”™è¯¯ï¼Œå…¶ä¸­ä¹‹ä¸€æ˜¯ä½¿ç”¨ <code>do-catch</code>ã€‚åœ¨ <code>do</code> è¯­å¥å—ä¸­ï¼Œä½ å¯ä»¥åœ¨å¯èƒ½æŠ›å‡ºé”™è¯¯çš„ä»£ç å‰é¢å†™ä¸Š <code>try</code>ï¼Œåœ¨ <code>catch</code> è¯­å¥å—ä¸­ï¼Œé”™è¯¯ä¼šè¢«è‡ªåŠ¨èµ‹ç»™åç§° <code>error</code>ï¼Œæˆ–è€…ä½ è‡ªå®šä¹‰çš„å…¶ä»–åç§°ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> printerResponse <span class="operator">=</span> <span class="keyword">try</span> send(job: <span class="number">1040</span>, toPrinter: <span class="string">&quot;Bi Sheng&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(printerResponse)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(error)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Prints &quot;Job sent&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>ã€å®éªŒã€‘</p><p>æŠŠ pointer çš„åå­—æ¢æˆ â€œNever Has Tonerâ€ï¼Œä½¿ <code>send()</code> å‡½æ•°æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚</p></blockquote><p>ä½ å¯ä»¥æä¾›å¤šä¸ª <code>catch</code> è¯­å¥å—æ¥å¤„ç†ä¸åŒçš„é”™è¯¯ã€‚åœ¨ <code>catch</code> åé¢çš„ä»£ç æ¨¡å¼ç±»ä¼¼äºä½ åœ¨ switch è¯­å¥çš„ <code>case</code> åé¢å†™çš„ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> printerResponse <span class="operator">=</span> <span class="keyword">try</span> send(job: <span class="number">1440</span>, toPrinter: <span class="string">&quot;Gutenberg&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(printerResponse)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">PrinterError</span>.onFire &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;I&#x27;ll just put this over here, with the rest of the fire.&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="keyword">let</span> printerError <span class="keyword">as</span> <span class="type">PrinterError</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Printer error: <span class="subst">\(printerError)</span>.&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(error)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Prints &quot;Job sent&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>ã€å®éªŒã€‘</p><p>æ·»åŠ ä»£ç ï¼Œåœ¨ <code>do</code> è¯­å¥å—ä¸­æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œéœ€è¦æŠ›å‡ºä»€ä¹ˆé”™è¯¯æ¥ä½¿è¯¥é”™è¯¯è¢«ç¬¬ä¸€ä¸ª <code>catch</code> å—å¤„ç†ï¼Ÿç¬¬äºŒä¸ªã€ç¬¬ä¸‰ä¸ªåˆå¦‚ä½•ï¼Ÿ</p></blockquote><p>å¦ä¸€ç§å¤„ç†é”™è¯¯çš„åŠæ³•æ˜¯ä½¿ç”¨ <code>try?</code> æ¥æŠŠç»“æœè½¬åŒ–ä¸ºå¯é€‰å€¼ã€‚å¦‚æœå‡½æ•°æŠ›å‡ºé”™è¯¯ï¼Œå…·ä½“çš„é”™è¯¯ä¼šè¢«å¿½ç•¥ï¼Œè¿”å›å€¼ä¸º <code>nil</code>ã€‚å¦åˆ™ï¼Œè¿”å›å€¼ä¼šæ˜¯åŒ…å«äº†å‡½æ•°è¿”å›å€¼çš„å¯é€‰å€¼ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> printerSuccess <span class="operator">=</span> <span class="keyword">try?</span> send(job: <span class="number">1884</span>, toPrinter: <span class="string">&quot;Mergenthaler&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> printerFailure <span class="operator">=</span> <span class="keyword">try?</span> send(job: <span class="number">1885</span>, toPrinter: <span class="string">&quot;Never Has Toner&quot;</span>)</span><br></pre></td></tr></table></figure><p>ç”¨ <code>defer</code> æ¥å†™ä¸€å—åœ¨å‡½æ•°ä¸­çš„æ‰€æœ‰ä»£ç æ‰§è¡Œå®Œæˆåã€å‡½æ•°è¿”å›ä¹‹å‰æ‰§è¡Œçš„ä»£ç ã€‚ä¸è®ºå‡½æ•°æ˜¯å¦æŠ›å‡ºäº†é”™è¯¯ï¼Œè¿™æ®µ defer ä»£ç éƒ½ä¼šè¢«æ‰§è¡Œã€‚ä½ å¯ä»¥åˆ©ç”¨ <code>defer</code>ï¼ŒæŠŠè®¾ç½®å’Œæ¸…ç†çš„ä»£ç å†™åœ¨ä¸€èµ·ï¼Œå³ä½¿å®ƒä»¬å°†åœ¨ä¸åŒæ—¶å€™è¢«æ‰§è¡Œï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fridgeIsOpen <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"><span class="keyword">let</span> fridgeContent <span class="operator">=</span> [<span class="string">&quot;milk&quot;</span>, <span class="string">&quot;eggs&quot;</span>, <span class="string">&quot;leftovers&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fridgeContains</span><span class="params">(<span class="keyword">_</span> food: String)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    fridgeIsOpen <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">    <span class="keyword">defer</span> &#123;</span><br><span class="line">        fridgeIsOpen <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> result <span class="operator">=</span> fridgeContent.contains(food)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line">fridgeContains(<span class="string">&quot;banana&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(fridgeIsOpen)</span><br><span class="line"><span class="comment">// Prints &quot;false&quot;</span></span><br></pre></td></tr></table></figure><h2 id="æ³›å‹"><a href="#æ³›å‹" class="headerlink" title="æ³›å‹"></a>æ³›å‹</h2><p>åœ¨ä¸€å¯¹å°–æ‹¬å·ä¸­å†™ä¸€ä¸ªåå­—æ¥åˆ›å»ºæ³›å‹å‡½æ•°æˆ–ç±»å‹ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makeArray</span>&lt;Item&gt;<span class="params">(repeating item: Item, numberOfTimes: Int)</span></span> -&gt; [<span class="type">Item</span>] &#123;</span><br><span class="line">    <span class="keyword">var</span> result <span class="operator">=</span> [<span class="type">Item</span>]()</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">_</span> <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span>numberOfTimes &#123;</span><br><span class="line">        result.append(item)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line">makeArray(repeating: <span class="string">&quot;knock&quot;</span>, numberOfTimes: <span class="number">4</span>)</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥åˆ›å»ºæ³›å‹çš„å‡½æ•°å’Œæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºæ³›å‹çš„ç±»ã€æšä¸¾å’Œç»“æ„ä½“ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Reimplement the Swift standard library&#x27;s optional type</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">OptionalValue</span>&lt;<span class="title">Wrapped</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> none</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">some</span>(<span class="type">Wrapped</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> possibleInteger: <span class="type">OptionalValue</span>&lt;<span class="type">Int</span>&gt; <span class="operator">=</span> .none</span><br><span class="line">possibleInteger <span class="operator">=</span> .some(<span class="number">100</span>)</span><br></pre></td></tr></table></figure><p>åœ¨å‡½æ•°ä½“å‰ç”¨ <code>where</code> æ¥æ˜ç¡®ä¸€ç³»åˆ—å¯¹æ³›å‹çš„è¦æ±‚â€”â€”ä¾‹å¦‚ï¼Œè¦æ±‚è¿™ç§ç±»å‹è¦å®ç°æŸç§åè®®ï¼Œæˆ–è€…æŸä¸¤ä¸ªç±»å‹è¦ç›¸åŒï¼Œå†æˆ–è€…è¦æ±‚ä¸€ä¸ªç±»æœ‰ç‰¹å®šçš„å­ç±»ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">anyCommonElements</span>&lt;T: Sequence, U: Sequence&gt;<span class="params">(<span class="keyword">_</span> lhs: T, <span class="keyword">_</span> rhs: U)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">    <span class="keyword">where</span> <span class="type">T</span>.<span class="type">Element</span>: <span class="type">Equatable</span>, <span class="type">T</span>.<span class="type">Element</span> <span class="operator">==</span> <span class="type">U</span>.<span class="type">Element</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> lhsItem <span class="keyword">in</span> lhs &#123;</span><br><span class="line">        <span class="keyword">for</span> rhsItem <span class="keyword">in</span> rhs &#123;</span><br><span class="line">            <span class="keyword">if</span> lhsItem <span class="operator">==</span> rhsItem &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">anyCommonElements([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">3</span>])</span><br></pre></td></tr></table></figure><blockquote><p>ã€å®éªŒã€‘</p><p>ä¿®æ”¹å‡½æ•° <code>anyCommonElements(_:_:)</code> ä½¿ä¹‹è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œè¯¥æ•°ç»„åŒ…æ‹¬æ‰€æœ‰ä¸¤ä¸ªåºåˆ—ä¸­å…±æœ‰çš„å…ƒç´ ã€‚</p></blockquote><p>å†™ <code>&lt;T: Equatable&gt;</code> å’Œå†™ <code>&lt;T&gt; ... where T: Eauatable</code> æ˜¯ä¸€æ ·çš„ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Swift </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Andrew Ng æœºå™¨å­¦ä¹ ç¬”è®°æ€»ç»“</title>
      <link href="/2020/01/16/AndrewNgML/AndrewNgMLNotes/"/>
      <url>/2020/01/16/AndrewNgML/AndrewNgMLNotes/</url>
      
        <content type="html"><![CDATA[<h1 id="æœºå™¨å­¦ä¹ "><a href="#æœºå™¨å­¦ä¹ " class="headerlink" title="æœºå™¨å­¦ä¹ "></a>æœºå™¨å­¦ä¹ </h1><p>Emmmmï¼Œè¿™å­¦æœŸåœ¨ Coursera å­¦å®Œäº† Andrew Ng çš„ Machine Learning è¯¾ç¨‹ã€‚æˆ‘å¯¹è¿™ä¸ªè¯¾ç¨‹ä¸€å‘æ˜¯ä¸ä»¥ä¸ºæ„çš„ï¼Œå´ä¸å°å¿ƒæŠ¥äº†ä¸ªåï¼Œè¿˜æ‰‹è´±ç”³è¯·äº†ä¸ªç»æµæ´åŠ©ï¼Œå­¦å®Œå°±å¯ä»¥å…è´¹æ‹¿è¯ä¹¦ï¼ˆå–å‡ ç™¾å—å“’ï¼‰ï¼Œè¯¾ç¨‹æœŸé—´è¿˜é€æ­£ç‰ˆçš„ Matlab Onlineï¼Œè¿™ä¸€ç³»åˆ—çš„å¶(å )ç„¶(å°)äº‹(ä¾¿)ä»¶(å®œ)ä¿ƒä½¿æˆ‘å¼€å§‹åˆ·è¿™ä¸ªè¯¾äº†ã€‚è¶Šå­¦è¶Šè§‰å¾—ï¼Œå—¯ï¼ŒçœŸé¦™ï¼Œæ˜¯çœŸçš„å¾ˆé¦™ï¼è¿™ä¸ªè¯¾çœŸçš„æ˜¯å¾ˆå¥½çš„æœºå™¨å­¦ä¹ å…¥é—¨ï¼Œéš¾æ€ªé‚£ä¹ˆå¤šäººæ¨èã€‚</p><p>Coursera é‡Œè¯¾ç¨‹ç¬”è®°æœ‰æ¯ä¸€ç« çš„æ€»ç»“ï¼Œæ€»ç»“çš„éå¸¸å¥½ï¼Œæ¨èå­¦å®Œä¹‹åçœ‹ä¸€çœ‹ã€‚ä½†æˆ‘è¿˜æ˜¯å–œæ¬¢è‡ªå·±å†™è‡ªå·±çš„ï¼Œæ‰€ä»¥æˆ‘ä¹‹å‰è¾¹çœ‹è§†é¢‘è¾¹å†™äº†å‡ ä¹æ¶µç›–æ•´ä¸ªè¯¾ç¨‹çš„<a href="https://clownote.github.io/categories/Machine-Learning/AndrewNg/">ç¬”è®°</a>ï¼Œå…¶å®å¥½å¤šæ˜¯åœ¨æŠ„è€å¸ˆçš„åŸè¯å’ŒPPTğŸ˜‚ï¼Œå°±å½“ç»ƒä¹ æ‰“å­—ã€è‹±è¯­è¿˜æœ‰ $\LaTeX$ äº†ã€‚æ”¾å‡å›å®¶åœ¨ç«è½¦ä¸Š<del>ç™¾æ— èŠèµ–</del>å¿ƒè¡€æ¥æ½®ï¼Œæƒ³åˆ°äº†åº”è¯¥æ•´ç†ä¸€ä¸‹è¯¾ç¨‹é‡Œé¢å­¦åˆ°çš„ä¸œè¥¿ï¼Œå°±æœ‰äº†è¿™ç¯‡æ–‡ç« ã€‚</p><p>è¿™é‡Œæˆ‘ä¸»è¦æ˜¯å†™äº†å„ç§ç®—æ³•çš„æè¿°ï¼Œè¿˜ä»ç¼–ç¨‹ä½œä¸šé‡Œæå–äº†ç®—æ³•å¤§æ¦‚çš„ä»£ç å®ç°ï¼Œæ–¹ä¾¿æ—¥åå¿«é€ŸæŸ¥é˜…å§ã€‚ä¸€å¼€å§‹çš„å›å½’æ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥æˆ‘å†™çš„å¾ˆå°‘ï¼Œå°±å †äº†ç‚¹å…¬å¼ï¼ˆå…¶å®æ˜¯ç¡¬å§ä¸Šé“ºç©ºè°ƒå¤ªå†·è‡´ä½¿æˆ‘ç”Ÿç—…äº†ï¼Œæ€è·¯å µå¡å†™ä¸å‡ºä¸œè¥¿æ¥ğŸ˜·ï¼‰ï¼›åé¢SVMã€æ¨èç³»ç»Ÿä»€ä¹ˆçš„æ¯”è¾ƒå¤æ‚å°±å¤šå†™äº†ä¸€äº›ï¼ˆå…¶å®æ˜¯æˆ‘æŒæ¡çš„ä¸å¥½ï¼Œå½’çº³ä¸å‡ºé‡ç‚¹ğŸ¤¯ï¼‰ã€‚è‡³äºè¯¾ç¨‹é‡Œè€å¸ˆèŠ±å¤§åŠ›æ°”è®²çš„å…³äºæœºå™¨å­¦ä¹ ç³»ç»Ÿçš„è®¾è®¡ã€ä¼˜åŒ–ã€debug è¿˜æœ‰å„ç§<del>å¥‡æŠ€æ·«å·§</del> <del>éªšæ“ä½œ</del> å®ç”¨æŠ€å·§ ä»¥åŠ Octave å…¥é—¨å“ªä¸€å—æˆ‘å°±ä¸€æ¦‚ä¸æäº†ï¼Œè¿™äº›ä¸œè¥¿è¿˜æ˜¯è¦çœ‹è€å¸ˆçš„è§†é¢‘æ‰èƒ½ä½“ä¼šåˆ°ç²¾é«“ï¼ˆâ€¦ä¼˜(æŒ‚)ç§€(ç§‘)çš„å¤§å­¦ç”Ÿè‡ªç„¶æ˜¯ä¸èƒ½æ‰¿è®¤åŸå› æ˜¯è‡ªå·±æ‡’æƒ°çš„ğŸ˜ï¼‰ã€‚</p><p>ç”±äºæˆ‘çœ‹è¯¾ç¨‹çš„æ—¶å€™å…¨ç¨‹æ²¡æœ‰å¼€ä¸­æ–‡å­—å¹•ï¼Œå¹³æ—¶æŸ¥é˜…çš„ä¸­æ–‡èµ„æ–™ä¹Ÿæ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥å¥½å¤šæœ¯è¯­æˆ‘éƒ½ä¸çŸ¥é“è¦æ€ä¹ˆç¿»è¯‘ï¼Œå†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™æˆ‘å¤§æ¦‚æŸ¥äº†ä¸€äº›è‡ªå·±éš¾ä»¥è¡¨è¾¾çš„ï¼Œå…¶ä»–çš„å…¨é è‡†æµ‹ï¼Œæˆ‘ä¸ä¿è¯æ­£ç¡®ã€‚</p><p>Emmmï¼Œä¸å°å¿ƒå°±å†™äº†å‡ ç™¾å­—çš„åºŸè¯ğŸ˜‚ä¸‹é¢å°±å¼€å§‹å§ã€‚</p><h2 id="ç›‘ç£å­¦ä¹ "><a href="#ç›‘ç£å­¦ä¹ " class="headerlink" title="ç›‘ç£å­¦ä¹ "></a>ç›‘ç£å­¦ä¹ </h2><p>ç›‘ç£å­¦ä¹ æ˜¯ç»™xã€yæ•°æ®å»è®­ç»ƒçš„ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8n5s7zmffj30lv0ca40u.jpg" alt="image-20191105144318970"></p><h3 id="å›å½’é—®é¢˜"><a href="#å›å½’é—®é¢˜" class="headerlink" title="å›å½’é—®é¢˜"></a>å›å½’é—®é¢˜</h3><blockquote><p>åšé¢„æµ‹ï¼Œå€¼åŸŸä¸ºè¿ç»­çš„æ•°ï¼ˆä¾‹å¦‚åŒºé—´$[0,100]$ï¼‰</p></blockquote><p>æ•°å­¦æ¨¡å‹ï¼š</p><ul><li><p><strong>é¢„æµ‹å‡½æ•°</strong>ï¼š<br>$$</p><h1 id="h-theta-x"><a href="#h-theta-x" class="headerlink" title="h_\theta(x)"></a>h_\theta(x)</h1><h1 id="sum-i-0-m-theta-ix-i"><a href="#sum-i-0-m-theta-ix-i" class="headerlink" title="\sum_{i=0}^m \theta_ix_i"></a>\sum_{i=0}^m \theta_ix_i</h1><p>\left[\begin{array}{c}\theta_0 &amp; \theta_1 &amp; \ldots &amp; \theta_n\end{array}\right]</p><h1 id="left-begin-array-c-x-0-x-1-vdots-x-n-end-array-right"><a href="#left-begin-array-c-x-0-x-1-vdots-x-n-end-array-right" class="headerlink" title="\left[\begin{array}{c}x_0 \ x_1 \ \vdots \ x_n \end{array}\right]"></a>\left[\begin{array}{c}x_0 \ x_1 \ \vdots \ x_n \end{array}\right]</h1><p>\theta^TX<br>$$</p></li><li><p><strong>å¾…æ±‚å‚æ•°</strong>ï¼š$\theta=\left[\begin{array}{c}\theta_0 &amp; \theta_1 &amp; \ldots &amp; \theta_n\end{array}\right]$</p></li><li><p><strong>ä»£ä»·å‡½æ•°</strong>ï¼š<br>$$<br>J(\theta)=\frac{1}{2m}\sum_{i=1}^m(h(x^{(i)})-y^{(i)})^2<br>=\frac{(\sum_{i=1}^mh_\theta(X)-Y)^2}{2m}<br>$$</p></li></ul><p>ğŸ‘‰ä»£ç å®ç°ï¼š</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">J</span> = <span class="title">computeCostMulti</span><span class="params">(X, y, theta)</span></span></span><br><span class="line"><span class="comment">%COMPUTECOSTMULTI Compute cost for linear regression with multiple variables</span></span><br><span class="line"><span class="comment">%   J = COMPUTECOSTMULTI(X, y, theta) computes the cost of using theta as the</span></span><br><span class="line"><span class="comment">%   parameter for linear regression to fit the data points in X and y</span></span><br><span class="line"></span><br><span class="line">m = <span class="built_in">length</span>(y); <span class="comment">% number of training examples</span></span><br><span class="line"></span><br><span class="line">J = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">J = <span class="number">1</span> / (<span class="number">2</span>*m) * (X*theta - y)&#x27; * (X*theta - y);</span><br><span class="line"></span><br><span class="line"><span class="comment">% or less vectorizedly: </span></span><br><span class="line"><span class="comment">% predictions = X * theta;</span></span><br><span class="line"><span class="comment">% sqrErrors = (predictions - y) .^ 2;</span></span><br><span class="line"><span class="comment">% J = 1 / (2*m) * sum(sqrErrors);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ul><li><strong>ä¼˜åŒ–ç›®æ ‡</strong>ï¼šæ‰¾åˆ°ä¸€ç»„$\theta$ä½¿$J$æœ€å°ã€‚</li></ul><p>æ±‚è§£æ–¹æ³•ï¼š</p><h4 id="æ¢¯åº¦ä¸‹é™"><a href="#æ¢¯åº¦ä¸‹é™" class="headerlink" title="æ¢¯åº¦ä¸‹é™"></a>æ¢¯åº¦ä¸‹é™</h4><p>ï¼ˆè¿™é‡Œæš‚ä¸”åªè®¨è®º batch gradient descentï¼‰</p><p>$$<br>\begin{array}{ll}<br>\textrm{repeat until convergence } { \<br>\qquad \theta_j:=\theta_j-\alpha\frac{\partial}{\partial\theta_j}J(\theta)\<br>\qquad\quad:= \theta_j - \alpha \frac{1}{m} \sum^m_{i=1}[h_\theta(x^{(i)})-y^{(i)}] \cdot x_j^{(i)}\qquad \textrm{for }j:=0, â€¦, n \<br>}<br>\end{array}<br>$$</p><p>å‘é‡åŒ–è¡¨ç¤ºï¼š$\theta=\theta-\frac{\alpha}{m}X^T(h_\theta(X)-Y)$</p><p>ğŸ‘‰ä»£ç å®ç°ï¼š</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[theta, J_history]</span> = <span class="title">gradientDescentMulti</span><span class="params">(X, y, theta, alpha, num_iters)</span></span></span><br><span class="line"><span class="comment">%GRADIENTDESCENTMULTI Performs gradient descent to learn theta</span></span><br><span class="line"><span class="comment">%   theta = GRADIENTDESCENTMULTI(x, y, theta, alpha, num_iters) updates theta by</span></span><br><span class="line"><span class="comment">%   taking num_iters gradient steps with learning rate alpha</span></span><br><span class="line"></span><br><span class="line">m = <span class="built_in">length</span>(y); <span class="comment">% number of training examples</span></span><br><span class="line">J_history = <span class="built_in">zeros</span>(num_iters, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> iter = <span class="number">1</span>:num_iters</span><br><span class="line"></span><br><span class="line">    predictions = X * theta;</span><br><span class="line">    errors = (predictions - y);</span><br><span class="line">    theta = theta - alpha / m * (X&#x27; * errors);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">% Save the cost J in every iteration    </span></span><br><span class="line">    J_history(iter) = computeCostMulti(X, y, theta);</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h4 id="æ­£è§„æ–¹ç¨‹"><a href="#æ­£è§„æ–¹ç¨‹" class="headerlink" title="æ­£è§„æ–¹ç¨‹"></a>æ­£è§„æ–¹ç¨‹</h4><p>$$<br>\theta = (X^TX)^{-1}X^Ty<br>$$<br>ğŸ‘‰ä»£ç å®ç°ï¼š</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[theta]</span> = <span class="title">normalEqn</span><span class="params">(X, y)</span></span></span><br><span class="line"><span class="comment">%NORMALEQN Computes the closed-form solution to linear regression </span></span><br><span class="line"><span class="comment">%   NORMALEQN(X,y) computes the closed-form solution to linear </span></span><br><span class="line"><span class="comment">%   regression using the normal equations.</span></span><br><span class="line"></span><br><span class="line">theta = <span class="built_in">zeros</span>(<span class="built_in">size</span>(X, <span class="number">2</span>), <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">theta = pinv(X&#x27; * X) * X&#x27; * y;</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬æ±‚ä¼ªé€†ä»¥ç¡®ä¿æ­£å¸¸è¿è¡Œã€‚é€šå¸¸é€ æˆ$X^TX$ä¸å¯é€†çš„åŸå› æ˜¯ï¼š</p><ol><li>å­˜åœ¨å¯çº¦ç‰¹å¾ï¼Œå³ç»™å®šçš„æŸä¸¤/å¤šä¸ªç‰¹å¾çº¿æ€§ç›¸å…³ï¼Œåªä¿ç•™ä¸€ä¸ªåˆ é™¤å…¶ä»–å³å¯è§£å†³ã€‚ï¼ˆe.g. there are the size of house in feet^2 and the size of house in meter^2, where we know that 1 meter = 3.28 feetï¼‰</li><li>ç»™å®šç‰¹å¾è¿‡å¤šï¼Œ($m \le n$). å¯ä»¥åˆ é™¤ä¸€äº›ä¸é‡è¦çš„ç‰¹å¾ï¼ˆè€ƒè™‘PCAç®—æ³•ï¼‰</li></ol><h4 id="æ¢¯åº¦ä¸‹é™vsæ­£è§„æ–¹ç¨‹"><a href="#æ¢¯åº¦ä¸‹é™vsæ­£è§„æ–¹ç¨‹" class="headerlink" title="æ¢¯åº¦ä¸‹é™vsæ­£è§„æ–¹ç¨‹"></a>æ¢¯åº¦ä¸‹é™vsæ­£è§„æ–¹ç¨‹</h4><table><thead><tr><th></th><th>Gradient Descent</th><th>Normal Equation</th></tr></thead><tbody><tr><td>éœ€è¦é€‰æ‹© alpha</td><td>âœ…</td><td>-</td></tr><tr><td>ç¬¬ä¸‰æ–¹</td><td>âœ…</td><td>-</td></tr><tr><td>æ—¶é—´å¤æ‚åº¦</td><td>$O(kn^2)$</td><td>æ±‚$X^TX$çš„ä¼ªé€†éœ€è¦$O(n^3)$</td></tr><tr><td>n ç›¸å½“å¤§æ—¶</td><td>å¯ä»¥å·¥ä½œ</td><td>ååˆ†ç¼“æ…¢ç”šè‡³ä¸å¯è®¡ç®—</td></tr></tbody></table><p>å®é™…ä¸Šï¼Œå½“ $n&gt;10,000$ æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸æ›´å€¾å‘äºä½¿ç”¨æ¢¯åº¦ä¸‹é™ï¼Œå¦åˆ™æ­£è§„æ–¹ç¨‹ä¸€èˆ¬éƒ½è¡¨ç°å¾—æ›´å¥½ã€‚</p><h4 id="æ³¨ï¼šç‰¹å¾ç¼©æ”¾"><a href="#æ³¨ï¼šç‰¹å¾ç¼©æ”¾" class="headerlink" title="æ³¨ï¼šç‰¹å¾ç¼©æ”¾"></a>æ³¨ï¼šç‰¹å¾ç¼©æ”¾</h4><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿è¾“å…¥å€¼å¤§æ¦‚åœ¨ä¸€å®šçš„èŒƒå›´å†…æ¥ä½¿æ¢¯åº¦ä¸‹é™è¿è¡Œæ›´å¿«ï¼Œæ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰å€¼å˜åˆ° $[-1,1]$ çš„èŒƒå›´å†…ï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å¤„ç†è®©è¾“å…¥å€¼ä¹‹é—´çš„å·®è·ä¸è¦å¤ªå¤§ï¼ˆä¾‹å¦‚ï¼Œè¾“å…¥å€¼ä¸­åŒæ—¶æœ‰ 0.000001 å’Œ 1 è¿™æ ·å·®è·å¤§çš„å€¼ä¼šå½±å“æ¢¯åº¦ä¸‹é™çš„æ•ˆç‡ï¼‰ã€‚</p><p>åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬é€šå¸¸æƒ³è¦ä¿è¯å˜é‡å€¼åœ¨ $[-3,-\frac{1}{3}) \cup (+\frac{1}{3}, +3]$ è¿™ä¸ªèŒƒå›´å†…å–å€¼ã€‚</p><p>ä¸ºè¾¾æˆè¯¥ç›®æ ‡ï¼Œæˆ‘ä»¬åšå¦‚ä¸‹æ“ä½œï¼š</p><ol><li>Feature scaling</li></ol><p>$$<br>\begin{array}{rl}<br>\textrm{Range:} &amp; s_i = max(x_i)-min(x_i)\<br>\textrm{Or Range:} &amp; s_i = \textrm{standard deviation of } x_i\<br>\textrm{Scaling:} &amp; x_i:=\frac{x_i}{s_i}<br>\end{array}<br>$$</p><ol start="2"><li>Mean normalizaton</li></ol><p>$$<br>\begin{array}{rl}<br>\textrm{Mean(Average):} &amp; \mu_i = \frac{sum(x_i)}{m}\<br>\textrm{normalizing:} &amp; x_i:=x_i-\mu_i<br>\end{array}<br>$$</p><p>æŠŠä¸¤ä¸ªæ“ä½œå’Œåœ¨ä¸€èµ·ï¼Œå³ï¼š<br>$$<br>x_i:=\frac{x_i-\mu_i}{s_i}<br>$$<br>å…¶ä¸­ï¼Œ$\mu_i$ æ˜¯ç‰¹å¾(i)çš„å€¼çš„å¹³å‡ï¼Œ$s_i$æ˜¯å€¼çš„èŒƒå›´ã€‚</p><p>ğŸ‘‰ä»£ç å®ç°ï¼š</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[X_norm, mu, sigma]</span> = <span class="title">featureNormalize</span><span class="params">(X)</span></span></span><br><span class="line"><span class="comment">%FEATURENORMALIZE Normalizes the features in X </span></span><br><span class="line"><span class="comment">%   FEATURENORMALIZE(X) returns a normalized version of X where</span></span><br><span class="line"><span class="comment">%   the mean value of each feature is 0 and the standard deviation</span></span><br><span class="line"><span class="comment">%   is 1. This is often a good preprocessing step to do when</span></span><br><span class="line"><span class="comment">%   working with learning algorithms.</span></span><br><span class="line"></span><br><span class="line">X_norm = X;</span><br><span class="line">mu = <span class="built_in">zeros</span>(<span class="number">1</span>, <span class="built_in">size</span>(X, <span class="number">2</span>));</span><br><span class="line">sigma = <span class="built_in">zeros</span>(<span class="number">1</span>, <span class="built_in">size</span>(X, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">mu = <span class="built_in">mean</span>(X);</span><br><span class="line">sigma = std(X);</span><br><span class="line">X_norm = (X - mu) ./ sigma;</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="åˆ†ç±»é—®é¢˜"><a href="#åˆ†ç±»é—®é¢˜" class="headerlink" title="åˆ†ç±»é—®é¢˜"></a>åˆ†ç±»é—®é¢˜</h3><blockquote><p>åšé¢„æµ‹ï¼Œå€¼åŸŸä¸ºç¦»æ•£çš„å‡ ä¸ªç‰¹å®šå€¼ï¼ˆä¾‹å¦‚ 0 æˆ– 1ï¼›0/1/2/3ï¼‰</p></blockquote><h4 id="é€»è¾‘å›å½’"><a href="#é€»è¾‘å›å½’" class="headerlink" title="é€»è¾‘å›å½’"></a>é€»è¾‘å›å½’</h4><p>å‡è®¾å‡½æ•°ï¼š<br>$$<br>\left{\begin{array}{l}<br>h_\theta(x) = g(\theta^Tx)\<br>z = \theta^T x\<br>g(z) = \frac{1}{1+e^{-z}}\<br>\end{array}\right.<br>$$<br>å…¶ä¸­ï¼Œ$g(z)$ ç§°ä¸º Simoid å‡½æ•°ï¼Œæˆ–é€»è¾‘å‡½æ•°ï¼Œå…¶å›¾åƒå¦‚ä¸‹ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gauxvtzb5qj30ur0g8wgd.jpg" alt="image-20190917162504420"></p><p>ğŸ‘‰ä»£ç å®ç°ï¼š</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">g</span> = <span class="title">sigmoid</span><span class="params">(z)</span></span></span><br><span class="line"><span class="comment">%SIGMOID Compute sigmoid functoon</span></span><br><span class="line"><span class="comment">%   J = SIGMOID(z) computes the sigmoid of z.</span></span><br><span class="line"></span><br><span class="line">g = <span class="number">1.0</span> ./ (<span class="number">1.0</span> + <span class="built_in">exp</span>(-z));</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>ä¸Šå¼å¯åŒ–ç®€å¾—ï¼š<br>$$<br>h_\theta(x) = \frac{1}{1+e^{-\theta^Tx}}<br>$$</p><p>$h_\theta$ çš„è¾“å‡ºæ˜¯é¢„æµ‹å€¼ä¸º1çš„å¯èƒ½æ€§ï¼Œå¹¶æœ‰ä¸‹ä¸¤å¼æˆç«‹ï¼š<br>$$<br>h_\theta(x)=P(y=1 \mid x;\theta)=1-P(y=0 \mid x; \theta)<br>$$</p><p>$$<br>P(y=0 \mid x;\theta) + P(y=1 \mid x;\theta) = 1<br>$$</p><p><strong>å†³ç­–è¾¹ç•Œ</strong>ï¼šé€»è¾‘å›å½’çš„å†³ç­–è¾¹ç•Œå°±æ˜¯å°†åŒºåŸŸåˆ†æˆ$y=0$å’Œ $y=1$ ä¸¤éƒ¨åˆ†çš„ä¸€ä¸ªè¶…å¹³é¢ã€‚</p><p>å†³ç­–è¾¹ç•Œç”±å‡è®¾å‡½æ•°å†³å®šã€‚è¿™æ˜¯ç”±äºè¦å®Œæˆåˆ†ç±»ï¼Œéœ€ç”¨$h_\theta$çš„è¾“å‡ºæ¥å†³å®šç»“æœæ˜¯ 0 è¿˜æ˜¯ 1ã€‚å®š 0.5 ä¸ºåˆ†ç•Œï¼Œå³ï¼š<br>$$<br>\begin{array}{rcl}<br>h_\theta(x) \ge 0.5 &amp;\Rightarrow&amp; y=1\<br>h_\theta(x) &lt; 0.5 &amp;\Rightarrow&amp; y=0<br>\end{array}<br>$$<br>ç”± Simoid å‡½æ•°çš„æ€§è´¨ï¼Œä¸Šå¼ç­‰ä»·ä¸ºï¼š<br>$$<br>\begin{array}{rcl}<br>\theta^TX \ge 0 &amp;\Rightarrow&amp; y=1\<br>\theta^TX \le 0 &amp;\Rightarrow&amp; y=0\<br>\end{array}<br>$$<br>é‚£ä¹ˆå¯¹äºç»™å®šçš„ä¸€ç»„ $\theta$ï¼Œä¾‹å¦‚$\theta=\left[\begin{array}{c}5\-1\0\end{array} \right]$ï¼Œæœ‰ $y=1$ å½“ä¸”ä»…å½“ $5+(-1)x_1+0x_2 \ge 0$ï¼Œè¿™æ—¶å†³ç­–è¾¹ç•Œä¸º $x_1=5$ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gauyq6oc10j306e04umx0.jpg" alt="image-20190917173722734"></p><p>å†³ç­–è¾¹ç•Œä¹Ÿå¯ä»¥æ˜¯ä¸‹é¢è¿™ç§å¤æ‚çš„æƒ…å†µï¼š</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1gauyt0wbq3j30mv08xwfh.jpg" alt="image-20190917174144868"></p><p><strong>é€»è¾‘å›å½’æ¨¡å‹</strong>ï¼š<br>$$<br>\begin{array}{rcl}<br>\textrm{Training set} &amp;:&amp; {(x^{(1)},y^{(1)}), (x^{(2)},y^{(2)}), \ldots, (x^{(m)},y^{(m)})}\<br>\<br>\textrm{m examples} &amp;:&amp;<br>x \in \left[\begin{array}{c}<br>x_0\x_1\ \vdots \ x_n<br>\end{array}\right] \textrm{where }(x_0=1)<br>,\quad y \in {0,1}\<br>\<br>\textrm{Hypothesis} &amp;:&amp; h_\theta(x)=\frac{1}{1+e^{-\theta^Tx}}\\<br>\textrm{Cost Function} &amp;:&amp;<br>J(\theta)=-\frac{1}{m}\sum_{i=1}^m\Bigg[y^{(i)}log\Big(h_\theta(x)\Big)+(1-y^{(i)})log\Big(1-h_\theta(x^{(i)})\Big)\Bigg]<br>\end{array}<br>$$<br>å‘é‡åŒ–è¡¨ç¤ºï¼š<br>$$<br>\begin{array}{l}<br>h=g(X\theta)\<br>J(\theta)=\frac{1}{m}\cdot\big(-y^T log(h) -(1-y)^T log(1-h)\big)<br>\end{array}<br>$$<br><strong>æ¢¯åº¦ä¸‹é™</strong>ï¼š<br>$$<br>\begin{array}{l}<br>Repeat \quad {\<br>\qquad \theta_j:=\theta_j-\frac{\alpha}{m}\sum_{i=1}^m(h_\theta(x^{(i)})-y^{(i)})\cdot x_j^{(i)}\<br>}<br>\end{array}<br>$$<br>å‘é‡åŒ–è¡¨ç¤ºï¼š<br>$$<br>\theta:=\theta-\frac{\alpha}{m}X^T(g(X\theta)-\overrightarrow{y})<br>$$<br>ğŸ‘‰ä»£ç å®ç°ï¼ˆä½¿ç”¨Advanced Optimizationï¼‰ï¼š</p><ol><li>æä¾›$J(\theta), \frac{\partial}{\partial\theta_j}J(\theta)$</li></ol><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[J, grad]</span> = <span class="title">costFunction</span><span class="params">(theta, X, y)</span></span></span><br><span class="line"><span class="comment">%COSTFUNCTION Compute cost and gradient for logistic regression</span></span><br><span class="line"><span class="comment">%   J = COSTFUNCTION(theta, X, y) computes the cost of using theta as the</span></span><br><span class="line"><span class="comment">%   parameter for logistic regression and the gradient of the cost</span></span><br><span class="line"><span class="comment">%   w.r.t. to the parameters.</span></span><br><span class="line"></span><br><span class="line">m = <span class="built_in">length</span>(y); <span class="comment">% number of training examples</span></span><br><span class="line"></span><br><span class="line">J = <span class="number">0</span>;</span><br><span class="line">grad = <span class="built_in">zeros</span>(<span class="built_in">size</span>(theta));</span><br><span class="line"></span><br><span class="line">h = sigmoid(X*theta);</span><br><span class="line"></span><br><span class="line">J = <span class="number">1</span>/m * (-y&#x27;*<span class="built_in">log</span>(h) - (<span class="number">1</span>-y)&#x27;*<span class="built_in">log</span>(<span class="number">1</span>-h));</span><br><span class="line"></span><br><span class="line">grad = <span class="number">1</span>/m * X&#x27;*(h-y);</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ol start="2"><li>è°ƒç”¨ Advanced Optimization å‡½æ•°è§£å†³ä¼˜åŒ–é—®é¢˜ï¼š</li></ol><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">options = optimset(<span class="string">&#x27;GradObj&#x27;</span>, <span class="string">&#x27;on&#x27;</span>, <span class="string">&#x27;MaxIter&#x27;</span>, <span class="number">100</span>);</span><br><span class="line">initialTheta = <span class="built_in">zeros</span>(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">[optTheta, functionVal, exitFlag] = fminunc(@costFunction, initialTheta, options);</span><br></pre></td></tr></table></figure><h5 id="å¤šå…ƒåˆ†ç±»"><a href="#å¤šå…ƒåˆ†ç±»" class="headerlink" title="å¤šå…ƒåˆ†ç±»"></a>å¤šå…ƒåˆ†ç±»</h5><p>æˆ‘ä»¬é‡‡ç”¨ä¸€ç³»åˆ—çš„å•å…ƒï¼ˆé€»è¾‘ï¼‰åˆ†ç±»æ¥å®Œæˆå¤šå…ƒåˆ†ç±»ï¼š<br>$$<br>\begin{array}{l}<br>y \in {0,1,\cdots,n}\\<br>h_\theta^{(0)}(x)=P(y=0|x;\theta)\<br>h_\theta^{(0)}(x)=P(y=0|x;\theta)\<br>\vdots\<br>h_\theta^{(0)}(x)=P(y=0|x;\theta)\\<br>prediction = \mathop{max}\limits_{\theta}\big(h_\theta^{(i)}(x)\big)<br>\end{array}<br>$$</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g78nj8fvy4j30d507agmp.jpg" alt="img"></p><h4 id="æ³¨ï¼šè¿‡æ‹Ÿåˆ"><a href="#æ³¨ï¼šè¿‡æ‹Ÿåˆ" class="headerlink" title="æ³¨ï¼šè¿‡æ‹Ÿåˆ"></a>æ³¨ï¼šè¿‡æ‹Ÿåˆ</h4><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7aopbltb1j30f0046dg2.jpg" alt="img"></p><p>è¿‡æ‹Ÿåˆå¯¹è®­ç»ƒé›†ä¸­çš„æ•°æ®é¢„æµ‹çš„å¾ˆå¥½ï¼Œä½†å¯¹æ²¡è§è¿‡çš„æ–°æ ·æœ¬é¢„æµ‹æ•ˆæœä¸ä½³ã€‚</p><p>è§£å†³è¿‡æ‹Ÿåˆçš„æ–¹æ³•æœ‰ï¼š</p><ol><li><p>å‡å°‘ç‰¹å¾æ•°é‡ï¼ˆPCAï¼‰</p></li><li><p>æ­£åˆ™åŒ–ï¼šåœ¨ä»£ä»·å‡½æ•°ä¸­åŠ å…¥ $\theta$ çš„æƒé‡ï¼š</p><p>$\mathop{min}\limits_{\theta} \dfrac{1}{2m}\ \sum_{i=1}^m (h_\theta(x^{(i)}) - y^{(i)})^2 + \lambda\ \sum_{j=1}^n \theta_j^2$</p><blockquote><p>æ³¨æ„ï¼Œ$\theta_0$æ˜¯æˆ‘ä»¬åŠ ä¸Šçš„å¸¸æ•°é¡¹ï¼Œä¸åº”è¯¥è¢«æ­£åˆ™åŒ–ã€‚</p></blockquote><p>ä»£ç å®ç°ï¼š</p></li></ol><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[J, grad]</span> = <span class="title">lrCostFunction</span><span class="params">(theta, X, y, lambda)</span></span></span><br><span class="line"><span class="comment">%LRCOSTFUNCTION Compute cost and gradient for logistic regression with </span></span><br><span class="line"><span class="comment">%regularization</span></span><br><span class="line"><span class="comment">%   J = LRCOSTFUNCTION(theta, X, y, lambda) computes the cost of using</span></span><br><span class="line"><span class="comment">%   theta as the parameter for regularized logistic regression and the</span></span><br><span class="line"><span class="comment">%   gradient of the cost w.r.t. to the parameters. </span></span><br><span class="line"></span><br><span class="line">m = <span class="built_in">length</span>(y); <span class="comment">% number of training examples</span></span><br><span class="line"></span><br><span class="line">J = <span class="number">0</span>;</span><br><span class="line">grad = <span class="built_in">zeros</span>(<span class="built_in">size</span>(theta));</span><br><span class="line"></span><br><span class="line"><span class="comment">% Unregularized cost function &amp; gradient for logistic regression</span></span><br><span class="line">h = sigmoid(X * theta);</span><br><span class="line">J = <span class="number">1</span>/m * (-y&#x27;*<span class="built_in">log</span>(h) - (<span class="number">1</span>-y)&#x27;*<span class="built_in">log</span>(<span class="number">1</span>-h));</span><br><span class="line">grad = <span class="number">1</span>/m * X&#x27;*(h-y);</span><br><span class="line"></span><br><span class="line"><span class="comment">% Regularize</span></span><br><span class="line">temp = theta;</span><br><span class="line">temp(<span class="number">1</span>) = <span class="number">0</span>;</span><br><span class="line">J = J + lambda/(<span class="number">2</span>*m) * sum(temp.^<span class="number">2</span>);</span><br><span class="line">grad = grad + lambda/m * temp;</span><br><span class="line"></span><br><span class="line">grad = grad(:);</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h4 id="ç¥ç»ç½‘ç»œ"><a href="#ç¥ç»ç½‘ç»œ" class="headerlink" title="ç¥ç»ç½‘ç»œ"></a>ç¥ç»ç½‘ç»œ</h4><p>$$<br>\left[\begin{array}{c}x_0 \ x_1 \ x_2 \ x_3\end{array}\right]<br>\rightarrow<br>\left[\begin{array}{c}a_1^{(2)} \ a_2^{(2)} \ a_3^{(2)} \ \end{array}\right]<br>\rightarrow<br>\left[\begin{array}{c}a_1^{(3)} \ a_2^{(3)} \ a_3^{(3)} \ \end{array}\right]<br>\rightarrow<br>h_\theta(x)<br>$$</p><p>ç¬¬ä¸€å±‚æ˜¯æ•°æ®é›†ï¼Œç§°ä¸ºè¾“å…¥å±‚ï¼Œå¯ä»¥çœ‹ä½œ $a^{(0)}$ ï¼›ä¸­é—´æ˜¯æ•°ä¸ªéšè—å±‚ï¼Œæœ€ç»ˆå¾—åˆ°çš„å°±æ˜¯é¢„æµ‹å‡½æ•°ï¼Œè¿™ä¸€å±‚å«åšè¾“å‡ºå±‚ã€‚</p><p>$$<br>z^{(j)} = \Theta^{(j-1)}a^{(j-1)}<br>$$</p><p>$$<br>a^{(j)} = g(z^{(j)})<br>$$</p><p>å‡è®¾æœ‰ c ä¸ªå±‚ï¼Œåˆ™:</p><p>$$<br>h_\Theta(x)=a^{(c+1)}=g(z^{(c+1)})<br>$$</p><p>ä¾‹å¦‚ï¼Œç”¨ä¸€å±‚çš„ç¥ç»ç½‘ç»œï¼Œæˆ‘ä»¬å¯ä»¥å»ºç«‹ä¸€äº›è¡¨è¾¾é€»è¾‘å‡½æ•°çš„ç¥ç»ç½‘ç»œï¼š<br>$$<br>\begin{array}{l}AND:\&amp;\Theta^{(1)} &amp;=\begin{bmatrix}-30 &amp; 20 &amp; 20\end{bmatrix} \ NOR:\&amp;\Theta^{(1)} &amp;= \begin{bmatrix}10 &amp; -20 &amp; -20\end{bmatrix} \ OR:\&amp;\Theta^{(1)} &amp;= \begin{bmatrix}-10 &amp; 20 &amp; 20\end{bmatrix} \\end{array}<br>$$</p><h5 id="å¤šå…ƒåˆ†ç±»-1"><a href="#å¤šå…ƒåˆ†ç±»-1" class="headerlink" title="å¤šå…ƒåˆ†ç±»"></a>å¤šå…ƒåˆ†ç±»</h5><p>$$<br>y^{(i)}=\begin{bmatrix}1\0\0\0\end{bmatrix},\begin{bmatrix}0\1\0\0\end{bmatrix},\begin{bmatrix}0\0\1\0\end{bmatrix},\begin{bmatrix}0\0\0\1\end{bmatrix}<br>$$</p><p>$$<br>\left[\begin{array}{c}x_0 \ x_1 \ x_2 \ x_3\end{array}\right]<br>\rightarrow<br>\left[\begin{array}{c}a_1^{(2)} \ a_2^{(2)} \ a_3^{(2)} \ â€¦ \end{array}\right]<br>\rightarrow<br>\left[\begin{array}{c}a_1^{(3)} \ a_2^{(3)} \ a_3^{(3)} \ â€¦ \end{array}\right]<br>\rightarrow<br>\cdots<br>\rightarrow<br>\left[\begin{array}{c}h_\Theta(x)_1 \ h_\Theta(x)_2 \ h_\Theta(x)_3 \ h_\Theta(x)_4 \end{array}\right]<br>$$</p><h5 id="ç¥ç»ç½‘ç»œçš„æ‹Ÿåˆ"><a href="#ç¥ç»ç½‘ç»œçš„æ‹Ÿåˆ" class="headerlink" title="ç¥ç»ç½‘ç»œçš„æ‹Ÿåˆ"></a>ç¥ç»ç½‘ç»œçš„æ‹Ÿåˆ</h5><table><thead><tr><th>Notation</th><th>Represent</th></tr></thead><tbody><tr><td>$L$</td><td>ç¥ç»ç½‘ç»œä¸­çš„æ€»å±‚æ•°</td></tr><tr><td>$s_l$</td><td>ç¬¬$l$å±‚ä¸­çš„èŠ‚ç‚¹æ•°ï¼ˆä¸ç®—åç§»å•å…ƒ$a_0$ï¼‰</td></tr><tr><td>$K$</td><td>è¾“å‡ºèŠ‚ç‚¹æ•°</td></tr></tbody></table><p><strong>ä»£ä»·å‡½æ•°</strong>ï¼š<br>$$<br>J(\Theta)=-\frac{1}{m}\sum_{i=1}^{m}\sum_{k=1}^{K}\Big[<br>y_k^{(i)}log\Big(\big(h_\Theta(x^{(i)})\big)<em>k\Big)+<br>(1-y_k^{(i)})log\Big(1-\big(h_\Theta(x^{(i)})\big)<em>k\Big)<br>\Big]+<br>\frac{\lambda}{2m}\sum</em>{l=1}^{L-1}\sum</em>{i=1}^{s_l}\sum_{j=1}^{s_{l+1}}\Big(\Theta_{j,i}^{(l)}\Big)^2<br>$$<br><strong>å‘åä¼ æ’­ç®—æ³•</strong>ï¼š<br>$$<br>\begin{array}{lll}<br>\textrm{Give training set }{(x^{(1)},y^{(1)}),â€¦,(x^{(m)},y^{(m)})}\<br>\textrm{Set }\Delta_{i,j}^{(l)}:=0\textrm{ for each } l,i,j \textrm{ (get a matrix full of zeros)}\<br>\mathop{\textrm{For}} \textrm{ training example $t=1$ to $m$}:\<br>\qquad a^{(1)}:= x^{(t)}\<br>\qquad \textrm{Compute $a^{(l)}$ for $l=2,3,\cdots,L$ by forward propagation}\<br>\qquad \textrm{Using $y^{(t)}$ to compute } \delta^{(L)}=a^{(L)}-y^{(t)}\<br>\qquad \textrm{Compute } \delta^{(l)}=\big((\Theta^{(l)})^T\delta^{(l+1)}\big).<em>a^{(l)}.</em>(1-a^{(l)}) \textrm{ for } \delta^{(L-1)},\delta^{(L-2)},â€¦,\delta^{(2)}\<br>\qquad \Delta^{(l)}:=\Delta^{(l)}+\delta^{(l+1)}(a^{(l)})^T\<br>\textrm{End For}\<br>D_{i,j}^{(l)}:=\frac{1}{m}\Delta_{i,j}^{(l)}\textrm{ if } j=0\<br>D_{i,j}^{(l)}:=\frac{1}{m}\big(\Delta_{i,j}^{(l)}+\lambda\Theta_{i,j}^{(l)}\big) \textrm{ if } j\neq 0 \<br>\textrm{Get }<br>\frac{\partial}{\partial\Theta_{i,j}^{(l)}}J(\Theta)=D_{i,j}^{(l)}<br>\end{array}<br>$$<br>æ³¨ï¼šä¸Šå¼ä¸­ $.*$ ä»£è¡¨ Matlab/Octave ä¸­çš„ element-wise çš„ä¹˜æ³•ã€‚</p><p><strong>å‘åä¼ æ’­çš„ä½¿ç”¨</strong>ï¼š</p><p>å…ˆçœ‹å‡ ä¸ªæ¶‰åŠåˆ°çš„æ–¹æ³•ï¼š</p><ul><li>å‚æ•°å±•å¼€ï¼šä¸ºä½¿ç”¨ä¼˜åŒ–å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ‰€æœ‰çš„$\Theta$çŸ©é˜µå±•å¼€å¹¶æ‹¼æ¥æˆä¸€ä¸ªé•¿å‘é‡ï¼š</li></ul><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">thetaVector = [ Theta1(:); Theta2(:); Theta3(:) ];</span><br><span class="line">deltaVector = [ D1(:); D2(:); D3(:) ];</span><br></pre></td></tr></table></figure><p>åœ¨å¾—åˆ°ä¼˜åŒ–ç»“æœåè¿”å›åŸæ¥çš„çŸ©é˜µï¼š</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Theta1 = <span class="built_in">reshape</span>(thetaVector(<span class="number">1</span>:<span class="number">110</span>),<span class="number">10</span>,<span class="number">11</span>)</span><br><span class="line">Theta2 = <span class="built_in">reshape</span>(thetaVector(<span class="number">111</span>:<span class="number">220</span>),<span class="number">10</span>,<span class="number">11</span>)</span><br><span class="line">Theta3 = <span class="built_in">reshape</span>(thetaVector(<span class="number">221</span>:<span class="number">231</span>),<span class="number">1</span>,<span class="number">11</span>)</span><br></pre></td></tr></table></figure><ul><li>æ¢¯åº¦æ£€æŸ¥ï¼šåˆ©ç”¨ $\frac{\partial}{\partial\Theta_j}J(\Theta) \approx \frac{J(\Theta_1,â€¦,\Theta_j+\epsilon,â€¦,\Theta_n)-J(\Theta_1,â€¦,\Theta_j-\epsilon,â€¦,\Theta_n)}{2\epsilon}$ å–ä¸€ä¸ªå°çš„é‚»åŸŸå¦‚ $\epsilon=10^{-4}$ï¼Œå¯ä»¥æ£€æŸ¥æˆ‘ä»¬ç”¨å‘åä¼ æ’­æ±‚å‡ºçš„æ¢¯åº¦æ˜¯å¦æ­£ç¡®ï¼ˆè‹¥æ­£ç¡®ï¼Œæœ‰ gradApprox â‰ˆ deltaVector æˆç«‹ï¼‰ã€‚ä»£ç å®ç°ï¼š</li></ul><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">epsilon = <span class="number">1e-4</span>;</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span> : n</span><br><span class="line">thetaPlus = theta;</span><br><span class="line">thetaPlus(<span class="built_in">i</span>) += epsilon;</span><br><span class="line">thetaMinus = theta;</span><br><span class="line">thetaMinus(<span class="built_in">i</span>) += epsilon;</span><br><span class="line">gradApprox(<span class="built_in">i</span>) = (J(thetaPlus) - J(thetaMinus)) / (<span class="number">2</span>*epsilon);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ul><li>éšå³åˆå§‹åŒ–ï¼šåœ¨å¼€å§‹æ—¶ï¼Œå°† $\Theta_{ij}^{(l)}$ éšæœºåˆå§‹åŒ–ï¼Œåº”ä¿è¯éšæœºå€¼çš„å–å€¼åœ¨ä¸€ä¸ª $[-\epsilon,\epsilon]$ çš„èŒƒå›´å†…ï¼ˆè¿™ä¸ª $\epsilon$ ä¸æ¢¯åº¦æ£€æŸ¥ä¸­çš„æ— å…³ï¼‰ã€‚ä»£ç å®ç°ï¼š</li></ul><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># If the dimensions of Theta1 is 10x11, Theta2 is 10x11 and Theta3 is 1x11.</span><br><span class="line"></span><br><span class="line">Theta1 = <span class="built_in">rand</span>(<span class="number">10</span>,<span class="number">11</span>) * (<span class="number">2</span> * INIT_EPSILON) - INIT_EPSILON;</span><br><span class="line">Theta2 = <span class="built_in">rand</span>(<span class="number">10</span>,<span class="number">11</span>) * (<span class="number">2</span> * INIT_EPSILON) - INIT_EPSILON;</span><br><span class="line">Theta3 = <span class="built_in">rand</span>(<span class="number">1</span>,<span class="number">11</span>) * (<span class="number">2</span> * INIT_EPSILON) - INIT_EPSILON;</span><br></pre></td></tr></table></figure><p>å°†ä¸Šè¿°æŠ€å·§ä¸å‘åä¼ æ’­ç®—æ³•ç»“åˆï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†äº†è®­ç»ƒç¥ç»ç½‘ç»œçš„æ–¹æ³•ï¼š</p><ol><li>éšæœºåˆå§‹åŒ–</li><li>å‘å‰ä¼ æ’­å¾—åˆ° $h_\Theta(x^{(i)})$ å¯¹ä»»æ„ $x^{(i)}$</li><li>è®¡ç®—ä»£ä»·å‡½æ•°</li><li>ä½¿ç”¨å‘åä¼ æ’­è®¡ç®—åå¯¼</li><li>åˆ©ç”¨æ¢¯åº¦æ£€æŸ¥éªŒè¯å‘åä¼ æ’­æ˜¯å¦æ­£ç¡®ï¼Œè‹¥æ²¡é—®é¢˜åˆ™å…³é—­æ¢¯åº¦æ£€æŸ¥åŠŸèƒ½</li><li>ä½¿ç”¨æ¢¯åº¦ä¸‹é™æˆ–ä¼˜åŒ–å‡½æ•°å¾—åˆ°$\Theta$</li></ol><p>ğŸ‘‰ä»£ç å®ç°ï¼š</p><ol><li>éšæœºåˆå§‹åŒ–</li></ol><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">W</span> = <span class="title">randInitializeWeights</span><span class="params">(L_in, L_out)</span></span></span><br><span class="line"><span class="comment">%RANDINITIALIZEWEIGHTS Randomly initialize the weights of a layer with L_in</span></span><br><span class="line"><span class="comment">%incoming connections and L_out outgoing connections</span></span><br><span class="line"><span class="comment">%   W = RANDINITIALIZEWEIGHTS(L_in, L_out) randomly initializes the weights </span></span><br><span class="line"><span class="comment">%   of a layer with L_in incoming connections and L_out outgoing </span></span><br><span class="line"><span class="comment">%   connections. </span></span><br><span class="line"><span class="comment">%</span></span><br><span class="line"><span class="comment">%   Note that W should be set to a matrix of size(L_out, 1 + L_in) as</span></span><br><span class="line"><span class="comment">%   the first column of W handles the &quot;bias&quot; terms</span></span><br><span class="line"><span class="comment">%</span></span><br><span class="line"></span><br><span class="line">W = <span class="built_in">zeros</span>(L_out, <span class="number">1</span> + L_in);</span><br><span class="line"></span><br><span class="line"><span class="comment">% epsilon_init = 0.12</span></span><br><span class="line">epsilon_init = <span class="built_in">sqrt</span>(<span class="number">6</span> / (L_in + L_out));</span><br><span class="line">W = <span class="built_in">rand</span>(L_out, <span class="number">1</span> + L_in) * (<span class="number">2</span> * epsilon_init) - epsilon_init;</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ol start="2"><li>è®¡ç®—ä»£ä»·</li></ol><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[J grad]</span> = <span class="title">nnCostFunction</span><span class="params">(nn_params, ...</span></span></span><br><span class="line"><span class="function"><span class="params">                                   input_layer_size, ...</span></span></span><br><span class="line"><span class="function"><span class="params">                                   hidden_layer_size, ...</span></span></span><br><span class="line"><span class="function"><span class="params">                                   num_labels, ...</span></span></span><br><span class="line"><span class="function"><span class="params">                                   X, y, lambda)</span></span></span><br><span class="line"><span class="comment">%NNCOSTFUNCTION Implements the neural network cost function for a two layer</span></span><br><span class="line"><span class="comment">%neural network which performs classification</span></span><br><span class="line"><span class="comment">%   [J grad] = NNCOSTFUNCTON(nn_params, hidden_layer_size, num_labels, ...</span></span><br><span class="line"><span class="comment">%   X, y, lambda) computes the cost and gradient of the neural network. The</span></span><br><span class="line"><span class="comment">%   parameters for the neural network are &quot;unrolled&quot; into the vector</span></span><br><span class="line"><span class="comment">%   nn_params and need to be converted back into the weight matrices. </span></span><br><span class="line"><span class="comment">% </span></span><br><span class="line"><span class="comment">%   The returned parameter grad should be a &quot;unrolled&quot; vector of the</span></span><br><span class="line"><span class="comment">%   partial derivatives of the neural network.</span></span><br><span class="line"><span class="comment">%</span></span><br><span class="line"></span><br><span class="line"><span class="comment">% Reshape nn_params back into the parameters Theta_1 and Theta_2, the weight matrices</span></span><br><span class="line"><span class="comment">% for our 2 layer neural network</span></span><br><span class="line">Theta_1 = <span class="built_in">reshape</span>(nn_params(<span class="number">1</span>:hidden_layer_size * (input_layer_size + <span class="number">1</span>)), ...</span><br><span class="line">                 hidden_layer_size, (input_layer_size + <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">Theta_2 = <span class="built_in">reshape</span>(nn_params((<span class="number">1</span> + (hidden_layer_size * (input_layer_size + <span class="number">1</span>))):<span class="keyword">end</span>), ...</span><br><span class="line">                 num_labels, (hidden_layer_size + <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">% Setup some useful variables</span></span><br><span class="line">m = <span class="built_in">size</span>(X, <span class="number">1</span>);</span><br><span class="line">K = num_labels;</span><br><span class="line"></span><br><span class="line">J = <span class="number">0</span>;</span><br><span class="line">Theta_1_grad = <span class="built_in">zeros</span>(<span class="built_in">size</span>(Theta_1));</span><br><span class="line">Theta_2_grad = <span class="built_in">zeros</span>(<span class="built_in">size</span>(Theta_2));</span><br><span class="line"></span><br><span class="line"><span class="comment">% y(5000x1) -&gt; Y(5000x10)</span></span><br><span class="line">Y = <span class="built_in">zeros</span>(m, K);</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span> : m</span><br><span class="line">    Y(<span class="built_in">i</span>, y(<span class="built_in">i</span>)) = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">% Feedforward</span></span><br><span class="line">a_1 = X;</span><br><span class="line">a_1_bias = [<span class="built_in">ones</span>(m, <span class="number">1</span>), a_1];</span><br><span class="line"></span><br><span class="line">z_2 = a_1_bias * Theta_1&#x27;;</span><br><span class="line">a_2 = sigmoid(z_2);</span><br><span class="line">a_2_bias = [<span class="built_in">ones</span>(m, <span class="number">1</span>), a_2];</span><br><span class="line"></span><br><span class="line">z_3 = a_2_bias * Theta_2&#x27;;</span><br><span class="line">a_3 = sigmoid(z_3);</span><br><span class="line">h = a_3;</span><br><span class="line"></span><br><span class="line"><span class="comment">% Cost Function</span></span><br><span class="line"><span class="comment">% for i = 1 : K</span></span><br><span class="line"><span class="comment">%     yK = Y(:, i);</span></span><br><span class="line"><span class="comment">%     hK = h(:, i);</span></span><br><span class="line"><span class="comment">%     J += 1/m * (-yK&#x27;*log(hK) - (1-yK)&#x27;*log(1-hK));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">% J can be get by element-wise compute more elegantly.</span></span><br><span class="line">J = <span class="number">1</span>/m * sum(sum((-Y.*<span class="built_in">log</span>(h) - (<span class="number">1</span>-Y).*<span class="built_in">log</span>(<span class="number">1</span>-h))));</span><br><span class="line"></span><br><span class="line"><span class="comment">% Regularize</span></span><br><span class="line">J = J + lambda/(<span class="number">2</span>*m) * (sum(sum(Theta_1(:, <span class="number">2</span>:<span class="keyword">end</span>).^<span class="number">2</span>)) + sum(sum(Theta_2(:, <span class="number">2</span>:<span class="keyword">end</span>).^<span class="number">2</span>)));</span><br><span class="line"></span><br><span class="line"><span class="comment">% Backpropagation</span></span><br><span class="line"></span><br><span class="line">delta_3 = a_3 .- Y;</span><br><span class="line">delta_2 = (delta_3 * Theta_2) .* sigmoidGradient([<span class="built_in">ones</span>(m, <span class="number">1</span>), z_2]);</span><br><span class="line"><span class="comment">% sigmoidGradient: return g = sigmoid(z) .* (1 - sigmoid(z));</span></span><br><span class="line">delta_2 = delta_2(:, <span class="number">2</span>:<span class="keyword">end</span>);</span><br><span class="line"></span><br><span class="line">Delta_1 = delta_2&#x27; * a_1_bias;</span><br><span class="line">Delta_2 = delta_3&#x27; * a_2_bias;</span><br><span class="line"></span><br><span class="line">Theta_1_grad = Delta_1 ./ m + lambda/m * [<span class="built_in">zeros</span>(<span class="built_in">size</span>(Theta_1, <span class="number">1</span>), <span class="number">1</span>), Theta_1(:, <span class="number">2</span>:<span class="keyword">end</span>)];</span><br><span class="line">Theta_2_grad = Delta_2 ./ m + lambda/m * [<span class="built_in">zeros</span>(<span class="built_in">size</span>(Theta_2, <span class="number">1</span>), <span class="number">1</span>), Theta_2(:, <span class="number">2</span>:<span class="keyword">end</span>)];</span><br><span class="line"></span><br><span class="line"><span class="comment">% Unroll gradients</span></span><br><span class="line">grad = [Theta_1_grad(:) ; Theta_2_grad(:)];</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ol start="3"><li>é¢„æµ‹</li></ol><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">p</span> = <span class="title">predict</span><span class="params">(Theta1, Theta2, X)</span></span></span><br><span class="line"><span class="comment">%PREDICT Predict the label of an input given a trained neural network</span></span><br><span class="line"><span class="comment">%   p = PREDICT(Theta1, Theta2, X) outputs the predicted label of X given the</span></span><br><span class="line"><span class="comment">%   trained weights of a neural network (Theta1, Theta2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">% Useful values</span></span><br><span class="line">m = <span class="built_in">size</span>(X, <span class="number">1</span>);</span><br><span class="line">num_labels = <span class="built_in">size</span>(Theta2, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">p = <span class="built_in">zeros</span>(<span class="built_in">size</span>(X, <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">h1 = sigmoid([<span class="built_in">ones</span>(m, <span class="number">1</span>) X] * Theta1&#x27;);</span><br><span class="line">h2 = sigmoid([<span class="built_in">ones</span>(m, <span class="number">1</span>) h1] * Theta2&#x27;);</span><br><span class="line">[dummy, p] = <span class="built_in">max</span>(h2, [], <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ol start="4"><li>é©±åŠ¨</li></ol><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">input_layer_size  = <span class="number">400</span>;  <span class="comment">% 20x20 Input Images of Digits</span></span><br><span class="line">hidden_layer_size = <span class="number">25</span>;   <span class="comment">% 25 hidden units</span></span><br><span class="line">num_labels = <span class="number">10</span>;          <span class="comment">% 10 labels, from 1 to 10   </span></span><br><span class="line">                          <span class="comment">% (note that we have mapped &quot;0&quot; to label 10)</span></span><br><span class="line"></span><br><span class="line">fprintf(<span class="string">&#x27;\nInitializing Neural Network Parameters ...\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">load(<span class="string">&#x27;Xy.mat&#x27;</span>);</span><br><span class="line"></span><br><span class="line">fprintf(<span class="string">&#x27;\nTraining Neural Network... \n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">%  value to see how more training helps.</span></span><br><span class="line">options = optimset(<span class="string">&#x27;MaxIter&#x27;</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">lambda = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">% Create &quot;short hand&quot; for the cost function to be minimized</span></span><br><span class="line">costFunction = @(p) nnCostFunction(p, ...</span><br><span class="line">                                   input_layer_size, ...</span><br><span class="line">                                   hidden_layer_size, ...</span><br><span class="line">                                   num_labels, X, y, lambda);</span><br><span class="line"></span><br><span class="line"><span class="comment">% Now, costFunction is a function that takes in only one argument (the</span></span><br><span class="line"><span class="comment">% neural network parameters)</span></span><br><span class="line">[nn_params, cost] = fmincg(costFunction, initial_nn_params, options);</span><br><span class="line"></span><br><span class="line"><span class="comment">% Obtain Theta1 and Theta2 back from nn_params</span></span><br><span class="line">Theta1 = <span class="built_in">reshape</span>(nn_params(<span class="number">1</span>:hidden_layer_size * (input_layer_size + <span class="number">1</span>)), ...</span><br><span class="line">                 hidden_layer_size, (input_layer_size + <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">Theta2 = <span class="built_in">reshape</span>(nn_params((<span class="number">1</span> + (hidden_layer_size * (input_layer_size + <span class="number">1</span>))):<span class="keyword">end</span>), ...</span><br><span class="line">                 num_labels, (hidden_layer_size + <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">pred = predict(Theta1, Theta2, X);</span><br><span class="line"></span><br><span class="line">fprintf(<span class="string">&#x27;\nTraining Set Accuracy: %f\n&#x27;</span>, <span class="built_in">mean</span>(double(pred == y)) * <span class="number">100</span>);</span><br></pre></td></tr></table></figure><h4 id="æ”¯æŒå‘é‡æœº"><a href="#æ”¯æŒå‘é‡æœº" class="headerlink" title="æ”¯æŒå‘é‡æœº"></a>æ”¯æŒå‘é‡æœº</h4><p>ä¼˜åŒ–ç›®æ ‡ï¼š<br>$$<br>\min_\theta<br>C\sum_{i=1}^m \large[ y^{(i)} \mathop{\textrm{cost}_1}(\theta^Tx^{(i)})</p><ul><li>(1 - y^{(i)})\ \mathop{\textrm{cost}_0}(\theta^Tx^{(i)})\large]</li><li>\frac{1}{2}\sum_{j=1}^n \theta_j^2<br>$$<br>å½“ $C$ å€¼æ¯”è¾ƒå¤§æ—¶ï¼Œè¿™ä¸ªä¼˜åŒ–ç›®æ ‡ä¼šé€‰æ‹©å°†ç¬¬ä¸€ä¸ªæ±‚å’Œé¡¹è¶‹äºé›¶ï¼Œè¿™æ ·ä¼˜åŒ–ç›®æ ‡å°±å˜æˆäº†ï¼š<br>$$<br>\begin{array}{l}<br>  \min_\theta \frac{1}{2}\sum_{j=1}^{n}\theta_j^2\\<br>  s.t. \quad \begin{array}{l}<pre><code>  \theta^Tx^&#123;(i)&#125; \ge 1 &amp; \textrm&#123;if &#125; y^&#123;(i)&#125;=1\\  \theta^Tx^&#123;(i)&#125; \le -1 &amp; \textrm&#123;if &#125; y^&#123;(i)&#125;=0</code></pre>  \end{array}<br>\end{array}<br>$$<br>ç”±æ¬§æ°ç©ºé—´çš„çŸ¥è¯†ï¼š<br>$$<br>\begin{array}{ccl}<br>||u|| &amp;=&amp; \textrm{length of vector } u= \sqrt{u_1^2+u_2^2}\<br>p &amp;=&amp; \textrm{length of projection of } v \textrm{ onto } u \textrm{ (signed)} \ \<br>u^Tv &amp;=&amp; p \cdot ||u||<br>\end{array}<br>$$<br>ä¸Šå¼å¯è¡¨ç¤ºä¸ºï¼š<br>$$<br>\begin{array}{l}<br>  \min_\theta \frac{1}{2}\sum_{j=1}^{n}\theta_j^2<br>  =\frac{1}{2}\Big(\sqrt{\sum_{j=1}^n\theta_j^2}\Big)^2<br>  =\frac{1}{2}||\theta||^2 \\<br>  s.t. \quad \begin{array}{l}<pre><code>  p^&#123;(i)&#125;\cdot ||\theta|| \ge 1 &amp; \textrm&#123;if &#125; y^&#123;(i)&#125;=1\\  p^&#123;(i)&#125;\cdot ||\theta|| \le -1 &amp; \textrm&#123;if &#125; y^&#123;(i)&#125;=0</code></pre>  \end{array}\\<br>  \textrm{where $p^{(i)}$ is the projection of $x^{(i)}$ onto the vector $\theta$.}<br>\end{array}<br>$$<br>SVM ä¼šé€‰æ‹©æœ€å¤§çš„é—´éš™ï¼š</li></ul><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gax9ziqe3sj324i0nu0z9.jpg" alt="å±å¹•å¿«ç…§ 2019-10-31 12.58.43"></p><h5 id="æ ¸æ–¹æ³•"><a href="#æ ¸æ–¹æ³•" class="headerlink" title="æ ¸æ–¹æ³•"></a>æ ¸æ–¹æ³•</h5><p>é¢å¯¹å¦‚ä¸‹åˆ†ç±»é—®é¢˜ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gaxa3eq7zuj30c5083gm3.jpg" alt="image-20191102114127170"></p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šé¡¹å¼æ¥å›å½’ï¼Œä¾‹å¦‚ï¼Œå½“ $\theta_0+\theta_1x_1+\theta_2x_2+\theta_3x_1x_2+\theta_4x_1^2+\theta_5x_2^2+\cdots\ge 0$ æ—¶é¢„æµ‹ $y=1$ï¼›</p><p>è¿™æ ·æœ‰å¤ªå¤šå¤šé¡¹å¼æ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘å¦‚ä¸‹æ–¹æ³•ï¼š<br>$$<br>\begin{array}{lcl}<br>\textrm{Predict } y=1 &amp;\textrm{if}&amp;\theta_0+\theta_1f_1+\theta_2f_2+\theta_3f_3+\cdots\ge 0<br>\end{array}<br>$$<br>è¿™é‡Œçš„ $f_1=x_1,f_2=x_2,f_3=x_1x_2,f_4=x_1^2,â€¦$</p><p>æˆ‘ä»¬ç”¨ $f_i$ æ›¿æ¢äº†å¤šé¡¹å¼ï¼Œé¿å…äº†é«˜æ¬¡é¡¹çš„éº»çƒ¦ï¼Œé‚£ä¹ˆå¦‚ä½•ç¡®å®š $f_i$ï¼Ÿå¤§æ¦‚çš„æ€æƒ³å¦‚ä¸‹ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8jljliww8j30o90dmwjt.jpg" alt="image-20191102124615797"></p><p>ä¸ºæ–¹ä¾¿æè¿°ï¼Œå‡è®¾æˆ‘ä»¬åªæœ‰ $x_0,x_1,x_2$ï¼Œå¹¶ä¸”åªæ‰“ç®—æ„é€  $f_1,f_2,f_3$ã€‚é‚£ä¹ˆï¼Œä¸ç®¡ $x_0$ï¼ˆåç§»é¡¹ï¼‰ï¼Œæˆ‘ä»¬ä» $x_1$-$x_2$ çš„å›¾åƒä¸­é€‰æ‹© 3 ä¸ªç‚¹ï¼Œè®°ä¸º $l^{(1)},l^{(2)},l^{(3)}$ï¼Œç§°ä¹‹ä¸º<em>æ ‡è®°ç‚¹</em>ã€‚ä»»ç»™ $x$ï¼Œæˆ‘ä»¬é€šè¿‡è®¡ç®—å…¶ä¸å„æ ‡è®°ç‚¹çš„ä¸´è¿‘ç¨‹åº¦å¾—åˆ°ä¸€ç»„ $f_i$ï¼š<br>$$<br>f_i = \mathop{\textrm{similarity}}(x,l^{(i)}) = \exp(-\frac{||x-l^{(i)}||^2}{2\sigma^2}) = \exp(-\frac{\sum_{j=1}^n(x_j-l_j^{(i)})^2}{2\sigma^2})<br>$$<br>è¿™é‡Œå…·ä½“çš„ similarity å‡½æ•°ç§°ä¸º<em>æ ¸å‡½æ•°</em>ï¼Œæ ¸å‡½æ•°å¤šç§å¤šæ ·ã€‚æˆ‘ä»¬è¿™é‡Œå†™çš„æ˜¯å¾ˆå¸¸ç”¨çš„ $\exp(-\frac{\sum_{j=1}^n(x_j-l_j^{(i)})^2}{2\sigma^2})$ ï¼Œç§°ä¸º Gaussian Kernelï¼Œä»–çš„ä»£ç å®ç°å¦‚ä¸‹ï¼š</p><p>ç”±è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œç»™å®š $x$ï¼Œå¯¹æ¯ä¸ª $l^{(i)}$ æˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ª $f_i$ï¼Œæ»¡è¶³ï¼š</p><ol><li>å½“ $x$ æ¥è¿‘ $l^{(i)}$ æ—¶</li></ol><p>$$<br>f_i \approx \lim_{x\to l^{(i)}}\exp(-\frac{||x-l^{(i)}||^2}{2\sigma^2}) = \exp(-\frac{0^2}{2\sigma^2}) = 1<br>$$</p><ol start="2"><li>å½“ $x$ è¿œç¦» $l^{(i)}$ æ—¶</li></ol><p>$$<br>f_i \approx \lim_{||x-l^{(i)}||\to +\infin}\exp(-\frac{||x-l^{(i)}||^2}{2\sigma^2}) = \exp(-\frac{\infin^2}{2\sigma^2}) = 0<br>$$</p><p>$\sigma$ çš„é€‰æ‹©ä¼šå½±å“ $f_i$ å€¼éš $x$ è¿œç¦» $l^{(i)}$ è€Œä¸‹é™çš„é€Ÿåº¦ï¼Œ$\sigma^2$ è¶Šå¤§ï¼Œ$f_i$å‡å°åœ°è¶Šæ…¢ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8jmrwo86pj30ph0dwwm1.jpg" alt="image-20191102132852867"></p><p>ä½¿ç”¨æ ¸æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åšå‡ºè¿™ç§é¢„æµ‹ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8jmzc2qq4j30ot0ditej.jpg" alt="image-20191102133600603"></p><p>å½“ä¸”ä»…å½“ç»™å®š$x$ä¸´è¿‘$l^{(1)}$ æˆ– $l^{(2)}$ æ—¶é¢„æµ‹ 1ï¼Œå¦åˆ™é¢„æµ‹ 0.</p><h5 id="SVM-ä¸­ä½¿ç”¨æ ¸"><a href="#SVM-ä¸­ä½¿ç”¨æ ¸" class="headerlink" title="SVM ä¸­ä½¿ç”¨æ ¸"></a>SVM ä¸­ä½¿ç”¨æ ¸</h5><ol><li><p>ç»™å®šè®­ç»ƒé›† $(x^{(1)},y^{(1)}),(x^{(2)},y^{(2)}),â€¦,(x^{(m)},y^{(m)})$</p></li><li><p>é€‰æ‹©æ ‡è®°ç‚¹ï¼š$l^{(i)}=x^{(i)} \quad \textrm{for }i=1,2,\cdots,m$</p></li><li><p>å¯¹äºæ ·æœ¬ $x$ï¼Œè®¡ç®—æ ¸ï¼š$f_i=\mathop{\textrm{similarity}}(x,l^{(i)}) \quad \textrm{for }i=1,2,\cdots,m$</p></li><li><p>ä»¤ $f=[f_0,f_1,f_2,\cdots,f_m]^T$ï¼Œå…¶ä¸­ $f_0 \equiv 1$ã€‚</p></li></ol><p>é¢„æµ‹ï¼š</p><ul><li>ç»™å®š $x$ï¼Œè®¡ç®— $f\in\R^{m+1}$</li><li>é¢„æµ‹ $y=1$ å¦‚æœ $\theta^Tf=\theta_0f_0+\theta_1f_1+\cdots\ge 0$</li></ul><p>è®­ç»ƒï¼š<br>$$<br>\min_\theta<br>C\sum_{i=1}^m \large[ y^{(i)} \mathop{\textrm{cost}_1}(\theta^Tf^{(i)})</p><ul><li>(1 - y^{(i)})\ \mathop{\textrm{cost}_0}(\theta^Tf^{(i)})\large]</li><li>\frac{1}{2}\sum_{j=1}^n \theta_j^2<br>$$<br>å®ç°ï¼š</li></ul><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¯¸å¦‚ liblinear, libsvm ä¹‹ç±»çš„åº“æ¥å¾—åˆ° SVM çš„ å‚æ•° $\theta$ï¼Œè¦ä½¿ç”¨è¿™äº›åº“ï¼Œæˆ‘ä»¬ä¸€èˆ¬éœ€è¦åšä»¥ä¸‹å·¥ä½œï¼š</p><ul><li>é€‰æ‹©å‚æ•° $C$</li><li>é€‰æ‹©æ ¸å‡½æ•°<ul><li><strong>No kernel</strong>ï¼ˆå³çº¿æ€§æ ¸ï¼Œäº¦å³åšé€»è¾‘å›å½’ï¼šPredict $y=1$ if $\theta^Tx\ge0$ï¼‰ï¼Œé€‚ç”¨äº <strong>nå¤§ må°</strong> çš„æƒ…å†µï¼ˆé¿å…è¿‡æ‹Ÿåˆï¼‰</li><li><strong>Gaussian kernel</strong>ï¼ˆ$f_i=\exp(-\frac{||x-l^{(i)}||^2}{2\sigma^2})\textrm{ where } l^{(i)}=x^{(i)} \textrm{ for } i=1,\cdots,m$ï¼‰é€‚ç”¨äº <strong>må¤§ nå°</strong> çš„æƒ…å†µï¼ˆå¯æ‹Ÿåˆæ›´å¤æ‚çš„éçº¿æ€§è¾¹ç•Œï¼‰</li></ul></li><li>æä¾›æ ¸å‡½æ•°ï¼ˆGaussian kernel ä¸ºä¾‹ï¼‰ï¼š</li></ul><p>$$<br>\begin{array}{l}<br>\textrm{function f = kernel(x1, x2)}\<br>\qquad \textrm{f} = \exp(-\frac{||\textrm{x1}-\textrm{x2}||^2}{2\sigma^2})\<br>\textrm{return}<br>\end{array}<br>$$</p><p>æ³¨æ„ï¼šä½¿ç”¨ Gaussian Kernel å‰åŠ¡å¿…åšç‰¹å¾ç¼©æ”¾ï¼</p><p>ğŸ‘‰æ— æ ¸å‡½æ•°çš„ä»£ç å®ç°ï¼š</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sim</span> = <span class="title">linearKernel</span><span class="params">(x1, x2)</span></span></span><br><span class="line"><span class="comment">%LINEARKERNEL returns a linear kernel between x1 and x2</span></span><br><span class="line"><span class="comment">%   sim = linearKernel(x1, x2) returns a linear kernel between x1 and x2</span></span><br><span class="line"><span class="comment">%   and returns the value in sim</span></span><br><span class="line"></span><br><span class="line"><span class="comment">% Ensure that x1 and x2 are column vectors</span></span><br><span class="line">x1 = x1(:); x2 = x2(:);</span><br><span class="line"></span><br><span class="line"><span class="comment">% Compute the kernel</span></span><br><span class="line">sim = x1&#x27; * x2;  <span class="comment">% dot product</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>ğŸ‘‰é«˜æ–¯æ ¸çš„ä»£ç å®ç°ï¼š</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sim</span> = <span class="title">gaussianKernel</span><span class="params">(x1, x2, sigma)</span></span></span><br><span class="line"><span class="comment">%RBFKERNEL returns a radial basis function kernel between x1 and x2</span></span><br><span class="line"><span class="comment">%   sim = gaussianKernel(x1, x2) returns a gaussian kernel between x1 and x2</span></span><br><span class="line"><span class="comment">%   and returns the value in sim</span></span><br><span class="line"></span><br><span class="line"><span class="comment">% Ensure that x1 and x2 are column vectors</span></span><br><span class="line">x1 = x1(:); x2 = x2(:);</span><br><span class="line"></span><br><span class="line">sim = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">sim = <span class="built_in">exp</span>(-sum((x1 - x2).^<span class="number">2</span>) / (<span class="number">2</span> * sigma ^ <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>ğŸ‘‰SVM ç¤ºä¾‹ï¼š</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">% Load X, y, Xtest and ytest</span></span><br><span class="line">load(<span class="string">&#x27;data.mat&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">% SVM Parameters</span></span><br><span class="line">C = <span class="number">1</span>;         <span class="comment">% C = 1 ~ 100 is fine</span></span><br><span class="line">sigma = <span class="number">0.1</span>;    <span class="comment">% sigma = 0.03 ~ 0.1 gives somewhat good boundary, less is better</span></span><br><span class="line"></span><br><span class="line"><span class="comment">% We set the tolerance and max_passes lower here so that the code will run</span></span><br><span class="line"><span class="comment">% faster. However, in practice, you will want to run the training to</span></span><br><span class="line"><span class="comment">% convergence.</span></span><br><span class="line">model= svmTrain(X, y, C, @(x1, x2) gaussianKernel(x1, x2, sigma)); </span><br><span class="line">p = svmPredict(model, Xtest);</span><br><span class="line"></span><br><span class="line">fprintf(<span class="string">&#x27;Test Accuracy: %f\n&#x27;</span>, <span class="built_in">mean</span>(double(p == ytest)) * <span class="number">100</span>);</span><br></pre></td></tr></table></figure><h5 id="å¤šå…ƒåˆ†ç±»-2"><a href="#å¤šå…ƒåˆ†ç±»-2" class="headerlink" title="å¤šå…ƒåˆ†ç±»"></a>å¤šå…ƒåˆ†ç±»</h5><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8jul8myufj30mv0cz0xu.jpg" alt="image-20191102171432072"></p><h4 id="é€»è¾‘å›å½’-vs-ç¥ç»ç½‘ç»œ-vs-SVM"><a href="#é€»è¾‘å›å½’-vs-ç¥ç»ç½‘ç»œ-vs-SVM" class="headerlink" title="é€»è¾‘å›å½’ vs ç¥ç»ç½‘ç»œ vs SVM"></a>é€»è¾‘å›å½’ vs ç¥ç»ç½‘ç»œ vs SVM</h4><p>$n$ = ç‰¹å¾æ•°ï¼ˆ$x\in\R^{n+1}$ï¼‰</p><p>$m$ = è®­ç»ƒæ ·æœ¬æ•°</p><ul><li>nç›¸å¯¹äºmå¤§ ï¼ˆe.g. $n=10,000, m=10 \sim 1000$ï¼‰<ul><li>é€»è¾‘å›å½’ï¼Œæˆ– æ— æ ¸SVM</li></ul></li><li>nå°ã€mé€‚ä¸­ï¼ˆe.g. $n=1\sim1000,m=50,000$ï¼‰<ul><li>ç”¨ Gaussian æ ¸ SVM</li></ul></li><li>nå°ã€må¤§<ul><li>åˆ›é€ /æ·»åŠ ç‰¹å¾ï¼Œç„¶åç”¨ é€»è¾‘å›å½’æˆ–æ— æ ¸SVM</li></ul></li></ul><p>ç¥ç»ç½‘ç»œé€šå¸¸å¯ä»¥è§£å†³ä¸Šè¿°ä»»ä½•ä¸€ç§æƒ…å†µï¼Œä½†å¯èƒ½ç›¸å¯¹è¾ƒæ…¢ã€‚</p><h2 id="æ— ç›‘ç£å­¦ä¹ "><a href="#æ— ç›‘ç£å­¦ä¹ " class="headerlink" title="æ— ç›‘ç£å­¦ä¹ "></a>æ— ç›‘ç£å­¦ä¹ </h2><p>æ— ç›‘ç£å­¦ä¹ æ˜¯åªç»™xæ•°æ®çš„ï¼Œä¸ç»™yã€‚</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8n62mi54pj30lw0catay.jpg" alt="å±å¹•å¿«ç…§ 2019-11-05 14.49.05"></p><h3 id="K-Means-èšç±»"><a href="#K-Means-èšç±»" class="headerlink" title="K-Means èšç±»"></a>K-Means èšç±»</h3><blockquote><p>æŠŠä¸€å †ä¸œè¥¿è‡ªåŠ¨åˆ†æˆKå †ã€‚</p></blockquote><p>è¾“å…¥ï¼š</p><ul><li>$K$ï¼šèšç±»çš„ä¸ªæ•°</li><li>${x^{(1)},x^{(2)},\cdots,x^{(m)}}$ï¼šè®­ç»ƒé›†</li></ul><p>è¾“å‡ºï¼š</p><ul><li>$K$ ä¸ªç±»</li></ul><p>K-Meansç®—æ³•ï¼š<br>$$<br>\begin{array}{l}</p><p>\textrm{Randomly initialize $K$ cluster centroids $\mu_1, \mu_2,â€¦\mu_k \in \R^n$}\<br>\textrm{Repeat }{\<br>\qquad \textrm{for $i=1$ to $m$:}\qquad\textrm{// Cluster assignment step}\<br>\qquad\qquad c^{(i)} := k \ \textrm{ s.t. } \min_k||x^{(i)}-\mu_k||^2 \<br>\qquad \textrm{for $k=1$ to $K$:}\qquad\textrm{// Move centroid step}\<br>\qquad\qquad \mu_k:= \textrm{average (mean) of points assigned to cluster $k$}\<br>}\</p><p>\end{array}<br>$$<br>ä»£ä»·å‡½æ•°ï¼š<br>$$<br>J(c^{(1)},\cdots,c^{(m)},\mu_1,\cdots,\mu_K)=\frac{1}{m}\sum_{i=1}^{m}||x^{(i)}-\mu_{c^{(i)}}||^2<br>$$<br>ä¼˜åŒ–ç›®æ ‡ï¼š<br>$$<br>\min_{<br>\begin{array}{c}<br>    {1}c^{(1)},\cdots,c^{(m)},\<br>    \mu_1,\cdots,\mu_K<br>\end{array}}<br>J(c^{(1)},\cdots,c^{(m)},\mu_1,\cdots,\mu_K)<br>$$<br>å¾—åˆ°è¾ƒä¼˜è§£(ä¸ä¸€å®šèƒ½å¾—åˆ°æœ€ä¼˜è§£)çš„ç®—æ³•ï¼š<br>$$<br>\begin{array}{l}<br>\textrm{For $i=1$ to $100$ &lt;or 50~1000&gt; {}\<br>\qquad\textrm{Randomly initialize K-means.}\<br>\qquad\textrm{Run K-means. Get $c^{(1)},\cdots,c^{(m)},\mu_1,\cdots,\mu_k$}\<br>\qquad\textrm{Compute cost function (distortion):}\<br>\qquad\qquad J(c^{(1)},\cdots,c^{(m)},\mu_1,\cdots,\mu_K)\<br>\textrm{}}\<br>\textrm{pick clustering that gave lowest $J$.}<br>\end{array}<br>$$<br>$K$çš„é€‰æ‹©ï¼š</p><ol><li>æ›´å…·å®é™…é—®é¢˜çš„éœ€æ±‚æ˜“å¾—ï¼›</li><li>é€‰æ‹©æ‹ç‚¹ï¼š<img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gaxja4d68ej30cb0c3jro.jpg" alt="image-20191106171612460"></li></ol><p>ğŸ‘‰<strong>ä»£ç å®ç°</strong></p><ol><li>æ‰¾æœ€è¿‘çš„ç±»ä¸­å¿ƒï¼š</li></ol><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">idx</span> = <span class="title">findClosestCentroids</span><span class="params">(X, centroids)</span></span></span><br><span class="line"><span class="comment">%FINDCLOSESTCENTROIDS computes the centroid memberships for every example</span></span><br><span class="line"><span class="comment">%   idx = FINDCLOSESTCENTROIDS (X, centroids) returns the closest centroids</span></span><br><span class="line"><span class="comment">%   in idx for a dataset X where each row is a single example. idx = m x 1 </span></span><br><span class="line"><span class="comment">%   vector of centroid assignments (i.e. each entry in range [1..K])</span></span><br><span class="line"><span class="comment">%</span></span><br><span class="line"></span><br><span class="line"><span class="comment">% Set K</span></span><br><span class="line">K = <span class="built_in">size</span>(centroids, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">idx = <span class="built_in">zeros</span>(<span class="built_in">size</span>(X,<span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span> : <span class="built_in">size</span>(X, <span class="number">1</span>)</span><br><span class="line">    min_j = <span class="number">0</span>;</span><br><span class="line">    min_l = Inf;</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">j</span> = <span class="number">1</span> : <span class="built_in">size</span>(centroids, <span class="number">1</span>)</span><br><span class="line">        l = sum((X(<span class="built_in">i</span>, :) - centroids(<span class="built_in">j</span>, :)) .^ <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span> l &lt;= min_l</span><br><span class="line">            min_j = <span class="built_in">j</span>;</span><br><span class="line">            min_l = l;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    idx(<span class="built_in">i</span>) = min_j;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ol start="2"><li>è®¡ç®—ä¸­å¿ƒ:</li></ol><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">centroids</span> = <span class="title">computeCentroids</span><span class="params">(X, idx, K)</span></span></span><br><span class="line"><span class="comment">%COMPUTECENTROIDS returns the new centroids by computing the means of the </span></span><br><span class="line"><span class="comment">%data points assigned to each centroid.</span></span><br><span class="line"><span class="comment">%   centroids = COMPUTECENTROIDS(X, idx, K) returns the new centroids by </span></span><br><span class="line"><span class="comment">%   computing the means of the data points assigned to each centroid. It is</span></span><br><span class="line"><span class="comment">%   given a dataset X where each row is a single data point, a vector</span></span><br><span class="line"><span class="comment">%   idx of centroid assignments (i.e. each entry in range [1..K]) for each</span></span><br><span class="line"><span class="comment">%   example, and K, the number of centroids. You should return a matrix</span></span><br><span class="line"><span class="comment">%   centroids, where each row of centroids is the mean of the data points</span></span><br><span class="line"><span class="comment">%   assigned to it.</span></span><br><span class="line"><span class="comment">%</span></span><br><span class="line"></span><br><span class="line"><span class="comment">% Useful variables</span></span><br><span class="line">[m n] = <span class="built_in">size</span>(X);</span><br><span class="line"></span><br><span class="line">centroids = <span class="built_in">zeros</span>(K, n);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span> : K</span><br><span class="line">    ck = <span class="built_in">find</span>(idx == <span class="built_in">i</span>);</span><br><span class="line">    centroids(<span class="built_in">i</span>, :) = sum(X(ck,:)) / <span class="built_in">size</span>(ck, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ol start="3"><li>è¿è¡ŒK-Means</li></ol><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[centroids, idx]</span> = <span class="title">runkMeans</span><span class="params">(X, initial_centroids, ...</span></span></span><br><span class="line"><span class="function"><span class="params">                                      max_iters, plot_progress)</span></span></span><br><span class="line"><span class="comment">%RUNKMEANS runs the K-Means algorithm on data matrix X, where each row of X</span></span><br><span class="line"><span class="comment">%is a single example</span></span><br><span class="line"><span class="comment">%   [centroids, idx] = RUNKMEANS(X, initial_centroids, max_iters, ...</span></span><br><span class="line"><span class="comment">%   plot_progress) runs the K-Means algorithm on data matrix X, where each </span></span><br><span class="line"><span class="comment">%   row of X is a single example. It uses initial_centroids used as the</span></span><br><span class="line"><span class="comment">%   initial centroids. max_iters specifies the total number of interactions </span></span><br><span class="line"><span class="comment">%   of K-Means to execute. plot_progress is a true/false flag that </span></span><br><span class="line"><span class="comment">%   indicates if the function should also plot its progress as the </span></span><br><span class="line"><span class="comment">%   learning happens. This is set to false by default. runkMeans returns </span></span><br><span class="line"><span class="comment">%   centroids, a Kxn matrix of the computed centroids and idx, a m x 1 </span></span><br><span class="line"><span class="comment">%   vector of centroid assignments (i.e. each entry in range [1..K])</span></span><br><span class="line"><span class="comment">% è‹¥ä½¿ç”¨ plot_progress éœ€è¦é¢å¤–çš„ç”»å›¾å‡½æ•°å®ç°ï¼Œè¿™é‡Œæ²¡æœ‰ç»™å‡º.</span></span><br><span class="line"><span class="comment">%</span></span><br><span class="line"></span><br><span class="line"><span class="comment">% Set default value for plot progress</span></span><br><span class="line"><span class="keyword">if</span> ~exist(<span class="string">&#x27;plot_progress&#x27;</span>, <span class="string">&#x27;var&#x27;</span>) || <span class="built_in">isempty</span>(plot_progress)</span><br><span class="line">    plot_progress = <span class="built_in">false</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">% Plot the data if we are plotting progress</span></span><br><span class="line"><span class="keyword">if</span> plot_progress</span><br><span class="line">    <span class="built_in">figure</span>;</span><br><span class="line">    <span class="built_in">hold</span> on;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">% Initialize values</span></span><br><span class="line">[m n] = <span class="built_in">size</span>(X);</span><br><span class="line">K = <span class="built_in">size</span>(initial_centroids, <span class="number">1</span>);</span><br><span class="line">centroids = initial_centroids;</span><br><span class="line">previous_centroids = centroids;</span><br><span class="line">idx = <span class="built_in">zeros</span>(m, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">% Run K-Means</span></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:max_iters</span><br><span class="line">    </span><br><span class="line">    <span class="comment">% Output progress</span></span><br><span class="line">    fprintf(<span class="string">&#x27;K-Means iteration %d/%d...\n&#x27;</span>, <span class="built_in">i</span>, max_iters);</span><br><span class="line">    <span class="keyword">if</span> exist(<span class="string">&#x27;OCTAVE_VERSION&#x27;</span>)</span><br><span class="line">        fflush(stdout);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">% For each example in X, assign it to the closest centroid</span></span><br><span class="line">    idx = findClosestCentroids(X, centroids);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">% Optionally, plot progress here</span></span><br><span class="line">    <span class="keyword">if</span> plot_progress</span><br><span class="line">        plotProgresskMeans(X, centroids, previous_centroids, idx, K, <span class="built_in">i</span>);</span><br><span class="line">        previous_centroids = centroids;</span><br><span class="line">        fprintf(<span class="string">&#x27;Press enter to continue.\n&#x27;</span>);</span><br><span class="line">        input(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">% Given the memberships, compute new centroids</span></span><br><span class="line">    centroids = computeCentroids(X, idx, K);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">% Hold off if we are plotting progress</span></span><br><span class="line"><span class="keyword">if</span> plot_progress</span><br><span class="line">    <span class="built_in">hold</span> off;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ol start="4"><li>é©±åŠ¨è„šæœ¬ï¼š</li></ol><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">% Load an example dataset</span></span><br><span class="line">load(<span class="string">&#x27;data.mat&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">% Settings for running K-Means</span></span><br><span class="line">K = <span class="number">3</span>;</span><br><span class="line">max_iters = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">% For consistency, here we set centroids to specific values</span></span><br><span class="line"><span class="comment">% but in practice you want to generate them automatically, such as by</span></span><br><span class="line"><span class="comment">% settings them to be random examples (as can be seen in</span></span><br><span class="line"><span class="comment">% kMeansInitCentroids).</span></span><br><span class="line">initial_centroids = [<span class="number">3</span> <span class="number">3</span>; <span class="number">6</span> <span class="number">2</span>; <span class="number">8</span> <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">% Run K-Means algorithm. The &#x27;true&#x27; at the end tells our function to plot</span></span><br><span class="line"><span class="comment">% the progress of K-Means</span></span><br><span class="line">[centroids, idx] = runkMeans(X, initial_centroids, max_iters, <span class="built_in">true</span>);</span><br><span class="line">fprintf(<span class="string">&#x27;\nK-Means Done.\n\n&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="PCA-ç»´æ•°çº¦å‡"><a href="#PCA-ç»´æ•°çº¦å‡" class="headerlink" title="PCA ç»´æ•°çº¦å‡"></a>PCA ç»´æ•°çº¦å‡</h3><blockquote><p>ä¸»æˆåˆ†åˆ†æï¼šæŠŠnç»´çš„æ•°æ®(æŠ•å½±)é™åˆ°kç»´ï¼Œç•¥å»ä¸é‡è¦çš„éƒ¨åˆ†(k&lt;=n)ã€‚</p></blockquote><p><strong>PCAç®—æ³•</strong>ï¼š</p><ol><li><p>æ•°æ®é¢„å¤„ç†</p><p>è®­ç»ƒé›†ï¼š$x^{(1)},x^{(2)},\cdots,x^{(m)}$</p><p>é¢„å¤„ç†(feature scaling &amp; mean normalization):</p><ul><li><p>$\mu_j=\frac{1}{m}\sum_{i=1}^m x_j^{(i)},\qquad s_j=\textrm{standard deviation of feature }j$</p></li><li><p>Replace each $x_j^{(i)}$ with $\frac{x_j-\mu_j}{s_j}$</p></li></ul></li></ol><p>2)é™ç»´</p><ol><li>è®¡ç®—åæ–¹å·®çŸ©é˜µ$\Sigma$ï¼ˆè¿™ä¸ªçŸ©é˜µè®°åšå¤§Sigmaï¼Œæ³¨æ„å’Œæ±‚å’Œå·åŒºåˆ†ï¼‰ï¼š<br>$$<br>\Sigma = \frac{1}{m}\sum_{i=1}^n(x^{(i)})(x^{(i)})^T<br>$$</li><li>æ±‚$\Sigma$çš„ç‰¹å¾å€¼(å®é™…ä¸Šæ˜¯å¥‡å¼‚å€¼åˆ†è§£)ï¼š<code>[U, S, V] = svd(Sigma);</code></li><li>ä»ä¸Šä¸€æ­¥svdå¾—åˆ°:<br>$$<br>U = \left[\begin{array}{cccc}<br>| &amp; | &amp;  &amp; |\<br>u^{(1)} &amp; u^{(2)} &amp; \cdots &amp; u^{(n)}\<br>| &amp; | &amp;  &amp; |<br>\end{array}\right]<br>\in \R^{n\times n}<br>\Rightarrow<br>U_{reduce}=\left[\begin{array}{cccc}<br>| &amp; | &amp;  &amp; |\<br>u^{(1)} &amp; u^{(2)} &amp; \cdots &amp; u^{(k)}\<br>| &amp; | &amp;  &amp; |<br>\end{array}\right]<br>$$</li><li>å®Œæˆé™ç»´ï¼š$x\in\R^n\to z\in\R^k$:<br>$$<br>z = U_{reduce}^Tx<br>=\left[\begin{array}{ccc}</li></ol><p>   â€“ &amp; (u^{(1)})^T &amp; â€“\<br>    &amp; \vdots &amp; \<br>   â€“ &amp; (u^{(k)})^T &amp; â€“\<br>   \end{array}\right]x<br>$$</p><p>ğŸ‘‰ä»£ç å®ç°ï¼š</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">% do feature scaling &amp; mean normalization</span></span><br><span class="line"></span><br><span class="line">Sigma = <span class="number">1</span>/m * X&#x27; * X;</span><br><span class="line">[U, S, V] = svd(Sigma);</span><br><span class="line"></span><br><span class="line">Ureduce = U(:, <span class="number">1</span>:K);</span><br><span class="line">Z = X * Ureduce;</span><br></pre></td></tr></table></figure><p><strong>æ•°æ®å¤åŸ</strong>ï¼šå°†æ•°æ®è¿˜åŸåˆ°åŸæ¥çš„ç»´åº¦ï¼ˆ$z\in\R^k \to x_{approx}\in\R^n$ï¼‰ï¼š<br>$$<br>x_{approx}=U_{reduce}z<br>$$<br>ä¸€èˆ¬æƒ…å†µä¸‹ $x \neq x_{approx}$ï¼Œæˆ‘ä»¬åªèƒ½æœŸæœ› $x_{approx}$ å°½é‡æ¥è¿‘ $x$. </p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8ta88gafkj30oz0djaeo.jpg" alt="image-20191110215011122"></p><p><strong>$k$(ä¸»æˆåˆ†ä¸ªæ•°)çš„é€‰æ‹©</strong></p><p>ä¸€èˆ¬ï¼Œé€‰æ‹© $k$ ä¸ºä½¿å¾—ä¸‹å¼æˆç«‹çš„æœ€å°å€¼ï¼š<br>$$<br>\frac{\frac{1}{m}\sum_{i=1}^m||x^{(i)}-x_{approx}^{(i)}||^2}{\frac{1}{m}\sum_{i=1}^{m}||x^{(i)}||^2}\le0.01<br>$$<br>ç®—æ³•ï¼š<br>$$<br>\begin{array}{l}<br>\textrm{Try PCA with } k=1,\cdots,n:\<br>\quad \textrm{Compute } U_{reduce},z^{(1)},\cdots,z^{(m)},x_{approx}^{(1)},\cdots,x_{approx}^{m}\<br>\quad \textrm{Check if } \frac{\frac{1}{m}\sum_{i=1}^m||x^{(i)}-x_{approx}^{(i)}||^2}{\frac{1}{m}\sum_{i=1}^{m}||x^{(i)}||^2}\le0.01<br>\end{array}<br>$$</p><h3 id="å¼‚å¸¸æ£€æµ‹"><a href="#å¼‚å¸¸æ£€æµ‹" class="headerlink" title="å¼‚å¸¸æ£€æµ‹"></a>å¼‚å¸¸æ£€æµ‹</h3><blockquote><p>ä»ä¸€å †æ•°æ®ä¸­æ‰¾å‡ºå¼‚å¸¸äºå…¶ä»–çš„ã€‚</p></blockquote><p>é—®é¢˜æè¿°ï¼šç»™å®šæ•°æ®é›† ${x^{(1)},x^{(2)},\cdots,x^{(m)}}$ï¼Œé€šè¿‡è®­ç»ƒï¼Œåˆ¤æ–­ $x_{test}$ æ˜¯å¦å¼‚å¸¸ã€‚</p><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹$p(x)$ï¼ˆæ¦‚ç‡ï¼‰å»ºç«‹ä¸€ä¸ªæ¨¡å‹ï¼Œé€‰æ‹©ä¸€ä¸ªä¸´ç•Œå€¼ $\epsilon$ï¼Œä½¿ï¼š<br>$$<br>\begin{array}{l}<br>p(x_{test})&lt;\epsilon \Rightarrow \textrm{anomaly}\<br>p(x_{test})\ge\epsilon \Rightarrow \textrm{OK}<br>\end{array}<br>$$<br>è¿™æ ·é—®é¢˜å¯ä»¥è½¬åŒ–ä¸º<em>å¯†åº¦å€¼ä¼°è®¡</em>ã€‚æˆ‘ä»¬å¸¸ç”¨é«˜æ–¯åˆ†å¸ƒè§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h4 id="é«˜æ–¯åˆ†å¸ƒ"><a href="#é«˜æ–¯åˆ†å¸ƒ" class="headerlink" title="é«˜æ–¯åˆ†å¸ƒ"></a>é«˜æ–¯åˆ†å¸ƒ</h4><p>$x$ æœä»é«˜æ–¯åˆ†å¸ƒï¼š$x \sim \mathcal{N}(\mu,\sigma^2)$</p><p>åˆ™ï¼Œ$x$ çš„æ¦‚ç‡ä¸ºï¼š<br>$$<br>p(x) = \frac{1}{\sqrt{2\pi}\sigma}\exp\left(-\frac{(x-\mu)^2}{2\sigma^2}\right)<br>$$<br>å…¶ä¸­å‚æ•° $\mu$ å’Œ $\sigma$ ç”±ä¸‹å¼ç¡®å®šï¼ˆè¿™æ˜¯åœ¨æœºå™¨å­¦ä¹ é‡Œå¸¸ç”¨çš„æ ¼å¼ï¼Œä¸ä¸€å®šå’Œæ•°å­¦é‡Œçš„ä¸€æ ·ï¼‰ï¼š<br>$$<br>\mu=\frac{1}{m}\sum_{i=1}^{m}x^{(i)}<br>$$</p><p>$$<br>\sigma^2=\frac{1}{m}\sum_{i=1}^{m}\left(x^{(i)}-\mu\right)^2<br>$$</p><p>ğŸ‘‰ä»£ç å®ç°ï¼š</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[mu sigma2]</span> = <span class="title">estimateGaussian</span><span class="params">(X)</span></span></span><br><span class="line"><span class="comment">%ESTIMATEGAUSSIAN This function estimates the parameters of a </span></span><br><span class="line"><span class="comment">%Gaussian distribution using the data in X</span></span><br><span class="line"><span class="comment">%   [mu sigma2] = estimateGaussian(X), </span></span><br><span class="line"><span class="comment">%   The input X is the dataset with each n-dimensional data point in one row</span></span><br><span class="line"><span class="comment">%   The output is an n-dimensional vector mu, the mean of the data set</span></span><br><span class="line"><span class="comment">%   and the variances sigma^2, an n x 1 vector</span></span><br><span class="line"><span class="comment">% </span></span><br><span class="line"></span><br><span class="line"><span class="comment">% Useful variables</span></span><br><span class="line">[m, n] = <span class="built_in">size</span>(X);</span><br><span class="line"></span><br><span class="line">mu = <span class="built_in">zeros</span>(n, <span class="number">1</span>);</span><br><span class="line">sigma2 = <span class="built_in">zeros</span>(n, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">mu = <span class="built_in">mean</span>(X);</span><br><span class="line">sigma2 = var(X) * (m - <span class="number">1</span>) / m;</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>å€Ÿæ­¤æˆ‘ä»¬ä¾¿å¯å¾—åˆ°å¼‚å¸¸æ£€æŸ¥ç®—æ³•ï¼š</p><h5 id="å¼‚å¸¸æ£€æŸ¥ç®—æ³•"><a href="#å¼‚å¸¸æ£€æŸ¥ç®—æ³•" class="headerlink" title="å¼‚å¸¸æ£€æŸ¥ç®—æ³•"></a>å¼‚å¸¸æ£€æŸ¥ç®—æ³•</h5><ol><li>é€‰æ‹©è®¤ä¸ºå¯èƒ½è¡¨ç°å‡ºæ ·æœ¬å¼‚å¸¸çš„æ•°æ®ç‰¹å¾ $x_i$</li><li>è®¡ç®—å‚æ•° $\mu_1,\cdots,\mu_n,\sigma_1^2,\cdots,\sigma_n^2$ </li></ol><p>$$<br>\mu=\frac{1}{m}\sum_{i=1}^{m}x^{(i)}<br>$$</p><p>$$<br>\sigma^2=\frac{1}{m}\sum_{i=1}^{m}\left(x^{(i)}-\mu\right)^2<br>$$</p><ol start="3"><li>å¯¹äºæ–°ç»™çš„æ ·æœ¬ $x$ï¼Œè®¡ç®— $p(x)$ï¼š</li></ol><p>$$<br>p(x)=\prod_{j=1}^{n}p(x_j;\mu_j,\sigma_j^2)=\prod_{j=1}^{n}\frac{1}{\sqrt{2\pi}\sigma_j}\exp\left(-\frac{(x_j-\mu_j)^2}{2\sigma_j^2}\right)<br>$$</p><ol start="4"><li>å¦‚æœ$p(x)&lt;\epsilon$ï¼Œåˆ™é¢„æµ‹å¼‚å¸¸ã€‚</li></ol><h4 id="å¤šå…ƒé«˜æ–¯åˆ†å¸ƒ"><a href="#å¤šå…ƒé«˜æ–¯åˆ†å¸ƒ" class="headerlink" title="å¤šå…ƒé«˜æ–¯åˆ†å¸ƒ"></a>å¤šå…ƒé«˜æ–¯åˆ†å¸ƒ</h4><p>$$<br>p(x;\mu,\Sigma)=\frac<br>{\exp\left(-\frac{1}{2}(x-\mu)^T\Sigma^{-1}(x-\mu)\right)}<br>{\sqrt{(2\pi)^{n}|\Sigma|}}<br>$$</p><p>å‚æ•°ï¼š</p><ul><li>$\mu\in\R^n$</li><li>$\Sigma\in\R^{n\times n}$ (covariance matrix, <code>Sigma = 1/m * X&#39; * X;</code>)</li></ul><p>å‚æ•°çš„è®¡ç®—ï¼š<br>$$<br>\mu=\frac{1}{m}\sum_{i=1}^mx^{(i)} \qquad<br>\Sigma=\frac{1}{m}\sum_{i=1}^m\left(x^{(i)}-\mu\right)\left(x^{(i)}-\mu\right)^T<br>$$</p><p>ğŸ‘‰ä»£ç å®ç°ï¼š</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">p</span> = <span class="title">multivariateGaussian</span><span class="params">(X, mu, Sigma2)</span></span></span><br><span class="line"><span class="comment">%MULTIVARIATEGAUSSIAN Computes the probability density function of the</span></span><br><span class="line"><span class="comment">%multivariate gaussian distribution.</span></span><br><span class="line"><span class="comment">%    p = MULTIVARIATEGAUSSIAN(X, mu, Sigma2) Computes the probability </span></span><br><span class="line"><span class="comment">%    density function of the examples X under the multivariate gaussian </span></span><br><span class="line"><span class="comment">%    distribution with parameters mu and Sigma2. If Sigma2 is a matrix, it is</span></span><br><span class="line"><span class="comment">%    treated as the covariance matrix. If Sigma2 is a vector, it is treated</span></span><br><span class="line"><span class="comment">%    as the \sigma^2 values of the variances in each dimension (a diagonal</span></span><br><span class="line"><span class="comment">%    covariance matrix)</span></span><br><span class="line"><span class="comment">%</span></span><br><span class="line"></span><br><span class="line">k = <span class="built_in">length</span>(mu);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">size</span>(Sigma2, <span class="number">2</span>) == <span class="number">1</span>) || (<span class="built_in">size</span>(Sigma2, <span class="number">1</span>) == <span class="number">1</span>)</span><br><span class="line">    Sigma2 = <span class="built_in">diag</span>(Sigma2);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">X = <span class="built_in">bsxfun</span>(@minus, X, mu(:)&#x27;);</span><br><span class="line">p = (<span class="number">2</span> * <span class="built_in">pi</span>) ^ (- k / <span class="number">2</span>) * det(Sigma2) ^ (<span class="number">-0.5</span>) * ...</span><br><span class="line">    <span class="built_in">exp</span>(<span class="number">-0.5</span> * sum(<span class="built_in">bsxfun</span>(@times, X * pinv(Sigma2), X), <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h5 id="ç”¨å¤šå…ƒé«˜æ–¯åˆ†å¸ƒçš„å¼‚å¸¸æ£€æŸ¥"><a href="#ç”¨å¤šå…ƒé«˜æ–¯åˆ†å¸ƒçš„å¼‚å¸¸æ£€æŸ¥" class="headerlink" title="ç”¨å¤šå…ƒé«˜æ–¯åˆ†å¸ƒçš„å¼‚å¸¸æ£€æŸ¥"></a>ç”¨å¤šå…ƒé«˜æ–¯åˆ†å¸ƒçš„å¼‚å¸¸æ£€æŸ¥</h5><ol><li>æ‹Ÿåˆå¤šå…ƒé«˜æ–¯åˆ†å¸ƒçš„ $p(x)$ æ¨¡å‹ï¼Œé€šè¿‡å‚æ•°ï¼š</li></ol><p>$$<br>\mu=\frac{1}{m}\sum_{i=1}^mx^{(i)} \qquad<br>\Sigma=\frac{1}{m}\sum_{i=1}^m\left(x^{(i)}-\mu\right)\left(x^{(i)}-\mu\right)^T<br>$$</p><ol start="2"><li>å¯¹äºæ–°ç»™ $x$ï¼Œè®¡ç®—ï¼š</li></ol><p>$$<br>p(x)=\frac<br>{\exp\left(-\frac{1}{2}(x-\mu)^T\Sigma^{-1}(x-\mu)\right)}<br>{\sqrt{(2\pi)^{n}|\Sigma|}}<br>$$</p><ol start="3"><li>å¦‚æœ$p(x)&lt;\epsilon$ï¼Œåˆ™é¢„æµ‹å¼‚å¸¸ã€‚</li></ol><h4 id="é—¨æ§›é€‰æ‹©"><a href="#é—¨æ§›é€‰æ‹©" class="headerlink" title="é—¨æ§›é€‰æ‹©"></a>é—¨æ§›é€‰æ‹©</h4><p>é€šè¿‡è®¡ç®— $F_1$ å€¼å¯ä»¥å¾—åˆ°æœ€é€‚åˆçš„ $\epsilon$ã€‚</p><p>$F_1$ å€¼ç”± precision ($prec$) å’Œ recall ($rec$) ç»™å‡ºï¼š<br>$$<br>F_1=\frac{2\cdot prec \cdot rec}{prec+rec}<br>$$<br>å…¶ä¸­ï¼š<br>$$<br>prec = \frac{tp}{tp+fp}<br>$$</p><p>$$<br>rec = \frac{tp}{tp+fn}<br>$$</p><ul><li>$tp$ æ˜¯ true positivesï¼šé¢„æµ‹ä¸ºæ­£ï¼Œå®é™…ä¹Ÿä¸ºæ­£</li><li>$fp$ æ˜¯ false positivesï¼šé¢„æµ‹ä¸ºæ­£ï¼Œå®é™…ä¸ºè´Ÿ</li><li>$fn$ æ˜¯ false negativesï¼šé¢„æµ‹ä¸ºè´Ÿï¼Œå®é™…ä¸ºæ­£</li></ul><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8bmwqbebxj30po0dgahc.jpg" alt="image-20191026152903469"></p><p>ğŸ‘‰ä»£ç å®ç°ï¼š</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[bestEpsilon bestF1]</span> = <span class="title">selectThreshold</span><span class="params">(yval, pval)</span></span></span><br><span class="line"><span class="comment">%SELECTTHRESHOLD Find the best threshold (epsilon) to use for selecting</span></span><br><span class="line"><span class="comment">%outliers</span></span><br><span class="line"><span class="comment">%   [bestEpsilon bestF1] = SELECTTHRESHOLD(yval, pval) finds the best</span></span><br><span class="line"><span class="comment">%   threshold to use for selecting outliers based on the results from a</span></span><br><span class="line"><span class="comment">%   validation set (pval) and the ground truth (yval).</span></span><br><span class="line"><span class="comment">%</span></span><br><span class="line"></span><br><span class="line">bestEpsilon = <span class="number">0</span>;</span><br><span class="line">bestF1 = <span class="number">0</span>;</span><br><span class="line">F1 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">stepsize = (<span class="built_in">max</span>(pval) - <span class="built_in">min</span>(pval)) / <span class="number">1000</span>;</span><br><span class="line"><span class="keyword">for</span> epsilon = <span class="built_in">min</span>(pval):stepsize:<span class="built_in">max</span>(pval)</span><br><span class="line"></span><br><span class="line">    cvPredictions = pval &lt; epsilon;</span><br><span class="line">    </span><br><span class="line">    tp = sum((cvPredictions == <span class="number">1</span>) &amp; (yval == <span class="number">1</span>));</span><br><span class="line">    fp = sum((cvPredictions == <span class="number">1</span>) &amp; (yval == <span class="number">0</span>));</span><br><span class="line">    fn = sum((cvPredictions == <span class="number">0</span>) &amp; (yval == <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    prec = tp / (tp + fp);</span><br><span class="line">    rec = tp / (tp + fn);</span><br><span class="line"></span><br><span class="line">    F1 = (<span class="number">2</span> * prec * rec) / (prec + rec);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> F1 &gt; bestF1</span><br><span class="line">       bestF1 = F1;</span><br><span class="line">       bestEpsilon = epsilon;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="æ¨èç³»ç»Ÿ"><a href="#æ¨èç³»ç»Ÿ" class="headerlink" title="æ¨èç³»ç»Ÿ"></a>æ¨èç³»ç»Ÿ</h3><blockquote><p>é€šè¿‡è¯„åˆ†ï¼Œæ¨èç”¨æˆ·æ–°å†…å®¹ã€‚</p></blockquote><p>ç¬¦å·è¯´æ˜ï¼šï¼ˆå‡è®¾æˆ‘ä»¬è¦æ¨èçš„ä¸œè¥¿æ˜¯ç”µå½±ï¼‰</p><ul><li>$n_u$ = ç”¨æˆ·æ•°</li><li>$n_m$ = ç”µå½±æ•°</li><li>$r(i,j)=1$ è‹¥ç”¨æˆ· $j$ å¯¹ç”µå½± $i$ è¯„è¿‡åˆ†ï¼Œå¦åˆ™ä¸º 0</li><li>$y^{(i,j)}$ = ç”¨æˆ· $j$ ç»™ç”µå½± $i$ çš„è¯„åˆ†(åªæœ‰å½“ $r(i,j)=1$ æ—¶æ‰æœ‰å®šä¹‰)</li></ul><h4 id="åŸºäºå†…å®¹æ¨è"><a href="#åŸºäºå†…å®¹æ¨è" class="headerlink" title="åŸºäºå†…å®¹æ¨è"></a>åŸºäºå†…å®¹æ¨è</h4><p><strong>é¢„æµ‹æ¨¡å‹</strong>ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g9bi5bv4etj30nz06lac1.jpg" alt="å±å¹•å¿«ç…§ 2019-11-26 16.04.26"></p><ul><li>$r(i,j)=1$ è‹¥ç”¨æˆ· $j$ å¯¹ç”µå½± $i$ è¯„è¿‡åˆ†</li><li>$y^{(i,j)}$ = ç”¨æˆ· $j$ ç»™ç”µå½± $i$ çš„è¯„åˆ†(å¦‚æœæœ‰å®šä¹‰)</li><li>$\theta^{(j)}$ ç”¨æˆ· $j$ çš„å‚æ•°ï¼ˆå‘é‡ï¼‰</li><li>$x^{(i)}$ ç”µå½± $i$ çš„ç‰¹å¾ï¼ˆå‘é‡ï¼‰</li></ul><p>å¯¹äºç”¨æˆ· $j$ï¼Œç”µå½± $i$ï¼Œé¢„æµ‹è¯„åˆ†ï¼š$(\theta^{(j)})^T(x^{(i)})$ã€‚</p><p><strong>ä¼˜åŒ–ç›®æ ‡</strong>ï¼š</p><ol><li>ä¼˜åŒ– $\theta^{(j)}$ ï¼ˆå¯¹äºå•ä¸ªç”¨æˆ· $j$ çš„å‚æ•°ï¼‰</li></ol><p>$$<br>\min_{\theta^{(j)}}\sum_{i:r(i,j)=1}\left((\theta^{(j)})^Tx^{(i)}-y^{(i,j)}\right)^2+\frac{\lambda}{2}\sum_{k=1}^n \left(\theta_k^{(j)}\right)^2<br>$$</p><ol start="2"><li>ä¼˜åŒ– $\theta^{(1)},\theta^{(2)},\cdots,\theta^{(n_u)}$ï¼ˆå¯¹æ‰€æœ‰ç”¨æˆ·ï¼‰</li></ol><p>$$<br>\min_{\theta^{(1)},\cdots,\theta^{(n_u)}}<br>\sum_{j=1}^{n_u}\sum_{i:r(i,j)=1}\left((\theta^{(j)})^Tx^{(i)}-y^{(i,j)}\right)^2 +<br>\frac{\lambda}{2}\sum_{j=1}^{n_u}\sum_{k=1}^n \left(\theta_k^{(j)}\right)^2<br>$$</p><p>æˆ‘ä»¬å¯ä»¥ç”¨æ¢¯åº¦ä¸‹é™è§£å†³é—®é¢˜ï¼š<br>$$<br>\begin{array}{l}<br>Repeat\quad{\<br>\qquad \theta_0^{(j)}:=\theta_0^{(j)}-\alpha\sum_{i:r(i,j)=1} \big((\theta^{(j)})^T(x^{(i)})-y^{(i,j)}\big)x_0^{(i)}\<br>\qquad \theta_k^{(j)}:=\theta_k^{(j)}-\alpha\Big[\Big(\sum_{i:r(i,j)=1}\big((\theta^{(j)})^T(x^{(i)})-y^{(i)}\big)x_k^{(i)}\Big)+\lambda\theta_k^{(j)}\Big]\qquad (\textrm{for } k \neq 0)\<br>}<br>\end{array}<br>$$</p><h4 id="ååŒè¿‡æ»¤"><a href="#ååŒè¿‡æ»¤" class="headerlink" title="ååŒè¿‡æ»¤"></a>ååŒè¿‡æ»¤</h4><p>åœ¨åŸºäºå†…å®¹æ¨èä¸­æˆ‘ä»¬æœ‰æ—¶ä¼šå¾ˆéš¾æŠŠæ¡ç”µå½±ï¼ˆæˆ‘ä»¬è¦æ¨èçš„ä¸œè¥¿ï¼‰æœ‰å“ªäº›ç‰¹å¾ï¼ˆ$x^{(i)}$ï¼‰ï¼Œæˆ‘ä»¬æƒ³è®©æœºå™¨å­¦ä¹ è‡ªå·±æ‰¾ç‰¹å¾ï¼Œè¿™å°±ç”¨åˆ°ååŒè¿‡æ»¤ã€‚</p><p><strong>æ–°åŠ çš„ä¼˜åŒ–ç›®æ ‡</strong>ï¼šï¼ˆä¹‹å‰åœ¨åŸºäºå†…å®¹æ¨èé‡Œé¢çš„ä¼˜åŒ–ç›®æ ‡ä»éœ€è€ƒè™‘ï¼‰</p><ul><li>ç»™å®š $\theta^{(1)},\theta^{(2)},\cdots,\theta^{(n_u)}$ï¼Œå­¦ä¹  $x^{(i)}$:</li></ul><p>$$<br>\min_{x^{(i)}}\frac{1}{2}\sum_{i:r(i,j)=1}\left((\theta^{(j)})^Tx^{(i)}-y^{(i,j)}\right)^2+\frac{\lambda}{2}\sum_{k=1}^n \left(x_k^{(i)}\right)^2<br>$$</p><ul><li>ç»™å®š $\theta^{(1)},\theta^{(2)},\cdots,\theta^{(n_u)}$ ï¼Œå­¦ä¹  $x^{(1)},\cdots,x^{(n_m)}$ ï¼š</li></ul><p>$$<br>\min_{x^{(1)},\cdots,x^{(n_m)}}\frac{1}{2}<br>\sum_{i=1}^{n_m}\sum_{i:r(i,j)=1}\left((\theta^{(j)})^Tx^{(i)}-y^{(i,j)}\right)^2 +<br>\frac{\lambda}{2}\sum_{i=1}^{n_m}\sum_{k=1}^n \left(x_k^{(i)}\right)^2<br>$$</p><p><strong>ååŒè¿‡æ»¤</strong>ï¼š</p><p>ç°åœ¨æˆ‘ä»¬çš„é—®é¢˜æ˜¯å³æ²¡æœ‰è®­ç»ƒå¥½çš„ $\theta$ï¼Œåˆæ²¡æœ‰ä¸€ç»„å……åˆ†ä¼˜åŒ–çš„ $x$ï¼Œä½†å­¦ä¹  $\theta$ è¦å…ˆæœ‰ $x$ï¼Œå­¦ä¹  $x$ è¦å…ˆæœ‰ $\theta$ã€‚è¿™å°±å˜æˆäº†ä¸€ä¸ªç±»ä¼¼é¸¡ç”Ÿè›‹ã€è›‹ç”Ÿé¸¡çš„é—®é¢˜ã€‚</p><p>æˆ‘ä»¬å¯ä»¥è€ƒè™‘è¿™æ ·è§£å†³è¿™ä¸ªéš¾é¢˜ï¼š</p><p>é¦–å…ˆéšæœºçŒœä¸€ç»„ $\theta$ï¼Œç„¶åç”¨è¿™ç»„ $\theta$ å°±å¯ä»¥å¾—åˆ°ä¸€ç»„ $x$ï¼›ç”¨è¿™ç»„å¾—åˆ°çš„ $x$ åˆå¯ä»¥ä¼˜åŒ– $\theta$ï¼Œä¼˜åŒ–åçš„ $\theta$ åˆæ‹¿æ¥ä¼˜åŒ– $x$ â€¦â€¦ ä¸æ–­é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥æœŸæœ›å¾—åˆ°ä¸€ç»„ $x$ å’Œ $\theta$ éƒ½å……åˆ†ä¼˜åŒ–çš„è§£ï¼ˆäº‹å®ä¸Šå®ƒä»¬æœ€ç»ˆæ˜¯ä¼šæ”¶æ•›çš„ï¼‰ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g9ds8xkjatj30ob0bd0w0.jpg" alt="å±å¹•å¿«ç…§ 2019-11-28 15.20.59"><br>$$<br>\begin{array}{l}</p><p>\textrm{Given }<br>x^{(1)},\cdots,x^{(n_m)}<br>\textrm{ , estimate }<br>\theta^{(1)},\cdots,\theta^{(n_u)}:\<br>\quad<br>\min_{\theta^{(1)},\cdots,\theta^{(n_u)}}<br>\sum_{j=1}^{n_u}\sum_{i:r(i,j)=1}\left((\theta^{(j)})^Tx^{(i)}-y^{(i,j)}\right)^2 +<br>\frac{\lambda}{2}\sum_{j=1}^{n_u}\sum_{k=1}^n \left(\theta_k^{(j)}\right)^2\</p><p>\textrm {Given }<br>\theta^{(1)},\cdots,\theta^{(n_u)}<br>\textrm{ , estimate }<br>x^{(1)},\cdots,x^{(n_m)}:\<br>\quad<br>\min_{x^{(1)},\cdots,x^{(n_m)}}\frac{1}{2}<br>\sum_{i=1}^{n_m}\sum_{i:r(i,j)=1}\left((\theta^{(j)})^Tx^{(i)}-y^{(i,j)}\right)^2 +<br>\frac{\lambda}{2}\sum_{i=1}^{n_m}\sum_{k=1}^n \left(x_k^{(i)}\right)^2<br>\end{array}<br>$$<br>æˆ‘ä»¬éšæœºåˆå§‹åŒ–ä¸€ç»„å‚æ•°ï¼Œç„¶åé‡å¤æ¥å›è®¡ç®— $\theta$ å’Œ $x$ï¼Œæœ€ç»ˆä¼šå¾—åˆ°è§£ï¼Œä½†è¿™æ ·æ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘ä»¬å¯ä»¥åšçš„æ›´é«˜æ•ˆï¼š</p><p><strong>åŒæ—¶</strong>ä¼˜åŒ– $x^{(1)},\cdots,x^{(n_m)}$ å’Œ $\theta^{(1)},\cdots,\theta^{(n_u)}$:<br>$$<br>J(x^{(1)},\cdots,x^{(n_m)},\theta^{(1)},\cdots,\theta^{(n_u)})=<br>\frac{1}{2}<br>\sum_{(i,j):r(i,j)=1}\left((\theta^{(j)})^Tx^{(i)}-y^{(i,j)}\right)^2+<br>\frac{\lambda}{2}\sum_{i=1}^{n_m}\sum_{k=1}^n \left(x_k^{(i)}\right)^2+<br>\frac{\lambda}{2}\sum_{i=1}^{n_m}\sum_{k=1}^n \left(x_k^{(i)}\right)^2<br>$$</p><p>$$<br>\min_{\begin{array}{c}x^{(1)},\cdots,x^{(n_m)}\\theta^{(1)},\cdots,\theta^{(n_u)}\end{array}}<br>J(x^{(1)},\cdots,x^{(n_m)},\theta^{(1)},\cdots,\theta^{(n_u)})<br>$$</p><p><strong>ååŒè¿‡æ»¤ç®—æ³•</strong>ï¼š</p><ol><li>å°† $x^{(1)},\cdots,x^{(n_m)},\theta^{(1)},\cdots,\theta^{(n_u)}$ éšæœºåˆå§‹åŒ–ä¸ºä¸€äº›æ¯”è¾ƒå°çš„éšæœºå€¼</li><li>ä¼˜åŒ– $J(x^{(1)},\cdots,x^{(n_m)},\theta^{(1)},\cdots,\theta^{(n_u)})$</li><li>å¯¹äºç»™å®šç”¨æˆ·ï¼Œè¯¥ç”¨æˆ·çš„å‚æ•°æ˜¯ $\theta$ï¼Œåˆ™ç”¨è®­ç»ƒå¾—åˆ°çš„æŸç”µå½±çš„ç‰¹å¾ $x$ ï¼Œæˆ‘ä»¬å¯ä»¥é¢„æµ‹è¯¥ç”¨æˆ·å¯èƒ½ä¸ºæ­¤ç”µå½±è¯„åˆ†ï¼š$\theta^Tx$ã€‚</li></ol><p><strong>ä½ç§©çŸ©é˜µåˆ†è§£</strong>ï¼š</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æœ€ç»ˆçš„é¢„æµ‹æ˜¯è¿™æ ·çš„ï¼š<br>$$<br>Predict = \left[\begin{array}{ccccc} (x^{(1)})^T(\theta^{(1)}) &amp; \ldots &amp; (x^{(1)})^T(\theta^{(n_u)})\ \vdots &amp; \ddots &amp; \vdots \ (x^{(n_m)})^T(\theta^{(1)}) &amp; \ldots &amp; (x^{(n_m)})^T(\theta^{(n_u)})\end{array}\right]<br>$$<br>è€ƒè™‘åˆ°å‡ ä¹ä¸å¯èƒ½æœ‰ç”¨æˆ·æŠŠæ¥è¿‘æ‰€æœ‰çš„ç”µå½±éƒ½è¯„åˆ†ï¼Œè¿™ä¸ªé¢„æµ‹çŸ©é˜µæ˜¯ç¨€ç–çš„ï¼Œå­˜å‚¨è¿™ä¸ªçŸ©é˜µä¼šé€ æˆå¤§é‡æµªè´¹ï¼Œä¸å¦¨ä»¤ï¼š<br>$$<br>X = \left[\begin{array}{ccc}</p><ul><li>&amp; (x^{(1)})^T &amp; - \<br>&amp; \vdots &amp; \</li><li>&amp; (x^{(n_m)})^T &amp; - \<br>\end{array}\right],<br>\qquad<br>\Theta = \left[\begin{array}{ccc}</li><li>&amp; (\theta^{(1)})^T &amp; - \<br>&amp; \vdots &amp; \</li><li>&amp; (\theta^{(n_u)})^T &amp; - \<br>\end{array}\right]<br>$$<br>åˆ™æœ‰ï¼š<br>$$<br>Predict=X\Theta^T<br>$$<br>æˆ‘ä»¬ä¾¿å°†å®ƒåˆ†ä¸ºäº†ä¸¤éƒ¨åˆ†ã€‚ç”¨è¿™ä¸ªæ–¹æ³•æ±‚å– $X$ å’Œ $\Theta$ï¼Œè·å¾—æ¨èç³»ç»Ÿéœ€è¦çš„å‚æ•°ï¼Œç§°ä¹‹ä¸º<strong>ä½ç§©çŸ©é˜µåˆ†è§£</strong>ã€‚è¯¥æ–¹æ³•ä¸ä»…èƒ½åœ¨ç¼–ç¨‹æ—¶ç›´æ¥é€šè¿‡å‘é‡åŒ–çš„æ‰‹æ³•è·å¾—å‚æ•°ï¼Œè¿˜é€šè¿‡çŸ©é˜µåˆ†è§£èŠ‚çœäº†å†…å­˜ç©ºé—´ã€‚</li></ul><p><strong>å¯»æ‰¾ç›¸å…³ç”µå½±</strong>ï¼š</p><p>æˆ‘ä»¬å¸¸éœ€è¦æ¨èä¸ç”µå½± $i$ ç›¸å…³çš„ç”µå½± $j$ï¼Œå¯ä»¥è¿™æ ·æ‰¾åˆ°ï¼š<br>$$<br>\mathop{\textrm{smallest}} ||x^{(i)}-x^{(j)}||<br>$$<br><strong>å‡å€¼å½’ä¸€åŒ–å¤„ç†</strong>ï¼š</p><p>å†ç”µå½±æ¨èé—®é¢˜ä¸­ï¼Œç”±äºè¯„åˆ†æ€»æ˜¯1åˆ°5åˆ†ï¼ˆæˆ–å…¶ä»–èŒƒå›´ï¼‰ï¼Œæ•…ä¸ç”¨ç‰¹å¾ç¼©æ”¾ï¼Œä½†å¯ä»¥åš mean normalizationï¼š<br>$$<br>\mu_i=\mathop{\textrm{average}} y^{(i,:)}<br>$$</p><p>$$<br>Y_i = Y_i-\mu_i<br>$$</p><p>å¯¹ç”¨æˆ· $j$, ç”µå½± $i$, é¢„æµ‹:<br>$$<br>\left(\Theta^{(j)}\right)^T\left(x^{(i)}\right)+\mu_i<br>$$<br>ğŸ‘‰<strong>ä»£ç å®ç°</strong>ï¼š</p><ol><li>ä»£ä»·å‡½æ•°ï¼š</li></ol><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[J, grad]</span> = <span class="title">cofiCostFunc</span><span class="params">(params, Y, R, num_users, num_movies, ...</span></span></span><br><span class="line"><span class="function"><span class="params">                                  num_features, lambda)</span></span></span><br><span class="line"><span class="comment">%COFICOSTFUNC Collaborative filtering cost function</span></span><br><span class="line"><span class="comment">%   [J, grad] = COFICOSTFUNC(params, Y, R, num_users, num_movies, ...</span></span><br><span class="line"><span class="comment">%   num_features, lambda) returns the cost and gradient for the</span></span><br><span class="line"><span class="comment">%   collaborative filtering problem.</span></span><br><span class="line"><span class="comment">%</span></span><br><span class="line"></span><br><span class="line"><span class="comment">% Unfold the U and W matrices from params</span></span><br><span class="line">X = <span class="built_in">reshape</span>(params(<span class="number">1</span>:num_movies*num_features), num_movies, num_features);</span><br><span class="line">Theta = <span class="built_in">reshape</span>(params(num_movies*num_features+<span class="number">1</span>:<span class="keyword">end</span>), ...</span><br><span class="line">                num_users, num_features);</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line">J = <span class="number">0</span>;</span><br><span class="line">X_grad = <span class="built_in">zeros</span>(<span class="built_in">size</span>(X));</span><br><span class="line">Theta_grad = <span class="built_in">zeros</span>(<span class="built_in">size</span>(Theta));</span><br><span class="line"></span><br><span class="line">h = X * Theta&#x27;;</span><br><span class="line">er = (h - Y) .* R;</span><br><span class="line"></span><br><span class="line">J = <span class="number">1</span>/<span class="number">2</span> * sum(sum(er.^<span class="number">2</span>));</span><br><span class="line">X_grad = er * Theta;</span><br><span class="line">Theta_grad = er&#x27; * X; </span><br><span class="line"></span><br><span class="line"><span class="comment">% Regularized</span></span><br><span class="line"></span><br><span class="line">J += lambda/<span class="number">2</span> *(sum(sum(Theta.^<span class="number">2</span>)) + sum(sum(X.^<span class="number">2</span>)));</span><br><span class="line">X_grad += lambda * X;</span><br><span class="line">Theta_grad += lambda * Theta;</span><br><span class="line">grad = [X_grad(:); Theta_grad(:)];</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ol start="2"><li>å‡å€¼å½’ä¸€</li></ol><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[Ynorm, Ymean]</span> = <span class="title">normalizeRatings</span><span class="params">(Y, R)</span></span></span><br><span class="line"><span class="comment">%NORMALIZERATINGS Preprocess data by subtracting mean rating for every </span></span><br><span class="line"><span class="comment">%movie (every row)</span></span><br><span class="line"><span class="comment">%   [Ynorm, Ymean] = NORMALIZERATINGS(Y, R) normalized Y so that each movie</span></span><br><span class="line"><span class="comment">%   has a rating of 0 on average, and returns the mean rating in Ymean.</span></span><br><span class="line"><span class="comment">%</span></span><br><span class="line"></span><br><span class="line">[m, n] = <span class="built_in">size</span>(Y);</span><br><span class="line">Ymean = <span class="built_in">zeros</span>(m, <span class="number">1</span>);</span><br><span class="line">Ynorm = <span class="built_in">zeros</span>(<span class="built_in">size</span>(Y));</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span>:m</span><br><span class="line">    idx = <span class="built_in">find</span>(R(<span class="built_in">i</span>, :) == <span class="number">1</span>);</span><br><span class="line">    Ymean(<span class="built_in">i</span>) = <span class="built_in">mean</span>(Y(<span class="built_in">i</span>, idx));</span><br><span class="line">    Ynorm(<span class="built_in">i</span>, idx) = Y(<span class="built_in">i</span>, idx) - Ymean(<span class="built_in">i</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><ol start="3"><li>é©±åŠ¨è„šæœ¬</li></ol><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%  Normalize Ratings</span></span><br><span class="line">[Ynorm, Ymean] = normalizeRatings(Y, R);</span><br><span class="line"></span><br><span class="line"><span class="comment">%  Useful Values</span></span><br><span class="line">num_users = <span class="built_in">size</span>(Y, <span class="number">2</span>);</span><br><span class="line">num_movies = <span class="built_in">size</span>(Y, <span class="number">1</span>);</span><br><span class="line">num_features = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">% Set Initial Parameters (Theta, X)</span></span><br><span class="line">X = <span class="built_in">randn</span>(num_movies, num_features);</span><br><span class="line">Theta = <span class="built_in">randn</span>(num_users, num_features);</span><br><span class="line"></span><br><span class="line">initial_parameters = [X(:); Theta(:)];</span><br><span class="line"></span><br><span class="line"><span class="comment">% Set options for fmincg</span></span><br><span class="line">options = optimset(<span class="string">&#x27;GradObj&#x27;</span>, <span class="string">&#x27;on&#x27;</span>, <span class="string">&#x27;MaxIter&#x27;</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">% Set Regularization</span></span><br><span class="line">lambda = <span class="number">10</span>;</span><br><span class="line">theta = fmincg (@(t)(cofiCostFunc(t, Ynorm, R, num_users, num_movies, ...</span><br><span class="line">                                num_features, lambda)), ...</span><br><span class="line">                initial_parameters, options);</span><br><span class="line"></span><br><span class="line"><span class="comment">% Unfold the returned theta back into U and W</span></span><br><span class="line">X = <span class="built_in">reshape</span>(theta(<span class="number">1</span>:num_movies*num_features), num_movies, num_features);</span><br><span class="line">Theta = <span class="built_in">reshape</span>(theta(num_movies*num_features+<span class="number">1</span>:<span class="keyword">end</span>), ...</span><br><span class="line">                num_users, num_features);</span><br><span class="line"></span><br><span class="line">fprintf(<span class="string">&#x27;Recommender system learning completed.\n&#x27;</span>);</span><br><span class="line"></span><br><span class="line">p = X * Theta&#x27;;</span><br><span class="line">my_predictions = p(:,<span class="number">1</span>) + Ymean;</span><br></pre></td></tr></table></figure><hr><p>EOF</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> AndrewNg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤§æ•°æ®æœºå™¨å­¦ä¹ </title>
      <link href="/2019/12/17/AndrewNgML/AndrewNg-MachineLearning-17-LargeScaleMachineLearning/"/>
      <url>/2019/12/17/AndrewNgML/AndrewNg-MachineLearning-17-LargeScaleMachineLearning/</url>
      
        <content type="html"><![CDATA[<h1 id="Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-17-Large-Scale-Machine-Learning"><a href="#Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-17-Large-Scale-Machine-Learning" class="headerlink" title="Notes of Andrew Ngâ€™s Machine Learning â€”â€” (17) Large Scale Machine Learning"></a>Notes of Andrew Ngâ€™s Machine Learning â€”â€” (17) Large Scale Machine Learning</h1><h2 id="Gradient-Descent-with-Large-Datasets"><a href="#Gradient-Descent-with-Large-Datasets" class="headerlink" title="Gradient Descent with Large Datasets"></a>Gradient Descent with Large Datasets</h2><h3 id="Learning-With-Large-Datasets"><a href="#Learning-With-Large-Datasets" class="headerlink" title="Learning With Large Datasets"></a>Learning With Large Datasets</h3><p>When learning with large datasets, it can be high cost to do a gradient descent. So before we actually use this large datasets (say, $m = 100,000,000$) for model training, weâ€™d better try to randomly pick a small part of data ($m=1,000$) from it and learning from it. If this subset works already satisfying, weâ€™ll no longer need to do a learning with large dataset.</p><p>Suppose you are facing a supervised learning problem and have a very large dataset (m = 100,000,000). How can you tell if using all of the data is likely to perform much better than using a small subset of the data (say m = 1,000)?</p><p>What er can do is plotting  a learning curve for a range of values of m and verify that the algorithm has high variance when m is small.</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1g9rn4jr6zxj30om07r0vl.jpg" alt="image-20191210150555045"></p><p>Facing a left-liked curve, maybe we use a large dataset can offer a better model. But if we get the curve like the right one, use a $m&gt;1000$ can not actually improve our model effectively.</p><h3 id="Stochastic-Gradient-Descent"><a href="#Stochastic-Gradient-Descent" class="headerlink" title="Stochastic Gradient Descent"></a>Stochastic Gradient Descent</h3><p>Before talking about the Stochastic Gradient Descent, letâ€™s take a look at the gradient descent we used (Actually, it is called <em>Batch Gradient Descent</em>), A linear regression for example:</p><blockquote><p>$J_{\textrm{train}}(\theta)=\frac{1}{2m}\sum_{i=1}^{m}(h_\theta(x^{(i)})-y^{(i)})^2$ </p><p>Repeat {</p><p>â€‹        $\quad \theta_j:=\theta_j-\alpha\frac{1}{m}\sum_{i=1}^{m}(h_\theta(x^{(i)})-y^{(i)})x_j^{(i)}$    (for every $j=0,\cdots,n$)</p><p>}</p></blockquote><p>With this Batch Gradient Descent, every step we take will need to calculate the sum of derivatives of all data. If our dataset is large, the time cost will be very expensive.</p><p>To deal with a large dataset, here is the <em>Stochastic Gradient Descent</em>:</p><p>$$<br>\begin{array}{l}<br>cost\left(\theta,(x^{(i)},y^{(i)})\right)=\frac{1}{2}(h_\theta(x^{(i)})-y^{(i)})^2\\<br>J_{train}(\theta)=\frac{1}{m}\sum_{i=1}^{m}cost\left(\theta,(x^{(i)},y^{(i)})\right)\\</p><p>1.\quad \textrm{Randomly shuffle(reorder) training examples}\<br>2.\quad \textrm{Repeat } { \<br>\qquad\qquad \textrm{for $i:= 1, \cdots,m$ } { \<br>\qquad\qquad\qquad\quad \theta_j:=\theta_j-\alpha(h_\theta(x^{(i)})-y^{(i)})x_j^{(i)} \quad \textrm{(for every $j=0,\cdots,n$)} \<br>\qquad\qquad\qquad\quad } \<br>\qquad\qquad } \<br>\end{array}<br>$$<br>Notice that, instead of calculate the sum of all derivatives and change the whole theta, in the inner for loop, each step we only care about the cost of one theta. When the training set size m is very large, stochastic gradient descent can be much faster than gradient descent.</p><p>Learning rate $\alpha$ is typically held constant. Can slowly decrease $\alpha$ over time if we want $\theta$ to converge better. (E.g. $\alpha=\frac{CONST_1}{iterationNumber+CONST_2}$)</p><h3 id="Mini-Batch-Gradient-Descent"><a href="#Mini-Batch-Gradient-Descent" class="headerlink" title="Mini-Batch Gradient Descent"></a>Mini-Batch Gradient Descent</h3><ul><li>Batch gradient descent: Use all $m$ examples in each iteration</li><li>Stochastic gradient descent: Use $1$ example in each iteration</li><li>Mini-batch gradient descent: Use $b$ examples in each iteration ($b\in[2, 100]$, Usual $10$)</li></ul><p>Mini-batch gradient descent sometimes faster than stochastic gradient descent:<br>$$<br>\begin{array}{l}<br>\textrm{Say $b=10,m=1000$.}\</p><p>\textrm{Repeat } { \<br>\qquad \textrm{for $i:= 1, 11, 21, 31, \cdots,991$ } { \<br>\qquad\qquad\quad \theta_j:=\theta_j-\alpha\frac{1}{10}\sum_{k=i}^{i+9}(h_\theta(x^{(i)})-y^{(i)})x_j^{(i)} \quad \textrm{(for every $j=0,\cdots,n$)} \<br>\qquad\qquad\quad } \<br>} \<br>\end{array}<br>$$</p><h3 id="Stochastic-Gradient-Descent-Convergence"><a href="#Stochastic-Gradient-Descent-Convergence" class="headerlink" title="Stochastic Gradient Descent Convergence"></a>Stochastic Gradient Descent Convergence</h3><h4 id="Checking-for-convergence"><a href="#Checking-for-convergence" class="headerlink" title="Checking for convergence"></a>Checking for convergence</h4><ul><li><p><strong>Batch gradient descent</strong>:</p><p>Plot $J_{train}(\theta)$ as a function of the number of iterations of gradient descent.</p><p>$J_{train}(\theta)=\frac{1}{2m}\sum_{i=1}^m(h_\theta(x^{(i)})-y^{(i)})^2$</p></li><li><p><strong>Stochastic gradient descent</strong>:</p><p>$cost(\theta,(x^{(i)},y^{(i)}))=\frac{1}{2}(h_\theta(x^{(i)})-y^{(i)})^2$</p><p>During learning, compute $cost(\theta,(x^{(i)},y^{(i)}))$ before updating $\theta$ using $(x^{(i)},y^{(i)})$.</p><p>Every 1000 iterations, plot $cost(\theta,(x^{(i)},y^{(i)}))$ averaged over the last 1000 examples processed by algorithm. (If we get a plot that is too noisy to see itâ€™s converging or not, try ploting for every 5000 (or summat bigger than 1000) iterations rather than 1000)</p></li></ul><h2 id="Advanced-Topics"><a href="#Advanced-Topics" class="headerlink" title="Advanced Topics"></a>Advanced Topics</h2><h3 id="Online-Learning"><a href="#Online-Learning" class="headerlink" title="Online Learning"></a>Online Learning</h3><p>An online learning algorithm allows us to learn from a continuous stream of data (have no fixed dataset),  since we use each example once then no longer need to process it again. Another advantage of online learning is also that if we have a changing pool of users, or if the things weâ€™re trying to predict are slowly changing, the online learning algorithm can slowly adapt our learned hypothesis to whatever the latest sets of user behaviors are like as well.</p><p>Here is an example:</p><blockquote><p>Shipping service website where user comes, specifies origin and destination, you offer to ship their package for some asking price, and users sometimes choose to use your shipping service ($y=1$), sometimes not ($y=0$).</p><p>Features $x$ capture properties of user, of origin/destination and asking price. We want to learn $p(y=1|x;\theta)$ to optimize price.</p></blockquote><p>Here is how an online learning version of logistic regression work for this problem:<br>$$<br>\begin{array}{l}<br>\textrm{Repeat forever } {\<br>\qquad \textrm{Get $(x,y)$ corresponding to user.}\<br>\qquad \textrm{Update $\theta$ using $(x,y)$:}\<br>\qquad \qquad \theta_j:=\theta_j-\alpha(h_\theta(x)-y)\cdot x_j (j=0,\cdots,n) \<br>}<br>\end{array}<br>$$</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9ywywm9hgj30yg0ih79d.jpg" alt="image-20191216220518514"></p><h3 id="Map-Reduce-and-Data-Parallelism"><a href="#Map-Reduce-and-Data-Parallelism" class="headerlink" title="Map Reduce and Data Parallelism"></a>Map Reduce and Data Parallelism</h3><p>We can divide up batch gradient descent and dispatch the cost function for a subset of the data to many different machines so that we can train our algorithm in parallel.</p><p>You can split your training set into z subsets corresponding to the number of machines you have. On each of those machines calculate $\displaystyle \sum_{i=p}^{q}(h_{\theta}(x^{(i)}) - y^{(i)}) \cdot x_j^{(i)}$, where weâ€™ve split the data starting at p and ending at q.</p><p>MapReduce will take all these dispatched (or â€˜mappedâ€™) jobs and â€˜reduceâ€™ them by calculating:</p><p>$\Theta_j := \Theta_j - \alpha \dfrac{1}{z}(temp_j^{(1)} + temp_j^{(2)} + \cdots + temp_j^{(z)})$</p><p>For all $j=0,â€¦,n$.</p><p>This is simply taking the computed cost from all the machines, calculating their average, multiplying by the learning rate, and updating theta.</p><p>Your learning algorithm is MapReduceable if it can be <em>expressed as computing sums of functions over the training set</em>. Linear regression and logistic regression are easily parallelizable.</p><p>For neural networks, you can compute forward propagation and back propagation on subsets of your data on many machines. Those machines can report their derivatives back to a â€˜masterâ€™ server that will combine them.</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> AndrewNg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ©ç”¨ C# è¯­è¨€å®ç°è·¨å¹³å°å°é—¹é’Ÿ</title>
      <link href="/2019/12/10/blog/CSharpAlarm/"/>
      <url>/2019/12/10/blog/CSharpAlarm/</url>
      
        <content type="html"><![CDATA[<h1 id="åˆ©ç”¨-C-è¯­è¨€å®ç°è·¨å¹³å°å°é—¹é’Ÿ"><a href="#åˆ©ç”¨-C-è¯­è¨€å®ç°è·¨å¹³å°å°é—¹é’Ÿ" class="headerlink" title="åˆ©ç”¨ C# è¯­è¨€å®ç°è·¨å¹³å°å°é—¹é’Ÿ"></a>åˆ©ç”¨ C# è¯­è¨€å®ç°è·¨å¹³å°å°é—¹é’Ÿ</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å­¦æ ¡çš„è¯¾ç¨‹è¦æ±‚åšä¸€ä¸ª C# å°é—¹é’Ÿç¨‹åºè®¾è®¡ï¼Œå…·ä½“è¦æ±‚å¦‚ä¸‹ï¼š</p><ol><li>åšä¸€ä¸ªå°é—¹é’Ÿçª—ä½“åº”ç”¨ç¨‹åºã€‚</li><li>å…·å¤‡å®æ—¶æ˜¾ç¤ºæ•°å­—æ—¶é’Ÿçš„åŠŸèƒ½ï¼Œæ–¹ä¾¿ä½¿ç”¨è€…è·å–å½“å‰çš„æ—¶é—´ã€‚</li><li>å…·å¤‡å®æ—¶ç»˜åˆ¶è¡¨ç›˜æ—¶é’Ÿçš„åŠŸèƒ½ï¼Œæ ¹æ®å½“å‰æ—¶é—´å†æ¥ç»˜åˆ¶ç§’é’ˆã€åˆ†é’ˆå’Œæ—¶é’ˆã€‚</li><li>å…·å¤‡æ•´ç‚¹æŠ¥æ—¶çš„åŠŸèƒ½ï¼Œå½“å¤„äºæ•´ç‚¹æ—¶ï¼Œç³»ç»Ÿè¿›è¡ŒæŠ¥æ—¶ã€‚</li><li>å…·å¤‡å®šç‚¹æŠ¥æ—¶çš„åŠŸèƒ½ï¼Œæ ¹æ®ä½¿ç”¨è€…çš„è®¾å®šï¼Œè¿›è¡ŒæŠ¥æ—¶ã€‚</li><li>æŠŠä½¿ç”¨è€…è®¾ç½®çš„æŠ¥æ—¶æ—¶é—´ï¼Œè®°å½•åœ¨æ–‡æœ¬æ–‡ä»¶ä¸­ï¼Œç³»ç»Ÿåœ¨å¯åŠ¨æ—¶ï¼Œè‡ªåŠ¨åŠ è½½è¯¥æ–‡æœ¬æ–‡ä»¶ä»¥ä¾¿è·å–å®šç‚¹æŠ¥æ—¶çš„æ—¶é—´ã€‚</li><li>ç³»ç»Ÿæœ€å°åŒ–æ—¶ï¼Œç¼©å°ä¸ºç³»ç»Ÿæ‰˜ç›˜ã€‚</li></ol><p>è¿™ä¸ªä¸œè¥¿ä¸éš¾ï¼Œå°±æ˜¯æœ€ç®€å•çš„ App å¼€å‘å˜›ï¼Œä½†è¦æ±‚ç”¨ C# åš Windows çª—ä½“å°±å¾ˆçƒ¦ã€‚ç”±äºæˆ‘ä¸ä½¿ç”¨ Windows ç³»ç»Ÿï¼Œæ‰€ä»¥æ‹¿åˆ°é¢˜ç›®ï¼Œé¦–å…ˆçš„æƒ³æ³•å°±æ˜¯<strong>è·¨å¹³å°</strong>ï¼Œæˆ‘å¸Œæœ›åœ¨ Mac ä¸Šå®Œæˆå¼€å‘ï¼Œç„¶åç›´æ¥æ‰“åŒ…å‘å¸ƒåˆ° Windows å¹³å°ã€‚</p><p>ä»¥å‰çœ‹è¿‡å¥½å‡ ä¸ªè·¨å¹³å°çš„å¼€æºçš„ UI å®ç°é¡¹ç›®éƒ½æ˜¯ C# å†™çš„ï¼Œæ¯”å¦‚ Pathos: Nethack Codex ç”¨çš„ Inventionã€‚ä½†å› ä¸ºæˆ‘ä¹‹å‰ç”šè‡³ä»æ²¡ç”¨è¿‡ C#ï¼Œæ‰€ä»¥å¯¹äºå®ƒä»¬å…·ä½“çš„å®ç°ä¸æ˜¯å¾ˆäº†è§£ã€‚ç»è¿‡ä¸€é˜µ Googleï¼Œæˆ‘æ‰¾åˆ°äº† Microsoft è‡ªå®¶åšçš„è·¨å¹³å°æ–¹æ¡ˆâ€”â€”Xamarinã€‚</p><p>emmmmï¼ŒXamarin è¿˜åˆ†å¥½å‡ ä¸ªéƒ¨åˆ†ï¼ŒXamarin.Formsï¼ŒXamarin.Mac ä»€ä¹ˆçš„ã€‚å…¶ä¸­ï¼ŒXamarin.Forms å¯ä»¥ä¸€å¥— UI ä»£ç ç”Ÿæˆ Androidã€iOSã€UWP(æ”¯æŒä¸å®Œæ•´ï¼Œè¿˜æ˜¯é¢„è§ˆç‰ˆ)ã€‚è¿™ä¸ªæ¡†æ¶ä¸‹ Androidã€iOS å¯ä»¥åœ¨ Mac ä¸Šç”¨ Visual Studio for Mac æ¥å¼€å‘å¹¶ä¸”ç”Ÿæˆï¼ŒUWP åªèƒ½åœ¨ Windows ä¸‹ç”Ÿæˆã€‚</p><p>è¿™ä¸ªä¸œè¥¿æ„Ÿè§‰è¿˜ä¸é”™ï¼Œçœ‹æ–‡æ¡£é‡Œç”Ÿæˆå‡ºæ¥çš„ UI æ•ˆæœæŒºå¥½çœ‹çš„ï¼Œä»£ç ä¹Ÿæ¯”è¾ƒç®€å•ï¼ˆç›¸è¾ƒäºåŸç”Ÿ Android å¼€å‘ï¼‰ï¼Œæ‰€ä»¥æˆ‘å†³å®šç”¨è¿™ä¸ª Xamarin.Forms å…ˆåœ¨ Mac ä¸‹å®Œæˆè¿™ä¸ªå°é—¹é’Ÿçš„å¼€å‘ï¼Œç„¶åå€Ÿä¸€å° Windows ç”µè„‘æ¥ç”Ÿæˆ UWPã€‚</p><p>å†³å®šäº†æ¡†æ¶ï¼Œç„¶åå°±æ˜¯ C# åŸºç¡€è¯­æ³•å’Œ Xamarin.Forms çš„å­¦ä¹ äº†ã€‚è¿™ä¸¤ä¸ªä¸œè¥¿å¾®è½¯éƒ½æœ‰è¯¦ç»†çš„ã€é’ˆå¯¹å„ç§ä¸åŒæŠ€æœ¯æ°´å¹³çš„å¼€å‘è€…çš„å…¥é—¨æ•™ç¨‹ï¼Œé¡ºç€çœ‹ä¸€éï¼ŒæŠŠä¾‹å­å†™ä¸€ä¸‹ä¹Ÿå°±è¶³å¤Ÿå®Œæˆè¿™æ¬¡çš„å°é—¹é’Ÿä»»åŠ¡äº†ã€‚</p><p>æ¥ä¸‹æ¥å°±è¿›å…¥è·¨å¹³å°å°é—¹é’Ÿå¼€å‘çš„è¿‡ç¨‹äº†ã€‚</p><h2 id="è®¾è®¡"><a href="#è®¾è®¡" class="headerlink" title="è®¾è®¡"></a>è®¾è®¡</h2><p>æˆ‘ä»¬é¦–å…ˆæ€è€ƒæˆ‘ä»¬æœŸæœ›çš„ App ä½¿ç”¨åœºæ™¯ï¼šç”¨æˆ·ç‚¹å‡»æ‰“å¼€ Appï¼Œå±å¹•ä¸Šæ˜¾ç¤ºå‡ºä¸€ä¸ªåœ†ç›˜æ—¶é’Ÿï¼Œç„¶åï¼Œå¯ä»¥ä»å¯¼èˆªæ¡ï¼ˆiOS çš„ä¹ æƒ¯æ˜¯åº•éƒ¨ï¼ŒAndroid å’Œ UWP ä¸ºé¡¶éƒ¨ï¼‰åˆ‡æ¢åˆ°ä¸€ä¸ªç°å®è¿™é—¹é’Ÿæ¡ç›®åˆ°ç•Œé¢ï¼Œç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œç‚¹å¼€ä¸€æ¡é—¹é’Ÿæ¡ç›®è¿›è¡Œç¼–è¾‘ï¼Œæˆ–ç€æ·»åŠ æ–°çš„é—¹é’Ÿæ¡ç›®ã€‚</p><p>iOS è‡ªå¸¦çš„ â€œæ—¶é’Ÿâ€ App ç»™äº†æˆ‘ä»¬å¾ˆå¥½çš„å‚è€ƒï¼ˆç”±äºå®ƒæ²¡æœ‰åœ†ç›˜æ—¶é’ŸåŠŸèƒ½ï¼Œæˆ‘æˆªäº†ä¸€å¼ â€œå°±å¯â€ç•Œé¢æ›¿ä»£ğŸ˜“ï¼‰ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9qnn9cnd8j31d50u0qft.jpg" alt="IMG_1573"></p><p>åœ¨æˆ‘ä»¬çš„è®¾è®¡ä¸­ï¼Œå°é—¹é’Ÿ App å¯ä»¥åˆ†ä¸ºè¿™æ ·å‡ ä¸ªé¡µé¢ï¼š</p><ul><li>ğŸ•¤æ—¶é’Ÿé¡µï¼šæ˜¾ç¤ºä¸€ä¸ªåœ†ç›˜æ—¶é’Ÿï¼Œå±•ç¤ºå½“å‰æ—¶é—´ï¼›</li><li>â°é—¹é’Ÿé¡µï¼šæ˜¾ç¤ºå½“å‰è®¾å®šçš„æ‰€æœ‰é—¹é’Ÿæ¡ç›®ï¼Œå¯ä»¥ç‚¹å¼€ç¼–è¾‘ã€æ–°å»ºé—¹é’Ÿæ¡ç›®ï¼›</li><li>ğŸ§¾è¯¦æƒ…é¡µï¼šæ–°å»ºã€ç¼–è¾‘ä¸€æ¡é—¹é’Ÿçš„æ—¶é—´ã€æ³¨é‡Šçš„é¡µé¢ï¼Œå¹¶æœ‰ä¿å­˜ã€åˆ é™¤çš„åŠŸèƒ½ã€‚</li></ul><p>å…·ä½“åˆ° Xamarin.Forms ä¸­ï¼Œè¿™äº› Pages å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9qes7ga8nj30ea0ehmxj.jpg" alt="MyClockPagesDiagram"></p><p>ç„¶åï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®¾è®¡å¦å¤–ä¸€ä¸ªé‡è¦çš„éƒ¨åˆ†ï¼Œä¸€æ¡â€œé—¹é’Ÿâ€çš„è¡¨ç¤ºå’Œå‚¨å­˜ã€‚</p><p>å¯ä»¥è€ƒè™‘ç”¨ä¸€ä¸ª <code>AlarmItem</code> ç±»æ¥ä»£è¡¨ä¸€æ¡é—¹é’Ÿï¼Œè¿™ä¸ªç±»è¦å…·æœ‰ å”¯ä¸€IDã€æ—¶é—´ã€æ˜¯å¦æ‰“å¼€ã€æ³¨é‡Š è¿™å‡ ä¸ªå±æ€§ã€‚</p><p>åœ¨ Xamarin ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¼•å…¥ SQLite å‚¨å­˜è¿™ä¸ªå¯¹è±¡ï¼Œåªéœ€è¦å†™ä¸€ä¸ª <code>Database</code> ç±»ï¼Œç®€å•å°è£…ä¸€ä¸‹ CRUDï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨ã€‚</p><p>æ¥ä¸‹æ¥å°±è¦å¼€å§‹ä»£ç å®ç°äº†ï¼Œå…ˆè´´å‡ºæœ€åæˆå“æˆªå›¾ï¼ŒiOSä¸Šçš„æ•ˆæœï¼š</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9qtdimzaxj31f20u0wop.jpg" alt="IMG_1576"></p><p>UWP çš„æ•ˆæœï¼š</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9vdl50y0qj312o0u0gqs.jpg" alt="IMG_1600"></p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>æ•´ä¸ª App çš„åŸºç¡€å¤§æ¦‚æœ‰äº†ï¼Œç°åœ¨è€ƒè™‘ä¸€äº›å®ç°çš„ç»†èŠ‚ã€‚</p><p>ï¼ˆåœ¨è¿™é‡Œæˆ‘åªåˆ—å‡ºå…³é”®çš„æˆ–è€…ä»»ä½•æˆ‘è®¤ä¸ºæœ‰æ„æ€çš„ä»£ç ç‰‡æ®µï¼Œå®Œæ•´ä»£ç è§ <a href="https://github.com/cdfmlr/MyClock">GitHub</a>ï¼‰</p><h3 id="åœ†ç›˜æ—¶é’Ÿçš„å®ç°"><a href="#åœ†ç›˜æ—¶é’Ÿçš„å®ç°" class="headerlink" title="åœ†ç›˜æ—¶é’Ÿçš„å®ç°"></a>åœ†ç›˜æ—¶é’Ÿçš„å®ç°</h3><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9qey1safbj305b05bmx7.jpg" alt="å±å¹•å¿«ç…§ 2019-12-09 13.36.51"></p><p>ç»˜åˆ¶ä¸€ä¸ªå¦‚ä¸Šå›¾æ‰€ç¤ºçš„åœ†ç›˜æ—¶é’Ÿï¼Œéœ€è¦å®æ—¶çš„çŸ¢é‡å›¾ç»˜åˆ¶ã€‚Xamarin.Forms ä¸å…·æœ‰å†…ç½®çš„çŸ¢é‡å›¾å½¢ç³»ç»Ÿï¼Œä½†æœ‰ä¸€ä¸ª BoxView å¯å¸®åŠ©è¿›è¡Œè¡¥å¿ã€‚<a href="https://docs.microsoft.com/zh-cn/dotnet/api/xamarin.forms.boxview">BoxView</a>  å‘ˆç°æŒ‡å®šçš„å®½åº¦ã€ é«˜åº¦å’Œé¢œè‰²çš„ä¸€ä¸ªç®€å•çš„çŸ©å½¢ã€‚å‚ç…§å¾®è½¯çš„æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ä¸‹é¢çš„æ€è·¯å®ç°ä¸€ä¸ªæ—¶é’Ÿï¼š</p><h4 id="è¡¨ç›˜"><a href="#è¡¨ç›˜" class="headerlink" title="è¡¨ç›˜"></a>è¡¨ç›˜</h4><p>å¯¹äºè¡¨ç›˜ï¼Œé€šè¿‡ç®€å•çš„æ•°å­¦è®¡ç®—ï¼Œå°±å¯ä»¥å¾—åˆ°ä»12ç‚¹å¼€å§‹çš„è¡¨ç›˜ä¸Š 60 ä¸ªå‡åŒ€åˆ†å¸ƒçš„åˆ»åº¦ç‚¹çš„ä½ç½®åæ ‡ã€‚åœ¨ä¸€ä¸ªå¯ä»¥æŒ‡å®šä½ç½®çš„ AbsoluteLayout ä¸­ã€‚</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create the tick marks</span></span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; tickMarks.Length; i++)</span><br><span class="line">&#123;</span><br><span class="line">tickMarks[i] = <span class="keyword">new</span> BoxView &#123; Color = Color.Black &#125;;</span><br><span class="line">absoluteLayout.Children.Add(tickMarks[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æˆ‘ä»¬ç”Ÿæˆäº† 60 ä¸ªå¤§å°ç›¸åŒçš„æ­£æ–¹å½¢ BoxViewï¼Œç°å°†æ¨¡5çš„ç‚¹ç¨å¾®åŠ å¤§ï¼Œç„¶åæŠŠå®ƒä»¬æ”¾ç½®åˆ°æŒ‡å®šçš„ä½ç½®ï¼Œé’ˆå¯¹ä¸åŒä½ç½®çš„æ­£æ–¹å½¢åšä¸€ä¸ªä½¿å…¶æ­£å¯¹ä¸­å¿ƒçš„æ—‹è½¬ï¼Œè¡¨ç›˜å°±å®Œæˆäº†ã€‚</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Size and position a tickMark</span></span><br><span class="line"><span class="built_in">double</span> size = radius / (index % <span class="number">5</span> == <span class="number">0</span> ? <span class="number">15</span> : <span class="number">30</span>);</span><br><span class="line"><span class="built_in">double</span> radians = index * <span class="number">2</span> * Math.PI / tickMarks.Length;</span><br><span class="line"><span class="built_in">double</span> x = center.X + radius * Math.Sin(radians) - size / <span class="number">2</span>;</span><br><span class="line"><span class="built_in">double</span> y = center.Y - radius * Math.Cos(radians) - size / <span class="number">2</span>;</span><br><span class="line">AbsoluteLayout.SetLayoutBounds(tickMarks[index], <span class="keyword">new</span> Rectangle(x, y, size, size));</span><br><span class="line">tickMarks[index].Rotation = <span class="number">180</span> * radians / Math.PI;</span><br></pre></td></tr></table></figure><h4 id="æŒ‡é’ˆ"><a href="#æŒ‡é’ˆ" class="headerlink" title="æŒ‡é’ˆ"></a>æŒ‡é’ˆ</h4><p>æ¥ä¸‹æ¥æ˜¯æŒ‡é’ˆï¼Œå…ˆåœ¨ä¹‹å‰çš„ AbsoluteLayout ä¸­å®ä¾‹åŒ–ä¸‰ä¸ªä»£è¡¨æ—¶åˆ†ç§’é’ˆçš„ BoxViewï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">AbsoluteLayout</span> <span class="attr">x:Name</span>=<span class="string">&quot;absoluteLayout&quot;</span> <span class="attr">SizeChanged</span>=<span class="string">&quot;OnAbsoluteLayoutSizeChanged&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">BoxView</span> <span class="attr">x:Name</span>=<span class="string">&quot;hourHand&quot;</span> <span class="attr">Color</span>=<span class="string">&quot;Black&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">BoxView</span> <span class="attr">x:Name</span>=<span class="string">&quot;minuteHand&quot;</span> <span class="attr">Color</span>=<span class="string">&quot;Black&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">BoxView</span> <span class="attr">x:Name</span>=<span class="string">&quot;secondHand&quot;</span> <span class="attr">Color</span>=<span class="string">&quot;Black&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">AbsoluteLayout</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å†™ä¸€ä¸ª <code>HandParams</code> æ¥æŒ‡å®šä¸‰ä¸ªæ—¶é’ˆçš„å½¢çŠ¶ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> HandParams</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HandParams</span>(<span class="params"><span class="built_in">double</span> width, <span class="built_in">double</span> height, <span class="built_in">double</span> offset</span>) : <span class="title">this</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Width = width;</span><br><span class="line">        Height = height;</span><br><span class="line">        Offset = offset;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">double</span> Width &#123; <span class="keyword">private</span> <span class="keyword">set</span>; <span class="keyword">get</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">double</span> Height &#123; <span class="keyword">private</span> <span class="keyword">set</span>; <span class="keyword">get</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">double</span> Offset &#123; <span class="keyword">private</span> <span class="keyword">set</span>; <span class="keyword">get</span>; &#125;<span class="comment">// æ—‹è½¬ä¸­å¿ƒ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">readonly</span> HandParams secondParams = <span class="keyword">new</span> HandParams(<span class="number">0.02</span>, <span class="number">1.1</span>, <span class="number">0.85</span>);</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">readonly</span> HandParams minuteParams = <span class="keyword">new</span> HandParams(<span class="number">0.05</span>, <span class="number">0.8</span>, <span class="number">0.9</span>);</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">readonly</span> HandParams hourParams = <span class="keyword">new</span> HandParams(<span class="number">0.125</span>, <span class="number">0.65</span>, <span class="number">0.9</span>);</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œå†™ä¸€ä¸ª <code>LayoutHand</code> æ¥æŠŠæŒ‡é’ˆæ”¾åˆ°åˆé€‚çš„åœ°æ–¹ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LayoutHand</span>(<span class="params">BoxView boxView, HandParams handParams, Point center, <span class="built_in">double</span> radius</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">double</span> width = handParams.Width * radius;</span><br><span class="line">    <span class="built_in">double</span> height = handParams.Height * radius;</span><br><span class="line">    <span class="built_in">double</span> offset = handParams.Offset;</span><br><span class="line"></span><br><span class="line">    AbsoluteLayout.SetLayoutBounds(boxView,</span><br><span class="line">                                   <span class="keyword">new</span> Rectangle(center.X - <span class="number">0.5</span> * width,</span><br><span class="line">                                                 center.Y - offset * height,</span><br><span class="line">                                                 width, height));</span><br><span class="line">    boxView.AnchorY = handParams.Offset;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LayoutHand(secondHand, secondParams, center, radius);</span><br><span class="line">LayoutHand(minuteHand, minuteParams, center, radius);</span><br><span class="line">LayoutHand(hourHand, hourParams, center, radius);</span><br></pre></td></tr></table></figure><p>åœ¨æ—¶é—´æµåŠ¨æ—¶ï¼Œæ—‹è½¬æŒ‡é’ˆï¼Œä¸ºäº†è¥é€ ä¸€ç§çœŸå®çš„æ„Ÿè§‰ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªåŠ¨ç”»æ•ˆæœè®©ç§’é’Ÿçš„ç§»åŠ¨æœ‰çœŸå®çš„æ‘†åŠ¨æ„Ÿï¼Œä½†è¿™ä¸ªåŠ¨ç”»éœ€è¦æˆ‘ä»¬ Timer Tick çš„é¢‘ç‡é«˜ä¸€ç‚¹ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ClockPage</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    InitializeComponent();</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    Device.StartTimer(TimeSpan.FromSeconds(<span class="number">1.0</span> / <span class="number">60</span>), OnTimerTick);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">bool</span> <span class="title">OnTimerTick</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    DateTime dateTime = DateTime.Now;</span><br><span class="line">    hourHand.Rotation = <span class="number">30</span> * (dateTime.Hour % <span class="number">12</span>) + <span class="number">0.5</span> * dateTime.Minute;</span><br><span class="line">    minuteHand.Rotation = <span class="number">6</span> * dateTime.Minute + <span class="number">0.1</span> * dateTime.Second;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">double</span> t = dateTime.Millisecond / <span class="number">1000.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (t &lt; <span class="number">0.5</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        t = <span class="number">0.5</span> * Easing.SpringIn.Ease(t / <span class="number">0.5</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        t = <span class="number">0.5</span> * (<span class="number">1</span> + Easing.SpringOut.Ease((t - <span class="number">0.5</span>) / <span class="number">0.5</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    secondHand.Rotation = <span class="number">6</span> * (dateTime.Second + t);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œä¸€ä¸ªåœ†ç›˜æ—¶é’Ÿå°±å®Œæˆäº†ã€‚</p><h3 id="é—¹é’ŸåŠŸèƒ½å®ç°"><a href="#é—¹é’ŸåŠŸèƒ½å®ç°" class="headerlink" title="é—¹é’ŸåŠŸèƒ½å®ç°"></a>é—¹é’ŸåŠŸèƒ½å®ç°</h3><h4 id="é—¹é’Ÿã€æ•°æ®åº“æ¨¡å—"><a href="#é—¹é’Ÿã€æ•°æ®åº“æ¨¡å—" class="headerlink" title="é—¹é’Ÿã€æ•°æ®åº“æ¨¡å—"></a>é—¹é’Ÿã€æ•°æ®åº“æ¨¡å—</h4><p>æˆ‘ä»¬å°†ä½¿ç”¨ <code>SQLite.NET</code> å°†æ•°æ®åº“æ“ä½œåˆå¹¶åˆ°åº”ç”¨ç¨‹åºã€‚</p><p>é¦–å…ˆè¦åšçš„æ˜¯ä½¿ç”¨ Visual Studio ä¸­çš„ NuGet åŒ…ç®¡ç†å™¨å°† NuGet åŒ…æ·»åŠ åˆ°é¡¹ç›®ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦æ·»åŠ çš„åŒ…å«åš <code>sqlite-net-pcl</code> ï¼ˆè¯¦ç»†æ“ä½œå‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.microsoft.com/zh-cn/xamarin/get-started/quickstarts/database">å°†æ•°æ®å­˜å‚¨åœ¨æœ¬åœ° SQLite.NET æ•°æ®åº“ä¸­</a>ï¼‰ï¼Œæ·»åŠ å®Œæˆåæˆ‘ä»¬å°±å¯ä»¥å°†æ•°æ®å­˜å‚¨åœ¨æœ¬åœ° SQLite.NET æ•°æ®åº“ä¸­äº†ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å®ç°è®¾è®¡ä¸­æåˆ°çš„ <code>AlamItem</code> ç±»æ¥è¡¨ç¤ºä¸€æ¡é—¹é’Ÿï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> SQLite;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">MyClock</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AlarmItem</span></span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">PrimaryKey, AutoIncrement</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> ID &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> TimeSpan Time &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">bool</span> Work &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Note &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> <span class="title">ToString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> Time.ToString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨äº† <code>PrimaryKey</code> å’Œ <code>AutoIncrement</code> ç‰¹æ€§æ ‡è®° <code>ID</code> å±æ€§ï¼Œä»¥ç¡®ä¿ SQLite.NET æ•°æ®åº“ä¸­çš„æ¯ä¸ª <code>AlarmItem</code> å®ä¾‹éƒ½å…·æœ‰ SQLite.NET æä¾›çš„å”¯ä¸€ idã€‚</p><p>ç„¶åï¼Œåˆ›å»ºä¸€ä¸ª <code>Database</code> ç±»ï¼ŒåŒ…å«ç”¨äºåˆ›å»ºæ•°æ®åº“ã€ä»ä¸­è¯»å–æ•°æ®ã€å‘å…¶ä¸­å†™å…¥æ•°æ®ä»¥åŠä»ä¸­åˆ é™¤æ•°æ®çš„ä»£ç ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> SQLite;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">MyClock</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Database</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">readonly</span> SQLiteAsyncConnection _database;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Database</span>(<span class="params"><span class="built_in">string</span> dbPath</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            _database = <span class="keyword">new</span> SQLiteAsyncConnection(dbPath);</span><br><span class="line">            _database.CreateTableAsync&lt;AlarmItem&gt;().Wait();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Task&lt;List&lt;AlarmItem&gt;&gt; GetAllAlarmItemsAsync()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> _database.Table&lt;AlarmItem&gt;().ToListAsync();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">int</span>&gt; <span class="title">SaveAlarmItemAsync</span>(<span class="params">AlarmItem alarmItem</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (alarmItem.ID != <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> _database.UpdateAsync(alarmItem);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> _database.InsertAsync(alarmItem);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">int</span>&gt; <span class="title">DeleteAlarmItemAsync</span>(<span class="params">AlarmItem alarmItem</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> _database.DeleteAsync(alarmItem);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä½¿ç”¨çš„å…¨æ˜¯å°†æ•°æ®åº“æ“ä½œç§»åŠ¨åˆ°åå°çº¿ç¨‹çš„å¼‚æ­¥ SQLite.NET APIã€‚ æ­¤å¤–ï¼Œ<code>Database</code>æ„é€ å‡½æ•°å°†æ•°æ®åº“æ–‡ä»¶çš„è·¯å¾„ä½œä¸ºå‚æ•°ã€‚</p><h4 id="é—¹é’Ÿç›¸å…³çš„é¡µé¢"><a href="#é—¹é’Ÿç›¸å…³çš„é¡µé¢" class="headerlink" title="é—¹é’Ÿç›¸å…³çš„é¡µé¢"></a>é—¹é’Ÿç›¸å…³çš„é¡µé¢</h4><p>æ¥ä¸‹æ¥æˆ‘ä»¬è€ƒè™‘å…ˆæŠŠå’Œé—¹é’Ÿçš„CRUDç›¸å…³çš„ <code>AlarmPage</code> å’Œ <code>AlarmEditPage</code> é¡µé¢å®ç°ã€‚</p><p>é¦–å…ˆæ˜¯ <code>AlarmPage</code>ï¼Œè¿™ä¸ªç•Œé¢å°†ç½—åˆ—æ‰€æœ‰çš„å·²æœ‰é—¹é’Ÿæ¡ç›®ï¼Œå¹¶ä¸”å¯ä»¥æ·»åŠ æ–°çš„æ¡ç›®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ContentPage</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xamarin.com/schemas/2014/forms&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">xmlns:x</span>=<span class="string">&quot;http://schemas.microsoft.com/winfx/2009/xaml&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">x:Class</span>=<span class="string">&quot;MyClock.AlarmPage&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">Title</span>=<span class="string">&quot;é—¹é’Ÿ&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ContentPage.ToolbarItems</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ToolbarItem</span> <span class="attr">Text</span>=<span class="string">&quot;+&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">IconImageSource</span>=<span class="string">&quot;add.png&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">Clicked</span>=<span class="string">&quot;OnAlarmItemAddClicked&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ContentPage.ToolbarItems</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">StackLayout</span> <span class="attr">Margin</span>=<span class="string">&quot;20&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ListView</span> <span class="attr">x:Name</span>=<span class="string">&quot;alarmListView&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">ItemSelected</span>=<span class="string">&quot;OnAlarmItemSelected&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ListView.ItemTemplate</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">DataTemplate</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">TextCell</span> <span class="attr">Text</span>=<span class="string">&quot;&#123;Binding TimeString&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                          <span class="attr">Detail</span>=<span class="string">&quot;&#123;Binding Note&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">DataTemplate</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ListView.ItemTemplate</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ListView</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">Text</span>=<span class="string">&quot;æ·»åŠ &quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">Clicked</span>=<span class="string">&quot;OnAlarmItemAddClicked&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">StackLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">ContentPage</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘åœ¨æ ‡é¢˜æ é‡Œå†™äº†ä¸€ä¸ªæ·»åŠ æ–°æ¡ç›®çš„ â€œ<code>+</code>â€ æŒ‰é’®ï¼Œä½†ç”±äºè°ƒè¯•ä¸­å‘ç°ï¼Œå®ƒè™½ç„¶åœ¨ Androidã€iOS ä¸­éƒ½èƒ½å¾ˆå¥½çš„å‘ˆç°ï¼Œä½†åœ¨ UWP é‡Œä¸å¯è§ï¼ˆè™½ç„¶æŠŠé¼ æ ‡ç§»åˆ°é‚£é‡Œç¨å¾®ç§»åŠ¨å±å¹•åå¯ä»¥çœ‹åˆ°ä¹Ÿå¯ä»¥ç‚¹å‡»åˆ°å®ƒï¼‰ï¼Œç”¨æˆ·ä½“éªŒå¾ˆå·®ï¼Œæ‰€ä»¥å°±åœ¨ ListView ä¸‹é¢åŠ äº†ä¸€ä¸ªå¾ˆæ˜¾çœ¼ã€ä¹Ÿå‡ ä¹ä¸å¯èƒ½å‡ºæ„å¤–çš„ â€œ<code>æ·»åŠ </code>â€ Buttonã€‚</p><p>å½“ç”¨æˆ·ç‚¹å‡» ListView é‡Œçš„é—¹é’Ÿæ¡ç›® æˆ–è€… æ·»åŠ æ–°æ¡ç›® æ—¶ï¼Œå°†è½¬åˆ° <code>AlarmEditPage</code> å®Œæˆé—¹é’Ÿæ¡ç›®çš„æŸ¥çœ‹ã€ç¼–è¾‘ã€ä¿å­˜æˆ–åˆ é™¤ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">async</span> <span class="keyword">void</span> <span class="title">OnAlarmItemAddClicked</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">await</span> Navigation.PushAsync(<span class="keyword">new</span> AlarmEditPage</span><br><span class="line">&#123;</span><br><span class="line">BindingContext = <span class="keyword">new</span> AlarmItem()</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">async</span> <span class="keyword">void</span> <span class="title">OnAlarmItemSelected</span>(<span class="params"><span class="built_in">object</span> sender, SelectedItemChangedEventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (e.SelectedItem != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> Navigation.PushAsync(<span class="keyword">new</span> AlarmEditPage</span><br><span class="line">&#123;</span><br><span class="line">BindingContext = e.SelectedItem <span class="keyword">as</span> AlarmItem</span><br><span class="line">&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>AlarmEditPage</code> çš„ç•Œé¢è®¾è®¡å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ContentPage</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xamarin.com/schemas/2014/forms&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">xmlns:x</span>=<span class="string">&quot;http://schemas.microsoft.com/winfx/2009/xaml&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">x:Class</span>=<span class="string">&quot;MyClock.AlarmEditPage&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">Title</span>=<span class="string">&quot;è®¾ç½®é—¹é’Ÿ&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">StackLayout</span> <span class="attr">Margin</span>=<span class="string">&quot;20, 35, 20, 20&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Label</span> <span class="attr">Text</span>=<span class="string">&quot;æ—¶é—´:&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TimePicker</span> <span class="attr">Time</span>=<span class="string">&quot;&#123;Binding Time&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">Format</span>=<span class="string">&quot;T&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">StackLayout</span> <span class="attr">Orientation</span>=<span class="string">&quot;Vertical&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Label</span> <span class="attr">Text</span>=<span class="string">&quot;å¯ç”¨:&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Switch</span> <span class="attr">HorizontalOptions</span>=<span class="string">&quot;StartAndExpand&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">IsToggled</span>=<span class="string">&quot;&#123;Binding Work&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">StackLayout</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Label</span> <span class="attr">Text</span>=<span class="string">&quot;æ³¨é‡Š:&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Editor</span> <span class="attr">Placeholder</span>=<span class="string">&quot;è¾“å…¥æ³¨é‡Š&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">Text</span>=<span class="string">&quot;&#123;Binding Note&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">MaxLength</span>=<span class="string">&quot;300&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">HeightRequest</span>=<span class="string">&quot;100&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Grid</span> <span class="attr">Margin</span>=<span class="string">&quot;10&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Grid.ColumnDefinitions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ColumnDefinition</span> <span class="attr">Width</span>=<span class="string">&quot;*&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ColumnDefinition</span> <span class="attr">Width</span>=<span class="string">&quot;*&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Grid.ColumnDefinitions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span> <span class="attr">Text</span>=<span class="string">&quot;ä¿å­˜&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">Clicked</span>=<span class="string">&quot;OnSaveButtonClicked&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span> <span class="attr">Grid.Column</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">Text</span>=<span class="string">&quot;åˆ é™¤&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">Clicked</span>=<span class="string">&quot;OnDeleteButtonClicked&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Grid</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">StackLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ContentPage</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="é—¹é’Ÿæ¡ç›®çš„CRUD"><a href="#é—¹é’Ÿæ¡ç›®çš„CRUD" class="headerlink" title="é—¹é’Ÿæ¡ç›®çš„CRUD"></a>é—¹é’Ÿæ¡ç›®çš„CRUD</h4><p>å› ä¸ºæˆ‘ä»¬å°†åœ¨æ•´ä¸ªç¨‹åºçš„ä¸åŒéƒ¨åˆ†é€šç”¨æˆ‘ä»¬å°è£…çš„ <code>Database</code> è¿™ä¸ªæ•°æ®åº“ï¼Œæ‰€ä»¥åœ¨ <code>App.xaml.cs</code> ä¸­å°†å…¶å®ä¾‹åŒ–ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">App</span> : <span class="title">Application</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Database database;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Database Database</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (database == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                database = <span class="keyword">new</span> Database(Path.Combine(Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData), <span class="string">&quot;alarm.db3&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> database;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥åœ¨å„å¤„è°ƒç”¨äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†æ•°æ®ä¸ç•Œé¢è”ç³»èµ·æ¥ã€‚</p><p>åœ¨ <code>AlarmPage</code> çš„ <code>OnAppearing</code> ä¸­ï¼Œæˆ‘ä»¬å°†å†™è¿™æ ·çš„ä¸€è¡Œä»£ç ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alarmListView.ItemsSource = <span class="keyword">await</span> App.Database.GetAllAlarmItemsAsync();</span><br></pre></td></tr></table></figure><p>è¿™è¡Œä»£ç å°†ä¼šæŠŠæ•°æ®åº“ä¸­å‚¨å­˜çš„æ‰€æœ‰é—¹é’Ÿæ¡ç›®è¯»å–å‡ºæ¥ï¼ŒåŠ è½½åˆ°ç•Œé¢ä¸Šçš„ ListView é‡Œã€‚</p><p>ç„¶åï¼Œåœ¨ <code>AlarmEditPage</code> ä¸­å®Œæˆ ä¿å­˜ã€åˆ é™¤ ä¸¤ä¸ªæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶å¤„ç†ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">async</span> <span class="keyword">void</span> <span class="title">OnSaveButtonClicked</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> alarmItem = (AlarmItem)BindingContext;</span><br><span class="line">    <span class="keyword">await</span> App.Database.SaveAlarmItemAsync(alarmItem);</span><br><span class="line">    <span class="keyword">await</span> Navigation.PopAsync();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">async</span> <span class="keyword">void</span> <span class="title">OnDeleteButtonClicked</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> alarmItem = (AlarmItem)BindingContext;</span><br><span class="line">    <span class="keyword">await</span> App.Database.DeleteAlarmItemAsync(alarmItem);</span><br><span class="line">    <span class="keyword">await</span> Navigation.PopAsync();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å–å‡ºé¡µé¢é‡Œæ˜¾ç¤ºçš„æ¡ç›®åï¼Œè°ƒç”¨æ•°æ®åº“ä¸­ä¿å­˜/åˆ é™¤å®ƒï¼Œç„¶åé€€å‡ºåˆ° <code>AlarmPage</code>ã€‚</p><h4 id="é—¹é’Ÿæé†’"><a href="#é—¹é’Ÿæé†’" class="headerlink" title="é—¹é’Ÿæé†’"></a>é—¹é’Ÿæé†’</h4><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥æ–°å»ºã€ä¿å­˜ã€ç¼–è¾‘ã€åˆ é™¤é—¹é’Ÿæ¡ç›®äº†ï¼Œä½†è¿™äº›è¿˜éƒ½æ˜¯æ•°æ®ä¸Šçš„æ“ä½œï¼Œæ¥ä¸‹æ¥å®ç°é—¹é’Ÿçš„æé†’åŠŸèƒ½ã€‚</p><p>é—¹é’Ÿéœ€è¦åœ¨æŒ‡å®šçš„æ—¶é—´å“èµ·ä»¥æé†’ç”¨æˆ·ï¼Œæˆ‘ä»¬å¯ä»¥è¦ä¸ºæ¯ä¸€ä¸ªé—¹é’Ÿæ¡ç›®è°ƒç”¨ç³»ç»Ÿçº§çš„å®šæ—¶äº‹ä»¶ï¼ˆæ¨¡ä»¿ç³»ç»Ÿè‡ªå¸¦çš„é—¹é’ŸåŠŸèƒ½ï¼‰ï¼Œè¿™ä¸ªæ–¹æ³•æ„Ÿè§‰å¾ˆç‰›çš®ï¼Œä½†åœ¨ä»£ç å®ç°ã€å°¤å…¶æ˜¯è·¨å¹³å°å®ç°ä¸Šéº»çƒ¦ï¼Œæˆ‘ä¸ç¡®å®šï¼ˆæ²¡æœ‰å°è¯•ï¼‰è¿™æ ·çš„æ“ä½œæ˜¯å¦å¯ä»¥æ˜¾è‘—æå‡ç¨‹åºæ€§èƒ½ï¼Œæˆ‘ä»¬åªæ˜¯åšä¸ªç®€å•çš„å°é—¹é’Ÿä½œä¸šï¼Œæ²¡æœ‰å¿…è¦å¦‚æ­¤ã€‚æ‰€ä»¥æˆ‘é‡‡ç”¨äº†æœ€ç®€å•ç›´è§‚çš„æ–¹æ³•â€”â€”æ¯éš”ä¸€æ®µæ—¶é—´æ£€æµ‹ä¸€æ¬¡æ˜¯å¦æœ‰é—¹é’Ÿåˆ°æ—¶ã€‚è¿™æ ·åšæ³•æœ€æ–¹ä¾¿çš„åœ°æ–¹æ˜¯ï¼Œå¯ä»¥å’Œ ClockPage é‡Œçš„æ—¶é’ŸæŒ‡é’ˆæ›´æ–°äº‹ä»¶å…±ç”¨ä¸€ä¸ª Timerï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="built_in">bool</span> <span class="title">OnTimerTick</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    DateTime dateTime = DateTime.Now;</span><br><span class="line"></span><br><span class="line">    ... <span class="comment">// Do ui changes</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (dateTime.Second % <span class="number">30</span> &lt;= <span class="number">1</span> &amp;&amp; dateTime.Minute != _lastCheck)  <span class="comment">// To avoid high cpu occupying</span></span><br><span class="line">    &#123;</span><br><span class="line">        _lastCheck = dateTime.Minute;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ•´ç‚¹æŠ¥æ—¶</span></span><br><span class="line">        <span class="keyword">if</span> (onTheHourToggle.IsToggled &amp;&amp; dateTime.Minute == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Notify(dateTime.Hour);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®šæ—¶çš„é—¹é’Ÿ</span></span><br><span class="line">        List&lt;AlarmItem&gt; alarms = App.Database.GetAllAlarmItemsAsync().Result;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> a <span class="keyword">in</span> alarms)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (a.Work &amp;&amp; isOnTime(a.Time, dateTime))</span><br><span class="line">            &#123;</span><br><span class="line">                Notify(a);</span><br><span class="line">                a.Work = <span class="literal">false</span>;</span><br><span class="line">                App.Database.SaveAlarmItemAsync(a);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">bool</span> <span class="title">isOnTime</span>(<span class="params">TimeSpan t, DateTime d</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> t.Hours == d.Hour &amp;&amp; t.Minutes == d.Minute;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„æˆ‘ä»¬è®¾ç½®çš„ Timer åœ¨ä¸€ç§’å†…æ˜¯è¦ Tick å¥½å¤šæ¬¡çš„ï¼Œä½†é—¹é’Ÿåˆ°æ—¶æ£€æµ‹åªåº”è¯¥æ¯åˆ†é’Ÿ0ç§’æ—¶åšä¸€æ¬¡ï¼ˆæˆ‘å†åŠ äº†ä¸€æ¬¡åœ¨30ç§’æ—¶çš„é˜²æ­¢æ„å¤–ï¼‰ï¼Œæ‰€ä»¥æœ‰äº† <code>dateTime.Second % 30 &lt;= 1 &amp;&amp; dateTime.Minute != _lastCheck</code> è¿™æ ·çš„ä»£ç </p><p>åœ¨ <code>Notify</code> æ–¹æ³•ä¸­å®Œæˆå…·ä½“çš„é€šçŸ¥ç”¨æˆ·çš„è¡Œä¸ºï¼Œæ¯”å¦‚å¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// For é—¹é’Ÿ</span></span><br><span class="line"><span class="keyword">await</span> DisplayAlert(alarmItem.TimeString, alarmItem.Note, <span class="string">&quot;OK&quot;</span>);</span><br></pre></td></tr></table></figure><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// For æ•´ç‚¹æŠ¥æ—¶</span></span><br><span class="line"><span class="keyword">await</span> DisplayAlert(<span class="string">&quot;æ•´ç‚¹æŠ¥æ—¶&quot;</span>, <span class="string">&quot;ç°åœ¨æ—¶é—´&quot;</span> + hour + <span class="string">&quot;ç‚¹æ•´ã€‚&quot;</span>, <span class="string">&quot;OK&quot;</span>);</span><br></pre></td></tr></table></figure><p>å…¶å®ï¼Œæˆ‘è¿˜å®ç°äº†é—¹é’Ÿåˆ°æ—¶æ’­æ”¾éŸ³ä¹ä»¥åŠè¯­éŸ³æ•´ç‚¹æŠ¥æ—¶çš„åŠŸèƒ½ï¼Œåªè¦åœ¨ <code>Notify</code> æ–¹æ³•ä¸­åŠ å…¥å¯¹åº”çš„æ“ä½œå°±è¡Œäº†ï¼Œåœ¨æ­¤ä¸èµ˜è¿°ã€‚ä½†è¿™äº›å…³äºéŸ³é¢‘çš„å®ç°åœ¨ iOS å’Œ Android é‡Œæ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†æˆ‘ä¸€æ¬¡éƒ½æ²¡æœ‰æˆåŠŸåœ¨ UWP ä¸Šå¼„å‡ºæ¥ï¼Œå¯èƒ½æ˜¯éœ€è¦è®¾ç½®ä¸€ä¸‹è§£å†³æ–¹æ¡ˆçš„æ‰“åŒ…æ–¹å¼ä»€ä¹ˆçš„ï¼Œä½†æˆ‘æ²¡æœ‰æ‰¾åˆ° Microsoft ç›¸åº”çš„æ–‡æ¡£ä»‹ç»ï¼Œå’±ä¹Ÿæ²¡æ·±å…¥ç ”ç©¶ğŸ˜‚ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è‡³æ­¤ï¼Œæ•´ä¸ªè·¨å¹³å°å°é—¹é’Ÿé¡¹ç›®å°±å¤§æ¦‚ä»‹ç»å®Œäº†ï¼Œæ—¶é—´å…³ç³»ï¼Œæˆ‘çœç•¥äº†å¤ªå¤šçš„ç»†èŠ‚ï¼Œå¯ä»¥åˆ° Github é˜…è¯»æºç ï¼Œ<a href="https://github.com/cdfmlr/MyClock">https://github.com/cdfmlr/MyClock</a> ã€‚</p><p>é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥å¤§æ¦‚äº†è§£ C# è¯­è¨€å’Œ åˆ©ç”¨ Xamarin.Forms å¼€å‘è·¨å¹³å° App çš„æ–¹æ³•ï¼Œä½†éœ€è¦ä¸€å®šçš„ Android/iOS/Flutter/UWP å¼€å‘åŸºç¡€æ‰èƒ½å¾ˆå¥½çš„ç†è§£è¿™äº›ä»£ç ã€‚å…¶å®ï¼Œå†™å®Œè¿™ä¸ªä¸œè¥¿ï¼Œè™½ç„¶ç®€å•ï¼ŒåŸºæœ¬ç¨å¾®è®¾è®¡ä¸€ä¸‹å°±ç…§ç€æ–‡æ¡£å†™å°±å¥½äº†ï¼Œäº”å…­ç™¾è¡Œä»£ç ï¼Œå‡ ä¸ªå°æ—¶æå®šï¼Œä½†æˆ‘è¿˜æ˜¯å¾ˆæœ‰æ”¶è·çš„ã€‚C# çš„å¥½å¤šåœ°æ–¹æ„Ÿè§‰çœŸçš„æ¯” Java å†™ç€æ–¹ä¾¿ï¼ˆæœ€æ˜¾è‘—çš„æ˜¯ getter å’Œ setterï¼‰ï¼Œç„¶è€Œå‘½åä¹ æƒ¯ä»€ä¹ˆçš„ä¸å¤ªä¹ æƒ¯ï¼Œè‡³äºæ•ˆç‡å’±æ²¡è¯¦ç»†ç ”ç©¶ä¹Ÿæ²¡æœ‰ç»“è®ºã€‚Xamarin ä¹Ÿå¾ˆå¥½ç”¨ï¼Œå†™èµ·æ¥ä»£ç ç®€å•æ˜“æ‡‚ã€å¼€å‘é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œæ¯”åŸç”Ÿ Android å¼€å‘æ–¹ä¾¿å¾ˆå¤šï¼Œè·¨å¹³å°çš„ UI æ•ˆæœä¹Ÿç¡®å®ä¸é”™ï¼ˆé™¤äº†åœ¨å¾®è½¯è‡ªå®¶çš„ UWP ä¸‹æœ‰å° BugsğŸ˜‚ï¼‰ ã€‚</p><p>å†è¯´ä¸€ä¸‹ä¸è¶³ã€‚ç¬¬ä¸€ï¼Œæˆ‘æ²¡æœ‰ä¸‹åŠŸå¤«åš UI è®¾è®¡ï¼Œæ‰€ä»¥æ¯”è¾ƒä¸‘ï¼›ç¬¬äºŒï¼Œå¦‚å‰é¢å¤šæ¬¡æåˆ°çš„ï¼Œè¿™ä¸ªå®ç°åœ¨ UWP å¹³å°ä¸‹çš„æ•ˆæœä¸ä½³ï¼›æœ€åï¼Œå…¶å®è¿™ä¸ªå®ç°å¹¶æ²¡æœ‰å®Œæˆé¢˜ç›®è¦æ±‚çš„â€œæœ€å°åŒ–åˆ°ç³»ç»Ÿæ‰˜ç›˜â€ï¼ˆXamarin æ²¡æœ‰æä¾›è¿™ç§æ“ä½œï¼Œè¿™ä¸ªä¸œè¥¿æ˜¾ç„¶è·¨ä¸äº†å¹³å°ï¼Œåªèƒ½åœ¨ Windows é‡Œå®ç°ï¼‰ã€â€œä¿å­˜ä¸ºæ–‡æœ¬æ–‡ä»¶â€ï¼ˆæˆ‘ä»¬çŸ¥é“ï¼ŒSQLite ç®—æ˜¯äºŒè¿›åˆ¶å‚¨å­˜ï¼Œè°ˆä¸ä¸Šâ€œæ–‡æœ¬æ–‡ä»¶â€ï¼‰ç­‰ã€‚</p><h2 id="å¦ä¸€ç§å®ç°"><a href="#å¦ä¸€ç§å®ç°" class="headerlink" title="å¦ä¸€ç§å®ç°"></a>å¦ä¸€ç§å®ç°</h2><p>åŸºäºå‰é¢æ‰€è¯´çš„è¯¸å¤šä¸è¶³ï¼Œæˆ‘åˆå€Ÿäº†ä¸€å° Windows PCï¼Œå‚è€ƒé©¬è€å¸ˆå¤šå¹´å‰çš„æ–‡ç«  <a href="https://blog.csdn.net/lsgo_myp/article/details/53148238">åˆ©ç”¨C#è¯­è¨€å®ç°å°é—¹é’Ÿ</a>ï¼Œå†™äº† <a href="https://github.com/cdfmlr/Alarm-WindowsForms">Alarm-WindowsForms</a> é¡¹ç›®ï¼Œä¸€ä¸ªæ›´ç¬¦åˆé¢˜ç›®è¦æ±‚ä½†æ›´åŠ ç²—åˆ¶æ»¥é€ çš„ WindowsForms å®ç°ã€‚</p><p>WindowsForms æ¯•ç«Ÿæ˜¯ä¸Šä¸€ä¸ªå¹´ä»£çš„äº§ç‰©äº†ï¼Œå®ƒè®¾è®¡å‡ºæ¥çš„ä¸œè¥¿ä¹Ÿè¿˜æ˜¯è€çš„ Windows æ ·å¼ï¼Œè·Ÿå¾®è½¯ç°åœ¨çš„ Fluent Design ä¸€ç‚¹è¾¹éƒ½ä¸æ²¾ï¼Œé™¤äº†å†å²é—ç•™ä¸‹æ¥é‚£äº›éƒ¨åˆ†å¾®è½¯ç°åœ¨è‡ªå®¶è½¯ä»¶çš„å¼€å‘ä¹Ÿä¸ç”¨è¿™ä¸ªäº†ï¼Œè¿™ä¸œè¥¿åœ¨ VS 2019 é‡Œçš„è®¾è®¡ç•Œé¢é‡Œæ˜¾ç¤ºçš„å±…ç„¶éƒ½æ˜¯ä¸ª Windows vista/7 æ ·å­çš„çª—ä½“ğŸ˜‚ã€‚</p><p>æˆ‘æ²¡æœ‰å¥½å¥½ç ”ç©¶ C# å†™ WindowsForms çš„çŸ¥è¯†ï¼Œæ•´ä¸ªå®ç°åŸºæœ¬å°±æ˜¯å‡­ ç›´è§‰ + é©¬è€å¸ˆçš„æ–‡ç«  + å°æ—¶å€™å­¦ VB æ®‹å­˜çš„è®°å¿†ã€‚è€Œä¸”ç”±äºæˆ‘ä¸ç†Ÿæ‚‰ Windows å’Œ Visual Studio çš„æ“ä½œï¼Œæˆ‘ç”šè‡³è¿å¯¹æ–°å»ºå‡ºæ¥çš„ç±»çš„å‘½åéƒ½æ²¡åšï¼ˆåæ§½ä¸€ä¸‹ Windows ä¸‹ VS çš„é€»è¾‘ï¼Œæ–°å»ºä¸€ä¸ª Class æˆ–è€…å…¶ä»–ä»€ä¹ˆä¸œè¥¿çš„æ—¶å€™å±…ç„¶æ²¡æœ‰è¾“å…¥åç§°çš„åœ°æ–¹ï¼Œè‡ªåŠ¨æå‡ºäº› Class1ã€Class2 ä¹‹ç±»çš„ä¸œè¥¿æ¥ï¼Œç„¶åå’±ä¹Ÿä¸æ•¢å»é‡å‘½åå®ƒï¼Œæ€•è§£å†³æ–¹æ¡ˆé‡Œæ³¨å†Œçš„ä¿¡æ¯ä¸å¯¹äº†ï¼ˆVS For Mac æœ‰è¿™ä¸ªæ¯›ç—…ï¼Œä¸çŸ¥é“ Win ä¸Šçš„å¦‚ä½•ï¼‰ï¼‰ï¼Œæ‰€ä»¥ä¸æ‰“ç®—è¯¦ç»†å†™äº†ï¼Œå¤§è‡´çš„è®¾è®¡å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">WindowsForms å°é—¹é’Ÿç¨‹åº</span><br><span class="line">    |-- UI</span><br><span class="line">    |    |-- åœ¨ç¨‹åºè½½å…¥æ—¶ç»˜åˆ¶ç•Œé¢ï¼Œè¯»å–å‚¨å­˜çš„é—¹é’Ÿæ•°æ®</span><br><span class="line">    |    |-- åœ¨ Timer Tick (æ¯1ç§’) æ—¶:</span><br><span class="line">    | | åŠ¨æ€æ›´æ–°åœ†ç›˜æ—¶é’Ÿ</span><br><span class="line">    | |æ£€æµ‹æ˜¯å¦æ•´ç‚¹æŠ¥æ—¶æˆ–é—¹é’Ÿæé†’</span><br><span class="line">    |    |-- åœ¨ç”¨æˆ·æ·»åŠ æ–°é—¹é’Ÿæ—¶åˆ›å»º Alarm å®ä¾‹</span><br><span class="line">    | | å€ŸåŠ© AlarmDatabase å‚¨å­˜ï¼Œå¹¶å†™å…¥ç£ç›˜</span><br><span class="line">    |    |-- åœ¨ç”¨æˆ·ç¼–è¾‘&#x2F;åˆ é™¤é—¹é’Ÿæ—¶:</span><br><span class="line">    | |å€ŸåŠ© AlarmDatabase ä¿®æ”¹&#x2F;åˆ é™¤ Alarm å®ä¾‹</span><br><span class="line">    | | åŒæ—¶ä¹Ÿä»ç£ç›˜æ–‡ä»¶ä¸­ä¿®æ”¹&#x2F;åˆ é™¤æ•°æ®</span><br><span class="line">    |    |-- åœ¨æœ€å°åŒ–&#x2F;å…³é—­æ—¶å¤„ç†æœ€å°åŒ–åˆ°ç³»ç»Ÿæ‰˜ç›˜</span><br><span class="line">    |</span><br><span class="line">    |-- ç›¸å…³ç±»</span><br><span class="line">         |-- class Alarm: é—¹é’Ÿç±»ï¼Œä»£è¡¨ç¨‹åºè¿è¡Œæ—¶çš„ä¸€ä¸ªé—¹é’Ÿå¯¹è±¡</span><br><span class="line">         |-- class AlarmDatabase: é—¹é’Ÿæ•°æ®åº“</span><br><span class="line">         |      å¤„ç†å°†å†…å­˜ä¸­çš„é—¹é’Ÿæ•°æ®å‚¨å­˜åˆ°ç£ç›˜ä»¥åŠä»ç£ç›˜è¯»å–å·²ä¿å­˜çš„æ•°æ®</span><br><span class="line">         |-- class TickMarkDrawHelper: è®¡ç®—è¡¨ç›˜åˆ»åº¦åæ ‡çš„è¾…åŠ©ç±»</span><br></pre></td></tr></table></figure><p>è¿è¡Œæ•ˆæœï¼š</p><p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1g9vdfrwji1j30m40d8dg5.jpg" alt="1"></p><p>å†™è¿™ä¸ªå®ç°æ”¶è·å°±æ²¡æœ‰å¤ªå¤šäº†ï¼Œæ— éæ˜¯å†ç†Ÿæ‚‰äº†ä¸€ä¸‹ C# è¿˜æœ‰ WindowsFormsï¼Œä½†æ„Ÿè§¦å€’æ˜¯é¢‡å¤šã€‚å†™è¿™ä¸ªä¸œè¥¿çš„æ—¶å€™ï¼Œæˆ‘æƒ³èµ·è‡ªå·±ä¸€å¼€å§‹å­¦ç¼–ç¨‹çš„æ—¶å€™æ¥è§¦çš„ VBï¼Œå½“æ—¶ç”¨ä¸€å°ç£ç›˜åªæœ‰ 10 GB çš„ Windows 98 ç¬”è®°æœ¬ï¼Œè·‘å¹´çºªæ¯”è‡ªå·±è¿˜å¤§çš„ VS6.0 ï¼ˆå½“æ—¶å¥½åƒè¿˜æ˜¯ä¸€ä¸ªä¸ªåˆ†å¼€çš„ VC6.0ã€VB6.0 ä»€ä¹ˆçš„ï¼‰ï¼Œé‚£ä¸ªæ—¶å€™å†™çš„ VB å°±å’Œç°åœ¨è¿™ä¸ª WindowsForms in C# ä¸€æ ·ï¼Œè¿˜æ˜¯é‚£å‡ ä¸ªç†Ÿæ‚‰çš„æ§ä»¶ï¼Œåªæ˜¯å¼€å‘è¯­è¨€ä» BASIC å˜æˆäº† C#ã€‚è¿™ä¸ªæ—¶å€™æ‰çŒ›ç„¶å›å¿†èµ·ï¼Œä»æˆ‘çš„ç¬¬ä¸€ä¸ª Hello World åˆ°ä»Šå¤©ä¹Ÿæœ‰8å¹´äº†â€¦â€¦ä»Šåä¹Ÿè¿˜ä¼šä¸€ç›´ç»§ç»­è¿™æ®µç¨‹åºäººç”Ÿï¼Œè™½ç„¶å†™ä»£ç ä»æ¥éƒ½ä¸æ˜¯æˆ‘æœ€å–œæ¬¢çš„äº‹ï¼Œä½†æ˜¯æ²¡åŠæ³•ï¼Œè°è®©æˆ‘ä¹æ„å‘¢â€¦â€¦</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ¨èç³»ç»Ÿ</title>
      <link href="/2019/12/05/AndrewNgML/AndrewNg-MachineLearning-16-RecommenderSystems/"/>
      <url>/2019/12/05/AndrewNgML/AndrewNg-MachineLearning-16-RecommenderSystems/</url>
      
        <content type="html"><![CDATA[<h1 id="Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-16-Recommender-Systems"><a href="#Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-16-Recommender-Systems" class="headerlink" title="Notes of Andrew Ngâ€™s Machine Learning â€”â€” (16) Recommender Systems"></a>Notes of Andrew Ngâ€™s Machine Learning â€”â€” (16) Recommender Systems</h1><h2 id="Predicting-Movie-Ratings"><a href="#Predicting-Movie-Ratings" class="headerlink" title="Predicting Movie Ratings"></a>Predicting Movie Ratings</h2><h3 id="Problem-Formulation"><a href="#Problem-Formulation" class="headerlink" title="Problem Formulation"></a>Problem Formulation</h3><p>Example: Predicting movies using zero to five stars.</p><p>Here we got some ratings for some movies given by  different users, where a <code>?</code> means this use not rated that movie:</p><table><thead><tr><th>Movie</th><th>Alice(1)</th><th>Bob(2)</th><th>Carol(3)</th><th>Dave(4)</th></tr></thead><tbody><tr><td>Love at last</td><td>5</td><td>5</td><td>0</td><td>0</td></tr><tr><td>Romance forever</td><td>5</td><td>?</td><td>?</td><td>0</td></tr><tr><td>Cute puppies of love</td><td>?</td><td>4</td><td>0</td><td>?</td></tr><tr><td>Nonstop car chases</td><td>0</td><td>0</td><td>5</td><td>4</td></tr><tr><td>Swords vs. karate</td><td>0</td><td>0</td><td>5</td><td>?</td></tr></tbody></table><p>Notation:</p><ul><li>$n_u$ = number of users</li><li>$n_m$ = number of movies</li><li>$r(i,j)=1$ if user $j$ has rated movie $i$</li><li>$y^{(i,j)}$ = rating given by user $j$ to movie $i$ (defined only if $r(i,j)=1$)</li></ul><p>In this example,  $n_u=4$ and $n_m=5$.We can see that the first three movies is somewhat romantic where the last two is action movies. And we know that our Alice and Bob is more interested in romance  movies so they may give a higher (say, 4 or 5) rate to they  no watched <em>Cute pupies of love</em> and <em>Romance forever</em>, but they may give 0 to <em>Nonstop car chases</em> and <em>Sword vs. karate</em>. And Carol and Dave will behave  on the contrary.</p><h3 id="Content-Based-Recommendations"><a href="#Content-Based-Recommendations" class="headerlink" title="Content Based Recommendations"></a>Content Based Recommendations</h3><p>We can asume we have a set of $x$ measures the degree to the kind of the movie.</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g9bi5bv4etj30nz06lac1.jpg" alt="å±å¹•å¿«ç…§ 2019-11-26 16.04.26"></p><p>We can bulid a model like this: for each user $j$, learn a parameter $\theta^{(j)}\in\R^3$. Predict user $j$ as rating movie $i$ with $(\theta^{(j)})^Tx^{(i)}$ stars.</p><p>Here is what we will do:</p><ul><li><p>$r(i,j)=1$ if user $j$ has rated movie $i$ ($0$ otherwise)</p></li><li><p>$y^{(i,j)}$ = rating given by user $j$ to movie $i$ (if defined)</p></li><li><p>$\theta^{(j)}$ = parameter vector for user $j$</p></li><li><p>$x^{(i)}$ = feature vector for movie $i$</p></li></ul><p>For User $j$, movie $i$, predicted rating: $(\theta^{(j)})^T(x^{(i)})$</p><p>So our <strong>optimization objective</strong> is:</p><p>To learn $\theta^{(j)}$ (parameter for a single user $j$):<br>$$<br>\min_{\theta^{(j)}}\sum_{i:r(i,j)=1}\left((\theta^{(j)})^Tx^{(i)}-y^{(i,j)}\right)^2+\frac{\lambda}{2}\sum_{k=1}^n \left(\theta_k^{(j)}\right)^2<br>$$<br>To learn $\theta^{(1)},\theta^{(2)},\cdots,\theta^{(n_u)}$ (for all users):<br>$$<br>\min_{\theta^{(1)},\cdots,\theta^{(n_u)}}<br>\sum_{j=1}^{n_u}\sum_{i:r(i,j)=1}\left((\theta^{(j)})^Tx^{(i)}-y^{(i,j)}\right)^2 +<br>\frac{\lambda}{2}\sum_{j=1}^{n_u}\sum_{k=1}^n \left(\theta_k^{(j)}\right)^2<br>$$<br>We can use a gradient descent to solve it<br>$$<br>\begin{array}{l}<br>Repeat\quad{\<br>\qquad \theta_0^{(j)}:=\theta_0^{(j)}-\alpha\sum_{i:r(i,j)=1} \big((\theta^{(j)})^T(x^{(i)})-y^{(i,j)}\big)x_0^{(i)}\<br>\qquad \theta_k^{(j)}:=\theta_k^{(j)}-\alpha\Big[\Big(\sum_{i:r(i,j)=1}\big((\theta^{(j)})^T(x^{(i)})-y^{(i)}\big)x_k^{(i)}\Big)+\lambda\theta_k^{(j)}\Big]\qquad (\textrm{for } k \neq 0)\<br>}<br>\end{array}<br>$$</p><h2 id="Collaborative-Filtering"><a href="#Collaborative-Filtering" class="headerlink" title="Collaborative Filtering"></a>Collaborative Filtering</h2><h3 id="Collaborative-Filtering-1"><a href="#Collaborative-Filtering-1" class="headerlink" title="Collaborative Filtering"></a>Collaborative Filtering</h3><p>In many conditions, we have no idea of what features to use, so we need this algtorithm that is called <em>Collaborative Filtering</em> to help us <strong>learn the features</strong>.</p><p>Here is a example:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g9drfoeqaoj30lo0avacu.jpg" alt="å±å¹•å¿«ç…§ 2019-11-28 14.55.32"></p><p>Given rates of movies by people and how this people like different kinds of movies ($\theta$), we try to get what kind of a movie is likely to be ($x$).</p><p><strong>Optimization algorithm</strong></p><p>Given $\theta^{(1)},\theta^{(2)},\cdots,\theta^{(n_u)}$, to learn $x^{(i)}$:<br>$$<br>\min_{x^{(i)}}\frac{1}{2}\sum_{i:r(i,j)=1}\left((\theta^{(j)})^Tx^{(i)}-y^{(i,j)}\right)^2+\frac{\lambda}{2}\sum_{k=1}^n \left(x_k^{(i)}\right)^2<br>$$<br>Given $\theta^{(1)},\theta^{(2)},\cdots,\theta^{(n_u)}$, to learn $x^{(1)},\cdots,x^{(n_m)}$:<br>$$<br>\min_{x^{(1)},\cdots,x^{(n_m)}}\frac{1}{2}<br>\sum_{i=1}^{n_m}\sum_{i:r(i,j)=1}\left((\theta^{(j)})^Tx^{(i)}-y^{(i,j)}\right)^2 +<br>\frac{\lambda}{2}\sum_{i=1}^{n_m}\sum_{k=1}^n \left(x_k^{(i)}\right)^2<br>$$<br><strong>Collaborative filtering</strong></p><p>So if we knew the features, we can learn the parameters theta for different users. If our users are willing to give us parameters, then we can estimate features for the different movies. </p><p>So this is kind of a chicken and egg problem. Which comes first? If we can get the thetas, we can know the xs. If we have the xs, we can learn the thetas.</p><p>What we can do is in fact <strong>randomly guess</strong> some value of the thetas. Now based on the initial random guess for the thetas, we can then go ahead and use the procedure that we just talked about in order to learn features for different movies. Then we get better thetas by using the new xs. Then another set of better xs, â€¦ Keep on doing this, it can finally coverage.</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g9ds8xkjatj30ob0bd0w0.jpg" alt="å±å¹•å¿«ç…§ 2019-11-28 15.20.59"></p><h3 id="Collaborative-Filtering-Algorithm"><a href="#Collaborative-Filtering-Algorithm" class="headerlink" title="Collaborative Filtering Algorithm"></a>Collaborative Filtering Algorithm</h3><p>Here is what we do in the previous content:</p><blockquote><p>Given $x^{(1)},\cdots,x^{(n_m)}$, estimate $\theta^{(1)},\cdots,\theta^{(n_u)}$:<br>$$<br>\min_{\theta^{(1)},\cdots,\theta^{(n_u)}}<br>\sum_{j=1}^{n_u}\sum_{i:r(i,j)=1}\left((\theta^{(j)})^Tx^{(i)}-y^{(i,j)}\right)^2 +<br>\frac{\lambda}{2}\sum_{j=1}^{n_u}\sum_{k=1}^n \left(\theta_k^{(j)}\right)^2<br>$$<br>Given $\theta^{(1)},\cdots,\theta^{(n_u)}$, estimate $x^{(1)},\cdots,x^{(n_m)}$:<br>$$<br>\min_{x^{(1)},\cdots,x^{(n_m)}}\frac{1}{2}<br>\sum_{i=1}^{n_m}\sum_{i:r(i,j)=1}\left((\theta^{(j)})^Tx^{(i)}-y^{(i,j)}\right)^2 +<br>\frac{\lambda}{2}\sum_{i=1}^{n_m}\sum_{k=1}^n \left(x_k^{(i)}\right)^2<br>$$<br>We randomly initialize the parameters and go back and forth between the xâ€™s and the thetas, to get the objective.</p></blockquote><p>There is a more efficient way to do so:</p><p>Minimizing $x^{(1)},\cdots,x^{(n_m)}$ and $\theta^{(1)},\cdots,\theta^{(n_u)}$ simultaneously:<br>$$<br>J(x^{(1)},\cdots,x^{(n_m)},\theta^{(1)},\cdots,\theta^{(n_u)})=<br>\frac{1}{2}<br>\sum_{(i,j):r(i,j)=1}\left((\theta^{(j)})^Tx^{(i)}-y^{(i,j)}\right)^2+<br>\frac{\lambda}{2}\sum_{i=1}^{n_m}\sum_{k=1}^n \left(x_k^{(i)}\right)^2+<br>\frac{\lambda}{2}\sum_{i=1}^{n_m}\sum_{k=1}^n \left(x_k^{(i)}\right)^2<br>$$</p><p>$$<br>\min_{\begin{array}{c}x^{(1)},\cdots,x^{(n_m)}\\theta^{(1)},\cdots,\theta^{(n_u)}\end{array}}<br>J(x^{(1)},\cdots,x^{(n_m)},\theta^{(1)},\cdots,\theta^{(n_u)})<br>$$</p><p>Put everything together, we get the <strong>collaborative filtering algorithm</strong>:</p><ol><li><p>Initialize $x^{(1)},\cdots,x^{(n_m)},\theta^{(1)},\cdots,\theta^{(n_u)}$ to small random values</p></li><li><p>Minimize $J(x^{(1)},\cdots,x^{(n_m)},\theta^{(1)},\cdots,\theta^{(n_u)})$ using gradient descent (or an advanced optimization algorithm).</p><p>E.g. for every $j=1,â€¦,n_u,i=1,â€¦,n_m$:<br>$$<br>x_k^{(i)}:=x_k^{(i)}-\alpha\Big[\Big(\sum_{j:r(i,j)=1}\big((\theta^{(j)})^T(x^{(i)})-y^{(i)}\big)\theta_k^{(j)}\Big)+\lambda x_k^{(i)}\Big]<br>$$</p><p>$$<br>\theta_k^{(j)}:=\theta_k^{(j)}-\alpha\Big[\Big(\sum_{i:r(i,j)=1}\big((\theta^{(j)})^T(x^{(i)})-y^{(i)}\big)x_k^{(i)}\Big)+\lambda\theta_k^{(j)}\Big]<br>$$</p></li><li><p>For a user with parameters $\theta$ and a movie with (learned) features $x$, predict a star rating of $\theta^Tx$.</p></li></ol><h2 id="Low-Rank-Matrix-Factorization"><a href="#Low-Rank-Matrix-Factorization" class="headerlink" title="Low Rank Matrix Factorization"></a>Low Rank Matrix Factorization</h2><h3 id="Vectorization-Low-Rank-Matrix-Factorization"><a href="#Vectorization-Low-Rank-Matrix-Factorization" class="headerlink" title="Vectorization: Low Rank Matrix Factorization"></a>Vectorization: Low Rank Matrix Factorization</h3><p>To vectorize the collaborative filtering algorithm, we are going to put xs/thetas together:</p><p>So, let:<br>$$<br>X = \left[\begin{array}{ccc}</p><ul><li>&amp; (x^{(1)})^T &amp; - \<br>&amp; \vdots &amp; \</li><li>&amp; (x^{(n_m)})^T &amp; - \<br>\end{array}\right],<br>\qquad<br>\Theta = \left[\begin{array}{ccc}</li><li>&amp; (\theta^{(1)})^T &amp; - \<br>&amp; \vdots &amp; \</li><li>&amp; (\theta^{(n_u)})^T &amp; - \<br>\end{array}\right]<br>$$<br>Then, we can get prediction by:<br>$$<br>X\Theta^T= \left[\begin{array}{ccccc} (x^{(1)})^T(\theta^{(1)}) &amp; \ldots &amp; (x^{(1)})^T(\theta^{(n_u)})\ \vdots &amp; \ddots &amp; \vdots \ (x^{(n_m)})^T(\theta^{(1)}) &amp; \ldots &amp; (x^{(n_m)})^T(\theta^{(n_u)})\end{array}\right]<br>$$<br>And this algorithm is called <em>Low Rank Matrix Factorization</em>.</li></ul><h4 id="Finding-related-movies"><a href="#Finding-related-movies" class="headerlink" title="Finding related movies"></a>Finding related movies</h4><p>For each product (e.g. movie) $i$, we learn a feature vector $x^{(i)}\in\R^n$. We can find a movie $j$ that is most related to movie $i$ by finding a $j$ that has:<br>$$<br>\mathop{\textrm{smallest}} ||x^{(i)}-x^{(j)}||.<br>$$</p><h3 id="Implementational-Detail-Mean-Normalization"><a href="#Implementational-Detail-Mean-Normalization" class="headerlink" title="Implementational Detail: Mean Normalization"></a>Implementational Detail: Mean Normalization</h3><p>If we use what we talked about above, given a user who ranked no movies, than, our recommend system will output a all zeros result, so we can recommend nothing to this user. We never hope this, so we do a mean normalization:<br>$$<br>\mu_i=\mathop{\textrm{average}} y^{(i,:)}<br>$$</p><p>$$<br>Y_i = Y_i-\mu_i<br>$$</p><p>For user $j$, on movie $i$, we predict:<br>$$<br>\left(\Theta^{(j)}\right)^T\left(x^{(i)}\right)+\mu_i<br>$$<br>Then we can get a set of â€œaverageâ€ recommendation  for a no-ranked user.</p><p>We talked about mean normalization. However, unlike some other applications of feature scaling, we did not scale the movie ratings by dividing by the range (max â€“ min value). This is because all the movie ratings are already comparable (e.g., 0 to 5 stars), so they are already on similar scales.</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> AndrewNg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼‚å¸¸æ£€æµ‹</title>
      <link href="/2019/11/26/AndrewNgML/AndrewNg-MachineLearning-15-AnomalyDetection/"/>
      <url>/2019/11/26/AndrewNgML/AndrewNg-MachineLearning-15-AnomalyDetection/</url>
      
        <content type="html"><![CDATA[<h1 id="Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-15-Anomaly-Detection"><a href="#Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-15-Anomaly-Detection" class="headerlink" title="Notes of Andrew Ngâ€™s Machine Learning â€”â€” (15) Anomaly Detection"></a>Notes of Andrew Ngâ€™s Machine Learning â€”â€” (15) Anomaly Detection</h1><h2 id="Density-Estimation"><a href="#Density-Estimation" class="headerlink" title="Density Estimation"></a>Density Estimation</h2><h3 id="Problem-Motivation"><a href="#Problem-Motivation" class="headerlink" title="Problem Motivation"></a>Problem Motivation</h3><p><em>Anomaly Detection</em> is a type of machine learning problem.</p><p>Imagine that youâ€™re a manufacturer of aircraft engines, and letâ€™s say that as your aircraft engines roll off the assembly line, youâ€™re doing quality assurance testing, and as part of that testing you measure features of your aircraft engine, like the heat generated, the vibrations and so on. So you now have a data set of $x_1$ through $x_m$, if you have manufactured $m$ aircraft engines and plot your data. Then, given a new engine $x_{test}$, you want to know is $x_{test}$ anomalous? This problem is called <strong>Anomaly Detection</strong>.</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8xdwc6zf8j30p10c2gpb.jpg" alt="image-20191114105935962"></p><p>Here is want we are going to do:</p><blockquote><p>Dataset: ${x^{(1)},x^{(2)},\cdots,x^{(m)}}$</p><p>Is $x_{test}$ anomalous?</p></blockquote><p>To solve this problem, we will train a model for $p(x)$ (i.e. a model for the <strong>probability</strong> of $x$, where $x$ are these features of, say, aircraft engines). Weâ€™re then going to say that for the new aircraft engine, if $p(x_{test})$ is less than some $\epsilon$ then we flag this as an anomaly:<br>$$<br>\begin{array}{l}<br>p(x_{test})&lt;\epsilon \Rightarrow \textrm{anomaly}\<br>p(x_{test})\ge\epsilon \Rightarrow \textrm{OK}<br>\end{array}<br>$$<br>This problem of estimating this distribution $p(x)$ are sometimes called the problem of <em>density estimation</em>.</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8xebhrku9j30nl0d7gqi.jpg" alt="image-20191114111418858"></p><h4 id="Anomaly-detection-example"><a href="#Anomaly-detection-example" class="headerlink" title="Anomaly detection example"></a>Anomaly detection example</h4><p><strong>Anomaly detec-on example</strong> </p><p>Fraud detection</p><ul><li>$x^{(i)}$= features of user $i$â€™s actvities </li><li>Model $p(x)$ from data.</li><li>Idenify unusual users by checking which have $p(x)&lt;\epsilon$</li></ul><p>Manufacturing  (Monitoring computers in a data center )</p><ul><li><p>$x^{(i)}$ = features of machine $i$</p></li><li><p>$x_1$ = memory use, $x_2$ = number of disk accesses/sec, $x_3$ = CPU load, $x_4$ = CPU load/network traffic â€¦</p></li></ul><h3 id="Gaussian-Distribution"><a href="#Gaussian-Distribution" class="headerlink" title="Gaussian Distribution"></a>Gaussian Distribution</h3><p><strong>Gaussian distribution</strong> which is also called the <em>normal distribution</em>.</p><p>If $x$ is a distributed Gaussian with mean $\mu$, variance $\sigma^2$, we will write it as:<br>$$<br>x \sim \mathcal{N}(\mu,\sigma^2)<br>$$<br>In this case, the probability of $x$ is:<br>$$<br>p(x) = \frac{1}{\sqrt{2\pi}\sigma}\exp\left(-\frac{(x-\mu)^2}{2\sigma^2}\right)<br>$$</p><p>There is some example of Gaussian distribution:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8yum81cydj30je0c3410.jpg" alt="image-20191115172344685"></p><p>We can see that the â€œcenterâ€ of these plots is actually the value of $\mu$. And with our $\sigma$ increasing,  the plots is more and more â€œflatâ€. Or, it will be â€œthin &amp; tallâ€ if $\sigma$ is small.</p><h4 id="Parameter-estimation"><a href="#Parameter-estimation" class="headerlink" title="Parameter estimation"></a>Parameter estimation</h4><p>Given a dataset: ${x^{(1)},x^{(2)},\cdots,x^{(m)}}$, we can get our $\mu$ and $\sigma$ by:<br>$$<br>\mu=\frac{1}{m}\sum_{i=1}^{m}x^{(i)}<br>$$</p><p>$$<br>\sigma^2=\frac{1}{m}\sum_{i=1}^{m}\left(x^{(i)}-\mu\right)^2<br>$$</p><p>P.S. this is what people turn to use when handling a machine learning problem, itâ€™s a little different from what we normally utilize in mathematics.</p><h3 id="Anomaly-detection-algorithm"><a href="#Anomaly-detection-algorithm" class="headerlink" title="Anomaly detection algorithm"></a>Anomaly detection algorithm</h3><ol><li><p>Choose features $x_i$ that you think might be indicative of anomalous examples.</p></li><li><p>Fit parameters $\mu_1,\cdots,\mu_n,\sigma_1^2,\cdots,\sigma_n^2$: (I wrote the vectorilized version)<br>$$<br>\mu=\frac{1}{m}\sum_{i=1}^{m}x^{(i)}<br>$$</p><p>$$<br>\sigma^2=\frac{1}{m}\sum_{i=1}^{m}\left(x^{(i)}-\mu\right)^2<br>$$</p></li><li><p>Given new example $x$, compute $p(x)$:<br>$$<br>p(x)=\prod_{j=1}^{n}p(x_j;\mu_j,\sigma_j^2)=\prod_{j=1}^{n}\frac{1}{\sqrt{2\pi}\sigma_j}\exp\left(-\frac{(x_j-\mu_j)^2}{2\sigma_j^2}\right)<br>$$</p></li><li><p>Anomaly if $p(x)&lt;\epsilon$</p></li></ol><h2 id="Building-an-Anomaly-Detection-System"><a href="#Building-an-Anomaly-Detection-System" class="headerlink" title="Building an Anomaly Detection System"></a>Building an Anomaly Detection System</h2><h3 id="Developing-and-Evaluating-an-Anomaly-Detection-System"><a href="#Developing-and-Evaluating-an-Anomaly-Detection-System" class="headerlink" title="Developing and Evaluating an Anomaly Detection System"></a>Developing and Evaluating an Anomaly Detection System</h3><p><strong>The importance of real-number evalua-on</strong> </p><p>When developing a learning algorithm (choosing features, etc.), making decisions is much easier if we have a way of evalua-ng our learning algorithm. </p><p>Assume we have some labeled data, of anomalous and non- anomalous examples. ($y=0$ if normal, $y=1$ if anomalous). </p><ul><li><p><code>Training set</code>: $x^{(1)},x^{(2)},\cdots,x^{(m)}$ (assume normal examples/not anomalous)</p></li><li><p><code>Cross validation set</code>: $\left(x_{cv}^{(1)},y_{cv}^{(1)}\right),\cdots,\left(x_{cv}^{(m_{cv})},y_{cv}^{(m_{cv})}\right)$</p></li><li><p><code>Test set</code>: $\left(x_{test}^{(1)},y_{test}^{(1)}\right),\cdots,\left(x_{test}^{(m_{test})},y_{test}^{(m_{test})}\right)$</p></li></ul><p><strong>Aircraft engines motivating example</strong> </p><p>Say, what we have is:</p><ul><li>10000 good (normal) engines  ($y=0$)</li><li>20 flawed engines (anomalous)   ($y=1$)</li></ul><p>Than we are going to choose:</p><ul><li>Training set: 6000 good engines</li><li>CV: 2000 good engines ($y=0$), 10 anomalous ($y=1$)</li><li>Test: 2000 good engines ($y=0$), 10 anomalous ($y=1$) </li></ul><p><strong>Algorithm evaluation</strong></p><p>Fit model $p(x)$ on training set ${x^{(1)},\cdots,x^{(m)}}$</p><p>On a cross validation/test example $x$, predict:<br>$$<br>y = \left{\begin{array}{ll}<br>1 &amp; \textrm{if } p(x) &lt; \epsilon \quad \textrm{(anomaly)}\<br>0 &amp; \textrm{if } p(x) \ge \epsilon \quad \textrm{(normal)}\<br>\end{array}\right.<br>$$<br>Possible evaluation matrices:</p><ul><li>True positive, false positive, false negative, true negative </li><li>Precision/Recall</li><li>$F_1$-score </li></ul><p>Can also use cross valida-on set to choose parameter $\epsilon$.</p><h3 id="Anomaly-Detection-vs-Supervised-Learning"><a href="#Anomaly-Detection-vs-Supervised-Learning" class="headerlink" title="Anomaly Detection vs. Supervised Learning"></a>Anomaly Detection vs. Supervised Learning</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8zz0ijc4cj310f0khn20.jpg" alt="image-20191116164047663"></p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8zz0b347dj31050jswgw.jpg" alt="image-20191116164113192"></p><p>There are some more examples:</p><ul><li><p>(Anomaly Detection) You run a power utility (supplying electricity to customers) and want to monitor your electric plants to see if any one of them might be behaving strangely.</p></li><li><p>(Supervised Learning) You run a power utility and want to predict tomorrowâ€™s expected demand for electricity (so that you can plan to ramp up an appropriate amount of generation capacity).</p></li><li><p>(Anomaly Detection) A computer vision / security application, where you examine video images to see if anyone in your companyâ€™s parking lot is acting in an unusual way.</p></li><li><p>(Supervised Learning) A computer vision application, where you examine an image of a person entering your retail store to determine if the person is male or female.</p></li></ul><h3 id="Choosing-What-Features-to-Use"><a href="#Choosing-What-Features-to-Use" class="headerlink" title="Choosing What Features to Use"></a>Choosing What Features to Use</h3><h4 id="preprocess-non-gaussian-features"><a href="#preprocess-non-gaussian-features" class="headerlink" title="preprocess non-gaussian features"></a>preprocess non-gaussian features</h4><p>We can use <code>hist</code> in octave to plot out the histogram of our data, if we find that it is non-gaussian, we can try to apply a $\log(x+c)$ or $x^{\frac{1}{c}}$ (try different $c$ for a better result) to make it looks more gaussian. For example:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g90vvgj48aj30qs08ijtu.jpg" alt="image-20191117113816740"></p><h4 id="Error-analysis-for-anomaly-detection"><a href="#Error-analysis-for-anomaly-detection" class="headerlink" title="Error analysis for anomaly detection"></a>Error analysis for anomaly detection</h4><p>What we want is:</p><ul><li>$p(x)$ large for normal examples $x$.</li><li>$p(x)$ small for anomalous examples $x$.</li></ul><p>And the most common problem is:</p><blockquote><p>$p(x)$ is comparable (say, both large) for normal and anomalous examples.</p></blockquote><p>Suppose our anomaly detection algorithm is performing poorly and outputs a large value of p(x) for many normal examples and for many anomalous examples in the cross validation dataset, what is most likely to help is to try coming up with more features to distinguish between the normal and the anomalous examples.</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g90wc7yk3gj30m807x40w.jpg" alt="image-20191117115423248"></p><h2 id="Multivariate-Gaussian-distribution"><a href="#Multivariate-Gaussian-distribution" class="headerlink" title="Multivariate Gaussian distribution"></a>Multivariate Gaussian distribution</h2><h3 id="Multivariate-Gaussian-Distribution"><a href="#Multivariate-Gaussian-Distribution" class="headerlink" title="Multivariate Gaussian Distribution"></a>Multivariate Gaussian Distribution</h3><p>What we still want to do is:</p><ul><li>Given $x\in\R^n$.</li><li>Donâ€™t model $p(x_1),p(x_2),\cdots$ separately.</li><li>Model $p(x)$ all in one go.</li></ul><p><em>Multivariate gaussian</em> is able to make it:<br>$$<br>p(x;\mu,\Sigma)=\frac<br>{\exp\left(-\frac{1}{2}(x-\mu)^T\Sigma^{-1}(x-\mu)\right)}<br>{\sqrt{(2\pi)^{n}|\Sigma|}}<br>$$<br>P.s. $|\Sigma| = \det\Sigma $ is the determinant of $\Sigma$ .</p><p>Where we need parameters:</p><ul><li>$\mu\in\R^n$</li><li>$\Sigma\in\R^{n\times n}$ (covariance matrix, <code>Sigma = 1/m * X&#39; * X;</code>)</li></ul><p>Given training set ${x^{(1)},\cdots,x^{(m)}}$, we can fit the parameters:<br>$$<br>\mu=\frac{1}{m}\sum_{i=1}^mx^{(i)} \qquad<br>\Sigma=\frac{1}{m}\sum_{i=1}^m\left(x^{(i)}-\mu\right)\left(x^{(i)}-\mu\right)^T<br>$$</p><p>Here are lots of examples:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g90zj4eo2fj31xy0h37wh.jpg" alt="å±å¹•å¿«ç…§ 2019-11-17 13.39.08 3"></p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g90zjbm1afj31xy0h31kx.jpg" alt="å±å¹•å¿«ç…§ 2019-11-17 13.39.08 2"></p><h3 id="Anomaly-Detection-using-the-Multivariate-Gaussian-Distribution"><a href="#Anomaly-Detection-using-the-Multivariate-Gaussian-Distribution" class="headerlink" title="Anomaly Detection using the Multivariate Gaussian Distribution"></a>Anomaly Detection using the Multivariate Gaussian Distribution</h3><h4 id="Using-the-Multivariate-Gaussian-Distribution"><a href="#Using-the-Multivariate-Gaussian-Distribution" class="headerlink" title="Using the Multivariate Gaussian Distribution"></a>Using the Multivariate Gaussian Distribution</h4><ol><li><p>Fit model $p(x)$ by setting:<br>$$<br>\mu=\frac{1}{m}\sum_{i=1}^mx^{(i)} \qquad<br>\Sigma=\frac{1}{m}\sum_{i=1}^m\left(x^{(i)}-\mu\right)\left(x^{(i)}-\mu\right)^T<br>$$</p></li><li><p>Given a new example $x$, compute:<br>$$<br>p(x)=\frac<br>{\exp\left(-\frac{1}{2}(x-\mu)^T\Sigma^{-1}(x-\mu)\right)}<br>{\sqrt{(2\pi)^{n}|\Sigma|}}<br>$$</p></li><li><p>Flag an anomaly if $p(x)&lt;\epsilon$</p></li></ol><h4 id="Relationship-to-original-model"><a href="#Relationship-to-original-model" class="headerlink" title="Relationship to original model"></a>Relationship to original model</h4><p>Original model: $p(x)=p(x_1;\mu_1,\sigma_1^2)\times p(x_2;\mu_2,\sigma_2^2) \times \cdots \times p(x_n;\mu_n,\sigma_n^2)$</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g92bif84qwj30la05ajtx.jpg" alt="image-20191118172458083"></p><p>As we can see, the contours of the Original model are always <strong>axis aligned</strong>.</p><p> This model actually corresponds to a special case of a multivariate Gaussian distribution $p(x)=\frac{\exp\left(-\frac{1}{2}(x-\mu)^T\Sigma^{-1}(x-\mu)\right)}<br>{\sqrt{(2\pi)^{n}|\Sigma|}}$ where:<br>$$<br>\Sigma=\left[\begin{array}{cccc}<br>\sigma_1^2 \<br> &amp; \sigma_1^2 \<br> &amp; &amp; \ddots \<br> &amp; &amp; &amp; \sigma_n^2<br>\end{array}\right]<br>$$</p><h4 id="Original-model-vs-Multivariate-gaussian"><a href="#Original-model-vs-Multivariate-gaussian" class="headerlink" title="Original model vs. Multivariate gaussian"></a>Original model vs. Multivariate gaussian</h4><p>Original model:</p><ul><li>$p(x)=p(x_1;\mu_1,\sigma_1^2)\times \cdots \times p(x_n;\mu_n,\sigma_n^2)$</li><li>Manually create features to capture anomalies where $x_1,x_2$ take unusual combinations of values. (e.g. $x_3=\frac{x_1}{x_2}$)</li><li>Computationally cheaper (alternatively, scales better to large $n$)</li><li>OK even if $m$ (training set size) is small</li></ul><p>Multivariate gaussian:</p><ul><li>$p(x)=\frac{\exp\left(-\frac{1}{2}(x-\mu)^T\Sigma^{-1}(x-\mu)\right)}<br>{\sqrt{(2\pi)^{n}|\Sigma|}}$</li><li>Automatically captures correlations between features (no need to create a $x_3=\frac{x_1}{x_2}$)</li><li>Computationally more expensive</li><li>Must have $m&gt;n$ &amp; all features are not redundant (need to promise that there are no features that are linearly dependent) or else $\Sigma$ is non-invertible.</li></ul>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> AndrewNg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mac æœ¬åœ°å¿«ç…§å ç”¨ç©ºé—´é—®é¢˜</title>
      <link href="/2019/11/18/blog/mac-localsnapshot-occupy/"/>
      <url>/2019/11/18/blog/mac-localsnapshot-occupy/</url>
      
        <content type="html"><![CDATA[<h1 id="Mac-æœ¬åœ°å¿«ç…§å ç”¨ç©ºé—´é—®é¢˜"><a href="#Mac-æœ¬åœ°å¿«ç…§å ç”¨ç©ºé—´é—®é¢˜" class="headerlink" title="Mac æœ¬åœ°å¿«ç…§å ç”¨ç©ºé—´é—®é¢˜"></a>Mac æœ¬åœ°å¿«ç…§å ç”¨ç©ºé—´é—®é¢˜</h1><h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><blockquote><p>åœ¨ä½¿ç”¨ Mac çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½é‡åˆ°å¦‚ä¸‹é—®é¢˜ï¼š</p></blockquote><p>å½“æˆ‘ä»¬åœ¨ App Store ä¸­ä¸‹è½½ä¸€ä¸ªæ¯”è¾ƒå¤§çš„è½¯ä»¶æ—¶ï¼ˆå¦‚ Xcodeï¼Œ&gt;6GBï¼‰ï¼Œå¼¹å‡ºå¯¹è¯æ¡†æç¤ºè¯´ï¼šâ€œå¯ç”¨çš„ç£ç›˜ç©ºé—´ä¸è¶³ï¼Œæ— æ³•å®‰è£…æ­¤äº§å“â€ã€‚</p><p>è¿™æ—¶ï¼Œæˆ‘ä»¬ç‚¹å‡»èœå•æ å·¦ä¸Šè§’â€ğŸâ€å›¾æ ‡-&gt;â€œå…³äºæœ¬æœºâ€-&gt;â€œå‚¨å­˜ç©ºé—´â€ï¼Œæˆ–æŸ¥çœ‹ Finder(è®¿è¾¾)åº•éƒ¨ï¼Œå‘ç°æ˜¾ç¤ºçš„å¯ç”¨ç©ºé—´è¿˜æœ‰50GBï¼Œæ€ä¹ˆå¯èƒ½â€œç©ºé—´ä¸è¶³å‘¢â€ï¼Ÿ</p><p>å¸¦ç€ç–‘é—®ï¼Œæˆ‘ä»¬åˆå°è¯•ä½¿ç”¨å…¶ä»–æ–¹æ³•æŸ¥çœ‹ç£ç›˜å‰©ä½™ç©ºé—´ï¼šå¦‚æœä½ ç¨å¾®äº†è§£ Unix/Linuxï¼Œæˆ‘æƒ³è¿™æ—¶ä½ çš„ä¸€ä¸ªå¯èƒ½é€‰æ‹©ä¸€å®šä¼šæ˜¯ â€œ<code>$ df -h</code>â€ï¼Œè€Œå¦‚æœä½ å¯¹å‰é¢è¿™å¥è¯ä¸ç”šäº†è§£æˆ–ä¸€æ— æ‰€çŸ¥å¯¹è¯ï¼Œä½ å¯ä»¥æ‰“å¼€ macOS ç³»ç»Ÿè‡ªå¸¦çš„â€œ<strong>ç£ç›˜å·¥å…·</strong>â€ã€‚</p><p>é€šè¿‡å‰è€…çš„åšæ³•ä½ å¯èƒ½çœ‹åˆ°ç±»ä¼¼ä¸‹é¢è¿™æ ·çš„ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[Foo@Bar-MacBook:] 00:00  ~ !502 $ df -h</span><br><span class="line">Filesystem      Size   Used  Avail Capacity iused               ifree %iused  Mounted on</span><br><span class="line">&#x2F;dev&#x2F;disk1s1   113Gi   96Gi   13Gi    84% 1225588 9223372036853550219    0%   &#x2F;</span><br><span class="line">devfs          331Ki  331Ki    0Bi   100%    1146                   0  100%   &#x2F;dev</span><br><span class="line">&#x2F;dev&#x2F;disk1s4   113Gi  3.0Gi   13Gi     9%       3 9223372036854775804    0%   &#x2F;private&#x2F;var&#x2F;vm</span><br><span class="line">map -hosts       0Bi    0Bi    0Bi   100%       0                   0  100%   &#x2F;net</span><br><span class="line">map auto_home    0Bi    0Bi    0Bi   100%       0                   0  100%   &#x2F;home</span><br></pre></td></tr></table></figure><p>ä¸ç”¨è§£é‡Šï¼ˆå¦‚æœä½ çœŸçš„æ˜¯æˆ‘è¯´çš„å‰è€…ï¼Œå¦åˆ™ï¼Œè¯·çœ‹ä¸‹ä¸€æ®µï¼‰ï¼Œä½ åƒæƒŠåœ°å‘ç°ç³»ç»Ÿå¯ç”¨ç©ºé—´åªæœ‰13GBäº†ğŸ˜±ï¼</p><p>è€Œåœ¨â€œ<strong>ç£ç›˜å·¥å…·</strong>â€ä¸­ä½ å¯ä»¥çœ‹è§å›¾æ¡å±•ç¤ºçš„å¯ç”¨â€œå®é™…å¯ç”¨â€åªæœ‰13.34Gï¼Œä¸‹é¢è¿˜å†™æœ‰ä¸€æ¡â€å¯ç”¨: 50GBï¼ˆ36.66GB<em>å¯æ¸…é™¤</em>ï¼‰â€ã€‚ğŸ¤”</p><p>â€œå¯æ¸…é™¤â€? ä»€ä¹ˆæ„æ€? æ€ä¹ˆæ¸…é™¤? åˆ°å¤´æ¥è¿˜æ˜¯ä¸èƒ½ç”¨å˜›ï¼</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><blockquote><p>æˆ‘çŸ¥é“ä½ æ€¥äºè§£å†³é—®é¢˜ï¼Œè€Œä¸æ˜¯çœ‹æˆ‘å†™é—®é¢˜åˆ†æçš„è¿‡ç¨‹ï¼Œæ‰€ä»¥ï¼Œå…ˆè´´å‡ºè§£å†³æ–¹æ¡ˆã€‚è‹¥æœ‰å…´è¶£ï¼Œå†è¯·ä¸€ç¥æœ€åçš„é—®é¢˜åˆ†æã€‚</p></blockquote><ol><li>æ‰“å¼€ç»ˆç«¯ï¼ˆå¦‚æœä¸çŸ¥é“å¯ä»¥ <code>command+ç©ºæ ¼</code> èšç„¦æœç´¢ â€œç»ˆç«¯.appâ€ï¼‰ï¼Œè¾“å…¥å¦‚ä¸‹æŒ‡ä»¤ï¼Œå›è½¦:</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmutil listlocalsnapshotdates</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œä½ ä¼šçœ‹åˆ°è¾“å‡ºè¿™æ ·çš„ä¸œè¥¿:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Snapshot dates for all disks:</span><br><span class="line">2066-06-05-223724</span><br><span class="line">2066-06-05-230056</span><br><span class="line">2066-06-06-053724</span><br><span class="line">2066-06-06-060056</span><br></pre></td></tr></table></figure><ol start="2"><li>ç„¶åï¼Œå†åˆ†åˆ«é”®å…¥æŒ‡ä»¤ <code>tmutil deletelocalsnapshots &lt;snapshot_date&gt;</code>ï¼ŒæŠŠé‡Œé¢çš„ â€<code>&lt;snapshot_date&gt;</code>â€œ æ¢æˆä½ åœ¨ä¸Šé¢çœ‹åˆ°çš„æŸä¸€è¡Œæ—¥æœŸï¼Œå›è½¦åç¨ç­‰ï¼Œçœ‹åˆ°:</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Deleted local snapshot &#39;2066-06-05-223724&#39;</span><br></pre></td></tr></table></figure><p>å—¯ï¼Œåˆ äº†ä¸€ä¸ªæŸç§ä¸œè¥¿ï¼Œä¸ç®¡ä»–æ˜¯ä»€ä¹ˆï¼Œåæ­£å¯ç”¨å¯ç”¨ç£ç›˜ç©ºé—´ä¼šå¢å¤§å§ï¼Œæ•…å¦‚æ³•ç‚®åˆ¶ï¼Œç»§ç»­<code>tmutil deletelocalsnapshots</code> å¹²æ‰åˆšæ‰ <code>tmutil listlocalsnapshotdates</code> å‡ºæ¥çš„æ‰€æœ‰æ—¥æœŸã€‚</p><ol start="3"><li><p>å®Œæˆåï¼Œç¨ç­‰å‡ åˆ†é’Ÿï¼Œå† <code>df -h</code> æˆ–æ‰“å¼€â€ç£ç›˜å·¥å…·â€ï¼Œä½ ä¼šå‘ç°ï¼Œå®é™…å¯ç”¨ç©ºé—´å¤§äº†å‡ åGï¼Œä¹‹å‰çš„å¯æ¸…é™¤ï¼Œè¢«æˆ‘ä»¬æ¸…é™¤äº†ğŸ˜Šï¼</p></li><li><p>è¿™æ—¶å†å°è¯•å®‰è£…ä¹‹å‰çš„è½¯ä»¶å°±å¯ä»¥æˆåŠŸäº†ã€‚</p></li></ol><p>é—®é¢˜è§£å†³ğŸ’ªï¼</p><p>P.S. å‚è€ƒâ€æ–‡æœ¬å¼æˆªå›¾â€ğŸ˜œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[foo@His-MacBook:] 06:06  ~ !501 $ tmutil listlocalsnapshotdates</span><br><span class="line">Snapshot dates for all disks:</span><br><span class="line">2066-06-20-133724</span><br><span class="line">2066-06-20-140056</span><br><span class="line">[foo@His-MacBook:] 06:06  ~ !502 $ tmutil deletelocalsnapshots 2066-06-20-133724</span><br><span class="line">Deleted local snapshot &#39;2066-06-20-133724&#39;</span><br><span class="line">[foo@His-MacBook:] 06:06  ~ !503 $</span><br></pre></td></tr></table></figure><p>ã€æ³¨ã€‘æˆ‘ä¹Ÿç»å†è¿‡åœ¨ä¸Šè¿°æ“ä½œåå®Œå…¨æ²¡è§£å†³é—®é¢˜çš„æƒ…å†µã€‚è€Œåœ¨æˆ‘åšå®Œä¸Šè¿°æ‰€æœ‰æ“ä½œå¹¶ä¸”é‡å¯ï¼Œå†é‡å¤ä¸€éè¿™äº›æ“ä½œåï¼ŒIt works.</p><h2 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h2><p>å¥½çš„ï¼Œé—®é¢˜è§£å†³äº†ï¼Œä½†ä¸ºä»€ä¹ˆå¯ä»¥è¿™æ ·æ“ä½œå‘¢ï¼Ÿç­”æ¡ˆå°±è—åœ¨æˆ‘ä»¬è§£å†³çš„åŠæ³•é‡Œã€‚</p><p>é¦–å…ˆï¼Œâ€œ<code>tmutil</code>â€ æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œé€šè¿‡ <code>$ whatis tmutil</code>ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå®ƒçš„å­¦åå«åšâ€œæ—¶é—´æœºå™¨å®ç”¨å·¥å…·ï¼ˆTime Machine utilityï¼‰â€ï¼Œåˆé€šè¿‡ <code>$ man tmutil</code>ï¼Œæˆ‘ä»¬ä¼šæ˜ç™½ï¼Œæˆ‘ä»¬åˆšæ‰æ˜¯åˆ—å‡º(listlocalsnapshotdates)å¹¶é€ä¸ªåˆ é™¤(deletelocalsnapshots)äº†ç£ç›˜ä¸­å‚¨å­˜çš„â€œ<strong>æ—¶é—´æœºå™¨æœ¬åœ°å¿«ç…§</strong>ï¼ˆlocal Time Machine snapshotsï¼‰â€ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬çŸ¥é“äº†å ç”¨æˆ‘ä»¬â€å¯æ¸…é™¤â€çš„ç£ç›˜ç©ºé—´ã€è¿˜é€é¥â€œè®¿è¾¾â€å¤–ã€ä¸ä¸ºâ€å…³äºæœ¬æœºâ€œæ‰€çŸ¥çš„çœŸå‡¶æ˜¯è°äº†â€”â€”â€”â€”ä¸‡æ¶çš„â€œ<em>æœ¬åœ°å¿«ç…§</em>â€ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ‰“ç®—äººè‚‰æœç´¢ï¼Œæ­å¼€å®ƒä¸‘é™‹çš„å¤–è¡£ï¼</p><p>å¤§è‚† Google åï¼Œæˆ‘ä»¬åœ¨ Apple å®˜ç½‘æ‰¾åˆ°äº†ä¸€ç¯‡åä¸º â€œ<a href="https://support.apple.com/zh-cn/HT204015">å…³äºâ€œæ—¶é—´æœºå™¨â€æœ¬åœ°å¿«ç…§</a>â€ çš„æ–‡ç« ï¼Œé‡Œé¢æœ‰è®°è½½ï¼š</p><blockquote><p>æ‚¨çš„â€œæ—¶é—´æœºå™¨â€å¤‡ä»½ç£ç›˜æœ‰æ—¶å¯èƒ½ä¸å¯ç”¨ï¼Œå› æ­¤â€œæ—¶é—´æœºå™¨â€è¿˜ä¼šå°†æŸäº›å¤‡ä»½å‚¨å­˜åœ¨æ‚¨çš„ Mac ä¸Šã€‚è¿™äº›å¤‡ä»½ç§°ä½œæœ¬åœ°å¿«ç…§ã€‚<br>æ‚¨æ— éœ€è€ƒè™‘æœ¬åœ°å¿«ç…§æ‰€å ç”¨çš„å‚¨å­˜ç©ºé—´å¤§å°ï¼Œå› ä¸ºå®ƒä»¬ä¸ä¼šå ç”¨è¯¸å¦‚ä¸‹è½½æ–‡ä»¶ã€æ‹·è´æ–‡ä»¶æˆ–å®‰è£…æ–°è½¯ä»¶ç­‰ä»»åŠ¡æ‰€éœ€çš„ç©ºé—´ã€‚<br>æ‚¨çš„ Mac å°†å¿«ç…§å ç”¨çš„ç©ºé—´è®¡ä¸ºå¯ç”¨å‚¨å­˜ç©ºé—´ã€‚å³ä¾¿å¦‚æ­¤ï¼Œâ€œæ—¶é—´æœºå™¨â€åªä¼šå°†å¿«ç…§å‚¨å­˜åœ¨å…·æœ‰å¤§é‡å¯ç”¨ç©ºé—´çš„ç£ç›˜ä¸Šï¼Œå¹¶ä¸”ä¼šåœ¨å¿«ç…§è¿‡æ—§æˆ–å…¶ä»–å†…å®¹éœ€è¦ç©ºé—´æ—¶è‡ªåŠ¨åˆ é™¤ç›¸åº”çš„å¿«ç…§ã€‚</p></blockquote><p>emmmï¼Œè¿™å°±å¯ä»¥è§£é‡Šé—®é¢˜äº†ã€‚è¿™ä¸ªè‡ªåŠ¨çš„å¿«ç…§æœ¬æ¥æ˜¯ä¸åº”è¯¥å½±å“æˆ‘ä»¬ä¸‹è½½å®‰è£…è½¯ä»¶çš„ï¼Œä½†å¯èƒ½å®ƒæœ‰ç‚¹æŠ½ä¸å¬ç³»ç»Ÿä½¿å”¤äº†ã€‚</p><p>æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆæ˜¯æ‰‹åŠ¨åˆ é™¤äº†é‚£äº›å¿«ç…§ï¼Œå½“ç„¶ï¼Œè¯»å®Œäº† Apple çš„æ–‡æ¡£ï¼Œæˆ‘ä»¬çŸ¥é“ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®â€å–æ¶ˆé€‰æ‹©â€™è‡ªåŠ¨å¤‡ä»½â€˜â€æ¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœã€‚<strong>ä½†ï¼æ˜¯ï¼</strong>ï¼Œè¿™äº›å¿«ç…§å¹³æ—¶æ„Ÿè§‰ç”¨å¤„å¹¶ä¸å¤§ï¼Œä½†å¶å°”æˆ–è®¸è¿˜çœŸæœ‰å¤§ç”¨ï¼ˆå¤‡ä»½è¿™ç§ä¸œè¥¿å°±åƒä¿é™©ä¸€æ ·ï¼Œå¸Œæœ›ä¸€è¾ˆå­éƒ½ç”¨ä¸åˆ°ï¼Œä½†è¯¥ä¹°çš„è¿˜æ˜¯åº”è¯¥ä¹°ï¼‰ï¼Œæ‰€ä»¥ Apple å’Œæˆ‘ä»¬éƒ½å¹¶ä¸æ¨èå–æ¶ˆè¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬åªè¦åœ¨ä¸æ—¶ä¹‹éœ€åˆ°æ¥æ—¶ï¼Œæ‡‚å¾—å¦‚ä½•æ‰‹åŠ¨é‡Šæ”¾ä¸€äº›ç©ºé—´å°±å¥½äº†ã€‚</p><p>Thatâ€™s it.ğŸ˜‰</p>]]></content>
      
      
      
        <tags>
            
            <tag> Mac </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç»´æ•°çº¦å‡</title>
      <link href="/2019/11/13/AndrewNgML/AndrewNg-MachineLearning-14-DimensionalityReduction/"/>
      <url>/2019/11/13/AndrewNgML/AndrewNg-MachineLearning-14-DimensionalityReduction/</url>
      
        <content type="html"><![CDATA[<h1 id="Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-14-Dimensionality-Reduction"><a href="#Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-14-Dimensionality-Reduction" class="headerlink" title="Notes of Andrew Ngâ€™s Machine Learning â€”â€” (14) Dimensionality Reduction"></a>Notes of Andrew Ngâ€™s Machine Learning â€”â€” (14) Dimensionality Reduction</h1><h2 id="Motivation"><a href="#Motivation" class="headerlink" title="Motivation"></a>Motivation</h2><h3 id="Data-Compression"><a href="#Data-Compression" class="headerlink" title="Data Compression"></a>Data Compression</h3><p><em>Dimensionality reduction</em> is another type of unsupervised learning problem.</p><p>There are a couple of different reasons why one might want to do dimensionality reduction. One is <strong>data compression</strong> which  not only allows us to compress the data and have it therefore use up less computer memory or disk space, but it will also allow us to speed up our learning algorithms.</p><p>What we will do in data compression is reduce data from a high dimensionality to a lower one.</p><p>For example:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8pbajmgl3j30mt0byq68.jpg" alt="image-20191107112251112"></p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8pbaeml8oj30p30brgt7.jpg" alt="å±å¹•å¿«ç…§ 2019-11-07 11.24.44"></p><p>As we see, to make dimensionality reduce, intuitionally , we projects the high-D on a lower-D.</p><p>In the more typical example of dimensionality reduction we might have a thousand dimensional data that we might want to reduce to letâ€™s say a hundred dimensional.</p><p>Generally, suppose we apply <code>dimensionality reduction</code> to a dataset of $m$ examples ${x^{(1)},x^{(2)},\cdots,x^{(m)}}$, where $x^{(i)}\in\R^n$. As a result of this, we will get out a lower dimensional dataset ${z^{(1)},z^{(2)},\cdots,z^{(m)}}$ of $m$ examples where $z^{(i)}\in\R^k$ for some value of $k$ and $k\le n$.</p><h3 id="Data-Visualization"><a href="#Data-Visualization" class="headerlink" title="Data Visualization"></a>Data Visualization</h3><p>We can also utilize dimensionality reduction for data visualization.</p><p>For a lot of machine learning applications, it really helps us to develop effective learning algorithms, if we can understand our data better. And visualizing the data is a useful in this.</p><p>Letâ€™s say we have collected a large data set, which means we have a set of $x^{(i)}\in\R^n$ where $n$ is very large, and we can hardly visualize it because, you know, actually we can only draw a plot in or less than 3 dimension. In this case, what we need to do is dimensionality reduction.</p><p>For example, weâ€™ve collected a large data set of many statistics about different countries. we may have a huge data set like this:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8pd8wo33nj30po0dbn3e.jpg" alt="å±å¹•å¿«ç…§ 2019-11-07 12.32.30"></p><p>To visualize this data, what we can do is reduce the dimensionality from 50-D to 2-D, and then we can plot a 2-D plot to understand our data better.</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8pdanhskoj30nq0c0did.jpg" alt="å±å¹•å¿«ç…§ 2019-11-07 12.31.49"></p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8pde507hrj30ox0bhdiw.jpg" alt="image-20191107123745407"></p><p>To wrap up, suppose you have a dataset ${x^{(1)},x^{(2)},\cdots,x^{(m)}}$ where $x^{(i)}\in\R^n$. In order to visualize it, we apply dimensionality reduction and get ${z^{(1)},z^{(2)},\cdots,z^{(m)}}$ where $z^{(i)}\in\R^k$. And we usual make $k = 2$ or $k = 3$ (since we can plot 2D or 3D data but donâ€™t have ways to visualize higher dimensional data).</p><h2 id="Principal-Component-Analysis"><a href="#Principal-Component-Analysis" class="headerlink" title="Principal Component Analysis"></a>Principal Component Analysis</h2><p>For the problem of dimensionality reduction, the most commonly used algorithm is something called <em>principal component analysis</em> (PCA).</p><h4 id="PCA-problem-formulation"><a href="#PCA-problem-formulation" class="headerlink" title="PCA problem formulation"></a>PCA problem formulation</h4><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8pksu0z5nj30nu07mn1t.jpg" alt="image-20191107165349198"></p><ul><li><p>Reduce form 2-dimension to 1-dimension: </p><p>Find a direction (a vector $u^{(1)}\in\R^n$) onto which to project the data so as to minimize the projection error.</p></li><li><p>Reduce form n-dimension to k-dimension:</p><p>Find $k$ vectors $u^{(1)},u^{(2)},\cdots,u^{(k)}$ onto which to project the data, so as to minimize the projection error.</p></li></ul><p>Notice that PCA is not linear regression! In the linear regression, we minimize the vertical length  between the data point and our hypothesis line, while in the PCA, we minimize the distance between the data point and its projected point:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8plgct2i6j31iy0oywjp.jpg" alt="image-20191107171638816"></p><h4 id="PCA-Algorithm"><a href="#PCA-Algorithm" class="headerlink" title="PCA Algorithm"></a>PCA Algorithm</h4><h5 id="Data-preprocessing"><a href="#Data-preprocessing" class="headerlink" title="Data preprocessing"></a>Data preprocessing</h5><p>Training set: $x^{(1)},x^{(2)},\cdots,x^{(m)}$</p><p>Preprocessing (feature scaling &amp; mean normalization):</p><ul><li><p>$$<br>\mu_j=\frac{1}{m}\sum_{i=1}^m x_j^{(i)},\qquad s_j=\textrm{standard deviation of feature $j$}<br>$$</p></li><li><p>Replace each $x_j^{(i)}$ with $\frac{x_j-\mu_j}{s_j}$</p></li></ul><h5 id="Reduce-data-from-n-dimensions-to-k-dimensions"><a href="#Reduce-data-from-n-dimensions-to-k-dimensions" class="headerlink" title="Reduce data from $n$-dimensions to $k$-dimensions"></a>Reduce data from $n$-dimensions to $k$-dimensions</h5><ol><li><p>Compute <code>convariance matrix</code> (notated a big Sigma, notice that itâ€™s different from a sum notation):<br>$$<br>\Sigma = \frac{1}{m}\sum_{i=1}^n(x^{(i)})(x^{(i)})^T<br>$$</p></li><li><p>Compute <code>eigenvectors</code> of matrix $\Sigma$:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[U, S, V] &#x3D; svd(Sigma);</span><br></pre></td></tr></table></figure></li><li><p>Get from <code>svd</code>:<br>$$<br>U = \left[\begin{array}{cccc}<br>| &amp; | &amp;  &amp; |\<br>u^{(1)} &amp; u^{(2)} &amp; \cdots &amp; u^{(n)}\<br>| &amp; | &amp;  &amp; |<br>\end{array}\right]<br>\in \R^{n\times n}<br>\Rightarrow<br>U_{reduce}=\left[\begin{array}{cccc}<br>| &amp; | &amp;  &amp; |\<br>u^{(1)} &amp; u^{(2)} &amp; \cdots &amp; u^{(k)}\<br>| &amp; | &amp;  &amp; |<br>\end{array}\right]<br>$$</p></li><li><p>Make $x\in\R^n\to z\in\R^k$:<br>$$<br>z = U_{reduce}^Tx<br>=\left[\begin{array}{ccc}<br>â€“ &amp; (u^{(1)})^T &amp; â€“\<br> &amp; \vdots &amp; \<br>â€“ &amp; (u^{(k)})^T &amp; â€“\<br>\end{array}\right]x<br>$$</p></li></ol><p>This does do the right thing of minimizing this square projection error although the  mathematical proof of that is beyond the scope of this course.</p><p>Summary:</p><p>After mean normalization (ensure every feature has zero mean) and optionally feature scaling:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Sigma &#x3D; 1&#x2F;m * X&#39; * X;</span><br><span class="line">[U, S, V] &#x3D; svd(Sigma);</span><br><span class="line"></span><br><span class="line">Ureduce &#x3D; U(:, 1:K);</span><br><span class="line">Z &#x3D; X * Ureduce;</span><br></pre></td></tr></table></figure><h2 id="Applying-PCA"><a href="#Applying-PCA" class="headerlink" title="Applying PCA"></a>Applying PCA</h2><h3 id="Reconstruction-from-Compressed-Representation"><a href="#Reconstruction-from-Compressed-Representation" class="headerlink" title="Reconstruction from Compressed Representation"></a>Reconstruction from Compressed Representation</h3><p>With PCA, we compressed data from n-dimension to a lower k-dimension. There should be a way to go back from the compressed representation to an approximation of our original high-dimensional data. We call this way <em>reconstruction</em>.</p><p>Recall that our PCA is working as $z= U_{reduce}^Tx$.</p><p>To reconstruction, what we will do is:<br>$$<br>x_{approx}=U_{reduce}z<br>$$<br>It makes $z\in\R^k \to x_{approx}\in\R^n$. The $x_{approx}$ will be close to $x$, but we can hardly expect $x=x_{approx}$.</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8ta88gafkj30oz0djaeo.jpg" alt="image-20191110215011122"></p><p>Previously, we said that PCA chooses a direction $u^{(1)},\cdots,u^{(k)}$ onto which to project the data so as to minimize the (squared) projection error. With our new defined $x_{approx}$, another way to say the same is that PCA tries to minimize:<br>$$<br>\frac{1}{m}\sum_{i=1}^{m}||x^{(i)}-x_{approx}^{(i)}||^2<br>$$</p><h3 id="Choosing-the-k-number-of-principal-components"><a href="#Choosing-the-k-number-of-principal-components" class="headerlink" title="Choosing the $k$ (number of principal components)"></a>Choosing the $k$ (number of principal components)</h3><p>About PCA, we can see:</p><ul><li>Average squared projection error: $\frac{1}{m}\sum_{i=1}^m||x^{(i)}-x_{approx}^{(i)}||^2$</li><li>Total variation in the data: $\frac{1}{m}\sum_{i=1}^{m}||x^{(i)}||^2$</li></ul><p>Typically, choose $k$ to be smallest value so that:<br>$$<br>\frac{\frac{1}{m}\sum_{i=1}^m||x^{(i)}-x_{approx}^{(i)}||^2}{\frac{1}{m}\sum_{i=1}^{m}||x^{(i)}||^2}\le0.01<br>$$<br>We call it â€œ99% of variance is retainedâ€.</p><p>We can also choose other numbers instead of the usual $0.01$, in practice, $0.01\sim0.05$ is all capable.</p><p>The algorithm utilized for $k$ choosing is that:</p><blockquote><p>Try PCA with $k=1,\cdots,n$:</p><p>Compute $U_{reduce},z^{(1)},\cdots,z^{(m)},x_{approx}^{(1)},\cdots,x_{approx}^{m}$;</p><p>Check if $\frac{\frac{1}{m}\sum_{i=1}^m||x^{(i)}-x_{approx}^{(i)}||^2}{\frac{1}{m}\sum_{i=1}^{m}||x^{(i)}||^2}\le0.01$?</p></blockquote><p>In octave, we can implement it as:</p><ol><li><p><code>[U, S, V] = svd(Sigma)</code>, after running we can get a <code>S</code> that is useful here:</p></li><li><p>Pick smallest value of $k$ for which (99% of variance retained for example)<br>$$<br>\frac{\sum_{i=1}^k S_{ii}}{\sum_{i=1}^m S_{ii}}\ge0.99<br>$$</p></li></ol><h3 id="Advice-for-Applying-PCA"><a href="#Advice-for-Applying-PCA" class="headerlink" title="Advice for Applying PCA"></a>Advice for Applying PCA</h3><h4 id="Supervised-Learning-speedup"><a href="#Supervised-Learning-speedup" class="headerlink" title="Supervised Learning speedup"></a>Supervised Learning speedup</h4><p>In supervised learning, we have data like this:<br>$$<br>(x^{(1)},y^{(1)}),(x^{(2)},y^{(2)}),\cdots,(x^{(m)},y^{(m)})<br>$$<br>We can <strong>extract inputs</strong> by:</p><ul><li>Unlabled dataset: $x^{(1)},x^{(2)},\cdots,x^{(m)}\in \R^n$</li><li>Applying PCA: $z^{(1)},z^{(2)},\cdots,z^{(m)}\in \R^k$, where $k$ is lower than $n$</li></ul><p>Then we get <strong>new training set</strong>:<br>$$<br>(z^{(1)},y^{(1)}),(z^{(2)},y^{(2)}),\cdots,(z^{(m)},y^{(m)})<br>$$<br>Note: Mapping $x^{(i)}\to z^{(i)}$ should be defined by running PCA only on the <strong>training set</strong> . This mapping can be applied as well to the examples $x_{cv}^{(i)}$ and $x_{test}^{(i)}$ in the cross validation and test sets.</p><h4 id="Application-of-PCA"><a href="#Application-of-PCA" class="headerlink" title="Application of PCA"></a>Application of PCA</h4><ul><li><p>Compression</p><ul><li>Reduce memory/disk needed to store data</li><li>Speed up learning algorithm</li></ul><p>In this case, we should choose $k$ by <code>% of  variance retained</code>.</p></li><li><p>Visualization</p><p>In this case, $k=2$ or $k=3$</p></li></ul><h4 id="Bad-use-of-PCA-To-prevent-overfitting"><a href="#Bad-use-of-PCA-To-prevent-overfitting" class="headerlink" title="Bad use of PCA: To prevent overfitting"></a>Bad use of PCA: To prevent overfitting</h4><blockquote><p>Use $z^{(i)}$ instead of $x^{(i)}$ to reduce the number of features to $k&lt;n$.</p><p>Thus, fewer features, less likely to overfit.</p></blockquote><p>ğŸ‘† This is a BAD use of PCA.</p><p>This might work OK, but isnâ€™t a good way to address overfitting. Use regularization instead:</p><p>$$<br>\min_\theta\frac{1}{2m}\sum_{i=1}^m(h_\theta(x^{(i)})-y^{(i)})^2+\frac{\lambda}{2m}\sum_{j=1}^{n}\theta_j^2<br>$$</p><h4 id="PCA-or-not"><a href="#PCA-or-not" class="headerlink" title="PCA or not"></a>PCA or not</h4><p>PCA is sometimes used where it shouldnâ€™t be, here is an example:</p><p>When designing a ML system, we wrote down this steps:</p><ol><li>Get training set ${(x^{(1)},y^{(1)}),\cdots,(x^{(m)},y^{(m)})}$</li><li>Run PCA to reduce $x^{(i)}$ in dimension to get $z^{i}$</li><li>Train logistic regression on ${(z^{(1)},y^{(1)}),\cdots,(z^{(m)},y^{(m)})}$</li><li>Test on test set: Map $x_{test}^{(i)}$ to $z_{test}^{(i)}$. Run $h_\theta(z)$ on ${(z_{test}^{(1)},y^{(1)}),\cdots,(z_{test}^{(m)},y^{(m)})}$</li></ol><p>But before doing this, we should think: How about the whole thing without using PCA?</p><p>Before implementing PCA, first try running whatever you want to do with the original/raw data $x^{(i)}$. Only if that doesnâ€™t do what you want, then implement PCA and consider using $z^{(i)}$.</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> AndrewNg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ— ç›‘ç£å­¦ä¹ </title>
      <link href="/2019/11/07/AndrewNgML/AndrewNg-MachineLearning-13-UnsupervisedLearning/"/>
      <url>/2019/11/07/AndrewNgML/AndrewNg-MachineLearning-13-UnsupervisedLearning/</url>
      
        <content type="html"><![CDATA[<h1 id="Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-13-Unsupervised-Learning"><a href="#Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-13-Unsupervised-Learning" class="headerlink" title="Notes of Andrew Ngâ€™s Machine Learning â€”â€” (13) Unsupervised Learning"></a>Notes of Andrew Ngâ€™s Machine Learning â€”â€” (13) Unsupervised Learning</h1><h2 id="Clustering"><a href="#Clustering" class="headerlink" title="Clustering"></a>Clustering</h2><h3 id="Unsupervised-Learning-Introduction"><a href="#Unsupervised-Learning-Introduction" class="headerlink" title="Unsupervised Learning: Introduction"></a>Unsupervised Learning: Introduction</h3><p>In supervised learning, we are given a set of labeled training set ( ($(x,y)$ given)) to fit a hypothesis to it:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8n5s7zmffj30lv0ca40u.jpg" alt="image-20191105144318970"></p><p>In contrast, in the unsupervised learning problems, we are given data that does not have any labels associated with it ($x$ only, no $y$):</p><p> <img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8n62mi54pj30lw0catay.jpg" alt="å±å¹•å¿«ç…§ 2019-11-05 14.49.05"></p><p>The slide above shows that hereâ€™s a set of points add in no labels. So, in unsupervised learning what we do is we give this sort of unlabeled training set to an algorithm and we just ask the algorithm find some structure in the data for us. </p><p>Given this data set one type of structure we might have an algorithm find is that it looks like this data set has points grouped into two separate clusters (drawn in green) and so an algorithm that finds <strong>clusters</strong> like the ones Iâ€™ve just circled is called a <em>clustering algorithm</em>.</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8n6ap2y9bj30lq0d7135.jpg" alt="image-20191105150106356"></p><h3 id="K-Means-Algorithm"><a href="#K-Means-Algorithm" class="headerlink" title="K-Means Algorithm"></a>K-Means Algorithm</h3><blockquote><p>In the clustering problem we are given an unlabeled data set and we would like to have an algorithm automatically group the data into coherent subsets or into coherent clusters for us.</p></blockquote><p>The <em>K-Means Algorithm</em> is  by far the most popular and widely used clustering algorithm.</p><p>Given an unlabeled data set to group (cluster) them into K (letâ€™s say two, for example) clusters, what the <code>K-Means Algorithm</code> do is:</p><ol><li>Randomly initialize two points, called the cluster centroids.</li><li>Cluster assignment step: going through each of the examples, for each of data dots depending on which cluster centroid itâ€™s closer to, one point is going to be assigned to one of the K cluster centroids (color them into the same color, illustratingly).</li><li>Move centroid step:  take the K cluster centroids, and we are going to move them to the average of the points colored the same colour.</li></ol><p>We keep on move centroid then redo a cluster assignment. Doing this looply until the cluster centroids not change any further (i.e. the K-Means has converged). And, itâ€™s done a good job finding the clusters in the data.</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8n8yx2xiwg30hy0cadi8.gif" alt="1572942743912"></p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8n98yihsoj30us0c8go8.jpg" alt="å±å¹•å¿«ç…§ 2019-11-05 16.23.33"></p><h4 id="K-means-algoithm"><a href="#K-means-algoithm" class="headerlink" title="K-means algoithm"></a>K-means algoithm</h4><p>Input: </p><ul><li><p>$K$ (number of clusters)</p></li><li><p>${x^{(1)},x^{(2)},\cdots,x^{(m)}}$ (training set)</p><p>$x^{(i)}\in\R^n$ (drop $x_0=1$ convention)</p></li></ul><p>Output:</p><ul><li>$K$ subsets</li></ul><p>Algorithm:<br>$$<br>\begin{array}{l}</p><p>\textrm{Randomly initialize $K$ cluster centroids $\mu_1, \mu_2,â€¦\mu_k \in \R^n$}\<br>\textrm{Repeat }{\<br>\qquad \textrm{for $i=1$ to $m$:}\qquad\textrm{// Cluster assignment step}\<br>\qquad\qquad c^{(i)} := k \ \textrm{ s.t. } \min_k||x^{(i)}-\mu_k||^2 \<br>\qquad\qquad \textrm{/* set $ c^{(i)}$ the index (from $1$ to $K$) of cluster centroid closest to $x^{(i)}$ */}\<br>\qquad \textrm{for $k=1$ to $K$:}\qquad\textrm{// Move centroid step}\<br>\qquad\qquad \textrm{if cluster centroid $\mu_i$ has 0 points assigned to it}:\<br>\qquad\qquad\qquad \textrm{eliminate that cluster centroid, continue}\<br>\qquad\qquad\qquad \textrm{// end up with $K-1$ clusters}\<br>\qquad\qquad \mu_k:= \textrm{average (mean) of points assigned to cluster $k$}\<br>}\</p><p>\end{array}<br>$$</p><h4 id="K-Means-for-non-separated-clusters"><a href="#K-Means-for-non-separated-clusters" class="headerlink" title="K-Means for non-separated clusters"></a>K-Means for non-separated clusters</h4><p>K-Means can do well in both well-separated cluster and non-separated clusters:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8n930vsnrj30mv09swhe.jpg" alt="image-20191105163643613"></p><h3 id="K-means-Optimization-Objective"><a href="#K-means-Optimization-Objective" class="headerlink" title="K-means Optimization Objective"></a>K-means Optimization Objective</h3><p>Notations:</p><ul><li>$c^{(i)}$ = index of cluster ($1,2,\cdots,K$) to which example $x^{(i)}$ is currently assigned.</li><li>$\mu_k$ = cluster centroid $k$ ($\mu_k\in\R^n$).</li><li>$\mu_{c^{(i)}}$ = cluster centroid of cluster to which example $x^{(i)}$ has been assigned.</li></ul><p>For example, letâ€™s say we have a $x^{(1)}$ that is currently assigned to cluster $5$, so in this case, our $c^{(1)}=5$ and $\mu_{c^{(1)}}=\mu_5$, where cluster centroid of cluster $5$ is notated as $\mu_5$. </p><p>Optimization objective:<br>$$<br>J(c^{(1)},\cdots,c^{(m)},\mu_1,\cdots,\mu_K)=\frac{1}{m}\sum_{i=1}^{m}||x^{(i)}-\mu_{c^{(i)}}||^2<br>$$</p><p>$$<br>\min_{<br>\begin{array}<br>    {1}c^{(1)},\cdots,c^{(m)},\<br>    \mu_1,\cdots,\mu_K<br>\end{array}}<br>J(c^{(1)},\cdots,c^{(m)},\mu_1,\cdots,\mu_K)<br>$$</p><p>Our cost function $J$  is also called <strong>distortion</strong>.</p><p>In the K-means algorithm, what it doing in our cluster assignment step is minimize $J$ wit $c^{(1)},\cdots,c^{(m)}$ (holding $\mu_1,\cdots,\mu_k$ fixed), and the move centroid step is minimizing the $J$ wit $\mu_1,â€¦,\mu_k$.</p><h3 id="Random-initialization"><a href="#Random-initialization" class="headerlink" title="Random initialization"></a>Random initialization</h3><p>There is a way to random initialization our $K$ cluster centroids:</p><ol><li>Should have $K&lt;m$</li><li>Randomly pick $K$ training examples.</li><li>Set $\mu_1,\cdots,\mu_k$ equal to these $K$ examples.</li></ol><p>i.e. we pick $k$ distinct random integers $i_1,\cdots,i_k$ from ${1,\cdots,m}$, set $\mu_1=x^{(i_1)},\mu_2=x^{(i_2)},\cdots,\mu_k=x^{(i_k)}$.</p><h4 id="Local-optima"><a href="#Local-optima" class="headerlink" title="Local optima"></a>Local optima</h4><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8oe2i8gz8j30oo0d8tb5.jpg" alt="image-20191106161508966"></p><p>Beacuse of the random initialization, we sometimes get a good cluster (get a <em>global optima</em>, like the one at the right top of the picture) and we may also get a bad one (get a <em>local optima</em>, like the two at the right bottom of the picture).</p><p>To avoid the K-means algorithm stop at a loacal optima, we can try this:<br>$$<br>\begin{array}{l}<br>\textrm{For $i=1$ to $100$ &lt;or 50~1000&gt; {}\<br>\qquad\textrm{Randomly initialize K-means.}\<br>\qquad\textrm{Run K-means. Get $c^{(1)},\cdots,c^{(m)},\mu_1,\cdots,\mu_k$}\<br>\qquad\textrm{Compute cost function (distortion):}\<br>\qquad\qquad J(c^{(1)},\cdots,c^{(m)},\mu_1,\cdots,\mu_K)\<br>\textrm{}}\<br>\textrm{pick clustering that gave lowest $J$.}<br>\end{array}<br>$$</p><h3 id="Choosing-the-Number-of-Clusters"><a href="#Choosing-the-Number-of-Clusters" class="headerlink" title="Choosing the Number of Clusters"></a>Choosing the Number of Clusters</h3><p>The most common way to choose the number of clusters $K$ is actually to choose it by hand.</p><p>Choosing the <em>Elbow</em> number is a capable way to choose the value of $K$:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8oftu824rj30cb0c3407.jpg" alt="image-20191106171612460"></p><p>However the elbow method is not always make sense for a condition like this:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8ofwmrgy0j30bb08fwf9.jpg" alt="image-20191106171906665"></p><p>We can hardly find a elbow of it.</p><p>So, there is another thought to make it:</p><blockquote><p>Sometimes, you are running K-means to get clusters to use for some later/downstream purpose. Elaluate K-means based on a metric for how well it performs for that later purpose.</p></blockquote><p>T-shirt sizing for example:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8og2ak66wj30o709l0wr.jpg" alt="image-20191106172431180"></p><p>In particular, what we can do is, think about this from the perspective of the T-shirt business and ask: â€œWell if I have five segments, then how well will my T-shirts fit my  customers and so, how many T-shirts can I sell? How happy will my customers be?â€ What really makes sense, from the perspective of the T-shirt business, in terms of whether, I want to have Goer T-shirt sizes so that my T-shirts fit my customers better. Or do I want to have fewer T-shirt sizes so that I make fewer sizes of T-shirts. And I can sell them to the customers more cheaply. And so, the t-shirt selling business, that might give you a way to decide, between three clusters versus five clusters.</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> AndrewNg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ”¯æŒå‘é‡æœº</title>
      <link href="/2019/11/04/AndrewNgML/AndrewNg-MachineLearning-12-SupportVectorMachines/"/>
      <url>/2019/11/04/AndrewNgML/AndrewNg-MachineLearning-12-SupportVectorMachines/</url>
      
        <content type="html"><![CDATA[<h1 id="Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-12-Support-Vector-Machines"><a href="#Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-12-Support-Vector-Machines" class="headerlink" title="Notes of Andrew Ngâ€™s Machine Learning â€”â€” (12) Support Vector Machines"></a>Notes of Andrew Ngâ€™s Machine Learning â€”â€” (12) Support Vector Machines</h1><h2 id="Large-Margin-Classification"><a href="#Large-Margin-Classification" class="headerlink" title="Large Margin Classification"></a>Large Margin Classification</h2><h3 id="Optimization-Objective"><a href="#Optimization-Objective" class="headerlink" title="Optimization Objective"></a>Optimization Objective</h3><p>The <em>Support Vector Machine</em> (or <em>SVM</em>) is a powerful algorithm that is widely used in both industry and academia. Compared to both logistic regression and neural networks, the SVM somethimes gives a cleaner and more powerful way of learning complex non-linear functions.</p><p>What the <strong>cost</strong> of example in our logistic regression is as:<br>$$<br>-y\log\Big(\frac{1}{1+e^{-\theta^Tx}}\Big)-(1-y)\log\Big(1-\frac{1}{1+e^{-\theta^Tx}}\Big)<br>$$<br>It looks like this:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f4rfgycnj31lc0mqjsr.jpg" alt="å±å¹•å¿«ç…§ 2019-09-19 23.23.39"></p><p>With SVM, weâ€™d like to make a little change of them so that:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f58f0dolj31ao0h6wpq.jpg" alt="image-20191029161946046"></p><p>We set a $\textrm{cost}_1$ instead of $-\log(h)$ and set a $\textrm{cost}_0$ instead of $-\log(1-h)$.</p><p>So, for logistic regression, we are going to:<br>$$<br>\min_\theta\frac{1}{m} \sum_{i=1}^m \large[ -y^{(i)}\ \log (h_\theta (x^{(i)})) - (1 - y^{(i)})\ \log (1 - h_\theta(x^{(i)}))\large] + \frac{\lambda}{2m}\sum_{j=1}^n \theta_j^2<br>$$<br>And for Support Vector Machine, we change it to:<br>$$<br>\min_\theta<br>C\sum_{i=1}^m \large[ y^{(i)} \mathop{\textrm{cost}_1}(\theta^Tx^{(i)})</p><ul><li>(1 - y^{(i)})\ \mathop{\textrm{cost}_0}(\theta^Tx^{(i)})\large]</li><li>\frac{1}{2}\sum_{j=1}^n \theta_j^2<br>$$<br>We dropped the $\frac{1}{m}$ in both terms, then multiplied a $C=\lambda$ to them. In this case we can promise that we can get the same min $\theta$ with those two operators.</li></ul><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8f5vx0x43j31dm0ni156.jpg" alt="image-20191029164223055"></p><h3 id="Large-Margin-Intuition"><a href="#Large-Margin-Intuition" class="headerlink" title="Large Margin Intuition"></a>Large Margin Intuition</h3><p>Letâ€™s say the SVM decision boundary:<br>$$<br>\min_\theta<br>C\sum_{i=1}^m \large[ y^{(i)} \mathop{\textrm{cost}_1}(\theta^Tx^{(i)})</p><ul><li>(1 - y^{(i)})\ \mathop{\textrm{cost}_0}(\theta^Tx^{(i)})\large]</li><li>\frac{1}{2}\sum_{j=1}^n \theta_j^2<br>$$<br>If we set $C$ a very  large value, $100000$ for example, when this optimization objective , weâ€™re going to be highly motivated to choose a value, so that <strong>the first term is equal to zero</strong>. And our goal become:<br>$$<br>\begin{array}{l}<br>  \min_\theta \frac{1}{2}\sum_{j=1}^{n}\theta_j^2 \\<br>  s.t. \quad \begin{array}{l}<pre><code>  \theta^Tx^&#123;(i)&#125; \ge 1 &amp; \textrm&#123;if &#125; y^&#123;(i)&#125;=1\\  \theta^Tx^&#123;(i)&#125; \le -1 &amp; \textrm&#123;if &#125; y^&#123;(i)&#125;=0</code></pre>  \end{array}<br>\end{array}<br>$$<br>We will get a very intersting decision boundary. The Support Vector Machines will choose a decision boundary that does a great job of separating the positive and negative examples (the black line below install of others).</li></ul><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8f6tz8op1j30q60kon78.jpg" alt="image-20191029171503318"></p><p>we see that the black decision boundary has some larger minimum distance from any of my training examples, whereas the magenta and the green lines come awfully close to the training examples.</p><p>And mathematically, what that does is, this black decision boundary has a larger distance (the blue lines).That distance is called the <em>margin</em> of the support vector machine and this gives the SVM a certain robustness, because it tries to separate the data with as a large a margin as possible. So the support vector machine is sometimes also called a large margin classifier.</p><p>If $C$ is very large than the SVM will be sensitive to <strong>outliers</strong>. For example, we a very large $C$, $100000$ maybe, with a outliers at the left bottom, the learning algorithm will get the magenta decision boundary. However, if $C$ is not too large, we are going to get the black one as wanted:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8f7bsn392j30zm0iqwmu.jpg" alt="image-20191029173209265"></p><h3 id="Mathematics-Behind-Large-Margin-Classification"><a href="#Mathematics-Behind-Large-Margin-Classification" class="headerlink" title="Mathematics Behind Large Margin Classification"></a>Mathematics Behind Large Margin Classification</h3><h4 id="Vector-Inner-Product"><a href="#Vector-Inner-Product" class="headerlink" title="Vector Inner Product"></a>Vector Inner Product</h4><p>Letâ€™s say we have two vectors:<br>$$<br>u=\left[\begin{array}{l}u1 \ u2\end{array}\right],\qquad v=\left[\begin{array}{l}v1 \ v2\end{array}\right]<br>$$<br>We define their <em>Vector Inner Product</em> as:<br>$$<br>\textrm{Inner Product} =<br>u^Tv=v^Tu<br>$$<br>And we can also get the inner product by getting:<br>$$<br>\begin{array}{ccl}<br>||u|| &amp;=&amp; \textrm{length of vector } u= \sqrt{u_1^2+u_2^2}\<br>p &amp;=&amp; \textrm{length of projection of } v \textrm{ onto } u \textrm{ (signed)} \ \<br>u^Tv &amp;=&amp; p \cdot ||u||<br>\end{array}<br>$$<br><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8h7ruhj8kj31em0s0nfd.jpg" alt="image-20191031111759471"></p><h4 id="SVM-Decision-Boundary"><a href="#SVM-Decision-Boundary" class="headerlink" title="SVM Decision Boundary"></a>SVM Decision Boundary</h4><p>When the $C$ is very large, we can get this:<br>$$<br>\begin{array}{l}<br>    \min_\theta \frac{1}{2}\sum_{j=1}^{n}\theta_j^2<br>    =\frac{1}{2}\Big(\sqrt{\sum_{j=1}^n\theta_j^2}\Big)^2<br>    =\frac{1}{2}||\theta||^2 \\<br>    s.t. \quad \begin{array}{l}<br>        \theta^Tx^{(i)} \ge 1 &amp; \textrm{if } y^{(i)}=1\<br>        \theta^Tx^{(i)} \le -1 &amp; \textrm{if } y^{(i)}=0<br>    \end{array}<br>\end{array}<br>$$<br>If we make a simplification as $\theta_0=0, n=2$, so that $\theta=[\theta_1,\theta_2]^T$, then our $\theta^Tx^{(i)}=p^{(i)}\cdot ||\theta||=\theta_1x_1^{(i)}+\theta_2x_2^{(i)}$.</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8h9w173flj309l06t3zr.jpg" alt="image-20191031123156678"></p><p>So, our description can be:<br>$$<br>\begin{array}{l}<br>    \min_\theta \frac{1}{2}\sum_{j=1}^{n}\theta_j^2<br>    =\frac{1}{2}\Big(\sqrt{\sum_{j=1}^n\theta_j^2}\Big)^2<br>    =\frac{1}{2}||\theta||^2 \\<br>    s.t. \quad \begin{array}{l}<br>        p^{(i)}\cdot ||\theta|| \ge 1 &amp; \textrm{if } y^{(i)}=1\<br>        p^{(i)}\cdot ||\theta|| \le -1 &amp; \textrm{if } y^{(i)}=0<br>    \end{array}\\<br>    \textrm{where $p^{(i)}$ is the projection of $x^{(i)}$ onto the vector $\theta$.}<br>\end{array}<br>$$<br>In the condition of $y=1$, to min the $\theta$, we should promise $||\theta||$ is small as well as make $p^{(i)}\cdot ||\theta|| \ge 1$ as possible. So, we get a large $p^{(i)}$.</p><p>For the negative example, similarly, we will get a $p^{(i)}$ whos absolute value is large.</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8harwzv9cj324i0nu4qp.jpg" alt="å±å¹•å¿«ç…§ 2019-10-31 12.58.43"></p><p>As we seen, a large $p^{(i)}$ gives us a large margin.</p><h2 id="kernels"><a href="#kernels" class="headerlink" title="kernels"></a>kernels</h2><h3 id="Kernels-and-Similarity"><a href="#Kernels-and-Similarity" class="headerlink" title="Kernels and Similarity"></a>Kernels and Similarity</h3><p>We can develop complex nonlinear classifiers by adapting support vector machines. The main technique for this is something called <em>kernels</em>.</p><p>Letâ€™s say if we a training set that looks this:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8jjopayn9j30c5083jui.jpg" alt="image-20191102114127170"></p><p>Recall the past, we will work with lots of polynomial features to hypothesis $y=1$ if $\theta_0+\theta_1x_1+\theta_2x_2+\theta_3x_1x_2+\theta_4x_1^2+\theta_5x_2^2+\cdots\ge 0$ and predict $0$ otherwise.</p><p>Another way of that is:<br>$$<br>\begin{array}{lcl}<br>\textrm{Predict } y=1 &amp;\textrm{if}&amp;\theta_0+\theta_1f_1+\theta_2f_2+\theta_3f_3+\cdots\ge 0<br>\end{array}<br>$$<br>Where $f_1=x_1,f_2=x_2,f_3=x_1x_2,f_4=x_1^2,â€¦$</p><p>If we have a lot of features, then there will be too many polynomial terms, which can become very computationally expensive. So is there a different or a better choice of the features that we can use to plug into this sort of hypothesis form, or in another words, how to define a set of new $f_1,f_2,f_3$ to avoid  high polynomial calculations?</p><p>Here is one idea:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8jljliww8j30o90dmwjt.jpg" alt="image-20191102124615797"></p><p>To simplify the description and make it more intuitional, letâ€™s say we have only $x_0,x_1,x_2$ and we are going to define only three new features ($f_1,f_2,f_3$). </p><p>Leave $x_0$ alone, we manually pick a few points $(x_1^{(i)},x_2^{(i)})$ from a plot of $x_1$-$x_2$, in this example they are notated as $l^{(1)},l^{(2)},l^{(3)}$. We call this points <code>landmarks</code>.</p><p>And then, given a $x$, we can compute new feature depending on proximity to landmarks $l^{(1)},l^{(2)},l^{(3)}$ as follow:<br>$$<br>f_i = \mathop{\textrm{similarity}}(x,l^{(i)}) = \exp(-\frac{||x-l^{(i)}||^2}{2\sigma^2}) = \exp(-\frac{\sum_{j=1}^n(x_j-l_j^{(i)})^2}{2\sigma^2})<br>$$<br>The mathematical term for the simiarity function is <code>kernel function</code>. There are many formula of kernel functions can be chosen. And the specific kernel weâ€™re using here is actually called a <em>Gaussian Kernel</em>.</p><p>Note. $||w||$ means the length of the vector $w$.</p><p>Given  $x$, for each $l^{(i)}$ we can get a $f_i$:</p><ul><li>If x is near $l^{(i)}$:</li></ul><p>$$<br>f_i \approx \lim_{x\to l^{(i)}}\exp(-\frac{||x-l^{(i)}||^2}{2\sigma^2}) = \exp(-\frac{0^2}{2\sigma^2}) = 1<br>$$</p><ul><li>If $x$ far from $l^{(i)}$:</li></ul><p>$$<br>f_i \approx \lim_{||x-l^{(i)}||\to +\infin}\exp(-\frac{||x-l^{(i)}||^2}{2\sigma^2}) = \exp(-\frac{\infin^2}{2\sigma^2}) = 0<br>$$</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8jmrwo86pj30ph0dwwm1.jpg" alt="image-20191102132852867"></p><p>We can see that: If sigma squared is large, as we move away from $l^{(1)}$, the value of $f_1$ falls away much more slowly.</p><p>So, given this definition of the features, letâ€™s see what source of hypothesis we can learn:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8jmzc2qq4j30ot0ditej.jpg" alt="image-20191102133600603"></p><p>We can see that, in this example, only given the $x$ near $l^{(1)}$ or $l^{(2)}$ will it predict â€œ1â€, if the $x$ if far from this two landmarks, it will predict â€œ0â€.</p><h3 id="SVM-with-Kernels"><a href="#SVM-with-Kernels" class="headerlink" title="SVM with Kernels"></a>SVM with Kernels</h3><p>We have talked about the process of picking a few landmarks. But how to choose our $l^{(i)}$s? Actually we will simply choose the location of our landmarks to be exactly near the locations of our m training examples. Here is what we are going to do:</p><hr><h4 id="The-Support-Vector-Machine-With-Kernels-Algorithm"><a href="#The-Support-Vector-Machine-With-Kernels-Algorithm" class="headerlink" title="The Support Vector Machine With Kernels Algorithm"></a>The Support Vector Machine With Kernels Algorithm</h4><p>Given a set of training data: $(x^{(1)},y^{(1)}),(x^{(2)},y^{(2)}),â€¦,(x^{(m)},y^{(m)})$ </p><p>Choose landmarks: $l^{(i)}=x^{(i)} \quad \textrm{for }i=1,2,\cdots,m$</p><p>For example $x$: $f_i=\mathop{\textrm{similarity}}(x,l^{(i)}) \quad \textrm{for }i=1,2,\cdots,m$</p><p>Group $f_i$s into a vector: $f=[f_0,f_1,f_2,\cdots,f_m]^T$, in which the $f_0 \equiv 1$ is a extra feature for convention.</p><p>Hypothesis: </p><ul><li>Given $x$, compute features $f\in\R^{m+1}$</li><li>Predict $y=1$ if $\theta^Tf=\theta_0f_0+\theta_1f_1+\cdots\ge 0$ (where $\theta\in\R^{m+1}$)</li></ul><p>Training:<br>$$<br>\min_\theta<br>C\sum_{i=1}^m \large[ y^{(i)} \mathop{\textrm{cost}_1}(\theta^Tf^{(i)})</p><ul><li>(1 - y^{(i)})\ \mathop{\textrm{cost}_0}(\theta^Tf^{(i)})\large]</li><li>\frac{1}{2}\sum_{j=1}^n \theta_j^2<br>$$<br>Notice: instead of $\theta^Tx^{(i)}$ that we use before, now we use $\theta^Tf^{(i)}$. And here our $n$ is equal to $m$. </li></ul><p>Mathematical tricks in practice: Ignoring the $\theta_0$ (s.t. $\theta=[\theta_1,\cdots,\theta_m]^T$), we can get $\sum_j\theta_j^2=\theta^T\theta$. Moreover, for mathematical convenience when deal with a large training set, we gonna use <strong>$\theta^T M \theta$</strong> instead of $\theta^T\theta$.</p><hr><h4 id="SVM-parameters"><a href="#SVM-parameters" class="headerlink" title="SVM parameters"></a>SVM parameters</h4><p>Here are parameters that we are going to choose when use the algorithm above:</p><ul><li>$C$ (=$\frac{1}{m}$)<ul><li>Large $C$: Lower bias, high variance (small $\lambda$)</li><li>Small $C$: Higher bias, low variance (large $\lambda$)</li></ul></li><li>$\sigma^2$<ul><li>Large $\sigma^2$: Features $f_i$ vary more smoothly. Higher bias, lower variance.<img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8jukxlnxkj306u04laad.jpg" alt="å±å¹•å¿«ç…§ 2019-11-02 15.51.46"></li><li>Small $\sigma^2$: Features $f_i$ vary less smoothly. Lower bias, higher variance.<img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8jul1utnaj306i04ezk4.jpg" alt="å±å¹•å¿«ç…§ 2019-11-02 15.51.50"></li></ul></li></ul><p>E.g. Suppose we train an SVM and find it overfits our training data. A reasonable next step is going to decrease $C$ or increase $\sigma^2$.</p><h2 id="SVM-in-Practice"><a href="#SVM-in-Practice" class="headerlink" title="SVM in Practice"></a>SVM in Practice</h2><h3 id="Using-An-SVM"><a href="#Using-An-SVM" class="headerlink" title="Using An SVM"></a>Using An SVM</h3><p>We are not recommended writing our own software to solve for the parameters via a SVM. We should call some library functions to do that.</p><p>When using SVM software package (e.g. <code>liblinear</code>, <code>libsvm</code>) to solve for parameters $\theta$, we need to specify:</p><ul><li>Choice of parameter $C$;</li><li>Choice of kernel (similarity function):<ul><li><strong>No kernel</strong> (â€œlinear kernelâ€, do our common logistic regression): Predict $y=1$ if $\theta^Tx\ge0$. For large $n$ and small $m$ case (no kernel can avoid overfitting).</li><li><strong>Gaussian kernel</strong>: $f_i=\exp(-\frac{||x-l^{(i)}||^2}{2\sigma^2})$, where $l^{(i)}=x^{(i)}$.(Need to choose $\sigma^2$). For small $n$ and large $m$ case (Gaussian kernel can fit a more complex nonlinear decision boundary).</li></ul></li></ul><p>If we decide to use a Gaussian kernel, here is what we are going to do:</p><ul><li>Provide a kernel (similarity) function:<br>$$<br>\begin{array}{l}<br>\textrm{function f = kernel(x1, x2)}\<br>\qquad \textrm{f} = \exp(-\frac{||\textrm{x1}-\textrm{x2}||^2}{2\sigma^2})\<br>\textrm{return}<br>\end{array}<br>$$<br>Note: Do perform feature scaling before using the Gaussian kernel.</li></ul><h3 id="Other-choices-of-kernel"><a href="#Other-choices-of-kernel" class="headerlink" title="Other choices of kernel"></a>Other choices of kernel</h3><p>Not all similarity functions $\mathop{\textrm{similarity}}(x,l)$ make valid kernels. (Need to satisfy technical condiction called â€œMercerâ€™s Theoremâ€ to make sure SVM packagesâ€™ optimizations run correctly, and do not diverge).</p><p>There are many off-the-shelf kernels available, for example:</p><ul><li>Polynomial kernel: $k(x,l)=(X^Tl+constant)^{degree}$, need to choose the $constant$ and $degree$. Usually performs worse than Gaussian kernel. Only for $X$ and $l$ are all strictly non negative.</li><li>More esoteric: String kernel (for input is text string),  chi-square kernel, histogram intersection kernel, â€¦</li></ul><h3 id="Multi-class-classification"><a href="#Multi-class-classification" class="headerlink" title="Multi-class classification"></a>Multi-class classification</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8jul8myufj30mv0cz0xu.jpg" alt="image-20191102171432072"></p><h3 id="Logistic-regression-v-s-SVMs"><a href="#Logistic-regression-v-s-SVMs" class="headerlink" title="Logistic regression v.s. SVMs"></a>Logistic regression v.s. SVMs</h3><p>$n$ = number of features ($x\in\R^{n+1}$);</p><p>$m$ = number of training examples;</p><ul><li>If $n$ is large (relative to $m$): ($n\ge m$, e.g. $n=10,000, m=10 \sim 1000$)<ul><li>Use logistic regression, or SVM without a kernel (â€œlinear kernelâ€) </li></ul></li><li>If $n$ is small, $m$ is intermediate: (e.g. $n=1\sim1000,m=50,000+$)<ul><li>Use SVM with Gaussian kernel</li></ul></li><li>If $n$ is small, $m$ is large:<ul><li>Create/add more features, then use logistic regression or SVM without a kernel</li></ul></li></ul><p>Note: Neural network likely to work well for most of these settings, but may be slower to train.</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> AndrewNg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœºå™¨å­¦ä¹ ç³»ç»Ÿè®¾è®¡</title>
      <link href="/2019/10/26/AndrewNgML/AndrewNg-MachineLearning-11-MachineLearningSystemDesign/"/>
      <url>/2019/10/26/AndrewNgML/AndrewNg-MachineLearning-11-MachineLearningSystemDesign/</url>
      
        <content type="html"><![CDATA[<h1 id="Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-11-Machine-Learning-System-Design"><a href="#Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-11-Machine-Learning-System-Design" class="headerlink" title="Notes of Andrew Ngâ€™s Machine Learning â€”â€” (11) Machine Learning System Design"></a>Notes of Andrew Ngâ€™s Machine Learning â€”â€” (11) Machine Learning System Design</h1><h2 id="Prioritizing-What-to-Work-On"><a href="#Prioritizing-What-to-Work-On" class="headerlink" title="Prioritizing What to Work On"></a>Prioritizing What to Work On</h2><p><strong>System Design Example:</strong></p><p>Given a data set of emails, we could construct a vector for each email. Each entry in this vector represents a word. The vector normally contains 10,000 to 50,000 entries gathered by finding the most frequently used words in our data set. If a word is to be found in the email, we would assign its respective entry a 1, else if it is not found, that entry would be a 0. Once we have all our x vectors ready, we train our algorithm and finally, we could use it to classify if an email is a spam or not.</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8bj9rx2urj30ki09mdk2.jpg" alt="img"></p><p>So how could you spend your time to improve the accuracy of this classifier?</p><ul><li>Collect lots of data (for example â€œhoneypotâ€ project but doesnâ€™t always work)</li><li>Develop sophisticated features (for example: using email header data in spam emails)</li><li>Develop algorithms to process your input in different ways (recognizing misspellings in spam).</li></ul><p>It is difficult to tell which of the options will be most helpful.</p><h2 id="Error-Analysis"><a href="#Error-Analysis" class="headerlink" title="Error Analysis"></a>Error Analysis</h2><p>The recommended approach to solving machine learning problems is to:</p><ul><li>Start with a simple algorithm, implement it quickly, and test it early on your cross validation data.</li><li>Plot learning curves to decide if more data, more features, etc. are likely to help.</li><li>Manually examine the errors on examples in the cross validation set and try to spot a trend where most of the errors were made.</li></ul><p>For example, assume that we have 500 emails and our algorithm misclassifies a 100 of them. We could manually analyze the 100 emails and categorize them based on what type of emails they are. We could then try to come up with new cues and features that would help us classify these 100 emails correctly. Hence, if most of our misclassified emails are those which try to steal passwords, then we could find some features that are particular to those emails and add them to our model. We could also see how classifying each word according to its root changes our error rate:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8bl9vwi9lj30jg0a143a.jpg" alt="img"></p><p>It is very important to <strong>get error results as a single, numerical value</strong>. Otherwise it is difficult to assess your algorithmâ€™s performance.</p><p>For example if we use stemming, which is the process of treating the same word with different forms (fail/failing/failed) as one word (fail), and get a 3% error rate instead of 5%, then we should definitely add it to our model. However, if we try to distinguish between upper case and lower case letters and end up getting a 3.2% error rate instead of 3%, then we should avoid using this new feature. </p><p>Hence, we should try new things, get a numerical value for our error rate, and based on our result decide whether we want to keep the new feature or not.</p><h2 id="Handling-Skewed-Data"><a href="#Handling-Skewed-Data" class="headerlink" title="Handling Skewed Data"></a>Handling Skewed Data</h2><h3 id="Error-metrics-for-skewed-classes"><a href="#Error-metrics-for-skewed-classes" class="headerlink" title="Error metrics for skewed classes"></a>Error metrics for skewed classes</h3><p>A <em>skewed class</em> is a case of that the ratio of positive to negative examples is very close to one of two extremes.</p><p>For example, consider the problem of cancer classification, when we say $y = 1$ if the patient has cancer and $y = 0$ if they do not. We have trained the progression classifier and letâ€™s say we test out classifier on a test set and find that we get 1% error. So, we are making 99% correct diagnosis. Seems like a really impressive result. </p><p>But now, we find out that only 0.5% of patients in out training test sets actually have cancer (i.e. only half a percent of the patients that come though our screening process have cancer). This case is actually what we called a skewed class. In this case the 1% error no longert looks so impressive.</p><p>And in particular, hereâ€™s a piece of code, which is actually even a non learning code like this:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function y &#x3D; predictCancer(x)</span><br><span class="line">y &#x3D; 0;% just output 0 for whatever x.</span><br><span class="line">return</span><br></pre></td></tr></table></figure><p>It just sets $y=0$, and always predicts nobody has cancer. This algorithm would actually get 0.5% error.So this is even better then the 1% offered by our classifier. </p><p>So, How can we know whether a implement (e.g. using the $y \equiv 0$ instead of our learning algorithm) is actually a improvement for a skewed class?</p><p>One of the evaluatin  metric are whatâ€™s called <em>Precision/Recall</em>:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8bmwqbebxj30po0dgahc.jpg" alt="image-20191026152903469"></p><p>If a classifier is high precision and high recall, then we can make sure that this algorithm preforms pretty well.</p><h3 id="Trading-Off-Precision-and-Recall"><a href="#Trading-Off-Precision-and-Recall" class="headerlink" title="Trading Off Precision and Recall"></a>Trading Off Precision and Recall</h3><p>After training a logistic regression classifier, we plan to make predictions according to:</p><ul><li>Predict $y=1$ if $h_\theta(x)â‰¥threshold$</li><li>Predict $y=1$ if $h_\theta(x)&lt;threshold$</li></ul><p>For different values of the <code>threshold</code> parameter, we get different values of precision (<code>P</code>) and recall (<code>R</code>).</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8bpe4ywhyj30pr0edgth.jpg" alt="image-20191026165452692"></p><p>So, how to compare precision/recall numbers? We get what called <em>F score</em> (or <em>$F_1$ score</em>) for help:<br>$$<br>F_1 \textrm{ Score} = 2 \frac{PR}{P+R}<br>$$<br><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8bpu6kdx0j30pm0ec446.jpg" alt="image-20191026171016268"></p><p>In the worst case where our $P=R=0$, we will get $F_1$ score = 0. And in the best case where $P=R=1$, the F score will equals 1. So a $F_1$ Score will be a value between 0 and 1, the higher $F_1$ Score we get, the better implement it is.</p><p>A reasonable way to pick the value to use for the threshold is to measure precision (<code>P</code>) and recall (<code>R</code>) on the   <strong>cross validation set</strong> and choose the value of threshold which maximizes $2\frac{PR}{P+R}$.</p><h2 id="Data-For-Machine-Learning"><a href="#Data-For-Machine-Learning" class="headerlink" title="Data For Machine Learning"></a>Data For Machine Learning</h2><blockquote><p>Itâ€™s not who has the best algorithm that wins. Itâ€™s who has the most data.</p></blockquote><h3 id="Large-data-rationale"><a href="#Large-data-rationale" class="headerlink" title="Large data rationale"></a>Large data rationale</h3><p>We think a massive  training set will be able to help when we assume feature $x\in\R^{n+1}$ has sufficient information to predict $y$ accurately.</p><p>A useful test for this is: <strong>Given the input $x$, can a human expert confidently predict $y$?</strong></p><p>Example: For breakfast I ate <u>{two, to, too}</u> eggs.</p><p>Counterexample: Predict housing price from only size and no other features.</p><hr><p>To make $J_{\textrm{test}}(\Theta)$ be small, we should:</p><ul><li><p>Using a learning algorithm with many parameters (<em>low bias algorithm</em> e.g. logistic/linear regression regression with many features; neural network with many hidden units)</p><p>-&gt; $J_{\textrm{train}}(\Theta)$ will be small</p></li><li><p>Using a very large training set (unlikely to overfit)</p><p>-&gt; $J_{\textrm{train}}(\Theta) \approx J_{\textrm{test}}(\Theta)$</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> AndrewNg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœºå™¨å­¦ä¹ çš„åº”ç”¨å»ºè®®</title>
      <link href="/2019/10/26/AndrewNgML/AndrewNg-MachineLearning-10-AdviceForApplyingMachineLearning/"/>
      <url>/2019/10/26/AndrewNgML/AndrewNg-MachineLearning-10-AdviceForApplyingMachineLearning/</url>
      
        <content type="html"><![CDATA[<h1 id="Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-10-Advice-for-Applying-Machine-Learning"><a href="#Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-10-Advice-for-Applying-Machine-Learning" class="headerlink" title="Notes of Andrew Ngâ€™s Machine Learning â€”â€” (10) Advice for Applying Machine Learning"></a>Notes of Andrew Ngâ€™s Machine Learning â€”â€” (10) Advice for Applying Machine Learning</h1><h2 id="Evaluating-a-Learning-Algorithm"><a href="#Evaluating-a-Learning-Algorithm" class="headerlink" title="Evaluating a Learning Algorithm"></a>Evaluating a Learning Algorithm</h2><h3 id="Machine-learning-diagnostic"><a href="#Machine-learning-diagnostic" class="headerlink" title="Machine learning diagnostic"></a>Machine learning diagnostic</h3><p><code>Diagnostic</code>: A test that you can run to gain insight what is/isnâ€™t working with a learning algorithm, and gain guidance as to how best to improve its performance.</p><p>Diagnostics can take time to implement, but doing so can be a very good use of our time.</p><h3 id="Evaluating-a-Hypothesis"><a href="#Evaluating-a-Hypothesis" class="headerlink" title="Evaluating a Hypothesis"></a>Evaluating a Hypothesis</h3><p>Once we have done some trouble shooting for errors in our predictions by: </p><ul><li>Getting more training examples</li><li>Trying smaller sets of features</li><li>Trying additional features</li><li>Trying polynomial features</li><li>Increasing or decreasing Î»</li></ul><p>We can move on to evaluate our new hypothesis. </p><p>A hypothesis may have a low error for the training examples but still be inaccurate (because of overfitting). Thus, to evaluate a hypothesis, given a dataset of training examples, we can split up the data into two sets: a <strong><code>training set</code></strong> and a <strong><code>test set</code></strong>. Typically, the training set consists of <code>70%</code> of your data and the test set is the remaining <code>30%</code>.</p><p>The new procedure using these two sets is then:</p><ol><li><p>Learn $\Theta$ and minimize $J_{\textrm{train}}(\Theta)$ using the training set</p></li><li><p>Compute the test set error $J_{\textrm{test}}(\Theta)$</p></li></ol><h4 id="The-test-set-error"><a href="#The-test-set-error" class="headerlink" title="The test set error"></a>The test set error</h4><ol><li>For linear regression: $J_{test}(\Theta) = \dfrac{1}{2m_{test}} \sum_{i=1}^{m_{test}}(h_\Theta(x^{(i)}<em>{test}) - y^{(i)}</em>{test})^2$</li><li>For classification ~ Misclassification error (aka 0/1 misclassification error):</li></ol><p>$$<br>err(h_\Theta(x),y) = \left{\begin{array}{lll} 1 &amp; \textrm{if } h_\Theta(x) \geq 0.5\ and\ y = 0\ or\ h_\Theta(x) &lt; 0.5\ and\ y = 1\ 0 &amp; \textrm{otherwise} \end{array}\right.<br>$$</p><p>This gives us a binary 0 or 1 error result based on a misclassification. The average test error for the test set is:<br>$$<br>\text{Test Error} = \dfrac{1}{m_{test}} \sum^{m_{test}}<em>{i=1} err(h_\Theta(x^{(i)}_{test}), y^{(i)}</em>{test})<br>$$<br>This gives us the proportion of the test data that was misclassified.</p><h3 id="Model-Selection-and-Train-Validation-Test-Sets"><a href="#Model-Selection-and-Train-Validation-Test-Sets" class="headerlink" title="Model Selection and Train/Validation/Test Sets"></a>Model Selection and Train/Validation/Test Sets</h3><p>Just because a learning algorithm fits a training set well, that does not mean it is a good hypothesis. It could over fit and as a result your predictions on the test set would be poor. The error of your hypothesis as measured on the data set with which you trained the parameters will be lower than the error on any other data set. </p><p>Given many models with different polynomial degrees, we can use a systematic approach to identify the â€˜bestâ€™ function. In order to choose the model of your hypothesis, you can test each degree of polynomial and look at the error result.</p><p>One way to break down our dataset into the three sets is:</p><ul><li>Training set: 60%</li><li>Cross validation set: 20%</li><li>Test set: 20%</li></ul><p>We can now calculate three separate error values for the three different sets using the following method:</p><ol><li>Optimize the parameters in $\Theta$ using the training set for each polynomial degree.</li><li>Find the polynomial degree d with the least error using the cross validation set.</li><li>Estimate the generalization error using the test set with $J_{test}(\Theta(d))$, ($d$ = theta from polynomial with lower error);</li></ol><p>This way, the degree of the polynomial d has not been trained using the test set.</p><h2 id="Bias-v-s-Variance"><a href="#Bias-v-s-Variance" class="headerlink" title="Bias v.s. Variance"></a>Bias v.s. Variance</h2><h3 id="Diagnosing-Bias-v-s-Variance"><a href="#Diagnosing-Bias-v-s-Variance" class="headerlink" title="Diagnosing Bias v.s. Variance"></a>Diagnosing Bias v.s. Variance</h3><p>We offen need to examine the relationship between the degree of the polynomial $d$ and the <em>underfitting</em> or <em>overfitting</em> of our hypothesis.</p><ul><li>We need to distinguish whether <strong>bias</strong> or <strong>variance</strong> is the problem contributing to bad predictions.</li><li>High bias is underfitting and high variance is overfitting. Ideally, we need to find a golden mean between these two.</li></ul><p>The training error will tend to <strong>decrease</strong> as we increase the degree d of the polynomial.</p><p>At the same time, the cross validation error will tend to <strong>decrease</strong> as we increase d up to a point, and then it will <strong>increase</strong> as $d$ is increased, forming a convex curve.</p><ul><li><strong>High bias (underfitting)</strong>: both $J_{\textrm{train}}(\Theta)$ and $J_{\textrm{CV}}(\Theta)$ will be high. Also, $J_{\textrm{CV}}(\Theta) \approx J_{\textrm{train}}(\Theta)$.</li><li><strong>High variance (overfitting)</strong>: $J_{\textrm{train}}(\Theta)$ will be low and $J_{\textrm{CV}}(\Theta) \gg J_{\textrm{train}}(\Theta)$.</li></ul><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8ajhooasfj308c073q3l.jpg" alt="img"></p><h3 id="Regularization-and-Bias-Variance"><a href="#Regularization-and-Bias-Variance" class="headerlink" title="Regularization and Bias/Variance"></a>Regularization and Bias/Variance</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8al43zgpwj30jj0akq4m.jpg" alt="img"></p><p>In the figure above, we see that as $\lambda$ increases, our fit becomes more rigid. On the other hand, as $\lambda$ approaches $0$, we tend to over overfit the data. So how do we choose our parameter $\lambda$ to get it â€˜just rightâ€™ ? In order to choose the model and the regularization term $\lambda$,  we need to:</p><ol><li>Create a list of lambdas (i.e. $\lambdaâˆˆ{0,0.01,0.02,0.04,0.08,0.16,0.32,0.64,1.28,2.56,5.12,10.24}$);</li><li>Create a set of models with different degrees or any other variants.</li><li>Iterate through the$\lambda$s and for each $\lambda$ go through all the models to learn some $\Theta$.</li><li>Compute the cross validation error using the learned $\Theta$ (computed with $\lambda$) on the $J_{\textrm{CV}}(\Theta)$ <strong>without</strong> regularization or $\lambda = 0$.</li><li>Select the best combo that produces the lowest error on the cross validation set.</li><li>Using the best combo $\Theta$ and $\lambda$, apply it on $J_{\textrm{test}}(\Theta)$ to see if it has a good generalization of the problem.</li></ol><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8antxbcmwj30pu0eiq8l.jpg" alt="image-20191025191458736"></p><h3 id="Learning-Curves"><a href="#Learning-Curves" class="headerlink" title="Learning Curves"></a>Learning Curves</h3><p>Training an algorithm on a very few number of data points (such as 1, 2 or 3) will easily have 0 errors because we can always find a quadratic curve that touches exactly those number of points. Hence:</p><ul><li>As the training set gets larger, the error for a quadratic function increases.</li><li>The error value will plateau out after a certain m, or training set size.</li></ul><p><em>Learning curves</em> is often a very useful thing to plot if either we wanted to sanity check that our algorithm is working correctly, or if we want to improve the performance of the algorithm.</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8anv9sdhvj30pq0ef0xi.jpg" alt="image-20191025191643371"></p><h4 id="Experiencing-high-bias"><a href="#Experiencing-high-bias" class="headerlink" title="Experiencing high bias"></a>Experiencing high bias</h4><p><strong>Low training set size</strong>: cases $J_{\textrm{train}}(\Theta)$ to be low and $J_{\textrm{CV}}(\Theta)$ to be high.</p><p><strong>Large training set size</strong>: cases both $J_{\textrm{train}}(\Theta)$ and $J_{\textrm{CV}}(\Theta)$ to be high with $J_{\textrm{train}}(\Theta) \approx J_{\textrm{CV}}(\Theta)$.</p><p>If a learning algorithm is suffering from <strong>high bias</strong>, getting more training data will not <strong>(by itself)</strong> help much.</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8annycdk8j308c056q3e.jpg" alt="img"></p><h4 id="Experiencing-high-variance"><a href="#Experiencing-high-variance" class="headerlink" title="Experiencing high variance"></a>Experiencing high variance</h4><p><strong>Low training set size</strong>: $J_{\textrm{train}}(\Theta)$ will be low and $J_{\textrm{CV}}(\Theta)$ will be high.</p><p><strong>Large training set size</strong>: $J_{\textrm{train}}(\Theta)$ increases with training set size and $J_{\textrm{CV}}(\Theta)$ continues to decrease without leveling off. Also, $J_{\textrm{train}}(\Theta) &lt; J_{\textrm{CV}}(\Theta)$ but the difference between them remains significant.</p><p>If a learning algorithm is suffering from <strong>high variance</strong>, getting more training data is likely to help.</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8anrlbbfkj308c04rdgb.jpg" alt="img"></p><h3 id="Deciding-What-to-Do-Next-Revisited"><a href="#Deciding-What-to-Do-Next-Revisited" class="headerlink" title="Deciding What to Do Next Revisited"></a>Deciding What to Do Next Revisited</h3><p>Our decision process can be broken down as follows:</p><ul><li><p><strong>Getting more training examples:</strong> Fixes high variance</p></li><li><p><strong>Trying smaller sets of features:</strong> Fixes high variance</p></li><li><p><strong>Adding features:</strong> Fixes high bias</p></li><li><p><strong>Adding polynomial features:</strong> Fixes high bias</p></li><li><p><strong>Decreasing Î»:</strong> Fixes high bias</p></li><li><p><strong>Increasing Î»:</strong> Fixes high variance.</p></li></ul><h4 id="Diagnosing-Neural-Networks"><a href="#Diagnosing-Neural-Networks" class="headerlink" title="Diagnosing Neural Networks"></a>Diagnosing Neural Networks</h4><ul><li>A neural network with fewer parameters is <strong>prone to underfitting</strong>. It is also <strong>computationally cheaper</strong>.</li><li>A large neural network with more parameters is <strong>prone to overfitting</strong>. It is also <strong>computationally expensive</strong>. In this case you can use regularization (increase Î») to address the overfitting.</li></ul><p>Using a single hidden layer is a good starting default. You can train your neural network on a number of hidden layers using your cross validation set. You can then select the one that performs best.</p><h4 id="Model-Complexity-Effects"><a href="#Model-Complexity-Effects" class="headerlink" title="Model Complexity Effects:"></a>Model Complexity Effects:</h4><ul><li>Lower-order polynomials (low model complexity) have high bias and low variance. In this case, the model fits poorly consistently.</li><li>Higher-order polynomials (high model complexity) fit the training data extremely well and the test data extremely poorly. These have low bias on the training data, but very high variance.</li><li>In reality, we would want to choose a model somewhere in between, that can generalize well but also fits the data reasonably well.</li></ul>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> AndrewNg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¥ç»ç½‘ç»œçš„æ‹Ÿåˆ</title>
      <link href="/2019/10/21/AndrewNgML/AndrewNg-MachineLearning-9-NeuralNetworksLearning/"/>
      <url>/2019/10/21/AndrewNgML/AndrewNg-MachineLearning-9-NeuralNetworksLearning/</url>
      
        <content type="html"><![CDATA[<h1 id="Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-9-Neural-Networks-Learning"><a href="#Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-9-Neural-Networks-Learning" class="headerlink" title="Notes of Andrew Ngâ€™s Machine Learning â€”â€” (9) Neural Networks: Learning"></a>Notes of Andrew Ngâ€™s Machine Learning â€”â€” (9) Neural Networks: Learning</h1><h2 id="Cost-Functon-amp-Backpropagation"><a href="#Cost-Functon-amp-Backpropagation" class="headerlink" title="Cost Functon &amp; Backpropagation"></a>Cost Functon &amp; Backpropagation</h2><h3 id="Cost-Function"><a href="#Cost-Function" class="headerlink" title="Cost Function"></a>Cost Function</h3><p>Firstly, define some needed variables:</p><table><thead><tr><th>Notation</th><th>Represent</th></tr></thead><tbody><tr><td>$L$</td><td>total number of layers in the network</td></tr><tr><td>$s_l$</td><td>number of units (not counting bias unit) in layer $l$</td></tr><tr><td>$K$</td><td>number of output units/classes</td></tr></tbody></table><p>Recall that in neural networks, we may have many output nodes. </p><p>We denote $H_\Theta(x)_k$ as being a hypothesis that results in the $K^{th}$ output. </p><p>Our cost function for neural networks is going to be a generalization of the one we used for logistic regression. Recall that the cost function for regularized logistic regression was:</p><p>$J(\theta) = - \frac{1}{m} \sum_{i=1}^m \large[ y^{(i)}\ \log (h_\theta (x^{(i)})) + (1 - y^{(i)})\ \log (1 - h_\theta(x^{(i)}))\large] + \frac{\lambda}{2m}\sum_{j=1}^n \theta_j^2$</p><p>For neural networks, it is going to be slightly more complicated:<br>$$<br>J(\Theta)=-\frac{1}{m}\sum_{i=1}^{m}\sum_{k=1}^{K}\Big[<br>y_k^{(i)}log\Big(\big(h_\Theta(x^{(i)})\big)<em>k\Big)+<br>(1-y_k^{(i)})log\Big(1-\big(h_\Theta(x^{(i)})\big)<em>k\Big)<br>\Big]+<br>\frac{\lambda}{2m}\sum</em>{l=1}^{L-1}\sum</em>{i=1}^{s_l}\sum_{j=1}^{s_{l+1}}\Big(\Theta_{j,i}^{(l)}\Big)^2<br>$$<br>We have added a few nested summations to account for our multiple output nodes. In the first part of the equation, before the square brackets, we have an additional nested summation that loops through the number of output nodes.</p><p>In the regularization part, after the square brackets, we must account for multiple theta matrices. The number of columns in our current theta matrix is equal to the number of nodes in our current layer (including the bias unit). The number of rows in our current theta matrix is equal to the number of nodes in the next layer (excluding the bias unit). As before with logistic regression, we square every term.</p><p>Note:</p><ul><li>the double sum simply adds up the logistic regression costs calculated for each cell in the output layer</li><li>the triple sum simply adds up the squares of all the individual Î˜s in the entire network.</li><li>the i in the triple sum does <strong>not</strong> refer to training example i</li></ul><h3 id="Backpropagation-Algorithm"><a href="#Backpropagation-Algorithm" class="headerlink" title="Backpropagation Algorithm"></a>Backpropagation Algorithm</h3><p><code>Backpropagation</code> is neural-network terminology for minimizing our cost function, just like what we were doing with gradient descent in logistic and linear regression. Our goal is to compute:</p><p>$\mathop{\textrm{min}}_\Theta J(\Theta)$</p><p>That is, we want to minimize our cost function $J$ using an optimal set of parameters in theta. In this section weâ€™ll look at the equations we use to compute the partial derivative of $J(\Theta)$:</p><p>$\frac{\partial}{\partial\Theta_{i,j}^{(l)}}J(\Theta)$</p><p>To do so, we use the following algorithm:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7y3ekmyjmj30om0d9gs6.jpg" alt="img"></p><hr><h4 id="Backpropagation-Algorithm-1"><a href="#Backpropagation-Algorithm-1" class="headerlink" title="Backpropagation Algorithm"></a>Backpropagation Algorithm</h4><p>Given training set ${(x^{(1)},y^{(1)}),â€¦,(x^{(m)},y^{(m)})}$</p><ul><li>Set $\Delta_{i,j}^{(l)}:=0$ for all $l,i,j$, (hence you end up having a matrix full of zeros)</li></ul><p>(ğŸ‘‡ Begin For loop: ğŸ‘‡)</p><p><strong>For</strong> training example $t=1\textrm{ to } m$:</p><ol><li>Set $a^{(1)}:=x^{(t)}$</li><li>Preform forward propagation to compute $a^{(l)}$ for $l=2,3,â€¦,L$</li></ol><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7y3n2yqdkj30d8074q53.jpg" alt="img"></p><ol start="3"><li>Using $y^{(t)}$, compute $\delta^{(L)}=a^{(L)}-y^{(t)}$</li></ol><p>Where $L$ is our total number of layers and $a^{(L)}$ is the vector of outputs of the activation units for the last layer.</p><p>So, our <code>error values</code> for the last layer are simply the differences of our actual results in the last layer and the correct outputs in $y$.</p><p>To get the delta values of the layers before the last layer, we can use an equation that steps us back from right to left:</p><ol start="4"><li>Compute $\delta^{(L-1)},\delta^{(L-2)},â€¦,\delta^{(2)}$ using $\delta^{(l)}=\big((\Theta^{(l)})^T\delta^{(l+1)}\big).<em>a^{(l)}.</em>(1-a^{(l)})$</li></ol><p>ã€Noteã€‘: â€œ$.* $â€ above are the element-wise multiplications in Octave/MATLAB.</p><p>The delta values of layer $l$ are calculated by multiplying the delta values in the next layer with the theta matrix of layer $l$.</p><p>We then element-wise multiply that with a function called $gâ€™$, or g-prime, which is the derivative of the activation function $g$ evaluated with the input values given by $z^{(l)}$.</p><p>The g-prime derivative terms can also be written out as: $gâ€™(z^{(l)})=a^{(l)}.*(1-a^{(l)})$</p><ol start="5"><li>$\Delta_{i,j}^{(l)}:=\Delta_{i,j}^{l}+a_j^{(l)}\delta^{(l+1)}$ or with vectorization, $\Delta^{(l)}:=\Delta^{(l)}+\delta^{(l+1)}(a^{(l)})^T$</li></ol><p>(ğŸ‘† End For ğŸ‘†)</p><p>Hence we update our new $\Delta$ matrix.</p><ul><li><p>$D_{i,j}^{(l)}:=\frac{1}{m}\big(\Delta_{i,j}^{(l)}+\lambda\Theta_{i,j}^{(l)}\big)$, if $j\not=0$;</p></li><li><p>$D_{i,j}^{(l)}:=\frac{1}{m}\Delta_{i,j}^{(l)}$ if $j=0$.</p></li></ul><p>The capital-delta matrix $D$ is used as an <code>accumulator</code> to add up our values as we go along and eventually compute our partial derivate.</p><p>Thus we get $\frac{\partial}{\partial\Theta_{i,j}^{(l)}}J(\Theta)=D_{i,j}^{(l)}$.</p><hr><h4 id="Backpropagation-Intuition"><a href="#Backpropagation-Intuition" class="headerlink" title="Backpropagation Intuition"></a>Backpropagation Intuition</h4><p>Recall that the cost function for a neural network is:<br>$$<br>J(\Theta)=-\frac{1}{m}\sum_{i=1}^{m}\sum_{k=1}^{K}\Big[y_k^{(t)}\log\big(h_\Theta(x^{(t)})\big)<em>k+(1-y_k^{(t)})\log\big(1-h_\Theta(x^{(t)})\big)<em>k\Big]+\frac{\lambda}{m}\sum</em>{l=1}^{L-1}\sum</em>{i=1}^{s_l}\sum_{j=1}^{s_l+1}\Big(\Theta_{j,i}^{(l)}\Big)^2<br>$$<br>If we consider simple non-multiclass classification ($K=1$) and disregard regularization, the cost is copmputed with:<br>$$<br>cost(t) = y^{(t)}\log\big(h_\Theta(x^{(t)})\big)+(1-y^{(t)})\log\big(1-h_\Theta(x^{(t)})\big)<br>$$<br>Intuitively, $\delta_j^{(l)}$ is the â€œerrorâ€ for $a_j^{(l)}$ (unit $j$ in layer $l$). More formally, the delta values are actually the derivative of the cost function:<br>$$<br>\delta_j^{(l)}=\frac{\partial}{\partial z_j^{(l)}}cost(t)<br>$$<br>Recall that our derivative is the slope of a line tangent to the cost function, so the steeper the slope the more incorrect we are. Let us consider the following neural network below and see how we could calculate some $\delta_j^{(l)}$:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g8072ftfjzj30k00b9wi3.jpg" alt="img"></p><p>In the image above, to calculate $\delta_2^{(2)}$ , we multiply the weights $\Theta_{12}^{(2)}$ and $\Theta_{22}^{(2)}$ by their respective $\delta$ values found to the right of each edge. So we get $\delta_2^{(2)}=\Theta_{12}^{(2)}\times\delta_1^{(3)}+\Theta_{22}^{(2)}\times\delta_2^{(3)}$. To calculate every single possible $\delta_j^{(l)}$, we could start from the right of our diagram. We can think of our edges as our $\Theta_{ij}$. Going from right to left, to calculate the value of $\delta_j^{(l)}$, you can just take the over all sum of each weight times the $\delta$ it is coming from. Hence, another example would be $\delta_2^{(3)}=\Theta_{12}^{(3)}\times\delta_1^{(4)}$.</p><h2 id="Backpropagation-in-Practice"><a href="#Backpropagation-in-Practice" class="headerlink" title="Backpropagation in Practice"></a>Backpropagation in Practice</h2><h3 id="Unrolling-Parameters"><a href="#Unrolling-Parameters" class="headerlink" title="Unrolling Parameters"></a>Unrolling Parameters</h3><p>With neural networks, we are working with sets of matrices:<br>$$<br>\begin{array}{lll} \Theta^{(1)}, \Theta^{(2)}, \Theta^{(3)}, \dots \newline D^{(1)}, D^{(2)}, D^{(3)}, \dots \end{array}<br>$$<br>In order to use optimizing function such as <code>fminunc()</code>, we will want to <em>unroll</em> all the elements and put them into one long vector:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">thetaVector &#x3D; [ Theta1(:); Theta2(:); Theta3(:) ];</span><br><span class="line">deltaVector &#x3D; [ D1(:); D2(:); D3(:) ];</span><br></pre></td></tr></table></figure><p>If the dimensions of Theta1 is 10x11, Theta2 is 10x11 and Theta3 is 1x11, then we can get back our original matrices from the â€œunrolledâ€ versions as follows:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Theta1 &#x3D; reshape(thetaVector(1:110),10,11)</span><br><span class="line">Theta2 &#x3D; reshape(thetaVector(111:220),10,11)</span><br><span class="line">Theta3 &#x3D; reshape(thetaVector(221:231),1,11)</span><br></pre></td></tr></table></figure><p>To summarize:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g80ervs2l4j30ey06aq57.jpg" alt="img"></p><h3 id="Gradient-Checking"><a href="#Gradient-Checking" class="headerlink" title="Gradient Checking"></a>Gradient Checking</h3><p>Gradient checking will assure that our backpropagation works as intended. We can approximate the derivative of our cost function with:<br>$$<br>\frac{\partial}{\partial\Theta}J(\Theta) \approx \frac{J(\Theta+\epsilon)-J(\Theta-\epsilon)}{2\epsilon}<br>$$<br>A small value for $\epsilon$ such as $\epsilon=10^{-4}$, guarantees that the math works out properly. If the value for $\epsilon$, we can end up with numerical problems.</p><p>With multiple theta matrices, we can approximate the derivative with respect to $\Theta_j$ (where we get $j$ from 1 to n, for each one) as follows:<br>$$<br>\frac{\partial}{\partial\Theta_j}J(\Theta) \approx \frac{J(\Theta_1,â€¦,\Theta_j+\epsilon,â€¦,\Theta_n)-J(\Theta_1,â€¦,\Theta_j-\epsilon,â€¦,\Theta_n)}{2\epsilon}<br>$$<br>Hence, we are only adding or subtracting epsilon to the $\Theta_j$ matrix.</p><p>In octave we can do it as follows:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">epsilon &#x3D; 1e-4;</span><br><span class="line">for i &#x3D; 1 : n</span><br><span class="line">thetaPlus &#x3D; theta;</span><br><span class="line">thetaPlus(i) +&#x3D; epsilon;</span><br><span class="line">thetaMinus &#x3D; theta;</span><br><span class="line">thetaMinus(i) +&#x3D; epsilon;</span><br><span class="line">gradApprox(i) &#x3D; (J(thetaPlus) - J(thetaMinus)) &#x2F; (2*epsilon);</span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>We previously saw how to calculate the deltaVector. So once we compute our <code>gradApprox</code> vector, we can check that <code>gradApprox â‰ˆ deltaVector</code>. </p><p>Once we have verified <strong>once</strong> that your backpropagation algorithm is correct, we donâ€™t need to compute gradApprox again. The code to compute gradApprox can be very slow. So we guess itâ€™s better to turn off or disable the codes for gradient checking.</p><h3 id="Randoom-Initialization"><a href="#Randoom-Initialization" class="headerlink" title="Randoom Initialization"></a>Randoom Initialization</h3><p>Initializing all theta weights to zero does not work with neural networks. When we backpropagate, all nodes will update to the same value repeatedly. Instead we can randomly initialize our weights for our $\Theta$  matrices using the following method:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g84m3eabzfj30fb07qjsk.jpg" alt="img"></p><p>Hence, we initialize each $\Theta_{ij}^{(l)}$ to a random value between $[-\epsilon,\epsilon]$.  Using the above formula guarantees that we get the desired bound. The same procedure applies to all the $\Theta$â€™s. </p><p>Below is some working code implement.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># If the dimensions of Theta1 is 10x11, Theta2 is 10x11 and Theta3 is 1x11.</span><br><span class="line"></span><br><span class="line">Theta1 &#x3D; rand(10,11) * (2 * INIT_EPSILON) - INIT_EPSILON;</span><br><span class="line">Theta2 &#x3D; rand(10,11) * (2 * INIT_EPSILON) - INIT_EPSILON;</span><br><span class="line">Theta3 &#x3D; rand(1,11) * (2 * INIT_EPSILON) - INIT_EPSILON;</span><br></pre></td></tr></table></figure><p><code>rand(x,y)</code> is just a function in octave that will initialize a matrix of random real numbers between 0 and 1. </p><p>(Note: the epsilon used above is unrelated to the epsilon from Gradient Checking)</p><h3 id="Putting-It-Together"><a href="#Putting-It-Together" class="headerlink" title="Putting It Together"></a>Putting It Together</h3><p>First, pick a network architecture; choose the layout of your neural network, including how many hidden units in each layer and how many layers in total you want to have.</p><ul><li>Number of input units = dimension of features $x^{(i)}$</li><li>Number of output units = number of classes</li><li>Number of hidden units per layer = usually more the better (must balance with cost of computation as it increases with more hidden units)</li><li>Defaults: 1 hidden layer. If you have more than 1 hidden layer, then it is recommended that you have the same number of units in every hidden layer.</li></ul><p><strong>Training a Neural Network</strong></p><ol><li>Randomly initialize the weights</li><li>Implement forward propagation to get $h_\Theta(x^{(i)})$ for any $x^{(i)}$</li><li>Implement the cost function</li><li>Implement backpropagation to compute partial derivatives</li><li>Use gradient checking to confirm that your backpropagation works. Then disable gradient checking.</li><li>Use gradient descent or a built-in optimization function to minimize the cost function with the weights in theta.</li></ol><p>When we perform forward and back propagation, we loop on every training example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for i &#x3D; 1:m,</span><br><span class="line">   Perform forward propagation and backpropagation using example (x(i),y(i))</span><br><span class="line">   (Get activations a(l) and delta terms d(l) for l &#x3D; 2,...,L</span><br></pre></td></tr></table></figure><p>The following image gives us an intuition of what is happening as we are implementing our neural network: </p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g84ozcnlokj30eu08aq5g.jpg" alt="img"></p><p>Ideally, we want $h_\Theta(x^{(i)})\approx y^{(i)}$. This will minimize our cost function. However, keep in mind that $J(\Theta)$  is not convex and thus we can end up in a local minimum instead. </p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> AndrewNg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¥ç»ç½‘ç»œçš„æè¿°</title>
      <link href="/2019/10/13/AndrewNgML/AndrewNg-MachineLearning-8-NeuralNetworksRepresentation/"/>
      <url>/2019/10/13/AndrewNgML/AndrewNg-MachineLearning-8-NeuralNetworksRepresentation/</url>
      
        <content type="html"><![CDATA[<h1 id="Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-8-Neural-Networks-Representation"><a href="#Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-8-Neural-Networks-Representation" class="headerlink" title="Notes of Andrew Ngâ€™s Machine Learning â€”â€” (8) Neural Networks: Representation"></a>Notes of Andrew Ngâ€™s Machine Learning â€”â€” (8) Neural Networks: Representation</h1><h2 id="Model-Representation"><a href="#Model-Representation" class="headerlink" title="Model Representation"></a>Model Representation</h2><p>Letâ€™s examine how we will represent a hypothesis function using neural networks.</p><p>At a very simple level, neurons are basically computational units that take inputs (<strong>dendrites</strong>) as electrical inputs (called â€œspikesâ€) that are channeled to outputs (<strong>axons</strong>).</p><p>In our model, our dendrites are like the input features $x_1\cdots x_n$, and the output is the result of our hypothesis function.</p><p>In this model our $x_0$ input node is sometimes called the â€œbias unit.â€ It is always equal to 1.</p><p>In neural networks, we use the same logistic function as in classification, $\frac{1}{1+e^{-\theta^Tx}}$, yet we sometimes call it a sigmoid (logistic) <strong>activation</strong> function. In this situation, our â€œthetaâ€ parameters are sometimes called â€œweightsâ€.</p><p>Visually, a simplistic representation looks like:<br>$$<br>\left[\begin{array}{c}<br>x_0\x_1\x_2<br>\end{array}\right]<br>\to [\quad] \to h_\theta(x)<br>$$<br>Our input nodes (layer 1), also known as the â€œinput layerâ€, go into another node (layer 2), which finally outputs the hypothesis function, known as the â€œoutput layerâ€. We can have intermediate layers of nodes between the input and output layers called the â€œhidden layers.â€</p><p>In this example, we label these intermediate or â€œhiddenâ€ layer nodes $a^2_0 \cdots a^2_n$ and call them â€œactivation units.â€</p><ul><li>$a_i^{(j)}$ = â€œactivationâ€ of unit $i$ in layer $j$</li><li>$\Theta^{(j)}$ = matrix of weights controlling function mapping from layer $j$ to layer $j+1$</li></ul><p>If we had one hidden layer, it would look like:<br>$$<br>\left[\begin{array}{c}x_0 \ x_1 \ x_2 \ x_3\end{array}\right]\rightarrow\left[\begin{array}{c}a_1^{(2)} \ a_2^{(2)} \ a_3^{(2)} \ \end{array}\right]\rightarrow h_\theta(x)<br>$$<br>The values for each of the â€œactivationâ€ nodes is obtained as follows:<br>$$<br>\begin{array}{r} a_1^{(2)} = g(\Theta_{10}^{(1)}x_0 + \Theta_{11}^{(1)}x_1 + \Theta_{12}^{(1)}x_2 + \Theta_{13}^{(1)}x_3) \\ a_2^{(2)} = g(\Theta_{20}^{(1)}x_0 + \Theta_{21}^{(1)}x_1 + \Theta_{22}^{(1)}x_2 + \Theta_{23}^{(1)}x_3) \\ a_3^{(2)} = g(\Theta_{30}^{(1)}x_0 + \Theta_{31}^{(1)}x_1 + \Theta_{32}^{(1)}x_2 + \Theta_{33}^{(1)}x_3) \\ h_\Theta(x) = a_1^{(3)} = g(\Theta_{10}^{(2)}a_0^{(2)} + \Theta_{11}^{(2)}a_1^{(2)} + \Theta_{12}^{(2)}a_2^{(2)} + \Theta_{13}^{(2)}a_3^{(2)}) \\ \end{array}<br>$$<br>To do a vectorized implementation of thew above functions, weâ€™re going to define a new variable $z_k^{(j)}$ that encompasses the parameters inside our $g$ function. In the previous example if we replaced by the vartizble $z$ for all the parameters we would get:<br>$$<br>\begin{array}{l}a_1^{(2)} = g(z_1^{(2)}) \\ a_2^{(2)} = g(z_2^{(2)}) \\ a_3^{(2)} = g(z_3^{(2)}) \\ \end{array}<br>$$<br>In other words, for layer $j=2$ and node $k$, the variable $z$ will be:<br>$$<br>z_k^{(2)} = \Theta_{k,0}^{(1)}x_0 + \Theta_{k,1}^{(1)}x_1 + \cdots + \Theta_{k,n}^{(1)}x_n<br>$$<br>The vector representation of $x$ and $z^{j}$ is:<br>$$<br>x = \begin{bmatrix}x_0 \ x_1 \ \vdots \ x_n\end{bmatrix} \qquad z^{(j)} = \begin{bmatrix}z_1^{(j)} \ z_2^{(j)} \ \vdots \ z_n^{(j)}\end{bmatrix}<br>$$<br>Setting $x = a^{(1)}$, we can rewrite the equation as:<br>$$<br>z^{(j)} = \Theta^{(j-1)}a^{(j-1)}<br>$$<br>We are multiplying our matrix $\Theta^{(jâˆ’1)}$ with dimensions $s_j\times (n+1)$ (where $s_j$ is the number of our activation nodes) by our vector $a^{(j-1)}$ with height $(n+1)$. This gives us our vector $z^{(j)}$ with height $s_j$. Now we can get a vector of our activation nodes for layer $j$ as follows:<br>$$<br>a^{(j)} = g(z^{(j)})<br>$$<br>Where our function g can be applied element-wise to our vector $z^{(j)}$.</p><p>We can then add a bias unit (equal to $1$) to layer $j$ after we have computed $a^{(j)}$. This will be element $a_0^{(j)}$ and will be equal to $1$. To compute our final hypothesis, letâ€™s first compute another $z$ vector:<br>$$<br>z^{(j+1)} = \Theta^{(j)}a^{(j)}<br>$$<br>We get this final $z$ vector by multiplying the next theta matrix after $\Theta^{(jâˆ’1)}$ with the values of all the activation nodes we just got. This last theta matrix $\Theta^{(j)}$ will have only <strong>one row</strong> which is multiplied by one column $a^{(j)}$ so that our result is a single number. We then get our final result with:<br>$$<br>h_\Theta(x)=a^{(j+1)}=g(z^{(j+1)})<br>$$<br>Notice that in this <strong>last step</strong>, between layer $j$ and layer $j+1$, we are doing <strong>exactly the same thing</strong> as we did in logistic regression. Adding all these intermediate layers in neural networks allows us to more elegantly produce interesting and more complex non-linear hypotheses.</p><h2 id="Examples-and-Intuitions"><a href="#Examples-and-Intuitions" class="headerlink" title="Examples and Intuitions"></a>Examples and Intuitions</h2><p>A simple example of applying neural networks is by predicting $x_1 \and x_2$, which is the logical â€˜andâ€™ operator and is only true if both $x_1$ and $x_2$ are $1$. The graph of our functions will look like:<br>$$<br>\begin{array}{c}\begin{bmatrix}x_0 \ x_1 \ x_2\end{bmatrix} \rightarrow\begin{bmatrix}g(z^{(2)})\end{bmatrix} \rightarrow h_\Theta(x)\end{array}<br>$$<br>Remember that $x_0$ is our bias variable and is always $1$. The $g(z)$ is the following:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7qukjiuo1j308h04d0sv.jpg" alt="img"></p><p>Letâ€™s set our first Theta matrix as:<br>$$<br>\Theta^{(1)}=\begin{bmatrix} -30 &amp; 20 &amp; 20 \end{bmatrix}<br>$$<br>This will cause the output of our hypothesis to only be positive if both $x_1$ and $x_2$ are $1$. In other words:<br>$$<br>\begin{array}{ll}&amp; h_\Theta(x) = g(-30 + 20x_1 + 20x_2) \ \ &amp; x_1 = 0 \ \ and \ \ x_2 = 0 \ \ then \ \ g(-30) \approx 0 \ &amp; x_1 = 0 \ \ and \ \ x_2 = 1 \ \ then \ \ g(-10) \approx 0 \ &amp; x_1 = 1 \ \ and \ \ x_2 = 0 \ \ then \ \ g(-10) \approx 0 \ &amp; x_1 = 1 \ \ and \ \ x_2 = 1 \ \ then \ \ g(10) \approx 1\end{array}<br>$$<br>So we have constructed one of the fundamental operations in computers by using a small neural network rather than using an actual AND gate. Neural networks can also be used to simulate all the other logical gates. The following is an example of the logical operator â€˜ORâ€™, meaning either $x_1$ is true or $x_2$ is true, or both:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g7qukcx6wij30gb07raaw.jpg" alt="f_ueJLGnEea3qApInhZCFg_a5ff8edc62c9a09900eae075e8502e34_Screenshot-2016-11-23-10.03.48"></p><h3 id="A-Neural-Network-for-XNOR"><a href="#A-Neural-Network-for-XNOR" class="headerlink" title="A Neural Network for XNOR"></a>A Neural Network for <code>XNOR</code></h3><p>The $\Theta^{(1)}$ matrices for <code>AND</code>, <code>NOR</code> and <code>OR</code> are:<br>$$<br>\begin{array}{l}AND:\&amp;\Theta^{(1)} &amp;=\begin{bmatrix}-30 &amp; 20 &amp; 20\end{bmatrix} \ NOR:\&amp;\Theta^{(1)} &amp;= \begin{bmatrix}10 &amp; -20 &amp; -20\end{bmatrix} \ OR:\&amp;\Theta^{(1)} &amp;= \begin{bmatrix}-10 &amp; 20 &amp; 20\end{bmatrix} \\end{array}<br>$$</p><p>We can combine these to get the <code>XNOR</code> logical operator (which gives $1$ if $x_1$ and $x_2$ are both $0$ or both $1$):<br>$$<br>\begin{bmatrix}x_0 \ x_1 \ x_2\end{bmatrix} \rightarrow\begin{bmatrix}a_1^{(2)} \ a_2^{(2)} \end{bmatrix} \rightarrow\begin{bmatrix}a^{(3)}\end{bmatrix} \rightarrow h_\Theta(x)<br>$$<br>For the transition between the first and second layer, weâ€™ll use a $\Theta^{(1)}$ matrix that combines the values for AND and NOR:<br>$$<br>\Theta^{(1)} =\begin{bmatrix}-30 &amp; 20 &amp; 20 \ 10 &amp; -20 &amp; -20\end{bmatrix}<br>$$<br>For the transition between the second and third layer, weâ€™ll use a $\Theta^{(2)}$ matrix that uses the value for OR:<br>$$<br>\Theta^{(2)} =\begin{bmatrix}-10 &amp; 20 &amp; 20\end{bmatrix}<br>$$<br>Letâ€™s write out the values for all our nodes:<br>$$<br>\begin{array}{ll}&amp; a^{(2)} = g(\Theta^{(1)} \cdot x) \&amp; a^{(3)} = g(\Theta^{(2)} \cdot a^{(2)}) \&amp; h_\Theta(x) = a^{(3)}\end{array}<br>$$<br>And there we have the XNOR operator using a hidden layer with two nodes! The following summarizes the above algorithm:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7vfhtjp3aj30hb09h40o.jpg" alt="rag_zbGqEeaSmhJaoV5QvA_52c04a987dcb692da8979a2198f3d8d7_Screenshot-2016-11-23-10.28.41"></p><h2 id="Multiclass-Classification"><a href="#Multiclass-Classification" class="headerlink" title="Multiclass Classification"></a>Multiclass Classification</h2><p>To classify data into multiple classes, we let our hypothesis function return a vector of values. Say we wanted to classify our data into one of four categories. We will use the following example to see how this classification is done. This algorithm takes as input an image and classifies it accordingly: </p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7vhuzddrnj30h309en0f.jpg" alt="9Aeo6bGtEea4MxKdJPaTxA_4febc7ec9ac9dd0e4309bd1778171d36_Screenshot-2016-11-23-10.49.05"></p><p>We can define our set of resulting classes as y:<br>$$<br>y^{(i)}=\begin{bmatrix}1\0\0\0\end{bmatrix},\begin{bmatrix}0\1\0\0\end{bmatrix},\begin{bmatrix}0\0\1\0\end{bmatrix},\begin{bmatrix}0\0\0\1\end{bmatrix}<br>$$<br>Each $y^{(i)}$ represents a different image corresponding to either a car, pedestrian, truck, or motorcycle. The inner layers, each provide us with some new information which leads to our final hypothesis function. The setup looks like:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7vhzbeut9j308u02w3yn.jpg" alt="VBxpV7GvEeamBAoLccicqA_3e7f67888330b131426ecffd27936f61_Screenshot-2016-11-23-10.59.19"></p><p>Our resulting hypothesis for one set of inputs may look like:<br>$$<br>h_\Theta(x) =\begin{bmatrix}0 \ 0 \ 1 \ 0 \end{bmatrix}<br>$$<br>In which case our resulting class is the third one down, or $h_{\Theta}(x)_3$, which represents the motorcycle. </p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> AndrewNg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿‡æ‹Ÿåˆ</title>
      <link href="/2019/09/26/AndrewNgML/AndrewNg-MachineLearning-7-Overfitting/"/>
      <url>/2019/09/26/AndrewNgML/AndrewNg-MachineLearning-7-Overfitting/</url>
      
        <content type="html"><![CDATA[<h1 id="Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-7-Overfitting"><a href="#Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-7-Overfitting" class="headerlink" title="Notes of Andrew Ngâ€™s Machine Learning â€”â€” (7) Overfitting"></a>Notes of Andrew Ngâ€™s Machine Learning â€”â€” (7) Overfitting</h1><h2 id="The-Problem-of-Overfitting"><a href="#The-Problem-of-Overfitting" class="headerlink" title="The Problem of Overfitting"></a>The Problem of Overfitting</h2><p>Consider the problem of predicting $y$ from $x \in \R$. The leftmost figure below shows the result of fitting a $y=\theta_0+\theta_1x$ to a dataset. We see that the data doesnâ€™t really lie on straight line, and so the fit is not very good.</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7aopbltb1j30f0046dg2.jpg" alt="img"></p><p>Instead, if we had added an extra feature $x^2$, and fit $y=\theta_0+\theta_1+\theta_2x^2$, then we obtain a slightly better fit to the data (See middle figure).</p><p>Naively, it might seem that the more features we add, the better. However, there is also a danger in adding too many features: The rightmost figure is the result of fitting a $5^{th}$ order polynomial $y = \sum_{j=0} ^5 \theta_j x^j$. We see that even though the fitted curve passes through the data perfectly, we would not expect this to be a very good predictor for unseen examples.</p><p>The figure on the left shows an instance of <strong>underfitting</strong>â€”in which the data clearly shows structure not captured by the model</p><blockquote><p><strong><code>Underfitting</code></strong>, or <em>high bias</em>, is when the form of our hypothesis function h maps poorly to the trend of the data. It is usually caused by a function that is too simple or uses too few features.</p></blockquote><p>The figure on the right is an example of <strong>overfitting</strong>.</p><blockquote><p><strong><code>Overfitting</code></strong>, or <em>high variance</em>, is caused by a hypothesis function that makes accurate predictions for examples in the training set, but it does not generalize well to make accurate predictions on new, previously unseen examples. It is usually caused by a complicated function that creates a lot of unnecessary curves and angles unrelated to the data.</p></blockquote><p><code>Overfitting</code> is applied to both linear and logistic regression. There are two main options to address the issue of overfitting:</p><ol><li>Reduce the number of features:</li></ol><ul><li>Manually select which features to keep.</li><li>Use a model selection algorithm (studied later in the course).</li></ul><ol start="2"><li>Regularization</li></ol><ul><li>Keep all the features, but reduce the magnitude of parameters $\theta_j$.</li><li>Regularization works well when we have a lot of slightly useful features.</li></ul><h2 id="Cost-Function"><a href="#Cost-Function" class="headerlink" title="Cost Function"></a>Cost Function</h2><p>If we have overfitting from our hypothesis function, we can reduce the weight that some of the terms in our function carry by increasing their cost.</p><p>Say we wanted to make the following function more quadratic:<br>$$<br>\theta_0 + \theta_1x + \theta_2x^2 + \theta_3x^3 + \theta_4x^4<br>$$</p><p>Weâ€™ll want to eliminate the influence of $\theta_3x^3$ and $\theta_4x^4$ . Without actually getting rid of these features or changing the form of our hypothesis, we can instead modify our <strong>cost function</strong>:<br>$$<br>min_\theta\ \dfrac{1}{2m}\sum_{i=1}^m (h_\theta(x^{(i)}) - y^{(i)})^2 + 1000\cdot\theta_3^2 + 1000\cdot\theta_4^2<br>$$</p><p>Weâ€™ve added two extra terms at the end to inflate the cost of $\theta_3$ and $\theta_4$. Now, in order for the cost function to get close to zero, we will have to reduce the values of $\theta_3$ and $\theta_4$ to near zero. This will in turn greatly reduce the values of $\theta_3x^3$ and $\theta_4x^4$ in our hypothesis function. As a result, we see that the new hypothesis (depicted by the pink curve) looks like a quadratic function but fits the data better due to the extra small terms $\theta_3x^3$ and $\theta_4x^4$.</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7aq081c3hj30gh091wfl.jpg" alt="img"></p><p>We could also <em>regularize all of our theta parameters</em> in a single summation as:</p><p>$$<br>\mathop{min}\limits_{\theta} \dfrac{1}{2m}\ \sum_{i=1}^m (h_\theta(x^{(i)}) - y^{(i)})^2 + \lambda\ \sum_{j=1}^n \theta_j^2<br>$$</p><p>The $\lambda$, or lambda, is the <strong>regularization parameter</strong>. It determines how much the costs of our theta parameters are inflated.</p><p>Using the above cost function with the extra summation, we can smooth the output of our hypothesis function to reduce overfitting.</p><p>Note. If lambda is chosen to be too large, it may smooth out the function too much and cause underfitting.</p><h2 id="Regularized-Linear-Regression"><a href="#Regularized-Linear-Regression" class="headerlink" title="Regularized Linear Regression"></a>Regularized Linear Regression</h2><p>We can apply regularization to both linear regression and logistic regression. </p><h3 id="Gradient-Descent"><a href="#Gradient-Descent" class="headerlink" title="Gradient Descent"></a>Gradient Descent</h3><p>We will modify our gradient descent function to separate out $\theta_0$ from the rest of the parameters because we do not want to penalize $\theta_0$.<br>$$<br>\begin{array}{l}<br>Repeat\quad{\<br>\qquad \theta_0:=\theta_0-\alpha\frac{1}{m}\sum_{i=1}^m\big(h_\theta(x^{(i)})-y^{(i)}\big)x_0^{(i)}\<br>\qquad \theta_j:=\theta_j-\alpha\Big[\Big(\frac{1}{m}\sum_{i=1}^m\big(h_\theta(x^{(i)})-y^{(i)}\big)x_j^{i}\Big)+\frac{\lambda}{m}\theta_j\Big]\qquad j\in{1,2,\cdots,n}\<br>}<br>\end{array}<br>$$<br>The term $\frac{\lambda}{m}\theta_j$ performs our regularization. With some manipulation our update rule can also be represented as:<br>$$<br>\theta_j:=\theta_j(1-\alpha\frac{\lambda}{m})-\alpha\frac{1}{m}\sum_{i=1}^{m}\Big(h_\theta(x^{(i)})-y^{(i)}\Big)x_j^{(i)}<br>$$<br>The first term in the above equation, $(1-\alpha\frac{\lambda}{m})$ will always be less than $1$. Intuitively we can see it as reducing the value of $\theta_j$ by some amount on every update. Notice that the second term is now exactly the same as it was before.</p><h3 id="Normal-Equation"><a href="#Normal-Equation" class="headerlink" title="Normal Equation"></a>Normal Equation</h3><p>Now letâ€™s approach regularization using the alternate method of the non-iterative normal equation.</p><p>To add in regularization, the equation is the same as our original, except that we add another term inside the parentheses:<br>$$<br>\begin{array}{l}<br>\theta=(X^TX+\lambda \cdot L)^{-1}X^Ty\<br>\textrm{where}\quad L=\left[\begin{array}{cccc}<br>0\<br>&amp;1\<br>&amp;&amp;1\<br>&amp;&amp;&amp;\ddots\<br>&amp;&amp;&amp;&amp;1<br>\end{array}\right]<br>\end{array}<br>$$<br>$L$ is a matrix with $0$ at the top left and $1$â€™s down the diagonal, with $0$â€™s everywhere else. It should have dimension $(n+1)Ã—(n+1)$. Intuitively, this is the identity matrix (though we are not including $x_0$), multiplied with a single real number Î».</p><p>Recall that if $m&lt;n$, then $X^TX$ is non-invertible. However, when we add the term $\lambda\cdot L$, then $X^TX+\lambda\cdot L$ becomes invertible.</p><h2 id="Regularized-Logistic-Regression"><a href="#Regularized-Logistic-Regression" class="headerlink" title="Regularized Logistic Regression"></a>Regularized Logistic Regression</h2><p>We can regularize logistic regression in a similar way that we regularize linear regression. As a result, we can avoid overfitting. The following image shows how the regularized function, displayed by the pink line, is less likely to overfit than the non-regularized function represented by the blue line:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7axj9vr5xj30do07edh2.jpg" alt="img"></p><p>Recall that our cost function for logistic regression was:<br>$$<br>J(\theta) = - \frac{1}{m} \sum_{i=1}^m \Big[ y^{(i)}\ \log \big(h_\theta (x^{(i)})\big) + (1 - y^{(i)})\ \log \big(1 - h_\theta(x^{(i)})\big) \Big]<br>$$</p><p>We can regularize this equation by adding a term to the end:<br>$$<br>J(\theta) = - \frac{1}{m} \sum_{i=1}^m \large[ y^{(i)}\ \log (h_\theta (x^{(i)})) + (1 - y^{(i)})\ \log (1 - h_\theta(x^{(i)}))\large] + \frac{\lambda}{2m}\sum_{j=1}^n \theta_j^2<br>$$</p><p>The second sum, $\sum_{j=1}^n \theta_j^2$ <strong>means to explicitly exclude</strong> the bias term, $\theta_0$. I.e. the $\theta$ vector is indexed from $0$ to $n$ (holding $n+1$ values, $\theta_0$ through $\theta_n$), and this sum explicitly skips $\theta_0$, by running from $1$ to $n$, skipping $0$. Thus, when computing the equation, we should continuously update the two following equations:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g7axue4ykpj30de06h75k.jpg" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> AndrewNg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†ç±»é—®é¢˜</title>
      <link href="/2019/09/24/AndrewNgML/AndrewNg-MachineLearning-6-Classification/"/>
      <url>/2019/09/24/AndrewNgML/AndrewNg-MachineLearning-6-Classification/</url>
      
        <content type="html"><![CDATA[<h1 id="Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-6-Classification"><a href="#Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-6-Classification" class="headerlink" title="Notes of Andrew Ngâ€™s Machine Learning â€”â€” (6) Classification"></a>Notes of Andrew Ngâ€™s Machine Learning â€”â€” (6) Classification</h1><h2 id="Intro-of-Classification"><a href="#Intro-of-Classification" class="headerlink" title="Intro of Classification"></a>Intro of Classification</h2><p>Classification problems are something like giving a patient with a tumor, we have to predict whether the tumor is malignant or benign. Itâ€™s expected to output <strong>discrete</strong> values.</p><p>The classification problem is just like the regression problem, except that the values we want to predict take on only a small number of discrete values. For now, we will focus on the <strong>binary classification problem</strong> in which <code>y</code> can take only two values, <code>0</code> and <code>1</code>. </p><p>For instance, if we are trying to build a spam classifier for email, then $x^{(i)}$ may be some features of a piece of email, and $y$ may be <code>1</code> if it is a piece of spam mail, and <code>0</code> otherwise. Hence, $y \in {0,1}$. <code>0</code> is also called the <em>negative class</em>, and <code>1</code> the <em>positive class</em>, and they are sometimes also denoted by the symbols <code>-</code> and <code>+</code>. Given $x^{(i)}$, the corresponding $y^{(i)}$ is also called <em>the label for the training example</em>.</p><p>To attempt classification, one method is to use linear refression and map all predictions greater than <code>0.5</code> as a <code>1</code> and all less than <code>0.5</code> as a <code>0</code>. However, this method doesnâ€™t work because classification is not actually a linear function. So what we actually do to solve classification problems is an algorithm named <strong>logistic regression</strong>. Note that even be called <em>regression</em>, it is actually to do classification.</p><h2 id="Logistic-Regression"><a href="#Logistic-Regression" class="headerlink" title="Logistic Regression"></a>Logistic Regression</h2><h3 id="Hypothesis-Representation"><a href="#Hypothesis-Representation" class="headerlink" title="Hypothesis Representation"></a>Hypothesis Representation</h3><p>We could approach the classification problem ignoring the fact that <code>y</code> is discrete-valued, and use our old linear regression algorithm to try to predict <code>y</code> given <code>x</code>. However it is easy to construct examples where this method performs very poorly.</p><p>Intuitively, it also doesnâ€™t make sense for $h_\theta(x)$ to take values larger than <code>1</code> or smaller then <code>0</code> when we know that $y\in{0,1}$. To fix this, letâ€™s change our hypotheses $h_\theta(x)$ to satisfy $0 \le h_\theta(x) \le 1$. This accomplished by plugging $\theta^Tx$ into the <strong>Logistic Function</strong>.</p><p>The the <strong>Simoid Function</strong>, also called the <strong>Logistic Function</strong> is this:<br>$$<br>y = \frac{1}{1+e^{-x}}<br>$$<br>It looks like the following image:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g72ld52460j30ur0g8ta7.jpg" alt="image-20190917162504420"></p><p>Our new form uses the Simoid Function:<br>$$<br>\begin{array}{l}h_\theta(x) = g(\theta^Tx)\z = \theta^Tx\g(z) = \frac{1}{1+e^{-z}}\end{array}<br>$$<br>The logistic function $g(z)$ maps any real numbers to the $(0,1)$ interval, making it useful for transforming a arbitrary-valued function into a function better suited for classfication.</p><p>We can also simply write $h_\theta(x)$ like this:<br>$$<br>h_\theta(X) = \frac{1}{1+e^{-\theta^Tx}}<br>$$<br><strong>$h_\theta(x)$ will output the probalility that our output is <code>1</code>.</strong> For example, $h_\theta(x)=0.7$ gives us a probability of $70%$ that our output is $1$ (then the probability that it is 0 is 30%):<br>$$<br>\begin{array}{l}<br>h_\theta(x)=P(y=1 \mid x;\theta)=1-P(y=0 \mid x; \theta)\<br>P(y=0 \mid x;\theta) + P(y=1 \mid x;\theta) = 1<br>\end{array}<br>$$</p><h3 id="Decision-Boundary"><a href="#Decision-Boundary" class="headerlink" title="Decision Boundary"></a>Decision Boundary</h3><p>In order to get our discrete <code>0</code> or <code>1</code> classification, we can translate the output of the hyporithesis function as follows:<br>$$<br>\begin{array}{rcl}<br>h_\theta(x) \ge 0.5 &amp;\Rightarrow&amp; y=1\<br>h_\theta(x) &lt; 0.5 &amp;\Rightarrow&amp; y=0<br>\end{array}<br>$$<br>The way our logistic function $g$ behaves is that when its input is $\ge 0$, its output is $\ge 0.5$:<br>$$<br>g(z) \ge 0.5 \quad when \quad z \ge 0<br>$$<br>In fact, we know that:<br>$$<br>\begin{array}{lclcl}<br>z \to -\infin &amp;,&amp; e^{\infin} \to \infin &amp; \Rightarrow &amp; g(z) \to 0\<br>z \to 0 &amp;,&amp; e^{0} \to 1 &amp; \Rightarrow &amp; g(z) \to 0.5\<br>z \to +\infin &amp;,&amp; e^{-\infin} \to 0 &amp; \Rightarrow &amp; g(z) \to 1<br>\end{array}<br>$$<br>So if our input to $g$ is $\theta^TX$, then that means:<br>$$<br>h_\theta(X) = g(\theta^TX) \ge 0.5 \quad when \quad \theta^TX \ge 0<br>$$<br>From these statements we can now say:<br>$$<br>\begin{array}{rcl}<br>\theta^TX \ge 0 &amp;\Rightarrow&amp; y=1\<br>\theta^TX \le 0 &amp;\Rightarrow&amp; y=0\<br>\end{array}<br>$$<br>The <strong>decision boundary</strong> is the line that separates the area where $y=0$ and where $y=1$. It is created by our hypothesis function.</p><p>Example:<br>$$<br>\theta=\left[ \begin{array}{c}<br>5\<br>-1\<br>0<br>\end{array} \right]<br>$$<br>In this case, $y=1$ if $5+(-1)x_1+0x_2 \ge 0$ , i.e. $x_1 \le 5$. Our boundary is a straight vertical line placed on the graph where $x_1=5$, and everything to the left of that denotes $y=1$, while everything to the right denotes $y=0$:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g72ng9ovwsj306e04u74d.jpg" alt="image-20190917173722734"></p><p>Another example:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g72niix9vaj30m20cin2i.jpg" alt="image-20190917173931467"></p><p>Non-linear decision boundaries:</p><p>The input to the sigmoid function g(z) (e.g. $\theta^TX$) doesnâ€™t need to be linear, and could be a function that describes a circle (e.g. $z=\theta_0+\theta_1x_1^2+\theta_2x_2^2$) or any shape to fit our data.</p><p>Example:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g72nku2lrxj30mv08xtcy.jpg" alt="image-20190917174144868"></p><h3 id="Logistic-Regression-Model"><a href="#Logistic-Regression-Model" class="headerlink" title="Logistic Regression Model"></a>Logistic Regression Model</h3><p>In this part, we will implement the logistic regression model.<br>$$<br>\begin{array}{rcl}<br>\textrm{Training set} &amp;:&amp; {(x^{(1)},y^{(1)}), (x^{(2)},y^{(2)}), \ldots, (x^{(m)},y^{(m)})}\<br>\<br>\textrm{m examples} &amp;:&amp;<br>x \in \left[\begin{array}{c}<br>x_0\x_1\ \vdots \ x_n<br>\end{array}\right] \textrm{where }(x_0=1)<br>,\quad y \in {0,1}\<br>\<br>\textrm{Hypothesis} &amp;:&amp; h_\theta(x)=\frac{1}{1+e^{-\theta^Tx}}<br>\end{array}<br>$$</p><h4 id="Cost-Function"><a href="#Cost-Function" class="headerlink" title="Cost Function"></a>Cost Function</h4><p>If we use the same cost function that we use for <em>linear regression</em> ($J(\theta)=\frac{1}{m}\sum_{i=1}^m\frac{1}{2}(h_\theta(x^{(i)})-y^{(i)})^2$) for logistic regression, it will be <strong>non-convex</strong> (that looks wavy), which is causing many local optima and hard to find the global minimum.</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g757sf5lm8j30f504w3zi.jpg" alt="å±å¹•å¿«ç…§ 2019-09-19 22.49.53"></p><p>So, what we actually need is our new <strong>Logistic Regression Cost Function</strong>, which guarantees that $J(\theta)$ is convex for logistic regression.<br>$$<br>\begin{array}{l}<br>J(\theta)=\frac{1}{m}\sum_{i=1}^{m}Cost(h_\theta(x^{(i)},y^{(i)}))\<br>\<br>Cost(h_\theta(x),y)=\left{\begin{array}{rl}<br>-log(h_\theta(x)) &amp; \textrm{ if}\quad y=1\<br>-log(1-h_\theta(x)) &amp; \textrm{ if}\quad y=0<br>\end{array}\right.<br>\end{array}<br>$$<br>The â€œ$J(\theta)$-$h_\theta(x)$â€ plots is like this:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g758q7xincj31lc0mq76b.jpg" alt="å±å¹•å¿«ç…§ 2019-09-19 23.23.39"></p><p>Letâ€™s take a look at the $Cost(h_\theta(x),y)$ :<br>$$<br>\begin{array}{lcl}Cost(h_\theta(x),y) = 0 &amp;\textrm{if}&amp; h_\theta(x)=y\Cost(h_\theta(x),y) \to \infin &amp;\textrm{if}&amp; y=0 \quad&amp;\quad h_\theta(x) \to 1\Cost(h_\theta(x),y) \to \infin &amp;\textrm{if}&amp; y=1 \quad&amp;\quad h_\theta(x) \to 0\\end{array}<br>$$</p><blockquote><p> If our correct answer â€˜yâ€™ is 0, then the cost function will be 0 if our hypothesis function also outputs 0. If our hypothesis approaches 1, then the cost function will approach infinity.</p><p>If our correct answer â€˜yâ€™ is 1, then the cost function will be 0 if our hypothesis function outputs 1. If our hypothesis approaches 0, then the cost function will approach infinity.</p></blockquote><h4 id="Simplified-Cost-Function"><a href="#Simplified-Cost-Function" class="headerlink" title="Simplified Cost Function"></a>Simplified Cost Function</h4><p>We can simplify the $Cost$ function by compressing the two conditional cases into one case:<br>$$<br>Cost(h_\theta(x),y)=-y \cdot log(h_\theta(x))-(1-y) \cdot log(1-h_\theta(x))<br>$$<br>In this definition, when $y=0$, the term $-(1-y) \cdot log(1-h_\theta(x))$ will be $0$; when $y=0$, the term $-y \cdot log(h_\theta(x))$ will be $0$. Obviously, this is equal to the previous one but more easy to implement.</p><p>Now, we can fully write out our entire cost function as follow:<br>$$<br>J(\theta)=-\frac{1}{m}\sum_{i=1}^m\Bigg[y^{(i)}log\Big(h_\theta(x)\Big)+(1-y^{(i)})log\Big(1-h_\theta(x^{(i)})\Big)\Bigg]<br>$$<br>And a <strong>vectorized</strong> implementation is:<br>$$<br>\begin{array}{l}<br>h=g(X\theta)\<br>J(\theta)=\frac{1}{m}\cdot\big(-y^T log(h) -(1-y)^T log(1-h)\big)<br>\end{array}<br>$$</p><h4 id="Gradient-Descent"><a href="#Gradient-Descent" class="headerlink" title="Gradient Descent"></a>Gradient Descent</h4><p>The general form of gradient descent is:<br>$$<br>\begin{array}{l}<br>Repeat \quad {\<br>\qquad \theta_j:=\theta_j-\alpha\frac{\partial}{\partial\theta_j}J(\theta)\<br>}<br>\end{array}<br>$$<br>Work out the derivative part using calculus to get:<br>$$<br>\begin{array}{l}<br>Repeat \quad {\<br>\qquad \theta_j:=\theta_j-\frac{\alpha}{m}\sum_{i=1}^m(h_\theta(x^{(i)})-y^{(i)})\cdot x_j^{(i)}\<br>}<br>\end{array}<br>$$<br>Actually, this algorithm is identical to the one we used in linear regression. And notice that we still have to simultaneously update all values in theta.</p><p><strong>Vectorized implementation</strong>:<br>$$<br>\theta:=\theta-\frac{\alpha}{m}X^T(g(X\theta)-\overrightarrow{y})<br>$$</p><h2 id="Advanced-Optimization"><a href="#Advanced-Optimization" class="headerlink" title="Advanced Optimization"></a>Advanced Optimization</h2><p>There are many more sophisticated, faster ways to optimize $\theta$ that can be used instead of gradient descent, such as â€œ<em>Conjugate gradient</em>â€œ, â€œ<em>BFGS</em>â€œ and â€œ<em>L-BFGS</em>â€œ.</p><p>We are not suggest to write these more sophisticated algorithms ourself but use the libraries instead, as theyâ€™re already tested and highly optimized. Octave provides them.</p><p>We can use octaveâ€™s <code>fminunc()</code> optimization algorithm to do that.</p><p>To use this advanced optimization, we first need to provide a function that evaluates the following two functions for a given inpuit value $\theta$:<br>$$<br>J(\theta), \qquad \frac{\partial}{\partial\theta_j}J(\theta)<br>$$<br>We can write a single function that retunrs both of these:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function [jVal, gradient] &#x3D; costFunction(theta)</span><br><span class="line">jVal &#x3D; &lt;code to compute J(theta)&gt;</span><br><span class="line">gradient &#x3D; &lt;code to compute derivative of J(theta)&gt;</span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>Then we are going to set a <code>optimset</code> and a initial theta as well, then send them to <code>fminunc()</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">options &#x3D; optimset(&#39;GradObj&#39;, &#39;on&#39;, &#39;MaxIter&#39;, 100);</span><br><span class="line">initialTheta &#x3D; zeros(2, 1);</span><br><span class="line"></span><br><span class="line">[optTheta, functionVal, exitFlag] &#x3D; fminunc(@costFunction, initialTheta, options);</span><br></pre></td></tr></table></figure><h2 id="Multiclass-Classification"><a href="#Multiclass-Classification" class="headerlink" title="Multiclass Classification"></a>Multiclass Classification</h2><p>Now we will approach the classification of data when we have more than two categories. Instead of $y={0,1}$ we will expand our definition so that $y={0,1â€¦n}$.</p><p>Since $y={0,1â€¦n}$, we divide our problem into $n+1$ ($+1$ because the index starts at $0$) binary classification problems; in each one, we predict the probability that â€˜$y$â€™ is a member of one of our classes.<br>$$<br>\begin{array}{l}<br>y \in {0,1,\cdots,n}\\<br>h_\theta^{(0)}(x)=P(y=0|x;\theta)\<br>h_\theta^{(0)}(x)=P(y=0|x;\theta)\<br>\vdots\<br>h_\theta^{(0)}(x)=P(y=0|x;\theta)\\<br>prediction = \mathop{max}\limits_{\theta}\big(h_\theta^{(i)}(x)\big)<br>\end{array}<br>$$<br>We are basically choosing one class and then lumping all the others into a single second class. We do this repeatedly, applying binary logistic regression to each case, and then use the hypothesis that returned the highest value as our prediction.</p><p>The following image shows how one could classify 3 classes:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g78nj8fvy4j30d507agmp.jpg" alt="img"></p><p><strong>To summarize:</strong></p><p>Train a logistic regression classifier $h_\theta(x)$ for each classï¿¼ to predict the probability that ï¿¼ ï¿¼$y=i$ï¿¼ ï¿¼. To make a prediction on a new $x$, pick the class ï¿¼that maximizes $h_\theta(x)$.</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> AndrewNg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”¨ Python åšæ•°å­¦å»ºæ¨¡</title>
      <link href="/2019/09/17/blog/MathematicalModelingWithPython/"/>
      <url>/2019/09/17/blog/MathematicalModelingWithPython/</url>
      
        <content type="html"><![CDATA[<h1 id="ç”¨-Python-åšæ•°å­¦å»ºæ¨¡"><a href="#ç”¨-Python-åšæ•°å­¦å»ºæ¨¡" class="headerlink" title="ç”¨ Python åšæ•°å­¦å»ºæ¨¡"></a>ç”¨ Python åšæ•°å­¦å»ºæ¨¡</h1><h2 id="çº¿æ€§è§„åˆ’"><a href="#çº¿æ€§è§„åˆ’" class="headerlink" title="çº¿æ€§è§„åˆ’"></a>çº¿æ€§è§„åˆ’</h2><blockquote><p>ç¬¬ä¸‰æ–¹ä¾èµ–åº“ï¼š<code>scipy</code>ã€‚</p></blockquote><p>ç”¨ <code>scipy.optimize.linprog</code> å¯ä»¥è§£çº¿æ€§è§„åˆ’é—®é¢˜ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">linprog(c, A_ub=<span class="literal">None</span>, b_ub=<span class="literal">None</span>, A_eq=<span class="literal">None</span>, b_eq=<span class="literal">None</span>, bounds=<span class="literal">None</span>, method=<span class="string">&#x27;simplex&#x27;</span>, callback=<span class="literal">None</span>, options=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><p>å…¶è§„å®šçš„é—®é¢˜æ ‡å‡†å‹å¼ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Minimize:     c^T * x</span><br><span class="line">    </span><br><span class="line">Subject to:   A_ub * x &lt;&#x3D; b_ub</span><br><span class="line">              A_eq * x &#x3D;&#x3D; b_eq</span><br></pre></td></tr></table></figure><p>e.g. æ±‚æ¥ä¸‹åˆ—çº¿æ€§è§„åˆ’é—®é¢˜ï¼š<br>$$<br>\textrm{max } z=2x_1+3x_2-5x_3,\<br>\textrm{s.t. } \left { \begin{array}{ll}<br>x_1+x_2+x_3=7\<br>2x_1-5x_2+x_3\ge10\<br>x_1+3x_2+x_3\le12\<br>x_1,x_2,x_3\ge0<br>\end{array}\right.<br>$$<br><strong>è§£</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> scipy <span class="keyword">import</span> optimize</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c = [-<span class="number">2</span>, -<span class="number">3</span>, <span class="number">5</span>]</span><br><span class="line">a = [[-<span class="number">2</span>, <span class="number">5</span>, -<span class="number">1</span>], [<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>]]</span><br><span class="line">b = [-<span class="number">10</span>, <span class="number">12</span>]</span><br><span class="line">aeq = [[<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]]</span><br><span class="line">beq = [<span class="number">7</span>]</span><br><span class="line">bounds = [[<span class="number">0</span>, <span class="literal">None</span>], [<span class="number">0</span>, <span class="literal">None</span>], [<span class="number">0</span>, <span class="literal">None</span>]]<span class="comment"># (0, None) means non-negative, this is a default value</span></span><br><span class="line">result = optimize.linprog(c, a, b, aeq, beq, bounds)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><blockquote><p>âš ï¸ã€æ³¨æ„ã€‘è¿™é‡Œé¢˜ç›®æ˜¯æ±‚maxï¼Œæ ‡å‡†å‹æ˜¯minï¼Œæ‰€ä»¥åœ¨å†™<code>c</code>çŸ©é˜µçš„æ—¶å€™æŠŠå€¼éƒ½å†™æˆäº†é¢˜ç›®ä¸­çš„è´Ÿï¼›ç±»ä¼¼åœ°ï¼Œ <code>&gt;=</code> çš„é¡¹å¯¹åº”çš„aã€bä¸­å€¼è¦å–ä¹‹è´Ÿã€‚ç„¶åæœ€ç»ˆç»“æœä¹Ÿè¦å–<code>fun</code>çš„è´Ÿã€‚</p></blockquote><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    fun: -14.571428571428571</span><br><span class="line">message: &#39;Optimization terminated successfully.&#39;</span><br><span class="line">    nit: 2</span><br><span class="line">  slack: array([3.85714286, 0.        ])</span><br><span class="line"> status: 0</span><br><span class="line">success: True</span><br><span class="line">      x: array([6.42857143, 0.57142857, 0.        ])</span><br></pre></td></tr></table></figure><p>æœ€ä¼˜è§£ä¸º$x_1=6.42857143, x_2=0.57142857, x_3=0$, å¯¹åº”çš„æœ€ä¼˜å€¼$z=14.571428571428571$.</p><p>è‹¥è¦å– funã€xçš„å€¼ï¼Œå¯ä»¥ç›´æ¥ç”¨ <code>result.fun</code> å’Œ <code>result.x</code>ã€‚</p><h2 id="æ•´æ•°è§„åˆ’"><a href="#æ•´æ•°è§„åˆ’" class="headerlink" title="æ•´æ•°è§„åˆ’"></a>æ•´æ•°è§„åˆ’</h2><p>çº¿æ€§æ•´æ•°è§„åˆ’é—®é¢˜å¯ä»¥è½¬æ¢ä¸ºçº¿æ€§è§„åˆ’é—®é¢˜æ±‚è§£ã€‚</p><p>å¯¹äºéçº¿æ€§çš„æ•´æ•°è§„åˆ’ï¼Œåœ¨ç©·ä¸¾ä¸å¯ä¸ºæ—¶ï¼Œåœ¨ä¸€å®šè®¡ç®—é‡ä¸‹å¯ä»¥è€ƒè™‘ç”¨ <em>è’™ç‰¹å¡æ´›æ³•</em> å¾—åˆ°ä¸€ä¸ªæ»¡æ„è§£ã€‚</p><h3 id="è’™ç‰¹å¡æ´›æ³•ï¼ˆéšæœºå–æ ·æ³•ï¼‰"><a href="#è’™ç‰¹å¡æ´›æ³•ï¼ˆéšæœºå–æ ·æ³•ï¼‰" class="headerlink" title="è’™ç‰¹å¡æ´›æ³•ï¼ˆéšæœºå–æ ·æ³•ï¼‰"></a>è’™ç‰¹å¡æ´›æ³•ï¼ˆéšæœºå–æ ·æ³•ï¼‰</h3><p>e.g. $y=x^2$ã€$y=12-x$ ä¸ $x$ è½´ åœ¨ç¬¬ä¸€è±¡é™å›´æˆä¸€ä¸ªæ›²è¾¹ä¸‰è§’å½¢ã€‚è®¾è®¡ä¸€ä¸ªéšæœºè¯•éªŒï¼Œæ±‚è¯¥å›¾åƒé¢ç§¯çš„è¿‘ä¼¼å€¼ã€‚</p><p><strong>è§£</strong>ï¼š    è®¾è®¡çš„éšæœºè¯•éªŒæ€æƒ³å¦‚ä¸‹ï¼šåœ¨çŸ©å½¢åŒºåŸŸ <code>[0, 12] * [0, 9]</code> ä¸Šäº§ç”Ÿæœä»å‡åŒ€åˆ†å¸ƒçš„ <code>10^7</code> ä¸ªéšæœºç‚¹ï¼Œç»Ÿè®¡éšæœºç‚¹è½åœ¨æ›²è¾¹ä¸‰è§’å½¢çš„é¢‘æ•°ï¼Œåˆ™æ›²è¾¹ä¸‰è§’å½¢çš„é¢ç§¯è¿‘ä¼¼ä¸ºä¸Šè¿°çŸ©å½¢é¢ç§¯ä¹˜äºé¢‘ç‡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x = [random.random() * <span class="number">12</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">10000000</span>)]</span><br><span class="line">y = [random.random() * <span class="number">9</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">10000000</span>)]</span><br><span class="line"></span><br><span class="line">p = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">10000000</span>):</span><br><span class="line">    <span class="keyword">if</span> x[i] &lt;= <span class="number">3</span> <span class="keyword">and</span> y[i] &lt; x[i] ** <span class="number">2</span>:</span><br><span class="line">            p += <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> x[i] &gt; <span class="number">3</span> <span class="keyword">and</span> y[i] &lt; <span class="number">12</span> - x[i]:</span><br><span class="line">            p += <span class="number">1</span></span><br><span class="line"> </span><br><span class="line">area_appr = <span class="number">12</span> * <span class="number">9</span> * p / <span class="number">10</span> ** <span class="number">7</span></span><br><span class="line">print(area_appr)</span><br></pre></td></tr></table></figure><p>ç»“æœåœ¨ <code>49.5</code> é™„è¿‘ã€‚</p><p>e.g. å·²çŸ¥éçº¿æ€§æ•´æ•°è§„åˆ’ä¸ºï¼š<br>$$<br>\textrm{max } z=x_1^2+x_2^2+3x_3^2+4x_4^2+2x_5^2-8x_1-2x_2-3x_3-x_4-2x_5\<br>\textrm{s.t. } \left { \begin{array}{ll}<br>0 \le x_i \le 99, i=1,â€¦,5,\<br>x_1+x_2+x_3+x_4+x_5 \le 400\<br>x_1+2x_2+2x_3+x_4+6x_5 \le 800\<br>2x_1+x_2+6x_3 \le 200\<br>x_3+x_4+5x_5 \le 200<br>\end{array}\right.<br>$$<br>å¦‚æœç”¨æšä¸¾æ³•ï¼Œè¦è®¡ç®— <code>100^5 = 10^10</code> ä¸ªç‚¹ï¼Œè®¡ç®—é‡å¤ªå¤§ã€‚æ‰€ä»¥è€ƒè™‘ç”¨è’™ç‰¹å¡æ´›æ³•å»éšæœºè®¡ç®—  <code>10^6</code> ä¸ªç‚¹ï¼Œå¾—åˆ°æ¯”è¾ƒæ»¡æ„çš„ç‚¹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›®æ ‡å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">x: <span class="built_in">list</span></span>) -&gt; int:</span></span><br><span class="line">    <span class="keyword">return</span> x[<span class="number">0</span>] ** <span class="number">2</span> + x[<span class="number">1</span>] ** <span class="number">2</span> + <span class="number">3</span> * x[<span class="number">2</span>] ** <span class="number">2</span> + <span class="number">4</span> * x[<span class="number">3</span>] ** <span class="number">2</span> + <span class="number">2</span> * x[<span class="number">4</span>] ** <span class="number">2</span> - <span class="number">8</span> * x[<span class="number">0</span>] - <span class="number">2</span> * x[<span class="number">1</span>] - <span class="number">3</span> * x[<span class="number">2</span>] - x[<span class="number">3</span>] -<span class="number">2</span> * x[<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># çº¦æŸå‘é‡å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">g</span>(<span class="params">x: <span class="built_in">list</span></span>) -&gt; list:</span></span><br><span class="line">    res = []</span><br><span class="line">    res.append(<span class="built_in">sum</span>(x) - <span class="number">400</span>)</span><br><span class="line">    res.append(x[<span class="number">0</span>] + <span class="number">2</span> * x[<span class="number">1</span>] + <span class="number">2</span> * x[<span class="number">2</span>] + x[<span class="number">3</span>] + <span class="number">6</span> * x[<span class="number">4</span>] - <span class="number">800</span>)</span><br><span class="line">    res.append(<span class="number">2</span> * x[<span class="number">0</span>] + x[<span class="number">1</span>] + <span class="number">6</span> * x[<span class="number">2</span>] - <span class="number">200</span>)</span><br><span class="line">    res.append(x[<span class="number">2</span>] + x[<span class="number">3</span>] + <span class="number">5</span> * x[<span class="number">4</span>] - <span class="number">200</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">random.seed(time.time)</span><br><span class="line"></span><br><span class="line">pb = <span class="number">0</span></span><br><span class="line">xb = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span> ** <span class="number">6</span>):</span><br><span class="line">    x = [random.randint(<span class="number">0</span>, <span class="number">99</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]<span class="comment"># äº§ç”Ÿä¸€è¡Œäº”åˆ—çš„åŒºé—´[0, 99] ä¸Šçš„éšæœºæ•´æ•°</span></span><br><span class="line">    rf = f(x)</span><br><span class="line">    rg = g(x)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">all</span>((a &lt; <span class="number">0</span> <span class="keyword">for</span> a <span class="keyword">in</span> rg)):<span class="comment"># è‹¥ rg ä¸­æ‰€æœ‰å…ƒç´ éƒ½å°äº 0</span></span><br><span class="line">        <span class="keyword">if</span> pb &lt; rf:</span><br><span class="line">            xb = x</span><br><span class="line">            pb = rf</span><br><span class="line">            </span><br><span class="line">print(xb, pb)</span><br></pre></td></tr></table></figure><h3 id="æŒ‡æ´¾é—®é¢˜"><a href="#æŒ‡æ´¾é—®é¢˜" class="headerlink" title="æŒ‡æ´¾é—®é¢˜"></a>æŒ‡æ´¾é—®é¢˜</h3><blockquote><p>ç¬¬ä¸‰æ–¹ä¾èµ–åº“ï¼š<code>numpy</code> , <code>scipy</code>ã€‚</p></blockquote><p>ç”¨ <code>scipy.optimize.linear_sum_assignment</code> å¯ä»¥è§£æŒ‡æ´¾é—®é¢˜(the linear sum assignment problem)ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">linear_sum_assignment(cost_matrix)</span><br></pre></td></tr></table></figure><p>æ³¨æ„æŒ‡æ´¾çŸ©é˜µ <code>cost_matrix</code> é‡Œçš„å…ƒç´  <code>C[i, j]</code> çš„ <code>i</code> ä¸º <em>worker</em>ï¼Œ<code>j</code> ä¸º <em>job</em>.</p><blockquote><p>Formally, let X be a boolean matrix where $X[i,j] = 1$ iff row i is assigned to column j. Then the optimal assignment has cost<br>$$<br>\min \sum_i \sum_j C_{i,j} X_{i,j}<br>$$<br>s.t. each row is assignment to at most one column, and each column to at most one row.</p></blockquote><p>e.g. æ±‚è§£ä¸‹åˆ—æŒ‡æ´¾é—®é¢˜ï¼Œå·²çŸ¥æŒ‡æ´¾çŸ©é˜µä¸º<br>$$<br>\left[ \begin{array}{cc}<br>3 &amp; 8 &amp; 2 &amp; 10 &amp; 3\<br>8 &amp; 7 &amp; 2 &amp; 9 &amp; 7\<br>6 &amp; 4 &amp; 2 &amp; 7 &amp; 5\<br>8 &amp; 4 &amp; 2 &amp; 3 &amp; 5\<br>9 &amp; 10 &amp; 6 &amp; 9 &amp; 10\<br>\end{array} \right].<br>$$<br><strong>è§£</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> scipy <span class="keyword">import</span> optimize</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c = [[<span class="number">3</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">10</span>,<span class="number">3</span>], [<span class="number">8</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">9</span>,<span class="number">7</span>], [<span class="number">6</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">5</span>], [<span class="number">8</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>], [<span class="number">9</span>,<span class="number">10</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">10</span>]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c = np.array(c)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>optimize.linear_sum_assignment(c)</span><br><span class="line">(array([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]), array([<span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">0</span>]))<span class="comment"># å¯¹åº” x15ã€x23ã€x32ã€x44ã€x51</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c[[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], [<span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">0</span>]].<span class="built_in">sum</span>()<span class="comment"># ç»“æœä»£å…¥ cost_matrixï¼Œæ±‚å¾—æœ€ä¼˜å€¼</span></span><br><span class="line"><span class="number">21</span></span><br></pre></td></tr></table></figure><h2 id="éçº¿æ€§è§„åˆ’"><a href="#éçº¿æ€§è§„åˆ’" class="headerlink" title="éçº¿æ€§è§„åˆ’"></a>éçº¿æ€§è§„åˆ’</h2><h3 id="éçº¿æ€§è§„åˆ’æ¨¡å‹"><a href="#éçº¿æ€§è§„åˆ’æ¨¡å‹" class="headerlink" title="éçº¿æ€§è§„åˆ’æ¨¡å‹"></a>éçº¿æ€§è§„åˆ’æ¨¡å‹</h3><blockquote><p>ç¬¬ä¸‰æ–¹ä¾èµ–åº“ï¼š<code>numpy</code> , <code>scipy</code>ã€‚</p></blockquote><p>æˆ‘ä»¬ä¹‹å‰å¤šæ¬¡ä½¿ç”¨çš„ <code>scipy.optimize</code> ä¸­é›†æˆäº†ä¸€ç³»åˆ—ç”¨æ¥æ±‚è§„åˆ’çš„å‡½æ•°ï¼Œå…¶ä¸­å½“ç„¶ä¸ä¹è§£å†³éçº¿æ€§è§„åˆ’çš„æ–¹æ³•ã€‚ä¾‹å¦‚ç”¨å…¶ä¸­çš„ <code>minimize</code> å‡½æ•°å°±å¯ä»¥è§£å†³å¾ˆå¤šåœ¨ Matlab ä¸­ç”¨ <code>fmincon</code> è§£çš„éçº¿æ€§è§„åˆ’é—®é¢˜ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">minimize(fun, x0, args&#x3D;(), method&#x3D;None, jac&#x3D;None, hess&#x3D;None, hessp&#x3D;None, bounds&#x3D;None, constraints&#x3D;(), tol&#x3D;None, callback&#x3D;None, options&#x3D;None)</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨çš„å‚æ•°ï¼š</p><ul><li><code>fun</code>:ï¼šå¾…æ±‚ <em>æœ€å°å€¼</em> çš„ç›®æ ‡å‡½æ•°ï¼Œ<code>fun(x, *args) -&gt; float</code>ï¼Œ x æ˜¯ <code>shape (n,)</code>çš„ 1-D array  </li><li><code>x0</code>ï¼šåˆå§‹çŒœæµ‹å€¼ï¼Œ <code>shape (n,)</code>çš„ 1-D array </li><li><code>bounds</code>ï¼šè®¾ç½®å‚æ•°èŒƒå›´/çº¦æŸæ¡ä»¶ï¼Œtupleï¼Œå½¢å¦‚ <code>((0, None), (0, None))</code></li><li><code>constraints</code>ï¼š<em>çº¦æŸæ¡ä»¶</em>ï¼Œæ”¾ä¸€ç³»åˆ— dict çš„ tupleï¼Œ<code>(&#123;&#39;type&#39;: TYPE, &#39;fun&#39;: FUN&#125;, ...)</code><ul><li><code>TYPE</code>ï¼š<code>&#39;eq&#39;</code>è¡¨ç¤º å‡½æ•°ç»“æœç­‰äº0 ï¼› <code>&#39;ineq&#39;</code> è¡¨ç¤º è¡¨è¾¾å¼å¤§äºç­‰äº0</li><li><code>FUN</code>ï¼š çº¦æŸå‡½æ•°</li></ul></li></ul><p>e.g. æ±‚ä¸‹åˆ—éçº¿æ€§è§„åˆ’ï¼š<br>$$<br>\textrm{min } f(x)=x_1^2+x_2^2+x_3^2+8,\<br>\textrm{s.t. } \left { \begin{array}{ll}<br>x_1^2+x_2^2+x_3^2 \ge 0,\<br>x_1+x_2^2+x_3^2 \le 20,\<br>-x_1-x_2^2+2=0,\<br>x_2+2x_3^2=3,\<br>x_1,x_2,x_3 \ge 0.<br>\end{array}\right.<br>$$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> scipy <span class="keyword">import</span> optimize</span><br><span class="line"></span><br><span class="line">f = <span class="keyword">lambda</span> x: x[<span class="number">0</span>] ** <span class="number">2</span> + x[<span class="number">1</span>] **<span class="number">2</span> + x[<span class="number">2</span>] ** <span class="number">2</span> + <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Noticeï¼šeq ==; ineq &gt;=</span></span><br><span class="line">cons = (&#123;<span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;ineq&#x27;</span>, <span class="string">&#x27;fun&#x27;</span>: <span class="keyword">lambda</span> x: x[<span class="number">0</span>]**<span class="number">2</span> - x[<span class="number">1</span>] + x[<span class="number">2</span>]**<span class="number">2</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;ineq&#x27;</span>, <span class="string">&#x27;fun&#x27;</span>: <span class="keyword">lambda</span> x: -x[<span class="number">0</span>] - x[<span class="number">1</span>] - x[<span class="number">2</span>]**<span class="number">3</span> + <span class="number">20</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;eq&#x27;</span>, <span class="string">&#x27;fun&#x27;</span>: <span class="keyword">lambda</span> x: -x[<span class="number">0</span>] - x[<span class="number">1</span>]**<span class="number">2</span> + <span class="number">2</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;eq&#x27;</span>, <span class="string">&#x27;fun&#x27;</span>: <span class="keyword">lambda</span> x: x[<span class="number">1</span>] + <span class="number">2</span> * x[<span class="number">2</span>]**<span class="number">2</span> - <span class="number">3</span>&#125;)</span><br><span class="line"></span><br><span class="line">res = optimize.minimize(f, (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), constraints=cons)</span><br><span class="line"></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    fun: 10.651091840572583</span><br><span class="line">    jac: array([1.10433471, 2.40651834, 1.89564812])</span><br><span class="line">message: &#39;Optimization terminated successfully.&#39;</span><br><span class="line">   nfev: 86</span><br><span class="line">    nit: 15</span><br><span class="line">   njev: 15</span><br><span class="line"> status: 0</span><br><span class="line">success: True</span><br><span class="line">      x: array([0.55216734, 1.20325918, 0.94782404])</span><br></pre></td></tr></table></figure><p>å³ï¼Œæ±‚å¾—å½“ $(x_1,x_2,x_3)=(0.55216734, 1.20325918, 0.94782404)$ æ—¶ï¼Œæœ€å°å€¼$y=10.651091840572583$.</p><h3 id="æ— çº¦æŸé—®é¢˜çš„-Python-è§£æ³•"><a href="#æ— çº¦æŸé—®é¢˜çš„-Python-è§£æ³•" class="headerlink" title="æ— çº¦æŸé—®é¢˜çš„ Python è§£æ³•"></a>æ— çº¦æŸé—®é¢˜çš„ Python è§£æ³•</h3><h4 id="ç¬¦å·è§£"><a href="#ç¬¦å·è§£" class="headerlink" title="ç¬¦å·è§£"></a>ç¬¦å·è§£</h4><blockquote><p>ç¬¬ä¸‰æ–¹ä¾èµ–åº“ï¼š<code>sympy</code>ã€‚</p></blockquote><p>e.g. æ±‚å¤šå…ƒå‡½æ•° $f(xï¼Œy) = x^3 - y^3 + 3x^2 + 3y^2 - 9x$ çš„æå€¼</p><p>æ€è·¯ï¼šæ±‚é©»ç‚¹ï¼Œä»£å…¥HessiançŸ©é˜µï¼Œæ­£å®šåˆ™ä¸ºæå°å€¼ï¼Œè´Ÿå®šæå¤§ï¼Œä¸å®šä¸æ˜¯æå€¼ç‚¹ã€‚</p><p><strong>è§£</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sympy</span><br><span class="line"></span><br><span class="line">f, x, y = sympy.symbols(<span class="string">&quot;f x y&quot;</span>)</span><br><span class="line"></span><br><span class="line">f = x**<span class="number">3</span> - y**<span class="number">3</span> + <span class="number">3</span> * x**<span class="number">2</span> + <span class="number">3</span> * y**<span class="number">2</span> - <span class="number">9</span> * x</span><br><span class="line">funs = sympy.Matrix([f])</span><br><span class="line">args = sympy.Matrix([x, y])</span><br><span class="line"></span><br><span class="line">df = funs.jacobian(args)        <span class="comment"># ä¸€é˜¶åå¯¼</span></span><br><span class="line">d2f = df.jacobian(args)         <span class="comment"># Hessian çŸ©é˜µ</span></span><br><span class="line"></span><br><span class="line">stationaryPoints = sympy.solve(df)      <span class="comment"># é©»ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> stationaryPoints:</span><br><span class="line">    a = d2f.subs(x, i[x]).subs(y, i[y])<span class="comment"># é©»ç‚¹å¤„çš„Hessian</span></span><br><span class="line">    b = a.eigenvals(multiple=<span class="literal">True</span>)      <span class="comment"># æ±‚HessiançŸ©é˜µçš„ç‰¹å¾å€¼</span></span><br><span class="line">    fv = f.subs(x, i[x]).subs(y, i[y])<span class="comment"># é©»ç‚¹å¤„çš„å‡½æ•°å€¼</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">all</span>((j &gt; <span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> b)):</span><br><span class="line">        print(<span class="string">&#x27;ç‚¹(&#123;x&#125;, &#123;y&#125;)æ˜¯æå°å€¼ç‚¹ï¼Œå¯¹åº”çš„æå°å€¼ä¸º: f(&#123;x&#125;, &#123;y&#125;) = &#123;f&#125;&#x27;</span>.<span class="built_in">format</span>(x=i[x], y=i[y], f=fv))</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">all</span>((j &lt; <span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> b)):</span><br><span class="line">        print(<span class="string">&#x27;ç‚¹(&#123;x&#125;, &#123;y&#125;)æ˜¯æå¤§å€¼ç‚¹ï¼Œå¯¹åº”çš„æå¤§å€¼ä¸º: f(&#123;x&#125;, &#123;y&#125;) = &#123;f&#125;&#x27;</span>.<span class="built_in">format</span>(x=i[x], y=i[y], f=fv))</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">any</span>((j &lt; <span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> b)) <span class="keyword">and</span> <span class="built_in">any</span>((j &gt; <span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> b)):</span><br><span class="line">        print(<span class="string">&#x27;ç‚¹(&#123;x&#125;, &#123;y&#125;)ä¸æ˜¯æå€¼ç‚¹&#x27;</span>.<span class="built_in">format</span>(x=i[x], y=i[y]))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&#x27;æ— æ³•åˆ¤æ–­ç‚¹(&#123;x&#125;, &#123;y&#125;)æ˜¯å¦ä¸ºæå€¼ç‚¹&#x27;</span>.<span class="built_in">format</span>(x=i[x], y=i[y]))</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç‚¹(-3, 0)ä¸æ˜¯æå€¼ç‚¹</span><br><span class="line">ç‚¹(-3, 2)æ˜¯æå¤§å€¼ç‚¹ï¼Œå¯¹åº”çš„æå¤§å€¼ä¸º: f(-3, 2) &#x3D; 31</span><br><span class="line">ç‚¹(1, 0)æ˜¯æå°å€¼ç‚¹ï¼Œå¯¹åº”çš„æå°å€¼ä¸º: f(1, 0) &#x3D; -5</span><br><span class="line">ç‚¹(1, 2)ä¸æ˜¯æå€¼ç‚¹</span><br></pre></td></tr></table></figure><h4 id="æ•°å€¼è§£"><a href="#æ•°å€¼è§£" class="headerlink" title="æ•°å€¼è§£"></a>æ•°å€¼è§£</h4><blockquote><p>ç¬¬ä¸‰æ–¹ä¾èµ–åº“ï¼š<code>numpy</code> , <code>scipy</code>ã€‚</p></blockquote><p>åˆ©ç”¨ Python æ±‚æ— çº¦æŸæå€¼çš„æ•°å€¼è§£ä¸æˆ‘ä»¬åœ¨éçº¿æ€§è§„åˆ’æ¨¡å‹ä¸­çš„æ“ä½œç±»ä¼¼ï¼Œæˆ‘ä»¬ä¾ç„¶ä½¿ç”¨ <code>minimize</code> å‡½æ•°æ±‚è§£ï¼Œä¸è¿‡è¿™æ¬¡è¿ constraints éƒ½ä¸ç”¨äº†ã€‚</p><p>e.g. æ±‚å¤šå…ƒå‡½æ•° $f(xï¼Œy) = x^3 - y^3 + 3x^2 + 3y^2 - 9x$ çš„æœ€å€¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import numpy as np</span><br><span class="line">from scipy import optimize</span><br><span class="line"></span><br><span class="line">f &#x3D; lambda x: x[0]**3 - x[1]**3 + 3 * x[0]**2 + 3 * x[1]**2 - 9 * x[0]</span><br><span class="line"></span><br><span class="line">resMin &#x3D; optimize.minimize(f, (0, 0))# æ±‚æœ€å°å€¼</span><br><span class="line">resMax &#x3D; optimize.minimize(lambda x: -f(x), (0, 0))# æ±‚æœ€å¤§å€¼</span><br><span class="line"></span><br><span class="line">print(&quot;æœ€å°å€¼ï¼š\n&quot;)</span><br><span class="line">print(resMin)</span><br><span class="line">print(&quot;æœ€å¤§å€¼ï¼š\n&quot;)</span><br><span class="line">print(resMax)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">æå°å€¼ï¼š</span><br><span class="line"></span><br><span class="line">      fun: -5.0</span><br><span class="line"> hess_inv: array([[8.34028325e-02, 3.27721596e-09],</span><br><span class="line">       [3.27721596e-09, 1.00000000e+00]])</span><br><span class="line">      jac: array([1.1920929e-07, 0.0000000e+00])</span><br><span class="line">  message: &#39;Optimization terminated successfully.&#39;</span><br><span class="line">     nfev: 20</span><br><span class="line">      nit: 4</span><br><span class="line">     njev: 5</span><br><span class="line">   status: 0</span><br><span class="line">  success: True</span><br><span class="line">        x: array([ 1.00000000e+00, -5.40966234e-09])</span><br><span class="line">æå¤§å€¼ï¼š</span><br><span class="line"></span><br><span class="line">      fun: -30.99999999999847</span><br><span class="line"> hess_inv: array([[0.08280865, 0.00036445],</span><br><span class="line">       [0.00036445, 0.16672048]])</span><br><span class="line">      jac: array([ 9.53674316e-07, -4.29153442e-06])</span><br><span class="line">  message: &#39;Optimization terminated successfully.&#39;</span><br><span class="line">     nfev: 172</span><br><span class="line">      nit: 11</span><br><span class="line">     njev: 43</span><br><span class="line">   status: 0</span><br><span class="line">  success: True</span><br><span class="line">        x: array([-2.99999994,  1.99999929])</span><br></pre></td></tr></table></figure><h4 id="æ±‚å‡½æ•°çš„é›¶ç‚¹å’Œæ–¹ç¨‹ç»„çš„è§£"><a href="#æ±‚å‡½æ•°çš„é›¶ç‚¹å’Œæ–¹ç¨‹ç»„çš„è§£" class="headerlink" title="æ±‚å‡½æ•°çš„é›¶ç‚¹å’Œæ–¹ç¨‹ç»„çš„è§£"></a>æ±‚å‡½æ•°çš„é›¶ç‚¹å’Œæ–¹ç¨‹ç»„çš„è§£</h4><blockquote><p>ç¬¬ä¸‰æ–¹ä¾èµ–åº“ï¼š<code>sympy</code>ã€‚</p></blockquote><p>ä½¿ç”¨ <code>sympy.solve</code> å‡½æ•°å¯ä»¥æ±‚å‡ºæ–¹ç¨‹/æ–¹ç¨‹ç»„çš„ç¬¦å·è§£ï¼Œå¾—åˆ°çš„æ¯ä¸ªæ ¹å¯ä»¥è°ƒç”¨å…¶ <code>evalf</code> æ–¹æ³•è½¬åŒ–ä¸ºè¿‘ä¼¼çš„æ•°å€¼ã€‚</p><ol><li>æ±‚å¤šé¡¹å¼ $f(x)=x^3-x^2+2x-3$ çš„é›¶ç‚¹</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> sympy</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = sympy.Symbol(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = sympy.solve(x**<span class="number">3</span> - x**<span class="number">2</span> + <span class="number">2</span> * x -<span class="number">3</span>)<span class="comment"># æ±‚ç¬¦å·è§£</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line">[<span class="number">1</span>/<span class="number">3</span> + (-<span class="number">1</span>/<span class="number">2</span> - sqrt(<span class="number">3</span>)*I/<span class="number">2</span>)*(<span class="number">65</span>/<span class="number">54</span> + <span class="number">5</span>*sqrt(<span class="number">21</span>)/<span class="number">18</span>)**(<span class="number">1</span>/<span class="number">3</span>) - <span class="number">5</span>/(<span class="number">9</span>*(-<span class="number">1</span>/<span class="number">2</span> - sqrt(<span class="number">3</span>)*I/<span class="number">2</span>)*(<span class="number">65</span>/<span class="number">54</span> + <span class="number">5</span>*sqrt(<span class="number">21</span>)/<span class="number">18</span>)**(<span class="number">1</span>/<span class="number">3</span>)), <span class="number">1</span>/<span class="number">3</span> - <span class="number">5</span>/(<span class="number">9</span>*(-<span class="number">1</span>/<span class="number">2</span> + sqrt(<span class="number">3</span>)*I/<span class="number">2</span>)*(<span class="number">65</span>/<span class="number">54</span> + <span class="number">5</span>*sqrt(<span class="number">21</span>)/<span class="number">18</span>)**(<span class="number">1</span>/<span class="number">3</span>)) + (-<span class="number">1</span>/<span class="number">2</span> + sqrt(<span class="number">3</span>)*I/<span class="number">2</span>)*(<span class="number">65</span>/<span class="number">54</span> + <span class="number">5</span>*sqrt(<span class="number">21</span>)/<span class="number">18</span>)**(<span class="number">1</span>/<span class="number">3</span>), -<span class="number">5</span>/(<span class="number">9</span>*(<span class="number">65</span>/<span class="number">54</span> + <span class="number">5</span>*sqrt(<span class="number">21</span>)/<span class="number">18</span>)**(<span class="number">1</span>/<span class="number">3</span>)) + <span class="number">1</span>/<span class="number">3</span> + (<span class="number">65</span>/<span class="number">54</span> + <span class="number">5</span>*sqrt(<span class="number">21</span>)/<span class="number">18</span>)**(<span class="number">1</span>/<span class="number">3</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line"><span class="meta">... </span>    print(i.evalf())<span class="comment"># è¿‘ä¼¼æ•°å€¼</span></span><br><span class="line"><span class="meta">... </span></span><br><span class="line">-<span class="number">0.137841101825493</span> - <span class="number">1.52731225088663</span>*I</span><br><span class="line">-<span class="number">0.137841101825493</span> + <span class="number">1.52731225088663</span>*I</span><br><span class="line"><span class="number">1.27568220365098</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li>æ±‚å¦‚ä¸‹æ–¹ç¨‹ç»„çš„è§£</li></ol><p>$$<br>\left{\begin{array}{l}<br>x^2+y-6=0\<br>y^2+x-6=0\<br>\end{array}\right.<br>$$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> sympy</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x, y = sympy.symbols(<span class="string">&#x27;x y&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = sympy.solve((x**<span class="number">2</span>+y-<span class="number">6</span>, y**<span class="number">2</span>+x-<span class="number">6</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line">[&#123;x: -<span class="number">3</span>, y: -<span class="number">3</span>&#125;, &#123;x: <span class="number">2</span>, y: <span class="number">2</span>&#125;, &#123;x: <span class="number">6</span> - (<span class="number">1</span>/<span class="number">2</span> - sqrt(<span class="number">21</span>)/<span class="number">2</span>)**<span class="number">2</span>, y: <span class="number">1</span>/<span class="number">2</span> - sqrt(<span class="number">21</span>)/<span class="number">2</span>&#125;, &#123;x: <span class="number">6</span> - (<span class="number">1</span>/<span class="number">2</span> + sqrt(<span class="number">21</span>)/<span class="number">2</span>)**<span class="number">2</span>, y: <span class="number">1</span>/<span class="number">2</span> + sqrt(<span class="number">21</span>)/<span class="number">2</span>&#125;]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line"><span class="meta">... </span>    print(<span class="string">&#x27;(&#123;x&#125;, &#123;y&#125;)&#x27;</span>.<span class="built_in">format</span>(x=i[x].evalf(), y=i[y].evalf()))</span><br><span class="line"><span class="meta">... </span></span><br><span class="line">(-<span class="number">3.00000000000000</span>, -<span class="number">3.00000000000000</span>)</span><br><span class="line">(<span class="number">2.00000000000000</span>, <span class="number">2.00000000000000</span>)</span><br><span class="line">(<span class="number">2.79128784747792</span>, -<span class="number">1.79128784747792</span>)</span><br><span class="line">(-<span class="number">1.79128784747792</span>, <span class="number">2.79128784747792</span>)</span><br></pre></td></tr></table></figure><h3 id="çº¦æŸæå€¼é—®é¢˜"><a href="#çº¦æŸæå€¼é—®é¢˜" class="headerlink" title="çº¦æŸæå€¼é—®é¢˜"></a>çº¦æŸæå€¼é—®é¢˜</h3><p>å‚è€ƒä¸Šæ–‡ â€œæ— çº¦æŸé—®é¢˜çš„ Python è§£æ³•â€ã€‚</p><p>â€¦â€¦</p><p><strong>æœªå®Œä½†ä¸ç”¨å¾…ç»­äº†ï¼Œåº”è¯¥æ²¡æœ‰åç»­äº†ï¼Œæˆ‘å¯¹ç”¨ python åšæ•°å­¦å»ºæ¨¡ä»¥åŠæ•°å­¦å»ºæ¨¡éƒ½å¤±å»å…´è¶£äº†ã€‚</strong></p><h2 id="é™„ï¼šnumpy"><a href="#é™„ï¼šnumpy" class="headerlink" title="é™„ï¼šnumpy"></a>é™„ï¼šnumpy</h2><p>æ¨èä¸€ä»½è´¨é‡æ¯”è¾ƒé«˜çš„ numpy ä¸­æ–‡æ–‡æ¡£ï¼š<a href="https://www.numpy.org.cn/index.html">https://www.numpy.org.cn/index.html</a>.</p><h3 id="åˆ›å»º-å‘é‡-çŸ©é˜µ"><a href="#åˆ›å»º-å‘é‡-çŸ©é˜µ" class="headerlink" title="åˆ›å»º å‘é‡/çŸ©é˜µ"></a>åˆ›å»º å‘é‡/çŸ©é˜µ</h3><p>ç”¨ <code>np.array()</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>np.array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]])</span><br><span class="line">array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">       [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>],</span><br><span class="line">       [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]])</span><br></pre></td></tr></table></figure><h3 id="çŸ©é˜µçš„æ‹¼æ¥"><a href="#çŸ©é˜µçš„æ‹¼æ¥" class="headerlink" title="çŸ©é˜µçš„æ‹¼æ¥"></a>çŸ©é˜µçš„æ‹¼æ¥</h3><ul><li>åˆ—åˆå¹¶/æ‰©å±•ï¼š<code>np.column_stack()</code></li><li>è¡Œåˆå¹¶/æ‰©å±•ï¼š<code>np.row_stack()</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>A = np.array([[<span class="number">1</span>,<span class="number">1</span>], [<span class="number">2</span>,<span class="number">2</span>]])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>B = np.array([[<span class="number">3</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">4</span>]])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>A</span><br><span class="line">array([[<span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">       [<span class="number">2</span>, <span class="number">2</span>]])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>B</span><br><span class="line">array([[<span class="number">3</span>, <span class="number">3</span>],</span><br><span class="line">       [<span class="number">4</span>, <span class="number">4</span>]])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>np.column_stack((A, B))<span class="comment"># è¡Œ</span></span><br><span class="line">array([[<span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>],</span><br><span class="line">       [<span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>]])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>np.row_stack((A, B))<span class="comment"># åˆ—</span></span><br><span class="line">array([[<span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">       [<span class="number">2</span>, <span class="number">2</span>],</span><br><span class="line">       [<span class="number">3</span>, <span class="number">3</span>],</span><br><span class="line">       [<span class="number">4</span>, <span class="number">4</span>]])</span><br></pre></td></tr></table></figure><h3 id="å¯¹è§’çº¿å…ƒç´ èµ‹å€¼"><a href="#å¯¹è§’çº¿å…ƒç´ èµ‹å€¼" class="headerlink" title="å¯¹è§’çº¿å…ƒç´ èµ‹å€¼"></a>å¯¹è§’çº¿å…ƒç´ èµ‹å€¼</h3><p>æ¯”å¦‚è¯´æˆ‘ä»¬æœ‰ä¸€ä¸ª <code>np.array X</code>ï¼Œæˆ‘æƒ³å¯¹è§’çº¿çš„æ‰€æœ‰å€¼è®¾ç½®ä¸º0ï¼Œå¯ä»¥ç”¨ <code>np.fill_diagonal(X, [0, 0, 0, ...])</code>ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; D &#x3D; np.zeros([3, 3])</span><br><span class="line">&gt;&gt;&gt; np.fill_diagonal(D, [1, 2, 3])</span><br><span class="line">&gt;&gt;&gt; D</span><br><span class="line">array([[1., 0., 0.],</span><br><span class="line">       [0., 2., 0.],</span><br><span class="line">       [0., 0., 3.]])</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Octave å…¥é—¨</title>
      <link href="/2019/09/10/AndrewNgML/AndrewNg-MachineLearning-5-OctaveTutorial/"/>
      <url>/2019/09/10/AndrewNgML/AndrewNg-MachineLearning-5-OctaveTutorial/</url>
      
        <content type="html"><![CDATA[<h1 id="Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-5-Octave-Tutorial"><a href="#Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-5-Octave-Tutorial" class="headerlink" title="Notes of Andrew Ngâ€™s Machine Learning â€”â€” (5) Octave Tutorial"></a>Notes of Andrew Ngâ€™s Machine Learning â€”â€” (5) Octave Tutorial</h1><h2 id="Basic-Operations"><a href="#Basic-Operations" class="headerlink" title="Basic Operations"></a>Basic Operations</h2><h3 id="Elementary-Operations"><a href="#Elementary-Operations" class="headerlink" title="Elementary Operations"></a>Elementary Operations</h3><p><code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>^</code>.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; 5 + 6</span><br><span class="line">ans &#x3D;  11</span><br><span class="line">&gt;&gt; 20 - 1</span><br><span class="line">ans &#x3D;  19</span><br><span class="line">&gt;&gt; 3 * 4</span><br><span class="line">ans &#x3D;  12</span><br><span class="line">&gt;&gt; 8 &#x2F; 2</span><br><span class="line">ans &#x3D;  4</span><br><span class="line">&gt;&gt; 2 ^ 8</span><br><span class="line">ans &#x3D;  256</span><br></pre></td></tr></table></figure><h3 id="Logical-Operations"><a href="#Logical-Operations" class="headerlink" title="Logical Operations"></a>Logical Operations</h3><p><code>==</code>, <code>~=</code>, <code>&amp;&amp;</code>, <code>||</code>, <code>xor()</code>.</p><p>Note that a <strong>not equal sign</strong> is <strong><code>~=</code></strong>, and not <code>!=</code>.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; 1 &#x3D;&#x3D; 0</span><br><span class="line">ans &#x3D; 0</span><br><span class="line">&gt;&gt; 1 ~&#x3D; 0</span><br><span class="line">ans &#x3D; 1</span><br><span class="line">&gt;&gt; 1 &amp;&amp; 0</span><br><span class="line">ans &#x3D; 0</span><br><span class="line">&gt;&gt; 1 || 0</span><br><span class="line">ans &#x3D; 1</span><br><span class="line">&gt;&gt; xor(1, 0)</span><br><span class="line">ans &#x3D; 1</span><br></pre></td></tr></table></figure><h3 id="Change-the-Prompt"><a href="#Change-the-Prompt" class="headerlink" title="Change the Prompt"></a>Change the Prompt</h3><p>We can change the prompt via <code>PS1()</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; PS1(&quot;octave: &gt; &quot;)</span><br><span class="line">octave: &gt; PS1(&quot;&gt;&gt; &quot;)</span><br><span class="line">&gt;&gt; PS1(&quot;octave: &gt; &quot;)</span><br><span class="line">octave: &gt; PS1(&quot;SOMETHING &gt; &quot;)</span><br><span class="line">SOMETHING &gt; PS1(&quot;&gt;&gt; &quot;)</span><br><span class="line">&gt;&gt; % Prompt changed</span><br></pre></td></tr></table></figure><h3 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; a &#x3D; 3</span><br><span class="line">a &#x3D;  3</span><br><span class="line">&gt;&gt; a &#x3D; 3;    % semicolon supressing output</span><br><span class="line">&gt;&gt; c &#x3D; (3 &gt;&#x3D; 1);</span><br><span class="line">&gt;&gt; c</span><br><span class="line">c &#x3D; 1</span><br></pre></td></tr></table></figure><h3 id="Display-variables"><a href="#Display-variables" class="headerlink" title="Display variables"></a>Display variables</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; a &#x3D; pi;</span><br><span class="line">&gt;&gt; a</span><br><span class="line">a &#x3D;  3.1416</span><br><span class="line">&gt;&gt; disp(a)</span><br><span class="line"> 3.1416</span><br><span class="line">&gt;&gt; disp(sprintf(&#39;2 decimals: %0.2f&#39;, a))</span><br><span class="line">2 decimals: 3.14</span><br></pre></td></tr></table></figure><p>We can also set the default length of decimal places by entering <code>format short/long</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; a</span><br><span class="line">a &#x3D;  3.1416</span><br><span class="line">&gt;&gt; format long</span><br><span class="line">&gt;&gt; a</span><br><span class="line">a &#x3D;  3.141592653589793</span><br><span class="line">&gt;&gt; format short</span><br><span class="line">&gt;&gt; a</span><br><span class="line">a &#x3D;  3.1416</span><br></pre></td></tr></table></figure><h3 id="Create-Matrices"><a href="#Create-Matrices" class="headerlink" title="Create Matrices"></a>Create Matrices</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; A &#x3D; [1, 2, 3; 4, 5, 6]</span><br><span class="line">A &#x3D;</span><br><span class="line"></span><br><span class="line">   1   2   3</span><br><span class="line">   4   5   6</span><br><span class="line"></span><br><span class="line">&gt;&gt; B &#x3D; [1 3 5; 7 9 11]</span><br><span class="line">B &#x3D;</span><br><span class="line"></span><br><span class="line">    1    3    5</span><br><span class="line">    7    9   11</span><br><span class="line"></span><br><span class="line">&gt;&gt; B &#x3D; [1, 2, 3;</span><br><span class="line">&gt; 4, 5, 6;</span><br><span class="line">&gt; 7, 8, 9]</span><br><span class="line">B &#x3D;</span><br><span class="line"></span><br><span class="line">   1   2   3</span><br><span class="line">   4   5   6</span><br><span class="line">   7   8   9</span><br><span class="line"></span><br><span class="line">&gt;&gt; C &#x3D; [1, 2, 4, 8]</span><br><span class="line">C &#x3D;</span><br><span class="line"></span><br><span class="line">   1   2   4   8</span><br><span class="line"></span><br><span class="line">&gt;&gt; D &#x3D; [1; 2; 3; 4]</span><br><span class="line">D &#x3D;</span><br><span class="line"></span><br><span class="line">   1</span><br><span class="line">   2</span><br><span class="line">   3</span><br><span class="line">   4</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>There are some useful methods to generate matrices:</p><ul><li>Generate vector of a range</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; v &#x3D; 1:10    % start:end</span><br><span class="line">v &#x3D;</span><br><span class="line"></span><br><span class="line">    1    2    3    4    5    6    7    8    9   10</span><br><span class="line"></span><br><span class="line">&gt;&gt; v &#x3D; 1:0.1:2    % start:step:end</span><br><span class="line">v &#x3D;</span><br><span class="line"></span><br><span class="line"> Columns 1 through 8:</span><br><span class="line"></span><br><span class="line">    1.0000    1.1000    1.2000    1.3000    1.4000    1.5000    1.6000    1.7000</span><br><span class="line"></span><br><span class="line"> Columns 9 through 11:</span><br><span class="line"></span><br><span class="line">    1.8000    1.9000 </span><br></pre></td></tr></table></figure><ul><li>Generate matrices of all ones/zeros</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; ones(2, 3)</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">   1   1   1</span><br><span class="line">   1   1   1</span><br><span class="line"></span><br><span class="line">&gt;&gt; zeros(3, 2)</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">   0   0</span><br><span class="line">   0   0</span><br><span class="line">   0   0</span><br><span class="line"></span><br><span class="line">&gt;&gt; C &#x3D; 2 * ones(4, 5)</span><br><span class="line">C &#x3D;</span><br><span class="line"></span><br><span class="line">   2   2   2   2   2</span><br><span class="line">   2   2   2   2   2</span><br><span class="line">   2   2   2   2   2</span><br><span class="line">   2   2   2   2   2</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>Generate identity matrices</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; eye(3)</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">Diagonal Matrix</span><br><span class="line"></span><br><span class="line">   1   0   0</span><br><span class="line">   0   1   0</span><br><span class="line">   0   0   1</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>Generate matrices of random values</li></ul><p>Uniform distribution between 0 and 1:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; D &#x3D; rand(1, 3)</span><br><span class="line">D &#x3D;</span><br><span class="line"></span><br><span class="line">   0.14117   0.81424   0.83745</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Gaussian random:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; D &#x3D; randn(1, 3)</span><br><span class="line">D &#x3D;</span><br><span class="line"></span><br><span class="line">   0.22133  -2.00002   1.61025</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>We can generate a gaussian random vector with 10000 elements, and plot a histogram:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; randn(1, 10000);</span><br><span class="line">&gt;&gt; hist(w)</span><br></pre></td></tr></table></figure><p>Output figure:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6rc9xza9dj30ff0blt8s.jpg" alt="image-20190907224934733"></p><p>We can also plot a histogram with more buckets, 50 bins for example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; hist(w, 50)</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6rc9cow1gj30fh0bjjri.jpg" alt="image-20190907224859815"></p><h3 id="Get-Help"><a href="#Get-Help" class="headerlink" title="Get Help"></a>Get Help</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; help</span><br><span class="line"></span><br><span class="line">  For help with individual commands and functions type</span><br><span class="line"></span><br><span class="line">    help NAME</span><br><span class="line">    </span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">&gt;&gt; help eye</span><br><span class="line">&#39;eye&#39; is a built-in function from the file libinterp&#x2F;corefcn&#x2F;data.cc</span><br><span class="line"> </span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">&gt;&gt; help help</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Moving-Data-Around"><a href="#Moving-Data-Around" class="headerlink" title="Moving Data Around"></a>Moving Data Around</h2><h3 id="Size-of-matrix"><a href="#Size-of-matrix" class="headerlink" title="Size of matrix"></a>Size of matrix</h3><p><code>size()</code>: get the size of a matrix, return <code>[rows, columns]</code>.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; A &#x3D; [1, 2; 3, 4; 5, 6]</span><br><span class="line">A &#x3D;</span><br><span class="line"></span><br><span class="line">   1   2</span><br><span class="line">   3   4</span><br><span class="line">   5   6</span><br><span class="line"></span><br><span class="line">&gt;&gt; size(A)    % get the size of A</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">   3   2</span><br><span class="line"></span><br><span class="line">&gt;&gt; sz &#x3D; size(A);    % actually, size return a 1x2 matrix</span><br><span class="line">&gt;&gt; size(sz)</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">   1   2</span><br><span class="line"></span><br><span class="line">&gt;&gt; size(A, 1)    % get the first dimension of A (i.e. the number of rows)</span><br><span class="line">ans &#x3D;  3</span><br><span class="line">&gt;&gt; size(A, 2)    % the number of columns</span><br><span class="line">ans &#x3D;  2</span><br></pre></td></tr></table></figure><p><code>length()</code>: return the size of the longest dimension.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; length(A)    % get the size of the longest dimension. Confusing, not recommend</span><br><span class="line">ans &#x3D;  3</span><br><span class="line">&gt;&gt; v &#x3D; [1, 2, 3, 4];</span><br><span class="line">&gt;&gt; length(v)    % We often length() to get the length of a vector</span><br><span class="line">ans &#x3D;  4</span><br></pre></td></tr></table></figure><h3 id="Load-data"><a href="#Load-data" class="headerlink" title="Load data"></a>Load data</h3><p>We can use basic shell commands to find data that we want.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; pwd</span><br><span class="line">ans &#x3D; &#x2F;Users&#x2F;c</span><br><span class="line">&gt;&gt; cd MyProg&#x2F;octave&#x2F;</span><br><span class="line">&gt;&gt; pwd</span><br><span class="line">ans &#x3D; &#x2F;Users&#x2F;c&#x2F;MyProg&#x2F;octave</span><br><span class="line">&gt;&gt; ls</span><br><span class="line">featureX.dat featureY.dat</span><br><span class="line">&gt;&gt; ls -l</span><br><span class="line">total 16</span><br><span class="line">-rw-r--r--  1 c  staff  188 Sep  8 10:00 featureX.dat</span><br><span class="line">-rw-r--r--  1 c  staff  135 Sep  8 10:00 featureY.dat</span><br></pre></td></tr></table></figure><p><code>load</code> command can load data from a file.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; load featureX.dat</span><br><span class="line">&gt;&gt; load(&#39;featureY.dat&#39;)</span><br></pre></td></tr></table></figure><p>The data from file is now comed into matrices after load</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; featureX</span><br><span class="line">featureX &#x3D;</span><br><span class="line"></span><br><span class="line">   2104      3</span><br><span class="line">   1600      3</span><br><span class="line">   2400      3</span><br><span class="line">   1416      2</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">&gt;&gt; size(featureX)</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">   27    2</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Show-variables"><a href="#Show-variables" class="headerlink" title="Show variables"></a>Show variables</h3><p><code>who/whos</code>: show variables in memory currently.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; who</span><br><span class="line">Variables in the current scope:</span><br><span class="line"></span><br><span class="line">A         ans       featureX  featureY  sz        v         w</span><br><span class="line"></span><br><span class="line">&gt;&gt; whos    % for more details</span><br><span class="line">Variables in the current scope:</span><br><span class="line"></span><br><span class="line">   Attr Name          Size                     Bytes  Class</span><br><span class="line">   &#x3D;&#x3D;&#x3D;&#x3D; &#x3D;&#x3D;&#x3D;&#x3D;          &#x3D;&#x3D;&#x3D;&#x3D;                     &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D; </span><br><span class="line">        A             3x2                         48  double</span><br><span class="line">        ans           1x2                         16  double</span><br><span class="line">        featureX     27x2                        432  double</span><br><span class="line">        featureY     27x1                        216  double</span><br><span class="line">        sz            1x2                         16  double</span><br><span class="line">        v             1x4                         32  double</span><br><span class="line">        w             1x10000                  80000  double</span><br><span class="line"></span><br><span class="line">Total is 10095 elements using 80760 bytes</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Clear-variables"><a href="#Clear-variables" class="headerlink" title="Clear variables"></a>Clear variables</h3><p><code>clear</code> command can help us to clear variables that are no longer useful.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; who</span><br><span class="line">Variables in the current scope:</span><br><span class="line"></span><br><span class="line">A         ans       featureX  featureY  sz        v         w</span><br><span class="line"></span><br><span class="line">&gt;&gt; clear A    % clear a variable</span><br><span class="line">&gt;&gt; clear sz v w    % clear variables</span><br><span class="line">&gt;&gt; whos</span><br><span class="line">Variables in the current scope:</span><br><span class="line"></span><br><span class="line">   Attr Name          Size                     Bytes  Class</span><br><span class="line">   &#x3D;&#x3D;&#x3D;&#x3D; &#x3D;&#x3D;&#x3D;&#x3D;          &#x3D;&#x3D;&#x3D;&#x3D;                     &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D; </span><br><span class="line">        ans           1x2                         16  double</span><br><span class="line">        featureX     27x2                        432  double</span><br><span class="line">        featureY     27x1                        216  double</span><br><span class="line"></span><br><span class="line">Total is 83 elements using 664 bytes</span><br><span class="line">&gt;&gt; clear    % clear all variables</span><br><span class="line">&gt;&gt; whos</span><br><span class="line">&gt;&gt; </span><br></pre></td></tr></table></figure><h3 id="Save-data"><a href="#Save-data" class="headerlink" title="Save data"></a>Save data</h3><p>Take a part of a vector.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; v &#x3D; featureY(1:5)</span><br><span class="line">v &#x3D;</span><br><span class="line"></span><br><span class="line">   3999</span><br><span class="line">   3299</span><br><span class="line">   3690</span><br><span class="line">   2320</span><br><span class="line">   5399</span><br><span class="line">   </span><br><span class="line">&gt;&gt; whos</span><br><span class="line">Variables in the current scope:</span><br><span class="line"></span><br><span class="line">   Attr Name          Size                     Bytes  Class</span><br><span class="line">   &#x3D;&#x3D;&#x3D;&#x3D; &#x3D;&#x3D;&#x3D;&#x3D;          &#x3D;&#x3D;&#x3D;&#x3D;                     &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D; </span><br><span class="line">        featureX     27x2                        432  double</span><br><span class="line">        featureY     27x1                        216  double</span><br><span class="line">        v             5x1                         40  double</span><br><span class="line"></span><br><span class="line">Total is 86 elements using 688 bytes</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Save data to disk: <code>save file_name variable [-ascii]</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; save hello.mat v    % save as a binary format</span><br><span class="line">&gt;&gt; ls</span><br><span class="line">featureX.dat featureY.dat hello.mat</span><br><span class="line">&gt;&gt; save hello.txt v -ascii;    % save as a ascii txt</span><br><span class="line">&gt;&gt; </span><br></pre></td></tr></table></figure><p>Then we can clear it from memory and load v back from disk:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; clear v</span><br><span class="line">&gt;&gt; whos</span><br><span class="line">Variables in the current scope:</span><br><span class="line"></span><br><span class="line">   Attr Name          Size                     Bytes  Class</span><br><span class="line">   &#x3D;&#x3D;&#x3D;&#x3D; &#x3D;&#x3D;&#x3D;&#x3D;          &#x3D;&#x3D;&#x3D;&#x3D;                     &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D; </span><br><span class="line">        featureX     27x2                        432  double</span><br><span class="line">        featureY     27x1                        216  double</span><br><span class="line"></span><br><span class="line">Total is 81 elements using 648 bytes</span><br><span class="line"></span><br><span class="line">&gt;&gt; load hello.mat </span><br><span class="line">&gt;&gt; whos</span><br><span class="line">Variables in the current scope:</span><br><span class="line"></span><br><span class="line">   Attr Name          Size                     Bytes  Class</span><br><span class="line">   &#x3D;&#x3D;&#x3D;&#x3D; &#x3D;&#x3D;&#x3D;&#x3D;          &#x3D;&#x3D;&#x3D;&#x3D;                     &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;  &#x3D;&#x3D;&#x3D;&#x3D;&#x3D; </span><br><span class="line">        featureX     27x2                        432  double</span><br><span class="line">        featureY     27x1                        216  double</span><br><span class="line">        v             5x1                         40  double</span><br><span class="line"></span><br><span class="line">Total is 86 elements using 688 bytes</span><br><span class="line"></span><br><span class="line">&gt;&gt; </span><br></pre></td></tr></table></figure><h3 id="Manipulate-data"><a href="#Manipulate-data" class="headerlink" title="Manipulate data"></a>Manipulate data</h3><p>Get element from a matrix:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; A &#x3D; [1, 2; 3, 4; 5, 6]</span><br><span class="line">A &#x3D;</span><br><span class="line"></span><br><span class="line">   1   2</span><br><span class="line">   3   4</span><br><span class="line">   5   6</span><br><span class="line"></span><br><span class="line">&gt;&gt; A(3, 2)    % get a element of matrix</span><br><span class="line">ans &#x3D;  6</span><br><span class="line">&gt;&gt; A(2, :)    % &quot;:&quot; means every element along that row&#x2F;column</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">   3   4</span><br><span class="line"></span><br><span class="line">&gt;&gt; A(:, 1)</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">   1</span><br><span class="line">   3</span><br><span class="line">   5</span><br><span class="line"></span><br><span class="line">&gt;&gt; A([1, 3], :)    % get the elements along row 1 &amp; 3</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">   1   2</span><br><span class="line">   5   6</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Change the elements of a matrix:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; A &#x3D; [1, 2; 3, 4; 5, 6]</span><br><span class="line">A &#x3D;</span><br><span class="line"></span><br><span class="line">   1   2</span><br><span class="line">   3   4</span><br><span class="line">   5   6</span><br><span class="line"></span><br><span class="line">&gt;&gt; A(:, 2) &#x3D; [10, 11, 12]</span><br><span class="line">A &#x3D;</span><br><span class="line"></span><br><span class="line">    1   10</span><br><span class="line">    3   11</span><br><span class="line">    5   12</span><br><span class="line"></span><br><span class="line">&gt;&gt; A(1, 1) &#x3D; 0</span><br><span class="line">A &#x3D;</span><br><span class="line"></span><br><span class="line">    0   10</span><br><span class="line">    3   11</span><br><span class="line">    5   12</span><br><span class="line"></span><br><span class="line">&gt;&gt; A &#x3D; [A, [100; 101; 102]]    % append another column vector to right</span><br><span class="line">A &#x3D;</span><br><span class="line"></span><br><span class="line">     0    10   100</span><br><span class="line">     3    11   101</span><br><span class="line">     5    12   102</span><br><span class="line"></span><br><span class="line">&gt;&gt; A &#x3D; [1, 2; 3, 4; 5, 6]</span><br><span class="line">A &#x3D;</span><br><span class="line"></span><br><span class="line">   1   2</span><br><span class="line">   3   4</span><br><span class="line">   5   6</span><br><span class="line"></span><br><span class="line">&gt;&gt; B &#x3D; A + 10</span><br><span class="line">B &#x3D;</span><br><span class="line"></span><br><span class="line">   11   12</span><br><span class="line">   13   14</span><br><span class="line">   15   16</span><br><span class="line"></span><br><span class="line">&gt;&gt; C &#x3D; [A, B]</span><br><span class="line">C &#x3D;</span><br><span class="line"></span><br><span class="line">    1    2   11   12</span><br><span class="line">    3    4   13   14</span><br><span class="line">    5    6   15   16</span><br><span class="line"></span><br><span class="line">&gt;&gt; D &#x3D; [A; B];</span><br><span class="line">&gt;&gt; size(D)</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">   6   2</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Put all elements of a matrix into a single column vector:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; A</span><br><span class="line">A &#x3D;</span><br><span class="line"></span><br><span class="line">     0    10   100</span><br><span class="line">     3    11   101</span><br><span class="line">     5    12   102</span><br><span class="line"></span><br><span class="line">&gt;&gt; A(:)    % put all elements of A into a single vector</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">     0</span><br><span class="line">     3</span><br><span class="line">     5</span><br><span class="line">    10</span><br><span class="line">    11</span><br><span class="line">    12</span><br><span class="line">   100</span><br><span class="line">   101</span><br><span class="line">   102</span><br></pre></td></tr></table></figure><h2 id="Computing-on-Data"><a href="#Computing-on-Data" class="headerlink" title="Computing on Data"></a>Computing on Data</h2><h3 id="Element-wise-operations"><a href="#Element-wise-operations" class="headerlink" title="Element-wise operations"></a>Element-wise operations</h3><p>Use <code>.&lt;operator&gt;</code> instead of <code>&lt;operator&gt;</code> for element-wise operations (i.e. operations between elements).</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; A &#x3D; [1, 2; 3, 4; 5, 6];</span><br><span class="line">&gt;&gt; B &#x3D; [11, 12; 13, 14; 15, 16];</span><br><span class="line">&gt;&gt; C &#x3D; [1 1; 2 2];</span><br><span class="line">&gt;&gt; v &#x3D; [1, 2, 3];</span><br><span class="line">&gt;&gt; A .* B    % element-wise multiplication (ans &#x3D; [A(1,1)*B(1,1), A(1,2)*B(1,2); ...])</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">   11   24</span><br><span class="line">   39   56</span><br><span class="line">   75   96</span><br><span class="line"></span><br><span class="line">&gt;&gt; A .^ 2    % squaring each element of A</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">    1    4</span><br><span class="line">    9   16</span><br><span class="line">   25   36</span><br><span class="line"></span><br><span class="line">&gt;&gt; 1 .&#x2F; A</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">   1.00000   0.50000</span><br><span class="line">   0.33333   0.25000</span><br><span class="line">   0.20000   0.16667</span><br><span class="line"></span><br><span class="line">&gt;&gt; v .+ 1    % equals to &#96;v + 1&#96; &amp; &#96;v + ones(1, length(v))&#96;</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">   2   3   4</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Element-wise comparison:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; a</span><br><span class="line">a &#x3D;</span><br><span class="line"></span><br><span class="line">    1.00000   15.00000    2.00000    0.50000</span><br><span class="line"></span><br><span class="line">&gt;&gt; a &lt; 3</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">  1  0  1  1</span><br><span class="line">  </span><br><span class="line">&gt;&gt; find(a &lt; 3)    % to find the elements that are less then 3 in a, return their indices</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">   1   3   4</span><br><span class="line">   </span><br><span class="line">&gt;&gt; A</span><br><span class="line">A &#x3D;</span><br><span class="line"></span><br><span class="line">   1   2</span><br><span class="line">   3   4</span><br><span class="line">   5   6</span><br><span class="line"></span><br><span class="line">&gt;&gt; [r, c] &#x3D; find(A &lt; 3)</span><br><span class="line">r &#x3D;</span><br><span class="line"></span><br><span class="line">   1</span><br><span class="line">   1</span><br><span class="line"></span><br><span class="line">c &#x3D;</span><br><span class="line"></span><br><span class="line">   1</span><br><span class="line">   2</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Functions are element-wise:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; v &#x3D; [1, 2, 3]</span><br><span class="line">v &#x3D;</span><br><span class="line"></span><br><span class="line">   1   2   3</span><br><span class="line"></span><br><span class="line">&gt;&gt; log(v)</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">   0.00000   0.69315   1.09861</span><br><span class="line"></span><br><span class="line">&gt;&gt; exp(v)</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">    2.7183    7.3891   20.0855</span><br><span class="line"></span><br><span class="line">&gt;&gt; abs([-1, 2, -3, 4])</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">   1   2   3   4</span><br><span class="line"></span><br><span class="line">&gt;&gt; -v    % -1 * v</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">  -1  -2  -3</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Floor and Ceil of elements:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; a</span><br><span class="line">a &#x3D;</span><br><span class="line"></span><br><span class="line">    1.00000   15.00000    2.00000    0.50000</span><br><span class="line"></span><br><span class="line">&gt;&gt; floor(a)</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">    1   15    2    0</span><br><span class="line"></span><br><span class="line">&gt;&gt; ceil(a)</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">    1   15    2    1</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Matrix-operations"><a href="#Matrix-operations" class="headerlink" title="Matrix operations"></a>Matrix operations</h3><p>Matrix multiplication:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; A &#x3D; [1, 2; 3, 4; 5, 6];</span><br><span class="line">&gt;&gt; C &#x3D; [1 1; 2 2];</span><br><span class="line">&gt;&gt; A * C    % matrix multiplication</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">    5    5</span><br><span class="line">   11   11</span><br><span class="line">   17   17</span><br></pre></td></tr></table></figure><p>Transpose:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; A &#x3D; [1, 2; 3, 4; 5, 6];</span><br><span class="line">&gt;&gt; A&#39;    % transposed</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">   1   3   5</span><br><span class="line">   2   4   6</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Get the max element of a vector | matrix:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; a &#x3D; [1 15 2 0.5];</span><br><span class="line">&gt;&gt; A &#x3D; [1, 2; 3, 4; 5, 6];</span><br><span class="line">&gt;&gt; max_val &#x3D; max(a)</span><br><span class="line">max_val &#x3D;  15</span><br><span class="line">&gt;&gt; [val, index] &#x3D; max(a)</span><br><span class="line">val &#x3D;  15</span><br><span class="line">index &#x3D;  2</span><br><span class="line">&gt;&gt; max(A)    % &#96;max(&lt;Matrix&gt;)&#96; does a column-wise maximum</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">   5   6</span><br><span class="line">&gt;&gt; max(A, [], 1)    % max per column</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">   5   6</span><br><span class="line"></span><br><span class="line">&gt;&gt; max(A, [], 2)    % max per row</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">   2</span><br><span class="line">   4</span><br><span class="line">   6</span><br><span class="line"></span><br><span class="line">&gt;&gt; max(max(A))    % the max element of whole matrix</span><br><span class="line">ans &#x3D;  6</span><br><span class="line">&gt;&gt; max(A(:))</span><br><span class="line">ans &#x3D;  6</span><br></pre></td></tr></table></figure><p>Sum &amp; prod of vector:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; a</span><br><span class="line">a &#x3D;</span><br><span class="line"></span><br><span class="line">    1.00000   15.00000    2.00000    0.50000</span><br><span class="line">    </span><br><span class="line">&gt;&gt; A</span><br><span class="line">A &#x3D;</span><br><span class="line"></span><br><span class="line">   1   2</span><br><span class="line">   3   4</span><br><span class="line">   5   6</span><br><span class="line"></span><br><span class="line">&gt;&gt; sum(a)</span><br><span class="line">ans &#x3D;  18.500</span><br><span class="line">&gt;&gt; sum(A)</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">    9   12</span><br><span class="line">    </span><br><span class="line">&gt;&gt; sum(A, 1)</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">    9   12</span><br><span class="line"></span><br><span class="line">&gt;&gt; sum(A, 2)</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">    3</span><br><span class="line">    7</span><br><span class="line">   11</span><br><span class="line"></span><br><span class="line">&gt;&gt; prod(a)</span><br><span class="line">ans &#x3D;  15</span><br><span class="line">&gt;&gt; prod(A)</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">   15   48</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Get the diagonal elements:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; A &#x3D; magic(4)</span><br><span class="line">A &#x3D;</span><br><span class="line"></span><br><span class="line">   16    2    3   13</span><br><span class="line">    5   11   10    8</span><br><span class="line">    9    7    6   12</span><br><span class="line">    4   14   15    1</span><br><span class="line"></span><br><span class="line">&gt;&gt; A .* eye(4)</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">   16    0    0    0</span><br><span class="line">    0   11    0    0</span><br><span class="line">    0    0    6    0</span><br><span class="line">    0    0    0    1</span><br><span class="line"></span><br><span class="line">&gt;&gt; sum(A .* eye(4))</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">   16   11    6    1</span><br><span class="line"></span><br><span class="line">&gt;&gt; flipud(eye(4))    % flip up down</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">Permutation Matrix</span><br><span class="line"></span><br><span class="line">   0   0   0   1</span><br><span class="line">   0   0   1   0</span><br><span class="line">   0   1   0   0</span><br><span class="line">   1   0   0   0</span><br><span class="line"></span><br><span class="line">&gt;&gt; sum(A .* flipud(eye(4)))</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">    4    7   10   13</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Inverse:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; A &#x3D; magic(3)</span><br><span class="line">A &#x3D;</span><br><span class="line"></span><br><span class="line">   8   1   6</span><br><span class="line">   3   5   7</span><br><span class="line">   4   9   2</span><br><span class="line"></span><br><span class="line">&gt;&gt; pinv(A)</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">   0.147222  -0.144444   0.063889</span><br><span class="line">  -0.061111   0.022222   0.105556</span><br><span class="line">  -0.019444   0.188889  -0.102778</span><br><span class="line"></span><br><span class="line">&gt;&gt; pinv(A) * A    % get identity matrix</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">   1.0000e+00   2.0817e-16  -3.1641e-15</span><br><span class="line">  -6.1062e-15   1.0000e+00   6.2450e-15</span><br><span class="line">   3.0531e-15   4.1633e-17   1.0000e+00</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Plotting-Data"><a href="#Plotting-Data" class="headerlink" title="Plotting Data"></a>Plotting Data</h2><h3 id="Plotting-a-function"><a href="#Plotting-a-function" class="headerlink" title="Plotting a function"></a>Plotting a function</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; clear</span><br><span class="line">&gt;&gt; t &#x3D; [0:0.01:0.98];</span><br><span class="line">&gt;&gt; size(t)</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">    1   99</span><br><span class="line"></span><br><span class="line">&gt;&gt; y1 &#x3D; sin(2*pi*4*t);</span><br><span class="line">&gt;&gt; plot(t, y1);</span><br></pre></td></tr></table></figure><p>It will show you a figure like this:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6s5bn03vsj30dj0ao3yt.jpg" alt="image-20190908153422239"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; y2 &#x3D; cos(2*pi*4*t);</span><br><span class="line">&gt;&gt; plot(t, y2);</span><br></pre></td></tr></table></figure><p>ğŸ‘† This will replace the sin figure with a new cos figure.</p><p>If we want to have both the sin and cos plots, the <code>hold on</code> command will help:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; plot(t, y1);</span><br><span class="line">&gt;&gt; hold on;</span><br><span class="line">&gt;&gt; plot(t, y2, &#39;r&#39;);</span><br></pre></td></tr></table></figure><p>We can set some text on thw figure:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; xlabel(&quot;time&quot;);</span><br><span class="line">&gt;&gt; ylabel(&quot;value&quot;);</span><br><span class="line">&gt;&gt; legend(&#39;sin&#39;, &#39;cos&#39;);    % Show what the 2 lines are</span><br><span class="line">&gt;&gt; title(&#39;my plot&#39;);</span><br></pre></td></tr></table></figure><p>Now, we get this:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6s5m92rbyj30dc0a0jsq.jpg" alt="myPlot"></p><p>Then, we save it and close the plotting window:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; print -dpng &#39;myPlot.png&#39;    % save it to $(pwd)</span><br><span class="line">&gt;&gt; close</span><br></pre></td></tr></table></figure><p>We can show two figures at the same time:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; figure(1); plot(t, y1);</span><br><span class="line">&gt;&gt; figure(2); plot(t, y2);</span><br></pre></td></tr></table></figure><p>Then, we can also generate figures like this:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6s5u82kobj30e20avwf2.jpg" alt="image-20190908155218094"></p><p>What we need to do is using a <code>subplot</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; subplot(1, 2, 1);    % Divides plot a 1x2 grid, access first element</span><br><span class="line">&gt;&gt; plot(t, y1);</span><br><span class="line">&gt;&gt; subplot(1, 2, 2);</span><br><span class="line">&gt;&gt; plot(t, y2);</span><br><span class="line">&gt;&gt; axis([0.5, 1, -1, 1])    % change the range of axis</span><br></pre></td></tr></table></figure><p>Use <code>clf</code> to clear a figure:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; clf;</span><br></pre></td></tr></table></figure><h3 id="Showing-a-matrix"><a href="#Showing-a-matrix" class="headerlink" title="Showing a matrix"></a>Showing a matrix</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; A &#x3D; magic(5)</span><br><span class="line">A &#x3D;</span><br><span class="line"></span><br><span class="line">   17   24    1    8   15</span><br><span class="line">   23    5    7   14   16</span><br><span class="line">    4    6   13   20   22</span><br><span class="line">   10   12   19   21    3</span><br><span class="line">   11   18   25    2    9</span><br><span class="line"></span><br><span class="line">&gt;&gt; imagesc(A), colorbar</span><br></pre></td></tr></table></figure><p>It gives us a figure like this:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6s62mn3gwj30d60afwej.jpg" alt="image-20190908160029068"></p><p>The different colors correspond to the different values.</p><p>Another example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; B &#x3D; magic(10);</span><br><span class="line">&gt;&gt; imagesc(B), colorbar, colormap gray;</span><br></pre></td></tr></table></figure><p>Output:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6s680rvexj30dd0aidfw.jpg" alt="image-20190908160540485"></p><h2 id="Contriol-Statements"><a href="#Contriol-Statements" class="headerlink" title="Contriol Statements"></a>Contriol Statements</h2><h3 id="for"><a href="#for" class="headerlink" title="for"></a><code>for</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; v &#x3D; zeros(10, 1)</span><br><span class="line">v &#x3D;</span><br><span class="line"></span><br><span class="line">   0</span><br><span class="line">   0</span><br><span class="line">   0</span><br><span class="line">   0</span><br><span class="line">   0</span><br><span class="line">   0</span><br><span class="line">   0</span><br><span class="line">   0</span><br><span class="line">   0</span><br><span class="line">   0</span><br><span class="line"></span><br><span class="line">&gt;&gt; for i &#x3D; 1: 10,</span><br><span class="line">&gt;     v(i) &#x3D; 2^i;</span><br><span class="line">&gt; end;</span><br><span class="line">&gt;&gt; v&#39;</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">      2      4      8     16     32     64    128    256    512   1024</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="while"><a href="#while" class="headerlink" title="while"></a><code>while</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; i &#x3D; 1;</span><br><span class="line">&gt;&gt; while i &lt;&#x3D; 5,</span><br><span class="line">&gt;     v(i) &#x3D; 100;</span><br><span class="line">&gt;     i &#x3D; i + 1;</span><br><span class="line">&gt; end;</span><br><span class="line">&gt;&gt; v&#39;</span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">    100    100    100    100    100     64    128    256    512   1024</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="if"><a href="#if" class="headerlink" title="if"></a><code>if</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; for i &#x3D; 1: 10,</span><br><span class="line">&gt;     if v(i) &gt; 100,</span><br><span class="line">&gt;         disp(v(i));</span><br><span class="line">&gt;     end;</span><br><span class="line">&gt; end;</span><br><span class="line"> 128</span><br><span class="line"> 256</span><br><span class="line"> 512</span><br><span class="line"> 1024</span><br></pre></td></tr></table></figure><p>Or, we can program like this,</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">x &#x3D; 1;</span><br><span class="line">if (x &#x3D;&#x3D; 1)</span><br><span class="line">    disp (&quot;one&quot;);</span><br><span class="line">elseif (x &#x3D;&#x3D; 2)</span><br><span class="line">    disp (&quot;two&quot;);</span><br><span class="line">else</span><br><span class="line">    disp (&quot;not one or two&quot;);</span><br><span class="line">endif</span><br></pre></td></tr></table></figure><h3 id="break-amp-continue"><a href="#break-amp-continue" class="headerlink" title="break &amp; continue"></a><code>break</code> &amp; <code>continue</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">i &#x3D; 1;</span><br><span class="line">while true,</span><br><span class="line">    v(i) &#x3D; 999;</span><br><span class="line">    i &#x3D; i + 1;</span><br><span class="line">    if i &#x3D;&#x3D; 6,</span><br><span class="line">        break;</span><br><span class="line">    end;</span><br><span class="line">end;</span><br></pre></td></tr></table></figure><p>Output:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">v &#x3D;</span><br><span class="line"></span><br><span class="line">    999</span><br><span class="line">    999</span><br><span class="line">    999</span><br><span class="line">    999</span><br><span class="line">    999</span><br><span class="line">     64</span><br><span class="line">    128</span><br><span class="line">    256</span><br><span class="line">    512</span><br><span class="line">   1024</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h2><h3 id="Create-a-Function"><a href="#Create-a-Function" class="headerlink" title="Create a Function"></a>Create a Function</h3><p>To create a function, type the function code in a text editor (e.g. gedit or notepad), and save the file as <code>functionName.m</code></p><p>Example function:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function y &#x3D; squareThisNumber(x)</span><br><span class="line"></span><br><span class="line">y &#x3D; x^2;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>To call this function in Octave, do either:</p><ol><li><code>cd</code> to the directory of the functionName.m file and call the function:</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">% Navigate to directory:</span><br><span class="line">cd &#x2F;path&#x2F;to&#x2F;function</span><br><span class="line"></span><br><span class="line">% Call the function:</span><br><span class="line">functionName(args)</span><br></pre></td></tr></table></figure><ol start="2"><li>Add the directory of the function file to the load path:</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">% To add the path for the current session of Octave:</span><br><span class="line">addpath(&#39;&#x2F;path&#x2F;to&#x2F;function&#x2F;&#39;)</span><br><span class="line"></span><br><span class="line">% To remember the path for future sessions of Octave, after executing addpath above, also do:</span><br><span class="line">    savepath</span><br></pre></td></tr></table></figure><h3 id="Function-with-multiple-return-values"><a href="#Function-with-multiple-return-values" class="headerlink" title="Function with multiple return values"></a>Function with multiple return values</h3><p>Octaveâ€™s functions can return more than one value:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function [square, cube] &#x3D; squareAndCubeThisNumber(x)</span><br><span class="line"></span><br><span class="line">square &#x3D; x^2;</span><br><span class="line">cube &#x3D; x^3;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; [s, c] &#x3D; squareAndCubeThisNumber(5)</span><br><span class="line">s &#x3D;  25</span><br><span class="line">c &#x3D;  125</span><br></pre></td></tr></table></figure><h3 id="Practice"><a href="#Practice" class="headerlink" title="Practice"></a>Practice</h3><p>Letâ€™s say I have a data set that looks like this, with data points at <code>(1, 1)</code>,<code> (2, 2)</code>, <code>(3, 3)</code>. And what Iâ€™d like to do is to define an octave function to compute the cost function J of theta for different values of theta.</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6s7xhva3yj30em08baar.jpg" alt="image-20190908170150862"></p><p>First, put the data into octave:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">X &#x3D; [1, 1; 1, 2; 1, 3]    % Design matrix</span><br><span class="line">y &#x3D; [1; 2; 3]</span><br><span class="line">theta &#x3D; [0; 1]</span><br></pre></td></tr></table></figure><p>Output:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">X &#x3D;</span><br><span class="line"></span><br><span class="line">   1   1</span><br><span class="line">   1   2</span><br><span class="line">   1   3</span><br><span class="line"></span><br><span class="line">y &#x3D;</span><br><span class="line"></span><br><span class="line">   1</span><br><span class="line">   2</span><br><span class="line">   3</span><br><span class="line"></span><br><span class="line">theta &#x3D;</span><br><span class="line"></span><br><span class="line">   0</span><br><span class="line">   1</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Then define the cost function:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">% costFunctionJ.m</span><br><span class="line"></span><br><span class="line">function J &#x3D; costFunctionJ(X, y, theta)</span><br><span class="line"></span><br><span class="line">% X is the *design matrix* containing our training examples.</span><br><span class="line">% y is the class labels</span><br><span class="line"></span><br><span class="line">m &#x3D; size(X, 1);    % number of training examples</span><br><span class="line">predictions &#x3D; X * theta;    % predictions of hypothesis on all m examples</span><br><span class="line">sqrErrors &#x3D; (predictions - y) .^ 2;    % squared erroes</span><br><span class="line"></span><br><span class="line">J &#x3D; 1 &#x2F; (2*m) * sum(sqrErrors);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Now, use the costFunctionJ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; j &#x3D; costFunctionJ(X, y, theta)</span><br><span class="line">j &#x3D; 0</span><br></pre></td></tr></table></figure><p>Got <code>j = 0</code> because we set theta as <code>[0; 1]</code> which is fitting our data set perfectly.</p><h2 id="Vectorization"><a href="#Vectorization" class="headerlink" title="Vectorization"></a>Vectorization</h2><p>Vectorization is the process of taking code that relies on <strong>loops</strong> and converting it into <strong>matrix operations</strong>. It is more efficient, more elegant, and more concise.</p><p>As an example, letâ€™s compute our prediction from a hypothesis. Theta is the vector of fields for the hypothesis and x is a vector of variables.</p><p>With loops:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">prediction &#x3D; 0.0;</span><br><span class="line">for j &#x3D; 1:n+1,</span><br><span class="line">  prediction +&#x3D; theta(j) * x(j);</span><br><span class="line">end;</span><br></pre></td></tr></table></figure><p>With vectorization:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prediction &#x3D; theta&#39; * x;</span><br></pre></td></tr></table></figure><p>If you recall the definition multiplying vectors, youâ€™ll see that this one operation does the element-wise multiplication and overall sum in a very concise notation.</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> AndrewNg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ­£è§„æ–¹ç¨‹</title>
      <link href="/2019/09/07/AndrewNgML/AndrewNg-MachineLearning-4-NormalEquation/"/>
      <url>/2019/09/07/AndrewNgML/AndrewNg-MachineLearning-4-NormalEquation/</url>
      
        <content type="html"><![CDATA[<h1 id="Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-4-Normal-Equation"><a href="#Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-4-Normal-Equation" class="headerlink" title="Notes of Andrew Ngâ€™s Machine Learning â€”â€” (4) Normal Equation"></a>Notes of Andrew Ngâ€™s Machine Learning â€”â€” (4) Normal Equation</h1><h2 id="Normal-Equation"><a href="#Normal-Equation" class="headerlink" title="Normal Equation"></a>Normal Equation</h2><p>Gradient dedcent gives one way of minimizing our cost function $J$. Letâ€™s discuss a second way of doing so â€“ <strong><code>Normal Equation</code></strong>.</p><p>Normal Equation minimize $J$ by explicitly taking its derivatives with resspect to the $\theta_j$s, and setting them to zero. This alllows us to find the optimum theta without resorting to an iteration.</p><p>The normal equation formula is given below:<br>$$<br>\theta = (X^TX)^{-1}X^Ty<br>$$</p><p>There is no need to do feature scaling with the normal equation.</p><h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6oul2lb93j30gq09dgn1.jpg" alt="img"></p><h3 id="Normal-Equation-V-S-Gradient-Descent"><a href="#Normal-Equation-V-S-Gradient-Descent" class="headerlink" title="Normal Equation V.S. Gradient Descent"></a>Normal Equation V.S. Gradient Descent</h3><table><thead><tr><th>Gradient Descent</th><th>Normal Equation</th></tr></thead><tbody><tr><td>Need to choose alpha</td><td>No need to choose alpha</td></tr><tr><td>Needs many iterations</td><td>No need to iterate</td></tr><tr><td>Time cost: $O(kn^2)$</td><td>Need to calculate inverse of $X^TX$, which costs $O(n^3)$</td></tr><tr><td>Works well when n is large</td><td>Slow if n is very large</td></tr></tbody></table><p>In practice, when $n &gt; 10,000$, we are tend to use gradient descent, otherwise, normal equation will perform better.</p><h2 id="Normal-Equation-Noninvertibility"><a href="#Normal-Equation-Noninvertibility" class="headerlink" title="Normal Equation Noninvertibility"></a>Normal Equation Noninvertibility</h2><p>When implementing the normal equation in octave we want to usr the ** <code>pinv</code>** function rather than <code>inv</code>. The <code>pinv</code> will give you a value of $\theta$ even if $X^TX$ is not invertible.</p><p>if $X^TX$ is <strong>non-invertible</strong>, the common causes might be having:</p><ul><li><strong>Redundant features</strong>, where two features are linearly dependent. (e.g. there are the size of house in feet^2 and the size of house in meter^2, where we know that 1 meter = 3.28 feet)</li><li><strong>Too many features ($m \le n$)</strong>. In this case, delete some features or use â€œregularizationâ€.</li></ul><p>Solutions to the above problems include deleting a feature that is linearly dependent with another or deleting one or more features when there are too many features.</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> AndrewNg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤šå˜é‡çº¿æ€§å›å½’</title>
      <link href="/2019/09/05/AndrewNgML/AndrewNg-MachineLearning-3-MultivariateLinearRegression/"/>
      <url>/2019/09/05/AndrewNgML/AndrewNg-MachineLearning-3-MultivariateLinearRegression/</url>
      
        <content type="html"><![CDATA[<h1 id="Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-3-Multivariate-Linear-Regression"><a href="#Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-3-Multivariate-Linear-Regression" class="headerlink" title="Notes of Andrew Ngâ€™s Machine Learning â€”â€” (3) Multivariate Linear Regression"></a>Notes of Andrew Ngâ€™s Machine Learning â€”â€” (3) Multivariate Linear Regression</h1><h2 id="Multiple-Features"><a href="#Multiple-Features" class="headerlink" title="Multiple Features"></a>Multiple Features</h2><p>Linear regression with multiple variables is alse known as â€œ<strong>multivariate linear regression</strong>â€œ.</p><h3 id="Notations"><a href="#Notations" class="headerlink" title="Notations"></a>Notations</h3><p>We now introduce notation for equations where we can have any number of input variables (Multiple Features, i.e. Multivariate):</p><ul><li>$m$: the number of training examples.</li><li>$n$: the number of features.</li><li>$x^{(i)}$: the input (features) of the $i^{th}$ training example, a n-dimensional vector.</li><li>$x^{(i)}_j$: the value of feature $j$ in the $i^{th}$ training example.  </li></ul><h3 id="Hypothesis"><a href="#Hypothesis" class="headerlink" title="Hypothesis"></a>Hypothesis</h3><p>The multivariable form of the hypothesis function accommodating these multiple features is as follows:<br>$$<br>h_\theta(x)=\theta_0+\theta_1x_1+\theta_2x_2+\theta_3x_3+ â€¦ + \theta_nx_n<br>$$</p><blockquote><p>In order to develop intuition about this function, we can think about $\theta_0$ as the basic price of a house, $\theta_1$ as the price per square meter, $\theta_2$ as the price per floor, etc. $x_1$ will be the number of square meters in the house, $x_2$ the number of floors, etc.</p></blockquote><p>Using the definition of matrix muyltiplication, our multivariable hypothesis function can be concisely represented as:<br>$$<br>h_\theta(x)=<br>\left[\begin{array}{c}\theta_0 &amp; \theta_1 &amp; \ldots &amp; \theta_n\end{array}\right]<br>\left[\begin{array}{c}x_0 \ x_1 \ \vdots \ x_n \end{array}\right]<br>=<br>\theta^Tx<br>$$<br>This is a vectorization of our hypothesis function for one training example.</p><p>Remark: Note that for convenience reasons, we assume <strong>$x^{(i)}_0=1 \quad \textrm{for(}i \in 1, â€¦,m \textrm{)}$</strong>. This allows us to do matrix operations with $\theta$ and $x$. Hence making two vector $\theta$ and $x^{(i)}$ match each other element-wise (that is, have the same number of elements: n+1).</p><h2 id="Gradient-Descent-For-Multiple-Variables"><a href="#Gradient-Descent-For-Multiple-Variables" class="headerlink" title="Gradient Descent For Multiple Variables"></a>Gradient Descent For Multiple Variables</h2><p>Letâ€™s say the condition about the multiple variables:</p><blockquote><p>Hypothesis: $h_\theta(x)=\sum_{i=0}^m \theta_ix_i$.</p><p>Parameters: $\theta_0, \theta_1, â€¦,\theta_n$.</p><p>Cost Function: $J(\theta_0, \theta_1, â€¦, \theta_n)=\frac{1}{2m}\sum_{i=1}^m(h_\theta(x^{(i)})-y^{(i)})^2$.</p></blockquote><p>Or vectorizedly:</p><blockquote><p>Hypothesis: $h_\theta(x)=\theta^Tx$.</p><p>Parameters: $\theta$.</p><p>Cost Function: $J(\theta)=\frac{1}{2m}\sum_{i=1}^m(\theta^Tx^{(i)}-y^{(i)})^2$.</p></blockquote><p>The Gradient Descent will be like this:</p><blockquote><p>repeat until convergence {</p><p>$\qquad \theta_j := \theta_j - \alpha \frac{1}{m} \sum^m_{i=1}[h_\theta(x^{(i)})-y^{(i)}] \cdot x_j^{(i)}\qquad \textrm{for }j:=0, â€¦, n$</p><p>}</p></blockquote><p>The following image compares gradient descent with one variable to gradient descent with multiple variables:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6ljh8xnnuj30g508ttam.jpg" alt="img"></p><h2 id="Feature-Scaling"><a href="#Feature-Scaling" class="headerlink" title="Feature Scaling"></a>Feature Scaling</h2><p>We can speed up gradient descent by <strong>having each of our input values in roughly the same range</strong>. This is because $\theta$ will descend quickly on small ranges and slowly on large ranges, and so will oscillate inefficiently down to the optimum when the variables are very uneven.</p><p>The way to prevent this is to <strong>modify the ranges of our input variables</strong> so that they are all roughly the same. Ideally:<br>$$<br>\begin{array}{c}<br>-1 \le x_{i} \le 1\<br>\textrm{or}\<br>-0.5 \le x_{i} \le 0.5<br>\end{array}<br>$$<br>These arenâ€™t exact requirements; we are only trying to speed things up. The goal is to get all input variables into roughly one of these ranges, give or take a few.</p><p>In practice, we offen think itâ€™s ok for variables in range $[-3,-\frac{1}{3}) \cup (+\frac{1}{3}, +3]$.</p><p>Two techniques to help with this are <code>feature scaling</code> and <code>mean normalization</code>.</p><h3 id="Feature-scaling"><a href="#Feature-scaling" class="headerlink" title="Feature scaling"></a>Feature scaling</h3><p>Feature scaling involves <strong>dividing the input values by <em>the range</em></strong> (i.e. the maximum value minus the minimum value) of input variable, resulting in a new range of just 1.<br>$$<br>\begin{array}{rl}<br>\textrm{Range:} &amp; s_i = max(x_i)-min(x_i)\<br>\textrm{Scaling:} &amp; x_i:=\frac{x_i}{s_i}<br>\end{array}<br>$$</p><h3 id="Mean-normalization"><a href="#Mean-normalization" class="headerlink" title="Mean normalization"></a>Mean normalization</h3><p>Mean normalization involves subtracting the average value for an input variable from the values for that input variable resulting in a new average value for the input variable of just zero.<br>$$<br>\begin{array}{rl}<br>\textrm{Average:} &amp; \mu_i = \frac{sum(x_i)}{m}\<br>\textrm{Mean normalizing:} &amp; x_i:=x_i-\mu_i<br>\end{array}<br>$$</p><h3 id="Implement"><a href="#Implement" class="headerlink" title="Implement"></a>Implement</h3><p>We always implement both of these techniques via adjusting our input values as shown in this formula:<br>$$<br>x_i:=\frac{x_i-\mu_i}{s_i}<br>$$</p><ul><li><strong>$\mu_i$</strong> is the <strong>average of all the values for feature (i)</strong></li><li><strong>$s_i$</strong> is the <strong>range of values (<code>max - min</code>)</strong>, or $s_i$ could also be the <strong>standard deviation</strong>.</li></ul><p>For example, if $x_i$ represents housing prices with a range of 100 to 2000 and a mean value of 1000, then, $x_i := \dfrac{price-1000}{1900}$.</p><h4 id="In-octave"><a href="#In-octave" class="headerlink" title="In octave"></a>In octave</h4><p>In octave, the function <code>mean</code> can offer us the avaerage of values for feature (i), when the function <code>std</code> gives us the standard deviation of values for feature (i). So we can program like this:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">function [X_norm, mu, sigma] &#x3D; featureNormalize(X)</span><br><span class="line">%FEATURENORMALIZE Normalizes the features in X </span><br><span class="line">%   FEATURENORMALIZE(X) returns a normalized version of X where</span><br><span class="line">%   the mean value of each feature is 0 and the standard deviation</span><br><span class="line">%   is 1. This is often a good preprocessing step to do when</span><br><span class="line">%   working with learning algorithms.</span><br><span class="line"></span><br><span class="line">X_norm &#x3D; X;</span><br><span class="line">mu &#x3D; zeros(1, size(X, 2));</span><br><span class="line">sigma &#x3D; zeros(1, size(X, 2));</span><br><span class="line"></span><br><span class="line">% Instructions: First, for each feature dimension, compute the mean</span><br><span class="line">%               of the feature and subtract it from the dataset,</span><br><span class="line">%               storing the mean value in mu. Next, compute the </span><br><span class="line">%               standard deviation of each feature and divide</span><br><span class="line">%               each feature by it&#39;s standard deviation, storing</span><br><span class="line">%               the standard deviation in sigma. </span><br><span class="line">%</span><br><span class="line">%               Note that X is a matrix where each column is a </span><br><span class="line">%               feature and each row is an example. You need </span><br><span class="line">%               to perform the normalization separately for </span><br><span class="line">%               each feature. </span><br><span class="line">%</span><br><span class="line"></span><br><span class="line">mu &#x3D; mean(X);</span><br><span class="line">sigma &#x3D; std(X);</span><br><span class="line">X_norm &#x3D; (X - mu) .&#x2F; sigma;</span><br><span class="line"></span><br><span class="line">end</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Learning-Rate"><a href="#Learning-Rate" class="headerlink" title="Learning Rate"></a>Learning Rate</h2><h3 id="Debugging-gradient-descent"><a href="#Debugging-gradient-descent" class="headerlink" title="Debugging gradient descent"></a>Debugging gradient descent</h3><p>Make a plot with <em>number of iterations</em> on the x-axis. Now plot the cost functiong $J(\theta)$ over the number of iterations of  gradient descent. If $J(\theta)$ ever increases, then you probably need to decrease learning rate $\alpha$.</p><h3 id="Automatic-convergence-test"><a href="#Automatic-convergence-test" class="headerlink" title="Automatic convergence test"></a>Automatic convergence test</h3><p>Declare convergence if $J(\theta)$ decreases by less than $\epsilon$, where $\epsilon$ is some small value such as $10^{-3}$. However in practice itâ€™s difficult to choose this threshold value.</p><h3 id="Making-sure-gradient-descent-is-working-correctly"><a href="#Making-sure-gradient-descent-is-working-correctly" class="headerlink" title="Making sure gradient descent is working correctly"></a>Making sure gradient descent is working correctly</h3><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6mi7c257sj30eg07wt9v.jpg" alt="img"></p><p>It has been proven that if learning rate Î± is sufficiently small, then J(Î¸) will decrease on every iteration.</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6mi84pb5bj30e807pjsd.jpg" alt="img"></p><p>To summarize:</p><blockquote><p>If $\alpha$ is too small: slow convergence.</p><p>If $\alpha$ is too large: ï¿¼may not decrease on every iteration and thus may not converge.</p></blockquote><h3 id="Implement-1"><a href="#Implement-1" class="headerlink" title="Implement"></a>Implement</h3><p>We should try different $\alpha$ to find a fit one by drawing #iterations-J(Î¸) plots.</p><p>E.g. To choose $\alpha$, try:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">... , 0.001, 0.003, 0.01, 0.03, 0.1, 0.3, 1, ...</span><br></pre></td></tr></table></figure><h2 id="Features-and-Polynomial-Regression"><a href="#Features-and-Polynomial-Regression" class="headerlink" title="Features and Polynomial Regression"></a>Features and Polynomial Regression</h2><h3 id="Combine-Features"><a href="#Combine-Features" class="headerlink" title="Combine Features"></a>Combine Features</h3><p>We can improve our features and the form of our hypothesis function in a couple different ways.</p><p>For example, we can <strong>combine</strong> multiple features into one, Such as combining $x_1$ and $x_2$ into a new feature $x_3$ by taking $x_1 \cdot x_2$.</p><h3 id="Polynomial-Regression"><a href="#Polynomial-Regression" class="headerlink" title="Polynomial Regression"></a>Polynomial Regression</h3><p>To fit the data well, our hypothesis function may need to be non-linear. So we can <strong>change the behavior or curve</strong> of our hypothesis function by making it a quadratic, cubic or square root function (or any other form).</p><p>For example, if our hypothesis function is $h_\theta(x)=\theta_0+\theta_1x_1$ then we can create additional features based on $x_1$, to get the quadratic function $h_\theta(x)=\theta_0+\theta_1x_1+\theta_2x_1^2$ or the cubic function $h_\theta(x)=\theta_0+\theta_1x_1+\theta_2x_1^2+\theta_3x_1^3$, to make it a square root function, we could do: $h_\theta(x) = \theta_0 + \theta_1 x_1 + \theta_2 \sqrt{x_1}$.</p><p>In the cubic version, we can create new features $x_2$, $x_3$ where $x_2=x_1^2$ and $x_3=x_1^3$, then we can get a set of thetas via gradient descent for multiple variables.</p><p>âš ï¸Note. if you choose your features this way then <strong>feature scaling</strong> becomes very important.</p><p>e.g. if x has range 1 ~ 1000:</p><p>Then range of x^2 becomes 1 ~ 1000000;</p><p>And range of x^3 becomes 1 ~ 1000000000;</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> AndrewNg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çº¿æ€§ä»£æ•°å¤ä¹ </title>
      <link href="/2019/09/02/AndrewNgML/AndrewNg-MachineLearning-2-LinearAlgebraReview/"/>
      <url>/2019/09/02/AndrewNgML/AndrewNg-MachineLearning-2-LinearAlgebraReview/</url>
      
        <content type="html"><![CDATA[<h1 id="Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-2-Linear-Algebra-Review"><a href="#Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-2-Linear-Algebra-Review" class="headerlink" title="Notes of Andrew Ngâ€™s Machine Learning â€”â€” (2) Linear Algebra Review"></a>Notes of Andrew Ngâ€™s Machine Learning â€”â€” (2) Linear Algebra Review</h1><h2 id="Matrices-and-Vectors"><a href="#Matrices-and-Vectors" class="headerlink" title="Matrices and Vectors"></a>Matrices and Vectors</h2><ul><li><strong>Matrices</strong> are 2-dimensional arrays:</li></ul><p>$$<br>\left[\begin{array}{ccc}<br>a &amp; b &amp; c \<br>d &amp; e &amp; f \<br>g &amp; h &amp; i \<br>j &amp; k &amp; l \<br>\end{array}\right]<br>$$</p><p>The above matrix has four rows and three columns, so it is a <code>4 x 3 matrix</code>.</p><ul><li><strong>Vector</strong> are matrices with one column and many rows:</li></ul><p>$$<br>\left[\begin{array}{c}<br>w \<br>x \<br>y \<br>z \<br>\end{array}\right]<br>$$</p><p>The above vector is a <code>4 x 1 matrix</code>.</p><h3 id="Notation-and-terms"><a href="#Notation-and-terms" class="headerlink" title="Notation and terms"></a>Notation and terms</h3><ul><li>$A_{ij}$ refers to the element in the <em>ith row</em> and <em>jth column</em> of matrix A.</li><li>A vector with â€˜nâ€™ rows is referred to as a <code>&#39;n&#39;-dimensional vector</code>.</li><li>$v_i$ refers to the element in the <em>ith row</em> of the vector.</li><li>In general, all our vectors and matrices will be <code>1-indexed</code>, which refers that itâ€™s beginning from <code>1</code>. Note that this is different to lots of programming languages.</li><li>Matrices are usualy denoted by uppercase names while vectors are lowercase.</li><li><code>Scalar</code> means that an object is a single value, not a vector or matrix.</li><li>$\R$ referss to the set of scalar real numbers.</li><li>$R^n$ refers to the set of n-dimensional vectors of real numbers.</li></ul><h3 id="in-Octave-Matlab"><a href="#in-Octave-Matlab" class="headerlink" title="in Octave/Matlab"></a>in Octave/Matlab</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">% The ; denotes we are going back to a new row.</span><br><span class="line">A &#x3D; [1, 2, 3; 4, 5, 6; 7, 8, 9; 10, 11, 12]</span><br><span class="line"></span><br><span class="line">% Initialize a vector </span><br><span class="line">v &#x3D; [1;2;3] </span><br><span class="line"></span><br><span class="line">% Get the dimension of the matrix A where m &#x3D; rows and n &#x3D; columns</span><br><span class="line">[m,n] &#x3D; size(A)</span><br><span class="line"></span><br><span class="line">% You could also store it this way</span><br><span class="line">dim_A &#x3D; size(A)</span><br><span class="line"></span><br><span class="line">% Get the dimension of the vector v </span><br><span class="line">dim_v &#x3D; size(v)</span><br><span class="line"></span><br><span class="line">% Now let&#39;s index into the 2nd row 3rd column of matrix A</span><br><span class="line">A_23 &#x3D; A(2,3)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Output:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">A &#x3D;</span><br><span class="line"></span><br><span class="line">    1    2    3</span><br><span class="line">    4    5    6</span><br><span class="line">    7    8    9</span><br><span class="line">   10   11   12</span><br><span class="line"></span><br><span class="line">v &#x3D;</span><br><span class="line"></span><br><span class="line">   1</span><br><span class="line">   2</span><br><span class="line">   3</span><br><span class="line"></span><br><span class="line">m &#x3D;  4</span><br><span class="line">n &#x3D;  3</span><br><span class="line">dim_A &#x3D;</span><br><span class="line"></span><br><span class="line">   4   3</span><br><span class="line"></span><br><span class="line">dim_v &#x3D;</span><br><span class="line"></span><br><span class="line">   3   1</span><br><span class="line"></span><br><span class="line">A_23 &#x3D;  6</span><br></pre></td></tr></table></figure><h2 id="Addition-and-Scalar-Multiplication"><a href="#Addition-and-Scalar-Multiplication" class="headerlink" title="Addition and Scalar Multiplication"></a>Addition and Scalar Multiplication</h2><h3 id="Addition"><a href="#Addition" class="headerlink" title="Addition"></a>Addition</h3><p><strong>Addition</strong> and <strong>subtraction</strong> are element-wise, so you simply add or subtract each corresponding element:<br>$$<br>\left[\begin{array}{cc}<br>a &amp; b \<br>c &amp; d \<br>\end{array}\right]<br>+<br>\left[\begin{array}{cc}<br>w &amp; x\<br>y &amp; z\<br>\end{array}\right]<br>=<br>\left[\begin{array}{cc}<br>a+w &amp; b+x \<br>c+y &amp; d+z \<br>\end{array}\right]<br>$$<br>To add or subtract two matrices, their <em>dimensions</em> must be <strong>the same</strong>.</p><h3 id="Scalar-multiplication"><a href="#Scalar-multiplication" class="headerlink" title="Scalar multiplication"></a>Scalar multiplication</h3><p>In <strong>scalar multiplication</strong>, we simply multiply every element by the scalar value:<br>$$<br>\left[\begin{array}{cc}<br>a &amp; b \<br>c &amp; d \<br>\end{array}\right]<br>*x<br>=<br>\left[\begin{array}{cc}<br>ax &amp; bx \<br>cx &amp; dx \<br>\end{array}\right]<br>$$</p><h3 id="in-Octave-Matlab-1"><a href="#in-Octave-Matlab-1" class="headerlink" title="in Octave/Matlab"></a>in Octave/Matlab</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">% Initialize matrix A and B </span><br><span class="line">A &#x3D; [1, 2, 4; 5, 3, 2]</span><br><span class="line">B &#x3D; [1, 3, 4; 1, 1, 1]</span><br><span class="line"></span><br><span class="line">% Initialize constant s </span><br><span class="line">s &#x3D; 2</span><br><span class="line"></span><br><span class="line">% See how element-wise addition works</span><br><span class="line">add_AB &#x3D; A + B </span><br><span class="line"></span><br><span class="line">% See how element-wise subtraction works</span><br><span class="line">sub_AB &#x3D; A - B</span><br><span class="line"></span><br><span class="line">% See how scalar multiplication works</span><br><span class="line">mult_As &#x3D; A * s</span><br><span class="line"></span><br><span class="line">% Divide A by s</span><br><span class="line">div_As &#x3D; A &#x2F; s</span><br><span class="line"></span><br><span class="line">% A Matrix + scalar will get Matrix + a new matrix that each element equals the scalar </span><br><span class="line">add_As &#x3D; A + s</span><br></pre></td></tr></table></figure><p>Output:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">A &#x3D;</span><br><span class="line"></span><br><span class="line">   1   2   4</span><br><span class="line">   5   3   2</span><br><span class="line"></span><br><span class="line">B &#x3D;</span><br><span class="line"></span><br><span class="line">   1   3   4</span><br><span class="line">   1   1   1</span><br><span class="line"></span><br><span class="line">s &#x3D;  2</span><br><span class="line">add_AB &#x3D;</span><br><span class="line"></span><br><span class="line">   2   5   8</span><br><span class="line">   6   4   3</span><br><span class="line"></span><br><span class="line">sub_AB &#x3D;</span><br><span class="line"></span><br><span class="line">   0  -1   0</span><br><span class="line">   4   2   1</span><br><span class="line"></span><br><span class="line">mult_As &#x3D;</span><br><span class="line"></span><br><span class="line">    2    4    8</span><br><span class="line">   10    6    4</span><br><span class="line"></span><br><span class="line">div_As &#x3D;</span><br><span class="line"></span><br><span class="line">   0.50000   1.00000   2.00000</span><br><span class="line">   2.50000   1.50000   1.00000</span><br><span class="line"></span><br><span class="line">add_As &#x3D;</span><br><span class="line"></span><br><span class="line">   3   4   6</span><br><span class="line">   7   5   4</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Matrix-Vector-Multiplication"><a href="#Matrix-Vector-Multiplication" class="headerlink" title="Matrix-Vector Multiplication"></a>Matrix-Vector Multiplication</h2><p>We map the column of the vector onto each row of the matrix, multiplying each element and summing the result.<br>$$<br>\left[\begin{array}{cc}<br>a &amp; b\<br>c &amp; d\<br>e &amp; f\<br>\end{array}\right]<br>*<br>\left[\begin{array}{c}<br>x\<br>y<br>\end{array}\right]<br>=<br>\left[\begin{array}{cc}<br>ax &amp; by\<br>cx &amp; dy\<br>ex &amp; fy\<br>\end{array}\right]<br>$$<br>The result is a <strong>vector</strong>. The number of <strong>columns</strong> of the matrix must equal the number of <strong>rows</strong> of the vector.</p><p>An <code>m x n matrix</code> multiplied by an <code>n x 1 vector</code> results in an <code>m x 1 vector</code>.</p><h3 id="in-Octave-Matlab-2"><a href="#in-Octave-Matlab-2" class="headerlink" title="in Octave/Matlab"></a>in Octave/Matlab</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">% Initialize matrix A </span><br><span class="line">A &#x3D; [1, 2, 3; 4, 5, 6;7, 8, 9] </span><br><span class="line"></span><br><span class="line">% Initialize vector v </span><br><span class="line">v &#x3D; [1; 1; 1] </span><br><span class="line"></span><br><span class="line">% Multiply A * v</span><br><span class="line">Av &#x3D; A * v</span><br></pre></td></tr></table></figure><p>Output:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">A &#x3D;</span><br><span class="line"></span><br><span class="line">   1   2   3</span><br><span class="line">   4   5   6</span><br><span class="line">   7   8   9</span><br><span class="line"></span><br><span class="line">v &#x3D;</span><br><span class="line"></span><br><span class="line">   1</span><br><span class="line">   1</span><br><span class="line">   1</span><br><span class="line"></span><br><span class="line">Av &#x3D;</span><br><span class="line"></span><br><span class="line">    6</span><br><span class="line">   15</span><br><span class="line">   24</span><br></pre></td></tr></table></figure><h3 id="Neat-Trick"><a href="#Neat-Trick" class="headerlink" title="Neat Trick"></a>Neat Trick</h3><p>Say, we have a set of four sizes of houses, and we have a hypotheses for predictiong what the price of a house. We are going to compute $h(x)$ of each of our 4 houses:</p><blockquote><p>House sizes:<br>$$<br>\begin{array}{c}<br>2104\<br>1416\<br>1534\<br>852\<br>\end{array}<br>$$<br>Hypothesis:<br>$$<br>h_\theta(x)=-40+0.25x<br>$$</p></blockquote><p>It turns out thereâ€™s neat way of posing this, applying this hypothesis to all of my houses at the same time via a Matrix-Vector multiplication.</p><ul><li>Construct a <code>DataMatrix</code>:</li></ul><p>$$<br>\textrm{DataMatrix}=<br>\left[\begin{array}{cc}<br>1 &amp; 2104\<br>1 &amp; 1416\<br>1 &amp; 1534\<br>1 &amp; 852\<br>\end{array}\right]<br>$$</p><ul><li>Put <code>Parameters</code> to a vector:</li></ul><p>$$<br>\textrm{Parameters}=<br>\left[\begin{array}{c}<br>-40\<br>0.25\<br>\end{array}\right]<br>$$</p><ul><li>Then, the <code>Predictions</code> will be clear by calculate a Matrix-Vector Multiplication:</li></ul><p>$$<br>\begin{array}{ccccc}<br>\textrm{Predictions} &amp; = &amp; \textrm{DataMatrix} &amp; * &amp; \textrm{Parameters}\<br> &amp; = &amp; \left[\begin{array}{cc}<br>1 &amp; 2104\<br>1 &amp; 1416\<br>1 &amp; 1534\<br>1 &amp; 852<br>\end{array}\right] &amp; * &amp; \left[\begin{array}{c}<br>-40\<br>0.25<br>\end{array}\right]<br>\end{array}<br>$$</p><p>The reuslt will be something like this:<br>$$<br>\textrm{Predictions}=<br>\left[\begin{array}{c}<br>-40 \times 1 + 0.25 \times 2104\<br>-40 \times 1 + 0.25 \times 1416\<br>\vdots<br>\end{array}\right]<br>$$<br>Obviously, itâ€™s equal to the codes below:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for (i &#x3D; 0; i &lt; X.size(); i++) &#123;</span><br><span class="line">Predictions[i] &#x3D; h(X[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>However, our new trick simplifies the code, makes it more readable as well as driving it faster to be solved in most programming languages, we just construct two matrices and do a multiplication:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DataMatrix &#x3D; [...]</span><br><span class="line">Parameters &#x3D; [...]</span><br><span class="line">Predictions &#x3D; DataMatrix * Parameters</span><br></pre></td></tr></table></figure><h2 id="Matrix-Matrix-Multiplication"><a href="#Matrix-Matrix-Multiplication" class="headerlink" title="Matrix-Matrix Multiplication"></a>Matrix-Matrix Multiplication</h2><p>We multiply two matrices by breaking it into serveral vector multiplications and concatenating the result.<br>$$<br>\left[\begin{array}{cc}<br>a &amp; b\<br>c &amp; d\<br>e &amp; f\<br>\end{array}\right]<br>*<br>\left[\begin{array}{cc}<br>w &amp; x\<br>y &amp; z\<br>\end{array}\right]<br>=<br>\left[\begin{array}{cc}<br>aw+by &amp; ax+bz\<br>cw+dy &amp; cx+dz\<br>ew+fy &amp; ex+fz\<br>\end{array}\right]<br>$$<br>An <code>m x n matrix</code> multiplied by an <code>n x o matrix</code> result in an <code>m x o</code> matrix ($[m \times n]*[n \times o]=[m \times o]$). In the above example, a 3 x 2 matrix times a 2 x 2 matrix resulted in a 3 x 2 matrix.</p><p>To multiply two matrices, the number of <strong>columns</strong> of the first matrix must equal the number of <strong>rows</strong> of the second matrix.</p><h3 id="in-Octave-Matlab-3"><a href="#in-Octave-Matlab-3" class="headerlink" title="in Octave/Matlab"></a>in Octave/Matlab</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A &#x3D; [1, 2; 3, 4; 5, 6]</span><br><span class="line">B &#x3D; [7, 8; 9, 10]</span><br><span class="line">A*B</span><br></pre></td></tr></table></figure><p>Output:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">A &#x3D;</span><br><span class="line"></span><br><span class="line">   1   2</span><br><span class="line">   3   4</span><br><span class="line">   5   6</span><br><span class="line"></span><br><span class="line">B &#x3D;</span><br><span class="line"></span><br><span class="line">    7    8</span><br><span class="line">    9   10</span><br><span class="line"></span><br><span class="line">ans &#x3D;</span><br><span class="line"></span><br><span class="line">    25    28</span><br><span class="line">    57    64</span><br><span class="line">    89   100</span><br></pre></td></tr></table></figure><h3 id="Neat-Trick-1"><a href="#Neat-Trick-1" class="headerlink" title="Neat Trick"></a>Neat Trick</h3><p>Letâ€™s say, as befor, that we have four houses, and we want to predict their prices. Ony now, we have three competing hypotheses. We want to apply all three competing hypotheses to all four Xs. It turns out we can do that very efficiently using a matrix-matrix multiplication.</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6k2f8f6tyj30hw09f40y.jpg" alt="image-20190901154936492"></p><h2 id="Matrix-Multiplication-Properties"><a href="#Matrix-Multiplication-Properties" class="headerlink" title="Matrix Multiplication Properties"></a>Matrix Multiplication Properties</h2><h3 id="Non-commutative"><a href="#Non-commutative" class="headerlink" title="Non-commutative"></a>Non-commutative</h3><p>Matrices are not commutative:<br>$$<br>A \times B \neq B \times A<br>$$</p><h3 id="Associative"><a href="#Associative" class="headerlink" title="Associative"></a>Associative</h3><p>Matrices are associative:<br>$$<br>(A \times B) \times C = A \times (B \times C)<br>$$</p><h3 id="Identity-matrix"><a href="#Identity-matrix" class="headerlink" title="Identity matrix"></a>Identity matrix</h3><p><code>Identity matrix</code>: a matrix that simply has <code>1</code>â€˜s on the diagonal (upper left to lower right diagonal) and <code>0</code>â€˜s elsewhere.<br>$$<br>I=\left[\begin{array}{ccc}<br>1 &amp; 0 &amp; 0\<br>0 &amp; 1 &amp; 0\<br>0 &amp; 0 &amp; 1\<br>\end{array}\right]<br>$$<br>The identity matrix, when multiplied by any matrix of the same dimensions, results in the original matrix. Itâ€™s just like multiplying numbers by 1.<br>$$<br>A \times I = I \times A = A<br>$$<br>Notice that when doing <code>A*I</code>, the <code>I</code> should match the matrixâ€™s columns and when doing <code>I*A</code>, the <code>I</code> should match the matrixâ€™s rows:<br>$$<br>A_{m \times n} \times I_{n \times n}=I_{m \times m} \times A_{m \times n} = A_{m \times n}<br>$$</p><h3 id="in-Octave-Matlab-4"><a href="#in-Octave-Matlab-4" class="headerlink" title="in Octave/Matlab"></a>in Octave/Matlab</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">% Initialize random matrices A and B </span><br><span class="line">A &#x3D; [1,2;4,5]</span><br><span class="line">B &#x3D; [1,1;0,2]</span><br><span class="line"></span><br><span class="line">% Initialize a 2 by 2 identity matrix</span><br><span class="line">I &#x3D; eye(2)</span><br><span class="line"></span><br><span class="line">% The above notation is the same as I &#x3D; [1,0;0,1]</span><br><span class="line"></span><br><span class="line">% What happens when we multiply I*A ? </span><br><span class="line">IA &#x3D; I*A </span><br><span class="line"></span><br><span class="line">% How about A*I ? </span><br><span class="line">AI &#x3D; A*I </span><br><span class="line"></span><br><span class="line">% Compute A*B </span><br><span class="line">AB &#x3D; A*B </span><br><span class="line"></span><br><span class="line">% Is it equal to B*A? </span><br><span class="line">BA &#x3D; B*A </span><br><span class="line"></span><br><span class="line">% Note that IA &#x3D; AI but AB !&#x3D; BA</span><br></pre></td></tr></table></figure><p>Output:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">A &#x3D;</span><br><span class="line"></span><br><span class="line">   1   2</span><br><span class="line">   4   5</span><br><span class="line"></span><br><span class="line">B &#x3D;</span><br><span class="line"></span><br><span class="line">   1   1</span><br><span class="line">   0   2</span><br><span class="line"></span><br><span class="line">I &#x3D;</span><br><span class="line"></span><br><span class="line">Diagonal Matrix</span><br><span class="line"></span><br><span class="line">   1   0</span><br><span class="line">   0   1</span><br><span class="line"></span><br><span class="line">IA &#x3D;</span><br><span class="line"></span><br><span class="line">   1   2</span><br><span class="line">   4   5</span><br><span class="line"></span><br><span class="line">AI &#x3D;</span><br><span class="line"></span><br><span class="line">   1   2</span><br><span class="line">   4   5</span><br><span class="line"></span><br><span class="line">AB &#x3D;</span><br><span class="line"></span><br><span class="line">    1    5</span><br><span class="line">    4   14</span><br><span class="line"></span><br><span class="line">BA &#x3D;</span><br><span class="line"></span><br><span class="line">    5    7</span><br><span class="line">    8   10</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Inverse-and-Transpose"><a href="#Inverse-and-Transpose" class="headerlink" title="Inverse and Transpose"></a>Inverse and Transpose</h2><h3 id="Inverse"><a href="#Inverse" class="headerlink" title="Inverse"></a>Inverse</h3><p>The inverse of a matrix $A$ is denoted $A^{-1}$. Multiplying by the inverse results in the identity matrix:<br>$$<br>A_{m \times m} \times A^{-1}<em>{m \times m}=A^{-1}</em>{m \times m} \times A_{m \times m} = I_{m \times m}<br>$$<br>A non square matrix does not have an inverse matrix. We can compute inverses of matrices in octave with the <code>pinv(A)</code> function and in Matlab with the <code>inv(A)</code> function. Matrices that donâ€™t have an inverse are <em>singular</em> or <em>degenerate</em>.</p><p>In practice, when we are using normal equation with Octave, there are two functions to inverse a Matrix â€“ pinv and inv. For some mathematically reason, The <code>pinv(A)</code> will always offer us the value of data that we want, even if A is non-invertible.</p><h3 id="Transpose"><a href="#Transpose" class="headerlink" title="Transpose"></a>Transpose</h3><p>The transposition of a matrix is like rotating the matrix 90Âº in clockwise direction and then reversing it.</p><p>In other words: Let $A$ be an $m \times n$ matrix, and let $B=A^T$. Then  $B$ is an $n \times m$ matrix, and $B_{ij}=A_{ji}$.<br>$$<br>A=<br>\left[\begin{array}{cc}<br>a &amp; b\<br>c &amp; d\<br>e &amp; f\<br>\end{array}\right]<br>\qquad<br>A^T=<br>\left[\begin{array}{ccc}<br>a &amp; c &amp; e\<br>b &amp; d &amp; f\<br>\end{array}\right]<br>$$<br>We can compute transposition of matrices in matlab with the <code>transpose(A)</code> function or <code>A&#39;</code></p><h3 id="in-Octave-Matlab-5"><a href="#in-Octave-Matlab-5" class="headerlink" title="in Octave/Matlab"></a>in Octave/Matlab</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">% Initialize matrix A </span><br><span class="line">A &#x3D; [1,2,0;0,5,6;7,0,9]</span><br><span class="line"></span><br><span class="line">% Transpose A </span><br><span class="line">A_trans &#x3D; A&#39; </span><br><span class="line"></span><br><span class="line">% Take the inverse of A </span><br><span class="line">A_inv &#x3D; inv(A)</span><br><span class="line"></span><br><span class="line">% What is A^(-1)*A? </span><br><span class="line">A_invA &#x3D; inv(A)*A</span><br></pre></td></tr></table></figure><p>Output:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">A &#x3D;</span><br><span class="line"></span><br><span class="line">   1   2   0</span><br><span class="line">   0   5   6</span><br><span class="line">   7   0   9</span><br><span class="line"></span><br><span class="line">A_trans &#x3D;</span><br><span class="line"></span><br><span class="line">   1   0   7</span><br><span class="line">   2   5   0</span><br><span class="line">   0   6   9</span><br><span class="line"></span><br><span class="line">A_inv &#x3D;</span><br><span class="line"></span><br><span class="line">   0.348837  -0.139535   0.093023</span><br><span class="line">   0.325581   0.069767  -0.046512</span><br><span class="line">  -0.271318   0.108527   0.038760</span><br><span class="line"></span><br><span class="line">A_invA &#x3D;</span><br><span class="line"></span><br><span class="line">   1.00000  -0.00000   0.00000</span><br><span class="line">   0.00000   1.00000  -0.00000</span><br><span class="line">  -0.00000   0.00000   1.00000</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> AndrewNg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang-æ›´å¤šç±»å‹ï¼šæŒ‡é’ˆã€structã€sliceå’Œæ˜ å°„</title>
      <link href="/2019/08/31/Golang/go-3-MoreTypes/"/>
      <url>/2019/08/31/Golang/go-3-MoreTypes/</url>
      
        <content type="html"><![CDATA[<h2 id="æ›´å¤šç±»å‹ï¼šæŒ‡é’ˆã€structã€slice-å’Œæ˜ å°„"><a href="#æ›´å¤šç±»å‹ï¼šæŒ‡é’ˆã€structã€slice-å’Œæ˜ å°„" class="headerlink" title="æ›´å¤šç±»å‹ï¼šæŒ‡é’ˆã€structã€slice å’Œæ˜ å°„"></a>æ›´å¤šç±»å‹ï¼šæŒ‡é’ˆã€structã€slice å’Œæ˜ å°„</h2><h3 id="Â§-æŒ‡é’ˆ"><a href="#Â§-æŒ‡é’ˆ" class="headerlink" title="Â§ æŒ‡é’ˆ"></a>Â§ <a href="https://tour.golang.org/moretypes/1">æŒ‡é’ˆ</a></h3><p>Go æ‹¥æœ‰æŒ‡é’ˆã€‚æŒ‡é’ˆä¿å­˜äº†å€¼çš„å†…å­˜åœ°å€ã€‚</p><p>ç±»å‹ <code>*T</code> æ˜¯æŒ‡å‘ <code>T</code> ç±»å‹å€¼çš„æŒ‡é’ˆã€‚å…¶é›¶å€¼ä¸º <code>nil</code>ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p *<span class="keyword">int</span></span><br></pre></td></tr></table></figure><p><code>&amp;</code> æ“ä½œç¬¦ä¼šç”Ÿæˆä¸€ä¸ªæŒ‡å‘å…¶æ“ä½œæ•°çš„æŒ‡é’ˆã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">i := <span class="number">42</span></span><br><span class="line">p = &amp;i</span><br></pre></td></tr></table></figure><p><code>*</code> æ“ä½œç¬¦è¡¨ç¤ºæŒ‡é’ˆæŒ‡å‘çš„åº•å±‚å€¼ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(*p) <span class="comment">// é€šè¿‡æŒ‡é’ˆ p è¯»å– i</span></span><br><span class="line">*p = <span class="number">21</span>         <span class="comment">// é€šè¿‡æŒ‡é’ˆ p è®¾ç½® i</span></span><br></pre></td></tr></table></figure><p>è¿™ä¹Ÿå°±æ˜¯é€šå¸¸æ‰€è¯´çš„â€œé—´æ¥å¼•ç”¨â€æˆ–â€œé‡å®šå‘â€ã€‚</p><p>ä¸ C ä¸åŒï¼ŒGo æ²¡æœ‰æŒ‡é’ˆè¿ç®—ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">i, j := <span class="number">42</span>, <span class="number">2701</span></span><br><span class="line"></span><br><span class="line">p := &amp;i</span><br><span class="line">fmt.Println(p)</span><br><span class="line">fmt.Println(*p)</span><br><span class="line">*p = <span class="number">21</span></span><br><span class="line">fmt.Println(*p)</span><br><span class="line"></span><br><span class="line">p = &amp;j</span><br><span class="line">*p /= <span class="number">37</span></span><br><span class="line">fmt.Println(j)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0xc00008e000</span><br><span class="line">42</span><br><span class="line">21</span><br><span class="line">73</span><br></pre></td></tr></table></figure><h3 id="Â§-ç»“æ„ä½“"><a href="#Â§-ç»“æ„ä½“" class="headerlink" title="Â§ ç»“æ„ä½“"></a>Â§ <a href="https://tour.golang.org/moretypes/2">ç»“æ„ä½“</a></h3><p>ä¸€ä¸ªç»“æ„ä½“ï¼ˆ<code>struct</code>ï¼‰å°±æ˜¯ä¸€ç»„å­—æ®µï¼ˆfieldï¼‰ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">x <span class="keyword">int</span></span><br><span class="line">y <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(Vertex&#123;<span class="number">1</span>, <span class="number">2</span>&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;1 2&#125;</span><br></pre></td></tr></table></figure><h4 id="ç»“æ„ä½“å­—æ®µ"><a href="#ç»“æ„ä½“å­—æ®µ" class="headerlink" title="ç»“æ„ä½“å­—æ®µ"></a><a href="https://tour.golang.org/moretypes/3">ç»“æ„ä½“å­—æ®µ</a></h4><p>ç»“æ„ä½“å­—æ®µä½¿ç”¨ç‚¹å·æ¥è®¿é—®ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">X <span class="keyword">int</span></span><br><span class="line">Y <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">v := Vertex&#123;<span class="number">1</span>, <span class="number">2</span>&#125;</span><br><span class="line">v.X = <span class="number">4</span></span><br><span class="line">fmt.Println(v.X)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4</span><br></pre></td></tr></table></figure><h4 id="ç»“æ„ä½“æŒ‡é’ˆ"><a href="#ç»“æ„ä½“æŒ‡é’ˆ" class="headerlink" title="ç»“æ„ä½“æŒ‡é’ˆ"></a><a href="https://tour.golang.org/moretypes/4">ç»“æ„ä½“æŒ‡é’ˆ</a></h4><p>ç»“æ„ä½“å­—æ®µå¯ä»¥é€šè¿‡ç»“æ„ä½“æŒ‡é’ˆæ¥è®¿é—®ã€‚</p><p>å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªæŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆ pï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ <code>(*p).X</code> æ¥è®¿é—®å…¶å­—æ®µ Xã€‚ä¸è¿‡è¿™ä¹ˆå†™å¤ªå•°å—¦äº†ï¼Œæ‰€ä»¥è¯­è¨€ä¹Ÿå…è®¸æˆ‘ä»¬ä½¿ç”¨éšå¼é—´æ¥å¼•ç”¨ï¼Œç›´æ¥å†™ <code>p.X</code> å°±å¯ä»¥ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">X <span class="keyword">int</span></span><br><span class="line">Y <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">v := Vertex&#123;<span class="number">1</span>, <span class="number">2</span>&#125;</span><br><span class="line">p := &amp;v</span><br><span class="line">p.X = <span class="number">1e9</span></span><br><span class="line">fmt.Println(v)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;1000000000 2&#125;</span><br></pre></td></tr></table></figure><h4 id="ç»“æ„ä½“æ–‡æ³•-Struct-Literals"><a href="#ç»“æ„ä½“æ–‡æ³•-Struct-Literals" class="headerlink" title="ç»“æ„ä½“æ–‡æ³•(Struct Literals)"></a><a href="https://tour.golang.org/moretypes/5">ç»“æ„ä½“æ–‡æ³•(Struct Literals)</a></h4><p>ç»“æ„ä½“æ–‡æ³•é€šè¿‡ç›´æ¥åˆ—å‡ºå­—æ®µçš„å€¼æ¥æ–°åˆ†é…ä¸€ä¸ªç»“æ„ä½“ã€‚</p><p>ä½¿ç”¨ <code>Name:</code> è¯­æ³•å¯ä»¥ä»…åˆ—å‡ºéƒ¨åˆ†å­—æ®µã€‚ï¼ˆå­—æ®µåçš„é¡ºåºæ— å…³ã€‚ï¼‰</p><p>ç‰¹æ®Šçš„å‰ç¼€ <code>&amp;</code> è¿”å›ä¸€ä¸ªæŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">X, Y <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">v1 = Vertex&#123;<span class="number">1</span>, <span class="number">2</span>&#125;</span><br><span class="line">v2 = Vertex&#123;X: <span class="number">1</span>&#125;</span><br><span class="line">v3 = Vertex&#123;&#125;</span><br><span class="line">p0 = &amp;Vertex&#123;Y: <span class="number">1</span>, X: <span class="number">2</span>&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(v1, v2, v3, *p0)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;1 2&#125; &#123;1 0&#125; &#123;0 0&#125; &#123;2 1&#125;</span><br></pre></td></tr></table></figure><h3 id="Â§-æ•°ç»„"><a href="#Â§-æ•°ç»„" class="headerlink" title="Â§ æ•°ç»„"></a>Â§ <a href="https://tour.golang.org/moretypes/6">æ•°ç»„</a></h3><p>ç±»å‹ <code>[n]T</code> è¡¨ç¤ºæ‹¥æœ‰ n ä¸ª T ç±»å‹çš„å€¼çš„æ•°ç»„ã€‚</p><p>è¡¨è¾¾å¼</p><p><code>var a [10]int</code></p><p>ä¼šå°†å˜é‡ a å£°æ˜ä¸ºæ‹¥æœ‰ 10 ä¸ªæ•´æ•°çš„æ•°ç»„ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> a [<span class="number">2</span>]<span class="keyword">string</span></span><br><span class="line">a[<span class="number">0</span>] = <span class="string">&quot;Hello&quot;</span></span><br><span class="line">a[<span class="number">1</span>] = <span class="string">&quot;World&quot;</span></span><br><span class="line">fmt.Println(a[<span class="number">0</span>], a[<span class="number">1</span>])</span><br><span class="line">fmt.Println(a)</span><br><span class="line"></span><br><span class="line">primes := [<span class="number">6</span>]<span class="keyword">int</span>&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>&#125;</span><br><span class="line">fmt.Println(primes)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Hello World</span><br><span class="line">[Hello World]</span><br><span class="line">[2 3 5 7 11 13]</span><br></pre></td></tr></table></figure><p>æ•°ç»„çš„é•¿åº¦æ˜¯å…¶ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤æ•°ç»„ä¸èƒ½æ”¹å˜å¤§å°ã€‚è¿™çœ‹èµ·æ¥æ˜¯ä¸ªé™åˆ¶ï¼Œä¸è¿‡æ²¡å…³ç³»ï¼ŒGo æä¾›äº†æ›´åŠ ä¾¿åˆ©çš„æ–¹å¼æ¥ä½¿ç”¨æ•°ç»„ã€‚</p><h3 id="Â§-åˆ‡ç‰‡"><a href="#Â§-åˆ‡ç‰‡" class="headerlink" title="Â§ åˆ‡ç‰‡"></a>Â§ åˆ‡ç‰‡</h3><p>æ¯ä¸ªæ•°ç»„çš„å¤§å°éƒ½æ˜¯å›ºå®šçš„ã€‚è€Œåˆ‡ç‰‡åˆ™ä¸ºæ•°ç»„å…ƒç´ æä¾›åŠ¨æ€å¤§å°çš„ã€çµæ´»çš„è§†è§’ã€‚åœ¨å®è·µä¸­ï¼Œåˆ‡ç‰‡æ¯”æ•°ç»„æ›´å¸¸ç”¨ã€‚</p><p>ç±»å‹ <code>[]T</code> è¡¨ç¤ºä¸€ä¸ªå…ƒç´ ç±»å‹ä¸º T çš„åˆ‡ç‰‡ã€‚ï¼ˆä¸å†™å…ƒç´ ä¸ªæ•°çš„æ•°ç»„ï¼‰</p><p>åˆ‡ç‰‡é€šè¿‡ä¸¤ä¸ªä¸‹æ ‡æ¥ç•Œå®šï¼Œå³ä¸€ä¸ªä¸Šç•Œå’Œä¸€ä¸ªä¸‹ç•Œï¼ŒäºŒè€…ä»¥å†’å·åˆ†éš”ï¼š</p><p><code>a[low : high]</code></p><p>å®ƒä¼šé€‰æ‹©ä¸€ä¸ªåŠå¼€åŒºé—´ï¼ŒåŒ…æ‹¬ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä½†æ’é™¤æœ€åä¸€ä¸ªå…ƒç´ ã€‚</p><p>ä»¥ä¸‹è¡¨è¾¾å¼åˆ›å»ºäº†ä¸€ä¸ªåˆ‡ç‰‡ï¼Œå®ƒåŒ…å« a ä¸­ä¸‹æ ‡ä» 1 åˆ° 3 çš„å…ƒç´ ï¼š</p><p><code>a[1:4]</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">primes := [<span class="number">6</span>]<span class="keyword">int</span>&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s []<span class="keyword">int</span> = primes[<span class="number">1</span>:<span class="number">4</span>]</span><br><span class="line">fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[3 5 7]</span><br></pre></td></tr></table></figure><h4 id="åˆ‡ç‰‡å°±åƒæ•°ç»„çš„å¼•ç”¨"><a href="#åˆ‡ç‰‡å°±åƒæ•°ç»„çš„å¼•ç”¨" class="headerlink" title="åˆ‡ç‰‡å°±åƒæ•°ç»„çš„å¼•ç”¨"></a><a href="https://tour.golang.org/moretypes/8">åˆ‡ç‰‡å°±åƒæ•°ç»„çš„å¼•ç”¨</a></h4><p>åˆ‡ç‰‡å¹¶ä¸å­˜å‚¨ä»»ä½•æ•°æ®ï¼Œå®ƒåªæ˜¯æè¿°äº†åº•å±‚æ•°ç»„ä¸­çš„ä¸€æ®µã€‚</p><p>æ›´æ”¹åˆ‡ç‰‡çš„å…ƒç´ ä¼šä¿®æ”¹å…¶åº•å±‚æ•°ç»„ä¸­å¯¹åº”çš„å…ƒç´ ã€‚</p><p>ä¸å®ƒå…±äº«åº•å±‚æ•°ç»„çš„åˆ‡ç‰‡éƒ½ä¼šè§‚æµ‹åˆ°è¿™äº›ä¿®æ”¹ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">names := [<span class="number">4</span>]<span class="keyword">string</span>&#123;</span><br><span class="line"><span class="string">&quot;A&quot;</span>,</span><br><span class="line"><span class="string">&quot;B&quot;</span>,</span><br><span class="line"><span class="string">&quot;C&quot;</span>,</span><br><span class="line"><span class="string">&quot;D&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(names)</span><br><span class="line"></span><br><span class="line">a := names[<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line">b := names[<span class="number">1</span>:<span class="number">3</span>]</span><br><span class="line">fmt.Println(a, b)</span><br><span class="line"></span><br><span class="line">b[<span class="number">0</span>] = <span class="string">&quot;XXX&quot;</span></span><br><span class="line">fmt.Println(a, b)</span><br><span class="line">fmt.Println(names)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[A B C D]</span><br><span class="line">[A B] [B C]</span><br><span class="line">[A XXX] [XXX C]</span><br><span class="line">[A XXX C D]</span><br></pre></td></tr></table></figure><h4 id="åˆ‡ç‰‡æ–‡æ³•-Slice-literals"><a href="#åˆ‡ç‰‡æ–‡æ³•-Slice-literals" class="headerlink" title="åˆ‡ç‰‡æ–‡æ³•(Slice literals)"></a><a href="https://tour.golang.org/moretypes/9">åˆ‡ç‰‡æ–‡æ³•(Slice literals)</a></h4><p>åˆ‡ç‰‡æ–‡æ³•ç±»ä¼¼äºæ²¡æœ‰é•¿åº¦çš„æ•°ç»„æ–‡æ³•ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªæ•°ç»„æ–‡æ³•ï¼š</p><p><code>[3]bool&#123;true, true, false&#125;</code></p><p>ä¸‹é¢è¿™æ ·åˆ™ä¼šåˆ›å»ºä¸€ä¸ªå’Œä¸Šé¢ç›¸åŒçš„æ•°ç»„ï¼Œç„¶åæ„å»ºä¸€ä¸ªå¼•ç”¨äº†å®ƒçš„åˆ‡ç‰‡ï¼š</p><p><code>[]bool&#123;true, true, false&#125;</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">q := []<span class="keyword">int</span>&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>&#125;</span><br><span class="line">fmt.Println(q)</span><br><span class="line"></span><br><span class="line">r := []<span class="keyword">bool</span>&#123;<span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">true</span>, <span class="literal">false</span>&#125;</span><br><span class="line">fmt.Println(r)</span><br><span class="line"></span><br><span class="line">s := []<span class="keyword">struct</span> &#123;</span><br><span class="line">i <span class="keyword">int</span></span><br><span class="line">b <span class="keyword">bool</span></span><br><span class="line">&#125;&#123;</span><br><span class="line">&#123;<span class="number">2</span>, <span class="literal">true</span>&#125;,</span><br><span class="line">&#123;<span class="number">3</span>, <span class="literal">false</span>&#125;,</span><br><span class="line">&#123;<span class="number">5</span>, <span class="literal">true</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[2 3 5 7 11 13]</span><br><span class="line">[true false true false]</span><br><span class="line">[&#123;2 true&#125; &#123;3 false&#125; &#123;5 true&#125;]</span><br></pre></td></tr></table></figure><h4 id="åˆ‡ç‰‡çš„é»˜è®¤è¡Œä¸º"><a href="#åˆ‡ç‰‡çš„é»˜è®¤è¡Œä¸º" class="headerlink" title="åˆ‡ç‰‡çš„é»˜è®¤è¡Œä¸º"></a><a href="https://tour.golang.org/moretypes/10">åˆ‡ç‰‡çš„é»˜è®¤è¡Œä¸º</a></h4><p>åœ¨è¿›è¡Œåˆ‡ç‰‡æ—¶ï¼Œä½ å¯ä»¥åˆ©ç”¨å®ƒçš„é»˜è®¤è¡Œä¸ºæ¥å¿½ç•¥ä¸Šä¸‹ç•Œã€‚</p><p>åˆ‡ç‰‡ä¸‹ç•Œçš„é»˜è®¤å€¼ä¸º 0ï¼Œä¸Šç•Œåˆ™æ˜¯è¯¥åˆ‡ç‰‡çš„é•¿åº¦ã€‚</p><p>å¯¹äºæ•°ç»„</p><p><code>var a [10]int</code></p><p>æ¥è¯´ï¼Œä»¥ä¸‹åˆ‡ç‰‡æ˜¯ç­‰ä»·çš„ï¼š</p><p><code>a[0:10]</code></p><p><code>a[:10]</code></p><p><code>a[0:]</code></p><p><code>a[:]</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">s := []<span class="keyword">int</span>&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>&#125;</span><br><span class="line"></span><br><span class="line">s = s[<span class="number">1</span>:<span class="number">4</span>]</span><br><span class="line">fmt.Println(s)</span><br><span class="line"></span><br><span class="line">s = s[:<span class="number">2</span>]</span><br><span class="line">fmt.Println(s)</span><br><span class="line"></span><br><span class="line">s = s[<span class="number">1</span>:]</span><br><span class="line">fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[3 5 7]</span><br><span class="line">[3 5]</span><br><span class="line">[5]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="åˆ‡ç‰‡çš„é•¿åº¦ä¸å®¹é‡"><a href="#åˆ‡ç‰‡çš„é•¿åº¦ä¸å®¹é‡" class="headerlink" title="åˆ‡ç‰‡çš„é•¿åº¦ä¸å®¹é‡"></a><a href="https://tour.golang.org/moretypes/11">åˆ‡ç‰‡çš„é•¿åº¦ä¸å®¹é‡</a></h4><p>åˆ‡ç‰‡æ‹¥æœ‰ <strong>é•¿åº¦</strong> å’Œ <strong>å®¹é‡</strong>ã€‚</p><ul><li><p>åˆ‡ç‰‡çš„ é•¿åº¦ å°±æ˜¯å®ƒæ‰€åŒ…å«çš„å…ƒç´ ä¸ªæ•°ã€‚</p></li><li><p>åˆ‡ç‰‡çš„ å®¹é‡ æ˜¯ä»å®ƒçš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹æ•°ï¼Œåˆ°å…¶åº•å±‚æ•°ç»„å…ƒç´ æœ«å°¾çš„ä¸ªæ•°ã€‚</p></li></ul><p>åˆ‡ç‰‡ <code>s</code> çš„é•¿åº¦å’Œå®¹é‡å¯é€šè¿‡è¡¨è¾¾å¼ <code>len(s)</code> å’Œ <code>cap(s)</code> æ¥è·å–ã€‚</p><p>ä½ å¯ä»¥é€šè¿‡é‡æ–°åˆ‡ç‰‡æ¥æ”¹å˜ä¸€ä¸ªåˆ‡ç‰‡çš„é•¿åº¦(You can extend a sliceâ€™s length by re-slicing it, provided it has sufficient capacity. )ã€‚</p><p>å¦‚æœé•¿åº¦å¼€å¾—è¶…å‡ºäº†å®¹é‡(to extend it beyond its capacity)ï¼Œä¼šæœ‰ runtime errorã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">s := []<span class="keyword">int</span>&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>&#125;</span><br><span class="line">printSlice(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆªå–åˆ‡ç‰‡ä½¿å…¶é•¿åº¦ä¸º 0</span></span><br><span class="line">s = s[:<span class="number">0</span>]</span><br><span class="line">printSlice(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‹“å±•å…¶é•¿åº¦</span></span><br><span class="line">s = s[:<span class="number">4</span>]</span><br><span class="line">printSlice(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">// èˆå¼ƒå‰ä¸¤ä¸ªå€¼</span></span><br><span class="line">s = s[<span class="number">2</span>:]</span><br><span class="line">printSlice(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘å¤–æ‰©å±•å®ƒçš„å®¹é‡</span></span><br><span class="line">s = s[<span class="number">2</span>:<span class="number">10</span>]</span><br><span class="line">printSlice(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printSlice</span><span class="params">(s []<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;len=%d\tcap=%d\t %v\n&quot;</span>, <span class="built_in">len</span>(s), <span class="built_in">cap</span>(s), s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">len&#x3D;6cap&#x3D;6 [2 3 5 7 11 13]</span><br><span class="line">len&#x3D;0cap&#x3D;6 []</span><br><span class="line">len&#x3D;4cap&#x3D;6 [2 3 5 7]</span><br><span class="line">len&#x3D;2cap&#x3D;4 [5 7]</span><br><span class="line">panic: runtime error: slice bounds out of range</span><br><span class="line"></span><br><span class="line">goroutine 1 [running]:</span><br><span class="line">main.main()</span><br><span class="line">&#x2F;Users&#x2F;example&#x2F;go&#x2F;tour&#x2F;slice-len-cap&#x2F;src.go:22 +0x483</span><br><span class="line">exit status 2</span><br></pre></td></tr></table></figure><h4 id="nil-åˆ‡ç‰‡"><a href="#nil-åˆ‡ç‰‡" class="headerlink" title="nil åˆ‡ç‰‡"></a><a href="https://tour.golang.org/moretypes/12">nil åˆ‡ç‰‡</a></h4><p>åˆ‡ç‰‡çš„é›¶å€¼æ˜¯ <code>nil</code>ã€‚</p><p><code>nil</code> åˆ‡ç‰‡çš„é•¿åº¦å’Œå®¹é‡ä¸º <code>0</code> ä¸”æ²¡æœ‰åº•å±‚æ•°ç»„ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> s []<span class="keyword">int</span></span><br><span class="line">fmt.Println(s, <span class="built_in">len</span>(s), <span class="built_in">cap</span>(s))</span><br><span class="line"><span class="keyword">if</span> s == <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;nil!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[] 0 0</span><br><span class="line">nil!</span><br></pre></td></tr></table></figure><h4 id="ç”¨-make-åˆ›å»ºåˆ‡ç‰‡"><a href="#ç”¨-make-åˆ›å»ºåˆ‡ç‰‡" class="headerlink" title="ç”¨ make åˆ›å»ºåˆ‡ç‰‡"></a><a href="https://tour.golang.org/moretypes/13">ç”¨ make åˆ›å»ºåˆ‡ç‰‡</a></h4><p>åˆ‡ç‰‡å¯ä»¥ç”¨å†…å»ºå‡½æ•° <code>make</code> æ¥åˆ›å»ºï¼Œè¿™ä¹Ÿæ˜¯åˆ›å»ºåŠ¨æ€æ•°ç»„çš„æ–¹å¼ã€‚</p><p><code>make</code> å‡½æ•°ä¼šåˆ†é…ä¸€ä¸ªå…ƒç´ ä¸ºé›¶å€¼çš„æ•°ç»„å¹¶è¿”å›ä¸€ä¸ªå¼•ç”¨äº†å®ƒçš„åˆ‡ç‰‡ï¼š</p><p><code>a := make([]int, 5)  // len(a)=5</code></p><p>è¦æŒ‡å®šå®ƒçš„å®¹é‡(cap)ï¼Œéœ€å‘ make ä¼ å…¥ç¬¬ä¸‰ä¸ªå‚æ•°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, <span class="number">5</span>) <span class="comment">// len(b)=0, cap(b)=5</span></span><br><span class="line"></span><br><span class="line">b = b[:<span class="built_in">cap</span>(b)] <span class="comment">// len(b)=5, cap(b)=5</span></span><br><span class="line">b = b[<span class="number">1</span>:]      <span class="comment">// len(b)=4, cap(b)=4</span></span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">a := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">5</span>)</span><br><span class="line">printSlice(<span class="string">&quot;a&quot;</span>, a)</span><br><span class="line"></span><br><span class="line">b := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, <span class="number">5</span>)</span><br><span class="line">printSlice(<span class="string">&quot;b&quot;</span>, b)</span><br><span class="line"></span><br><span class="line">c := b[:<span class="number">2</span>]</span><br><span class="line">printSlice(<span class="string">&quot;c&quot;</span>, c)</span><br><span class="line"></span><br><span class="line">d := c[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">printSlice(<span class="string">&quot;d&quot;</span>, d)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printSlice</span><span class="params">(s <span class="keyword">string</span>, x []<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;%s: len=%d cap=%d %v\n&quot;</span>, s, <span class="built_in">len</span>(x), <span class="built_in">cap</span>(x), x)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a: len&#x3D;5 cap&#x3D;5 [0 0 0 0 0]</span><br><span class="line">b: len&#x3D;0 cap&#x3D;5 []</span><br><span class="line">c: len&#x3D;2 cap&#x3D;5 [0 0]</span><br><span class="line">d: len&#x3D;3 cap&#x3D;3 [0 0 0]</span><br></pre></td></tr></table></figure><h4 id="åˆ‡ç‰‡çš„åˆ‡ç‰‡"><a href="#åˆ‡ç‰‡çš„åˆ‡ç‰‡" class="headerlink" title="åˆ‡ç‰‡çš„åˆ‡ç‰‡"></a><a href="https://tour.golang.org/moretypes/14">åˆ‡ç‰‡çš„åˆ‡ç‰‡</a></h4><p>åˆ‡ç‰‡å¯åŒ…å«ä»»ä½•ç±»å‹ï¼Œç”šè‡³åŒ…æ‹¬å…¶å®ƒçš„åˆ‡ç‰‡ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªäº•å­—æ¿ï¼ˆäº•å­—æ£‹æ¸¸æˆï¼‰</span></span><br><span class="line">board := [][]<span class="keyword">string</span>&#123;</span><br><span class="line">[]<span class="keyword">string</span>&#123;<span class="string">&quot;_&quot;</span>, <span class="string">&quot;_&quot;</span>, <span class="string">&quot;_&quot;</span>&#125;,</span><br><span class="line">[]<span class="keyword">string</span>&#123;<span class="string">&quot;_&quot;</span>, <span class="string">&quot;_&quot;</span>, <span class="string">&quot;_&quot;</span>&#125;,</span><br><span class="line">[]<span class="keyword">string</span>&#123;<span class="string">&quot;_&quot;</span>, <span class="string">&quot;_&quot;</span>, <span class="string">&quot;_&quot;</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸¤ä¸ªç©å®¶è½®æµæ‰“ä¸Š X å’Œ O</span></span><br><span class="line">board[<span class="number">0</span>][<span class="number">0</span>] = <span class="string">&quot;X&quot;</span></span><br><span class="line">board[<span class="number">2</span>][<span class="number">2</span>] = <span class="string">&quot;O&quot;</span></span><br><span class="line">board[<span class="number">1</span>][<span class="number">2</span>] = <span class="string">&quot;X&quot;</span></span><br><span class="line">board[<span class="number">1</span>][<span class="number">0</span>] = <span class="string">&quot;O&quot;</span></span><br><span class="line">board[<span class="number">0</span>][<span class="number">2</span>] = <span class="string">&quot;X&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(board); i++ &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;%s\n&quot;</span>, strings.Join(board[i], <span class="string">&quot;  &quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">X  _  X</span><br><span class="line">O  _  X</span><br><span class="line">_  _  O</span><br></pre></td></tr></table></figure><h4 id="å‘åˆ‡ç‰‡è¿½åŠ å…ƒç´ "><a href="#å‘åˆ‡ç‰‡è¿½åŠ å…ƒç´ " class="headerlink" title="å‘åˆ‡ç‰‡è¿½åŠ å…ƒç´ "></a><a href="https://tour.golang.org/moretypes/15">å‘åˆ‡ç‰‡è¿½åŠ å…ƒç´ </a></h4><p>ä¸ºåˆ‡ç‰‡è¿½åŠ æ–°çš„å…ƒç´ æ˜¯ç§å¸¸ç”¨çš„æ“ä½œï¼Œä¸ºæ­¤ Go æä¾›äº†å†…å»ºçš„ append å‡½æ•°ã€‚å†…å»ºå‡½æ•°çš„<a href="https://golang.org/pkg/builtin/#append">æ–‡æ¡£</a>å¯¹æ­¤å‡½æ•°æœ‰è¯¦ç»†çš„ä»‹ç»ã€‚</p><p><code>func append(s []T, vs ...T) []T</code></p><p><code>append</code> çš„ç¬¬ä¸€ä¸ªå‚æ•° <code>s</code> æ˜¯ä¸€ä¸ªå…ƒç´ ç±»å‹ä¸º <code>T</code> çš„åˆ‡ç‰‡ï¼Œå…¶ä½™ç±»å‹ä¸º <code>T</code> çš„å€¼å°†ä¼šè¿½åŠ åˆ°è¯¥åˆ‡ç‰‡çš„æœ«å°¾ã€‚</p><p><code>append</code> çš„ç»“æœæ˜¯ä¸€ä¸ªåŒ…å«åŸåˆ‡ç‰‡æ‰€æœ‰å…ƒç´ åŠ ä¸Šæ–°æ·»åŠ å…ƒç´ çš„åˆ‡ç‰‡ã€‚</p><p>å½“ <code>s</code> çš„åº•å±‚æ•°ç»„å¤ªå°ï¼Œä¸è¶³ä»¥å®¹çº³æ‰€æœ‰ç»™å®šçš„å€¼æ—¶ï¼Œå®ƒå°±ä¼šåˆ†é…ä¸€ä¸ªæ›´å¤§çš„æ•°ç»„ã€‚è¿”å›çš„åˆ‡ç‰‡ä¼šæŒ‡å‘è¿™ä¸ªæ–°åˆ†é…çš„æ•°ç»„ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> s []<span class="keyword">int</span></span><br><span class="line">printSlice(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†å…ƒç´ æ·»åŠ åˆ°ä¸€ä¸ªç©ºåˆ‡ç‰‡</span></span><br><span class="line">s = <span class="built_in">append</span>(s, <span class="number">0</span>)</span><br><span class="line">printSlice(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™ä¸ªåˆ‡ç‰‡ä¼šæŒ‰éœ€å¢é•¿</span></span><br><span class="line">s = <span class="built_in">append</span>(s, <span class="number">1</span>)</span><br><span class="line">printSlice(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯ä»¥ä¸€æ¬¡æ·»åŠ å¤šä¸ªå…ƒç´ </span></span><br><span class="line">s = <span class="built_in">append</span>(s, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">printSlice(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printSlice</span><span class="params">(s []<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;len=%d cap=%d %v\n&quot;</span>, <span class="built_in">len</span>(s), <span class="built_in">cap</span>(s), s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">len&#x3D;0 cap&#x3D;0 []</span><br><span class="line">len&#x3D;1 cap&#x3D;1 [0]</span><br><span class="line">len&#x3D;2 cap&#x3D;2 [0 1]</span><br><span class="line">len&#x3D;5 cap&#x3D;6 [0 1 2 3 4]</span><br></pre></td></tr></table></figure><p>ï¼ˆè¦äº†è§£å…³äºåˆ‡ç‰‡çš„æ›´å¤šå†…å®¹ï¼Œè¯·é˜…è¯»æ–‡ç«  <a href="https://blog.golang.org/go-slices-usage-and-internals">Go åˆ‡ç‰‡ï¼šç”¨æ³•å’Œæœ¬è´¨</a>ã€‚ï¼‰</p><h3 id="Range"><a href="#Range" class="headerlink" title="Range"></a><a href="https://tour.golang.org/moretypes/16">Range</a></h3><p><code>for</code> å¾ªç¯çš„ <code>range</code> å½¢å¼å¯éå†åˆ‡ç‰‡æˆ–æ˜ å°„ã€‚</p><p>å½“ä½¿ç”¨ <code>for</code> å¾ªç¯éå†åˆ‡ç‰‡æ—¶ï¼Œæ¯æ¬¡è¿­ä»£éƒ½ä¼šè¿”å›ä¸¤ä¸ªå€¼ã€‚ç¬¬ä¸€ä¸ªå€¼ä¸ºå½“å‰å…ƒç´ çš„ä¸‹æ ‡ï¼Œç¬¬äºŒä¸ªå€¼ä¸ºè¯¥ä¸‹æ ‡æ‰€å¯¹åº”å…ƒç´ çš„ä¸€ä»½å‰¯æœ¬ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pow = []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">16</span>, <span class="number">32</span>, <span class="number">64</span>, <span class="number">128</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i, v := <span class="keyword">range</span> pow &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;2**%d = %d\n&quot;</span>, i, v)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">2**0 &#x3D; 1</span><br><span class="line">2**1 &#x3D; 2</span><br><span class="line">2**2 &#x3D; 4</span><br><span class="line">2**3 &#x3D; 8</span><br><span class="line">2**4 &#x3D; 16</span><br><span class="line">2**5 &#x3D; 32</span><br><span class="line">2**6 &#x3D; 64</span><br><span class="line">2**7 &#x3D; 128</span><br></pre></td></tr></table></figure><h4 id="rangeï¼ˆç»­ï¼‰"><a href="#rangeï¼ˆç»­ï¼‰" class="headerlink" title="rangeï¼ˆç»­ï¼‰"></a><a href="https://tour.golang.org/moretypes/17">rangeï¼ˆç»­ï¼‰</a></h4><p>å¯ä»¥å°† ä¸‹æ ‡ æˆ– å€¼ èµ‹äºˆ _ æ¥å¿½ç•¥å®ƒã€‚</p><p><code>for i, _ := range pow</code><br><code>for _, value := range pow</code></p><p>è‹¥ä½ åªéœ€è¦ç´¢å¼•ï¼Œå¿½ç•¥ç¬¬äºŒä¸ªå˜é‡å³å¯:</p><p><code>for i := range pow</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">pow := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line"><span class="keyword">for</span> i := <span class="keyword">range</span> pow &#123;</span><br><span class="line">pow[i] = <span class="number">1</span> &lt;&lt; <span class="keyword">uint</span>(i) <span class="comment">// == 2 ** i</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> _, value := <span class="keyword">range</span> pow &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;%d\n&quot;</span>, value)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">8</span><br><span class="line">16</span><br><span class="line">32</span><br><span class="line">64</span><br><span class="line">128</span><br><span class="line">256</span><br><span class="line">512</span><br></pre></td></tr></table></figure><h3 id="Maps-æ˜ å°„"><a href="#Maps-æ˜ å°„" class="headerlink" title="Maps(æ˜ å°„)"></a><a href="https://tour.golang.org/moretypes/19">Maps(æ˜ å°„)</a></h3><p>æ˜ å°„å°†é”®æ˜ å°„åˆ°å€¼ã€‚</p><p>æ˜ å°„çš„é›¶å€¼ä¸º <code>nil</code> ã€‚</p><p><code>nil</code> æ˜ å°„æ—¢æ²¡æœ‰é”®ï¼Œä¹Ÿä¸èƒ½æ·»åŠ é”®ã€‚</p><p><code>make</code> å‡½æ•°ä¼šè¿”å›ç»™å®šç±»å‹çš„æ˜ å°„ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–å¤‡ç”¨ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">Lat, Long <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> m <span class="keyword">map</span>[<span class="keyword">string</span>]Vertex</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(m)</span><br><span class="line"><span class="comment">// m[&quot;A&quot;] = Vertex&#123;1.2, 3.4&#125;    // ä¸å¯è¿™æ ·ç”¨</span></span><br><span class="line"></span><br><span class="line">m = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]Vertex)</span><br><span class="line">m[<span class="string">&quot;B&quot;</span>] = Vertex&#123;</span><br><span class="line"><span class="number">40.05</span>, <span class="number">-71.0</span>,</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(m[<span class="string">&quot;B&quot;</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">map[]</span><br><span class="line">&#123;40.05 -71&#125;</span><br></pre></td></tr></table></figure><h4 id="æ˜ å°„çš„æ–‡æ³•"><a href="#æ˜ å°„çš„æ–‡æ³•" class="headerlink" title="æ˜ å°„çš„æ–‡æ³•"></a><a href="https://tour.golang.org/moretypes/20">æ˜ å°„çš„æ–‡æ³•</a></h4><p>æ˜ å°„çš„æ–‡æ³•ä¸ç»“æ„ä½“ç›¸ä¼¼ï¼Œä¸è¿‡å¿…é¡»æœ‰é”®åã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">Lat, Long <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> m = <span class="keyword">map</span>[<span class="keyword">string</span>]Vertex&#123;</span><br><span class="line"><span class="string">&quot;B&quot;</span> : Vertex&#123;<span class="number">1</span>, <span class="number">2</span>&#125;,</span><br><span class="line"><span class="string">&quot;C&quot;</span> : Vertex&#123;<span class="number">3</span>, <span class="number">4</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(m)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map[B:&#123;1 2&#125; C:&#123;3 4&#125;]</span><br></pre></td></tr></table></figure><h4 id="æ˜ å°„çš„æ–‡æ³•ï¼ˆç»­ï¼‰"><a href="#æ˜ å°„çš„æ–‡æ³•ï¼ˆç»­ï¼‰" class="headerlink" title="æ˜ å°„çš„æ–‡æ³•ï¼ˆç»­ï¼‰"></a><a href="https://tour.golang.org/moretypes/21">æ˜ å°„çš„æ–‡æ³•ï¼ˆç»­ï¼‰</a></h4><p>è‹¥é¡¶çº§ç±»å‹åªæ˜¯ä¸€ä¸ªç±»å‹åï¼Œä½ å¯ä»¥åœ¨æ–‡æ³•çš„å…ƒç´ ä¸­çœç•¥å®ƒ:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Vertex <span class="keyword">struct</span> &#123;</span><br><span class="line">Lat, Long <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> m = <span class="keyword">map</span>[<span class="keyword">string</span>]Vertex&#123;</span><br><span class="line"><span class="string">&quot;B&quot;</span>: &#123;<span class="number">1</span>, <span class="number">2</span>&#125;,</span><br><span class="line"><span class="string">&quot;C&quot;</span>: &#123;<span class="number">3</span>, <span class="number">4</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(m)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map[B:&#123;1 2&#125; C:&#123;3 4&#125;]</span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹æ˜ å°„"><a href="#ä¿®æ”¹æ˜ å°„" class="headerlink" title="ä¿®æ”¹æ˜ å°„"></a><a href="https://tour.golang.org/moretypes/22">ä¿®æ”¹æ˜ å°„</a></h4><p>åœ¨æ˜ å°„ <code>m</code> ä¸­æ’å…¥æˆ–ä¿®æ”¹å…ƒç´ ï¼š</p><p><code>m[key] = elem</code></p><p>è·å–å…ƒç´ ï¼š</p><p><code>elem = m[key]</code></p><p>åˆ é™¤å…ƒç´ ï¼š</p><p><code>delete(m, key)</code></p><p>é€šè¿‡åŒèµ‹å€¼æ£€æµ‹æŸä¸ªé”®æ˜¯å¦å­˜åœ¨ï¼š</p><p><code>elem, ok = m[key]</code></p><p>è‹¥ <code>key</code> åœ¨ <code>m</code> ä¸­ï¼Œ<code>ok</code> ä¸º <code>true</code> ï¼›å¦åˆ™ï¼Œ<code>ok</code> ä¸º <code>false</code>ã€‚</p><p>è‹¥ <code>key</code> ä¸åœ¨æ˜ å°„ä¸­ï¼Œé‚£ä¹ˆ <code>elem</code> æ˜¯è¯¥æ˜ å°„å…ƒç´ ç±»å‹çš„é›¶å€¼ã€‚</p><p>åŒæ ·çš„ï¼Œå½“ä»æ˜ å°„ä¸­è¯»å–æŸä¸ªä¸å­˜åœ¨çš„é”®æ—¶ï¼Œç»“æœæ˜¯æ˜ å°„çš„å…ƒç´ ç±»å‹çš„é›¶å€¼ã€‚</p><p><strong>æ³¨</strong> ï¼šè‹¥ <code>elem</code> æˆ– <code>ok</code> è¿˜æœªå£°æ˜ï¼Œå¯ä»¥ä½¿ç”¨çŸ­å˜é‡å£°æ˜ï¼š</p><p><code>elem, ok := m[key]</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line">m[<span class="string">&quot;Answer&quot;</span>] = <span class="number">42</span></span><br><span class="line">fmt.Println(<span class="string">&quot;The value:&quot;</span>, m[<span class="string">&quot;Answer&quot;</span>])</span><br><span class="line"></span><br><span class="line">m[<span class="string">&quot;Answer&quot;</span>] = <span class="number">48</span></span><br><span class="line">fmt.Println(<span class="string">&quot;The value:&quot;</span>, m[<span class="string">&quot;Answer&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">delete</span>(m, <span class="string">&quot;Answer&quot;</span>)</span><br><span class="line">fmt.Println(<span class="string">&quot;The value:&quot;</span>, m[<span class="string">&quot;Answer&quot;</span>])</span><br><span class="line"></span><br><span class="line">v, ok := m[<span class="string">&quot;Answer&quot;</span>]</span><br><span class="line">fmt.Println(<span class="string">&quot;The value:&quot;</span>, v, <span class="string">&quot;Present?&quot;</span>, ok)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">The value: 42</span><br><span class="line">The value: 48</span><br><span class="line">The value: 0</span><br><span class="line">The value: 0 Present? false</span><br></pre></td></tr></table></figure><h3 id="å‡½æ•°å€¼"><a href="#å‡½æ•°å€¼" class="headerlink" title="å‡½æ•°å€¼"></a><a href="https://tour.golang.org/moretypes/24">å‡½æ•°å€¼</a></h3><p>å‡½æ•°ä¹Ÿæ˜¯å€¼ã€‚å®ƒä»¬å¯ä»¥åƒå…¶å®ƒå€¼ä¸€æ ·ä¼ é€’ã€‚</p><p>å‡½æ•°å€¼å¯ä»¥ç”¨ä½œå‡½æ•°çš„å‚æ•°æˆ–è¿”å›å€¼ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">compute</span><span class="params">(fn <span class="keyword">func</span>(<span class="keyword">float64</span>, <span class="keyword">float64</span>)</span> <span class="title">float64</span>) <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> fn(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">hypot := <span class="function"><span class="keyword">func</span><span class="params">(x, y <span class="keyword">float64</span>)</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> math.Sqrt(x*x + y*y)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(hypot(<span class="number">5</span>, <span class="number">12</span>))</span><br><span class="line"></span><br><span class="line">fmt.Println(compute(hypot))</span><br><span class="line">fmt.Println(compute(math.Pow))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">13</span><br><span class="line">5</span><br><span class="line">81</span><br></pre></td></tr></table></figure><h3 id="å‡½æ•°çš„é—­åŒ…"><a href="#å‡½æ•°çš„é—­åŒ…" class="headerlink" title="å‡½æ•°çš„é—­åŒ…"></a><a href="https://tour.golang.org/moretypes/25">å‡½æ•°çš„é—­åŒ…</a></h3><p>Go å‡½æ•°å¯ä»¥æ˜¯ä¸€ä¸ªé—­åŒ…ã€‚é—­åŒ…æ˜¯ä¸€ä¸ªå‡½æ•°å€¼ï¼Œå®ƒå¼•ç”¨äº†å…¶å‡½æ•°ä½“ä¹‹å¤–çš„å˜é‡ã€‚è¯¥å‡½æ•°å¯ä»¥è®¿é—®å¹¶èµ‹äºˆå…¶å¼•ç”¨çš„å˜é‡çš„å€¼ï¼Œæ¢å¥è¯è¯´ï¼Œè¯¥å‡½æ•°è¢«è¿™äº›å˜é‡â€œç»‘å®šâ€åœ¨ä¸€èµ·ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">adder</span><span class="params">()</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">sum := <span class="number">0</span></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">sum += x</span><br><span class="line"><span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">pos, neg := adder(), adder()</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">fmt.Println(</span><br><span class="line">pos(i),</span><br><span class="line">neg(<span class="number">-2</span>*i),</span><br><span class="line">)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">0 0</span><br><span class="line">1 -2</span><br><span class="line">3 -6</span><br><span class="line">6 -12</span><br><span class="line">10 -20</span><br><span class="line">15 -30</span><br><span class="line">21 -42</span><br><span class="line">28 -56</span><br><span class="line">36 -72</span><br><span class="line">45 -90</span><br></pre></td></tr></table></figure><p>ğŸ‘†å‡½æ•° <code>adder</code> è¿”å›ä¸€ä¸ªé—­åŒ…ã€‚æ¯ä¸ªé—­åŒ…éƒ½è¢«ç»‘å®šåœ¨å…¶å„è‡ªçš„ <code>sum</code> å˜é‡ä¸Šã€‚</p><p>å®ä¾‹ï¼š<a href="https://tour.golang.org/moretypes/26"><em>æ–æ³¢çº³å¥‘é—­åŒ…</em></a></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// fibonacci is a function that returns</span></span><br><span class="line"><span class="comment">// a function that returns an int.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fibonacci</span><span class="params">()</span> <span class="title">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">i, j := <span class="number">0</span>, <span class="number">1</span></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">i, j = j, i + j</span><br><span class="line"><span class="keyword">return</span> i</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">f := fibonacci()</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">fmt.Println(f())</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">5</span><br><span class="line">...</span><br></pre></td></tr></table></figure><hr>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang-æµç¨‹æ§åˆ¶è¯­å¥ï¼šforã€ifã€elseã€switch å’Œ defer</title>
      <link href="/2019/08/31/Golang/go-2-ControlStatements/"/>
      <url>/2019/08/31/Golang/go-2-ControlStatements/</url>
      
        <content type="html"><![CDATA[<h2 id="æµç¨‹æ§åˆ¶è¯­å¥ï¼šforã€ifã€elseã€switch-å’Œ-defer"><a href="#æµç¨‹æ§åˆ¶è¯­å¥ï¼šforã€ifã€elseã€switch-å’Œ-defer" class="headerlink" title="æµç¨‹æ§åˆ¶è¯­å¥ï¼šforã€ifã€elseã€switch å’Œ defer"></a>æµç¨‹æ§åˆ¶è¯­å¥ï¼šforã€ifã€elseã€switch å’Œ defer</h2><h3 id="Â§-for"><a href="#Â§-for" class="headerlink" title="Â§ for"></a>Â§ <a href="https://tour.golang.org/flowcontrol/1">for</a></h3><p>Go åªæœ‰ä¸€ç§å¾ªç¯ç»“æ„ï¼š<code>for</code> å¾ªç¯ã€‚</p><p>åŸºæœ¬çš„ <code>for</code> å¾ªç¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œå®ƒä»¬ç”¨åˆ†å·éš”å¼€ï¼š</p><ul><li>åˆå§‹åŒ–è¯­å¥ï¼šåœ¨ç¬¬ä¸€æ¬¡è¿­ä»£å‰æ‰§è¡Œ</li><li>æ¡ä»¶è¡¨è¾¾å¼ï¼Œåˆ™å‰åçš„<code>;</code>ä¼šè¢«å»æ‰ï¼Œè‹¥æœ‰ï¼šåœ¨æ¯æ¬¡è¿­ä»£å‰æ±‚å€¼</li><li>åç½®è¯­å¥ï¼šåœ¨æ¯æ¬¡è¿­ä»£çš„ç»“å°¾æ‰§è¡Œ</li></ul><p>åˆå§‹åŒ–è¯­å¥é€šå¸¸ä¸ºä¸€å¥çŸ­å˜é‡å£°æ˜ï¼Œè¯¥å˜é‡å£°æ˜ä»…åœ¨ <code>for</code> è¯­å¥çš„ä½œç”¨åŸŸä¸­å¯è§ã€‚</p><p>ä¸€æ—¦æ¡ä»¶è¡¨è¾¾å¼çš„å¸ƒå°”å€¼ä¸º <code>false</code>ï¼Œå¾ªç¯è¿­ä»£å°±ä¼šç»ˆæ­¢ã€‚</p><p>æ³¨æ„ï¼šå’Œ Cã€Javaã€JavaScript ä¹‹ç±»çš„è¯­è¨€ä¸åŒï¼ŒGo çš„ for è¯­å¥åé¢çš„ä¸‰ä¸ªæ„æˆéƒ¨åˆ†å¤–æ²¡æœ‰å°æ‹¬å· <code>( )</code>ï¼Œ è€Œå¤§æ‹¬å· <code>&#123; &#125;</code> åˆ™æ˜¯å¿…é¡»çš„ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">sum := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">sum += i</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(sum)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">45</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–è¯­å¥å’Œåç½®è¯­å¥æ˜¯å¯é€‰çš„ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">i := <span class="number">0</span></span><br><span class="line">j := <span class="number">100</span></span><br><span class="line">c := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i != j &#123;    <span class="comment">// for ;i != j; &#123; è‡ªåŠ¨æ ¼å¼åŒ–åçš„ç»“æœï¼Œgo ä¸­çš„&quot;while&quot;</span></span><br><span class="line">i++</span><br><span class="line">j--</span><br><span class="line">c += <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">&quot;i: %v, j: %v, c: %v\n&quot;</span>, i, j, c)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i: 50, j: 50, c: 50</span><br></pre></td></tr></table></figure><p>å¦‚æœåªæœ‰æ¡ä»¶è¡¨è¾¾å¼ï¼Œåˆ™å‰åçš„ <code>;</code> ä¼šè¢« <code>go fmt</code> å»æ‰ï¼Œæˆä¸º go ä¸­çš„â€whileâ€ã€‚è‹¥æœ‰åˆå§‹åŒ–è¯­å¥ã€æ¡ä»¶è¡¨è¾¾å¼ã€åç½®è¯­å¥ä¸­çš„ä¸¤ä¸ªï¼Œåˆ™ä¸ä¼šè¢«çœç•¥ã€‚</p><h4 id="for-ä¹Ÿæ˜¯-go-çš„-â€œwhileâ€"><a href="#for-ä¹Ÿæ˜¯-go-çš„-â€œwhileâ€" class="headerlink" title="for ä¹Ÿæ˜¯ go çš„ â€œwhileâ€"></a><a href="https://tour.golang.org/flowcontrol/3">for ä¹Ÿæ˜¯ go çš„ â€œwhileâ€</a></h4><p>å¯ä»¥å»æ‰åˆ†å·ï¼Œåœ¨ <code>for</code>  ä¸ <code>&#123;</code> åªå†™æ¡ä»¶è¯­å¥ã€‚<br>C çš„ while åœ¨ Go ä¸­ä¹Ÿå«åš <code>for</code>ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">s := <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> s &lt;= <span class="number">1000</span> &#123;</span><br><span class="line">s += s</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1024</span><br></pre></td></tr></table></figure><h4 id="æ— é™å¾ªç¯"><a href="#æ— é™å¾ªç¯" class="headerlink" title="æ— é™å¾ªç¯"></a><a href="https://tour.golang.org/flowcontrol/4">æ— é™å¾ªç¯</a></h4><p>å¦‚æœçœç•¥å¾ªç¯æ¡ä»¶ï¼Œ<code>for</code> ä¸ <code>&#123;</code> é—´ä»€ä¹ˆéƒ½ä¸å†™ï¼Œè¯¥å¾ªç¯å°±ä¸ä¼šç»“æŸï¼Œå› æ­¤æ— é™å¾ªç¯å¯ä»¥å†™å¾—å¾ˆç´§å‡‘ã€‚<br>ï¼ˆæ²¡æœ‰æ¡ä»¶çš„ for åŒ for true ä¸€æ ·ã€‚ï¼‰</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">i := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">fmt.Println(i)</span><br><span class="line">i++</span><br><span class="line">time.Sleep(<span class="number">100</span> * time.Millisecond)  <span class="comment">// æš‚åœ100æ¯«ç±³</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">...     &#x2F;&#x2F; çœå»éƒ¨åˆ†è¾“å‡º</span><br><span class="line">^Csignal: interrupt     &#x2F;&#x2F; é”®å…¥äº† control+Cï¼Œä»¥ç»ˆæ­¢ç¨‹åº</span><br></pre></td></tr></table></figure><h3 id="Â§-if"><a href="#Â§-if" class="headerlink" title="Â§ if"></a>Â§ <a href="https://tour.golang.org/flowcontrol/5">if</a></h3><p>Go çš„ if è¯­å¥ä¸ for å¾ªç¯ç±»ä¼¼ï¼Œè¡¨è¾¾å¼å¤–æ— éœ€å°æ‹¬å· <code>( )</code> ï¼Œè€Œå¤§æ‹¬å· <code>&#123; &#125;</code> åˆ™æ˜¯å¿…é¡»çš„ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sqrt</span><span class="params">(x <span class="keyword">float64</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> x &lt; <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> sqrt(-x) + <span class="string">&quot;i&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> fmt.Sprint(math.Sqrt(x))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(sqrt(<span class="number">2</span>), sqrt(<span class="number">-4</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.4142135623730951 2i</span><br></pre></td></tr></table></figure><h4 id="if-çš„ç®€çŸ­è¯­å¥"><a href="#if-çš„ç®€çŸ­è¯­å¥" class="headerlink" title="if çš„ç®€çŸ­è¯­å¥"></a><a href="https://tour.golang.org/flowcontrol/6">if çš„ç®€çŸ­è¯­å¥</a></h4><p>åŒ <code>for</code> ä¸€æ ·ï¼Œ <code>if</code> è¯­å¥å¯ä»¥åœ¨æ¡ä»¶è¡¨è¾¾å¼å‰æ‰§è¡Œä¸€ä¸ªç®€å•çš„è¯­å¥ã€‚</p><p>è¯¥è¯­å¥å£°æ˜çš„å˜é‡ä½œç”¨åŸŸä»…åœ¨ <code>if</code> ä¹‹å†…ã€‚</p><p>ï¼ˆåœ¨æœ€åçš„ <code>return</code> è¯­å¥å¤„ä½¿ç”¨ <code>v</code> çœ‹çœ‹ã€‚ï¼‰</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pow</span><span class="params">(x, n, lim <span class="keyword">float64</span>)</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> v := math.Pow(x, n); v &lt; lim &#123;</span><br><span class="line"><span class="keyword">return</span> v</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> lim</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(</span><br><span class="line">pow(<span class="number">3</span>, <span class="number">2</span>, <span class="number">10</span>),</span><br><span class="line">pow(<span class="number">3</span>, <span class="number">3</span>, <span class="number">20</span>),</span><br><span class="line">)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">9 20</span><br></pre></td></tr></table></figure><h4 id="if-else"><a href="#if-else" class="headerlink" title="if-else"></a><a href="https://tour.golang.org/flowcontrol/7">if-else</a></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pow</span><span class="params">(x, n, lim <span class="keyword">float64</span>)</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> v := math.Pow(x, n); v &lt; lim &#123;</span><br><span class="line"><span class="keyword">return</span> v</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;%g &gt;= %g\n&quot;</span>, v, lim)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿™é‡Œå¼€å§‹å°±ä¸èƒ½ä½¿ç”¨ v äº†</span></span><br><span class="line"><span class="keyword">return</span> lim</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(</span><br><span class="line">pow(<span class="number">3</span>, <span class="number">2</span>, <span class="number">10</span>),</span><br><span class="line">pow(<span class="number">3</span>, <span class="number">3</span>, <span class="number">20</span>),</span><br><span class="line">)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">27 &gt;&#x3D; 20</span><br><span class="line">9 20</span><br></pre></td></tr></table></figure><p>åœ¨ <code>if</code> çš„ç®€çŸ­è¯­å¥ä¸­å£°æ˜çš„å˜é‡åŒæ ·å¯ä»¥åœ¨ä»»ä½•å¯¹åº”çš„ <code>else</code> å—ä¸­ä½¿ç”¨ã€‚</p><p>ï¼ˆåœ¨ <code>main</code> çš„ <code>fmt.Println</code> è°ƒç”¨å¼€å§‹å‰ï¼Œä¸¤æ¬¡å¯¹ <code>pow</code> çš„è°ƒç”¨å‡å·²æ‰§è¡Œå¹¶è¿”å›å…¶å„è‡ªçš„ç»“æœã€‚ï¼‰</p><h3 id="Â§-switch"><a href="#Â§-switch" class="headerlink" title="Â§ switch"></a>Â§ <a href="https://tour.golang.org/flowcontrol/9">switch</a></h3><p><code>switch</code> æ˜¯ç¼–å†™ä¸€è¿ä¸² <code>if - else</code> è¯­å¥çš„ç®€ä¾¿æ–¹æ³•ã€‚å®ƒè¿è¡Œç¬¬ä¸€ä¸ªå€¼ç­‰äºæ¡ä»¶è¡¨è¾¾å¼çš„ case è¯­å¥ã€‚</p><p>Go çš„ <code>switch</code> è¯­å¥ç±»ä¼¼äº Cã€C++ã€Javaã€JavaScript å’Œ PHP ä¸­çš„ï¼Œä¸è¿‡ Go åªè¿è¡Œé€‰å®šçš„ <code>case</code>ï¼Œè€Œéä¹‹åæ‰€æœ‰çš„ <code>case</code>ã€‚ å®é™…ä¸Šï¼ŒGo è‡ªåŠ¨æä¾›äº†åœ¨è¿™äº›è¯­è¨€ä¸­æ¯ä¸ª <code>case</code> åé¢æ‰€éœ€çš„ <code>break</code> è¯­å¥ã€‚ é™¤éä»¥ <code>fallthrough</code> è¯­å¥ç»“æŸï¼Œå¦åˆ™åˆ†æ”¯ä¼šè‡ªåŠ¨ç»ˆæ­¢ã€‚ Go çš„å¦ä¸€ç‚¹é‡è¦çš„ä¸åŒåœ¨äº <code>switch</code> çš„ <code>case</code> æ— éœ€ä¸ºå¸¸é‡ï¼Œä¸”å–å€¼ä¸å¿…ä¸ºæ•´æ•°ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;runtime&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Print(<span class="string">&quot;Go runs on &quot;</span>)</span><br><span class="line"><span class="keyword">switch</span> os := runtime.GOOS; os &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;darwin&quot;</span>:</span><br><span class="line">fmt.Println(<span class="string">&quot;OS X.&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;linux&quot;</span>:</span><br><span class="line">fmt.Println(<span class="string">&quot;Linux.&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="comment">// freebsd, openbsd,</span></span><br><span class="line"><span class="comment">// plan9, windows...</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%s.\n&quot;</span>, os)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Go runs on OS X.</span><br></pre></td></tr></table></figure><h4 id="switch-çš„æ±‚å€¼é¡ºåº"><a href="#switch-çš„æ±‚å€¼é¡ºåº" class="headerlink" title="switch çš„æ±‚å€¼é¡ºåº"></a><a href="https://tour.golang.org/flowcontrol/10">switch çš„æ±‚å€¼é¡ºåº</a></h4><p><code>switch</code> çš„ <code>case</code> è¯­å¥ä»ä¸Šåˆ°ä¸‹é¡ºæ¬¡æ‰§è¡Œï¼Œç›´åˆ°åŒ¹é…æˆåŠŸæ—¶åœæ­¢ã€‚</p><p>ï¼ˆä¾‹å¦‚ï¼Œ</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> i &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line"><span class="keyword">case</span> f():</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ i==0 æ—¶ f ä¸ä¼šè¢«è°ƒç”¨ã€‚ï¼‰</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;When&#x27;s Saturday?&quot;</span>)</span><br><span class="line">today := time.Now().Weekday()</span><br><span class="line"><span class="keyword">switch</span> time.Saturday &#123;</span><br><span class="line"><span class="keyword">case</span> today + <span class="number">0</span>:</span><br><span class="line">fmt.Println(<span class="string">&quot;Today.&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> today + <span class="number">1</span>:</span><br><span class="line">fmt.Println(<span class="string">&quot;Tomorrow.&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> today + <span class="number">2</span>:</span><br><span class="line">fmt.Println(<span class="string">&quot;In two days.&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">fmt.Println(<span class="string">&quot;Too far away.&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">When&#39;s Saturday?</span><br><span class="line">Tomorrow.</span><br></pre></td></tr></table></figure><h4 id="æ²¡æœ‰æ¡ä»¶çš„-switch"><a href="#æ²¡æœ‰æ¡ä»¶çš„-switch" class="headerlink" title="æ²¡æœ‰æ¡ä»¶çš„ switch"></a><a href="https://tour.golang.org/flowcontrol/11">æ²¡æœ‰æ¡ä»¶çš„ switch</a></h4><p>æ²¡æœ‰æ¡ä»¶çš„ <code>switch</code> åŒ <code>switch true</code> ä¸€æ ·ã€‚</p><p>è¿™ç§å½¢å¼èƒ½å°†ä¸€é•¿ä¸² <code>if-then-else</code> å†™å¾—æ›´åŠ æ¸…æ™°ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">t := time.Now()</span><br><span class="line"><span class="keyword">switch</span> &#123;</span><br><span class="line"><span class="keyword">case</span> t.Hour() &lt; <span class="number">12</span>:</span><br><span class="line">fmt.Println(<span class="string">&quot;Good morning!&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> t.Hour() &lt; <span class="number">17</span>:</span><br><span class="line">fmt.Println(<span class="string">&quot;Good afternoon.&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">fmt.Println(<span class="string">&quot;Good evening.&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Good evening.</span><br></pre></td></tr></table></figure><h3 id="Â§-defer"><a href="#Â§-defer" class="headerlink" title="Â§ defer"></a>Â§ <a href="https://tour.golang.org/flowcontrol/12">defer</a></h3><p><code>defer</code> è¯­å¥ä¼šå°†å‡½æ•°æ¨è¿Ÿåˆ°å¤–å±‚å‡½æ•°è¿”å›ä¹‹åæ‰§è¡Œã€‚</p><p>æ¨è¿Ÿè°ƒç”¨çš„å‡½æ•°å…¶å‚æ•°ä¼šç«‹å³æ±‚å€¼ï¼ˆé—­åŒ…?ğŸ¤”ï¸ï¼‰ï¼Œä½†ç›´åˆ°å¤–å±‚å‡½æ•°è¿”å›å‰è¯¥å‡½æ•°éƒ½ä¸ä¼šè¢«è°ƒç”¨ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> fmt.Println(<span class="string">&quot;world&quot;</span>)</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hello</span><br><span class="line">world</span><br></pre></td></tr></table></figure><h4 id="defer-æ ˆ"><a href="#defer-æ ˆ" class="headerlink" title="defer æ ˆ"></a><a href="https://tour.golang.org/flowcontrol/13">defer æ ˆ</a></h4><p>æ¨è¿Ÿçš„å‡½æ•°è°ƒç”¨ä¼šè¢«å‹å…¥ä¸€ä¸ªæ ˆä¸­ã€‚å½“å¤–å±‚å‡½æ•°è¿”å›æ—¶ï¼Œè¢«æ¨è¿Ÿçš„å‡½æ•°ä¼šæŒ‰ç…§<strong>åè¿›å…ˆå‡º</strong>çš„é¡ºåºè°ƒç”¨ã€‚</p><p>æ›´å¤šå…³äº <code>defer</code> è¯­å¥çš„ä¿¡æ¯ï¼Œ<a href="https://blog.golang.org/defer-panic-and-recover">å‚è€ƒé˜…è¯»æ­¤æ–‡</a>ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;counting...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line"><span class="keyword">defer</span> fmt.Println(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;done.&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">counting...</span><br><span class="line">done.</span><br><span class="line">9</span><br><span class="line">8</span><br><span class="line">7</span><br><span class="line">6</span><br><span class="line">5</span><br><span class="line">4</span><br><span class="line">3</span><br><span class="line">2</span><br><span class="line">1</span><br><span class="line">0</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang-åŒ…ã€å˜é‡å’Œå‡½æ•°</title>
      <link href="/2019/08/31/Golang/go-1-PackageVarFunc/"/>
      <url>/2019/08/31/Golang/go-1-PackageVarFunc/</url>
      
        <content type="html"><![CDATA[<h2 id="åŒ…ã€å˜é‡å’Œå‡½æ•°"><a href="#åŒ…ã€å˜é‡å’Œå‡½æ•°" class="headerlink" title="åŒ…ã€å˜é‡å’Œå‡½æ•°"></a>åŒ…ã€å˜é‡å’Œå‡½æ•°</h2><h3 id="Â§-åŒ…"><a href="#Â§-åŒ…" class="headerlink" title="Â§ åŒ…"></a>Â§ <a href="https://tour.golang.org/basics/1">åŒ…</a></h3><p>æ¯ä¸ª Go ç¨‹åºéƒ½æ˜¯ç”±åŒ…æ„æˆçš„ã€‚</p><p>ä¸€èˆ¬ç¨‹åºä» <code>main</code> åŒ…çš„ <code>main</code> å‡½æ•°å¼€å§‹è¿è¡Œï¼Œé™¤éæœ‰ <code>init</code> å‡½æ•°ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math/rand&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;This is a rand int:&quot;</span>, rand.Intn(<span class="number">10</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This is a rand int: 1</span><br></pre></td></tr></table></figure><p>æœ¬ç¨‹åºé€šè¿‡å¯¼å…¥è·¯å¾„ <code>&quot;fmt&quot;</code> å’Œ <code>&quot;math/rand&quot;</code> æ¥ä½¿ç”¨è¿™ä¸¤ä¸ªåŒ…ã€‚</p><p>æŒ‰ç…§çº¦å®šï¼ŒåŒ…åä¸å¯¼å…¥è·¯å¾„çš„æœ€åä¸€ä¸ªå…ƒç´ ä¸€è‡´ã€‚ä¾‹å¦‚ï¼Œ<code>&quot;math/rand&quot;</code> åŒ…ä¸­çš„æºç å‡ä»¥ <code>package rand</code> è¯­å¥å¼€å§‹ã€‚</p><p><em>æ³¨æ„ï¼š</em> è‹¥æ­¤ç¨‹åºçš„è¿è¡Œç¯å¢ƒæ˜¯å›ºå®šçš„ï¼Œ<code>rand.Intn</code> å°†æ€»æ˜¯ä¼šè¿”å›ç›¸åŒçš„æ•°å­—ã€‚</p><p>ï¼ˆè¦å¾—åˆ°ä¸åŒçš„æ•°å­—ï¼Œéœ€ä¸ºç”Ÿæˆå™¨æä¾›ä¸åŒçš„ç§å­æ•°ï¼ˆä½¿ç”¨ <a href="https://golang.org/pkg/math/rand/#Seed"><code>rand.Seed</code></a>ï¼‰ã€‚ å¸¸ç”¨æ—¶é—´çš„å€¼ä½œä¸ºç§å­æ•°ã€‚ï¼‰</p><h4 id="å¯¼å…¥"><a href="#å¯¼å…¥" class="headerlink" title="å¯¼å…¥"></a><a href="https://tour.golang.org/basics/2">å¯¼å…¥</a></h4><p>æ­£å¦‚æˆ‘ä»¬åœ¨ä¹‹å‰çš„ä»£ç ä¸­çœ‹è§çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>import</code> è¯­å¥æ¥å¯¼å…¥åŒ…ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;8&#x27;s sqrt is %g.\n&quot;</span>, math.Sqrt(<span class="number">8</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This is a rand int: 1</span><br></pre></td></tr></table></figure><p>æ­¤ä»£ç ç”¨åœ†æ‹¬å·ç»„åˆäº†å¯¼å…¥ï¼Œè¿™æ˜¯â€œåˆ†ç»„â€å½¢å¼çš„å¯¼å…¥è¯­å¥ã€‚</p><p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç¼–å†™å¤šä¸ªå¯¼å…¥è¯­å¥ï¼Œä¾‹å¦‚ï¼š</p><p><code>import &quot;fmt&quot;</code><br><code>import &quot;math&quot;</code></p><p>ä¸è¿‡ä½¿ç”¨åˆ†ç»„å¯¼å…¥è¯­å¥æ˜¯æ›´å¥½çš„å½¢å¼ã€‚</p><h4 id="å¯¼å‡ºå"><a href="#å¯¼å‡ºå" class="headerlink" title="å¯¼å‡ºå"></a><a href="https://tour.golang.org/basics/3">å¯¼å‡ºå</a></h4><p>åœ¨ Go ä¸­ï¼Œå¦‚æœä¸€ä¸ªåå­—ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯å·²å¯¼å‡ºçš„ã€‚ä¾‹å¦‚ï¼Œ<code>Pizza</code> å°±æ˜¯ä¸ªå·²å¯¼å‡ºåï¼Œ<code>Pi</code> ä¹ŸåŒæ ·ï¼Œå®ƒå¯¼å‡ºè‡ª <code>math</code> åŒ…ã€‚</p><p>pizza å’Œ pi å¹¶æœªä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œæ‰€ä»¥å®ƒä»¬æ˜¯æœªå¯¼å‡ºçš„ã€‚</p><p>åœ¨å¯¼å…¥ä¸€ä¸ªåŒ…æ—¶ï¼Œä½ åªèƒ½å¼•ç”¨å…¶ä¸­å·²å¯¼å‡ºçš„åå­—ã€‚ä»»ä½•â€œæœªå¯¼å‡ºâ€çš„åå­—åœ¨è¯¥åŒ…å¤–å‡æ— æ³•è®¿é—®ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(math.pi)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä»£ç ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°é”™è¯¯è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># command-line-arguments</span><br><span class="line">.&#x2F;src.go:9:14: cannot refer to unexported name math.pi</span><br><span class="line">.&#x2F;src.go:9:14: undefined: math.pi</span><br></pre></td></tr></table></figure><p>ç„¶åå°† <code>math.pi</code> æ”¹åä¸º <code>math.Pi</code> å†è¯•ç€æ‰§è¡Œä¸€æ¬¡ï¼Œå°±å¯ä»¥å¾—åˆ°é¢„æƒ³çš„è¾“å‡ºäº†ï¼š</p><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3.141592653589793</span><br></pre></td></tr></table></figure><h3 id="Â§-å‡½æ•°"><a href="#Â§-å‡½æ•°" class="headerlink" title="Â§ å‡½æ•°"></a>Â§ <a href="https://tour.golang.org/basics/4">å‡½æ•°</a></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(x <span class="keyword">int</span>, y <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(add(<span class="number">12</span>, <span class="number">13</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">25</span><br></pre></td></tr></table></figure><p>å‡½æ•°å¯ä»¥æ²¡æœ‰å‚æ•°æˆ–æ¥å—å¤šä¸ªå‚æ•°ã€‚</p><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ<code>add</code> æ¥å—ä¸¤ä¸ª <code>int</code> ç±»å‹çš„å‚æ•°ã€‚</p><p>æ³¨æ„ç±»å‹åœ¨å˜é‡å<strong>ä¹‹å</strong>ã€‚</p><p>ï¼ˆå‚è€ƒ <a href="http://blog.golang.org/gos-declaration-syntax">è¿™ç¯‡å…³äº Go è¯­æ³•å£°æ˜çš„æ–‡ç« </a> äº†è§£è¿™ç§ç±»å‹å£°æ˜å½¢å¼å‡ºç°çš„åŸå› ã€‚ï¼‰</p><h4 id="å‡½æ•°ï¼ˆç»­ï¼‰"><a href="#å‡½æ•°ï¼ˆç»­ï¼‰" class="headerlink" title="å‡½æ•°ï¼ˆç»­ï¼‰"></a><a href="https://tour.golang.org/basics/5">å‡½æ•°ï¼ˆç»­ï¼‰</a></h4><p>å½“è¿ç»­ä¸¤ä¸ªæˆ–å¤šä¸ªå‡½æ•°çš„å·²å‘½åå½¢å‚ç±»å‹ç›¸åŒæ—¶ï¼Œé™¤æœ€åä¸€ä¸ªç±»å‹ä»¥å¤–ï¼Œå…¶å®ƒéƒ½å¯ä»¥çœç•¥ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(x, y <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(add(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3</span><br></pre></td></tr></table></figure><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ</p><p><code>x int, y int</code></p><p>è¢«ç¼©å†™ä¸º</p><p><code>x, y int</code></p><h4 id="å¤šå€¼è¿”å›"><a href="#å¤šå€¼è¿”å›" class="headerlink" title="å¤šå€¼è¿”å›"></a><a href="https://tour.golang.org/basics/6">å¤šå€¼è¿”å›</a></h4><p>å‡½æ•°å¯ä»¥è¿”å›<strong>ä»»æ„æ•°é‡</strong>çš„è¿”å›å€¼ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">swap</span><span class="params">(x, y <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">string</span>, <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> y, x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">a, b := swap(<span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;World&quot;</span>)</span><br><span class="line">fmt.Println(a, b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">World Hello</span><br></pre></td></tr></table></figure><p>swap å‡½æ•°è¿”å›äº†ä¸¤ä¸ªå­—ç¬¦ä¸²ã€‚</p><h4 id="å‘½åè¿”å›å€¼"><a href="#å‘½åè¿”å›å€¼" class="headerlink" title="å‘½åè¿”å›å€¼"></a><a href="https://tour.golang.org/basics/7">å‘½åè¿”å›å€¼</a></h4><p>Go çš„è¿”å›å€¼å¯è¢«å‘½åï¼Œå®ƒä»¬ä¼šè¢«è§†ä½œå®šä¹‰åœ¨å‡½æ•°é¡¶éƒ¨çš„å˜é‡ã€‚</p><p>è¿”å›å€¼çš„åç§°åº”å½“å…·æœ‰ä¸€å®šçš„æ„ä¹‰ï¼Œå®ƒå¯ä»¥ä½œä¸ºæ–‡æ¡£ä½¿ç”¨ã€‚</p><p>æ²¡æœ‰å‚æ•°çš„ <code>return</code> è¯­å¥è¿”å›å·²å‘½åçš„è¿”å›å€¼ã€‚ä¹Ÿå°±æ˜¯ ç›´æ¥ è¿”å›ã€‚</p><p>ç›´æ¥è¿”å›è¯­å¥åº”å½“ä»…ç”¨åœ¨ä¸‹é¢è¿™æ ·çš„çŸ­å‡½æ•°ä¸­ã€‚åœ¨é•¿çš„å‡½æ•°ä¸­å®ƒä»¬ä¼šå½±å“ä»£ç çš„å¯è¯»æ€§ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">split</span><span class="params">(sum <span class="keyword">int</span>)</span> <span class="params">(x, y <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">x = sum * <span class="number">4</span> / <span class="number">9</span></span><br><span class="line">y = sum - x</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(split(<span class="number">17</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7 10</span><br></pre></td></tr></table></figure><h3 id="Â§-å˜é‡"><a href="#Â§-å˜é‡" class="headerlink" title="Â§ å˜é‡"></a>Â§ <a href="https://tour.golang.org/basics/8">å˜é‡</a></h3><p><code>var</code> è¯­å¥ç”¨äºå£°æ˜ä¸€ä¸ªå˜é‡åˆ—è¡¨ï¼Œè·Ÿå‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸€æ ·ï¼Œç±»å‹åœ¨æœ€åã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> i, j <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> y, n <span class="keyword">bool</span></span><br><span class="line">fmt.Println(i, j, y, n)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 false false</span><br></pre></td></tr></table></figure><p>å°±åƒåœ¨è¿™ä¸ªä¾‹å­ä¸­çœ‹åˆ°çš„ä¸€æ ·ï¼Œ<code>var</code> è¯­å¥å¯ä»¥å‡ºç°åœ¨åŒ…æˆ–å‡½æ•°çº§åˆ«ã€‚</p><h4 id="å˜é‡çš„åˆå§‹åŒ–"><a href="#å˜é‡çš„åˆå§‹åŒ–" class="headerlink" title="å˜é‡çš„åˆå§‹åŒ–"></a><a href="https://tour.golang.org/basics/9">å˜é‡çš„åˆå§‹åŒ–</a></h4><p>å˜é‡å£°æ˜å¯ä»¥åŒ…å«åˆå§‹å€¼ï¼Œæ¯ä¸ªå˜é‡å¯¹åº”ä¸€ä¸ªã€‚</p><p>å¦‚æœåˆå§‹åŒ–å€¼å·²å­˜åœ¨ï¼Œåˆ™å¯ä»¥çœç•¥ç±»å‹ï¼›å˜é‡ä¼šä»åˆå§‹å€¼ä¸­è·å¾—ç±»å‹ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> i, j <span class="keyword">int</span> = <span class="number">1</span>, <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> y, n, a, b = <span class="literal">true</span>, <span class="literal">false</span>, <span class="string">&quot;Hello&quot;</span>, <span class="number">3.14</span></span><br><span class="line">fmt.Println(i, j, y, n, a, b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 2 true false Hello 3.14</span><br></pre></td></tr></table></figure><h4 id="çŸ­å˜é‡å£°æ˜"><a href="#çŸ­å˜é‡å£°æ˜" class="headerlink" title="çŸ­å˜é‡å£°æ˜"></a><a href="https://tour.golang.org/basics/10">çŸ­å˜é‡å£°æ˜</a></h4><p>åœ¨å‡½æ•°ä¸­ï¼Œç®€æ´èµ‹å€¼è¯­å¥ <code>:=</code> å¯åœ¨ç±»å‹æ˜ç¡®çš„åœ°æ–¹ä»£æ›¿ <code>var</code> å£°æ˜ã€‚</p><p>å‡½æ•°å¤–çš„æ¯ä¸ªè¯­å¥éƒ½å¿…é¡»ä»¥å…³é”®å­—å¼€å§‹ï¼ˆvar, func ç­‰ç­‰ï¼‰ï¼Œå› æ­¤ <code>:=</code> ç»“æ„ä¸èƒ½åœ¨å‡½æ•°å¤–ä½¿ç”¨ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">i := <span class="number">100</span></span><br><span class="line">fmt.Println(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">100</span><br></pre></td></tr></table></figure><h4 id="åŸºæœ¬ç±»å‹"><a href="#åŸºæœ¬ç±»å‹" class="headerlink" title="åŸºæœ¬ç±»å‹"></a><a href="https://tour.golang.org/basics/11">åŸºæœ¬ç±»å‹</a></h4><p>Go çš„åŸºæœ¬ç±»å‹æœ‰:</p><table><thead><tr><th>ç±»å‹</th><th>æè¿°</th><th>è¯´æ˜</th><th>è¡ç”Ÿ</th></tr></thead><tbody><tr><td><code>bool</code></td><td>å¸ƒå°”å‹</td><td><code>true</code> or <code>false</code></td><td></td></tr><tr><td><code>string</code></td><td>å­—ç¬¦ä¸²</td><td>ä¸€ä¸²å›ºå®šé•¿åº¦çš„å­—ç¬¦è¿æ¥èµ·æ¥çš„å­—ç¬¦åºåˆ—ï¼Œä½¿ç”¨ UTF-8 ç¼–ç æ ‡è¯† Unicode æ–‡æœ¬ã€‚</td><td></td></tr><tr><td><code>int</code></td><td>æ•´å‹</td><td>32ä½æœºä¸Šä¸º32ä½ï¼Œ64ä½æœºä¸Šæ˜¯64ä½</td><td>æŒ‡å®šå¤§å°çš„æ•´å‹: int8  <code>int16</code>  <code>int32</code>  <code>int64</code></td></tr><tr><td><code>uint</code></td><td>æ— ç¬¦å·æ•´å‹</td><td></td><td><code>uint8</code>ã€<code>uint16</code>ã€<code>uint32</code>ã€<code>uint64</code>ã€<code>uintptr</code></td></tr><tr><td><code>float32</code>ã€<code>float64</code></td><td>æµ®ç‚¹å‹</td><td></td><td></td></tr><tr><td><code>complex64</code>ã€<code>complex128</code></td><td>å¤æ•°</td><td>å¤æ•°çš„å­—é¢å€¼å¸¸é‡å†™ä½œ<code>1+2i</code></td><td></td></tr><tr><td><code>byte</code></td><td></td><td>uint8 çš„åˆ«å</td><td></td></tr><tr><td><code>rune</code></td><td>è¡¨ç¤ºä¸€ä¸ª Unicode ç ç‚¹</td><td>int32 çš„åˆ«å</td><td></td></tr></tbody></table><p>ä¸‹ä¾‹å±•ç¤ºäº†å‡ ç§ç±»å‹çš„å˜é‡ã€‚ åŒå¯¼å…¥è¯­å¥ä¸€æ ·ï¼Œå˜é‡å£°æ˜ä¹Ÿå¯ä»¥â€œåˆ†ç»„â€æˆä¸€ä¸ªè¯­æ³•å—ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math/cmplx&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">ToBe   <span class="keyword">bool</span>       = <span class="literal">false</span></span><br><span class="line">MaxInt <span class="keyword">uint64</span>     = <span class="number">1</span>&lt;&lt;<span class="number">64</span> - <span class="number">1</span></span><br><span class="line">z      <span class="keyword">complex128</span> = cmplx.Sqrt(<span class="number">-5</span> + <span class="number">12i</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;Type: %T\t\tValue: %v\n&quot;</span>, ToBe, ToBe)</span><br><span class="line">fmt.Printf(<span class="string">&quot;Type: %T\t\tValue: %v\n&quot;</span>, MaxInt, MaxInt)</span><br><span class="line">fmt.Printf(<span class="string">&quot;Type: %T\tValus: %v\n&quot;</span>, z, z)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Type: boolValue: false</span><br><span class="line">Type: uint64Value: 18446744073709551615</span><br><span class="line">Type: complex128Valus: (2+3i)</span><br></pre></td></tr></table></figure><p><code>int</code>, <code>uint</code> å’Œ <code>uintptr</code> åœ¨ 32 ä½ç³»ç»Ÿä¸Šé€šå¸¸ä¸º 32 ä½å®½ï¼Œåœ¨ 64 ä½ç³»ç»Ÿä¸Šåˆ™ä¸º 64 ä½å®½ã€‚ å½“ä½ éœ€è¦ä¸€ä¸ªæ•´æ•°å€¼æ—¶åº”ä½¿ç”¨ <code>int</code> ç±»å‹ï¼Œé™¤éä½ æœ‰ç‰¹æ®Šçš„ç†ç”±ä½¿ç”¨å›ºå®šå¤§å°æˆ–æ— ç¬¦å·çš„æ•´æ•°ç±»å‹ã€‚</p><h4 id="é›¶å€¼"><a href="#é›¶å€¼" class="headerlink" title="é›¶å€¼"></a><a href="https://tour.golang.org/basics/12">é›¶å€¼</a></h4><p>æ²¡æœ‰æ˜ç¡®åˆå§‹å€¼çš„å˜é‡å£°æ˜ä¼šè¢«èµ‹äºˆå®ƒä»¬çš„ <em>é›¶å€¼</em>ã€‚</p><p>é›¶å€¼æ˜¯ï¼š</p><p>æ•°å€¼ç±»å‹ä¸º <code>0</code>ï¼Œ<br>å¸ƒå°”ç±»å‹ä¸º <code>false</code>ï¼Œ<br>å­—ç¬¦ä¸²ä¸º <code>&quot;&quot;</code>ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> i <span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> f <span class="keyword">float64</span></span><br><span class="line"><span class="keyword">var</span> c <span class="keyword">complex128</span></span><br><span class="line"><span class="keyword">var</span> b <span class="keyword">bool</span></span><br><span class="line"><span class="keyword">var</span> s <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">&quot;%v %v %v %v %q\n&quot;</span>, i, f, c, b, s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 (0+0i) false &quot;&quot;</span><br></pre></td></tr></table></figure><h4 id="ç±»å‹è½¬æ¢"><a href="#ç±»å‹è½¬æ¢" class="headerlink" title="ç±»å‹è½¬æ¢"></a><a href="https://tour.golang.org/basics/13">ç±»å‹è½¬æ¢</a></h4><p>è¡¨è¾¾å¼ <code>T(v)</code> å°†å€¼ <code>v</code> è½¬æ¢ä¸ºç±»å‹ <code>T</code>ã€‚</p><p>ä¸€äº›å…³äºæ•°å€¼çš„è½¬æ¢ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i <span class="keyword">int</span> = <span class="number">42</span></span><br><span class="line"><span class="keyword">var</span> f <span class="keyword">float64</span> = <span class="keyword">float64</span>(i)</span><br><span class="line"><span class="keyword">var</span> u <span class="keyword">uint</span> = <span class="keyword">uint</span>(f)</span><br></pre></td></tr></table></figure><p>æˆ–è€…ï¼Œæ›´åŠ ç®€å•çš„å½¢å¼(åœ¨å‡½æ•°ä¸­)ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i := <span class="number">42</span></span><br><span class="line">f := <span class="keyword">float64</span>(i)</span><br><span class="line">u := <span class="keyword">uint</span>(f)</span><br></pre></td></tr></table></figure><p>ä¸ C ä¸åŒçš„æ˜¯ï¼ŒGo åœ¨ä¸åŒç±»å‹çš„é¡¹ä¹‹é—´èµ‹å€¼æ—¶éœ€è¦æ˜¾å¼è½¬æ¢ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> x, y <span class="keyword">int</span> = <span class="number">3</span>, <span class="number">4</span></span><br><span class="line"><span class="keyword">var</span> f <span class="keyword">float64</span> = math.Sqrt(<span class="keyword">float64</span>(x*x + y*y))</span><br><span class="line"><span class="keyword">var</span> z <span class="keyword">uint</span> = <span class="keyword">uint</span>(f)</span><br><span class="line">fmt.Println(x, y, z)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3 4 5 5</span><br></pre></td></tr></table></figure><h4 id="ç±»å‹æ¨å¯¼"><a href="#ç±»å‹æ¨å¯¼" class="headerlink" title="ç±»å‹æ¨å¯¼"></a><a href="https://tour.golang.org/basics/14">ç±»å‹æ¨å¯¼</a></h4><p>åœ¨å£°æ˜ä¸€ä¸ªå˜é‡è€Œä¸æŒ‡å®šå…¶ç±»å‹æ—¶ï¼ˆå³ä½¿ç”¨ä¸å¸¦ç±»å‹çš„ <code>:=</code> è¯­æ³•æˆ– <code>var =</code> è¡¨è¾¾å¼è¯­æ³•ï¼‰ï¼Œå˜é‡çš„ç±»å‹ç”±å³å€¼æ¨å¯¼å¾—å‡ºã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">i := <span class="number">1</span></span><br><span class="line">j := <span class="number">1.1</span></span><br><span class="line">k := <span class="number">1</span> + <span class="number">2i</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%T\t%T\t%T\n%v\t%v\t%v\n&quot;</span>, i, j, k, i, j, k)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">intfloat64complex128</span><br><span class="line">11.1(1+2i)</span><br></pre></td></tr></table></figure><p>å½“å³å€¼å£°æ˜äº†ç±»å‹æ—¶ï¼Œæ–°å˜é‡çš„ç±»å‹ä¸å…¶ç›¸åŒï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i <span class="keyword">int</span></span><br><span class="line">j := i <span class="comment">// j ä¹Ÿæ˜¯ä¸€ä¸ª int</span></span><br></pre></td></tr></table></figure><p>ä¸è¿‡å½“å³è¾¹åŒ…å«æœªæŒ‡æ˜ç±»å‹çš„æ•°å€¼å¸¸é‡æ—¶ï¼Œæ–°å˜é‡çš„ç±»å‹å°±å¯èƒ½æ˜¯ <code>int</code>, <code>float64</code> æˆ– <code>complex128</code> äº†ï¼Œè¿™å–å†³äºå¸¸é‡çš„ç²¾åº¦ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i := <span class="number">42</span>           <span class="comment">// int</span></span><br><span class="line">f := <span class="number">3.142</span>        <span class="comment">// float64</span></span><br><span class="line">g := <span class="number">0.867</span> + <span class="number">0.5i</span> <span class="comment">// complex128</span></span><br></pre></td></tr></table></figure><h4 id="å¸¸é‡"><a href="#å¸¸é‡" class="headerlink" title="å¸¸é‡"></a><a href="https://tour.golang.org/basics/15">å¸¸é‡</a></h4><p>å¸¸é‡çš„å£°æ˜ä¸å˜é‡ç±»ä¼¼ï¼Œåªä¸è¿‡æ˜¯ä½¿ç”¨ <strong><code>const</code></strong> å…³é”®å­—æ›¿æ¢ <code>var</code>ã€‚</p><p>å¸¸é‡å¯ä»¥æ˜¯å­—ç¬¦ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼æˆ–æ•°å€¼ã€‚</p><p>å¸¸é‡ä¸èƒ½ç”¨ <code>:=</code> è¯­æ³•å£°æ˜ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PI = <span class="number">3.14</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">const</span> NAME = <span class="string">&quot;World&quot;</span></span><br><span class="line">fmt.Println(<span class="string">&quot;Hello,&quot;</span>, NAME)</span><br><span class="line">fmt.Println(PI)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Hello, World</span><br><span class="line">3.14</span><br></pre></td></tr></table></figure><h4 id="æ•°å€¼å¸¸é‡"><a href="#æ•°å€¼å¸¸é‡" class="headerlink" title="æ•°å€¼å¸¸é‡"></a><a href="https://tour.golang.org/basics/16">æ•°å€¼å¸¸é‡</a></h4><p>æ•°å€¼å¸¸é‡æ˜¯é«˜ç²¾åº¦çš„<strong>å€¼</strong>ã€‚</p><p>ä¸€ä¸ªæœªæŒ‡å®šç±»å‹çš„å¸¸é‡ç”±ä¸Šä¸‹æ–‡æ¥å†³å®šå…¶ç±»å‹ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line"><span class="comment">// å°† 1 å·¦ç§» 100 ä½æ¥åˆ›å»ºä¸€ä¸ªéå¸¸å¤§çš„æ•°å­—</span></span><br><span class="line"><span class="comment">// å³è¿™ä¸ªæ•°çš„äºŒè¿›åˆ¶æ˜¯ 1 åé¢è·Ÿç€ 100 ä¸ª 0</span></span><br><span class="line">Big = <span class="number">1</span> &lt;&lt; <span class="number">100</span></span><br><span class="line"><span class="comment">// å†å¾€å³ç§» 99 ä½ï¼Œå³ Small = 1 &lt;&lt; 1ï¼Œæˆ–è€…è¯´ Small = 2</span></span><br><span class="line">Small = Big &gt;&gt; <span class="number">99</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">needInt</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> x*<span class="number">10</span> + <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">needFloat</span><span class="params">(x <span class="keyword">float64</span>)</span> <span class="title">float64</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> x * <span class="number">0.1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(needInt(Small))</span><br><span class="line">fmt.Println(needFloat(Small))</span><br><span class="line">fmt.Println(needFloat(Big))</span><br><span class="line"><span class="comment">// fmt.Println(needInt(Big))</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">21</span><br><span class="line">0.2</span><br><span class="line">1.2676506002282295e+29</span><br></pre></td></tr></table></figure><p>å°è¯•ä¸€ä¸‹è¾“å‡º <code>needInt(Big)</code> å°†ä¼šæŠ¥é”™ï¼ˆæº¢å‡ºï¼‰ã€‚</p><p>ï¼ˆ<code>int</code> ç±»å‹æœ€å¤§å¯ä»¥å­˜å‚¨ä¸€ä¸ª 64 ä½çš„æ•´æ•°ï¼Œæœ‰æ—¶ä¼šæ›´å°ã€‚ï¼‰</p>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang-Goè¯­è¨€åŸºç¡€</title>
      <link href="/2019/08/31/Golang/go-0-begining/"/>
      <url>/2019/08/31/Golang/go-0-begining/</url>
      
        <content type="html"><![CDATA[<h1 id="Go-è¯­è¨€åŸºç¡€"><a href="#Go-è¯­è¨€åŸºç¡€" class="headerlink" title="Go è¯­è¨€åŸºç¡€"></a>Go è¯­è¨€åŸºç¡€</h1><h2 id="Go-è¯­è¨€ç®€ä»‹ï¼ˆæ— ç”¨çš„åºŸè¯-ï¼‰"><a href="#Go-è¯­è¨€ç®€ä»‹ï¼ˆæ— ç”¨çš„åºŸè¯-ï¼‰" class="headerlink" title="Go è¯­è¨€ç®€ä»‹ï¼ˆæ— ç”¨çš„åºŸè¯ =_=ï¼‰"></a>Go è¯­è¨€ç®€ä»‹ï¼ˆæ— ç”¨çš„åºŸè¯ =_=ï¼‰</h2><blockquote><p>Go æ˜¯ä¸€ä¸ªå¼€æºçš„ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒèƒ½è®©æ„é€ ç®€å•ã€å¯é ä¸”é«˜æ•ˆçš„è½¯ä»¶å˜å¾—å®¹æ˜“ã€‚</p></blockquote><p>æˆ‘ä½¿ç”¨ Go çš„å‡ ä¸ªåŸå› ï¼š</p><ul><li>å¿«é€Ÿ</li><li>ç®€æ´</li><li>ä¸¥æ ¼è§„èŒƒ</li><li>æ–¹ä¾¿çš„ç½‘ç»œç¼–ç¨‹</li><li>æ–¹ä¾¿çš„å¤šçº¿ç¨‹</li><li>å®Œå¤‡çš„æ–‡æ¡£</li><li>å¼€æº</li><li><del>å¤§å¤šæ•°æœ‹å‹éƒ½ä¸ä¼šå‘€</del></li></ul><p>ä½¿ç”¨ Go å·²ç»æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œå®ƒç»™æˆ‘çš„å‡ ä¸ªæ„Ÿè§‰å°±æ˜¯ï¼š</p><ul><li>è¦æ±‚ä¸¥æ ¼ï¼ˆä¸èƒ½å£°æ˜ä¸ä½¿ç”¨çš„å˜é‡ï¼Œå˜é‡ç±»å‹å¿…é¡»æ˜¾ç¤ºè½¬åŒ–ç­‰ï¼‰</li><li>è¶…æ–¹ä¾¿çš„å¤šçº¿ç¨‹ï¼</li><li>é«˜æ•ˆï¼ˆæ—¶é—´ã€ç©ºé—´æ¶ˆè€—éƒ½ä¸å¤§å“¦ï¼‰</li></ul><p>å€Ÿç”¨ä¸€å¥å‰è¾ˆçš„è¯ï¼ŒGolang å°±æ˜¯äº’è”ç½‘æ—¶ä»£çš„ Cï¼ç”±äºæœ¬äººå¹¼å¹´æ—¶æœŸå¯¹ C ååˆ†çƒ­çˆ±ï¼ˆåæ¥ç”Ÿæ´»æ‰€è¿«æ›´å¤šæ˜¯åœ¨ç”¨OOçš„è¯­è¨€ï¼‰ï¼Œæ‰€ä»¥å¯¹ Go çš„å°è±¡ä¹Ÿå¾ˆå¥½ã€‚</p><h2 id="ç¼–è¯‘ã€è¿è¡ŒGoç¨‹åº"><a href="#ç¼–è¯‘ã€è¿è¡ŒGoç¨‹åº" class="headerlink" title="ç¼–è¯‘ã€è¿è¡ŒGoç¨‹åº"></a>ç¼–è¯‘ã€è¿è¡ŒGoç¨‹åº</h2><ol><li><strong>åˆ›å»ºç›®å½•</strong>ï¼š<br>æ–°å»ºä¸€ä¸ªç›®å½•ï¼Œè¿™ä¸ªç›®å½•çš„åç§°åº”ä¸éœ€è¦å»ºç«‹çš„Goé¡¹ç›®åç§°ç›¸åŒï¼ˆæœ€åç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶å°†ä»¥è¿™ä¸ªâ€œé¡¹ç›®æ ¹ç›®å½•â€ä¸ºæ–‡ä»¶åï¼‰ï¼› </li><li><strong>åˆ›å»ºæºæ–‡ä»¶</strong>ï¼š<br>è¿›å…¥è¯¥ç›®å½•ï¼Œåˆ›å»ºåä¸º <code>*.go</code> çš„Goæºæ–‡ä»¶ï¼Œå¹¶å†™å…¥ä»£ç ï¼›</li><li><strong>æ ¼å¼åŒ–ä»£ç </strong>ï¼š<br>å·¥ä½œç›®å½•ä¸å˜ï¼Œæ‰§è¡Œå‘½ä»¤ <code>go fmt</code>ï¼Œå¯ä»¥è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ï¼›</li><li><strong>ç¼–è¯‘è¿è¡Œ</strong>ï¼š<br><code>go run &lt;src.go&gt;</code>å‘½ä»¤ä¼šå°†ç¼–è¯‘å‚æ•°ä¸­çš„å‘½ä»¤æºç æ–‡ä»¶ï¼Œå¹¶æŠŠç¼–è¯‘åçš„å¯æ‰§è¡Œæ–‡ä»¶å­˜æ”¾åˆ°ä¸´æ—¶å·¥ä½œç›®å½•ä¸­ï¼Œç„¶åè¿è¡Œè¯¥ä¸´æ—¶å¯æ‰§è¡Œæ–‡ä»¶ï¼›</li><li><strong>ç¼–è¯‘</strong>ï¼š<br>å·¥ä½œç›®å½•ä¸å˜ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š<code>go bulid</code>ï¼Œè‹¥ç¼–è¯‘é€šè¿‡ï¼Œç›®å½•ä¸­å°†å‡ºç°ä¸€ä¸ªä¸ç›®å½•åŒåçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼›</li><li><strong>è¿è¡Œ</strong>ï¼š<br>æ‰§è¡Œç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶å³å¯ã€‚</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir test_go</span><br><span class="line">$ cd test_go&#x2F;</span><br><span class="line">$ vim test.go</span><br><span class="line">$ go run test.go</span><br><span class="line">Hello, world!</span><br><span class="line">$ go build</span><br><span class="line">$ ls</span><br><span class="line">test.go test_go</span><br><span class="line">$ .&#x2F;test_go </span><br><span class="line">Hello, world!</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ test.go ä¸­æˆ‘ä»¬å†™äº†ä¸€ä¸ªç»å…¸çš„ <code>Hello World</code> ç¨‹åºï¼Œå®ƒçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;Hello, world!\n&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å•å˜é‡çº¿æ€§å›å½’</title>
      <link href="/2019/08/18/AndrewNgML/AndrewNg-MachineLearning-1-LinearRegressionWithOneVariable/"/>
      <url>/2019/08/18/AndrewNgML/AndrewNg-MachineLearning-1-LinearRegressionWithOneVariable/</url>
      
        <content type="html"><![CDATA[<h1 id="Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-1-Linear-Regression-with-One-Variable"><a href="#Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-1-Linear-Regression-with-One-Variable" class="headerlink" title="Notes of Andrew Ngâ€™s Machine Learning â€”â€” (1) Linear Regression with One Variable"></a>Notes of Andrew Ngâ€™s Machine Learning â€”â€” (1) Linear Regression with One Variable</h1><h2 id="Model-Representation"><a href="#Model-Representation" class="headerlink" title="Model Representation"></a>Model Representation</h2><h3 id="Notation"><a href="#Notation" class="headerlink" title="Notation"></a>Notation</h3><ul><li><a href="http://clownote.github.io/about/index.html#%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F">$x^{(i)}$</a> denote the <em>input</em> variables, called <strong>input features</strong></li><li>$y^{(i)}$ denote the <em>output</em> variables, called <strong>target variable</strong></li><li>$(x^{(i)}, y^{(i)})$ is called a <strong>training example</strong></li><li>$(x^{(i)}, y^{(i)}); i=1, â€¦, m$ â€”â€” is called a <strong>training set</strong></li></ul><p>âš ï¸ã€Noteã€‘The superscript â€œ$^{(i)}$â€ in the notations is simply an <strong>index</strong> into the train set.</p><ul><li>$X$ denote the <strong>space</strong> of <em>input values</em></li><li>$Y$ denote the <strong>space</strong> of <em>output values</em></li></ul><p>In many examples, $X = Y =\R$.</p><h3 id="A-more-formal-description-of-supervised-learning"><a href="#A-more-formal-description-of-supervised-learning" class="headerlink" title="A more formal description of supervised learning"></a>A more formal description of supervised learning</h3><p>Given a training set, to learn a <strong>function</strong> $h: X \to Y$ so that $h(x)$ is a â€œgoodâ€ predictor for the corresponding value of $y$.</p><p>For historical reasons, this function $h$ is called a <strong><code>hypothesis</code></strong>.</p><p>Pictorially:</p><p><img src="http://ww4.sinaimg.cn/large/006tNc79gy1g652fmlvx6j30az078glq.jpg" alt="page1image20344816.png"> </p><p>With our new notations, the categories of supervised learning problems can be this:</p><ul><li><code>regression problem</code>: when the <strong>target variable</strong> is continuous.</li><li><code>classification problem</code>: $y$ can take on only a small number of discrete values</li></ul><h3 id="Hypothesis-amp-Model-Regression"><a href="#Hypothesis-amp-Model-Regression" class="headerlink" title="Hypothesis &amp; Model Regression"></a>Hypothesis &amp; Model Regression</h3><p>To represent the hypothesis $h$, for example, if we want to fit a data set like this:</p><p><img src="http://ww4.sinaimg.cn/large/006tNc79gy1g65bp99j97j307o05gq2z.jpg" alt="image-20190819214710193"></p><p>Simply, we may make the $h_\theta(x)=\theta_0+\theta_1x$. This is means that we are going to predict that $y$ is a linear function of $x$. </p><p>Plotting this in the picture, it will be something like this:</p><p><img src="http://ww3.sinaimg.cn/large/006tNc79gy1g65byqwhjxj307o05gwee.jpg" alt="006tNc79gy1g65bp99j97j307o05gq2z"></p><p>And what this function is doing is predicting that $y$ is some straight line function of $x$.</p><p>In this case, this <strong>model</strong> is called <strong><code>linear regression with one variable</code></strong>(or <code>Univariate linear regression</code>).</p><p>P.S. we can also fit a more complicated (perhaps non-linear) functions, but this linear case is the simplest.</p><h2 id="Cost-Function"><a href="#Cost-Function" class="headerlink" title="Cost Function"></a>Cost Function</h2><p>Well, now we have got this:</p><p><img src="http://ww4.sinaimg.cn/large/006tNc79gy1g65cm1aucyj30js0a60v0.jpg" alt="image-20190819221840291"></p><p>To get a â€œgoodâ€ hypothesis function, we need to choose $\theta_0$, $\theta_1$ so that $h_\theta(x)$ is close to $y$ for our training exmaples $(x, y)$.  A cost function is of great help with this goal.</p><h3 id="Cost-function"><a href="#Cost-function" class="headerlink" title="Cost function"></a>Cost function</h3><p>A <strong><code>cost function</code></strong> can help us to measure the accuracy of our hypothesis function.</p><p>This takes an <strong>average difference</strong> of all the results of the hypothesis with inputs from xâ€™s and the actual output yâ€™s:<br>$$<br>J(\theta_0, \theta_1) = \frac{1}{2m}\sum^m_{i=1}[h_\theta(x^{(i)})-y^{(i)}]^2 \tag{1}<br>$$<br>The function $(1)$ is our <em>cost function</em> exactly. Take a look at it:</p><ul><li><p>$h_\theta(x^{(i)})-y^{(i)}$ shows the difference between the predicted value and the actual value.</p></li><li><p>$\frac{1}{m}\sum^{m}_{i=1}â€¦$ offers the mean of the squares of $h_\theta(x^{(i)})-y^{(i)}$</p></li><li><p>The mean is halved ($\frac{1}{2}$) as a convenience for the computati::on of the <strong>gradient descent</strong>, as the $\frac{1}{2}f^2 = f$.</p></li></ul><p>P.S. This function is otherwise called the â€œ<em>Squared error function</em>â€œ, or â€œ<em>Mean squared error</em>â€œ.</p><h3 id="Goal"><a href="#Goal" class="headerlink" title="Goal"></a>Goal</h3><p>To make $h_\theta(x)$ closing to $y$, we are just expected to minimize our cost function by adjusting the value of $\theta_0$, $\theta_1$.</p><p>We describe this <strong>goal</strong> like this:<br>$$<br>\mathop{minimize}\limits_{\theta_0, \theta_1} J(\theta_0, \theta_1) \tag{2}<br>$$<br>Or, more directly:<br>$$<br>\mathop{minimize}\limits_{\theta_0, \theta_1}<br>\frac{1}{2m}\sum^m_{i=1}[h_\theta(x^{(i)})-y^{(i)}]^2<br>\tag{3}<br>$$</p><p>And if we are working with a linear regression with one variable, the $h_\theta(x)=\theta_0+\theta_1x$.</p><p>âš ï¸ã€Noteã€‘Hypothesis Function &amp; Cost Function</p><ul><li>$h_\theta(x)$ for fixed $\theta_i$, is a function of $x$.</li><li>$J(\theta_0, \theta_1)$ is a function of the parameter $\theta_i$ .</li></ul><h2 id="Cost-Function-Intuition-I"><a href="#Cost-Function-Intuition-I" class="headerlink" title="Cost Function - Intuition I"></a>Cost Function - Intuition I</h2><p>Letâ€™s draw some pictures for better understanding of what the values of the cost function.</p><p>To getting start, we are going to work with a simplified hypothesis function:</p><p><img src="http://ww2.sinaimg.cn/large/006tNc79ly1g65ddr26d9j30ja0a4778.jpg" alt="å±å¹•å¿«ç…§ 2019-08-19 22.44.10"></p><p>Our training data set is scattered on the x-y plane. We are trying to make a straight line (defined by $h_\theta(x)$) which passes through these scattered data points.</p><p>Our objective is to get the best possible line. The best possible line will be such:</p><blockquote><p>So that the <em>average squared vertical distances of the scattered points from the line</em> ($\frac{1}{m}\sum^m_{i=1}[h_\theta(x^{(i)})-y^{(i)}]^2$) will be the least.</p></blockquote><p>Ideally, the line should pass through all the points of our training data set. In such a case, the value of cost function $J(\theta_0, \theta_1)$ will be <code>0</code>. </p><p>E.g. A ideal situation where $J=0$:</p><p>Let this be our training set: Only three points <code>(1, 1)</code>, <code>(2, 2)</code> &amp; <code>(3, 3)</code></p><p><img src="http://ww2.sinaimg.cn/large/006tNc79ly1g65dnu9hj7j309606iwen.jpg" alt="å±å¹•å¿«ç…§ 2019-08-19 22.54.07"></p><p>Now, we try setting $\theta_1$ to different values: <code>-0.5</code>,  <code>0</code>, <code>0.5</code>, <code>1</code>, <code>1.5</code>â€¦â€¦</p><p>When $\theta_1=1$, we get a slope of 1 which goes through every single data point in our model. Conversely, when $\theta_1=0.5$, we see the vertical distance from our fit to the data points increase:</p><p><img src="http://ww4.sinaimg.cn/large/006tNc79ly1g65ejfyhsbj30rs08cmzd.jpg" alt="æ–°å»ºé¡¹ç›®"></p><p>By doing this, we got a series of graph of $h_\theta(x)$ in x-y plane as well as yield to the following $\theta_1$-$J(\theta_1)$ graph:</p><p><img src="http://ww1.sinaimg.cn/large/006tNc79ly1g65dzrkce0j30b209ydh6.jpg" alt="image-20190819230628708"></p><p>Thus as a goal, we should try to <strong>minimize the cost function</strong>. In this case, $\theta_1=1$ is our global minimum.</p><h2 id="Cost-Function-Intuition-II"><a href="#Cost-Function-Intuition-II" class="headerlink" title="Cost Function - Intuition II"></a>Cost Function - Intuition II</h2><p>Unlike before, this time, we wonâ€™t continue with the simplified hypothesis, we are going to keep both of parameters $\theta_0$ and $\theta_1$. So the hypithesis function will be $h_\theta(x)=\theta_0+\theta_1x$.</p><p>Hereâ€™s our problem formulation as usual:<br>$$<br>\begin{array}{rl}<br> \textrm{Hypothesis: } &amp; h_\theta(x)=\theta_0+\theta_1x\<br>  &amp; \<br> \textrm{Parameters: } &amp; \theta_0, \theta_1\<br>   &amp; \<br> \textrm{Cost Function: } &amp; J(\theta_0, \theta_1) = \frac{1}{2m}\sum^m_{i=1}[h_\theta(x^{(i)})-y^{(i)}]^2\<br>   &amp; \<br> \textrm{Goal: } &amp; \mathop{minimize}\limits_{\theta_0, \theta_1} J(\theta_0, \theta_1)<br>\end{array}<br>$$<br>Same as last time, we want to unserstand the hypothesis $h$ and the cost function $J$ via a series of graph. However, weâ€™d like to use a <em><code>contour plot</code></em> to describe our $J(\theta_0, \theta_1)$.</p><blockquote><p>A <em>contour plot</em> is a graph that contains many contour lines.</p><p>A <em>contour line</em> of a two variable function has a constant value at all points of the same line. </p></blockquote><p>An example:</p><p><img src="http://ww3.sinaimg.cn/large/006y8mN6gy1g673ule5evj30p40cqafx.jpg" alt="å±å¹•å¿«ç…§ 2019-08-21 09.29.48"></p><p>Taking any color and going along the â€˜circleâ€™, one would expect to get the same value of the cost function. </p><p>To touch our optimization objective, we can try to setting the parameters $\theta_i$ to different values.</p><p>When $\theta_0 = 360$ and $\theta_1 = 0$, the value of $J(\theta_0, \theta_1)$ in the contour plot <strong>gets closer to the center thus reducing the cost function error</strong>. Now we get a result in a better fit of the data:</p><p><img src="http://ww3.sinaimg.cn/large/006y8mN6gy1g673vbnti4j30o20bggqp.jpg" alt="å±å¹•å¿«ç…§ 2019-08-21 09.29.58"></p><p>Minimizing the cost function as much as possible and consequently, the result of $\theta_1$ and $\theta_0$ tend to be around 0.12 and 250 respectively. Plotting those values on our graph to the right seems to put our point in the center of the inner most â€˜circleâ€™.</p><p>Obviously, we dislike to write a software to just plot out a contour plot and then try to manually read off the numbers to reach our goal. We want <strong>an efficient algorithm for automatically finding the value of $\theta_0$ and $\theta_1$ that minimizes the cost function $J$</strong>. Actually, the <em>gradient descent</em> algorithm that we will talk about works great on this question.</p><h2 id="Gradient-Descent"><a href="#Gradient-Descent" class="headerlink" title="Gradient Descent"></a>Gradient Descent</h2><p>There is a algorithm called <strong>gradient descent</strong> for <strong>minimizing the cost function $J$</strong>. And we can use it not only in linear regression as itâ€™s actually used all over the place in machine learning.</p><p>Letâ€™s talk about gradient descent for minimizing some arbitrary function $J$. So hereâ€™s the problem setup:</p><p><img src="http://ww2.sinaimg.cn/large/006y8mN6ly1g67fcs8k0mj30gs09gjsz.jpg" alt="image-20190821172439919"></p><p>We put $\theta_0$ on the <code>x</code> axis and $\theta_1$ on the <code>y</code> axis, with the <strong>cost function</strong> on the vertical <code>z</code> axis. The points on our graph will be the result of the cost function using our hypothesis with those specific theta parameters. The graph below depicts such a setup:</p><p><img src="http://ww2.sinaimg.cn/large/006y8mN6gy1g67l1ajh02j30no0con68.jpg" alt="image-20190821204112216"></p><p>We will know that we have succeeded when our cost function is at the very bottom of the pits in our graph, i.e. when its value is the minimum. The red arrows show the minimum points in the graph.</p><p>Image that we are physically standing at a point on a hill, in gradient descent, what weâ€™re going to do is to spin 360 degrees around and just look all around us, and ask, â€œIf I were to take a little step in some direction, and I want to go down the hill as quickly as possible, what direction should I take?â€ then you take a step in that direction. Repeat doing this until you converge to a local minimum. Like the black line in the picture above shows.</p><p>Notice that if we choose different points to grandient descent, we may reach different local optimums.</p><p>Mathematically, this is the definition of the gradient descent algorithm:</p><blockquote><p><strong>Gradient Descent Algorithm</strong></p><p>repeat until convergence {</p><p>$\qquad\theta_j := \theta_j - \alpha\frac{\partial}{\partial\theta_j}J(\theta_0, \theta_1)\qquad \textrm{(for } j=0 \textrm{ and } j=1 \textrm{)}$</p><p>}</p></blockquote><p>The $\alpha$ is a number that is called the <strong><code>learning rate</code></strong>. It basically controls how big a step we take downhill with gradient descent.</p><p>At each iteration $j$, one should simultaneously update the parameters Î¸1,Î¸2,â€¦,Î¸n. Updating a specific parameter prior to calculating another one on the <code>j(th)</code> iteration would yield to a wrong implementation:</p><p><img src="http://ww3.sinaimg.cn/large/006y8mN6ly1g67magihpyj30wo0hu7iy.jpg" alt="å±å¹•å¿«ç…§ 2019-08-21 21.24.15"></p><h2 id="Gradient-Descent-Intuition"><a href="#Gradient-Descent-Intuition" class="headerlink" title="Gradient Descent Intuition"></a>Gradient Descent Intuition</h2><p>Letâ€™s explore the scenario where we used **one parameter $\theta_1$ ** and plotted its cost function to implement a gradient descent. Our formula for a single parameter was : Repeat until convergence:<br>$$<br>\theta_1:=\alpha\frac{d}{d\theta_1}J(\theta_1)<br>$$</p><p>Regardless of the slopeâ€™s sign for $\frac{d}{d\theta_1}J(\theta_1)$ eventually converges to its minimum value. </p><p>The following graph shows that when the slope is negative, the value of $\theta_1$ increases and when it is positive, the value of $\theta_1$ decreases:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6de48b49qj30i50af0ui.jpg" alt="image-20190826211520863"></p><p>On a side note, we should adjust our parameter $\alpha$ to ensure that the gradient descent algorithm converges in a reasonable time. Failure to converge or too much time to obtain the minimum value imply that our step size is wrong.</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6de6eemuhj30im0astb9.jpg" alt="image-20190826211727240"></p><p>How does gradient descent converge with a fixed step size $\alpha$?<br>The intuition behind the convergence is that $\frac{d}{d\theta_1}J(\theta_1)$ approaches 0 as we approach the bottom of our convex function. At the minimum, the derivative will always be 0 and thus we get:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6de8nmhaoj30ia0a4why.jpg" alt="image-20190826211936126"></p><h2 id="Gradient-Descent-for-Linear-Regression"><a href="#Gradient-Descent-for-Linear-Regression" class="headerlink" title="Gradient Descent for Linear Regression"></a>Gradient Descent for Linear Regression</h2><p>Now, we have learnt the gradient descent, the linear regression model and the squared error cost function as well. This time, we are going to put together gradient descent with our cost function that will give us an algorithm for linear regression for fitting a straight line to our data.</p><p>This is what we worked out:</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6dedxiq58j30ej052aay.jpg" alt="image-20190826212442071"></p><p>We are going to apply gradient descent algorithm to minimize our squared error cost function.</p><p>The key term is the derivative term:</p><p>$$<br>\frac{\partial}{\partial\theta_j}J(\theta_0, \theta_1) = \frac{\partial}{\partial\theta_j}\frac{1}{2m}\sum^m_{i=1}[h_\theta(x^{(i)})-y^{(i)}]^2<br>=<br>\frac{\partial}{\partial\theta_j}\frac{1}{2m}\sum^m_{i=1}[\theta_0+\theta_1x^{(i)}-y^{(i)}]^2<br>$$</p><p>$$<br>\begin{array}{rl}<br>j=0: &amp; \frac{\partial}{\partial\theta_0}J(\theta_0,\theta_1)=\frac{1}{m}\sum^m_{i=1}[h_\theta(x^{(i)})-y^{(i)}]\<br> &amp; \<br>j=1: &amp; \frac{\partial}{\partial\theta_1}J(\theta_0,\theta_1)=\frac{1}{m}\sum^m_{i=1}[h_\theta(x^{(i)})-y^{(i)}] \cdot x^{(i)}<br>\end{array}<br>$$</p><p>Plug them back into our gradient descent algorithm:</p><blockquote><p>repeat until convergence {</p><p>$\qquad\theta_0 := \theta_0 - \alpha\frac{1}{m}\sum^m_{i=1}[h_\theta(x^{(i)})-y^{(i)}]$</p><p>$\qquad\theta_1 := \theta_1 - \alpha\frac{1}{m}\sum^m_{i=1}[h_\theta(x^{(i)})-y^{(i)}] \cdot x^{(i)}$</p><p>}</p></blockquote><p>Notice: update $\theta_0$ and $\theta_1$ simultaneously.</p><p>The point of all this is that if we start with a guess for our hypothesis and then repeatedly apply these gradient descent equations, our hypothesis will become more and more accurate. So, this is simply gradient descent on the original cost function J. </p><p>This method looks at every example in the entire training set on every step, and is called <strong>batch gradient descent</strong>. </p><p>Note that, while gradient descent can be susceptible to local minima in general, the optimization problem we have     posed here for linear regression has only one global, and no other local,optima; thus gradient descent always converges (assuming the learning rate Î± is not too large) to the global minimum. Indeed, J is a convex quadratic function. Here is an example of gradient descent as it is run to minimize a quadratic function.</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6dhmaf0chj308q06qgml.jpg" alt="image-20190826231632514"></p><p>The ellipses shown above are the contours of a quadratic function. Also shown is the trajectory taken by gradient descent, which was initialized at (48,30). The xâ€™s in the figure (joined by straight lines) mark the successive values of Î¸ that gradient descent went through as itconverged to its minimum.</p><hr><h2 id="Experiment"><a href="#Experiment" class="headerlink" title="Experiment"></a>Experiment</h2><p>A Wild Implement of Linear Regression with One Variable via Gradient Descent in Python Made by Myself:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># linregress.py</span></span><br><span class="line"><span class="comment"># Linear Regression with one variable via a Batch Gradient Descent</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># Created by CDFMLR on 2019/8/28.</span></span><br><span class="line"><span class="comment"># Copyright Â© CDFMLR. All right reserved.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinearRegressionWithOneVariable</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    # Linear regression with one variable</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    &gt; Given a training set, to find a set of parameters (theta_0, theta_1) of hypothesis function `h(x) = theta_0 + theta_1 * x` via gradient descent so that h(x) is a &quot;good&quot; predictor for the corresponding value of y.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Properties</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        - `training_set`</span></span><br><span class="line"><span class="string">        - `theta`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Methods</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        - `regress`: to find a set of thetas to make hypothesis a &quot;good&quot; predictor</span></span><br><span class="line"><span class="string">        - `hypothesis`: to get a predicted value</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Example</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    ``python</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; model = LinearRegressionWithOneVariable([(0, 0), (1, 1), (2, 2), (3, 3), (4, 4), (5, 5), (6, 6)])</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; model.regress(verbose=True, epsilon=0.0001)</span></span><br><span class="line"><span class="string">    theta_0:        0.025486336182825836</span></span><br><span class="line"><span class="string">    theta_1:        0.9940305813471573</span></span><br><span class="line"><span class="string">    cost:           9.99815680487604e-05</span></span><br><span class="line"><span class="string">    hypothesis:     h(x) = 0.025486336182825836 + 0.9940305813471573*x</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; model.hypothesis(10)</span></span><br><span class="line"><span class="string">    9.9657921496544</span></span><br><span class="line"><span class="string">``</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, training_set</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        training_set: training set</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        self.training_set = training_set    <span class="comment"># [(x: int, y: int), ...]</span></span><br><span class="line">        self.theta = [<span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_hypothesis</span>(<span class="params">self, x, theta</span>):</span></span><br><span class="line">        <span class="keyword">return</span> theta[<span class="number">0</span>] + theta[<span class="number">1</span>] * x</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_cost</span>(<span class="params">self, dataset, theta</span>):</span></span><br><span class="line">        s = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> dataset:</span><br><span class="line">            s += (self._hypothesis(i[<span class="number">0</span>], theta) - i[<span class="number">1</span>]) ** <span class="number">2</span></span><br><span class="line">        <span class="keyword">return</span> s / (<span class="number">2</span> * <span class="built_in">len</span>(dataset))</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_gradient_descent</span>(<span class="params">self, dataset, starting_theta, learning_rate, epsilon, max_count=<span class="number">4294967296</span></span>):</span></span><br><span class="line">        theta = <span class="built_in">list</span>.copy(starting_theta)</span><br><span class="line">        last_theta = <span class="built_in">list</span>.copy(starting_theta)</span><br><span class="line">        cost = self._cost(dataset, theta)</span><br><span class="line">        last_cost = cost * <span class="number">2</span></span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        epsilon = <span class="built_in">abs</span>(epsilon)</span><br><span class="line">        diff = epsilon + <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> (diff &gt; epsilon):</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> count &gt;= max_count:</span><br><span class="line">                <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;Failed in gradient descent: cannot convergence after &#123;mc&#125; iterations.&quot;</span>.<span class="built_in">format</span>(mc=max_count))</span><br><span class="line">    </span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                t_sum= <span class="built_in">sum</span>((self._hypothesis(i[<span class="number">0</span>], theta) - i[<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> dataset))</span><br><span class="line">                theta[<span class="number">0</span>] = theta[<span class="number">0</span>] - learning_rate * t_sum / <span class="built_in">len</span>(dataset)</span><br><span class="line">    </span><br><span class="line">                t_sum = <span class="built_in">sum</span>(</span><br><span class="line">                    ((self._hypothesis(i[<span class="number">0</span>], theta) - i[<span class="number">1</span>]) * i[<span class="number">0</span>] <span class="keyword">for</span> i <span class="keyword">in</span> dataset)</span><br><span class="line">                    )</span><br><span class="line">                theta[<span class="number">1</span>] = theta[<span class="number">1</span>] - learning_rate * t_sum / <span class="built_in">len</span>(dataset)</span><br><span class="line">    </span><br><span class="line">                last_cost = cost</span><br><span class="line">                cost = self._cost(dataset, theta)</span><br><span class="line">    </span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">any</span>((math.isnan(x) <span class="keyword">or</span> math.isinf(x) <span class="keyword">for</span> x <span class="keyword">in</span> theta)) <span class="keyword">and</span> <span class="built_in">abs</span>(cost) &lt;= <span class="built_in">abs</span>(last_cost):</span><br><span class="line">                    diff = <span class="built_in">max</span>((<span class="built_in">abs</span>(last_theta[i] - theta[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(theta))))</span><br><span class="line">                    last_theta = <span class="built_in">list</span>.copy(theta)</span><br><span class="line">                    learning_rate += learning_rate * <span class="number">4</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    theta = <span class="built_in">list</span>.copy(last_theta)</span><br><span class="line">                    learning_rate /= <span class="number">10</span></span><br><span class="line">                    <span class="keyword">if</span> (learning_rate == <span class="number">0</span>):</span><br><span class="line">                        learning_rate = self._get_learning_rate(self.training_set)</span><br><span class="line">    </span><br><span class="line">                <span class="comment"># print(&#x27;[DEBUG] (%s) theta: %s, diff=%s, learning_rate=%s, cost=%s&#x27; % (count, theta, diff, learning_rate, cost))</span></span><br><span class="line">            <span class="keyword">except</span> OverflowError:</span><br><span class="line">                theta = <span class="built_in">list</span>.copy(last_theta)</span><br><span class="line">                learning_rate /= <span class="number">10</span></span><br><span class="line">                <span class="keyword">if</span> (learning_rate == <span class="number">0</span>):</span><br><span class="line">                    learning_rate = self._get_learning_rate(self.training_set)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> theta, count</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_get_learning_rate</span>(<span class="params">self, dataset</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> / <span class="built_in">max</span>((i[<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> dataset))</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">regress</span>(<span class="params">self, epsilon=<span class="number">1</span>, learning_rate=<span class="number">0</span>, verbose=<span class="literal">False</span></span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        To find a set of thetas to make hypothesis a &quot;good&quot; predictor</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">        Parms:</span></span><br><span class="line"><span class="string">            - epsilon: when the difference between new theta and last theta less then epsilon, finish regressing</span></span><br><span class="line"><span class="string">            - learning_rate: about the &quot;step length&quot; of gtadient descent. Too small will take a long time to regress, and too big will raise a Overflow error. `0` to allow the algorithm to select an appropriate value automatically.</span></span><br><span class="line"><span class="string">            - verbose: true to print the result of regression</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        init_theta = [random.random(), random.random()]</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span> learning_rate == <span class="number">0</span>:</span><br><span class="line">            learning_rate = self._get_learning_rate(self.training_set)</span><br><span class="line">        </span><br><span class="line">        self.theta, count = self._gradient_descent(self.training_set, init_theta, learning_rate, epsilon)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> verbose:</span><br><span class="line">            print(<span class="string">&#x27;Gradient descent finished after &#123;count&#125; iterations:\ntheta_0:\t&#123;t0&#125;\ntheta_1:\t&#123;t1&#125;\ncost:\t\t&#123;cost&#125;\nhypothesis:\th(x) = &#123;t0&#125; + &#123;t1&#125;*x&#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">                    count=count, t0=self.theta[<span class="number">0</span>], t1=self.theta[<span class="number">1</span>], cost=self._cost(self.training_set, self.theta)))</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hypothesis</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        To get a predicted y value of giving x</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Parms:</span></span><br><span class="line"><span class="string">            - x: x value of the point you want to predict</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> self._hypothesis(x, self.theta)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    model = LinearRegressionWithOneVariable([(<span class="number">0</span>, <span class="number">0</span>), (<span class="number">1</span>, <span class="number">1</span>), (<span class="number">2</span>, <span class="number">2</span>), (<span class="number">3</span>, <span class="number">3</span>), (<span class="number">4</span>, <span class="number">4</span>), (<span class="number">5</span>, <span class="number">5</span>), (<span class="number">6</span>, <span class="number">6</span>)])</span><br><span class="line">    model.regress(verbose=<span class="literal">True</span>, epsilon=<span class="number">0.0000000001</span>)</span><br><span class="line">    model.hypothesis(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> AndrewNg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœºå™¨å­¦ä¹ å¼•å…¥</title>
      <link href="/2019/08/18/AndrewNgML/AndrewNg-MachineLearning-0-Introduction/"/>
      <url>/2019/08/18/AndrewNgML/AndrewNg-MachineLearning-0-Introduction/</url>
      
        <content type="html"><![CDATA[<h1 id="Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-0-Introduction"><a href="#Notes-of-Andrew-Ngâ€™s-Machine-Learning-â€”â€”-0-Introduction" class="headerlink" title="Notes of Andrew Ngâ€™s Machine Learning â€”â€” (0) Introduction"></a>Notes of Andrew Ngâ€™s Machine Learning â€”â€” (0) Introduction</h1><h2 id="Welcome"><a href="#Welcome" class="headerlink" title="Welcome"></a>Welcome</h2><p>Machine Learning </p><ul><li>Grew out of work in AI</li><li>New capability for computers</li></ul><p>Examples:</p><ul><li><p>Database mining<br>Large datasets from growth of automation / web.<br>  E.g. Web click data, medical records, biology, engineering</p></li><li><p>Applications canâ€™t program by hand.<br>  E.g. Autonomous helicopter, handwriting recognition, most of Natural Language Progressing (NLP), Computer Vision.</p></li><li><p>Self-customizing programs<br>  E.g. Amazon, Netflix product recommendations</p></li><li><p>Understanding human learning (brain, real AI)</p></li></ul><h2 id="What-is-machine-learning"><a href="#What-is-machine-learning" class="headerlink" title="What is machine learning"></a>What is machine learning</h2><h3 id="Machine-Learning-definition"><a href="#Machine-Learning-definition" class="headerlink" title="Machine Learning definition"></a>Machine Learning definition</h3><ul><li><em>Arthur Samuel (1959)</em> : Machine Learning: Field of study that gives computers the ability to learn without being explicitly programmed.</li><li><em>Tom Mitchell (1998)</em>, <em>a more modern definition</em> : Well-posed Learning Problem: A computer program is said to learn from experience <code>E</code> with respect to some task <code>T</code> and some prformance measure <code>P</code>, if its performance on T, as measured by P, improves with experience E.</li></ul><p>Example:</p><ul><li><p>Playing checkers.</p><p><code>E</code> = the experience of playing many games of checkers<br><code>T</code> = the task of playing checkers.<br><code>P</code> = the probability that the program will win the next game.</p></li><li><p>Spam Filter</p><p><code>E</code> = Watching you label emails as spam or not spam<br><code>T</code> = Classifying emails as spam or not spam<br><code>P</code> = The number (or fraction) of emails correctly classified as spam / not spam.</p></li></ul><h3 id="Machine-Learning-algorithms"><a href="#Machine-Learning-algorithms" class="headerlink" title="Machine Learning algorithms"></a>Machine Learning algorithms</h3><ul><li>Supervised learning</li><li>Unsupervised learning</li></ul><p>Others: Reinforcement learning, recommender system</p><h2 id="Supervised-Learning"><a href="#Supervised-Learning" class="headerlink" title="Supervised Learning"></a>Supervised Learning</h2><p>In supervised learning, we are:</p><ul><li>given a data set</li><li>given â€œright answersâ€ (already know what our correct output should look like)</li><li>having the idea that there is a relationship between the input and the output.</li></ul><h4 id="Categories-of-supervised-learning-problems"><a href="#Categories-of-supervised-learning-problems" class="headerlink" title="Categories of supervised learning problems"></a>Categories of supervised learning problems</h4><ol><li><p><code>Regression</code>: Predict continuous valued output</p><p>Trying to map input variables to some continuous function.</p><p><em>[To predict how much]</em></p><p>E.g.</p><ul><li>You have a large inventory of identical items. You want to predict how many of these items will sell over the next 3 months.</li><li>Given a picture of a person, we have to predict their age on the basis of the given picture</li></ul></li><li><p><code>Classification</code>: Discrete valued output (0/1 or 0/1/2/3â€¦)</p><p>Trying to map input variables into discrete categories.</p><p><em>[To predict whether/which]</em></p><p>E.g.</p><ul><li>Given a patient with a tumor, we have to predict whether the tumor is malignant or benign.</li><li>Youâ€™d like software to examine individual customer accounts, and for each accout decide if it has been hacked/compromised.</li></ul></li></ol><h2 id="Unsupervised-Learning"><a href="#Unsupervised-Learning" class="headerlink" title="Unsupervised Learning"></a>Unsupervised Learning</h2><p>In unsupervised learning we can:</p><ul><li>approach problems with little or no idea what our results should look like</li><li>derive structure from data where we donâ€™t necessarily know the effect of the variables.</li><li>derive this structure by <strong>clustering the data</strong> based on relationships among the variables in the data.</li></ul><p>With unsupervised learning there is <strong>no feedback based on the prediction results</strong>.</p><p>E.g.</p><ol><li><p><code>Clustering</code>: </p><ul><li><p>Google news looks for tens of thousands of news stories and automatically cluster them together. So, the news stories that are all about the same topic get displayed together.</p></li><li><p>Take a collection of 1,000,000 different genes, and find a way to automatically group these genes into groups that are somehow similar or related by different variables, such as lifespan, location, roles, and so on.</p></li></ul></li><li><p><code>Non-clustering</code>:</p><p>The â€œCocktail Party Algorithmâ€, allows you to find structure in a chaotic environment. (i.e. identifying individual voices and music from a mesh of sounds at a cocktail party).</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> AndrewNg </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GitHubåŠ Hexoæ‰“é€ ä¸ªäººåšå®¢</title>
      <link href="/2019/08/15/blog/GitHub%E5%8A%A0Hexo%E6%89%93%E9%80%A0%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
      <url>/2019/08/15/blog/GitHub%E5%8A%A0Hexo%E6%89%93%E9%80%A0%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/</url>
      
        <content type="html"><![CDATA[<h1 id="GitHub-Hexo-gt-ä¸ªäººåšå®¢"><a href="#GitHub-Hexo-gt-ä¸ªäººåšå®¢" class="headerlink" title="GitHub + Hexo =&gt; ä¸ªäººåšå®¢"></a>GitHub + Hexo =&gt; ä¸ªäººåšå®¢</h1><blockquote><p>æ‰“é€ ä¸€ä¸ªä¸ªäººåšå®¢å…¶å®å¾ˆç®€å•ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‹¥æœ‰ä¸€å°æœåŠ¡å™¨ã€ç”šè‡³å¯ä»¥å¯¹ Web å¼€å‘ä¸ç”šäº†è§£ã€‚</p></blockquote><p>è¿™ç¯‡æ–‡ç« è®°å½•æˆ‘å¦‚ä½•åœ¨ Mac ä¸Šé€šè¿‡ <a href="https://github.com/">GitHub</a>ã€<a href="https://hexo.io/">Hexo</a> æ‰“é€ ä¸€ä¸ª<em>ä¸ªäººåšå®¢</em> â€”â€” <strong><a href="https://clownote.github.io/">clownote</a></strong></p><h2 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h2><p>æˆ‘ä¸€ç›´ä¸å–œæ¬¢ CSDN å’Œåšå®¢å›­ç­‰åšå®¢å¹³å°ï¼Œä½†ç¡®å®æœ‰å†™ä¸œè¥¿çš„ä¹ æƒ¯ã€‚å†™äº†ä¸œè¥¿å°±è¦å‘è¡¨ï¼Œæ‰€ä»¥åœ¨ä¹‹å‰ï¼Œæˆ‘æŠŠæˆ‘å­¦ä¹ è®¡ç®—æœºçŸ¥è¯†çš„ç¬”è®°éƒ½æ”¾åˆ°äº†ä¸€ä¸ªè‡ªå·±åˆå­¦ Web å¼€å‘æ—¶æçš„ä¸€ä¸ªè¶…çº§ç®€é™‹çš„é™æ€ç½‘ç«™ä¸Šã€‚</p><p>ä½†å®ƒå®åœ¨æ˜¯å¤ªç®€é™‹äº†å¯¼è‡´ä½¿ç”¨èµ·æ¥<strong>å·¨</strong>éº»çƒ¦ï¼Œå‘å¸ƒæ–‡ç« è¦æ‰‹åŠ¨æŠŠ markdown å†™çš„æ–‡ç« ç”¨è‡ªå·±å†™çš„ä¸€ä¸ªè½¬æ¢å™¨æ¸²æŸ“æˆ HTMLï¼Œç„¶åè°ƒç”¨ä¸€ä¸ªå¯ä»¥åŠæ—¶æ¸²æŸ“ä»£ç é¢œè‰²çš„ js è¿›å»ï¼Œç„¶å FTP ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šï¼Œå†åˆ°æ‰‹åŠ¨ä¿®æ”¹ <code>index.html</code>ï¼ŒåŠ å…¥è¿™ç¯‡æ–°æ–‡ç« çš„é“¾æ¥â€¦â€¦</p><p>è¿™å®Œå…¨ä¸æ˜¯æ­£å¸¸äººåº”è¯¥ç”¨çš„æ“ä½œï¼</p><p>æˆ‘ä¸€ç›´åœ¨è€ƒè™‘å†™ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ã€æ›´æ–¹ä¾¿çš„åšå®¢ã€‚è®¡åˆ’æ˜¯ç”¨ Flask å†™åç«¯ï¼ŒVue åšå‰ç«¯ï¼ŒGit æ¥ç®¡ç†å†…å®¹ï¼Œç„¶åå†å†™ä¸€äº› Apple Scriptã€Bash Script è®©è¿™ä¸ªåšå®¢ç³»ç»Ÿæ–¹ä¾¿åœ¨ Mac ä¸­ä½¿ç”¨ ã€‚ä½†æœ€è¿‘ä¸€ç›´å¿™å…¶ä»–é¡¹ç›®ï¼Œæ²¡æ—¶é—´æ¥å®ç°ã€‚ç°åœ¨æˆ‘çš„æœåŠ¡å™¨åˆ°æœŸäº†ï¼Œç™¾åº¦äº‘çš„ï¼Œæ„Ÿè§‰ä¸å¤ªå¥½ç”¨ï¼ˆä¸»è¦æ˜¯å—å¯¹è¿™å®¶å…¬å¸çš„æŸäº›å…¶ä»–äº§å“çš„ä¸è‰¯å°è±¡çš„å½±å“ï¼‰ï¼Œä¸ç»­è´¹äº†ã€‚</p><p>ç¬”è®°æ€¥éœ€è¿å‡ºï¼å†™ä¹‹å‰æƒ³çš„åšå®¢ç³»ç»Ÿæ˜¯æ¥ä¸åŠäº†ï¼Œçªç„¶æƒ³èµ·æ¥å¾ˆå¤šäººç”¨ä¸€ä¸ªå« <code>Hexo</code> çš„ä¸œè¥¿åšåšå®¢ï¼Œäºæ˜¯ä¸€ç•ª Googleã€Bingã€‚æœ€ç»ˆï¼Œæˆ‘è§‰å®šç”¨ <code>GitHub</code> + <code>Hexo</code> å¿«é€Ÿï¼ˆLess than One Dayï¼‰æ‰“é€ ä¸€ä¸ª<strong>ä¸ç”¨æœåŠ¡å™¨</strong>ã€<strong>ä¸ç”¨å†™ä»£ç </strong>çš„åšå®¢ã€‚</p><h2 id="ç»è¿‡"><a href="#ç»è¿‡" class="headerlink" title="ç»è¿‡"></a>ç»è¿‡</h2><p><del>åºŸè¯ä¸å¤šè¯´ï¼Œä»£ç èµ¶å¿«å†™èµ·æ¥</del>ï¼Œï¼Œï¼Œï¼ˆå“¦ï¼Œé”™äº†ï¼Œå’±ä»¬ä»Šå¤©ä¸ç”¨å†™ä»£ç ï¼åªæ˜¯å‡ ä¸ªç®€å•çš„å‘½ä»¤ + é…ç½®å°±å¥½äº†ğŸ˜‚ï¼‰</p><p>åºŸè¯ä¸å¤šè¯´ï¼Œå»ºç«™èµ°èµ·ï¼</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><h4 id="æ³¨å†ŒGitHub"><a href="#æ³¨å†ŒGitHub" class="headerlink" title="æ³¨å†ŒGitHub"></a>æ³¨å†ŒGitHub</h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ³¨å†Œä¸€ä¸ª <code>GitHub</code> è´¦æˆ·ï¼Œæˆ‘ç›¸ä¿¡ç»å¤§å¤šæ•°çš„è¯»è€…å·²ç»å®Œæˆäº†è¿™ä¸€æ­¥ï¼Œæ‰€ä»¥ä¸å†èµ˜è¿°ï¼›å¦‚æœæ‚¨å¹¸è¿çš„å±äºå°‘æ•°äººï¼Œè¯·æ‰“å¼€ <a href="https://github.com/">GitHub</a>ï¼Œå³å¯æŒ‰ç…§æ„Ÿè§‰è½»æ¾å®Œæˆã€‚</p><h4 id="åˆ›å»º-GitHub-Pages"><a href="#åˆ›å»º-GitHub-Pages" class="headerlink" title="åˆ›å»º GitHub Pages"></a>åˆ›å»º GitHub Pages</h4><p>åœ¨æ‚¨çš„ GitHub ä¸­ï¼Œ<code>New</code> ä¸€ä¸ª <code>Repository</code>ï¼Œåå­—ä¸º <code>&lt;userName&gt;.github.io</code>ï¼Œå…¶ä¸­çš„ <code>&lt;userName&gt;</code> ä¸æ‚¨çš„ GitHub ç”¨æˆ·åç›¸åŒã€‚</p><p>æ³¨æ„ï¼Œåœ¨è¿™ä¸ªæ–°å»ºçš„ Repository çš„ <code>Settings</code> ä¸­ï¼Œæ‚¨åº”è¯¥å¯ä»¥æ‰¾åˆ°ï¼Œæœ‰å…³ <code>GitHub Pages</code> çš„è®¾ç½®é‡Œå†™äº†:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Your site is published at https:&#x2F;&#x2F;&lt;userName&gt;.github.io</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±æˆäº†ï¼Œå¦åˆ™è¯·æ£€æŸ¥ä¹‹å‰çš„æ­¥éª¤æ˜¯å¦æ­£ç¡®ã€‚</p><h4 id="å®‰è£…-Hexo"><a href="#å®‰è£…-Hexo" class="headerlink" title="å®‰è£… Hexo"></a>å®‰è£… Hexo</h4><p>åœ¨å®‰è£… <code>Hexo</code> å‰ï¼Œéœ€è¦ç¡®å®šç”µè„‘ä¸­æ˜¯å¦å·²å®‰è£…äº†ï¼š</p><ul><li><a href="http://nodejs.org/">Node.js</a> (ç‰ˆæœ¬è‡³å°‘ä¸º nodejs 6.9)</li><li><a href="http://git-scm.com/">Git</a></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git --version</span><br><span class="line">$ node --version</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰ï¼Œè¦å…ˆå®‰è£…ä»–ä»¬ã€‚æ¥ä¸‹æ¥åªéœ€è¦ä½¿ç”¨ <code>npm</code> å³å¯å®Œæˆ Hexo çš„å®‰è£…ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g hexo-cli</span><br></pre></td></tr></table></figure><h3 id="å»ºç«™"><a href="#å»ºç«™" class="headerlink" title="å»ºç«™"></a>å»ºç«™</h3><h4 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h4><p>å®‰è£… Hexo å®Œæˆåï¼Œæ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼ŒHexo å°†ä¼šåœ¨æŒ‡å®šæ–‡ä»¶å¤¹ä¸­æ–°å»ºæ‚¨çš„åšå®¢ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ hexo init &lt;folder&gt;</span><br><span class="line">$ cd &lt;folder&gt;</span><br><span class="line">$ npm install</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œå¯ä»¥çœ‹åˆ°æŒ‡å®šæ–‡ä»¶å¤¹çš„ç›®å½•å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ _config.yml</span><br><span class="line">â”œâ”€â”€ package.json</span><br><span class="line">â”œâ”€â”€ scaffolds</span><br><span class="line">â”œâ”€â”€ source</span><br><span class="line">|   â”œâ”€â”€ _drafts</span><br><span class="line">|   â””â”€â”€ _posts</span><br><span class="line">â””â”€â”€ themes</span><br></pre></td></tr></table></figure><h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>ç›®å½•ä¸­çš„ <code>_config.yml</code> æ˜¯ç½‘ç«™çš„é…ç½®ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ­¤é…ç½®ä¸€äº›å‚æ•°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cat _config.yml</span><br><span class="line"># Hexo Configuration</span><br><span class="line">## Docs: https:&#x2F;&#x2F;hexo.io&#x2F;docs&#x2F;configuration.html</span><br><span class="line">## Source: https:&#x2F;&#x2F;github.com&#x2F;hexojs&#x2F;hexo&#x2F;</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>éœ€è¦é…ç½®çš„é¡¹ç›®æœ‰ï¼š</p><table><thead><tr><th align="left">å‚æ•°</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left"><code>title</code></td><td align="left">ç½‘ç«™æ ‡é¢˜</td></tr><tr><td align="left"><code>subtitle</code></td><td align="left">ç½‘ç«™å‰¯æ ‡é¢˜</td></tr><tr><td align="left"><code>description</code></td><td align="left">ç½‘ç«™æè¿°</td></tr><tr><td align="left"><code>keywords</code></td><td align="left">ç½‘ç«™çš„å…³é”®è¯ã€‚ä½¿ç”¨åŠè§’é€—å· <code>,</code> åˆ†éš”å¤šä¸ªå…³é”®è¯ã€‚</td></tr><tr><td align="left"><code>author</code></td><td align="left">æ‚¨çš„åå­—</td></tr><tr><td align="left"><code>language</code></td><td align="left">ç½‘ç«™ä½¿ç”¨çš„è¯­è¨€</td></tr><tr><td align="left"><code>url</code></td><td align="left">ç½‘å€</td></tr><tr><td align="left"><code>theme</code></td><td align="left">å½“å‰ä¸»é¢˜åç§°ã€‚å€¼ä¸º<code>false</code>æ—¶ç¦ç”¨ä¸»é¢˜</td></tr><tr><td align="left"><code>deploy</code></td><td align="left">éƒ¨ç½²éƒ¨åˆ†çš„è®¾ç½®</td></tr></tbody></table><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œ<code>deploy</code> é¡¹çš„é…ç½®å°±å¯ä»¥æŠŠHexoä¸GitHubå…³è”èµ·æ¥ï¼Œå³å°†æˆ‘ä»¬çš„åšå®¢<strong>æ¨é€</strong>åˆ° GitHubï¼Œæ‰“å¼€ç«™ç‚¹çš„é…ç½®æ–‡ä»¶_config.ymlï¼Œ<code>deploy</code> é¡¹é…ç½®ä¸ºï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span> </span><br><span class="line"><span class="attr">type:</span> <span class="string">git</span></span><br><span class="line"><span class="attr">repo:</span> <span class="string">https://github.com/&lt;userName&gt;/&lt;userName&gt;.github.io</span></span><br><span class="line"><span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œæˆ‘ä»¬éœ€è¦è®© Hexo è¿æ¥ä¸Šæˆ‘ä»¬çš„ GitHubï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-deployer-git --save</span><br><span class="line"></span><br><span class="line">$ hexo clean</span><br><span class="line">$ hexo generate</span><br><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>æ¯ä¸€æ¡å‘½ä»¤çš„ä½œç”¨éƒ½å¾ˆç›´è§‚ã€‚æ“ä½œå®Œä¹‹åä½ å°±ä¼šå‘ç°ä½ çš„åšå®¢å·²ç»ä¸Šçº¿äº†ï¼Œå¯ä»¥åœ¨ç½‘ç»œä¸Šè¢«è®¿é—®äº†ï¼</p><h4 id="ä¸»é¢˜"><a href="#ä¸»é¢˜" class="headerlink" title="ä¸»é¢˜"></a>ä¸»é¢˜</h4><p>å¦‚æœä½ åƒæˆ‘ä¸€æ ·ï¼Œè§‰å¾— <code>Hexo</code> è‡ªå¸¦çš„ <code>landscape</code> ä¸»é¢˜ä¸å¤ªå¥½çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥è·Ÿæ¢ä¸€ä¸ªä¸»é¢˜ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åœ¨ Hexo å®˜ç½‘ä¸Šæ‰¾åˆ°å¾ˆä¸°å¯Œçš„ <a href="https://hexo.io/themes/">ä¸»é¢˜èµ„æº</a>ï¼Œå…·ä½“çš„ä½¿ç”¨æ–¹æ³•ä¸»é¢˜é¡¹ç›®çš„ README é‡Œä¼šå†™æ˜ï¼Œç…§ç€åšå°±è¡Œã€‚</p><p>è¿™é‡Œä»¥é…ç½®ä¸€ä¸ªå«åš <a href="https://github.com/probberechts/hexo-theme-cactus"><code>cactus</code></a> çš„ä¸»é¢˜ä¸ºä¾‹ï¼š</p><ol><li>ä¸‹è½½ã€å®‰è£…ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd &lt;folder&gt;# hexo init çš„ç›®å½•</span><br><span class="line">$ git clone https:&#x2F;&#x2F;github.com&#x2F;probberechts&#x2F;hexo-theme-cactus.git themes&#x2F;cactus# æ‹·è´ä¸€ä»½ä¸»é¢˜</span><br></pre></td></tr></table></figure><ol start="2"><li>ä¿®æ”¹Hexoä¸»é¢˜ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim .&#x2F;config.yml</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å…¶ä¸­çš„ <code>theme</code> å±æ€§ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># theme: landscape</span><br><span class="line">theme: cactus</span><br></pre></td></tr></table></figure><ol start="3"><li>ä¸»é¢˜é…ç½®</li></ol><p>åœ¨ <code>themes/cactus/_config.yml</code> ä¸­æŒ‰ç…§è‡ªå·±çš„éœ€è¦å¯¹ä¸»é¢˜è¿›è¡Œé…ç½®ã€‚</p><h3 id="å†™ä½œ"><a href="#å†™ä½œ" class="headerlink" title="å†™ä½œ"></a>å†™ä½œ</h3><p>å…¶å®åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„åšå®¢å°±å·²ç»æ„å»ºå®Œæˆäº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥ç”¨æ–°å»ºçš„åšå®¢ç³»ç»Ÿå†™ä½œäº†ğŸ˜Šã€‚</p><h4 id="æ–°å»ºæ–‡ç« "><a href="#æ–°å»ºæ–‡ç« " class="headerlink" title="æ–°å»ºæ–‡ç« "></a>æ–°å»ºæ–‡ç« </h4><p>ä½ å¯ä»¥æ‰§è¡Œä¸‹åˆ—å‘½ä»¤æ¥åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new [layout] &lt;title&gt;</span><br></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥åœ¨å‘½ä»¤ä¸­æŒ‡å®šæ–‡ç« çš„å¸ƒå±€ï¼ˆlayoutï¼‰ï¼Œé»˜è®¤ä¸º <code>post</code>ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ <code>_config.yml</code> ä¸­çš„ <code>default_layout</code> å‚æ•°æ¥æŒ‡å®šé»˜è®¤å¸ƒå±€ã€‚</p><p>å¯é€‰çš„å¸ƒå±€æœ‰ï¼š</p><table><thead><tr><th><code>layout</code></th><th>å‚¨å­˜è·¯å¾„</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><code>post</code></td><td><code>source/_posts</code></td><td>å­˜æ”¾è¦å‘å¸ƒçš„åšå®¢æ–‡ç« </td></tr><tr><td><code>page</code></td><td><code>source</code></td><td>ç½‘ç«™ä¸­çš„ä¸€äº›å›ºå®šé¡µé¢ï¼Œæ¯”å¦‚è¯´â€å…³äºâ€</td></tr><tr><td><code>draft</code></td><td><code>source/_drafts</code></td><td>è‰ç¨¿</td></tr></tbody></table><p><code>hexo new</code> æˆåŠŸåï¼ŒHexo ä¼šå‘Šè¯‰ä½ æ–°å»ºçš„æ–‡ä»¶è·¯å¾„ï¼Œåˆ©ç”¨ markdown ç¼–è¾‘å™¨æ‰“å¼€å®ƒï¼Œå°±å¯ä»¥å¼€å§‹ä¹¦å†™äº†ï¼Œåœ¨æˆ‘çš„ Mac é‡Œï¼Œé»˜è®¤çš„ markdown ç¼–è¾‘å™¨æ˜¯ <code>Typora</code>ï¼Œå¯ä»¥ç›´æ¥ç”¨ <code>open</code> å‘½ä»¤æ¥ç”¨é»˜è®¤ç¨‹åºæ‰“å¼€å¹¶ç¼–è¾‘æ–‡ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ open ~&#x2F;&lt;blogFolder&gt;&#x2F;source&#x2F;_drafts&lt;title&gt;.md</span><br></pre></td></tr></table></figure><h4 id="è‰ç¨¿"><a href="#è‰ç¨¿" class="headerlink" title="è‰ç¨¿"></a>è‰ç¨¿</h4><p>æˆ‘ä»¬åœ¨å†™æ–‡ç« æ—¶ï¼Œå¯ä»¥å…ˆå†™è‰ç¨¿(draft)ã€‚è‰ç¨¿é»˜è®¤ä¸ä¼šæ˜¾ç¤ºåœ¨é¡µé¢ä¸­ï¼Œæ‚¨å¯åœ¨æ‰§è¡Œæ—¶åŠ ä¸Š <code>--draft</code> å‚æ•°ï¼Œæˆ–æ˜¯æŠŠ <code>render_drafts</code> å‚æ•°è®¾ä¸º <code>true</code> æ¥é¢„è§ˆè‰ç¨¿ã€‚</p><p>æ–‡ç« å†™å¥½åï¼Œé€šè¿‡ <code>publish</code> å‘½ä»¤å°†è‰ç¨¿ç§»åŠ¨åˆ° <code>source/_posts</code> æ–‡ä»¶å¤¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo publish [layout] &lt;title&gt;</span><br></pre></td></tr></table></figure><h4 id="Front-matter"><a href="#Front-matter" class="headerlink" title="Front-matter"></a>Front-matter</h4><p>Front-matter æ˜¯æ–‡ä»¶æœ€ä¸Šæ–¹ä»¥ <code>---</code> åˆ†éš”çš„åŒºåŸŸï¼Œåœ¨é‡Œé¢å†™ YAML é…ç½®ï¼Œç”¨äºæŒ‡å®šä¸ªåˆ«æ–‡ä»¶çš„å˜é‡ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">Hello</span> <span class="string">World</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2013</span><span class="string">/7/13</span> <span class="number">20</span><span class="string">:46:25</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„å‚æ•°ï¼š</p><table><thead><tr><th align="left">å‚æ•°</th><th align="left">æè¿°</th><th align="left">é»˜è®¤å€¼</th></tr></thead><tbody><tr><td align="left"><code>layout</code></td><td align="left">å¸ƒå±€</td><td align="left"></td></tr><tr><td align="left"><code>title</code></td><td align="left">æ ‡é¢˜</td><td align="left"></td></tr><tr><td align="left"><code>date</code></td><td align="left">å»ºç«‹æ—¥æœŸ</td><td align="left">æ–‡ä»¶å»ºç«‹æ—¥æœŸ</td></tr><tr><td align="left"><code>updated</code></td><td align="left">æ›´æ–°æ—¥æœŸ</td><td align="left">æ–‡ä»¶æ›´æ–°æ—¥æœŸ</td></tr><tr><td align="left"><code>comments</code></td><td align="left">å¼€å¯æ–‡ç« çš„è¯„è®ºåŠŸèƒ½</td><td align="left">true</td></tr><tr><td align="left"><code>tags</code></td><td align="left">æ ‡ç­¾ï¼ˆä¸é€‚ç”¨äºåˆ†é¡µï¼‰</td><td align="left"></td></tr><tr><td align="left"><code>categories</code></td><td align="left">åˆ†ç±»ï¼ˆä¸é€‚ç”¨äºåˆ†é¡µï¼‰</td><td align="left"></td></tr><tr><td align="left"><code>permalink</code></td><td align="left">è¦†ç›–æ–‡ç« ç½‘å€</td><td align="left"></td></tr><tr><td align="left"><code>keywords</code></td><td align="left">ä»…ç”¨äº meta æ ‡ç­¾å’Œ Open Graph çš„å…³é”®è¯ï¼ˆä¸æ¨èä½¿ç”¨ï¼‰</td><td align="left"></td></tr></tbody></table><h4 id="åˆ†ç±»å’Œæ ‡ç­¾"><a href="#åˆ†ç±»å’Œæ ‡ç­¾" class="headerlink" title="åˆ†ç±»å’Œæ ‡ç­¾"></a>åˆ†ç±»å’Œæ ‡ç­¾</h4><p>å¯¹äºå¤§å¤šæ•°äººæ¥è®²ï¼Œå¯¹ä¸€ç¯‡æ–‡ç« åˆ†ç±»å’Œæ ‡ç­¾çš„è®¾ç½®æ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p><p>åˆ†ç±»å’Œæ ‡ç­¾å¬èµ·æ¥å¾ˆæ¥è¿‘ï¼Œä½†æ˜¯åœ¨ Hexo ä¸­ä¸¤è€…æœ‰ç€æ˜æ˜¾çš„å·®åˆ«ï¼š<strong>åˆ†ç±»(<code>categories</code>)</strong> å…·æœ‰<em>é¡ºåºæ€§</em>å’Œ<em>å±‚æ¬¡æ€§</em>ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>Foo, Bar</code> ä¸ç­‰äº <code>Bar, Foo</code>ï¼›è€Œ <strong>æ ‡ç­¾(<code>tags</code>)</strong> æ²¡æœ‰é¡ºåºå’Œå±‚æ¬¡ã€‚</p><p>åœ¨ <code>Front-matter</code> ä¸­ï¼Œåˆ†ç±»å’Œæ ‡ç­¾çš„è®¾ç½®æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">categories:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">Diary</span></span><br><span class="line"><span class="attr">tags:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">PS3</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">Games</span></span><br></pre></td></tr></table></figure><p>åœ¨ä½¿ç”¨ <code>categories</code> æ—¶ï¼Œè¯·æ³¨æ„ï¼š</p><p>Hexoä¸æ”¯æŒæŒ‡å®šå¤šä¸ªåŒçº§åˆ†ç±»ï¼ä¸‹é¢çš„æŒ‡å®šæ–¹æ³•ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">categories:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">Diary</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">Life</span></span><br></pre></td></tr></table></figure><p>ä¼šä½¿åˆ†ç±» <code>Life</code> æˆä¸º <code>Diary</code> çš„å­åˆ†ç±»ï¼Œè€Œä¸æ˜¯ <em>å¹¶åˆ—åˆ†ç±»</em>ã€‚å› æ­¤ï¼Œæœ‰å¿…è¦ä¸ºæ‚¨çš„æ–‡ç« é€‰æ‹©å°½å¯èƒ½å‡†ç¡®çš„åˆ†ç±»ã€‚</p><h4 id="å‘å¸ƒ"><a href="#å‘å¸ƒ" class="headerlink" title="å‘å¸ƒ"></a>å‘å¸ƒ</h4><p>åœ¨å®Œæˆå†™ä½œåï¼Œæˆ‘ä»¬å…ˆä¿å­˜ç¼–è¾‘å¥½çš„ markdown æ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ hexo publish post &lt;title&gt;.md# å¦‚æœæ–°å»ºæ—¶ layout ä¸º draft</span><br><span class="line"></span><br><span class="line">$ hexo deploy --generate# ç”Ÿæˆæ–‡ä»¶å®Œæˆåéƒ¨ç½²</span><br><span class="line"># å¯ä»¥ç®€å†™ä¸º &#96;$ hexo d -g&#96;</span><br></pre></td></tr></table></figure><h4 id="æ“ä½œæ€»ç»“"><a href="#æ“ä½œæ€»ç»“" class="headerlink" title="æ“ä½œæ€»ç»“"></a>æ“ä½œæ€»ç»“</h4><p>ç°åœ¨ï¼Œå›é¡¾ä¸€ä¸‹æˆ‘ä»¬ç”¨ Hexo å†™ä½œçš„è¿‡ç¨‹:</p><ol><li><code>$ hexo new draft &lt;title&gt;</code></li><li><code>$ open ~/&lt;blogFolder&gt;/source/_drafts/&lt;title&gt;.md</code></li><li><code>åœ¨ç¼–è¾‘å™¨ä¸­å¡«å†™Front-matterï¼Œå¹¶å®Œæˆå†…å®¹å†™ä½œ</code></li><li><code>$ hexo publish post &lt;title&gt;</code></li><li><code>$ hexo deploy --generate</code></li></ol><p>å¦‚æœæœ‰èƒ½åŠ›ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å†™ä¸€ä¸ªç®€å•çš„å°è„šæœ¬æ¥ç®€åŒ–è¿™äº›æ“ä½œã€‚å¾ˆå®¹æ˜“å®ç°ï¼Œåœ¨è¿™é‡Œå°±ä¸ä»‹ç»äº†ã€‚</p><h3 id="åŠŸèƒ½æ‹“å±•"><a href="#åŠŸèƒ½æ‹“å±•" class="headerlink" title="åŠŸèƒ½æ‹“å±•"></a>åŠŸèƒ½æ‹“å±•</h3><p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†åšå®¢ç³»ç»Ÿçš„å®‰è£…ã€å»ºç«™å¹¶ä¸”å­¦ä¼šäº†åœ¨å…¶ä¸­å†™ä½œã€‚</p><p>å½“æˆ‘ä»¬æ‰“å¼€è‡ªå·±çš„åšå®¢ç½‘ç«™æ—¶ï¼Œä¼šå‘ç°ï¼Œæˆ‘ä»¬çš„ <code>Cactus</code> ä¸»é¢˜å·²ç»æä¾›äº†è¯¸å¦‚åˆ†äº«ã€å¯¼èˆªçš„åŠŸèƒ½ã€‚</p><p>ä½†æˆ–è®¸æˆ‘ä»¬è¿˜æ˜¯è§‰å¾—å®ƒæœ‰äº›å¤ªç®€é™‹äº†ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜æƒ³è®©å®ƒæœ‰ä¸€äº›è®©ç”¨æˆ·ä½“éªŒæ›´å¥½çš„ç‰¹æ€§ï¼Œæ¯”å¦‚ï¼Œæœç´¢ã€è¯„è®ºåŠŸèƒ½ï¼Œç°åœ¨æˆ‘ä»¬å°è¯•æ¥å®ç°å®ƒä»¬ã€‚</p><p>å…¶å®ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„ <code>Cactus</code> ä¸»é¢˜ä¸­ï¼Œå·²ç»åŒ…å«äº†å¯¹æœç´¢ã€è¯„è®ºçš„æ”¯æŒï¼Œç›´æ¥ä½¿ç”¨å³å¯ã€‚</p><h4 id="æœç´¢"><a href="#æœç´¢" class="headerlink" title="æœç´¢"></a>æœç´¢</h4><p>å®‰è£… hexo çš„æœç´¢æ’ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-generator-search --save</span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªæ–°é¡µé¢ï¼Œç”¨æ¥æ‰¿è½½æœç´¢åŠŸèƒ½ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new page search</span><br></pre></td></tr></table></figure><p>åœ¨ Front-matter é‡ŒåŠ ä¸Š <code>type: search</code>ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">title:</span> <span class="string">Search</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">search</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><p>åœ¨ <code>themes/cactus/_config.yml</code> é‡Œé…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">nav:</span></span><br><span class="line">  <span class="attr">search:</span> <span class="string">/search/</span></span><br></pre></td></tr></table></figure><h4 id="è¯„è®º"><a href="#è¯„è®º" class="headerlink" title="è¯„è®º"></a>è¯„è®º</h4><p> <code>Cactus</code> ä¸»é¢˜ä¸ºæˆ‘ä»¬æä¾›çš„è¯„è®ºå·¥å…·æ˜¯ <code>Disqus</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªå„æ–¹é¢éƒ½å¾ˆå¥½çš„è¯„è®ºç³»ç»Ÿï¼Œä½†æœ‰ä¸€ç‚¹é—®é¢˜æ˜¯ï¼Œè¿™ä¸ªè¯„è®ºç³»ç»Ÿ<strong>åœ¨å›½å†…æ— æ³•ä½¿ç”¨</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬åªæ˜¯ç®€å•ç¿»è¯‘ä¸€ä¸‹å®˜æ–¹çš„ä»‹ç»ï¼š</p><p>é¦–å…ˆï¼Œåœ¨ Disqus æ³¨å†Œæˆ‘ä»¬çš„ç«™ç‚¹: <a href="http://disqus.com/admin/create/">https://disqus.com/admin/create/</a>.</p><p>ç„¶å, ä¿®æ”¹ <code>themes/cactus/_config.yml</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">disqus:</span><br><span class="line">  enabled: true</span><br><span class="line">  shortname: SITENAME</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>SITENAME</code> æ˜¯åœ¨æ³¨å†Œ Disqus æ—¶ï¼Œä½ ç»™ä½ çš„ç«™ç‚¹å¡«å†™çš„åå­—ã€‚</p><h2 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h2><p>å¥½äº†ï¼Œæˆ‘ä»¬çš„åšå®¢ç½‘ç«™å»ºå¥½äº†ã€‚ç”±äºæˆ‘æœ€è¿«åˆ‡çš„éœ€æ±‚å°±æ˜¯å¿«é€Ÿçš„å®Œæˆåšå®¢å»ºç«™ï¼Œæ‰€ä»¥å¤šä½™çš„ä¸œè¥¿æˆ‘éƒ½æ²¡æœ‰ç ”ç©¶ï¼Œä½†å…¶å® Hexo è¿˜å¯ä»¥æœ‰å¾ˆå¤šæ‹“å±•ï¼ŒGitHub Pages ä¹Ÿè¿˜æœ‰ä¸€äº›ä¸œè¥¿å¯ä»¥é…ç½®ï¼Œè¿™äº›éƒ½éœ€è¦å¤§å®¶è‡ªå·±å»ç ”ç©¶ã€‚</p><p>åæœŸæˆ‘è¿˜ä¼šæŒç»­ä¼˜åŒ–è¿™ä¸ªç½‘ç«™ï¼Œæ¯”å¦‚æˆ‘è®¡åˆ’ä¿®æ”¹ä¸€ä¸‹æºç ï¼ŒæŠŠ Cactus ä¸­çš„ <code>Disqus</code> è¯„è®ºæ¢æˆå¢™å†…èƒ½ç”¨çš„å¦‚ <code>livere</code> ä¹‹ç±»çš„ä¸œè¥¿ ï¼Œå¦‚æœå¯ä»¥ï¼Œæˆ‘ä¼šå¦å¤–å‘æ–‡è®°å½•ã€‚</p><p>å…¶å®ï¼Œè¿™ç¯‡æ–‡ç« ä¸­çš„ç»å¤§å¤šæ•°å†…å®¹éƒ½æ¥æºäºå’±ä»¬ä½¿ç”¨çš„å„ä¸ªå·¥å…·çš„å®˜ç½‘ï¼Œæˆ‘åªæ˜¯ç²—ç³™åœ°æŠŠä»–ä»¬æŒ‰ç…§ä¸€å®šçš„é€»è¾‘é¡ºåºæ’åˆ—åˆ°ä¸€èµ·ã€‚å¦‚æœéœ€è¦æ›´è¯¦ç»†çš„è¯´æ˜ï¼Œå¤§å®¶å¯ä»¥çœ‹ä¸‹é¢åˆ—å‡ºçš„è¿™äº›å‚è€ƒæ–‡æ¡£ï¼š</p><ul><li>GitHubçš„æ³¨å†Œä¸ä½¿ç”¨ï¼š<a href="https://help.github.com/cn">https://help.github.com/cn</a></li><li>Hexoçš„å®‰è£…åŠä½¿ç”¨ï¼š<a href="https://hexo.io/zh-cn/docs/">https://hexo.io/zh-cn/docs/</a></li><li>Cactusä¸»é¢˜çš„é…ç½®ï¼š<a href="https://github.com/probberechts/hexo-theme-cactus">https://github.com/probberechts/hexo-theme-cactus</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®ç»“æ„ã€Œå›¾ã€çš„åŸºç¡€</title>
      <link href="/2019/05/07/Algorithm/Graph/"/>
      <url>/2019/05/07/Algorithm/Graph/</url>
      
        <content type="html"><![CDATA[<p>è¿™ï¼ˆå¯èƒ½ï¼‰æ˜¯ä½ èƒ½æ‰¾åˆ°çš„æœ€ç®€å•çš„è®²å›¾çš„æ–‡ç« ã€‚</p><blockquote><p>è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘ä»¥å‰å­¦ä¹ ã€Œå›¾ã€æ•°æ®ç»“æ„çš„æ—¶å€™å†™çš„ã€‚ä»Šå¤©ä¸Šè¯¾è®²å›¾ï¼Œæˆ‘ç¿»äº†å¥½ä¹…æ‰ç¿»åˆ°è¿™ä¸ªğŸ˜‚</p><p>æ³¨ï¼šæ–‡ä¸­ä»£ç å‡ä¸ºä¼ªä»£ç ï¼Œå…¶è¯­æ³•æ¯”è¾ƒç±»ä¼¼äº Python + BASICï¼Œä½ å¯ä»¥ç”¨ä½ å–œæ¬¢çš„ä»»ä½•è¯­è¨€å»åšå…·ä½“å®ç°ã€‚åœ¨æœ€åï¼Œæˆ‘ä¼šé™„ä¸Šæˆ‘çš„ Python å®ç°æºç ã€‚</p></blockquote><h2 id="ç½‘ç»œçš„è¡¨ç¤º"><a href="#ç½‘ç»œçš„è¡¨ç¤º" class="headerlink" title="ç½‘ç»œçš„è¡¨ç¤º"></a>ç½‘ç»œçš„è¡¨ç¤º</h2><ol start="0"><li><p>é‚»æ¥çŸ©é˜µ</p><p>ï¼ˆç•¥ï¼Œè¿™ä¸ªæ˜¯æ•°å­¦ï¼Œæˆ‘ä¸æ‡‚ï¼‰</p></li><li><p>æŠŠé“¾è·¯ä½œä¸ºå¼•ç”¨å‚¨å­˜åœ¨ç±»é‡Œï¼ˆè¿å¸¦å…¶ä»–æ•°æ®ï¼‰ï¼š</p></li></ol><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Class Node</span><br><span class="line">String: name</span><br><span class="line">List&lt;Node&gt;: neighbors</span><br><span class="line">List&lt;Integer&gt;: costs</span><br><span class="line">End Node</span><br></pre></td></tr></table></figure><ol start="2"><li>é“¾è·¯å’ŒèŠ‚ç‚¹å•ç‹¬ï¼ˆæ›´å¸¸ç”¨ï¼‰ï¼š</li></ol><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Class Node:</span><br><span class="line">String: name</span><br><span class="line">List&lt;Link&gt;: links</span><br><span class="line">End Node</span><br><span class="line"></span><br><span class="line">Class Link:</span><br><span class="line">Integer: cost</span><br><span class="line">Node: nodes[2]// æ— å‘</span><br><span class="line">/* Node: toNode// æœ‰å‘ */</span><br><span class="line">ENd Link</span><br></pre></td></tr></table></figure><p>æ— å‘ï¼Œé“¾è·¯åŒ…å«ä¸¤ä¸ª Nodeï¼Œé¡ºåºä»»æ„ã€‚</p><p>æœ‰å‘ï¼ŒåªåŒ…å«ä¸€ä¸ª Nodeï¼ŒæŒ‡å‘ç›®æ ‡èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥ç”¨ä¸¤ä¸ªï¼Œä¸€ä¸ªæŒ‡å‘æ¥æºï¼Œå¦ä¸€ä¸ªæŒ‡å‘ç›®æ ‡ã€‚</p><h2 id="ç½‘ç»œçš„éå†"><a href="#ç½‘ç»œçš„éå†" class="headerlink" title="ç½‘ç»œçš„éå†"></a>ç½‘ç»œçš„éå†</h2><h3 id="æ·±åº¦ä¼˜å…ˆ"><a href="#æ·±åº¦ä¼˜å…ˆ" class="headerlink" title="æ·±åº¦ä¼˜å…ˆ"></a>æ·±åº¦ä¼˜å…ˆ</h3><blockquote><p>åœ¨ä¸€æ¬¡æ·±åº¦ä¼˜å…ˆéå†ä¸­ï¼Œç®—æ³•é¦–å…ˆè®¿é—®ä¸€äº›ç¦»åˆå§‹èŠ‚ç‚¹å¾ˆè¿œçš„èŠ‚ç‚¹ï¼Œä¹‹åæ‰æ˜¯ç¦»åˆå§‹èŠ‚ç‚¹è¾ƒè¿‘çš„èŠ‚ç‚¹ã€‚</p></blockquote><p>ç›´æ¥åƒæ ‘ä¸€æ ·éå†ï¼Œåœ¨å›¾ä¸­æ˜¯ä¸è¡Œçš„ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">badTraverse():</span><br><span class="line">&lt;å¤„ç†èŠ‚ç‚¹&gt;</span><br><span class="line">For Each link In links:</span><br><span class="line">link.nodes[1].Traverse()</span><br><span class="line">Next link</span><br><span class="line">End badTraverse</span><br></pre></td></tr></table></figure><p>å¦‚æœå›¾åŒ…å«äº†å›è·¯ï¼Œè¿™ä¸ªç®—æ³•ä¼šæ­»å¾ªç¯ã€‚</p><p>è§£å†³çš„æ–¹æ³•æ˜¯è®©ç®—æ³•çŸ¥é“è‡ªå·±è®¿é—®è¿‡çš„èŠ‚ç‚¹ï¼Œå¯ä»¥ç»™ç±»ä¸­åŠ ä¸€ä¸ª <code>visited</code> å±æ€§æ¥çºªå½•è‡ªå·±æœ‰æ²¡æœ‰è¢«è®¿é—®ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">slowTraverse():</span><br><span class="line">&lt;å¤„ç†èŠ‚ç‚¹&gt;</span><br><span class="line">Self.visited = True</span><br><span class="line"></span><br><span class="line">For Each link In links:</span><br><span class="line">If Not link.nodes[1].visited:</span><br><span class="line">link.nodes[1].Traverse()</span><br><span class="line">End If</span><br><span class="line">Next link</span><br><span class="line">End slowTraverse</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç®—æ³•ç†è®ºä¸Šå¯è¡Œï¼Œä½†æ¶ˆè€—å¤ªå¤§ï¼Œå®¹æ˜“çˆ†æ ˆã€‚</p><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ç”¨æ ˆæ¥æ›¿æ¢é€’å½’ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">depthFirstTraverse(Node: startNode):</span><br><span class="line">// è®¿é—®å½“å‰èŠ‚ç‚¹</span><br><span class="line">startNode.visited = True</span><br><span class="line"></span><br><span class="line">// åˆ›å»ºæ ˆï¼ŒæŠŠåˆå§‹èŠ‚ç‚¹å‹å…¥æ ˆ</span><br><span class="line">Stack&lt;Node&gt;: stack</span><br><span class="line">stack.push(stareNode)</span><br><span class="line"></span><br><span class="line">// å¾ªç¯å¤„ç†ç›´åˆ°æ ˆä¸ºç©º</span><br><span class="line">While Not stack.isEmpty():</span><br><span class="line">Node node = stack.pop()// ä»æ ˆä¸­è·å–ä¸‹ä¸€èŠ‚ç‚¹</span><br><span class="line">// å¾ªç¯å¤„ç†èŠ‚ç‚¹ä¸­çš„é“¾è·¯</span><br><span class="line">For Each link In node.links:</span><br><span class="line">If Not link.nodes[1].visited:</span><br><span class="line">link.nodes[1].visited = True</span><br><span class="line">stack.push(link.node[1])</span><br><span class="line">End If</span><br><span class="line">Next link</span><br><span class="line">Loop// ç»§ç»­å¤„ç†ç›´åˆ°æ ˆä¸ºç©º</span><br><span class="line">End depthFirstTraverse</span><br></pre></td></tr></table></figure><h3 id="å¹¿åº¦ä¼˜å…ˆ"><a href="#å¹¿åº¦ä¼˜å…ˆ" class="headerlink" title="å¹¿åº¦ä¼˜å…ˆ"></a>å¹¿åº¦ä¼˜å…ˆ</h3><blockquote><p>åœ¨ä¸€æ¬¡å¹¿åº¦ä¼˜å…ˆéå†ä¸­ï¼Œç¦»åˆå§‹èŠ‚ç‚¹è¾ƒè¿‘çš„èŠ‚ç‚¹é¦–å…ˆè¢«è®¿é—®ï¼Œç„¶åæ‰æ˜¯ç¦»åˆå§‹èŠ‚ç‚¹è¾ƒè¿œçš„èŠ‚ç‚¹ã€‚</p></blockquote><p>åœ¨<strong>æ·±åº¦ä¼˜å…ˆéå†</strong>ä¸­ï¼Œç”±äºä½¿ç”¨<em>åè¿›å…ˆå‡º</em>çš„æ ˆæ¥å­˜æ”¾èŠ‚ç‚¹ï¼Œæ‰€ä»¥éå†äº†ä¸€äº›ç¦»åˆå§‹èŠ‚ç‚¹è¾ƒè¿œçš„èŠ‚ç‚¹ç„¶åæ‰éå†è¾ƒè¿‘çš„èŠ‚ç‚¹ã€‚</p><p>å¦‚æœä½¿ç”¨<strong>é˜Ÿåˆ—</strong>ï¼ˆ<em>Queues</em>ï¼ŒFIFOï¼‰ä»£æ›¿<strong>æ ˆ</strong>ï¼ˆ<em>Stacks</em>ï¼ŒFILOï¼‰ï¼Œåˆ™èŠ‚ç‚¹ä¼šæŒ‰å…ˆè¿›å…ˆå‡ºçš„é¡ºåºè¢«å¤„ç†ï¼Œç¦»åˆå§‹èŠ‚ç‚¹è¾ƒè¿‘çš„èŠ‚ç‚¹å°±é¦–å…ˆè¢«å¤„ç†äº†ï¼Œå³<strong>å¹¿åº¦ä¼˜å…ˆéå†</strong>ã€‚</p><h3 id="éå†çš„åº”ç”¨"><a href="#éå†çš„åº”ç”¨" class="headerlink" title="éå†çš„åº”ç”¨"></a>éå†çš„åº”ç”¨</h3><h4 id="æ— å‘å›¾è¿é€šæ€§æµ‹è¯•"><a href="#æ— å‘å›¾è¿é€šæ€§æµ‹è¯•" class="headerlink" title="æ— å‘å›¾è¿é€šæ€§æµ‹è¯•"></a>æ— å‘å›¾è¿é€šæ€§æµ‹è¯•</h4><p>å¯¹äºä¸€ä¸ªæ— å‘å›¾ï¼Œå¦‚æœè¿é€šï¼Œä¸€ä¸ªéå†ç®—æ³•ä»åˆè¯†èŠ‚ç‚¹å‡ºå‘ï¼Œå¯è¾¾æ‰€æœ‰èŠ‚ç‚¹ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Boolean: isConnected(Node: startNode):</span><br><span class="line">// ä»åˆè¯†èŠ‚ç‚¹å¼€å§‹éå†ç½‘ç»œ</span><br><span class="line">Traverse(start_node)</span><br><span class="line"></span><br><span class="line">// æŸ¥çœ‹æœ‰æ— æ²¡è¢«è®¿é—®çš„</span><br><span class="line">For Each node In &lt;æ‰€æœ‰èŠ‚ç‚¹&gt;</span><br><span class="line">If Not node.visited: Return False</span><br><span class="line">Next node</span><br><span class="line"></span><br><span class="line">// æ‰€æœ‰èŠ‚ç‚¹éƒ½è®¿é—®è¿‡äº†ï¼Œè¿é€š</span><br><span class="line">Return True</span><br><span class="line">End isConnected</span><br></pre></td></tr></table></figure><h4 id="å¯»æ‰¾æ‰€æœ‰è¿é€šåˆ†é‡"><a href="#å¯»æ‰¾æ‰€æœ‰è¿é€šåˆ†é‡" class="headerlink" title="å¯»æ‰¾æ‰€æœ‰è¿é€šåˆ†é‡"></a>å¯»æ‰¾æ‰€æœ‰è¿é€šåˆ†é‡</h4><p>åˆ©ç”¨æ·±åº¦éå†ï¼Œä¸€ç›´éå†ç›´åˆ°æ‰€æœ‰è¿é€šçš„èŠ‚ç‚¹éƒ½å·²ç»è®¿é—®è¿‡ï¼Œå°±æ‰¾åˆ°äº†æ‰€æœ‰è¿é€šåˆ†é‡ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">List&lt;List&lt;Node&gt;&gt;: getConnectedComponents:</span><br><span class="line">// è·Ÿè¸ªè®°å½•å·²ç»è®¿é—®è¿‡çš„èŠ‚ç‚¹æ•°</span><br><span class="line">Integer: numVisited = 0</span><br><span class="line">// åˆ›å»ºè¿é€šåˆ†é‡åˆ—è¡¨</span><br><span class="line">List&lt;Lidt&lt;Node&gt;&gt;: components</span><br><span class="line"></span><br><span class="line">// å¾ªç¯ç›´åˆ°æ‰€æœ‰èŠ‚ç‚¹éƒ½åœ¨è¿é€šåˆ†é‡ä¸­</span><br><span class="line">While numVisited &lt; èŠ‚ç‚¹ä¸ªæ•°:</span><br><span class="line">// æŸ¥æ‰¾ä¸€ä¸ªè¿˜æœªè®¿é—®è¿‡çš„èŠ‚ç‚¹</span><br><span class="line">Node: startNode = ç¬¬ä¸€ä¸ªæœªè®¿é—®è¿‡çš„èŠ‚ç‚¹</span><br><span class="line"></span><br><span class="line">// å°†åˆå§‹å€¼å‹å…¥æ ˆ</span><br><span class="line">Stack&lt;Node&gt;: stack</span><br><span class="line">stack.push(startNode)</span><br><span class="line">startNode.Visited = True</span><br><span class="line">numVisited += 1</span><br><span class="line"></span><br><span class="line">// å°†èŠ‚ç‚¹æ·»åŠ åˆ°ä¸€ä¸ªæ–°çš„è¿é€šåˆ†é‡ä¸­</span><br><span class="line">List&lt;Node&gt;: component</span><br><span class="line">component.add(startNode)</span><br><span class="line">components.add(component)</span><br><span class="line"></span><br><span class="line">// ä¸æ–­å¤„ç†ï¼Œç›´åˆ°å®ƒä¸ºç©º</span><br><span class="line">While Not stack.isEmpty():</span><br><span class="line">// ä»æ ˆä¸­è·å–ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span><br><span class="line">Node: node = stack.pop()</span><br><span class="line"></span><br><span class="line">// ä¾æ¬¡å¤„ç†è¯¥èŠ‚ç‚¹æ‰€æœ‰å¯¹åº”çš„é“¾è·¯</span><br><span class="line">For Each link In node.links:</span><br><span class="line">If Not link.nodes[1].visited:</span><br><span class="line">link.nodes[1].visited = True</span><br><span class="line">component.add(link.nodes[1])</span><br><span class="line">stack.push(link.nodes[1])</span><br><span class="line">// å°†é“¾è·¯æ ‡è®°ä¸ºæ ‘çš„ä¸€éƒ¨åˆ†ï¼Œç”Ÿæˆæ ‘</span><br><span class="line">link.visited = True</span><br><span class="line">numVisited += 1</span><br><span class="line">End If</span><br><span class="line">Next link</span><br><span class="line">Loop// Not stack.isEmpty()</span><br><span class="line">Loop// numVisited &lt; èŠ‚ç‚¹ä¸ªæ•°</span><br><span class="line"></span><br><span class="line">Return components</span><br><span class="line">End getConnectedComponents</span><br></pre></td></tr></table></figure><h4 id="ç”Ÿæˆæ ‘"><a href="#ç”Ÿæˆæ ‘" class="headerlink" title="ç”Ÿæˆæ ‘"></a>ç”Ÿæˆæ ‘</h4><p>å¦‚æœä¸€ä¸ªæ— å‘å›¾æ˜¯è¿é€šçš„ï¼Œå°±å¯ä»¥ä»¥ä¸€èŠ‚ç‚¹ä¸ºæ ¹å»ºç«‹ä¸€æ£µæ ‘ï¼Œè¡¨ç¤ºæ ¹èŠ‚ç‚¹åˆ°ç½‘ç»œä¸­å…¶ä»–èŠ‚ç‚¹åˆ°è·¯å¾„ã€‚è¿™é¢—æ ‘ç§°ä¸º<strong>ç”Ÿæˆæ ‘</strong>ã€‚</p><p>è¦å®ç°è¿™ä¸€ç‚¹ï¼Œåœ¨å‰é¢çš„ç¨‹åºé‡Œæ ‡è®°æ–°èŠ‚ç‚¹è¢«è®¿é—®åï¼Œå°†é“¾è·¯æ ‡è®°ä¸ºæ ‘çš„ä¸€éƒ¨åˆ†ï¼Œå°±è¡Œäº†ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">link.visited = True</span><br></pre></td></tr></table></figure><h5 id="æœ€å°ç”Ÿæˆæ ‘"><a href="#æœ€å°ç”Ÿæˆæ ‘" class="headerlink" title="æœ€å°ç”Ÿæˆæ ‘"></a>æœ€å°ç”Ÿæˆæ ‘</h5><p>å…·æœ‰æœ€å°‘å¯èƒ½ä»£ä»·çš„ç”Ÿæˆæ ‘ç§°ä¸º<strong>æœ€å°ç”Ÿæˆæ ‘</strong>ã€‚</p><p>è¦å¾—åˆ°ä¸€é¢—ç”Ÿæˆæ ‘ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹è´ªå¿ƒç­–ç•¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. æ·»åŠ æ ¹èŠ‚ç‚¹Rä»¥åˆå§‹åŒ–ç”Ÿæˆæ ‘</span><br><span class="line">2. å¯¹æ¯ä¸ªèŠ‚ç‚¹é‡å¤ç›´åˆ°å¾—åˆ°ç”Ÿæˆæ ‘ï¼š</span><br><span class="line">a. å‘ç°åœ¨ç”Ÿæˆæ ‘ä¸­èŠ‚ç‚¹åˆ°æœªåœ¨æ ‘ä¸­èŠ‚ç‚¹åˆ°æœ€å°ä»£ä»·é“¾æ¥</span><br><span class="line">b. å°†è¯¥é“¾æ¥åˆ°ç›®æ ‡èŠ‚ç‚¹æ·»åŠ åˆ°ç”Ÿæˆæ ‘</span><br></pre></td></tr></table></figure><h2 id="Pythonå®ç°"><a href="#Pythonå®ç°" class="headerlink" title="Pythonå®ç°"></a>Pythonå®ç°</h2><p>æ–‡ä¸­æ¶‰åŠçš„ä»£ç è¿˜æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œæˆ‘å†™äº†å…¶ä¸­ä¸€äº›çš„ Python å®ç°ï¼Œæ”¾åˆ°äº† GitHubï¼š</p><ul><li><a href="https://github.com/cdfmlr/Graph_Python">https://github.com/cdfmlr/Graph_Python</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Algorithm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java-IO</title>
      <link href="/2019/04/25/Java_intro/Day14_Java_IO/"/>
      <url>/2019/04/25/Java_intro/Day14_Java_IO/</url>
      
        <content type="html"><![CDATA[<h1 id="Java-I-O"><a href="#Java-I-O" class="headerlink" title="Java I/O"></a>Java I/O</h1><h2 id="å¤„ç†å¤–éƒ¨æ•°æ®"><a href="#å¤„ç†å¤–éƒ¨æ•°æ®" class="headerlink" title="å¤„ç†å¤–éƒ¨æ•°æ®"></a>å¤„ç†å¤–éƒ¨æ•°æ®</h2><p>åœ¨ Java ç¨‹åºä¸­ä½¿ç”¨çš„æ•°æ®é€šå¸¸æ¥è‡ªå¤–éƒ¨æ•°æ®æ¥æºï¼Œæ¯”å¦‚æ•°æ®åº“ã€é€šè¿‡å¥—æ¥å­—ç›´æ¥ä¼ è¾“çš„å­—èŠ‚æˆ–æ–‡ä»¶å­˜å‚¨ã€‚å¤§éƒ¨åˆ†æ”¶é›†å’Œå¤„ç†å¤–éƒ¨æ•°æ®çš„ Java å·¥å…·éƒ½åŒ…å«åœ¨ <code>java.io</code> åŒ…ä¸­ã€‚</p><h2 id="æ–‡ä»¶"><a href="#æ–‡ä»¶" class="headerlink" title="æ–‡ä»¶"></a>æ–‡ä»¶</h2><p>åœ¨æ‰€æœ‰å¯ç”¨äº Java åº”ç”¨ç¨‹åºçš„æ•°æ®æ¥æºä¸­ï¼Œæ–‡ä»¶æ˜¯æœ€å¸¸è§çš„ï¼Œé€šå¸¸ä¹Ÿæ˜¯æœ€æ–¹ä¾¿çš„ã€‚å¦‚æœæƒ³åœ¨ Java åº”ç”¨ç¨‹åºä¸­è¯»å–æŸä¸ªæ–‡ä»¶ï¼Œå¿…é¡»ä½¿ç”¨å°†å®ƒçš„ä¼ å…¥å­—èŠ‚è§£æä¸º Java è¯­è¨€ç±»å‹çš„<em>æµ</em>ã€‚</p><p><code>java.io.File</code> æ˜¯ä¸€ä¸ªåœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šå®šä¹‰èµ„æºå¹¶ä»¥æŸç§æŠ½è±¡æ–¹å¼è¡¨ç¤ºè¯¥èµ„æºçš„ç±»ã€‚åˆ›å»º <code>File</code> å¯¹è±¡å¾ˆå®¹æ˜“ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">File f = <span class="keyword">new</span> File(<span class="string">&quot;temp.txt&quot;</span>);</span><br><span class="line">File f2 = <span class="keyword">new</span> File(<span class="string">&quot;/home/steve/testFile.txt&quot;</span>);</span><br></pre></td></tr></table></figure><p><code>File</code> æ„é€ æ–¹æ³•æ¥å—å®ƒåˆ›å»ºçš„æ–‡ä»¶çš„è·¯å¾„ã€‚</p><p>å¯ä»¥å°†ä»»ä½• <code>String</code> ä¼ é€’åˆ° <code>File</code> çš„æ„é€ æ–¹æ³•ï¼Œåªè¦å®ƒæ˜¯æ“ä½œç³»ç»Ÿä¸­çš„æœ‰æ•ˆè·¯å¾„ï¼Œæ— è®ºå®ƒå¼•ç”¨çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚</p><p>é€šå¸¸ï¼Œæˆ‘ä»¬éƒ½éœ€è¦å‘æ–°åˆ›å»ºçš„ <code>File</code> å¯¹è±¡è¯¢é—®è¯¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">File f2 = <span class="keyword">new</span> File(<span class="string">&quot;/home/steve/testFile.txt&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (f2.exists()) &#123;</span><br><span class="line">  <span class="comment">// File exists. Process it...</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// File doesn&#x27;t exist. Create it...</span></span><br><span class="line">  f2.createNewFile();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–‡ä»¶æ“ä½œ"><a href="#æ–‡ä»¶æ“ä½œ" class="headerlink" title="æ–‡ä»¶æ“ä½œ"></a>æ–‡ä»¶æ“ä½œ</h3><p>åˆ©ç”¨ <code>java.io.File</code>ï¼Œé€šè¿‡ File å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥æ“ä½œæ–‡ä»¶ï¼š</p><ul><li>æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼š<code>FileObject.exists()</code></li><li>åˆ›å»ºæ–‡ä»¶ï¼š<code>FileObject.createNewFile()</code></li><li>åˆ é™¤æ–‡ä»¶ï¼š<code>FileObject.delete</code></li></ul><p>è¿˜æœ‰å¾ˆå¤šæ“ä½œï¼Œè¯¦è§ <a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/io/File.html">JDK æ–‡æ¡£</a>ã€‚</p><h2 id="åœ¨-Java-I-O-ä¸­ä½¿ç”¨æµ"><a href="#åœ¨-Java-I-O-ä¸­ä½¿ç”¨æµ" class="headerlink" title="åœ¨ Java I/O ä¸­ä½¿ç”¨æµ"></a>åœ¨ Java I/O ä¸­ä½¿ç”¨æµ</h2><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æµæ¥è®¿é—®æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ã€‚</p><p>æµå…è®¸ç¨‹åºä»æ¥æºæ¥æ”¶å­—èŠ‚æˆ–å°†è¾“å‡ºå‘é€åˆ°ç›®æ ‡ã€‚</p><p>åœ¨ <code>java.io</code> åŒ…ä¸­åŒ…å«å¤šç§é£æ ¼çš„æµï¼Œä¸€äº›æµå¯ä»¥å¤„ç†æ‰€æœ‰ç±»å‹çš„ 16 ä½å­—ç¬¦ï¼ˆ<code>Reader</code> å’Œ <code>Writer</code> ç±»å‹ï¼‰ã€‚å…¶ä»–æµä»…èƒ½å¤„ç† 8 ä½å­—èŠ‚ï¼ˆ<code>InputStream</code> å’Œ <code>OutputStream</code> ç±»å‹ï¼‰ã€‚</p><h3 id="Java-IO-æµ"><a href="#Java-IO-æµ" class="headerlink" title="Java IO æµ"></a>Java IO æµ</h3><p><img src="http://ww4.sinaimg.cn/large/006y8mN6gy1g673prk0haj30j30l7t9y.jpg" alt="iostream2xx"></p><h4 id="å­—èŠ‚æµ"><a href="#å­—èŠ‚æµ" class="headerlink" title="å­—èŠ‚æµ"></a>å­—èŠ‚æµ</h4><p><strong>å­—èŠ‚æµ</strong>è¯»ï¼ˆ<code>InputStream</code> å’Œå­ç±»ï¼‰å’Œå†™ï¼ˆ<code>OutputStream</code> å’Œå­ç±»ï¼‰8 ä½å­—èŠ‚ã€‚æ¢å¥è¯è¯´ï¼Œå¯ä»¥å°†å­—èŠ‚æµè§†ä¸ºä¸€ç§æ›´åŠ åŸå§‹çš„æµç±»å‹ã€‚ä¸‹é¢æ€»ç»“äº†ä¸¤ç§å¸¸è§çš„å­—èŠ‚æµå’Œå®ƒä»¬çš„ç”¨æ³•ï¼š</p><ul><li><code>FileInputStream</code> / <code>FileOutputStream</code>ï¼šä»æ–‡ä»¶è¯»å–å­—èŠ‚ï¼Œå°†å­—èŠ‚å†™å…¥æ–‡ä»¶ </li><li><code>ByteArrayInputStream</code> / <code>ByteArrayOutputStream</code>ï¼šä»å†…å­˜å‹ä¸­çš„æ•°ç»„è¯»å–å­—èŠ‚ï¼Œå°†å­—èŠ‚å†™å…¥å†…å­˜ä¸­çš„æ•°ç»„</li></ul><h4 id="å­—ç¬¦æµ"><a href="#å­—ç¬¦æµ" class="headerlink" title="å­—ç¬¦æµ"></a>å­—ç¬¦æµ</h4><p><strong>å­—ç¬¦æµ</strong>è¯»ï¼ˆ<code>Reader</code> å’Œå®ƒçš„å­ç±»ï¼‰å’Œå†™ï¼ˆ<code>Writer</code> å’Œå®ƒçš„å­ç±»ï¼‰16 ä½å­—ç¬¦ã€‚ä¸‹é¢æŒ‘é€‰äº†ä¸€äº›å­—ç¬¦æµå’Œå®ƒä»¬çš„ç”¨æ³•ï¼š</p><ul><li><code>StringReader</code> / <code>StringWriter</code>ï¼šåœ¨å†…å­˜ä¸­çš„ <code>String</code> ä¸­è¯»å–å’Œå†™å…¥å­—ç¬¦ã€‚ </li><li><code>InputStreamReader</code> / <code>InputStreamWriter</code>ï¼ˆå’Œå­ç±»<code>FileReader</code> / <code>FileWriter</code>ï¼‰ï¼šå……å½“å­—èŠ‚æµå’Œå­—ç¬¦æµä¹‹é—´çš„æ¡¥æ¢ã€‚<code>Reader</code> ä»å­—èŠ‚æµè¯»å–å­—èŠ‚å¹¶è½¬æ¢ä¸ºå­—ç¬¦ã€‚<code>Writer</code> å°†å­—ç¬¦è½¬æ¢ä¸ºå­—èŠ‚ï¼Œä»¥ä¾¿å°†å®ƒä»¬æ”¾åœ¨å­—èŠ‚æµä¸Šã€‚ </li><li><code>BufferedReader</code> / <code>BufferedWriter</code>ï¼šåœ¨è¯»å–æˆ–å†™å…¥å¦ä¸€ä¸ªæµæ—¶ç¼“å†²æ•°æ®ï¼Œä½¿è¯»å†™æ“ä½œæ›´é«˜æ•ˆã€‚</li></ul><h3 id="è¯»å–æ§åˆ¶å°è¾“å…¥"><a href="#è¯»å–æ§åˆ¶å°è¾“å…¥" class="headerlink" title="è¯»å–æ§åˆ¶å°è¾“å…¥"></a>è¯»å–æ§åˆ¶å°è¾“å…¥</h3><p>Java çš„æ§åˆ¶å°è¾“å…¥ç”± <code>System.in</code> å®Œæˆã€‚</p><p>ä¸ºäº†è·å¾—ä¸€ä¸ªç»‘å®šåˆ°æ§åˆ¶å°çš„å­—ç¬¦æµï¼Œæˆ‘ä»¬æŠŠ <code>System.in</code> åŒ…è£…åœ¨ä¸€ä¸ª <code>BufferedReader</code> å¯¹è±¡ä¸­æ¥åˆ›å»ºä¸€ä¸ªå­—ç¬¦æµï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> </span><br><span class="line">                     InputStreamReader(System.in));</span><br></pre></td></tr></table></figure><p>BufferedReader å¯¹è±¡åˆ›å»ºåï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ä½¿ç”¨ <code>read()</code> æ–¹æ³•ä»æ§åˆ¶å°è¯»å–ä¸€ä¸ªå­—ç¬¦ï¼Œæˆ–è€…ç”¨ <code>readLine()</code> æ–¹æ³•è¯»å–ä¸€ä¸ªå­—ç¬¦ä¸²ï¼š</p><ul><li><code>int read() throws IOException</code> ï¼šè°ƒç”¨ read() æ–¹æ³•ï¼Œå®ƒä»è¾“å…¥æµè¯»å–ä¸€ä¸ªå­—ç¬¦å¹¶æŠŠè¯¥å­—ç¬¦ä½œä¸ºæ•´æ•°å€¼è¿”å›ã€‚ å½“æµç»“æŸçš„æ—¶å€™è¿”å› -1ã€‚è¯¥æ–¹æ³•æŠ›å‡º IOExceptionã€‚</li><li><code>String readLine() throws IOException</code> ï¼šä¸ read() ç±»å‹ï¼Œä½†è¯»å–ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</li></ul><p>å®ä¾‹ï¼ˆè¯»å–å­—ç¬¦ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ BufferedReader åœ¨æ§åˆ¶å°è¯»å–å­—ç¬¦</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">chrRead</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  <span class="comment">// ç”¨ System.in åˆ›å»º BufferedReader</span></span><br><span class="line">  BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(System.in));</span><br><span class="line">  System.out.println(<span class="string">&quot;è¾“å…¥å­—ç¬¦ï¼Œåˆ°&#x27;q&#x27;é€€å‡ºï¼š&quot;</span>);</span><br><span class="line">  <span class="comment">// è¯»å–å­—ç¬¦</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">char</span> character = <span class="string">&#x27;\0&#x27;</span>; character != <span class="string">&#x27;q&#x27;</span>; ) &#123;</span><br><span class="line">    character = (<span class="keyword">char</span>) br.read();</span><br><span class="line">    System.out.println(character);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><del>ğŸ˜‚æœ‰æ„æ€çš„æ˜¯ï¼Œ</del>è¿™å¯¹ä»£ç çš„ä½œç”¨å’Œä¸‹é¢è¿™ <strong>ä¸€è¡Œ</strong>Pythonä»£ç æ˜¯ä¸€æ ·çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">&#x27;\n&#x27;</span>.join([c <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">input</span>(<span class="string">&quot;è¾“å…¥å­—ç¬¦ï¼Œåˆ°\&#x27;q\&#x27;é€€å‡ºï¼š\n&quot;</span>).split(<span class="string">&#x27;q&#x27;</span>)[<span class="number">0</span>] + <span class="string">&#x27;q&#x27;</span>]))</span><br></pre></td></tr></table></figure><p>å®ä¾‹ï¼ˆè¯»å–å­—ç¬¦ä¸²ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ BufferedReader åœ¨æ§åˆ¶å°è¯»å–å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">strRead</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(System.in));</span><br><span class="line">  System.out.println(<span class="string">&quot;Please enter lines of text, &#x27;end&#x27; to quit: &quot;</span>);</span><br><span class="line">  <span class="comment">// è¯»å–å­—ç¬¦ä¸²</span></span><br><span class="line">  <span class="keyword">for</span> (String line = <span class="string">&quot;\0&quot;</span>; !line.equals(<span class="string">&quot;end&quot;</span>); ) &#123;</span><br><span class="line">    line = (String) br.readLine();</span><br><span class="line">    System.out.println(line);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="scanner"><a href="#scanner" class="headerlink" title="scanner"></a>scanner</h4><p>å…¶å®ï¼Œæ›´å®¹æ˜“åœ°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ <code>java.util.Scanner</code> ç±»æ¥è·å–ç”¨æˆ·çš„è¾“å…¥ã€‚</p><h5 id="åˆ›å»º-scanner"><a href="#åˆ›å»º-scanner" class="headerlink" title="åˆ›å»º scanner"></a>åˆ›å»º scanner</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Scanner s = <span class="keyword">new</span> Scanner(System.in);</span><br></pre></td></tr></table></figure><h5 id="ä½¿ç”¨-scanner"><a href="#ä½¿ç”¨-scanner" class="headerlink" title="ä½¿ç”¨ scanner"></a>ä½¿ç”¨ scanner</h5><p>é€šè¿‡ä½¿ç”¨ <code>Scanner</code> ç±»çš„ <code>next()</code> ä¸ <code>nextLine()</code> æ–¹æ³•è·å–è¾“å…¥çš„å­—ç¬¦ä¸²ï¼Œåœ¨è¯»å–å‰æˆ‘ä»¬ä¸€èˆ¬éœ€è¦ ä½¿ç”¨ <code>hasNext</code> ä¸ <code>hasNextLine</code> åˆ¤æ–­æ˜¯å¦è¿˜æœ‰è¾“å…¥çš„æ•°æ®:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mine.java.tour;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TryScanner</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">Scanner scan = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">System.out.println(&quot;Please enter something:&quot;);</span></span><br><span class="line"><span class="comment">for (String read = &quot;\0&quot;; scan.hasNext(); ) &#123;</span></span><br><span class="line"><span class="comment">read = scan.next();</span></span><br><span class="line"><span class="comment">System.out.println(read);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">System.out.println(<span class="string">&quot;Please enter some lines:&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (String read = <span class="string">&quot;\0&quot;</span>; scan.hasNextLine(); ) &#123;</span><br><span class="line">read = scan.nextLine();</span><br><span class="line">System.out.println(read);</span><br><span class="line">&#125;</span><br><span class="line">scan.close();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="next-ä¸-nextLine-åŒºåˆ«"><a href="#next-ä¸-nextLine-åŒºåˆ«" class="headerlink" title="next() ä¸ nextLine() åŒºåˆ«"></a>next() ä¸ nextLine() åŒºåˆ«</h6><ul><li><p><code>next()</code>:</p><ol><li>ä¸€å®šè¦è¯»å–åˆ°æœ‰æ•ˆå­—ç¬¦åæ‰å¯ä»¥ç»“æŸè¾“å…¥ã€‚</li><li>å¯¹è¾“å…¥æœ‰æ•ˆå­—ç¬¦ä¹‹å‰é‡åˆ°çš„ç©ºç™½ï¼Œnext() æ–¹æ³•ä¼šè‡ªåŠ¨å°†å…¶å»æ‰ã€‚</li><li>åªæœ‰è¾“å…¥æœ‰æ•ˆå­—ç¬¦åæ‰å°†å…¶åé¢è¾“å…¥çš„ç©ºç™½ä½œä¸ºåˆ†éš”ç¬¦æˆ–è€…ç»“æŸç¬¦ã€‚ </li><li>next() ä¸èƒ½å¾—åˆ°å¸¦æœ‰ç©ºæ ¼çš„å­—ç¬¦ä¸²ã€‚</li></ol></li><li><p><code>nextLine()</code>ï¼š </p><ol><li>ä»¥Enterä¸ºç»“æŸç¬¦,ä¹Ÿå°±æ˜¯è¯´ nextLine()æ–¹æ³•è¿”å›çš„æ˜¯è¾“å…¥å›è½¦ä¹‹å‰çš„æ‰€æœ‰å­—ç¬¦ã€‚ </li><li>å¯ä»¥è·å¾—ç©ºç™½ã€‚</li></ol></li></ul><p>å¦å¤–ï¼Œå¦‚æœè¦è¾“å…¥ <code>int</code> æˆ– <code>float</code> ç±»å‹çš„æ•°æ®ï¼Œåœ¨ <code>Scanner</code> ç±»ä¸­ä¹Ÿæœ‰æ”¯æŒï¼Œä½†æ˜¯åœ¨è¾“å…¥ä¹‹å‰æœ€å¥½å…ˆä½¿ç”¨ <code>hasNextXxx()</code> æ–¹æ³•è¿›è¡ŒéªŒè¯ï¼Œå†ä½¿ç”¨ <code>nextXxx()</code> æ¥è¯»å–ã€‚</p><h3 id="æ–‡ä»¶è¯»å†™"><a href="#æ–‡ä»¶è¯»å†™" class="headerlink" title="æ–‡ä»¶è¯»å†™"></a>æ–‡ä»¶è¯»å†™</h3><h4 id="FileInputStream"><a href="#FileInputStream" class="headerlink" title="FileInputStream"></a>FileInputStream</h4><p><code>FileInputStream</code> ç”¨äºä»æ–‡ä»¶è¯»å–æ•°æ®ã€‚</p><p>å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²ç±»å‹çš„æ–‡ä»¶åæ¥åˆ›å»ºä¸€ä¸ªè¾“å…¥æµå¯¹è±¡æ¥è¯»å–æ–‡ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">InputStream f = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;/home/steve/testFile.txt&quot;</span>);</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶å¯¹è±¡æ¥åˆ›å»ºä¸€ä¸ªè¾“å…¥æµå¯¹è±¡æ¥è¯»å–æ–‡ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">File f = <span class="keyword">new</span> File(<span class="string">&quot;/home/steve/testFile.txt&quot;</span>);</span><br><span class="line">InputStream out = <span class="keyword">new</span> FileInputStream(f);</span><br></pre></td></tr></table></figure><h5 id="æ“ä½œ"><a href="#æ“ä½œ" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h5><table><thead><tr><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>public void close() throws IOException</code></td><td>å…³é—­æ­¤æ–‡ä»¶è¾“å…¥æµå¹¶é‡Šæ”¾ä¸æ­¤æµæœ‰å…³çš„æ‰€æœ‰ç³»ç»Ÿèµ„æºã€‚</td></tr><tr><td><code>protected void finalize()throws IOException</code></td><td>è¿™ä¸ªæ–¹æ³•æ¸…é™¤ä¸è¯¥æ–‡ä»¶çš„è¿æ¥ã€‚ç¡®ä¿åœ¨ä¸å†å¼•ç”¨æ–‡ä»¶è¾“å…¥æµæ—¶è°ƒç”¨å…¶ close æ–¹æ³•ã€‚</td></tr><tr><td><code>public int read(int r)throws IOException</code></td><td>ä» InputStream å¯¹è±¡è¯»å–æŒ‡å®šå­—èŠ‚çš„æ•°æ®ã€‚è¿”å›ä¸ºæ•´æ•°å€¼ã€‚è¿”å›ä¸‹ä¸€å­—èŠ‚æ•°æ®ï¼Œå¦‚æœå·²ç»åˆ°ç»“å°¾åˆ™è¿”å›-1ã€‚</td></tr><tr><td><code>public int read(byte[] r) throws IOException</code></td><td>ä»è¾“å…¥æµè¯»å–r.lengthé•¿åº¦çš„å­—èŠ‚ã€‚è¿”å›è¯»å–çš„å­—èŠ‚æ•°ã€‚å¦‚æœæ˜¯æ–‡ä»¶ç»“å°¾åˆ™è¿”å›-1ã€‚</td></tr><tr><td><code>public int available() throws IOException</code></td><td>è¿”å›ä¸‹ä¸€æ¬¡å¯¹æ­¤è¾“å…¥æµè°ƒç”¨çš„æ–¹æ³•å¯ä»¥ä¸å—é˜»å¡åœ°ä»æ­¤è¾“å…¥æµè¯»å–çš„å­—èŠ‚æ•°ã€‚è¿”å›ä¸€ä¸ªæ•´æ•°å€¼ã€‚</td></tr></tbody></table><h4 id="FileOutputStream"><a href="#FileOutputStream" class="headerlink" title="FileOutputStream"></a>FileOutputStream</h4><p>åŒæ ·å¯ä»¥ç”¨è·¯å¾„å­—ç¬¦ä¸²å’Œæ–‡ä»¶å¯¹è±¡æ¥æ„é€ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OutputStream f = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;/home/steve/testFile.txt&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">File f = <span class="keyword">new</span> File(<span class="string">&quot;/home/steve/testFile.txt&quot;</span>);</span><br><span class="line">OutputStream f = <span class="keyword">new</span> FileOutputStream(f);</span><br></pre></td></tr></table></figure><h5 id="æ“ä½œ-1"><a href="#æ“ä½œ-1" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h5><table><thead><tr><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>public void close() throws IOException</code></td><td>å…³é—­æ­¤æ–‡ä»¶è¾“å…¥æµå¹¶é‡Šæ”¾ä¸æ­¤æµæœ‰å…³çš„æ‰€æœ‰ç³»ç»Ÿèµ„æºã€‚</td></tr><tr><td><code>protected void finalize()throws IOException</code></td><td>è¿™ä¸ªæ–¹æ³•æ¸…é™¤ä¸è¯¥æ–‡ä»¶çš„è¿æ¥ã€‚ç¡®ä¿åœ¨ä¸å†å¼•ç”¨æ–‡ä»¶è¾“å…¥æµæ—¶è°ƒç”¨å…¶ close æ–¹æ³•ã€‚</td></tr><tr><td><code>public void write(int w)throws IOException</code></td><td>æŠŠæŒ‡å®šçš„å­—èŠ‚å†™åˆ°è¾“å‡ºæµä¸­ã€‚</td></tr><tr><td><code>public void write(byte[] w)</code></td><td>æŠŠæŒ‡å®šæ•°ç»„ä¸­w.lengthé•¿åº¦çš„å­—èŠ‚å†™åˆ°OutputStreamä¸­ã€‚</td></tr></tbody></table><h4 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mine.java.tour;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileStream</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Logger l = Logger.getLogger(<span class="string">&quot;Test&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡ byte ä»¥äºŒè¿›åˆ¶çš„å½¢å¼è¯»å†™æ–‡ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ioByByte</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">l.info(<span class="string">&quot;é€šè¿‡ byte ä»¥äºŒè¿›åˆ¶çš„å½¢å¼è¯»å†™æ–‡ä»¶:&quot;</span>);</span><br><span class="line"><span class="keyword">try</span> (</span><br><span class="line">OutputStream ostream = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;test.txt&quot;</span>);</span><br><span class="line">InputStream istream = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;test.txt&quot;</span>);</span><br><span class="line">) &#123;</span><br><span class="line"><span class="comment">// å†™å…¥æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">byte</span> toBeWritten[] = &#123;<span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0x46</span>, <span class="number">0x4d</span>, <span class="number">0x4c</span>, <span class="number">0x52</span>&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i : toBeWritten) &#123;</span><br><span class="line">ostream.write(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä»æ–‡ä»¶ä¸­è¯»å–</span></span><br><span class="line"><span class="keyword">int</span> fileSize = istream.available();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; fileSize; i++) &#123;</span><br><span class="line">System.out.print((<span class="keyword">char</span>)istream.read());</span><br><span class="line">&#125;</span><br><span class="line">System.out.print(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">l.severe(<span class="string">&quot;IOException: &quot;</span> + e);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¯»å†™ä¸­æ–‡(Unicode)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ioUnicode</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">l.info(<span class="string">&quot;è¯»å†™ä¸­æ–‡(Unicode):&quot;</span>);</span><br><span class="line">File fileForIO = <span class="keyword">new</span> File(<span class="string">&quot;æµ‹è¯•.txt&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (!fileForIO.exists()) &#123;</span><br><span class="line">fileForIO.createNewFile();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å†™</span></span><br><span class="line">OutputStream ostream = <span class="keyword">new</span> FileOutputStream(fileForIO);</span><br><span class="line">OutputStreamWriter writer = <span class="keyword">new</span> OutputStreamWriter(ostream, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">writer.append(<span class="string">&quot;ä¸­æ–‡&quot;</span>);</span><br><span class="line">writer.append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">writer.append(<span class="string">&quot;English&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">l.severe(<span class="string">&quot;Fail to write: &quot;</span> + e);</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (writer != <span class="keyword">null</span>) writer.close();</span><br><span class="line"><span class="keyword">if</span> (ostream != <span class="keyword">null</span>) ostream.close();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¯»</span></span><br><span class="line">InputStream istream = <span class="keyword">new</span> FileInputStream(fileForIO);</span><br><span class="line">InputStreamReader reader = <span class="keyword">new</span> InputStreamReader(istream, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line"><span class="keyword">while</span> (reader.ready()) &#123;</span><br><span class="line">sb.append((<span class="keyword">char</span>)reader.read());</span><br><span class="line">&#125;</span><br><span class="line">String result = sb.toString();</span><br><span class="line">System.out.println(result);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">l.severe(<span class="string">&quot;Fail to read: &quot;</span> + e);</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (reader != <span class="keyword">null</span>) reader.close();</span><br><span class="line"><span class="keyword">if</span> (istream != <span class="keyword">null</span>) istream.close();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">ioByByte();</span><br><span class="line">ioUnicode();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œè¿™ä¸ªç¨‹åºï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">5æœˆ 03, 2019 8:31:07 ä¸‹åˆ mine.java.tour.FileStream ioByByte</span><br><span class="line">ä¿¡æ¯: é€šè¿‡ byte ä»¥äºŒè¿›åˆ¶çš„å½¢å¼è¯»å†™æ–‡ä»¶:</span><br><span class="line">CDFMLR</span><br><span class="line">5æœˆ 03, 2019 8:31:08 ä¸‹åˆ mine.java.tour.FileStream ioUnicode</span><br><span class="line">ä¿¡æ¯: è¯»å†™ä¸­æ–‡(Unicode):</span><br><span class="line">ä¸­æ–‡</span><br><span class="line">English</span><br></pre></td></tr></table></figure><p><del>ğŸ˜‚è®½åˆºçš„æ˜¯ï¼Œ</del>å®ƒçš„ä½œç”¨å’Œä¸‹é¢è¿™æ®µ Python ä»£ç å·®ä¸å¤šï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;Test.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">&quot;CDFMLR&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;Test.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    print(f.read())</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;æµ‹è¯•.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;UTF-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">&quot;ä¸­æ–‡\nEnglish&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;æµ‹è¯•.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;UTF-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    print(f.read())</span><br></pre></td></tr></table></figure><hr><p>ç›¸å…³ä»£ç ï¼š</p><p><a href="./src/SystemIn.java">SystemIn.java</a></p><p><a href="./src/FileStream.java">FileStream.java</a></p><p><a href="./src/TryScanner.java">TryScanner.java</a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java-æ¥å£</title>
      <link href="/2019/04/24/Java_intro/Day13_Java_Interface/"/>
      <url>/2019/04/24/Java_intro/Day13_Java_Interface/</url>
      
        <content type="html"><![CDATA[<h1 id="Java-æ¥å£"><a href="#Java-æ¥å£" class="headerlink" title="Java æ¥å£"></a>Java æ¥å£</h1><p>æ ¹æ®è®¾è®¡ï¼ŒæŠ½è±¡æ–¹æ³•æŒ‡å®šä¸€ä¸ª<em>å¥‘çº¦</em>ï¼ˆé€šè¿‡æ–¹æ³•åã€å‚æ•°å’Œè¿”å›ç±»å‹ï¼‰ä½†æœªæä¾›å¯é‡ç”¨çš„ä»£ç ã€‚å½“åœ¨æŠ½è±¡ç±»çš„ä¸€ä¸ªå­ç±»ä¸­å®ç°è¡Œä¸ºçš„æ–¹å¼ä¸å¦ä¸€ä¸ªå­ç±»ä¸­ä¸åŒæ—¶ï¼ŒæŠ½è±¡æ–¹æ³•ï¼ˆåœ¨æŠ½è±¡ç±»ä¸Šå®šä¹‰ï¼‰å°±ä¼šå¾ˆæœ‰ç”¨ã€‚</p><p>å½“åœ¨åº”ç”¨ç¨‹åºä¸­éœ€è¦ä¸€ç»„å¯åˆ†ç»„åˆ°ä¸€èµ·çš„å¸¸è§è¡Œä¸ºï¼ˆä¾‹å¦‚ <code>java.util.List</code>ï¼‰ï¼Œä½†å®ƒä»¬å­˜åœ¨ä¸¤ä¸ªæˆ–å¤šä¸ªå®ç°æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨<em>æ¥å£</em> å®šä¹‰è¯¥è¡Œä¸ºã€‚</p><p><strong>æ¥å£</strong> åƒæ˜¯<strong>ä»…</strong>åŒ…å«æŠ½è±¡æ–¹æ³•çš„æŠ½è±¡ç±»ï¼›å®ƒä»¬<strong>ä»…</strong>å®šä¹‰å¥‘çº¦ï¼Œè€Œä¸å®šä¹‰å®ç°ã€‚</p><h2 id="å®šä¹‰æ¥å£"><a href="#å®šä¹‰æ¥å£" class="headerlink" title="å®šä¹‰æ¥å£"></a>å®šä¹‰æ¥å£</h2><p>æ¥å£å£°æ˜çœ‹èµ·æ¥åƒç±»å£°æ˜ï¼Œä½†ä½¿ç”¨äº† <code>interface</code> å…³é”®å­—ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">InterfaceName</span> </span>&#123;</span><br><span class="line">    <span class="function">returnType <span class="title">methodName</span><span class="params">(argumentList)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•æ²¡æœ‰æ–¹æ³•ä¸»ä½“ã€‚æ¥å£çš„å®ç°è€…è´Ÿè´£æä¾›æ–¹æ³•ä¸»ä½“ï¼ˆä¸æŠ½è±¡æ–¹æ³•ä¸€æ ·ï¼‰ã€‚</p><h2 id="å®ç°æ¥å£"><a href="#å®ç°æ¥å£" class="headerlink" title="å®ç°æ¥å£"></a>å®ç°æ¥å£</h2><p>è¦åœ¨ç±»ä¸Šå®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œåˆ™éœ€è¦<em>å®ç°</em> è¯¥æ¥å£ï¼Œè¿™æ„å‘³ç€æä¾›ä¸€ä¸ªæ–¹æ³•ä¸»ä½“æ¥è¿›ä¸€æ­¥æä¾›å±¥è¡Œæ¥å£å¥‘çº¦çš„è¡Œä¸ºã€‚</p><p>å¯ä»¥ä½¿ç”¨ <code>implements</code> å…³é”®å­—å®ç°æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Manager</span> <span class="keyword">extends</span> <span class="title">Employee</span> <span class="keyword">implements</span> <span class="title">BonusEligible</span>, <span class="title">StockOptionRecipient</span> </span>&#123;</span><br><span class="line">  <span class="comment">// And so on</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>implements</code> æ“ä½œç±»ä¼¼ ç»§æ‰¿ç”¨çš„ extendsï¼Œæ¥å£æ˜¯ä½¿ç”¨ <code>implements</code> å…³é”®å­—ï¼ŒäºŒè€…ä¸åŒçš„æ˜¯ï¼Œæ¥å£å¯ä»¥æœ‰å¥½å¤šä¸ªï¼Œä½†ç»§æ‰¿åªèƒ½æœ‰ä¸€ä¸ªã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬è¦åœ¨ implements äº†æ¥å£çš„ç±»é‡Œå®ç°è¯¥æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Manager</span> <span class="keyword">extends</span> <span class="title">Employee</span> <span class="keyword">implements</span> <span class="title">StockOptionRecipient</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Manager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processStockOptions</span> <span class="params">(<span class="keyword">int</span> numberOfOptions, BigDecimal price)</span> </span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;I can&#x27;t believe I got &quot;</span> + number + <span class="string">&quot; options at $&quot;</span> +</span><br><span class="line">    price.toPlainString() + <span class="string">&quot;!&quot;</span>); </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°è¯¥æ¥å£æ—¶ï¼Œéœ€è¦æä¾›è¯¥æ¥å£ä¸Šçš„ä¸€ä¸ªæˆ–å¤šä¸ªæ–¹æ³•çš„è¡Œä¸ºã€‚æ³¨æ„å®ç°çš„æ–¹æ³•å¿…é¡»ä¸æ¥å£ä¸­çš„åŒ¹é…ï¼ˆåç§°ã€å‚æ•°ã€è¿”å›å€¼ï¼‰ï¼Œè¿˜éœ€è¦æ·»åŠ  <code>public</code> è®¿é—®ä¿®é¥°ç¬¦ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java-å¼‚å¸¸</title>
      <link href="/2019/04/23/Java_intro/Day12_Java_Exception/"/>
      <url>/2019/04/23/Java_intro/Day12_Java_Exception/</url>
      
        <content type="html"><![CDATA[<h1 id="Java-å¼‚å¸¸å¤„ç†"><a href="#Java-å¼‚å¸¸å¤„ç†" class="headerlink" title="Java å¼‚å¸¸å¤„ç†"></a>Java å¼‚å¸¸å¤„ç†</h1><blockquote><p>æ²¡æœ‰ç¨‹åºèƒ½å¤Ÿå§‹ç»ˆæ­£å¸¸è¿è¡Œï¼ŒJava è¯­è¨€çš„è®¾è®¡è€…ä¹ŸçŸ¥é“è¿™ä¸€ç‚¹ã€‚Java å¹³å°æä¾›äº†å†…ç½®æœºåˆ¶æ¥å¤„ç†ä»£ç æœªå‡†ç¡®åœ°æŒ‰è®¡åˆ’è¿è¡Œçš„æƒ…å½¢ã€‚</p></blockquote><p><strong>å¼‚å¸¸</strong> æ˜¯åœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´å‘ç”Ÿçš„ç ´åæ­£å¸¸çš„ç¨‹åºæŒ‡ä»¤æµçš„äº‹ä»¶ã€‚</p><p><strong>å¼‚å¸¸å¤„ç†</strong> å¯ä»¥ä½¿ç”¨ <code>try</code> å’Œ <code>catch</code> ä»£ç å—ï¼ˆä»¥åŠ <code>finally</code>ï¼‰æ•è·é”™è¯¯ã€‚</p><h2 id="å¼‚å¸¸ç±»å‹"><a href="#å¼‚å¸¸ç±»å‹" class="headerlink" title="å¼‚å¸¸ç±»å‹"></a>å¼‚å¸¸ç±»å‹</h2><p>åœ¨ Java ä¸­ï¼Œå¼‚å¸¸çš„å±‚æ¬¡ç»“æ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="http://ww1.sinaimg.cn/large/006y8mN6gy1g673rbxe34j30i50b4dk9.jpg" alt="4970765-1437c4660dd95f3e"></p><ul><li><code>Throwable</code><ul><li><code>Error</code>    : è¿è¡Œæ—¶ç¯å¢ƒå‘ç”Ÿçš„é”™è¯¯ã€‚ä¾‹å¦‚ï¼ŒJVM å†…å­˜æº¢å‡ºã€‚ä¸€èˆ¬åœ°ï¼Œç¨‹åºä¸ä¼šä»é”™è¯¯ä¸­æ¢å¤ã€‚</li><li><code>Exception</code>    : ç¨‹åºæœ¬èº«å¯ä»¥å¤„ç†çš„å¼‚å¸¸<ul><li><code>IOException</code></li><li><code>RuntimeException</code><h3 id="å¼‚å¸¸åˆ†å±‚ç»“æ„"><a href="#å¼‚å¸¸åˆ†å±‚ç»“æ„" class="headerlink" title="å¼‚å¸¸åˆ†å±‚ç»“æ„"></a>å¼‚å¸¸åˆ†å±‚ç»“æ„</h3></li></ul></li></ul></li></ul><p>Java è¯­è¨€åŒ…å«ä¸€ä¸ªå®Œæ•´çš„å¼‚å¸¸åˆ†å±‚ç»“æ„ï¼Œå®ƒç”±è®¸å¤šç±»å‹çš„å¼‚å¸¸ç»„æˆï¼Œè¿™äº›å¼‚å¸¸åˆ’åˆ†ä¸ºä¸¤å¤§ä¸»è¦ç±»åˆ«ï¼š</p><ul><li>**å·²æ£€æŸ¥çš„å¼‚å¸¸(<em>checked exceptions</em>)**ï¼šå·²ç”±ç¼–è¯‘å™¨æ£€æŸ¥ï¼ˆè¡¨ç¤ºç¼–è¯‘å™¨ç¡®å®šå®ƒä»¬å·²åœ¨æ‚¨ä»£ç ä¸­çš„æŸå¤„å¤„ç†è¿‡ï¼‰ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œè¿™äº›å¼‚å¸¸æ˜¯ <code>java.lang.Exception</code> çš„ç›´æ¥å­ç±»ã€‚</li><li><strong>æœªæ£€æŸ¥çš„å¼‚å¸¸</strong>ï¼ˆä¹Ÿç§°ä¸º<em>è¿è¡Œæ—¶å¼‚å¸¸</em>ï¼Œ<em>unchecked / runtime exceptions</em>ï¼‰ï¼šæœªç”±ç¼–è¯‘å™¨æ£€æŸ¥ã€‚è¿™äº›æ˜¯ <code>java.lang.RuntimeException</code> çš„å­ç±»ã€‚</li></ul><h2 id="ä½¿ç”¨-tryã€catch-å’Œ-finally"><a href="#ä½¿ç”¨-tryã€catch-å’Œ-finally" class="headerlink" title="ä½¿ç”¨ tryã€catch å’Œ finally"></a>ä½¿ç”¨ <code>try</code>ã€<code>catch</code> å’Œ <code>finally</code></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// Try to execute</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (ExceptionType e) &#123;</span><br><span class="line">  <span class="comment">// Catch exception</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">// Always executes</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>âš ï¸ã€æ³¨æ„ã€‘<code>ExceptionType</code> è¦æ¢æˆå…·ä½“çš„é”™è¯¯ç±»å‹ï¼šå¦‚ <code>RuntimeException</code>ã€<code>IOException</code> ã€‚</p><p><code>try</code>ã€<code>catch</code> å’Œ <code>finally</code> ä»£ç å—å…±åŒå½¢æˆäº†ä¸€å¼ æ•è·å¼‚å¸¸çš„ç½‘: </p><ul><li>é¦–å…ˆï¼Œ<code>try</code> è¯­å¥é™å®šå¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä»£ç ;</li><li>æ•è·çš„å¼‚å¸¸ä¼šæ”¾åˆ° <code>catch</code> ä»£ç å—ï¼ˆæˆ–ç§° <em>å¼‚å¸¸å¤„ç†å‡½æ•°</em>ï¼‰ ä¸­ã€‚æ•è·åˆ°å¼‚å¸¸æ—¶ï¼Œå¯ä»¥å°è¯•ä¼˜é›…åœ°è¿›è¡Œæ¢å¤ï¼Œä¹Ÿå¯ä»¥é€€å‡ºç¨‹åºï¼ˆæˆ–æ–¹æ³•ï¼‰;</li><li>åœ¨æ‰€æœ‰å°è¯•å’Œæ•è·éƒ½å®Œæˆåï¼Œä¼šç»§ç»­æ‰§è¡Œ <code>finally</code> ä»£ç å—ï¼Œæ— è®ºæ˜¯å¦å‘ç”Ÿäº†å¼‚å¸¸;</li></ul><p>ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mine.java.tour;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exception</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">Logger l = Logger.getLogger(<span class="string">&quot;Try-Catch-Finally&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Integer foo = <span class="keyword">null</span>;</span><br><span class="line">System.out.println(<span class="string">&quot;foo: &quot;</span> + foo.toString());</span><br><span class="line">&#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">l.severe(<span class="string">&quot;Caught exception: &quot;</span> + e);</span><br><span class="line">System.out.println(<span class="string">&quot;catch&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;finally&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿è¡Œè¿™ä¸ªç¨‹åºä¼šå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">5æœˆ 02, 2019 11:57:04 ä¸Šåˆ mine.java.tour.Exception main</span><br><span class="line">ä¸¥é‡: Caught exception: java.lang.NullPointerException</span><br><span class="line">catch</span><br><span class="line">finally</span><br></pre></td></tr></table></figure><h3 id="å¤šä¸ª-catch-ä»£ç å—"><a href="#å¤šä¸ª-catch-ä»£ç å—" class="headerlink" title="å¤šä¸ª catch ä»£ç å—"></a>å¤šä¸ª <code>catch</code> ä»£ç å—</h3><p>å¯ä»¥æ‹¥æœ‰å¤šä¸ª <code>catch</code>ä»£ç å—ï¼Œä½†å¿…é¡»é‡‡ç”¨æŸç§ç‰¹å®šæ–¹å¼æ¥æ­å»ºå®ƒä»¬ã€‚</p><p>å¦‚æœæ‰€æœ‰å¼‚å¸¸éƒ½æ˜¯å…¶ä»–å¼‚å¸¸çš„å­ç±»ï¼Œé‚£ä¹ˆå­ç±»ä¼šæŒ‰ç…§ <code>catch</code> ä»£ç å—çš„é¡ºåºæ”¾åœ¨çˆ¶ç±»å‰é¢ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (IndexOutOfBoundsException e) &#123;</span><br><span class="line">    System.err.println(<span class="string">&quot;IndexOutOfBoundsException: &quot;</span> + e.getMessage());</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    System.err.println(<span class="string">&quot;Caught IOException: &quot;</span> + e.getMessage());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç”¨ä¸€ä¸ª-catch-æ•è·å¤šä¸ªç±»å‹çš„é”™è¯¯"><a href="#ç”¨ä¸€ä¸ª-catch-æ•è·å¤šä¸ªç±»å‹çš„é”™è¯¯" class="headerlink" title="ç”¨ä¸€ä¸ª catch æ•è·å¤šä¸ªç±»å‹çš„é”™è¯¯"></a>ç”¨ä¸€ä¸ª <code>catch</code> æ•è·å¤šä¸ªç±»å‹çš„é”™è¯¯</h3><p>åœ¨ Java SE 7 ä»¥åï¼Œä¸€ä¸ª <code>catch</code> è¯­å¥å¯ä»¥å¤„ç†ä¸æ­¢ä¸€ä¸ªç±»å‹çš„å¼‚å¸¸ã€‚è¿™ä¸ªç‰¹æ€§å¯ä»¥è®©æˆ‘ä»¬é¿å…ä¸€ç›´å†™é‡å¤çš„ä»£ç ï¼Œä¹Ÿè®©æˆ‘ä»¬æ²¡æœ‰ç†ç”±å»catchä¸€ä¸ªè¿‡åº¦å®½æ³›çš„é”™è¯¯ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ¬æ¥åº”è¯¥é€ä¸€å¤„ç†å„ç§ä¸åŒçš„é—®é¢˜ï¼Œä½†ä¸ºäº†é¿å…éº»çƒ¦ï¼Œç›´æ¥ <code>catch(RuntimeException e)</code>ï¼‰ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æŠŠ catch çš„å°æ‹¬å·é‡Œçš„å•ä¸ª ExceptionType æ›¿æ¢ä¸ºé€ä¸ªåˆ—å‡ºéœ€è¦è¿™ä¸ªè¯­å¥å—å¤„ç†çš„é”™è¯¯ç±»å‹ï¼Œæ¯ä¸ªç±»å‹ä¹‹é—´ç”¨ ç«–çº¿ï¼ˆ <code>|</code> ï¼‰åˆ†éš”ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">catch</span> (IOException|SQLException ex) &#123;</span><br><span class="line">    logger.log(ex);</span><br><span class="line">    <span class="keyword">throw</span> ex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€æ³¨ã€‘åœ¨ç”¨ä¸€ä¸ª catch æ•è·å¤šä¸ªé”™è¯¯çš„æ—¶å€™ï¼Œè¿™ä¸ª catch çš„å‚æ•°ä¼šéšå«åœ°å¸¦ä¸Š <code>final</code> å±æ€§ã€‚ä¾‹å¦‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œcatch çš„å‚æ•° ex æ˜¯ä¸€ä¸ª <code>final</code> çš„å˜é‡ï¼Œå› æ­¤ï¼Œä¸èƒ½åœ¨ catch è¯­å¥å—é‡Œç»™å®ƒèµ‹å€¼ï¼</p><h2 id="throws-å’Œ-throw"><a href="#throws-å’Œ-throw" class="headerlink" title="throws å’Œ throw"></a><code>throws</code> å’Œ <code>throw</code></h2><ul><li><code>throws</code> : æ–¹æ³•å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„å£°æ˜(ç”¨åœ¨å£°æ˜æ–¹æ³•æ—¶ï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•å¯èƒ½è¦æŠ›å‡ºå¼‚å¸¸)ã€‚</li></ul><p>Checked exception é€šè¿‡åœ¨å£°æ˜ä¸€ä¸ªæ–¹æ³•æ—¶ä½¿ç”¨ <code>throws</code> å…³é”®å­—åŠ ä¸Šä¸€ä¸ªå¯èƒ½çš„å¼‚å¸¸åˆ—è¡¨ æ¥å‘ç¼–è¯‘å™¨å£°æ˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">(<span class="keyword">int</span> a)</span> <span class="keyword">throws</span> Exception1, Exception1, ... </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>throws Exception1, Exception1, ...</code>  åªæ˜¯å‘Šè¯‰ç¼–è¯‘å™¨è¿™ä¸ªæ–¹æ³•å¯èƒ½ä¼šæŠ›å‡ºè¿™äº›å¼‚å¸¸ï¼Œæ–¹æ³•çš„è°ƒç”¨è€…å¯èƒ½è¦å¤„ç†è¿™äº›å¼‚å¸¸ï¼Œè€Œè¿™äº›å¯èƒ½å¼‚å¸¸æ˜¯è¯¥å‡½æ•°ä½“äº§ç”Ÿçš„ã€‚</p><ul><li><code>throw</code> æ˜¯å…·ä½“å‘å¤–æŠ›å¼‚å¸¸çš„åŠ¨ä½œï¼Œå®ƒæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸å®ä¾‹ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">className</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deposit</span><span class="params">(<span class="keyword">double</span> amount)</span> <span class="keyword">throws</span> RemoteException</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="comment">// Method implementation</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RemoteException();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//Remainder of class definition</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="try-with-resources-ä»£ç å—"><a href="#try-with-resources-ä»£ç å—" class="headerlink" title="try-with-resources ä»£ç å—"></a><code>try-with-resources</code> ä»£ç å—</h2><p>å½“æˆ‘ä»¬åœ¨ try ä¸­ä½¿ç”¨ä¸€äº›èµ„æºæ—¶ï¼Œä¸è®ºå‡ºé”™ä¸å¦æˆ‘ä»¬éƒ½åº”è¯¥åœ¨æœ€åå…³é—­å®ƒï¼Œæ‰€ä»¥å¯ä»¥åœ¨finally ä¸­å®Œæˆè¿™ä¸ªå…³é—­æ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> String <span class="title">readFirstLineFromFileWithFinallyBlock</span><span class="params">(String path)</span></span></span><br><span class="line"><span class="function">                                                     <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(path));</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> br.readLine();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (br != <span class="keyword">null</span>) br.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Java SE 7 å¼€å§‹ï¼Œè¿˜æœ‰ä¸€ç§æ›´ç®€å•åŠæ³•æ¥è§£å†³é—®é¢˜ï¼ŒJava å¯ä»¥è‡ªåŠ¨å…³é—­èµ„æºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> String <span class="title">readFirstLineFromFile</span><span class="params">(String path)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> (BufferedReader br =</span><br><span class="line">                   <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(path))) &#123;</span><br><span class="line">        <span class="keyword">return</span> br.readLine();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ try åé¢åŠ å°æ‹¬å·ï¼Œé‡Œé¢å£°æ˜éœ€è¦çš„èµ„æºï¼Œåœ¨ç»“æŸå¼‚å¸¸æ£€æµ‹åï¼ˆåœ¨ try ä»£ç å—è¶…å‡ºèŒƒå›´æ—¶ï¼‰ï¼ŒJava å°†è‡ªåŠ¨å¤„ç†è¿™ä¸ªèµ„æºçš„å…³é—­é—®é¢˜ã€‚</p><p>æ³¨æ„ï¼Œè¿™ç§è‡ªåŠ¨å…³é—­çš„èµ„æºå¿…é¡»å®ç° java.lang.AutoCloseable æ¥å£ï¼›å¦‚æœå°è¯•åœ¨ä¸€ä¸ªæ²¡æœ‰å®ç°è¯¥æ¥å£çš„èµ„æºç±»ä¸Šå®ç°æ­¤è¯­æ³•ï¼Œä¼šå‡ºé”™ã€‚</p><hr><p>ç›¸å…³ä»£ç ï¼š</p><p><a href="./src/Exception.java">Exception.java</a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java-é›†åˆ</title>
      <link href="/2019/04/22/Java_intro/Day11_Java_Collections/"/>
      <url>/2019/04/22/Java_intro/Day11_Java_Collections/</url>
      
        <content type="html"><![CDATA[<h1 id="Java-é›†åˆ"><a href="#Java-é›†åˆ" class="headerlink" title="Java é›†åˆ"></a>Java é›†åˆ</h1><blockquote><p>å¤§å¤šæ•°çœŸå®åº”ç”¨ç¨‹åºéƒ½ä¼šå¤„ç†åƒæ–‡ä»¶ã€å˜é‡ã€æ¥è‡ªæ–‡ä»¶çš„è®°å½•æˆ–æ•°æ®åº“ç»“æœé›†è¿™æ ·çš„é›†åˆã€‚</p></blockquote><p>æœ€å¸¸è§çš„é›†åˆå°±æ˜¯æ•°ç»„ï¼Œæˆ‘ä»¬ä¹‹å‰å·²ç»å•ç‹¬è®¨è®ºè¿‡å®ƒï¼Œç°åœ¨æˆ‘ä»¬ä¸»è¦ç ”ç©¶å…¶ä»–çš„é›†åˆç±»å‹ã€‚</p><h2 id="åˆ—è¡¨-List"><a href="#åˆ—è¡¨-List" class="headerlink" title="åˆ—è¡¨ List"></a>åˆ—è¡¨ <code>List</code></h2><p><code>List</code> æ˜¯ä¸€ç§æœ‰åºé›†åˆï¼Œä¹Ÿç§°ä¸º<em>åºåˆ—</em>ã€‚</p><p><code>List</code> é›†åˆåªèƒ½åŒ…å«å¯¹è±¡ï¼ˆä¸èƒ½åŒ…å«åƒ <code>int</code> è¿™æ ·çš„åŸè¯­ç±»å‹ï¼‰ã€‚</p><p>è¦ä½¿ç”¨ Listï¼Œæˆ‘ä»¬éœ€è¦å…ˆæŠŠå®ƒ import åˆ°ç¨‹åºä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.List;</span><br></pre></td></tr></table></figure><p><code>List</code> æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–å®ƒï¼ˆå³ï¼Œä¸å¯ä»¥ <code>new List&lt;E&gt;</code> ï¼ï¼‰ï¼Œè¦å£°æ˜ä¸€ä¸ª <code>List</code> ï¼Œä½¿ç”¨å¦‚ä¸‹è¯­æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; listOfStrings = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; listOfStrings = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªç§æ¯”è¾ƒå¸¸ç”¨çš„ List â€”â€” <code>ArrayList</code>ã€‚</p><blockquote><p>ã€æ³¨ã€‘</p><ol><li>è¦ä½¿ç”¨ä¸Šé¢çš„ä»£ç ï¼Œé¦–å…ˆè¦ ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br></pre></td></tr></table></figure></li><li>æˆ‘ä»¬å°† <code>ArrayList</code> å¯¹è±¡èµ‹ç»™äº†ä¸€ä¸ª <code>List</code> ç±»å‹çš„å˜é‡ã€‚åœ¨ Java ç¼–ç¨‹ä¸­ï¼Œå¯ä»¥å°†æŸç§ç±»å‹çš„å˜é‡èµ‹ç»™å¦ä¸€ç§ç±»å‹ï¼Œåªè¦è¢«èµ‹å€¼çš„å˜é‡æ˜¯èµ‹å€¼å˜é‡æ‰€å®ç°çš„è¶…ç±»æˆ–æ¥å£ã€‚</li></ol></blockquote><h3 id="æ­£å¼ç±»å‹"><a href="#æ­£å¼ç±»å‹" class="headerlink" title="æ­£å¼ç±»å‹"></a>æ­£å¼ç±»å‹</h3><p>å‰é¢çš„ä»£ç æ®µä¸­å°–æ‹¬å·ï¼ˆ <code>&lt;&gt;</code>ï¼‰ ä¸­çš„ç±»å‹è¢«ç§°ä¸º<em>æ­£å¼ç±»å‹ï¼ˆformal typeï¼‰</em>ï¼Œå³è¿™ä¸ª List æ˜¯ä¸€ä¸ªåŒ…å«ä½•ç§ç±»å‹çš„é›†åˆã€‚</p><p>å¦‚å‰ä¾‹ä¸­æ­£å¼ç±»å‹ä¸º <code>String</code>ï¼Œè¿™ä¸ª<code>List</code> ä»…èƒ½åŒ…å« <code>String</code> å®ä¾‹ã€‚</p><p>å¦‚æœæŠŠæ­£å¼ç±»å‹å†™ä¸º<code>&lt;Object&gt;</code>ï¼Œå°±æ„å‘³ç€å¯å°†ä»»ä½•å®ä½“æ”¾åœ¨è¯¥ <code>List</code> ä¸­ã€‚</p><h3 id="ä½¿ç”¨åˆ—è¡¨"><a href="#ä½¿ç”¨åˆ—è¡¨" class="headerlink" title="ä½¿ç”¨åˆ—è¡¨"></a>ä½¿ç”¨åˆ—è¡¨</h3><ul><li>å°†å®ä½“æ”¾å…¥  <code>List</code>  ä¸­<ul><li><code>add(E element)</code> æ–¹æ³•å°†å…ƒç´  element æ·»åŠ åˆ° <code>List</code> çš„æœ«å°¾å¤„ã€‚</li><li><code>add(int index, E e </code> æ–¹æ³•å°†å…ƒç´  element æ·»åŠ åˆ° <code>List</code> çš„ç´¢å¼•ä¸º <code>index</code> å¤„ï¼ˆ<code>index &lt;= List.size()</code>ï¼‰ã€‚</li></ul></li><li>è¯¢é—®  <code>List</code> ç›®å‰æœ‰å¤šå¤§<ul><li>è¦è¯¢é—® <code>List</code> æœ‰å¤šå¤§ï¼Œå¯è°ƒç”¨ <code>size()</code></li></ul></li><li>ä»  <code>List</code> ä¸­è·å–å®ä½“<ul><li>è¦ä» <code>List</code> ä¸­<strong>æ£€ç´¢</strong>æŸä¸€é¡¹ï¼Œå¯è°ƒç”¨ <code>get()</code> å¹¶å‘å®ƒä¼ é€’æƒ³è¦çš„é¡¹çš„ç´¢å¼•</li></ul></li><li>ä»  <code>List</code> ä¸­åˆ é™¤å®ä½“<ul><li>è¦ä» <code>List</code> ä¸­<strong>åˆ é™¤</strong>æŸä¸€é¡¹ï¼Œå¯è°ƒç”¨ <code>remove()</code> å¹¶å‘å®ƒä¼ é€’æƒ³è¦çš„é¡¹çš„ç´¢å¼•</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Logger l = Logger.getLogger(<span class="string">&quot;Test&quot;</span>)</span><br><span class="line"><span class="comment">// å£°æ˜ List</span></span><br><span class="line">List&lt;Integer&gt; listOfIntegers = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="comment">// æ’å…¥æ•°æ®</span></span><br><span class="line">listOfIntegers.add(Integer.valueOf(<span class="number">238</span>));</span><br><span class="line">listOfIntegers.add(<span class="number">0</span>, Integer.valueOf(<span class="number">987</span>));</span><br><span class="line"><span class="comment">// æŸ¥çœ‹å¤§å°</span></span><br><span class="line">l.info(<span class="string">&quot;Current List size: &quot;</span> + listOfIntegers.size());</span><br><span class="line"><span class="comment">// è·å–å…ƒç´ </span></span><br><span class="line">l.info(<span class="string">&quot;Item at index 0 is: &quot;</span> listOfIntegers.get(<span class="number">0</span>));</span><br><span class="line"><span class="comment">// åˆ é™¤å…ƒç´ </span></span><br><span class="line">listOfIntegers.remove(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>ç›¸å…³ä»£ç : <a href="./src/UsrList.java">UsrList.java</a></p><p>å…³äº List çš„æ›´å¤šè¯´æ˜ï¼Œè¯¦è§ <a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/util/List.html">JDKæ–‡æ¡£</a>ã€‚</p><h2 id="è¿­ä»£å˜é‡-Iterable"><a href="#è¿­ä»£å˜é‡-Iterable" class="headerlink" title="è¿­ä»£å˜é‡ Iterable"></a>è¿­ä»£å˜é‡ <code>Iterable</code></h2><p>å¦‚æœä¸€ä¸ªé›†åˆå®ç°äº† <code>java.lang.Iterable</code>ï¼Œé‚£ä¹ˆè¯¥é›†åˆè¢«ç§°ä¸º<em>è¿­ä»£å˜é‡é›†åˆ</em>ã€‚</p><p> <code>Iterable</code> å¯ä»ä¸€ç«¯å¼€å§‹ï¼Œé€é¡¹åœ°å¤„ç†é›†åˆï¼Œç›´åˆ°å¤„ç†å®Œæ‰€æœ‰é¡¹ã€‚</p><p>å®ƒçš„ä½¿ç”¨å½¢å¼å°±æ˜¯åœ¨ å¾ªç¯ ä¸­æåŠè¿‡çš„ for-echo å¾ªç¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (objectType varName : collectionReference) &#123;</span><br><span class="line">    <span class="comment">// Start using objectType (via varName) right away...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸º <code>List</code> æ‰©å±•äº† <code>java.util.Collection</code>ï¼ˆå®ƒå®ç° <code>Iterable</code>ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ç®€å†™è¯­æ³•æ¥è¿­ä»£ä»»ä½• <code>List</code> :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; listOfIntegers = obtainSomehow();</span><br><span class="line">Logger l = Logger.getLogger(<span class="string">&quot;Test&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (Integer i : listOfIntegers) &#123;</span><br><span class="line">    l.info(<span class="string">&quot;Integer value is : &quot;</span> + i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å®ç°çš„æ•ˆæœå’Œå¦‚ä¸‹çš„ for å¾ªç¯å¤„ç†ç­‰æ•ˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; listOfIntegers = obtainSomehow();</span><br><span class="line">Logger l = Logger.getLogger(<span class="string">&quot;Test&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> aa = <span class="number">0</span>; aa &lt; listOfIntegers.size(); aa++) &#123;</span><br><span class="line">    Integer I = listOfIntegers.get(aa);</span><br><span class="line">    l.info(<span class="string">&quot;Integer value is : &quot;</span> + i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é›†-Set"><a href="#é›†-Set" class="headerlink" title="é›† Set"></a>é›† <code>Set</code></h2><p><code>Set</code> æ˜¯ä¸€ç§æ²¡æœ‰é‡å¤å…ƒç´ çš„é›†åˆç»“æ„ã€‚å®ƒå¯ä¿è¯å…¶å…ƒç´ ä¸­çš„å”¯ä¸€æ€§ï¼Œä½†ä¸å…³å¿ƒå…ƒç´ çš„é¡ºåºã€‚</p><p><code>List</code> å¯åŒ…å«åŒä¸€ä¸ªå¯¹è±¡æ•°ç™¾æ¬¡ï¼Œè€Œ <code>Set</code> ä»…å¯åŒ…å«æŸä¸ªç‰¹å®šå®ä¾‹ä¸€æ¬¡ã€‚</p><p><code>Set</code> ä¹Ÿä»…å¯åŒ…å«å¯¹è±¡ï¼Œä¸èƒ½ç›´æ¥åŒ…å«å†…ç½®ç±»å‹ã€‚</p><p>ä¸ <code>List</code> ä¸€æ ·ï¼Œä¸èƒ½ç›´æ¥å®ä¾‹åŒ– <code>Set</code> (ä¸èƒ½ <code>new Set&lt;E&gt;()</code>) ï¼Œä½†å¯ä»¥ç”¨ç»§æ‰¿è‡ª <code>Set</code> çš„ <code>HashSet</code> ç­‰æ¥å®ç°ã€‚</p><h4 id="æ“ä½œ-Set"><a href="#æ“ä½œ-Set" class="headerlink" title="æ“ä½œ Set"></a>æ“ä½œ <code>Set</code></h4><ul><li>å¢<ul><li><code>add(E e)</code></li></ul></li><li>åˆ <ul><li><code>remove(Object o)</code></li></ul></li><li>è·å–å¤§å°<ul><li><code>size()</code></li></ul></li><li>è·å–å®ä½“<ul><li>ä½¿ç”¨åœ¨ â€œè¿­ä»£å˜é‡ (<code>Iterable</code>)â€ ä¸­ä»‹ç»çš„ for-each å¾ªç¯å¯ä»¥æŠŠå…ƒç´ ä» <code>Set</code> ä¸­å–å‡ºæ¥ã€‚ä½†æ³¨æ„å¯¹è±¡å¯èƒ½æŒ‰ç…§ä¸åŒäºæ·»åŠ å®ƒä»¬çš„é¡ºåºæ‰“å°è¢«å–å‡ºæ¥ã€‚</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TrySet</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] arg)</span> </span>&#123;</span><br><span class="line">Logger l = Logger.getLogger(<span class="string">&quot;Tset&quot;</span>);</span><br><span class="line"></span><br><span class="line">Set&lt;Integer&gt; setOfIntegers = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">setOfIntegers.add(Integer.valueOf(<span class="number">12</span>));</span><br><span class="line">setOfIntegers.add(Integer.valueOf(<span class="number">20</span>));</span><br><span class="line">setOfIntegers.add(Integer.valueOf(<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line">setOfIntegers.add(Integer.valueOf(<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line">l.info(setOfIntegers.toString());</span><br><span class="line"></span><br><span class="line">setOfIntegers.remove(Integer.valueOf(<span class="number">20</span>));</span><br><span class="line"></span><br><span class="line">l.info(<span class="string">&quot;&quot;</span> + setOfIntegers.size());</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (Integer i : setOfIntegers) &#123;</span><br><span class="line">i += <span class="number">100</span>;</span><br><span class="line">System.out.println(i);</span><br><span class="line">&#125;</span><br><span class="line">l.info(setOfIntegers.toString());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">... TrySet main</span><br><span class="line">ä¿¡æ¯: [20, 5, 12]</span><br><span class="line">... TrySet main</span><br><span class="line">ä¿¡æ¯: 2</span><br><span class="line">105</span><br><span class="line">112</span><br><span class="line">... TrySet main</span><br><span class="line">ä¿¡æ¯: [5, 12]</span><br></pre></td></tr></table></figure><h2 id="æ˜ å°„-Map"><a href="#æ˜ å°„-Map" class="headerlink" title="æ˜ å°„ Map"></a>æ˜ å°„ <code>Map</code></h2><p><code>Map</code> æ˜¯ä¸€ç§æ–¹ä¾¿çš„é›†åˆæ„é€ ï¼Œå¯ä»¥ä½¿ç”¨å®ƒå°†ä¸€ä¸ªå¯¹è±¡ï¼ˆ<em>é”®</em>ï¼‰ä¸å¦ä¸€ä¸ªå¯¹è±¡ï¼ˆ<em>å€¼</em>ï¼‰ç›¸å…³è”ã€‚</p><p><code>Map</code> çš„é”®å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œè€Œä¸”å¯åœ¨ä»¥åç”¨äºæ£€ç´¢å€¼ã€‚</p><p>å’Œ Listã€Set ä¸€æ ·ï¼Œ<code>Map</code> é›†åˆä»…å¯åŒ…å«å¯¹è±¡ï¼Œä¸” <code>Map</code> æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–å®ƒï¼Œæˆ‘ä»¬å¸¸ç”¨ <code>HashMap</code> æ¥å®ç°ä¸€ä¸ª <code>Map</code>ã€‚</p><h4 id="å¸¸ç”¨æ“ä½œ"><a href="#å¸¸ç”¨æ“ä½œ" class="headerlink" title="å¸¸ç”¨æ“ä½œ"></a>å¸¸ç”¨æ“ä½œ</h4><ul><li>æ·»åŠ å…ƒç´ ï¼š<code>put(K key, V value)</code></li><li>å–å‡ºå…ƒç´ ï¼š<code>get(Object key)</code></li><li>åˆ é™¤å…ƒç´ ï¼š<code>remove (Object key, [Object value])</code></li><li>è·å–å¤§å°ï¼š<code>size()</code></li><li>è·å–ä¸€ä¸ª Key çš„ <code>Set</code>ï¼š<code>keySet()</code>ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œç»“åˆä½¿ç”¨ Set å’Œ Mapï¼Œå®ç°éå† <code>Map</code>ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å£°æ˜</span></span><br><span class="line">Map&lt;String, Integer&gt; mapOfIntegers = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"><span class="comment">// æ·»åŠ </span></span><br><span class="line">mapOfIntegers.put(<span class="string">&quot;168&quot;</span>, Integer.valueOf(<span class="number">168</span>));</span><br><span class="line"><span class="comment">// å–å€¼</span></span><br><span class="line">Integer oneHundred68 = mapOfIntegers.get(<span class="string">&quot;168&quot;</span>);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;String&gt; keys = mapOfIntegers.keySet();</span><br><span class="line">Logger l = Logger.getLogger(<span class="string">&quot;Test&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (String key : keys) &#123;</span><br><span class="line">    Integer  value = mapOfIntegers.get(key);</span><br><span class="line">    l.info(<span class="string">&quot;Value keyed by &#x27;&quot;</span> + key + <span class="string">&quot;&#x27; is &#x27;&quot;</span> + value + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›¸å…³ä»£ç ï¼š<a href="./src/TryMap.java">TryMap.java</a></p><hr><p>ç›¸å…³ä»£ç ï¼š</p><p><a href="./src/UsrList.java">TryList.java</a></p><p><a href="./src/TrySet.java">TrySet.java</a></p><p><a href="./src/TryMap.java">TryMap.java</a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java-æ•°ç»„</title>
      <link href="/2019/04/21/Java_intro/Day10_Java_Array/"/>
      <url>/2019/04/21/Java_intro/Day10_Java_Array/</url>
      
        <content type="html"><![CDATA[<h1 id="Java-æ•°ç»„"><a href="#Java-æ•°ç»„" class="headerlink" title="Java æ•°ç»„"></a>Java æ•°ç»„</h1><p>Java è¯­è¨€ä¸­æä¾›çš„æ•°ç»„æ˜¯ç”¨æ¥å­˜å‚¨<strong>å›ºå®šå¤§å°</strong>çš„<strong>åŒç±»å‹å…ƒç´ </strong>çš„ã€‚</p><h2 id="å£°æ˜æ•°ç»„å˜é‡"><a href="#å£°æ˜æ•°ç»„å˜é‡" class="headerlink" title="å£°æ˜æ•°ç»„å˜é‡"></a>å£°æ˜æ•°ç»„å˜é‡</h2><p>æ¬²ä½¿ç”¨æ•°ç»„ï¼Œé¦–å…ˆå¿…é¡»å£°æ˜æ•°ç»„å˜é‡ï¼Œç”¨æ¥å­˜æ”¾æ•°ç»„å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dataType[] arrayRefVar;   <span class="comment">// é¦–é€‰çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">/* æˆ– */</span></span><br><span class="line">dataType arrayRefVar[];  <span class="comment">// æ•ˆæœç›¸åŒï¼Œä½†ä¸æ˜¯é¦–é€‰æ–¹æ³•ï¼Œè¿™ç§é£æ ¼æ¥è‡ª C/C++ï¼Œåªæ˜¯ä¸ºäº†è®© C/C++ ç¨‹åºå‘˜èƒ½å¤Ÿå¿«é€Ÿç†è§£javaè¯­è¨€</span></span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºæ•°ç»„"><a href="#åˆ›å»ºæ•°ç»„" class="headerlink" title="åˆ›å»ºæ•°ç»„"></a>åˆ›å»ºæ•°ç»„</h2><p>ä¸å…¶ä»–ç±»å‹ç›¸ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <code>new</code> åˆ›å»ºä¸€ä¸ªæ•°ç»„å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arrayRefVar = <span class="keyword">new</span> dataType[arraySize];</span><br></pre></td></tr></table></figure><p>ä¸ C ä¸åŒçš„æ˜¯ï¼ŒarraySize å¯ä»¥æ˜¯ä¸€ä¸ªå˜é‡ï¼Œè€Œä¸å¿…ä½¿ç”¨å­—é¢å€¼å¸¸é‡ã€‚</p><p>æˆ–è€…ï¼Œå¦‚æœæˆ‘ä»¬é¢„å…ˆçŸ¥é“äº†æ•°ç»„çš„å†…å®¹ï¼Œå¯ä»¥åƒ C ä¸€æ ·ç”¨ æ•°ç»„çš„å­—é¢å€¼å¸¸é‡ (<code>&#123;...&#125;</code>) æ¥åˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String [] names;</span><br><span class="line">names = &#123;<span class="string">&quot;James&quot;</span>, <span class="string">&quot;Larry&quot;</span>, <span class="string">&quot;Tom&quot;</span>, <span class="string">&quot;Lacy&quot;</span>&#125;;</span><br></pre></td></tr></table></figure><p>æ­£å¦‚å…¶ä»–ç±»å‹çš„å˜é‡ï¼Œæˆ‘ä»¬å¸¸æŠŠå£°æ˜å’Œåˆ›å»ºå†™åœ¨ä¸€èµ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataType[] arrayRefVar = <span class="keyword">new</span> dataType[arraySize];</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨æ•°ç»„"><a href="#ä½¿ç”¨æ•°ç»„" class="headerlink" title="ä½¿ç”¨æ•°ç»„"></a>ä½¿ç”¨æ•°ç»„</h2><h3 id="æ•°ç»„å¤§å°"><a href="#æ•°ç»„å¤§å°" class="headerlink" title="æ•°ç»„å¤§å°"></a>æ•°ç»„å¤§å°</h3><p>å¯¹äºä¸€ä¸ªæ•°ç»„ <code>arrayRefVar</code> ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>arrayRefVar.length</code> æ¥è·å–å…¶é•¿åº¦ã€‚</p><h3 id="ç´¢å¼•è®¿é—®"><a href="#ç´¢å¼•è®¿é—®" class="headerlink" title="ç´¢å¼•è®¿é—®"></a>ç´¢å¼•è®¿é—®</h3><p>æ•°ç»„çš„å…ƒç´ æ˜¯é€šè¿‡ç´¢å¼•è®¿é—®çš„ã€‚æ•°ç»„ç´¢å¼•ä» <code>0</code> å¼€å§‹ åˆ° <code>arrayRefVar.length-1</code>ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•°ç»„æ¥è¡¨ç¤ºå‡º <em>æ–æ³¢é‚£å¥‘æ•°åˆ—</em> çš„å‰ n é¡¹ï¼Œç„¶åæŠŠå®ƒä»¬è¾“å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FibonacciArray</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">// åˆ›å»ºæ•°ç»„</span></span><br><span class="line"><span class="keyword">int</span> size = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span>[] fib = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¡«è£…æ•°åˆ—</span></span><br><span class="line">fib[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">fib[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt; size; i++) &#123;</span><br><span class="line">fib[i] = fib[i-<span class="number">1</span>] + fib[i-<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; size; i++) &#123;</span><br><span class="line">System.out.println(fib[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•°ç»„è¿­ä»£"><a href="#æ•°ç»„è¿­ä»£" class="headerlink" title="æ•°ç»„è¿­ä»£"></a>æ•°ç»„è¿­ä»£</h3><p>æ­£å¦‚ä¸Šé¢çš„ç¨‹åºï¼Œæˆ‘ä»¬å¸¸ç”¨å¾ªç¯æ¥å¤„ç†ä¸€ä¸ªæ•°ç»„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¼ ç»Ÿçš„ for æˆ–è€…æ˜¯ for-each å¾ªç¯æ¥è¿­ä»£ä¸€ä¸ªæ•°ç»„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> arr[] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">5</span>];</span><br><span class="line"><span class="comment">// for</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    arr[i] = i * <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// for-each</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> element: arr) &#123;</span><br><span class="line">    System.out.println(element);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•°ç»„ä¸å‡½æ•°"><a href="#æ•°ç»„ä¸å‡½æ•°" class="headerlink" title="æ•°ç»„ä¸å‡½æ•°"></a>æ•°ç»„ä¸å‡½æ•°</h3><p>æˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ªæ•°ç»„çœ‹æˆæ˜¯å’Œå…¶ä»–ä»»ä½•å®ä¾‹ä¸€æ ·çš„å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å½“ç„¶ä¹Ÿå¯ä»¥æŠŠå®ƒå½“ä½œå‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼Œæˆ–ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼è¿”å›ã€‚</p><h4 id="æ•°ç»„ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼"><a href="#æ•°ç»„ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼" class="headerlink" title="æ•°ç»„ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼"></a>æ•°ç»„ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] returnArray(<span class="keyword">int</span> base) &#123;</span><br><span class="line"><span class="keyword">int</span>[] result = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; result.length; i++) &#123;</span><br><span class="line">result[i] = base &lt;&lt; i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ•°ç»„ä½œä¸ºå‡½æ•°çš„å‚æ•°"><a href="#æ•°ç»„ä½œä¸ºå‡½æ•°çš„å‚æ•°" class="headerlink" title="æ•°ç»„ä½œä¸ºå‡½æ•°çš„å‚æ•°"></a>æ•°ç»„ä½œä¸ºå‡½æ•°çš„å‚æ•°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i: arr) &#123;</span><br><span class="line">System.out.print(i + <span class="string">&quot;, &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">System.out.print(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº‹å®ä¸Šï¼Œæˆ‘ä»¬å¸¸ç”¨åˆ°çš„ <code>main</code> å‡½æ•°ï¼Œå°±æ˜¯ä½¿ç”¨æ•°ç»„ä½œä¸ºå‡½æ•°çš„å‚æ•°çš„è‰¯å¥½ä¾‹å­ã€‚</p><p><code>main</code> æ˜¯è¿™æ ·çš„ï¼š<code>public static void main(String[] args) &#123; ... &#125;</code>, å®ƒæ¥æ”¶ä¸€ä¸ª String çš„æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªæ•°ç»„çš„å…ƒç´ å°±æ˜¯åœ¨è¿è¡Œ java ç¨‹åºæ—¶ç»™å‡ºçš„å‘½ä»¤è¡Œå‚æ•°ã€‚<br>ä¾‹å¦‚ <code>java Example.java Arg1 Arg2</code>ï¼Œå¯¹åº”çš„argså°†æ˜¯ï¼š<code>&#123;&quot;Arg1&quot;, &quot;Arg2&quot;&#125;</code>ã€‚</p><p>å‚è€ƒç¤ºä¾‹ä»£ç  <a href="./src/ArrayAndFunction.java">ArrayAndFunction.java</a>ã€‚</p><h2 id="å¤šç»´æ•°ç»„"><a href="#å¤šç»´æ•°ç»„" class="headerlink" title="å¤šç»´æ•°ç»„"></a>å¤šç»´æ•°ç»„</h2><p>æˆ‘ä»¬å¯ä»¥å£°æ˜ä¸€ä¸ªå…ƒç´ æ˜¯æ•°ç»„çš„æ•°ç»„ï¼Œå³å¤šç»´æ•°ç»„ã€‚<br>ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a[][] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>][<span class="number">3</span>];</span><br></pre></td></tr></table></figure><p>è¿™å°†ç”Ÿæˆä¸€ä¸ªæœ‰ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„ï¼Œè¿™ä¸¤ä¸ªå…ƒç´ åˆåˆ†åˆ«æ˜¯åŒ…å« 3 ä¸ª int çš„æ•°ç»„ã€‚</p><p>æˆ‘ä»¬å¯ä»¥è¿™æ ·ä½¿ç”¨å®ƒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MultArr</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> a[][] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>][<span class="number">3</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; a.length; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; a[i].length; j++) &#123;</span><br><span class="line">a[i][j] = i*<span class="number">10</span> + j;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i[]: a) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j: i) &#123;</span><br><span class="line">System.out.println(j);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Arrays-ç±»"><a href="#Arrays-ç±»" class="headerlink" title="Arrays ç±»"></a>Arrays ç±»</h2><p><code>Arrays</code> ç±»ï¼ˆ<code>java.util.Arrays</code>ï¼‰æ˜¯ Java æä¾›çš„ä¸€ä¸ªå¤„ç†æ•°ç»„çš„ç±»ï¼Œå®ƒåŒ…å«äº†ä¸€ç³»åˆ—å¸¸ç”¨çš„æ•°ç»„æ“ä½œï¼Œå¯ä»¥å¯¹å†…å»ºç±»å‹çš„æ•°ç»„æ–¹ä¾¿åœ°æ“ä½œã€‚</p><p>è¦ä½¿ç”¨ <code>Arrays</code> ç±»ï¼Œé¦–å…ˆè¦å¯¼å…¥å®ƒï¼Œå³åœ¨ä»£ç å¼€å¤´ä½¿ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œå°±å¯ä»¥è°ƒç”¨å®ƒçš„è¿™äº›ä¸»è¦çš„æ–¹æ³•ï¼š</p><ul><li><code>Arrays.fill(ArrayObject, [begin, end,] Num)</code></li></ul><p>æŠŠ <code>Num</code> èµ‹å€¼ç»™ <code>ArrayObject</code> ä¸­ä¸‹æ ‡å±äº <code>[begin, end)</code> (å¯é€‰ï¼Œç¼ºçœä¸ºæ•´ä¸ªæ•°ç»„) çš„å…ƒç´ ã€‚</p><ul><li><code>Arrays.sort(ArrayObject, [begin, end])</code></li></ul><p>å¯¹ <code>ArrayObject</code> ä¸­ä¸‹æ ‡å±äº <code>[begin, end)</code> (å¯é€‰ï¼Œç¼ºçœä¸ºæ•´ä¸ªæ•°ç»„) çš„å…ƒç´ æ’åºã€‚</p><ul><li><code>Arrays.equals(Arr1, Arr2)</code></li></ul><p>åˆ¤æ–­æ•°ç»„ <code>Arr1</code> å’Œ <code>Arr2</code> æ˜¯å¦ç›¸åŒã€‚</p><ul><li><code>Arrays.binarySearch(ArrayObject, Key)</code></li></ul><p>åœ¨ æ•°ç»„ <code>ArrayObject</code> ä¸­ç”¨ <strong>äºŒåˆ†æœç´¢</strong>ï¼ˆæ³¨æ„è¦æ’åºåçš„æ‰æœ‰æ„ä¹‰ï¼‰æœç´¢å€¼Keyï¼Œ<br>æ‰¾åˆ°ä¼šè¿”å›é¦–ä¸ªå¯¹åº”çš„ç´¢å¼•ï¼Œ<br>æ‰¾ä¸åˆ°ä¼šè¿”å›è´Ÿå€¼ã€‚</p><ul><li><code>Arrays.toString(ArrayObject)</code></li></ul><p>ç”¨å­—ç¬¦ä¸²æ¥è¡¨ç¤ºä¸€ä¸ªæ•°ç»„ï¼ˆå¦‚ <code>&#123;1, 2, 3&#125;</code> è¡¨ç¤ºä¸º <code>&quot;[1, 2, 3]&quot;</code>ï¼‰ï¼Œ<br><strong>è¿”å›</strong>å¾—åˆ°çš„å­—ç¬¦ä¸²ã€‚</p><p>ç”¨ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UseArrays</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span>[] a = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span>[] b = &#123;<span class="number">9</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">7</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// toString</span></span><br><span class="line">System.out.println(Arrays.toString(a));</span><br><span class="line">System.out.println(Arrays.toString(b));</span><br><span class="line"></span><br><span class="line"><span class="comment">// fill</span></span><br><span class="line">Arrays.fill(a, <span class="number">6</span>);</span><br><span class="line">System.out.println(Arrays.toString(a));</span><br><span class="line"></span><br><span class="line">Arrays.fill(a, <span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>);</span><br><span class="line">System.out.println(Arrays.toString(a));</span><br><span class="line"></span><br><span class="line"><span class="comment">// sort</span></span><br><span class="line">Arrays.sort(b, <span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line">System.out.println(Arrays.toString(b));</span><br><span class="line"></span><br><span class="line">Arrays.sort(b);</span><br><span class="line">System.out.println(Arrays.toString(b));</span><br><span class="line"></span><br><span class="line"><span class="comment">// equals</span></span><br><span class="line">System.out.println(</span><br><span class="line">Arrays.equals(a, a)</span><br><span class="line">);</span><br><span class="line">System.out.println(</span><br><span class="line">Arrays.equals(a, b)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// binarySearch</span></span><br><span class="line">System.out.println(</span><br><span class="line">Arrays.binarySearch(b, <span class="number">3</span>)</span><br><span class="line">);</span><br><span class="line">System.out.println(</span><br><span class="line">Arrays.binarySearch(b, <span class="number">99</span>)</span><br><span class="line">);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[0, 0, 0, 0, 0]</span><br><span class="line">[9, 2, 1, 3, 7]</span><br><span class="line">[6, 6, 6, 6, 6]</span><br><span class="line">[6, 6, 8, 8, 6]</span><br><span class="line">[9, 1, 2, 3, 7]</span><br><span class="line">[1, 2, 3, 7, 9]</span><br><span class="line">true</span><br><span class="line">false</span><br><span class="line">2</span><br><span class="line">-6</span><br></pre></td></tr></table></figure><p>Arrays ç±»è¿˜æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œå¯ä»¥å‚è€ƒ <a href="https://docs.oracle.com/javase/10/docs/api/java/util/Arrays.html">å®˜æ–¹æ–‡æ¡£</a></p><hr><p>ç›¸å…³ä»£ç :</p><ul><li><a href="./src/FibonacciArray.java">FibonacciArray.java</a></li><li><a href="./src/ArrayAndFunction.java">ArrayAndFunction.java</a></li><li><a href="./src/MultArr.java">MultArr.java</a></li><li><a href="./src/UseArrays.java">UseArrays.java</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java-æ¡ä»¶</title>
      <link href="/2019/04/20/Java_intro/Day9_Java_Condition/"/>
      <url>/2019/04/20/Java_intro/Day9_Java_Condition/</url>
      
        <content type="html"><![CDATA[<h1 id="Java-æ¡ä»¶è¯­å¥"><a href="#Java-æ¡ä»¶è¯­å¥" class="headerlink" title="Java æ¡ä»¶è¯­å¥"></a>Java æ¡ä»¶è¯­å¥</h1><h2 id="if-else-è¯­å¥"><a href="#if-else-è¯­å¥" class="headerlink" title="if-else è¯­å¥"></a>if-else è¯­å¥</h2><p>Java çš„ <code>if</code> æ¡ä»¶è¯­å¥å’Œ C å®Œå…¨ä¸€è‡´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (expression_0) &#123;</span><br><span class="line">    <span class="comment">// statements</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (expression_1) &#123;</span><br><span class="line">    <span class="comment">// statements</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// statements</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><del>æ— éœ€è§£é‡Š</del></p><h2 id="switch-case-è¯­å¥"><a href="#switch-case-è¯­å¥" class="headerlink" title="switch-case è¯­å¥"></a>switch-case è¯­å¥</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span>(expression)&#123;</span><br><span class="line">    <span class="keyword">case</span> value_0 :</span><br><span class="line">       <span class="comment">//è¯­å¥</span></span><br><span class="line">       <span class="keyword">break</span>;   <span class="comment">//å¯é€‰</span></span><br><span class="line">    <span class="keyword">case</span> value_1 :</span><br><span class="line">       <span class="comment">//è¯­å¥</span></span><br><span class="line">       <span class="keyword">break</span>;   <span class="comment">//å¯é€‰</span></span><br><span class="line">    <span class="comment">//ä½ å¯ä»¥æœ‰ä»»æ„æ•°é‡çš„caseè¯­å¥</span></span><br><span class="line">    <span class="keyword">default</span> :   <span class="comment">//å¯é€‰</span></span><br><span class="line">       <span class="comment">//è¯­å¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Java ä¸­çš„ <code>switch</code> å¤§ä½“ä¸Šå’Œ C çš„ç›¸åŒï¼Œä½†ä¹Ÿæœ‰ä¸åŒçš„åœ°æ–¹ã€‚å€¼å¾—ä¸€æçš„æ˜¯å¦‚ä¸‹å‡ ç‚¹ï¼š</p><ul><li>åŒ C ä¸€æ ·ï¼Œ<ul><li>case è¯­å¥ä¸­çš„å€¼çš„æ•°æ®ç±»å‹å¿…é¡»ä¸å˜é‡çš„æ•°æ®ç±»å‹ç›¸åŒï¼Œè€Œä¸”åªèƒ½æ˜¯å¸¸é‡æˆ–è€…å­—é¢å¸¸é‡ã€‚</li><li>åŒæ—¶éœ€è¦æ³¨æ„ <code>case</code> åä¸€ç›´æ‰§è¡Œåˆ° <code>break</code> æ‰ä¼šåœæ­¢ï¼ˆæˆ–è€…æ‰§è¡Œåˆ°å…¨éƒ¨ç»“æŸï¼‰ï¼Œä¸ä¼šåœ¨ä¸€ä¸ª case ç»“æŸåè‡ªåŠ¨åœæ­¢ï¼</li></ul></li><li>ä¸ C ä¸åŒçš„æ˜¯ï¼Œ<ul><li>Java ä¸­ <code>switch</code> åé¢çš„ expression å¯ä»¥æ˜¯ <code>byte</code>ã€<code>short</code>ã€<code>int</code> æˆ–è€… <code>char</code>ã€‚ä» Java SE 7 å¼€å§‹ï¼Œswitch æ”¯æŒå­—ç¬¦ä¸² <code>String</code> ç±»å‹äº†ã€‚</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java-å¾ªç¯</title>
      <link href="/2019/04/19/Java_intro/Day8_Java_Loop/"/>
      <url>/2019/04/19/Java_intro/Day8_Java_Loop/</url>
      
        <content type="html"><![CDATA[<h1 id="Java-å¾ªç¯"><a href="#Java-å¾ªç¯" class="headerlink" title="Java å¾ªç¯"></a>Java å¾ªç¯</h1><p>Javaä¸­æœ‰ä¸‰ç§ä¸»è¦çš„å¾ªç¯ç»“æ„ï¼š</p><ul><li><code>while</code> å¾ªç¯</li><li><code>do...while</code> å¾ªç¯</li><li><code>for</code> å¾ªç¯</li></ul><h2 id="while-å¾ªç¯"><a href="#while-å¾ªç¯" class="headerlink" title="while å¾ªç¯"></a><code>while</code> å¾ªç¯</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">while( å¸ƒå°”è¡¨è¾¾å¼ ) &#123;</span><br><span class="line">    &#x2F;&#x2F; å¾ªç¯å†…å®¹</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="do-while-å¾ªç¯"><a href="#do-while-å¾ªç¯" class="headerlink" title="do...while å¾ªç¯"></a><code>do...while</code> å¾ªç¯</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">do &#123;</span><br><span class="line">    &#x2F;&#x2F; å¾ªç¯å†…å®¹</span><br><span class="line">&#125; while( å¸ƒå°”è¡¨è¾¾å¼ );</span><br></pre></td></tr></table></figure><h2 id="for-å¾ªç¯"><a href="#for-å¾ªç¯" class="headerlink" title="for å¾ªç¯"></a><code>for</code> å¾ªç¯</h2><p>å’Œ C++ 11 ä¸€æ ·ï¼ŒJavaæœ‰ä¸¤ç§ for å¾ªç¯ï¼Œä¸€ç§æ˜¯ç±»ä¼¼ä¸ C çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for( åˆå§‹åŒ–; å¸ƒå°”è¡¨è¾¾å¼; æ›´æ–° ) &#123;</span><br><span class="line">    &#x2F;&#x2F; ä»£ç è¯­å¥</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ç§ç”¨äºæ•°ç»„è¿­ä»£çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for(type element: array)</span><br><span class="line">&#123;</span><br><span class="line">    System.out.println(element);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å£°æ˜è¯­å¥ï¼šå£°æ˜æ–°çš„å±€éƒ¨å˜é‡ï¼Œè¯¥å˜é‡çš„ç±»å‹å¿…é¡»å’Œæ•°ç»„å…ƒç´ çš„ç±»å‹åŒ¹é…ã€‚å…¶ä½œç”¨åŸŸé™å®šåœ¨å¾ªç¯è¯­å¥å—ï¼Œå…¶å€¼ä¸æ­¤æ—¶æ•°ç»„å…ƒç´ çš„å€¼ç›¸ç­‰ã€‚<br>è¡¨è¾¾å¼ï¼šè¡¨è¾¾å¼æ˜¯è¦è®¿é—®çš„æ•°ç»„åï¼Œæˆ–è€…æ˜¯è¿”å›å€¼ä¸ºæ•°ç»„çš„æ–¹æ³•ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span>&#123;</span><br><span class="line">      <span class="keyword">int</span> [] numbers = &#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>&#125;;</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> x : numbers )&#123;</span><br><span class="line">         System.out.print( x );</span><br><span class="line">         System.out.print(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      System.out.print(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">      String [] names = &#123;<span class="string">&quot;James&quot;</span>, <span class="string">&quot;Larry&quot;</span>, <span class="string">&quot;Tom&quot;</span>, <span class="string">&quot;Lacy&quot;</span>&#125;;</span><br><span class="line">      <span class="keyword">for</span>( String name : names ) &#123;</span><br><span class="line">         System.out.print( name );</span><br><span class="line">         System.out.print(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¾ªç¯æ§åˆ¶"><a href="#å¾ªç¯æ§åˆ¶" class="headerlink" title="å¾ªç¯æ§åˆ¶"></a>å¾ªç¯æ§åˆ¶</h2><p><code>break</code>ã€<code>continue</code> åœ¨ Java ä¸­ä¹ŸåŒæ ·æœ‰æ•ˆã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java-åŸºæœ¬è¿ç®—</title>
      <link href="/2019/04/18/Java_intro/Day7_Java_Operators/"/>
      <url>/2019/04/18/Java_intro/Day7_Java_Operators/</url>
      
        <content type="html"><![CDATA[<h1 id="Java-è¿ç®—ç¬¦"><a href="#Java-è¿ç®—ç¬¦" class="headerlink" title="Java è¿ç®—ç¬¦"></a>Java è¿ç®—ç¬¦</h1><p>Java ä¸­çš„è¿ç®—ç¬¦ä¸ C ä¸­åŸºæœ¬ä¸€è‡´ã€‚</p><h2 id="ç®—æœ¯è¿ç®—ç¬¦"><a href="#ç®—æœ¯è¿ç®—ç¬¦" class="headerlink" title="ç®—æœ¯è¿ç®—ç¬¦"></a>ç®—æœ¯è¿ç®—ç¬¦</h2><table><thead><tr><th>æ“ä½œç¬¦</th><th>æè¿°</th><th>ä¾‹å­</th></tr></thead><tbody><tr><td><code>+</code></td><td>åŠ æ³• : ç›¸åŠ è¿ç®—ç¬¦ä¸¤ä¾§çš„å€¼</td><td><code>A + B</code> ç­‰äº 30</td></tr><tr><td><code>-</code></td><td>å‡æ³• : å·¦æ“ä½œæ•°å‡å»å³æ“ä½œæ•°</td><td><code>A â€“ B</code> ç­‰äº -10</td></tr><tr><td><code>*</code></td><td>ä¹˜æ³• : ç›¸ä¹˜æ“ä½œç¬¦ä¸¤ä¾§çš„å€¼</td><td><code>A * B</code> ç­‰äº200</td></tr><tr><td><code>/</code></td><td>é™¤æ³• : å·¦æ“ä½œæ•°é™¤ä»¥å³æ“ä½œæ•°</td><td><code>B / A</code> ç­‰äº2</td></tr><tr><td><code>++</code></td><td>è‡ªå¢: æ“ä½œæ•°çš„å€¼å¢åŠ 1</td><td><code>B++</code> æˆ– <code>++B</code> ç­‰äº 21</td></tr><tr><td><code>--</code></td><td>è‡ªå‡: æ“ä½œæ•°çš„å€¼å‡å°‘1</td><td><code>B--</code> æˆ– <code>--B</code> ç­‰äº 19</td></tr></tbody></table><h2 id="å…³ç³»è¿ç®—ç¬¦"><a href="#å…³ç³»è¿ç®—ç¬¦" class="headerlink" title="å…³ç³»è¿ç®—ç¬¦"></a>å…³ç³»è¿ç®—ç¬¦</h2><table><thead><tr><th>è¿ç®—ç¬¦</th><th>æè¿°</th><th>ä¾‹å­</th></tr></thead><tbody><tr><td><code>==</code></td><td>æ£€æŸ¥å¦‚æœä¸¤ä¸ªæ“ä½œæ•°çš„å€¼æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰åˆ™æ¡ä»¶ä¸ºçœŸã€‚</td><td><code>(A == B)</code>ä¸ºå‡ã€‚</td></tr><tr><td><code>!=</code></td><td>æ£€æŸ¥å¦‚æœä¸¤ä¸ªæ“ä½œæ•°çš„å€¼æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœå€¼ä¸ç›¸ç­‰åˆ™æ¡ä»¶ä¸ºçœŸã€‚</td><td><code>(A != B)</code> ä¸ºçœŸã€‚</td></tr><tr><td><code>&gt;</code></td><td>æ£€æŸ¥å·¦æ“ä½œæ•°çš„å€¼æ˜¯å¦å¤§äºå³æ“ä½œæ•°çš„å€¼ï¼Œå¦‚æœæ˜¯é‚£ä¹ˆæ¡ä»¶ä¸ºçœŸã€‚</td><td><code>(A &gt; B)</code>ä¸ºå‡ã€‚</td></tr><tr><td><code>&lt;</code></td><td>æ£€æŸ¥å·¦æ“ä½œæ•°çš„å€¼æ˜¯å¦å°äºå³æ“ä½œæ•°çš„å€¼ï¼Œå¦‚æœæ˜¯é‚£ä¹ˆæ¡ä»¶ä¸ºçœŸã€‚</td><td><code>(A &lt; B)</code>ä¸ºçœŸã€‚</td></tr><tr><td><code>&gt;=</code></td><td>æ£€æŸ¥å·¦æ“ä½œæ•°çš„å€¼æ˜¯å¦å¤§äºæˆ–ç­‰äºå³æ“ä½œæ•°çš„å€¼ï¼Œå¦‚æœæ˜¯é‚£ä¹ˆæ¡ä»¶ä¸ºçœŸã€‚</td><td><code>(A &gt;= B)</code>ä¸ºå‡ã€‚</td></tr><tr><td><code>&lt;=</code></td><td>æ£€æŸ¥å·¦æ“ä½œæ•°çš„å€¼æ˜¯å¦å°äºæˆ–ç­‰äºå³æ“ä½œæ•°çš„å€¼ï¼Œå¦‚æœæ˜¯é‚£ä¹ˆæ¡ä»¶ä¸ºçœŸã€‚</td><td><code>(A &lt;= B)</code>ä¸ºçœŸã€‚</td></tr></tbody></table><h2 id="é€»è¾‘è¿ç®—ç¬¦"><a href="#é€»è¾‘è¿ç®—ç¬¦" class="headerlink" title="é€»è¾‘è¿ç®—ç¬¦"></a>é€»è¾‘è¿ç®—ç¬¦</h2><table><thead><tr><th>æ“ä½œç¬¦</th><th>æè¿°</th><th>ä¾‹å­</th></tr></thead><tbody><tr><td><code>&amp;&amp;</code></td><td>ç§°ä¸ºé€»è¾‘ä¸è¿ç®—ç¬¦ã€‚å½“ä¸”ä»…å½“ä¸¤ä¸ªæ“ä½œæ•°éƒ½ä¸ºçœŸï¼Œæ¡ä»¶æ‰ä¸ºçœŸã€‚</td><td><code>(A &amp;&amp; B)</code> ä¸ºå‡ã€‚</td></tr><tr><td>`</td><td></td><td>`</td></tr><tr><td><code>!</code></td><td>ç§°ä¸ºé€»è¾‘éè¿ç®—ç¬¦ã€‚ç”¨æ¥åè½¬æ“ä½œæ•°çš„é€»è¾‘çŠ¶æ€ã€‚å¦‚æœæ¡ä»¶ä¸ºtrueï¼Œåˆ™é€»è¾‘éè¿ç®—ç¬¦å°†å¾—åˆ°falseã€‚</td><td><code>!(A &amp;&amp; B)</code> ä¸ºçœŸã€‚</td></tr></tbody></table><h2 id="ä½è¿ç®—ç¬¦"><a href="#ä½è¿ç®—ç¬¦" class="headerlink" title="ä½è¿ç®—ç¬¦"></a>ä½è¿ç®—ç¬¦</h2><table><thead><tr><th>æ“ä½œç¬¦</th><th>æè¿°</th><th>ä¾‹å­</th></tr></thead><tbody><tr><td><code>ï¼†</code></td><td>å¦‚æœç›¸å¯¹åº”ä½éƒ½æ˜¯1ï¼Œåˆ™ç»“æœä¸º1ï¼Œå¦åˆ™ä¸º0</td><td><code>(Aï¼†B)</code>ï¼Œå¾—åˆ°12ï¼Œå³0000 1100</td></tr><tr><td>`</td><td>`</td><td>å¦‚æœç›¸å¯¹åº”ä½éƒ½æ˜¯0ï¼Œåˆ™ç»“æœä¸º0ï¼Œå¦åˆ™ä¸º1</td></tr><tr><td><code>^</code></td><td>å¦‚æœç›¸å¯¹åº”ä½å€¼ç›¸åŒï¼Œåˆ™ç»“æœä¸º0ï¼Œå¦åˆ™ä¸º1</td><td><code>(A ^ B)</code>å¾—åˆ°49ï¼Œå³ 0011 0001</td></tr><tr><td><code>~</code></td><td>æŒ‰ä½å–åè¿ç®—ç¬¦ç¿»è½¬æ“ä½œæ•°çš„æ¯ä¸€ä½ï¼Œå³0å˜æˆ1ï¼Œ1å˜æˆ0ã€‚</td><td><code>(ã€œA)</code>å¾—åˆ°-61ï¼Œå³1100 0011</td></tr><tr><td><code>&lt;&lt;</code></td><td>æŒ‰ä½å·¦ç§»è¿ç®—ç¬¦ã€‚å·¦æ“ä½œæ•°æŒ‰ä½å·¦ç§»å³æ“ä½œæ•°æŒ‡å®šçš„ä½æ•°ã€‚</td><td><code>A &lt;&lt; 2</code> å¾—åˆ°240ï¼Œå³ 1111 0000</td></tr><tr><td><code>&gt;&gt;</code></td><td>æŒ‰ä½å³ç§»è¿ç®—ç¬¦ã€‚å·¦æ“ä½œæ•°æŒ‰ä½å³ç§»å³æ“ä½œæ•°æŒ‡å®šçš„ä½æ•°ã€‚</td><td><code>A &gt;&gt; 2</code> å¾—åˆ°15å³ 1111</td></tr><tr><td><code>&gt;&gt;&gt;</code></td><td>æŒ‰ä½å³ç§»è¡¥é›¶æ“ä½œç¬¦ã€‚å·¦æ“ä½œæ•°çš„å€¼æŒ‰å³æ“ä½œæ•°æŒ‡å®šçš„ä½æ•°å³ç§»ï¼Œç§»åŠ¨å¾—åˆ°çš„ç©ºä½ä»¥é›¶å¡«å……ã€‚</td><td><code>A&gt;&gt;&gt;2</code> å¾—åˆ°15å³0000 1111</td></tr></tbody></table><h2 id="èµ‹å€¼è¿ç®—ç¬¦"><a href="#èµ‹å€¼è¿ç®—ç¬¦" class="headerlink" title="èµ‹å€¼è¿ç®—ç¬¦"></a>èµ‹å€¼è¿ç®—ç¬¦</h2><table><thead><tr><th>æ“ä½œç¬¦</th><th>æè¿°</th><th>ä¾‹å­</th></tr></thead><tbody><tr><td><code>=</code></td><td>ç®€å•çš„èµ‹å€¼è¿ç®—ç¬¦ï¼Œå°†å³æ“ä½œæ•°çš„å€¼èµ‹ç»™å·¦ä¾§æ“ä½œæ•°</td><td><code>C = A + B</code> å°†æŠŠA + Bå¾—åˆ°çš„å€¼èµ‹ç»™C</td></tr><tr><td><code>+=</code></td><td>åŠ å’Œèµ‹å€¼æ“ä½œç¬¦ï¼Œå®ƒæŠŠå·¦æ“ä½œæ•°å’Œå³æ“ä½œæ•°ç›¸åŠ èµ‹å€¼ç»™å·¦æ“ä½œæ•°</td><td><code>C += A</code> ç­‰ä»·äºC = C + A</td></tr></tbody></table><p>ç±»ä¼¼ <code>+=</code> ï¼Œå…¶ä»–çš„<em>ç®—æ•°è¿ç®—ç¬¦</em>ã€<em>ä½è¿ç®—ç¬¦</em>ã€<em>é€»è¾‘è¿ç®—ç¬¦</em>éƒ½å¯ä»¥åŠ åœ¨ <code>=</code> å‰é¢ã€‚</p><h2 id="æ¡ä»¶è¿ç®—ç¬¦"><a href="#æ¡ä»¶è¿ç®—ç¬¦" class="headerlink" title="æ¡ä»¶è¿ç®—ç¬¦"></a>æ¡ä»¶è¿ç®—ç¬¦</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">variable x = (expression) ? value_if_true : value_if_false;</span><br></pre></td></tr></table></figure><h2 id="instanceof-è¿ç®—ç¬¦"><a href="#instanceof-è¿ç®—ç¬¦" class="headerlink" title="instanceof è¿ç®—ç¬¦"></a><code>instanceof</code> è¿ç®—ç¬¦</h2><p>è¯¥è¿ç®—ç¬¦ç”¨äºæ“ä½œå¯¹è±¡å®ä¾‹ï¼Œæ£€æŸ¥è¯¥å¯¹è±¡æ˜¯å¦æ˜¯ä¸€ä¸ªç‰¹å®šç±»å‹ï¼ˆç±»ç±»å‹æˆ–æ¥å£ç±»å‹ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">variable <span class="keyword">instanceof</span> class_or_interface_type_name;</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String name &#x3D; &quot;James&quot;;</span><br><span class="line">boolean result &#x3D; name instanceof String; &#x2F;&#x2F; ç”±äº name æ˜¯ String ç±»å‹ï¼Œæ‰€ä»¥è¿”å›çœŸ</span><br></pre></td></tr></table></figure><h2 id="è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§"><a href="#è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§" class="headerlink" title="è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§"></a>è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§</h2><p>è¯¦è§<a href="http://www.runoob.com/java/java-operators.html">å‚è€ƒ</a>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java-ä¿®é¥°ç¬¦</title>
      <link href="/2019/04/17/Java_intro/Day6_Java_Modifier/"/>
      <url>/2019/04/17/Java_intro/Day6_Java_Modifier/</url>
      
        <content type="html"><![CDATA[<h1 id="Java-ä¿®é¥°ç¬¦"><a href="#Java-ä¿®é¥°ç¬¦" class="headerlink" title="Java ä¿®é¥°ç¬¦"></a>Java ä¿®é¥°ç¬¦</h1><blockquote><p>ä¿®é¥°ç¬¦ç”¨æ¥å®šä¹‰ç±»ã€æ–¹æ³•æˆ–è€…å˜é‡ï¼Œé€šå¸¸æ”¾åœ¨è¯­å¥çš„æœ€å‰ç«¯ã€‚</p></blockquote><p>Java ä¸­çš„<strong>ä¿®é¥°ç¬¦</strong>ä¸»è¦åˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li>è®¿é—®ä¿®é¥°ç¬¦ï¼šJava é€šè¿‡è®¿é—®æ§åˆ¶ç¬¦æ¥ä¿æŠ¤å¯¹ç±»ã€å˜é‡ã€æ–¹æ³•å’Œæ„é€ æ–¹æ³•çš„è®¿é—®ï¼›</li><li>éè®¿é—®ä¿®é¥°ç¬¦ï¼šJava ä¸ºäº†å®ç°ä¸€äº›å…¶ä»–çš„åŠŸèƒ½è€Œè®¾å®šçš„ä¿®é¥°ç¬¦ï¼›</li></ul><h2 id="è®¿é—®ä¿®é¥°ç¬¦"><a href="#è®¿é—®ä¿®é¥°ç¬¦" class="headerlink" title="è®¿é—®ä¿®é¥°ç¬¦"></a>è®¿é—®ä¿®é¥°ç¬¦</h2><p>Javaä¸­ï¼Œå¯ä»¥ä½¿ç”¨è®¿é—®æ§åˆ¶ç¬¦æ¥ä¿æŠ¤å¯¹ç±»ã€å˜é‡ã€æ–¹æ³•å’Œæ„é€ æ–¹æ³•çš„è®¿é—®ã€‚Java æ”¯æŒ 4 ç§ä¸åŒçš„è®¿é—®æƒé™ã€‚</p><ul><li><code>default</code> (ç¼ºçœå€¼ï¼‰: åœ¨åŒä¸€åŒ…å†…å¯è§ï¼Œä¸ä½¿ç”¨ä»»ä½•ä¿®é¥°ç¬¦ã€‚ä½¿ç”¨å¯¹è±¡ï¼šç±»ã€æ¥å£ã€å˜é‡ã€æ–¹æ³•ã€‚</li><li><code>private</code> : åœ¨åŒä¸€ç±»å†…å¯è§ã€‚ä½¿ç”¨å¯¹è±¡ï¼šå˜é‡ã€æ–¹æ³•ã€‚ æ³¨æ„ï¼šä¸èƒ½ä¿®é¥°ç±»ï¼ˆå¤–éƒ¨ç±»ï¼‰</li><li><code>public</code> : å¯¹æ‰€æœ‰ç±»å¯è§ã€‚ä½¿ç”¨å¯¹è±¡ï¼šç±»ã€æ¥å£ã€å˜é‡ã€æ–¹æ³•</li><li><code>protected</code> : å¯¹åŒä¸€åŒ…å†…çš„ç±»å’Œæ‰€æœ‰å­ç±»å¯è§ã€‚ä½¿ç”¨å¯¹è±¡ï¼šå˜é‡ã€æ–¹æ³•ã€‚ æ³¨æ„ï¼šä¸èƒ½ä¿®é¥°ç±»ï¼ˆå¤–éƒ¨ç±»ï¼‰ã€‚<ul><li>å­ç±»ä¸åŸºç±»åœ¨åŒä¸€åŒ…ä¸­ï¼šè¢«å£°æ˜ä¸º <code>protected</code> çš„å˜é‡ã€æ–¹æ³•å’Œæ„é€ å™¨èƒ½è¢«åŒä¸€ä¸ªåŒ…ä¸­çš„ä»»ä½•å…¶ä»–ç±»è®¿é—®ï¼›</li><li>å­ç±»ä¸åŸºç±»ä¸åœ¨åŒä¸€åŒ…ä¸­ï¼šé‚£ä¹ˆåœ¨å­ç±»ä¸­ï¼Œå­ç±»å®ä¾‹å¯ä»¥è®¿é—®å…¶ä»åŸºç±»ç»§æ‰¿è€Œæ¥çš„ <code>protected</code> æ–¹æ³•ï¼Œè€Œä¸èƒ½è®¿é—®åŸºç±»å®ä¾‹çš„ <code>protected</code> æ–¹æ³•ã€‚</li></ul></li></ul><table><thead><tr><th>ä¿®é¥°ç¬¦</th><th>å½“å‰ç±»</th><th>åŒä¸€åŒ…å†…</th><th>å­å­™ç±»(åŒä¸€åŒ…)</th><th>å­å­™ç±»(ä¸åŒåŒ…)</th><th>å…¶ä»–åŒ…</th></tr></thead><tbody><tr><td>public</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>protected</td><td>Y</td><td>Y</td><td>Y</td><td>Y/N</td><td>N</td></tr><tr><td>default</td><td>Y</td><td>Y</td><td>Y</td><td>N</td><td>N</td></tr><tr><td>private</td><td>Y</td><td>N</td><td>N</td><td>N</td><td>N</td></tr></tbody></table><p>âš ï¸ã€æ³¨æ„ã€‘</p><ol><li>åœ¨ä¸å†™ä»»ä½•ä¿®é¥°ç¬¦çš„æƒ…å†µä¸‹ï¼ˆå¦‚ <code>int a = 1;</code>ï¼‰ï¼Œ<strong>æ¥å£</strong> é‡Œçš„å˜é‡éƒ½éšå¼å£°æ˜ä¸º <code>public static final</code>,è€Œæ¥å£é‡Œçš„æ–¹æ³•é»˜è®¤æƒ…å†µä¸‹è®¿é—®æƒé™ä¸º <code>public</code>ã€‚</li><li><code>protected</code> å¯ä»¥ä¿®é¥°æ•°æ®æˆå‘˜ï¼Œæ„é€ æ–¹æ³•ï¼Œæ–¹æ³•æˆå‘˜ï¼Œä¸èƒ½ä¿®é¥°ç±»ï¼ˆå†…éƒ¨ç±»é™¤å¤–ï¼‰ã€‚æ¥å£åŠæ¥å£çš„æˆå‘˜å˜é‡å’Œæˆå‘˜æ–¹æ³•ä¸èƒ½å£°æ˜ä¸º <code>protected</code>ã€‚è¯¦è§<a href="http://www.runoob.com/w3cnote/java-protected-keyword-detailed-explanation.html">å‚è€ƒ</a> ã€‚</li></ol><h4 id="è®¿é—®æ§åˆ¶ç¬¦çš„ç»§æ‰¿"><a href="#è®¿é—®æ§åˆ¶ç¬¦çš„ç»§æ‰¿" class="headerlink" title="è®¿é—®æ§åˆ¶ç¬¦çš„ç»§æ‰¿"></a>è®¿é—®æ§åˆ¶ç¬¦çš„ç»§æ‰¿</h4><ul><li>çˆ¶ç±»ä¸­å£°æ˜ä¸º <code>public</code> çš„æ–¹æ³•åœ¨å­ç±»ä¸­ä¹Ÿå¿…é¡»ä¸º <code>public</code> ã€‚</li><li>çˆ¶ç±»ä¸­å£°æ˜ä¸º <code>protected</code> çš„æ–¹æ³•åœ¨å­ç±»ä¸­è¦ä¹ˆå£°æ˜ä¸º <code>protected</code> ï¼Œè¦ä¹ˆå£°æ˜ä¸º <code>public</code> ï¼Œä¸èƒ½å£°æ˜ä¸º <code>private</code> ã€‚</li><li>çˆ¶ç±»ä¸­å£°æ˜ä¸º <code>private</code> çš„æ–¹æ³•ï¼Œä¸èƒ½å¤Ÿè¢«ç»§æ‰¿ã€‚</li></ul><h2 id="éè®¿é—®ä¿®é¥°ç¬¦"><a href="#éè®¿é—®ä¿®é¥°ç¬¦" class="headerlink" title="éè®¿é—®ä¿®é¥°ç¬¦"></a>éè®¿é—®ä¿®é¥°ç¬¦</h2><h4 id="static-ä¿®é¥°ç¬¦"><a href="#static-ä¿®é¥°ç¬¦" class="headerlink" title="static ä¿®é¥°ç¬¦"></a><code>static</code> ä¿®é¥°ç¬¦</h4><ul><li><p>é™æ€å˜é‡ï¼š<br><code>static</code> å…³é”®å­—ç”¨æ¥å£°æ˜ç‹¬ç«‹äºå¯¹è±¡çš„é™æ€å˜é‡ï¼Œæ— è®ºä¸€ä¸ªç±»å®ä¾‹åŒ–å¤šå°‘å¯¹è±¡ï¼Œå®ƒçš„é™æ€å˜é‡åªæœ‰ä¸€ä»½æ‹·è´ã€‚ é™æ€å˜é‡ä¹Ÿè¢«ç§°ä¸ºç±»å˜é‡ã€‚å±€éƒ¨å˜é‡ä¸èƒ½è¢«å£°æ˜ä¸º <code>static</code> å˜é‡ã€‚</p></li><li><p>é™æ€æ–¹æ³•ï¼š<br><code>static</code> å…³é”®å­—ç”¨æ¥å£°æ˜ç‹¬ç«‹äºå¯¹è±¡çš„é™æ€æ–¹æ³•ã€‚é™æ€æ–¹æ³•ä¸èƒ½ä½¿ç”¨ç±»çš„éé™æ€å˜é‡ã€‚é™æ€æ–¹æ³•ä»å‚æ•°åˆ—è¡¨å¾—åˆ°æ•°æ®ï¼Œç„¶åè®¡ç®—è¿™äº›æ•°æ®ã€‚</p></li></ul><p>å¯¹ç±»å˜é‡å’Œæ–¹æ³•çš„è®¿é—®å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>classname.variablename</code> å’Œ <code>classname.methodname</code> çš„æ–¹å¼è®¿é—®ã€‚</p><h4 id="final-ä¿®é¥°ç¬¦"><a href="#final-ä¿®é¥°ç¬¦" class="headerlink" title="final ä¿®é¥°ç¬¦"></a><code>final</code> ä¿®é¥°ç¬¦</h4><ul><li><code>final</code> å˜é‡:<br>å¸¸é‡ï¼Œä¸€æ—¦èµ‹å€¼åï¼Œä¸èƒ½è¢«é‡æ–°èµ‹å€¼ã€‚</li><li><code>final</code> ç±»:<br>ä¸èƒ½è¢«ç»§æ‰¿ï¼Œæ²¡æœ‰ç±»èƒ½å¤Ÿç»§æ‰¿ <code>final</code> ç±»çš„ä»»ä½•ç‰¹æ€§ã€‚</li><li><code>final</code> æ–¹æ³•:<br>ç±»ä¸­çš„ final æ–¹æ³•å¯ä»¥è¢«å­ç±»ç»§æ‰¿ï¼Œä½†æ˜¯ä¸èƒ½è¢«å­ç±»ä¿®æ”¹ã€‚<br>å£°æ˜ final æ–¹æ³•çš„ä¸»è¦ç›®çš„æ˜¯é˜²æ­¢è¯¥æ–¹æ³•çš„å†…å®¹è¢«ä¿®æ”¹ã€‚</li></ul><p><code>final</code> ä¿®é¥°ç¬¦é€šå¸¸å’Œ static ä¿®é¥°ç¬¦ä¸€èµ·ä½¿ç”¨æ¥åˆ›å»ºç±»å¸¸é‡ã€‚</p><h4 id="abstract-ä¿®é¥°ç¬¦"><a href="#abstract-ä¿®é¥°ç¬¦" class="headerlink" title="abstract ä¿®é¥°ç¬¦"></a><code>abstract</code> ä¿®é¥°ç¬¦</h4><ul><li>æŠ½è±¡ç±»ï¼š<br>æŠ½è±¡ç±»ä¸èƒ½ç”¨æ¥å®ä¾‹åŒ–å¯¹è±¡ï¼Œå£°æ˜æŠ½è±¡ç±»çš„å”¯ä¸€ç›®çš„æ˜¯ä¸ºäº†å°†æ¥å¯¹è¯¥ç±»è¿›è¡Œæ‰©å……ã€‚</li></ul><p>ä¸€ä¸ªç±»ä¸èƒ½åŒæ—¶è¢« abstract å’Œ final ä¿®é¥°ã€‚</p><p>æŠ½è±¡ç±»å¯ä»¥åŒ…å«æŠ½è±¡æ–¹æ³•å’ŒéæŠ½è±¡æ–¹æ³•ã€‚</p><p>ä»»ä½•ç»§æ‰¿æŠ½è±¡ç±»çš„å­ç±»å¿…é¡»å®ç°çˆ¶ç±»çš„æ‰€æœ‰æŠ½è±¡æ–¹æ³•ï¼Œé™¤éè¯¥å­ç±»ä¹Ÿæ˜¯æŠ½è±¡ç±»ã€‚</p><ul><li>æŠ½è±¡æ–¹æ³•ï¼š<br>æŠ½è±¡æ–¹æ³•æ˜¯ä¸€ç§æ²¡æœ‰ä»»ä½•å®ç°çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„çš„å…·ä½“å®ç°ç”±å­ç±»æä¾›ã€‚</li></ul><p>æŠ½è±¡æ–¹æ³•ä¸èƒ½è¢«å£°æ˜æˆ final å’Œ staticã€‚</p><p>âš ï¸ã€æ³¨æ„ã€‘å¦‚æœä¸€ä¸ªç±»åŒ…å«æŠ½è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆè¯¥ç±»ä¸€å®šè¦å£°æ˜ä¸ºæŠ½è±¡ç±»ï¼Œå¦åˆ™å°†å‡ºç°ç¼–è¯‘é”™è¯¯ã€‚</p><h4 id="synchronized-ä¿®é¥°ç¬¦"><a href="#synchronized-ä¿®é¥°ç¬¦" class="headerlink" title="synchronized ä¿®é¥°ç¬¦"></a><code>synchronized</code> ä¿®é¥°ç¬¦</h4><p><code>synchronized</code> å…³é”®å­—å£°æ˜çš„æ–¹æ³•åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ã€‚</p><h4 id="transient-ä¿®é¥°ç¬¦"><a href="#transient-ä¿®é¥°ç¬¦" class="headerlink" title="transient ä¿®é¥°ç¬¦"></a><code>transient</code> ä¿®é¥°ç¬¦</h4><p>è¯¦è§ <a href="http://www.runoob.com/java/java-modifier-types.html">å‚è€ƒ</a>ã€‚</p><h4 id="volatile-ä¿®é¥°ç¬¦"><a href="#volatile-ä¿®é¥°ç¬¦" class="headerlink" title="volatile ä¿®é¥°ç¬¦"></a><code>volatile</code> ä¿®é¥°ç¬¦</h4><p>è¯¦è§ <a href="http://www.runoob.com/java/java-modifier-types.html">å‚è€ƒ</a>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java-å˜é‡</title>
      <link href="/2019/04/16/Java_intro/Day5_Java_Variable/"/>
      <url>/2019/04/16/Java_intro/Day5_Java_Variable/</url>
      
        <content type="html"><![CDATA[<h1 id="Java-ä¸­çš„å˜é‡ç±»å‹"><a href="#Java-ä¸­çš„å˜é‡ç±»å‹" class="headerlink" title="Java ä¸­çš„å˜é‡ç±»å‹"></a>Java ä¸­çš„å˜é‡ç±»å‹</h1><h2 id="å±€éƒ¨å˜é‡"><a href="#å±€éƒ¨å˜é‡" class="headerlink" title="å±€éƒ¨å˜é‡"></a><strong>å±€éƒ¨å˜é‡</strong></h2><blockquote><p>åœ¨<em>æ–¹æ³•</em>æˆ–<em>è¯­å¥å—</em>ä¸­å®šä¹‰çš„å˜é‡è¢«ç§°ä¸ºå±€éƒ¨å˜é‡ã€‚å˜é‡å£°æ˜å’Œåˆå§‹åŒ–éƒ½æ˜¯åœ¨æ–¹æ³•ä¸­ï¼Œæ–¹æ³•ç»“æŸåï¼Œå˜é‡å°±ä¼šè‡ªåŠ¨é”€æ¯ã€‚</p></blockquote><ul><li>å±€éƒ¨å˜é‡å£°æ˜åœ¨æ–¹æ³•ã€æ„é€ æ–¹æ³•æˆ–è€…è¯­å¥å—ä¸­ï¼›</li><li>å±€éƒ¨å˜é‡åœ¨æ–¹æ³•ã€æ„é€ æ–¹æ³•ã€æˆ–è€…è¯­å¥å—è¢«æ‰§è¡Œçš„æ—¶å€™åˆ›å»ºï¼Œå½“å®ƒä»¬æ‰§è¡Œå®Œæˆåï¼Œå˜é‡å°†ä¼šè¢«é”€æ¯ï¼›</li><li>è®¿é—®ä¿®é¥°ç¬¦ä¸èƒ½ç”¨äºå±€éƒ¨å˜é‡ï¼›</li><li>å±€éƒ¨å˜é‡åªåœ¨å£°æ˜å®ƒçš„æ–¹æ³•ã€æ„é€ æ–¹æ³•æˆ–è€…è¯­å¥å—ä¸­å¯è§ï¼›</li><li>å±€éƒ¨å˜é‡æ˜¯åœ¨æ ˆä¸Šåˆ†é…çš„ã€‚</li><li>å±€éƒ¨å˜é‡æ²¡æœ‰é»˜è®¤å€¼ï¼Œæ‰€ä»¥å±€éƒ¨å˜é‡è¢«å£°æ˜åï¼Œå¿…é¡»ç»è¿‡åˆå§‹åŒ–ï¼Œæ‰å¯ä»¥ä½¿ç”¨ã€‚</li></ul><h2 id="æˆå‘˜å˜é‡-å®ä¾‹å˜é‡"><a href="#æˆå‘˜å˜é‡-å®ä¾‹å˜é‡" class="headerlink" title="æˆå‘˜å˜é‡(å®ä¾‹å˜é‡)"></a><strong>æˆå‘˜å˜é‡(å®ä¾‹å˜é‡)</strong></h2><blockquote><p>æˆå‘˜å˜é‡æ˜¯å®šä¹‰åœ¨ç±»ä¸­ï¼Œ<em>æ–¹æ³•ä½“ä¹‹å¤–</em>çš„å˜é‡ã€‚è¿™ç§å˜é‡åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™å®ä¾‹åŒ–ã€‚æˆå‘˜å˜é‡å¯ä»¥è¢«ç±»ä¸­æ–¹æ³•ã€æ„é€ æ–¹æ³•å’Œç‰¹å®šç±»çš„è¯­å¥å—è®¿é—®ã€‚</p></blockquote><ul><li>å®ä¾‹å˜é‡å£°æ˜åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œä½†åœ¨æ–¹æ³•ã€æ„é€ æ–¹æ³•å’Œè¯­å¥å—ä¹‹å¤–ï¼›</li><li>å½“ä¸€ä¸ªå¯¹è±¡è¢«å®ä¾‹åŒ–ä¹‹åï¼Œæ¯ä¸ªå®ä¾‹å˜é‡çš„å€¼å°±è·Ÿç€ç¡®å®šï¼›</li><li>å®ä¾‹å˜é‡åœ¨å¯¹è±¡åˆ›å»ºçš„æ—¶å€™åˆ›å»ºï¼Œåœ¨å¯¹è±¡è¢«é”€æ¯çš„æ—¶å€™é”€æ¯ï¼›</li><li>å®ä¾‹å˜é‡çš„å€¼åº”è¯¥è‡³å°‘è¢«ä¸€ä¸ªæ–¹æ³•ã€æ„é€ æ–¹æ³•æˆ–è€…è¯­å¥å—å¼•ç”¨ï¼Œä½¿å¾—å¤–éƒ¨èƒ½å¤Ÿé€šè¿‡è¿™äº›æ–¹å¼è·å–å®ä¾‹å˜é‡ä¿¡æ¯ï¼›</li><li>å®ä¾‹å˜é‡å¯ä»¥å£°æ˜åœ¨ä½¿ç”¨å‰æˆ–è€…ä½¿ç”¨åï¼›</li><li>è®¿é—®ä¿®é¥°ç¬¦å¯ä»¥ä¿®é¥°å®ä¾‹å˜é‡ï¼›</li><li>å®ä¾‹å˜é‡å¯¹äºç±»ä¸­çš„æ–¹æ³•ã€æ„é€ æ–¹æ³•æˆ–è€…è¯­å¥å—æ˜¯å¯è§çš„ã€‚ä¸€èˆ¬æƒ…å†µä¸‹åº”è¯¥æŠŠå®ä¾‹å˜é‡è®¾ä¸ºç§æœ‰ã€‚é€šè¿‡ä½¿ç”¨è®¿é—®ä¿®é¥°ç¬¦å¯ä»¥ä½¿å®ä¾‹å˜é‡å¯¹å­ç±»å¯è§ï¼›</li><li>å®ä¾‹å˜é‡å…·æœ‰é»˜è®¤å€¼ã€‚æ•°å€¼å‹å˜é‡çš„é»˜è®¤å€¼æ˜¯<code>0</code>ï¼Œå¸ƒå°”å‹å˜é‡çš„é»˜è®¤å€¼æ˜¯<code>false</code>ï¼Œå¼•ç”¨ç±»å‹å˜é‡çš„é»˜è®¤å€¼æ˜¯<code>null</code>ã€‚å˜é‡çš„å€¼å¯ä»¥åœ¨å£°æ˜æ—¶æŒ‡å®šï¼Œä¹Ÿå¯ä»¥åœ¨æ„é€ æ–¹æ³•ä¸­æŒ‡å®šï¼›</li><li>å®ä¾‹å˜é‡å¯ä»¥ç›´æ¥é€šè¿‡å˜é‡åè®¿é—®ã€‚ä½†åœ¨é™æ€æ–¹æ³•ä»¥åŠå…¶ä»–ç±»ä¸­ï¼Œå°±åº”è¯¥ä½¿ç”¨å®Œå…¨é™å®šåï¼š<code>ObejectReference.VariableName</code>ã€‚</li></ul><h2 id="ç±»å˜é‡"><a href="#ç±»å˜é‡" class="headerlink" title="ç±»å˜é‡"></a><strong>ç±»å˜é‡</strong></h2><blockquote><p>ç±»å˜é‡ä¹Ÿå£°æ˜åœ¨ç±»ä¸­ï¼Œæ–¹æ³•ä½“ä¹‹å¤–ï¼Œä½†å¿…é¡»å£°æ˜ä¸º <code>static</code> ç±»å‹ã€‚</p></blockquote><ul><li>ç±»å˜é‡ä¹Ÿç§°ä¸ºé™æ€å˜é‡ï¼Œåœ¨ç±»ä¸­ä»¥ <code>static</code> å…³é”®å­—å£°æ˜ï¼Œä½†å¿…é¡»åœ¨æ–¹æ³•ä¹‹å¤–ã€‚</li><li>æ— è®ºä¸€ä¸ªç±»åˆ›å»ºäº†å¤šå°‘ä¸ªå¯¹è±¡ï¼Œç±»åªæ‹¥æœ‰ç±»å˜é‡çš„ä¸€ä»½æ‹·è´ã€‚</li><li>é™æ€å˜é‡é™¤äº†è¢«å£°æ˜ä¸ºå¸¸é‡å¤–å¾ˆå°‘ä½¿ç”¨ã€‚å¸¸é‡æ˜¯æŒ‡å£°æ˜ä¸º <code>public</code> / <code>private</code>, <code>final</code> å’Œ <code>static</code> ç±»å‹çš„å˜é‡ã€‚å¸¸é‡åˆå§‹åŒ–åä¸å¯æ”¹å˜ã€‚</li><li>é™æ€å˜é‡å‚¨å­˜åœ¨é™æ€å­˜å‚¨åŒºã€‚ç»å¸¸è¢«å£°æ˜ä¸ºå¸¸é‡ï¼Œå¾ˆå°‘å•ç‹¬ä½¿ç”¨ <code>static</code> å£°æ˜å˜é‡ã€‚</li><li>é™æ€å˜é‡åœ¨ç¬¬ä¸€æ¬¡è¢«è®¿é—®æ—¶åˆ›å»ºï¼Œåœ¨ç¨‹åºç»“æŸæ—¶é”€æ¯ã€‚</li><li>ä¸å®ä¾‹å˜é‡å…·æœ‰ç›¸ä¼¼çš„å¯è§æ€§ã€‚ä½†ä¸ºäº†å¯¹ç±»çš„ä½¿ç”¨è€…å¯è§ï¼Œå¤§å¤šæ•°é™æ€å˜é‡å£°æ˜ä¸º <code>public</code> ç±»å‹ã€‚</li><li>é»˜è®¤å€¼å’Œå®ä¾‹å˜é‡ç›¸ä¼¼ã€‚æ•°å€¼å‹å˜é‡é»˜è®¤å€¼æ˜¯ <code>0</code>ï¼Œå¸ƒå°”å‹é»˜è®¤å€¼æ˜¯ <code>false</code>ï¼Œå¼•ç”¨ç±»å‹é»˜è®¤å€¼æ˜¯ <code>null</code>ã€‚å˜é‡çš„å€¼å¯ä»¥åœ¨å£°æ˜çš„æ—¶å€™æŒ‡å®šï¼Œä¹Ÿå¯ä»¥åœ¨æ„é€ æ–¹æ³•ä¸­æŒ‡å®šã€‚æ­¤å¤–ï¼Œé™æ€å˜é‡è¿˜å¯ä»¥åœ¨é™æ€è¯­å¥å—ä¸­åˆå§‹åŒ–ã€‚</li><li>é™æ€å˜é‡å¯ä»¥é€šè¿‡ï¼š<code>ClassName.VariableName</code> çš„æ–¹å¼è®¿é—®ã€‚</li><li>ç±»å˜é‡è¢«å£°æ˜ä¸º <code>public static final</code> ç±»å‹æ—¶ï¼Œç±»å˜é‡åç§°ä¸€èˆ¬å»ºè®®ä½¿ç”¨å¤§å†™å­—æ¯ã€‚å¦‚æœé™æ€å˜é‡ä¸æ˜¯ <code>public</code> å’Œ <code>final</code> ç±»å‹ï¼Œå…¶å‘½åæ–¹å¼ä¸å®ä¾‹å˜é‡ä»¥åŠå±€éƒ¨å˜é‡çš„å‘½åæ–¹å¼ä¸€è‡´ã€‚</li></ul><h4 id="å…³äº-ç±»å˜é‡-çš„è¯´æ˜ï¼š"><a href="#å…³äº-ç±»å˜é‡-çš„è¯´æ˜ï¼š" class="headerlink" title="å…³äº ç±»å˜é‡ çš„è¯´æ˜ï¼š"></a>å…³äº <strong>ç±»å˜é‡</strong> çš„è¯´æ˜ï¼š</h4><blockquote><p>The static keyword in Java is used for memory management mainly. We can apply java static keyword with variables, methods, blocks and nested class. The static keyword belongs to the class than an instance of the class. The static can be: Variable (also known as a class variable) Method (also known as a class method) Block.</p></blockquote><p>ï¼ˆéƒ¨åˆ†ç¿»è¯‘ï¼‰</p><blockquote><p>Java ä¸­çš„ <code>static</code> å…³é”®å­—ä¸»è¦ç”¨äº <em>memory management</em>ï¼ˆè°·æ­Œç¿»è¯‘ç»™å‡ºçš„ç¿»è¯‘æ˜¯â€œå†…å­˜ç®¡ç†â€, ä½†æˆ‘å¯¹è¿™ä¸ªè¯çš„ç†è§£æ˜¯ï¼šå®‰æ’å‡ºä¸€ä¸ªå†…å­˜ç©ºé—´æ¥ï¼Œä¾›ç±»çš„å®ä¾‹ä¹‹é—´å…±äº«æŸä¸ªé‡ï¼‰ã€‚æˆ‘ä»¬å¯ä»¥å°† java çš„ <code>static</code> å…³é”®å­—æ–½ç”¨äºå˜é‡ã€æ–¹æ³•ã€è¯­å¥å—å’ŒåµŒå¥—ç±»ã€‚<code>static</code> å®šä¹‰çš„å¯¹è±¡æ˜¯å±äºæ•´ä¸ªç±»çš„, è€Œä¸æ˜¯æŸä¸ªç±»çš„å®ä¾‹ã€‚</p></blockquote><p>æ™®é€šçš„å˜é‡å±äºç±»çš„æŸä¸€ä¸ªç‰¹å®šçš„å®ä¾‹ï¼Œä½†ç”¨ <code>static</code> å…³é”®å­—ä¿®é¥°çš„å˜é‡å°†å±äºä¸€ä¸ªç±»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬é€šè¿‡ç±»çš„æŸä¸€ä¸ªå®ä¾‹å»ä¿®æ”¹ä¸€ä¸ªä¸€èˆ¬çš„å˜é‡å€¼ï¼Œå°†åªæœ‰è¿™ä¸ªå®ä¾‹ä¸­çš„å€¼è¢«ä¿®æ”¹ï¼Œå…¶ä»–å®ä¾‹ä¸å—å½±å“ï¼›è€Œè‹¥æ˜¯ä¿®æ”¹ä¸€ä¸ª <code>static</code> å…³é”®å­—ä¿®é¥°çš„<strong>ç±»å˜é‡</strong>ï¼Œè¿™ä¸ªç±»çš„æ‰€æœ‰å®ä¾‹çš„è¿™ä¸ªå€¼éƒ½ä¼šè¢«ä¿®æ”¹ã€‚</p><p>è¯´èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œå¯ä»¥çœ‹ä¸€æ®µç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Static</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">Example foo = <span class="keyword">new</span> Example();</span><br><span class="line">Example bar = <span class="keyword">new</span> Example();</span><br><span class="line"></span><br><span class="line">foo.staticVar = foo.normalVar = <span class="string">&quot;foobar&quot;</span>;</span><br><span class="line"></span><br><span class="line">System.out.println(foo.staticVar + <span class="string">&quot;\t&quot;</span> + foo.normalVar);</span><br><span class="line">System.out.println(bar.staticVar + <span class="string">&quot;\t&quot;</span> + bar.normalVar);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>&#123;</span><br><span class="line"><span class="keyword">static</span> String staticVar = <span class="string">&quot;Example&quot;</span>;</span><br><span class="line">String normalVar = <span class="string">&quot;Example&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">foobarfoobar</span><br><span class="line">foobarExample</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åªæ”¹å˜äº† <code>foo</code> å®ä¾‹çš„å€¼ï¼Œä½†ç”± <code>static</code> ä¿®é¥°çš„ç±»å˜é‡ <code>staticVar</code> çš„æ”¹å˜åœ¨ <code>bar</code> ä¸­ä¹Ÿå‡ºç°äº†ï¼Œè€Œæ™®é€šçš„æˆå‘˜å˜é‡åˆ™ä¸ç„¶ã€‚</p><p>åˆ©ç”¨è¿™ç§ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ç§å¯ä»¥ç»Ÿè®¡è‡ªå·±çš„å®ä¾‹ä¸ªæ•°çš„ç±»ï¼Œè¯¦è§ <a href="src/CountingClass.java"><code>CountingClass.java</code></a></p><hr><p>ç›¸å…³ä»£ç ï¼š</p><p><a href="src/Static.java"><code>Static.java</code></a><br><a href="src/CountingClass.java"><code>CountingClass.java</code></a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java-åŸºæœ¬æ•°æ®ç±»å‹</title>
      <link href="/2019/04/15/Java_intro/Day4_Java_Types/"/>
      <url>/2019/04/15/Java_intro/Day4_Java_Types/</url>
      
        <content type="html"><![CDATA[<h1 id="Java-åŸºæœ¬æ•°æ®ç±»å‹"><a href="#Java-åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="Java åŸºæœ¬æ•°æ®ç±»å‹"></a>Java åŸºæœ¬æ•°æ®ç±»å‹</h1><p>Java çš„ä¸¤å¤§æ•°æ®ç±»å‹:</p><ul><li>å†…ç½®æ•°æ®ç±»å‹</li><li>å¼•ç”¨æ•°æ®ç±»å‹</li></ul><h2 id="å†…ç½®æ•°æ®ç±»å‹"><a href="#å†…ç½®æ•°æ®ç±»å‹" class="headerlink" title="å†…ç½®æ•°æ®ç±»å‹"></a>å†…ç½®æ•°æ®ç±»å‹</h2><p>å¯¹äºæ¯ä¸€ç§ æ•°æ®ç±»å‹ éƒ½æœ‰ä¸€ä¸ª <strong>åŒ…è£…ç±»</strong>ï¼Œå¦‚ï¼š<code>void</code>ç±»å‹çš„åŒ…è£…ç±»æ˜¯ <code>java.lang.Void</code>ã€‚</p><p>å¯¹äºæ•°å€¼ç±»å‹çš„åŒ…è£…ç±»ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ä»ä¸­è·å–å¯¹åº”ç±»å‹çš„äºŒè¿›åˆ¶ä½æ•°ã€å–å€¼èŒƒå›´ã€‚</p><table><thead><tr><th>åŸè¯­</th><th>å¯¹åº”çš„ JDK ç±»</th></tr></thead><tbody><tr><td>boolean</td><td>java.lang.Boolean</td></tr><tr><td>byte</td><td>java.lang.Byte</td></tr><tr><td>char</td><td>java.lang.Character</td></tr><tr><td>short</td><td>java.lang.Short</td></tr><tr><td>int</td><td>java.lang.Integer</td></tr><tr><td>long</td><td>java.lang.Long</td></tr><tr><td>float</td><td>java.lang.Float</td></tr><tr><td>double</td><td>java.lang.Double</td></tr></tbody></table><p>å…·ä½“çš„ä¾‹å­ï¼Œè§ <a href="./src/PrimitiveTypes.java"><code>PrimitiveTypes.java</code></a></p><p>ä¸‹é¢ï¼Œåˆ†ç±»ä»‹ç» Java ä¸­çš„å†…ç½®æ•°æ®ç±»å‹ï¼š</p><h3 id="void"><a href="#void" class="headerlink" title="void"></a>void</h3><p>ä»£è¡¨ç©ºçš„å€¼çš„ç±»å‹ã€‚</p><h3 id="æ•´æ•°å‹"><a href="#æ•´æ•°å‹" class="headerlink" title="æ•´æ•°å‹"></a>æ•´æ•°å‹</h3><table><thead><tr><th>ç±»å‹</th><th>è¯´æ˜</th><th>èŒƒå›´</th><th>é»˜è®¤å€¼</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><code>byte</code></td><td>8ä½, æœ‰ç¬¦å·, ä»¥äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºçš„æ•´æ•°</td><td><code>-128</code>~`127`</td><td><code>0</code></td><td>ç”¨åœ¨å¤§å‹æ•°ç»„ä¸­èŠ‚çº¦ç©ºé—´</td></tr><tr><td><code>short</code></td><td>16ä½, æœ‰ç¬¦å·, ä»¥äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºçš„æ•´æ•°</td><td><code>-32768</code>~`32767`</td><td><code>0</code></td><td></td></tr><tr><td><code>int</code></td><td>32ä½, æœ‰ç¬¦å·, ä»¥äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºçš„æ•´æ•°</td><td><code>-2147483648</code>~`2147483647`</td><td><code>0</code></td><td>ä¸€èˆ¬åœ°æ•´å‹å˜é‡é»˜è®¤ä¸º int ç±»å‹</td></tr><tr><td><code>long</code></td><td>64ä½, æœ‰ç¬¦å·, ä»¥äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºçš„æ•´æ•°</td><td><code>-2^63</code>~`2^63-1`</td><td><code>0L</code></td><td>å­—é¢å€¼å¸¸é‡æ˜¯æ•°åé¢åŠ â€Lâ€(â€œLâ€ç†è®ºä¸Šä¸åˆ†å¤§å°å†™ï¼Œä½†å°å†™ä¸æ˜“åˆ†è¾©ï¼Œæœ€å¥½å¤§å†™)</td></tr></tbody></table><p>æ•´å‹å­—é¢å€¼å¸¸é‡éƒ½å¯ä»¥ç”¨å(æ­£å¸¸ä¹¦å†™)ã€å…«(ä»¥<code>0</code>å¼€å¤´)ã€åå…­(ä»¥<code>0x</code>å¼€å¤´)è¿›åˆ¶è¡¨ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int decimal &#x3D; 100;</span><br><span class="line">int octal &#x3D; 0114;</span><br><span class="line">int hexadecimal &#x3D; 0x64;</span><br></pre></td></tr></table></figure><h3 id="æµ®ç‚¹å‹"><a href="#æµ®ç‚¹å‹" class="headerlink" title="æµ®ç‚¹å‹"></a>æµ®ç‚¹å‹</h3><blockquote><p>æµ®ç‚¹æ•°ä¸èƒ½ç”¨æ¥è¡¨ç¤ºç²¾ç¡®çš„å€¼ã€‚</p></blockquote><table><thead><tr><th>ç±»å‹</th><th>è¯´æ˜</th><th>é»˜è®¤å€¼</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><code>float</code></td><td>å•ç²¾åº¦ã€32ä½ã€ç¬¦åˆ IEEE 754 æ ‡å‡†çš„æµ®ç‚¹æ•°</td><td><code>0.0f</code></td><td>float åœ¨å‚¨å­˜å¤§å‹æµ®ç‚¹æ•°ç»„çš„æ—¶å€™å¯èŠ‚çœå†…å­˜ç©ºé—´</td></tr><tr><td><code>double</code></td><td>åŒç²¾åº¦ã€64 ä½ã€ç¬¦åˆIEEE 754æ ‡å‡†çš„æµ®ç‚¹æ•°</td><td><code>0.0d</code></td><td>æµ®ç‚¹æ•°çš„é»˜è®¤ç±»å‹ä¸ºdoubleç±»å‹</td></tr></tbody></table><h3 id="å­—ç¬¦å‹"><a href="#å­—ç¬¦å‹" class="headerlink" title="å­—ç¬¦å‹"></a>å­—ç¬¦å‹</h3><table><thead><tr><th>ç±»å‹</th><th>è¯´æ˜</th><th>èŒƒå›´</th><th>é»˜è®¤å€¼</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><code>char</code></td><td>charç±»å‹æ˜¯ä¸€ä¸ªå•ä¸€çš„ 16 ä½ Unicode å­—ç¬¦</td><td><code>\u0000</code>~`\uffff`</td><td>å­—é¢å€¼å¸¸é‡æ˜¯å•å¼•å·é‡Œå­—ç¬¦(å¦‚ï¼š<code>&#39;A&#39;</code>)</td><td></td></tr></tbody></table><h3 id="å¸ƒå°”å‹"><a href="#å¸ƒå°”å‹" class="headerlink" title="å¸ƒå°”å‹"></a>å¸ƒå°”å‹</h3><table><thead><tr><th>ç±»å‹</th><th>è¯´æ˜</th><th>å–å€¼</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td><code>boolean</code></td><td>è¡¨ç¤ºä¸€ä½çš„ä¿¡æ¯</td><td><code>true</code> å’Œ <code>false</code></td><td><code>false</code></td></tr></tbody></table><h2 id="å¼•ç”¨æ•°æ®ç±»å‹"><a href="#å¼•ç”¨æ•°æ®ç±»å‹" class="headerlink" title="å¼•ç”¨æ•°æ®ç±»å‹"></a>å¼•ç”¨æ•°æ®ç±»å‹</h2><blockquote><p>å¼•ç”¨ç±»å‹æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼ŒæŒ‡å‘å¯¹è±¡çš„å˜é‡æ˜¯å¼•ç”¨å˜é‡ã€‚</p></blockquote><p>å¯¹è±¡ã€æ•°ç»„éƒ½æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ã€‚</p><p>æ‰€æœ‰å¼•ç”¨ç±»å‹çš„é»˜è®¤å€¼éƒ½æ˜¯ <code>null</code>ã€‚</p><p>å¼•ç”¨å˜é‡ä¸€æ—¦å£°æ˜åï¼Œç±»å‹å°±ä¸èƒ½è¢«æ”¹å˜äº†ï¼Œä½†ä¸€ä¸ªå¼•ç”¨å˜é‡å¯ä»¥ç”¨æ¥å¼•ç”¨ä»»ä½•ä¸ä¹‹å…¼å®¹çš„ç±»å‹ã€‚</p><h2 id="Java-å˜é‡"><a href="#Java-å˜é‡" class="headerlink" title="Java å˜é‡"></a>Java å˜é‡</h2><p>å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œéœ€è¦ä½¿ç”¨å¦‚ä¸‹çš„æ ¼å¼çš„è¯­å¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type varName;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥åœ¨å£°æ˜çš„åŒæ—¶ï¼Œå¯¹å®ƒåˆå§‹åŒ–ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type varName &#x3D; initialValue;</span><br></pre></td></tr></table></figure><p>ã€æ³¨ã€‘åˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä½¿ç”¨ï¼š<code>ClassName instanceName = new ClassName();</code></p><h3 id="å¸¸é‡"><a href="#å¸¸é‡" class="headerlink" title="å¸¸é‡"></a>å¸¸é‡</h3><p>å¸¸é‡åœ¨ç¨‹åºè¿è¡Œæ—¶æ˜¯ä¸èƒ½è¢«ä¿®æ”¹çš„ã€‚</p><h4 id="å­—é¢å€¼å¸¸é‡"><a href="#å­—é¢å€¼å¸¸é‡" class="headerlink" title="å­—é¢å€¼å¸¸é‡"></a>å­—é¢å€¼å¸¸é‡</h4><p>å­—é¢å€¼å¸¸é‡ï¼Œå°±æ˜¯ç›´æ¥åœ¨ç¨‹åºé‡Œå†™ä¸€ä¸ªå€¼ï¼Œæ¯”å¦‚ <code>100</code>, <code>-100.0</code>, <code>&#39;A&#39;</code>â€¦<br>è¿™ä¸ªä¸œè¥¿å¾ˆå¥½ç†è§£ï¼Œç‰¹æ®Šçš„å·²ç»åœ¨ä¸Šé¢çš„å†…ç½®ç±»å‹è¡¨æ ¼ä¸­æœ‰è¯´æ˜äº†ã€‚</p><p>å­—é¢å€¼å¸¸é‡å¯ä»¥èµ‹ç»™ä»»ä½•å†…ç½®ç±»å‹çš„å˜é‡ã€‚</p><h4 id="å£°æ˜å¸¸é‡"><a href="#å£°æ˜å¸¸é‡" class="headerlink" title="å£°æ˜å¸¸é‡"></a>å£°æ˜å¸¸é‡</h4><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åƒå£°æ˜å˜é‡ä¸€æ ·å£°æ˜ä¸€ä¸ªå¸¸é‡ã€‚</p><p>åœ¨ Java ä¸­ï¼Œä½¿ç”¨ <code>final</code> å…³é”®å­—æ¥ä¿®é¥°å¸¸é‡ï¼Œå£°æ˜æ–¹å¼å’Œå˜é‡ç±»ä¼¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">final double PI &#x3D; 3.1415927;</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§æƒ¯ä¾‹ï¼Œå¸¸é‡ååº”è¯¥ç”¨<strong>å…¨éƒ¨å¤§å†™</strong>çš„åç§°è¡¨ç¤ºã€‚</p><h4 id="å­—ç¬¦ä¸²å¸¸é‡"><a href="#å­—ç¬¦ä¸²å¸¸é‡" class="headerlink" title="å­—ç¬¦ä¸²å¸¸é‡"></a>å­—ç¬¦ä¸²å¸¸é‡</h4><p>å’Œå…¶ä»–è¯­è¨€ä¸€æ ·ï¼ŒJavaçš„å­—ç¬¦ä¸²å¸¸é‡ä¹Ÿæ˜¯åŒ…å«åœ¨ä¸¤ä¸ªå¼•å·ä¹‹é—´çš„å­—ç¬¦åºåˆ—ï¼Œå…¶ä¸­å¯ä»¥ä½¿ç”¨è½¬ä¹‰å­—ç¬¦ï¼Œä¹Ÿå¯ä»¥å«æœ‰Unicodeå­—ç¬¦ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;Hello World&quot;</span><br><span class="line">&quot;two\nlines&quot;</span><br><span class="line">&quot;\&quot;This is in quotes\&quot;&quot;</span><br><span class="line">&quot;\u0001&quot;</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨çš„è½¬ä¹‰å­—ç¬¦å¦‚ä¸‹ï¼š</p><table><thead><tr><th>ç¬¦å·</th><th>å­—ç¬¦å«ä¹‰</th></tr></thead><tbody><tr><td><code>\n</code></td><td>æ¢è¡Œ (0x0a)</td></tr><tr><td><code>\r</code></td><td>å›è½¦ (0x0d)</td></tr><tr><td><code>\f</code></td><td>æ¢é¡µç¬¦(0x0c)</td></tr><tr><td><code>\b</code></td><td>é€€æ ¼ (0x08)</td></tr><tr><td><code>\0</code></td><td>ç©ºå­—ç¬¦ (0x20)</td></tr><tr><td><code>\t</code></td><td>åˆ¶è¡¨ç¬¦</td></tr><tr><td><code>\&quot;</code></td><td>åŒå¼•å·</td></tr><tr><td><code>\&#39;</code></td><td>å•å¼•å·</td></tr><tr><td><code>\\</code></td><td>åæ–œæ </td></tr><tr><td><code>\ddd</code></td><td>å…«è¿›åˆ¶å­—ç¬¦ (ddd)</td></tr><tr><td><code>\uxxxx</code></td><td>16è¿›åˆ¶Unicodeå­—ç¬¦ (xxxx)</td></tr></tbody></table><h3 id="ç±»å‹è½¬æ¢"><a href="#ç±»å‹è½¬æ¢" class="headerlink" title="ç±»å‹è½¬æ¢"></a>ç±»å‹è½¬æ¢</h3><p>Java ä¸­ç±»å‹çš„è½¬æ¢æœ‰ä»¥ä¸‹è§„åˆ™ï¼š</p><ol><li>ä¸èƒ½å¯¹booleanç±»å‹è¿›è¡Œç±»å‹è½¬æ¢ã€‚</li><li>ä¸èƒ½æŠŠå¯¹è±¡ç±»å‹è½¬æ¢æˆä¸ç›¸å…³ç±»çš„å¯¹è±¡ã€‚</li><li>åœ¨æŠŠå®¹é‡å¤§çš„ç±»å‹è½¬æ¢ä¸ºå®¹é‡å°çš„ç±»å‹æ—¶å¿…é¡»ä½¿ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚</li><li>è½¬æ¢è¿‡ç¨‹ä¸­å¯èƒ½å¯¼è‡´æº¢å‡ºæˆ–æŸå¤±ç²¾åº¦ã€‚</li><li>æµ®ç‚¹æ•°åˆ°æ•´æ•°çš„è½¬æ¢æ˜¯é€šè¿‡èˆå¼ƒå°æ•°å¾—åˆ°ï¼Œè€Œä¸æ˜¯å››èˆäº”å…¥ã€‚</li></ol><h4 id="è‡ªåŠ¨ç±»å‹è½¬æ¢"><a href="#è‡ªåŠ¨ç±»å‹è½¬æ¢" class="headerlink" title="è‡ªåŠ¨ç±»å‹è½¬æ¢"></a>è‡ªåŠ¨ç±»å‹è½¬æ¢</h4><p>åœ¨è‡ªåŠ¨ç±»å‹è½¬æ¢ä¸­ï¼Œç±»å‹æ€»æ˜¯ä»<strong>ä½çº§</strong>åˆ°<strong>é«˜çº§</strong>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ä½  ----------------------------------------&gt;  é«˜</span><br><span class="line"></span><br><span class="line">byte, short, char â€”&gt; int â€”&gt; long â€”&gt; float â€”&gt; double </span><br></pre></td></tr></table></figure><p>âš ï¸ã€æ³¨æ„ã€‘åœ¨è¿›è¡Œæ•´æ•°è¿ç®—æ—¶ï¼Œå¦‚æœæ˜¯ä¸¤ä¸ªæ¯”intç±»å‹å°çš„ç±»å‹åšè¿ç®—ï¼Œjavaåœ¨ç¼–è¯‘çš„æ—¶å€™å°±ä¼šå°†å®ƒä»¬ç»Ÿä¸€å¼ºè½¬æˆintç±»å‹ã€‚å½“æœ‰æ¯”intç±»å‹å¤§çš„ç±»å‹è¿ç®—æ—¶ï¼Œä¼šè‡ªåŠ¨è½¬æ¢æˆå®ƒä»¬ä¸­æœ€å¤§ç±»å‹é‚£ä¸ªã€‚</p><h4 id="å¼ºåˆ¶ç±»å‹è½¬æ¢"><a href="#å¼ºåˆ¶ç±»å‹è½¬æ¢" class="headerlink" title="å¼ºåˆ¶ç±»å‹è½¬æ¢"></a>å¼ºåˆ¶ç±»å‹è½¬æ¢</h4><p>é€šè¿‡ä¸‹é¢è¿™ç§è¯­å¥å¯ä»¥å¼ºåˆ¶ç±»å‹è½¬åŒ–ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(type)value</span><br></pre></td></tr></table></figure><p>âš ï¸ã€æ³¨æ„ã€‘è½¬æ¢çš„æ•°æ®ç±»å‹å¿…é¡»æ˜¯å…¼å®¹çš„ã€‚</p><h4 id="æ•°æ®ç±»å‹è½¬æ¢çš„è¡¥å……"><a href="#æ•°æ®ç±»å‹è½¬æ¢çš„è¡¥å……" class="headerlink" title="æ•°æ®ç±»å‹è½¬æ¢çš„è¡¥å……"></a>æ•°æ®ç±»å‹è½¬æ¢çš„è¡¥å……</h4><h5 id="1ã€åŒ…è£…ç±»è¿‡æ¸¡ç±»å‹è½¬æ¢"><a href="#1ã€åŒ…è£…ç±»è¿‡æ¸¡ç±»å‹è½¬æ¢" class="headerlink" title="1ã€åŒ…è£…ç±»è¿‡æ¸¡ç±»å‹è½¬æ¢"></a>1ã€åŒ…è£…ç±»è¿‡æ¸¡ç±»å‹è½¬æ¢</h5><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é¦–å…ˆå£°æ˜ä¸€ä¸ªå˜é‡ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„åŒ…è£…ç±»ï¼Œå°±å¯ä»¥åˆ©ç”¨åŒ…è£…ç±»çš„å„ç§æ–¹æ³•è¿›è¡Œç±»å‹è½¬æ¢äº†ã€‚</p><p>ä¾‹å¦‚ï¼š</p><p>å½“å¸Œæœ›æŠŠfloatå‹è½¬æ¢ä¸ºdoubleå‹æ—¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> f1 = <span class="number">100.00f</span>;</span><br><span class="line">Float F1 = <span class="keyword">new</span> Float(f1);</span><br><span class="line"><span class="keyword">double</span> d1 = F1.doubleValue();     <span class="comment">//F1.doubleValue()ä¸ºFloatç±»çš„è¿”å›doubleå€¼å‹çš„æ–¹æ³•</span></span><br></pre></td></tr></table></figure><p>ç®€å•ç±»å‹çš„å˜é‡è½¬æ¢ä¸ºç›¸åº”çš„åŒ…è£…ç±»ï¼Œå¯ä»¥åˆ©ç”¨åŒ…è£…ç±»çš„æ„é€ å‡½æ•°ã€‚<br>å³ï¼š<code>Boolean(boolean value)ã€Character(char value)</code>ã€<code>Integer(int value)</code>ã€<code>Long(long value)</code>ã€<code>Float(float value)</code>ã€<code>Double(double value)</code>ã€‚</p><p>è€Œåœ¨å„ä¸ªåŒ…è£…ç±»ä¸­ï¼Œæ€»æœ‰å½¢ä¸º <code>Ã—Ã—Value()</code> çš„æ–¹æ³•ï¼Œæ¥å¾—åˆ°å…¶å¯¹åº”çš„ç®€å•ç±»å‹æ•°æ®ã€‚<br>åˆ©ç”¨è¿™ç§æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥å®ç°ä¸åŒæ•°å€¼å‹å˜é‡é—´çš„è½¬æ¢ã€‚<br>ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ªåŒç²¾åº¦å®å‹ç±»ï¼Œ<code>intValue()</code> å¯ä»¥å¾—åˆ°å…¶å¯¹åº”çš„æ•´å‹å˜é‡ï¼Œè€Œ <code>doubleValue()</code> å¯ä»¥å¾—åˆ°å…¶å¯¹åº”çš„åŒç²¾åº¦å®å‹å˜é‡ã€‚</p><h5 id="2ã€å­—ç¬¦ä¸²ä¸å…¶å®ƒç±»å‹é—´çš„è½¬æ¢"><a href="#2ã€å­—ç¬¦ä¸²ä¸å…¶å®ƒç±»å‹é—´çš„è½¬æ¢" class="headerlink" title="2ã€å­—ç¬¦ä¸²ä¸å…¶å®ƒç±»å‹é—´çš„è½¬æ¢"></a>2ã€å­—ç¬¦ä¸²ä¸å…¶å®ƒç±»å‹é—´çš„è½¬æ¢</h5><h6 id="å…¶å®ƒç±»å‹å‘å­—ç¬¦ä¸²çš„è½¬æ¢"><a href="#å…¶å®ƒç±»å‹å‘å­—ç¬¦ä¸²çš„è½¬æ¢" class="headerlink" title="å…¶å®ƒç±»å‹å‘å­—ç¬¦ä¸²çš„è½¬æ¢"></a>å…¶å®ƒç±»å‹å‘å­—ç¬¦ä¸²çš„è½¬æ¢</h6><ol><li>è°ƒç”¨ç±»çš„ä¸²è½¬æ¢æ–¹æ³•: <code>X.toString();</code></li><li>è‡ªåŠ¨è½¬æ¢: <code>X+&quot;&quot;;</code></li><li>ä½¿ç”¨Stringçš„æ–¹æ³•: <code>String.valueOf(X);</code></li></ol><p>âš ï¸ã€æ³¨æ„ã€‘åœ¨ä½¿ç”¨ <code>2</code> æ—¶éœ€è¦æ³¨æ„ï¼š<strong>ä»»ä½•å­—ç¬¦ç±»å‹ä¸å­—ç¬¦ä¸²ç›¸åŠ ï¼Œç»“æœéƒ½æ˜¯æ‹¼æ¥ã€‚</strong><br>ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String s = <span class="keyword">null</span>;</span><br><span class="line">s += <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">System.out.println(s);  <span class="comment">// è¾“å‡º nullhello</span></span><br></pre></td></tr></table></figure><h6 id="å­—ç¬¦ä¸²ä½œä¸ºå€¼-å‘å…¶å®ƒç±»å‹çš„è½¬æ¢"><a href="#å­—ç¬¦ä¸²ä½œä¸ºå€¼-å‘å…¶å®ƒç±»å‹çš„è½¬æ¢" class="headerlink" title="å­—ç¬¦ä¸²ä½œä¸ºå€¼,å‘å…¶å®ƒç±»å‹çš„è½¬æ¢"></a>å­—ç¬¦ä¸²ä½œä¸ºå€¼,å‘å…¶å®ƒç±»å‹çš„è½¬æ¢</h6><ol><li>å…ˆè½¬æ¢æˆç›¸åº”çš„å°è£…å™¨å®ä¾‹,å†è°ƒç”¨å¯¹åº”çš„æ–¹æ³•è½¬æ¢æˆå…¶å®ƒç±»å‹</li></ol><p>ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸² <code>&quot;32.1&quot;</code> è½¬æ¢ <code>double</code> å‹çš„å€¼çš„æ ¼å¼ä¸º: <code>new Float(&quot;32.1&quot;).doubleValue()</code></p><p>ä¹Ÿå¯ä»¥ç”¨: <code>Double.valueOf(&quot;32.1&quot;).doubleValue()</code></p><ol start="2"><li>é™æ€parseXXXæ–¹æ³•</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">String s = <span class="string">&quot;1&quot;</span>;</span><br><span class="line"><span class="keyword">byte</span> b = Byte.parseByte( s );</span><br><span class="line"><span class="keyword">short</span> t = Short.parseShort( s );</span><br><span class="line"><span class="keyword">int</span> i = Integer.parseInt( s );</span><br><span class="line"><span class="keyword">long</span> l = Long.parseLong( s );</span><br><span class="line">Float f = Float.parseFloat( s );</span><br><span class="line">Double d = Double.parseDouble( s );</span><br></pre></td></tr></table></figure><h5 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><ol><li>åªæœ‰ boolean ä¸å‚ä¸æ•°æ®ç±»å‹çš„è½¬æ¢</li><li>è‡ªåŠ¨ç±»å‹çš„è½¬æ¢ï¼š<ul><li>å¸¸æ•°åœ¨è¡¨æ•°èŒƒå›´å†…æ˜¯èƒ½å¤Ÿè‡ªåŠ¨ç±»å‹è½¬æ¢çš„</li><li>æ•°æ®èŒƒå›´å°çš„èƒ½å¤Ÿè‡ªåŠ¨æ•°æ®ç±»å‹å¤§çš„è½¬æ¢</li><li>ç”±æµ®ç‚¹ç±»å‹è½¬æ¢æˆæ•´æ•°ç±»å‹ä¸ä¼šè‡ªåŠ¨è½¬æ¢çš„ï¼Œä¸ç„¶å°†ä¼šä¸¢å¤±ç²¾åº¦ã€‚</li><li>å¼•ç”¨ç±»å‹èƒ½å¤Ÿè‡ªåŠ¨è½¬æ¢ä¸ºçˆ¶ç±»çš„</li><li>åŸºæœ¬ç±»å‹å’Œå®ƒä»¬åŒ…è£…ç±»å‹æ˜¯èƒ½å¤Ÿäº’ç›¸è½¬æ¢çš„</li></ul></li><li>å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼šç”¨åœ†æ‹¬å·æ‹¬èµ·æ¥ç›®æ ‡ç±»å‹ï¼Œç½®äºå˜é‡å‰</li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java-ç±»å’Œå¯¹è±¡</title>
      <link href="/2019/04/14/Java_intro/Day3_Java_Class/"/>
      <url>/2019/04/14/Java_intro/Day3_Java_Class/</url>
      
        <content type="html"><![CDATA[<h1 id="Java-ä¸­çš„ç±»å’Œå¯¹è±¡"><a href="#Java-ä¸­çš„ç±»å’Œå¯¹è±¡" class="headerlink" title="Java ä¸­çš„ç±»å’Œå¯¹è±¡"></a>Java ä¸­çš„ç±»å’Œå¯¹è±¡</h1><blockquote><p>ç±»å¯ä»¥çœ‹æˆæ˜¯åˆ›å»ºJavaå¯¹è±¡çš„æ¨¡æ¿</p></blockquote><h2 id="ç±»çš„å®šä¹‰"><a href="#ç±»çš„å®šä¹‰" class="headerlink" title="ç±»çš„å®šä¹‰"></a>ç±»çš„å®šä¹‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sleep</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç±»ä¸­å˜é‡çš„ç±»å‹"><a href="#ç±»ä¸­å˜é‡çš„ç±»å‹" class="headerlink" title="ç±»ä¸­å˜é‡çš„ç±»å‹"></a>ç±»ä¸­å˜é‡çš„ç±»å‹</h2><ul><li><p><strong>å±€éƒ¨å˜é‡</strong>ï¼šåœ¨<em>æ–¹æ³•</em>æˆ–<em>è¯­å¥å—</em>ä¸­å®šä¹‰çš„å˜é‡è¢«ç§°ä¸ºå±€éƒ¨å˜é‡ã€‚å˜é‡å£°æ˜å’Œåˆå§‹åŒ–éƒ½æ˜¯åœ¨æ–¹æ³•ä¸­ï¼Œæ–¹æ³•ç»“æŸåï¼Œå˜é‡å°±ä¼šè‡ªåŠ¨é”€æ¯ã€‚</p></li><li><p>*<em>æˆå‘˜å˜é‡(å®ä¾‹å˜é‡)**ï¼šæˆå‘˜å˜é‡æ˜¯å®šä¹‰åœ¨ç±»ä¸­ï¼Œ</em>æ–¹æ³•ä½“ä¹‹å¤–*çš„å˜é‡ã€‚è¿™ç§å˜é‡åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™å®ä¾‹åŒ–ã€‚æˆå‘˜å˜é‡å¯ä»¥è¢«ç±»ä¸­æ–¹æ³•ã€æ„é€ æ–¹æ³•å’Œç‰¹å®šç±»çš„è¯­å¥å—è®¿é—®ã€‚</p></li><li><p><strong>ç±»å˜é‡</strong>ï¼šç±»å˜é‡ä¹Ÿå£°æ˜åœ¨ç±»ä¸­ï¼Œæ–¹æ³•ä½“ä¹‹å¤–ï¼Œä½†å¿…é¡»å£°æ˜ä¸º <code>static</code> ç±»å‹ã€‚</p></li></ul><blockquote><p>è¿™é‡Œåªæ˜¯ç®€å•ä»‹ç»ï¼Œè¯¦è§ <a href="./Day5_Java_Variable.md">Day5_Java_Variable.md</a></p></blockquote><h2 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h2><p>æ„é€ æ–¹æ³•çš„åç§°å¿…é¡»ä¸ç±»åŒåï¼Œä¸€ä¸ªç±»å¯ä»¥æœ‰å¤šä¸ªæ„é€ æ–¹æ³•ã€‚</p><p>åœ¨åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œè‡³å°‘è¦è°ƒç”¨ä¸€ä¸ªæ„é€ æ–¹æ³•ã€‚<br>å¦‚æœæ²¡æœ‰æ˜¾å¼åœ°ä¸ºç±»å®šä¹‰æ„é€ æ–¹æ³•ï¼ŒJavaç¼–è¯‘å™¨å°†ä¼šä¸ºè¯¥ç±»æä¾›ä¸€ä¸ªé»˜è®¤æ„é€ æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Dog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;æ„é€ Dog&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é‡è½½æ–¹æ³•"><a href="#é‡è½½æ–¹æ³•" class="headerlink" title="é‡è½½æ–¹æ³•"></a>é‡è½½æ–¹æ³•</h2><p>åˆ›å»ºä¸¤ä¸ªå…·æœ‰ç›¸åŒåç§°å’Œä¸åŒå‚æ•°åˆ—è¡¨ï¼ˆå³ä¸åŒçš„å‚æ•°æ•°é‡æˆ–ç±»å‹ï¼‰çš„æ–¹æ³•æ—¶ï¼Œå°±æ‹¥æœ‰äº†ä¸€ä¸ª<em>é‡è½½</em> æ–¹æ³•ã€‚</p><p>åœ¨è¿è¡Œæ—¶ï¼ŒJRE åŸºäºä¼ é€’ç»™å®ƒçš„å‚æ•°æ¥å†³å®šè°ƒç”¨æ‚¨çš„é‡è½½æ–¹æ³•çš„å“ªä¸ªå˜ä½“ã€‚</p><p>æˆ‘ä»¬ç”šè‡³å¯ä»¥åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­è°ƒç”¨å¦ä¸€ä¸ªåŒåçš„é‡è½½æ–¹æ³•ã€‚</p><p>ä½†è¦æ³¨æ„ï¼šåœ¨ä½¿ç”¨é‡è½½æ–¹æ³•æ—¶ï¼Œ</p><ul><li>ä¸èƒ½ä»…é€šè¿‡æ›´æ”¹ä¸€ä¸ªæ–¹æ³•çš„è¿”å›ç±»å‹æ¥é‡è½½å®ƒã€‚</li><li>ä¸èƒ½æ‹¥æœ‰ä¸¤ä¸ªå…·æœ‰ç›¸åŒåç§°å’Œç›¸åŒå‚æ•°åˆ—è¡¨çš„æ–¹æ³•ã€‚</li></ul><h2 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h2><p>è¦è¡¨ç¤ºä¸€ä¸ªç±»ç»§æ‰¿è‡ªæŸä¸€ä¸ªè¶…ç±»ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å£°æ˜ç±»æ—¶ï¼Œåœ¨ className ååŠ ä¸Š <code>extends</code>ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"><span class="comment">// Employee ç»§æ‰¿è‡ª Person</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Employee</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Employee</span><span class="params">(String name, <span class="keyword">int</span> age, <span class="keyword">int</span> height, <span class="keyword">int</span> weight,</span></span></span><br><span class="line"><span class="function"><span class="params">  String eyeColor, String gender)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name, age, height, weight, eyeColor, gender);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œè°ƒç”¨ <code>super([args])</code> æ¥åˆå§‹åŒ–çˆ¶ç±»ã€‚</p><h3 id="é‡å†™æ–¹æ³•"><a href="#é‡å†™æ–¹æ³•" class="headerlink" title="é‡å†™æ–¹æ³•"></a>é‡å†™æ–¹æ³•</h3><p>å¦‚æœä¸€ä¸ªå­ç±»æä¾›å…¶çˆ¶ç±»ä¸­å®šä¹‰çš„æ–¹æ³•çš„è‡ªæœ‰å®ç°ï¼Œè¿™è¢«ç§°ä¸º<em>æ–¹æ³•é‡å†™</em>ã€‚</p><p>é‡å†™çš„å½¢å¼ç±»ä¼¼äºé‡è½½ï¼Œä½†éœ€è¦åŠ ä¸Šä¸€ä¸ª <code>@Override</code>ã€‚ä¾‹å¦‚ï¼Œå½“çˆ¶ç±»ä¸­æœ‰ä¸€ä¸ª <code>foo()</code> æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å­ç±»ä¸­è¿™æ ·é‡å†™å®ƒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">super</span>.foo();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€æ³¨ã€‘è¿™æ®µä»£ç æ˜¯ä½¿ç”¨ Eclipse è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œå®ƒåªæ˜¯è°ƒç”¨äº†çˆ¶ç±»ä¸­çš„æ–¹æ³•ï¼ˆ<code>super.foo()</code>ï¼‰ï¼Œæ²¡æœ‰ä»»ä½•æ”¹å˜ï¼Œä½†å®é™…ä¸­æˆ‘ä»¬ä¸ä¼šè¿™ä¹ˆä½¿ç”¨ã€‚</p><p>é‡å†™åï¼Œ<strong>åœ¨ç±»ä¸­</strong>ç›´æ¥ä½¿ç”¨ <code>method()</code>è°ƒç”¨é‡å†™åçš„å‡½æ•°ï¼Œä½†æˆ‘ä»¬ä»»ç„¶å¯ä»¥é€šè¿‡ <code>super.method()</code> è°ƒç”¨çˆ¶ç±»ä¸­çš„ï¼ˆé‡å†™å‰çš„ï¼‰æ–¹æ³•ã€‚</p><h2 id="åˆ›å»ºå¯¹è±¡"><a href="#åˆ›å»ºå¯¹è±¡" class="headerlink" title="åˆ›å»ºå¯¹è±¡"></a>åˆ›å»ºå¯¹è±¡</h2><p>å¯¹è±¡æ˜¯æ ¹æ®ç±»åˆ›å»ºçš„ã€‚<br>åˆ›å»ºå¯¹è±¡éœ€è¦ä»¥ä¸‹ä¸‰æ­¥ï¼š</p><ul><li>å£°æ˜ï¼šå£°æ˜ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…æ‹¬å¯¹è±¡åç§°å’Œå¯¹è±¡ç±»å‹ã€‚</li><li>å®ä¾‹åŒ–ï¼šä½¿ç”¨å…³é”®å­— <code>new</code> æ¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡ã€‚</li><li>åˆå§‹åŒ–ï¼šä½¿ç”¨ <code>new</code> åˆ›å»ºå¯¹è±¡æ—¶ï¼Œä¼šè°ƒç”¨æ„é€ æ–¹æ³•åˆå§‹åŒ–å¯¹è±¡ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">Dog Dog0 = <span class="keyword">new</span> Dog();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è®¿é—®å®ä¾‹å˜é‡å’Œæ–¹æ³•"><a href="#è®¿é—®å®ä¾‹å˜é‡å’Œæ–¹æ³•" class="headerlink" title="è®¿é—®å®ä¾‹å˜é‡å’Œæ–¹æ³•"></a>è®¿é—®å®ä¾‹å˜é‡å’Œæ–¹æ³•</h2><ul><li>è®¿é—®å®ä¾‹çš„å˜é‡ï¼š<code>å®ä¾‹å.å˜é‡å</code></li><li>è°ƒç”¨å®ä¾‹çš„æ–¹æ³•ï¼š<code>å®ä¾‹å.æ–¹æ³•å()</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> </span>&#123;</span><br><span class="line">String name;</span><br><span class="line"><span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">eat</span><span class="params">(String food)</span> </span>&#123;</span><br><span class="line">System.out.println(name + <span class="string">&quot; is eating &quot;</span> + food + <span class="string">&quot;.&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Dog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">name = <span class="string">&quot;Dog&quot;</span>;</span><br><span class="line">age = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;æ„é€ ()ï¼š&quot;</span>);</span><br><span class="line">System.out.println(name + <span class="string">&quot;\t&quot;</span> + age);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Dog</span><span class="params">(String dogName, <span class="keyword">int</span> dogAge)</span> </span>&#123;</span><br><span class="line">name = dogName;</span><br><span class="line">age = dogAge;</span><br><span class="line">System.out.println(<span class="string">&quot;æ„é€ (name, age)ï¼š&quot;</span>);</span><br><span class="line">System.out.println(name + <span class="string">&quot;\t&quot;</span> + age);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">Dog Dog0 = <span class="keyword">new</span> Dog();</span><br><span class="line">Dog Dog1 = <span class="keyword">new</span> Dog(<span class="string">&quot;FooBar&quot;</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¿é—®å˜é‡ </span></span><br><span class="line">Dog0.name = <span class="string">&quot;Ana&quot;</span>;</span><br><span class="line">System.out.println(Dog0.name);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¿é—®æ–¹æ³•</span></span><br><span class="line">Dog1.eat(<span class="string">&quot;cat&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡ŒğŸ‘†ä¸Šé¢ä»£ç å°†è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">æ„é€ ()ï¼š</span><br><span class="line">Dog0</span><br><span class="line">æ„é€ (name, age)ï¼š</span><br><span class="line">FooBar3</span><br><span class="line">Ana</span><br><span class="line">FooBar is eating cat.</span><br></pre></td></tr></table></figure><h2 id="æ¯”è¾ƒå¯¹è±¡"><a href="#æ¯”è¾ƒå¯¹è±¡" class="headerlink" title="æ¯”è¾ƒå¯¹è±¡"></a>æ¯”è¾ƒå¯¹è±¡</h2><p>Java è¯­è¨€æä¾›äº†ä¸¤ç§æ¯”è¾ƒå¯¹è±¡çš„æ–¹æ³•ï¼š</p><ul><li><code>==</code> è¿ç®—ç¬¦ </li><li><code>equals()</code> æ–¹æ³•</li></ul><h3 id="ä½¿ç”¨-æ¯”è¾ƒå¯¹è±¡"><a href="#ä½¿ç”¨-æ¯”è¾ƒå¯¹è±¡" class="headerlink" title="ä½¿ç”¨ == æ¯”è¾ƒå¯¹è±¡"></a>ä½¿ç”¨ <code>==</code> æ¯”è¾ƒå¯¹è±¡</h3><p><code>==</code> è¯­æ³•æ¯”è¾ƒå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œåªæœ‰åœ¨ <code>a</code> å’Œ <code>b</code> ç›¸ç­‰æ—¶ï¼Œ<code>a == b</code> æ‰è¿”å› <code>true</code>ã€‚</p><p>å¯¹äºå†…ç½®åŸºæœ¬ç±»å‹ï¼Œéœ€è¦<em>å®ƒä»¬çš„å€¼ç›¸ç­‰</em>ã€‚</p><p>å¯¹äºå¯¹è±¡ï¼Œéœ€è¦ä¸¤ä¸ªå¯¹è±¡å¼•ç”¨<em>åŒä¸€ä¸ªå¯¹è±¡å®ä¾‹</em>ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.logging.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Equals</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">Logger l = Logger.getLogger(<span class="string">&quot;Test&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> i = <span class="number">12</span>,</span><br><span class="line">j = <span class="number">12</span>,</span><br><span class="line">k = <span class="number">99</span>;</span><br><span class="line">        </span><br><span class="line">Integer a = <span class="keyword">new</span> Integer(<span class="number">12</span>);</span><br><span class="line">Integer b = a;</span><br><span class="line">Integer c = <span class="keyword">new</span> Integer(<span class="number">12</span>);</span><br><span class="line"></span><br><span class="line">l.info(<span class="string">&quot;i == j: &quot;</span> + (i == j));</span><br><span class="line">l.info(<span class="string">&quot;i == k: &quot;</span> + (i == k));</span><br><span class="line"></span><br><span class="line">l.info(<span class="string">&quot;a == b: &quot;</span> + (a == b));</span><br><span class="line">l.info(<span class="string">&quot;a == c: &quot;</span> + (a == c));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œè¿™æ®µä»£ç å°†å¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">i &#x3D;&#x3D; j: true</span><br><span class="line">i &#x3D;&#x3D; k: false</span><br><span class="line">a &#x3D;&#x3D; b: true</span><br><span class="line">a &#x3D;&#x3D; c: false</span><br></pre></td></tr></table></figure><p>âš ï¸ã€æ³¨ã€‘è‹¥ä½¿ç”¨ <code>a = Integer.valueOf(12);</code> ä¸ <code>c = Integer.valueOf(12);</code> åˆ†åˆ«å¾—åˆ° a å’Œ cï¼Œåˆ™ <code>a == c</code> å°†æ˜¯ <code>true</code> ï¼</p><h3 id="ä½¿ç”¨-equals-æ¯”è¾ƒå¯¹è±¡"><a href="#ä½¿ç”¨-equals-æ¯”è¾ƒå¯¹è±¡" class="headerlink" title="ä½¿ç”¨ equals() æ¯”è¾ƒå¯¹è±¡"></a>ä½¿ç”¨ <code>equals()</code> æ¯”è¾ƒå¯¹è±¡</h3><blockquote><p><code>equals()</code> æ˜¯æ¯ç§ Java è¯­è¨€å¯¹è±¡éƒ½å¯ä»¥è‡ªç”±ä½¿ç”¨çš„æ–¹æ³•ï¼Œå› ä¸ºå®ƒè¢«å®šä¹‰ä¸º <code>java.lang.Object</code> çš„ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼ˆæ¯ä¸ª Java å¯¹è±¡éƒ½ç»§æ‰¿è¯¥å¯¹è±¡ï¼‰ã€‚</p></blockquote><p>è°ƒç”¨ <code>equals()</code> çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.equals(b);</span><br></pre></td></tr></table></figure><p>æ­¤è¯­å¥è°ƒç”¨å¯¹è±¡ <code>a</code> çš„ <code>equals()</code> æ–¹æ³•ï¼Œå‘å®ƒä¼ é€’å¯¹è±¡ <code>b</code> çš„å¼•ç”¨ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒJava ç¨‹åºä½¿ç”¨ <code>==</code> è¯­æ³•æ£€æŸ¥ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸åŒã€‚ä½†æ˜¯å› ä¸º <code>equals()</code> æ˜¯ä¸€ç§æ–¹æ³•ï¼Œæ‰€ä»¥å®ƒå¯ä»¥è¢«é‡å†™ã€‚è¿™æ ·ï¼Œå¯¹äºä»»ä½•å¯¹è±¡ï¼Œæˆ‘ä»¬éƒ½å¯å®šä¹‰é€‚åˆçš„ <code>equals()</code> çš„å«ä¹‰ã€‚</p><p>ã€æ³¨ã€‘åœ¨é‡å†™ <code>equals()</code> æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ <code>object.hashCode()</code>ï¼ˆ to return a hash code value for the object.ï¼‰</p><hr><p>ç›¸å…³ä»£ç ï¼š</p><p><a href="./src/Dog.java"><code>Dog.java</code></a></p><p>å‚è€ƒï¼š</p><p><a href="https://www.runoob.com/java/java-object-classes.html">èœé¸Ÿæ•™ç¨‹ | Java å¯¹è±¡å’Œç±»</a></p><p><a href="https://www.ibm.com/developerworks/cn/java/j-perry-next-steps-with-objects/index.html">Java ç¼–ç¨‹å…¥é—¨ |  ç¬¬ 13 å•å…ƒï¼šå¯¹è±¡çš„åç»­å¤„ç† </a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java-é¢å‘å¯¹è±¡</title>
      <link href="/2019/04/13/Java_intro/Day2_OOP/"/>
      <url>/2019/04/13/Java_intro/Day2_OOP/</url>
      
        <content type="html"><![CDATA[<h1 id="é¢å‘å¯¹è±¡æ€æƒ³"><a href="#é¢å‘å¯¹è±¡æ€æƒ³" class="headerlink" title="é¢å‘å¯¹è±¡æ€æƒ³"></a>é¢å‘å¯¹è±¡æ€æƒ³</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>éšç€è®¡ç®—æœºæŠ€æœ¯çš„å‘å±•ï¼Œæˆ‘ä»¬æƒ³ç”¨è®¡ç®—æœºæ¥è§£å†³è¶Šæ¥è¶Šå¤æ‚çš„é—®é¢˜ã€‚é—®é¢˜è¶Šå¤æ‚ï¼Œè§£å†³é—®é¢˜éœ€è¦çš„æŠ½è±¡å±‚å¾€å¾€è¶Šé«˜ã€‚</p><p>ç¼–ç¨‹è¯­è¨€çš„çš„å‘å±•ï¼Œä¹Ÿé¡ºåº”ç€è¿™æ ·çš„è¶‹åŠ¿ã€‚ä¸€å¼€å§‹çš„æ±‡ç¼–è¯­è¨€åªæ˜¯å¯¹è®¡ç®—æœºç¡¬ä»¶çš„ç®€å•æŠ½è±¡ï¼ŒCè¯­è¨€åˆå¯¹å…¶è¿›è¡Œäº†è¿›ä¸€æ­¥çš„æŠ½è±¡ï¼Œä½¿å…¶æ›´åŠ è´´è¿‘é—®é¢˜è€Œä¸æ˜¯ç¡¬ä»¶ï¼›åˆ°äº† Javaï¼Œé¢å‘å¯¹è±¡ç¼–ç¨‹(OOP)çš„æ€æƒ³å·²è¿‘å¾ˆæˆç†Ÿäº†ï¼Œè¿™æ˜¯ä¸€ç§æ›´åŠ æŠ½è±¡çš„è¯­è¨€ï¼Œå¯¹è®¡ç®—æœºç¡¬ä»¶çš„è¡¨è¾¾æ›´å°‘ï¼Œè€Œå¯¹é—®é¢˜çš„æè¿°æ›´å¤šã€‚</p><h2 id="è®¤è¯†é¢å‘å¯¹è±¡"><a href="#è®¤è¯†é¢å‘å¯¹è±¡" class="headerlink" title="è®¤è¯†é¢å‘å¯¹è±¡"></a>è®¤è¯†é¢å‘å¯¹è±¡</h2><ul><li>ä»€ä¹ˆæ˜¯<em>å¯¹è±¡</em>ï¼Ÿ</li></ul><p>å¯¹è±¡å°±æ˜¯ä¸€ä¸ªå­˜åœ¨çš„ä¸œè¥¿ï¼</p><p>åœ¨é¢å‘è¿‡ç¨‹çš„ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æŠŠä¸€ä¸ªé—®é¢˜è½¬æ¢æˆä¸€ç³»åˆ—çš„æ•°æ®å’Œæ“ä½œæ•°æ®çš„ç®—æ³•ï¼ŒåŒæ—¶æˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘è¿™äº›æ•°æ®å’Œç®—æ³•å¦‚ä½•ç”¨è®¡ç®—æœºå¯ä»¥ç†è§£çš„æ–¹å¼è¡¨è¾¾å‡ºæ¥ï¼Œå³éµç…§åŸºç¡€æœºå™¨çš„è¡¨è¾¾æ–¹å¼ã€‚</p><p>å¯¹è±¡çš„æ¦‚å¿µå¯ä¸ºæˆ‘ä»¬å¸¦æ¥æå¤§çš„ä¾¿åˆ©ã€‚å®ƒåœ¨æ¦‚å¿µä¸Šå…è®¸æˆ‘ä»¬å°†å„å¼å„æ ·æ•°æ®å’ŒåŠŸèƒ½å°è£…åˆ°ä¸€èµ·ã€‚è¿™æ ·ä¾¿å¯æ°å½“è¡¨è¾¾â€œé—®é¢˜ç©ºé—´â€çš„æ¦‚å¿µï¼Œä¸ç”¨åˆ»æ„éµç…§åŸºç¡€æœºå™¨çš„è¡¨è¾¾æ–¹å¼ã€‚</p><ul><li>ä»€ä¹ˆæ˜¯<em>é¢å‘å¯¹è±¡çš„ç¨‹åºè®¾è®¡</em>ï¼Ÿ</li></ul><p>é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œå°±æ˜¯æŠŠä¸€åˆ‡é—®é¢˜çš„éƒ¨åˆ†æŠ½è±¡æˆå¯¹è±¡ï¼Œç”¨é‚£äº›é€šç”¨çš„ç‰¹å¾å’Œè¡Œä¸ºæ¥æè¿°ä»–ä»¬ï¼Œç„¶åå†å¤„ç†è¿™äº›å¯¹è±¡ä¹‹é—´çš„æ²Ÿé€šï¼Œå¾—åˆ°å®Œæ•´çš„é—®é¢˜æè¿°ï¼Œå¹¶é€šè¿‡ç»™è¿™äº›å¯¹è±¡ä¸€äº›ï¼Œä¿¡æ¯è®©ä»–ä»¬æœ€ç»ˆç»™å‡ºä¸€ä¸ªè§£ã€‚</p><ul><li><p>â€œçº¯ç²¹â€çš„é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡æ–¹æ³•æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</p><ol><li>æ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯å¯¹è±¡ã€‚å¯å°†å¯¹è±¡æƒ³è±¡æˆä¸€ç§æ–°å‹å˜é‡ï¼›</li><li>ç¨‹åºæ˜¯ä¸€å¤§å †å¯¹è±¡çš„ç»„åˆï¼›é€šè¿‡æ¶ˆæ¯ä¼ é€’ï¼Œå„å¯¹è±¡çŸ¥é“è‡ªå·±è¯¥åšäº›ä»€ä¹ˆã€‚</li><li>æ¯ä¸ªå¯¹è±¡éƒ½æœ‰è‡ªå·±çš„å­˜å‚¨ç©ºé—´ï¼Œå¯å®¹çº³å…¶ä»–å¯¹è±¡ã€‚</li><li>æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ç§ç±»å‹ã€‚</li><li>åŒä¸€ç±»æ‰€æœ‰å¯¹è±¡éƒ½èƒ½æ¥æ”¶ç›¸åŒçš„æ¶ˆæ¯ã€‚</li></ol></li></ul><h2 id="å¯¹è±¡çš„æ¥å£"><a href="#å¯¹è±¡çš„æ¥å£" class="headerlink" title="å¯¹è±¡çš„æ¥å£"></a>å¯¹è±¡çš„æ¥å£</h2><p>æ‰€æœ‰å¯¹è±¡ï¼Œå°½ç®¡å„æœ‰ç‰¹è‰²ï¼Œéƒ½å±äºæŸä¸€ç³»åˆ—å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œè¿™äº›å¯¹è±¡å…·æœ‰é€šç”¨çš„ç‰¹å¾å’Œè¡Œä¸ºã€‚</p><p>â€œæ¥å£â€ï¼ˆInterfaceï¼‰å°±æ˜¯æŠŠä¸€ç§ç±»å‹çš„å¯¹è±¡çš„å…±åŒç‰¹å¾æŠ½è±¡å‡ºæ¥ï¼Œå¹¶å°†å…¶è¡¨ç¤ºã€‚ï¼ˆå¤§å¤šæ•°è¯­è¨€ä¸­æˆ‘ä»¬ä½¿ç”¨å…³é”®å­— <code>class</code> æ¥æè¿°ï¼‰</p><p>â€œç±»å‹â€å†³å®šäº†æ¥å£ï¼Œè€Œâ€œç±»â€æ˜¯é‚£ä¸ªæ¥å£çš„ä¸€ç§ç‰¹æ®Šå®ç°æ–¹å¼ã€‚</p><p>æ¥å£å»ºç«‹çš„åŒæ—¶ï¼Œä¹Ÿè§„å®šäº†å¯å¯¹ä¸€ä¸ªç‰¹å®šçš„å¯¹è±¡å‘å‡ºå“ªäº›è¯·æ±‚ã€‚æ‰€ä»¥å»ºå¥½ä¸€ä¸ªç±»åï¼Œå¯æ ¹æ®æƒ…å†µç”Ÿæˆè®¸å¤šå¯¹è±¡ã€‚éšåï¼Œå¯å°†é‚£äº›å¯¹è±¡ä½œä¸ºè¦è§£å†³é—®é¢˜ä¸­å­˜åœ¨çš„å…ƒç´ è¿›è¡Œå¤„ç†ã€‚</p><h2 id="å®ç°æ–¹æ¡ˆçš„éšè—"><a href="#å®ç°æ–¹æ¡ˆçš„éšè—" class="headerlink" title="å®ç°æ–¹æ¡ˆçš„éšè—"></a>å®ç°æ–¹æ¡ˆçš„éšè—</h2><p>åœ¨é¢å‘å¯¹è±¡çš„ç¨‹åºè®¾è®¡çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ—¶å¸¸éœ€è¦<em>æ§åˆ¶å¯¹æˆå‘˜çš„è®¿é—®</em>ã€‚</p><p>ä¸€æ–¹é¢ï¼Œé˜²æ­¢è°ƒç”¨ç±»çš„ç¨‹åºå‘˜æ¥è§¦åˆ°å†…éƒ¨æ•°æ®ç±»å‹çš„è®¾è®¡æ€æƒ³ã€‚<br>å¦ä¸€æ–¹é¢ï¼Œå…è®¸åº“è®¾è®¡äººå‘˜ä¿®æ”¹å†…éƒ¨ç»“æ„ï¼Œä¸ç”¨æ‹…å¿ƒå®ƒä¼šå¯¹å®¢æˆ·ç¨‹åºå‘˜é€ æˆä»€ä¹ˆå½±å“ã€‚</p><p>åœ¨æˆ‘ä»¬çš„æ¥å£ä¸­ï¼Œè¦å®ç°è¿™æ ·çš„è®¿é—®æ§åˆ¶ï¼ŒæŠŠä¸€éƒ¨åˆ†è®¾è®¡ç»†èŠ‚éšè—èµ·æ¥ï¼Œä¾¿éœ€è¦ä¸€ç§æœºåˆ¶æ¥å®ç°å¯¹è®¿é—®çš„æ§åˆ¶ï¼Œåœ¨ Java ä¸­è¿™ç§æ§åˆ¶ç”¨å…³é”®å­— <code>public</code>ï¼Œ<code>private</code>ï¼Œ<code>protected</code> ä»¥åŠæš—ç¤ºæ€§çš„ <code>friendly</code>æ¥å®ç°ï¼š</p><ul><li>â€œpublicâ€ï¼ˆå…¬å…±ï¼‰æ„å‘³ç€åç»­çš„å®šä¹‰ä»»ä½•äººå‡å¯ä½¿ç”¨ã€‚</li><li>â€œprivateâ€ï¼ˆç§æœ‰ï¼‰æ„å‘³ç€é™¤æ‚¨è‡ªå·±ã€ç±»å‹çš„åˆ›å»ºè€…ä»¥åŠé‚£ä¸ªç±»å‹çš„å†…éƒ¨å‡½æ•°æˆå‘˜ï¼Œå…¶ä»–ä»»ä½•äººéƒ½ä¸èƒ½è®¿é—®åç»­çš„å®šä¹‰ä¿¡æ¯ã€‚</li><li>â€œprotectedâ€ï¼ˆå—ä¿æŠ¤çš„ï¼‰ä¸â€œprivateâ€ç›¸ä¼¼ï¼Œåªæ˜¯ä¸€ä¸ªç»§æ‰¿çš„ç±»å¯è®¿é—®å—ä¿æŠ¤çš„æˆå‘˜ï¼Œä½†ä¸èƒ½è®¿é—®ç§æœ‰æˆå‘˜ã€‚ç»§æ‰¿çš„é—®é¢˜ä¸ä¹…å°±è¦è°ˆåˆ°ã€‚</li><li>â€œfriendlyâ€ï¼ˆå‹å¥½çš„ï¼‰æ¶‰åŠâ€œåŒ…è£…â€æˆ–â€œå°è£…â€ï¼ˆPackageï¼‰çš„æ¦‚å¿µâ€”â€”å³Javaç”¨æ¥æ„å»ºåº“çš„æ–¹æ³•ã€‚è‹¥æŸæ ·ä¸œè¥¿æ˜¯â€œå‹å¥½çš„â€ï¼Œæ„å‘³ç€å®ƒåªèƒ½åœ¨è¿™ä¸ªåŒ…è£…çš„èŒƒå›´å†…ä½¿ç”¨ï¼ˆæ‰€ä»¥è¿™ä¸€è®¿é—®çº§åˆ«æœ‰æ—¶ä¹Ÿå«ä½œâ€œåŒ…è£…è®¿é—®â€ï¼‰ã€‚</li></ul><h2 id="æ–¹æ¡ˆçš„é‡å¤ä½¿ç”¨"><a href="#æ–¹æ¡ˆçš„é‡å¤ä½¿ç”¨" class="headerlink" title="æ–¹æ¡ˆçš„é‡å¤ä½¿ç”¨"></a>æ–¹æ¡ˆçš„é‡å¤ä½¿ç”¨</h2><p>åˆ›å»ºå¹¶æµ‹è¯•å¥½ä¸€ä¸ªç±»åï¼Œå®ƒåº”ï¼ˆä»ç†æƒ³çš„è§’åº¦ï¼‰ä»£è¡¨ä¸€ç±»äº‹ç‰©ï¼Œæ˜¯å¯ä»¥é‡å¤åœ¨å¾ˆå¤šåœ°æ–¹ä½¿ç”¨çš„ã€‚</p><p>ä¸ºé‡å¤ä½¿ç”¨ä¸€ä¸ªç±»ï¼Œæœ€ç®€å•çš„åŠæ³•æ˜¯ä»…ç›´æ¥ä½¿ç”¨é‚£ä¸ªç±»çš„å¯¹è±¡ã€‚åŒæ—¶ä¹Ÿèƒ½å°†é‚£ä¸ªç±»çš„ä¸€ä¸ªå¯¹è±¡ç½®å…¥ä¸€ä¸ªæ–°ç±»ï¼Œè¿™ç§ç±»ä¸­ç½®å…¥ç±»çš„æ–¹æ³•æˆä¸ºâ€œç»„ç»‡â€æˆ–â€œåŒ…å«â€ï¼Œæ¯”å¦‚â€œä¸€è¾†è½¦åŒ…å«äº†ä¸€ä¸ªå˜é€Ÿç®±â€ã€‚</p><h2 id="ç»§æ‰¿ï¼šé‡æ–°ä½¿ç”¨æ¥å£"><a href="#ç»§æ‰¿ï¼šé‡æ–°ä½¿ç”¨æ¥å£" class="headerlink" title="ç»§æ‰¿ï¼šé‡æ–°ä½¿ç”¨æ¥å£"></a>ç»§æ‰¿ï¼šé‡æ–°ä½¿ç”¨æ¥å£</h2><p>æˆ‘ä»¬è´¹å°½å¿ƒæ€åšå‡ºä¸€ç§æ•°æ®ç±»å‹åï¼Œå‡å¦‚ä¸å¾—ä¸åˆæ–°å»ºä¸€ç§ç±»å‹ï¼Œä»¤å…¶å®ç°å¤§è‡´ç›¸åŒçš„åŠŸèƒ½ï¼Œé‚£ä¼šæ˜¯ä¸€ä»¶éå¸¸ä»¤äººç°å¿ƒçš„äº‹æƒ…ã€‚<br>ä½†è‹¥èƒ½åˆ©ç”¨ç°æˆçš„æ•°æ®ç±»å‹ï¼Œå¯¹å…¶è¿›è¡Œâ€œå…‹éš†â€ï¼Œå†æ ¹æ®æƒ…å†µè¿›è¡Œæ·»åŠ å’Œä¿®æ”¹ï¼Œæƒ…å†µå°±æ˜¾å¾—ç†æƒ³å¤šäº†ã€‚â€œç»§æ‰¿â€æ­£æ˜¯é’ˆå¯¹è¿™ä¸ªç›®æ ‡è€Œè®¾è®¡çš„ã€‚</p><blockquote><p>åœ¨ Java è¯­è¨€ä¸­ï¼Œç»§æ‰¿æ˜¯é€šè¿‡ <code>extends</code> å…³é”®å­—å®ç°çš„ã€‚</p></blockquote><p>ä½¿ç”¨ç»§æ‰¿æ—¶ï¼Œç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç±»ï¼Œä¸è¿‡è¿™ä¸ªâ€œå…‹éš†â€ç±»ï¼ˆæ­£å¼åç§°å«ä½œç»§æ‰¿ç±»æˆ–è€…å­ç±»ï¼‰ä¸­ä¸€å¼€å§‹å°±åŒ…å«äº†åŸå§‹ç±»ï¼ˆæ­£å¼åç§°å«ä½œåŸºç¡€ç±»ã€è¶…ç±»æˆ–çˆ¶ç±»ï¼‰ä¸­çš„æ‰€æœ‰æˆå‘˜ï¼ˆ<code>private</code>ä¼šè¢«éšè—èµ·æ¥ï¼Œç¦æ­¢è®¿é—®ï¼‰ä¸æ¥å£ã€‚</p><p>äºæ­¤åŒæ—¶ï¼Œåœ¨ç»§æ‰¿è¿‡ç¨‹ä¸­ï¼Œè‹¥<strong>çˆ¶ç±»</strong>å‘ç”Ÿäº†å˜åŒ–ï¼Œ<strong>å­ç±»</strong>ä¹Ÿä¼šåæ˜ å‡ºè¿™ç§å˜åŒ–ã€‚</p><p>åœ¨å®Œæˆç»§æ‰¿åï¼Œå¯å‘<strong>çˆ¶ç±»</strong>çš„å¯¹è±¡å‘é€çš„æ‰€æœ‰æ¶ˆæ¯äº¦å¯åŸæ ·å‘ç»™<strong>å­ç±»</strong>çš„å¯¹è±¡ã€‚å¦‚æœä¸å¯¹<strong>å­ç±»</strong>åšä»»ä½•ä¿®æ”¹ï¼Œ<strong>å­ç±»å¯¹è±¡</strong>æ¥æ”¶åˆ°ä¸€æ¡ç‰¹å®šçš„æ¶ˆæ¯åï¼Œä¹Ÿæ€»æœ‰ä¸€ä¸ª<strong>çˆ¶ç±»</strong>æä¾›çš„â€œæ–¹æ³•â€èƒ½å¤Ÿæ‰§è¡Œã€‚è¿™æ„å‘³ç€<strong>å­ç±»</strong>å…·æœ‰ä¸<strong>çˆ¶ç±»</strong>ç›¸åŒçš„ç±»å‹å’Œè¡Œä¸ºï¼</p><p>ç„¶è€Œï¼Œåœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›å­ç±»å’Œçˆ¶ç±»æœ‰æ‰€åŒºåˆ«ï¼ˆä¸ç„¶ä¸ºä»€ä¹ˆè¦å»ºç«‹ä¸€ä¸ªå­ç±»å‘¢ï¼Ÿï¼‰ï¼Œå®ç°è¿™ä¸ªæ•ˆæœï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸‹æ–¹æ³•å¯ç”¨ï¼š</p><ul><li>ä¸ºè¡ç”Ÿç±»æ·»åŠ æ–°å‡½æ•°ï¼ˆåŠŸèƒ½ï¼‰</li></ul><p>å¦‚æœéœ€è¦å­ç±»æ‹¥æœ‰çˆ¶ç±»æ²¡æœ‰çš„åŠŸèƒ½ï¼Œåªéœ€è¦ç»™å­ç±»å¢åŠ æ–°çš„æ–¹æ³•ï¼ˆå‡½æ•°ï¼‰å°±è¡Œäº†ã€‚</p><ul><li>æ”¹å˜ï¼ˆâ€æ”¹å–„â€ï¼‰åŸºç¡€ç±»ä¸€ä¸ªç°æœ‰å‡½æ•°çš„è¡Œä¸ºï¼ˆé‡è½½ï¼‰</li></ul><p>ä¸ºæ”¹å–„ä¸€ä¸ªå‡½æ•°ï¼Œåªéœ€ä¸ºè¡ç”Ÿç±»çš„å‡½æ•°å»ºç«‹ä¸€ä¸ªæ–°å®šä¹‰å³å¯ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ï¼šâ€œå°½ç®¡ä½¿ç”¨çš„å‡½æ•°æ¥å£æœªå˜ï¼Œä½†å®ƒçš„æ–°ç‰ˆæœ¬å…·æœ‰ä¸åŒçš„è¡¨ç°â€ã€‚</p><h2 id="å¤šå½¢å¯¹è±¡çš„äº’æ¢ä½¿ç”¨"><a href="#å¤šå½¢å¯¹è±¡çš„äº’æ¢ä½¿ç”¨" class="headerlink" title="å¤šå½¢å¯¹è±¡çš„äº’æ¢ä½¿ç”¨"></a>å¤šå½¢å¯¹è±¡çš„äº’æ¢ä½¿ç”¨</h2><p><img src="https://java.quanke.name/1-2.gif" alt="1-2.gif"></p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬æ„å»ºä¸€ä¸ª <code>Shape</code> ç±»ï¼Œ<code>Shape</code> ç±»æ‹¥æœ‰ <code>draw()</code>, <code>erase()</code>, <code>move()</code> ç­‰æ–¹æ³•ï¼›<br>ç„¶åæˆ‘ä»¬åœ¨æ„å»ºå‡ ä¸ª <code>Shape</code> çš„å­ç±»ï¼ˆç»§æ‰¿è‡ª <code>Shape</code>ï¼‰çš„ç±»ï¼š<code>Circle</code>, <code>Line</code>, <code>Triangle</code>ï¼›<br>å¯¹æ¯ä¸ªå­ç±»ï¼Œæˆ‘ä»¬éƒ½ä¼šæ ¹æ®å®é™…æƒ…å†µé‡è½½å¯¹åº”çš„æ–¹æ³•ã€‚</p><p>è¿™æ—¶ï¼Œå¦‚æœæˆ‘ä»¬æ„å»ºä¸€ä¸ª doStuff å‡½æ•°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">void doStuff(Shape s) &#123;</span><br><span class="line">    s.erase();</span><br><span class="line">    &#x2F;&#x2F; ...</span><br><span class="line">    s.draw();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ƒå¯ä»¥æ¥æ”¶ä»»ä½• Shape åŒ…æ‹¬å…¶å­ç±»è¿›è¡Œæ“ä½œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Circle c &#x3D; new Circle();</span><br><span class="line">Triangle t &#x3D; new Triangle();</span><br><span class="line">Line  l &#x3D; new Line();</span><br><span class="line">doStuff(c);</span><br><span class="line">doStuff(t);</span><br><span class="line">doStuff(l);</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æŠŠ Shape çš„å­ç±»ï¼Œå½“ä½œ Shape ä½¿ç”¨ï¼Œè¿™ç§°ä¸ºâ€œ<strong>ä¸Šæº¯é€ å‹</strong>â€ï¼Œè¿™æ ·åšå¸¸å¸¸å¯ä»¥é¿å…æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡åˆ°åº•æ˜¯ä½•ç§å…·ä½“ç±»å‹ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå³ä½¿ Circleã€Lineã€Triangle ç”¨ä¸åŒçš„ eraseã€draw çš„å…·ä½“å®ç°æ–¹å¼ï¼ŒdoStuff è¿˜æ˜¯å¯ä»¥å¾ˆå¥½å¾—å®Œæˆå·¥ä½œã€‚æˆ‘ä»¬å¯ä»¥ç†è§£ä¸º doStuff åªæ˜¯åœ¨å‘Šè¯‰ Shape ï¼šâ€œä½ æ˜¯ä¸€ç§å‡ ä½•å½¢çŠ¶ï¼Œæˆ‘çŸ¥é“ä½ èƒ½å°†è‡ªå·±åˆ æ‰ï¼Œå³erase()ï¼›è¯·è‡ªå·±é‡‡å–é‚£ä¸ªè¡ŒåŠ¨ï¼Œå¹¶è‡ªå·±å»æ§åˆ¶æ‰€æœ‰çš„ç»†èŠ‚å§â€ï¼Œè€Œä¸æ˜¯å¯¹ Circle åšæŸç§æ“ä½œï¼Œå¯¹ Triangle åšæŸç§æ“ä½œâ€¦</p><h4 id="åŠ¨æ€ç»‘å®š"><a href="#åŠ¨æ€ç»‘å®š" class="headerlink" title="åŠ¨æ€ç»‘å®š"></a>åŠ¨æ€ç»‘å®š</h4><p>æˆ‘ä»¬åœ¨ä½¿ç”¨ä¸Šè¿°ä»£ç æ—¶ï¼Œä¸è®ºæˆ‘ä»¬ä¼ ç»™ doStuff çš„æ˜¯é‚£ç§å…·ä½“ç±»å‹ï¼Œå®ƒæ€»èƒ½è°ƒç”¨æˆ‘ä»¬æƒ³è¦çš„å‡½æ•°ã€‚</p><p>åƒè¿™æ ·å°†ä¸€æ¡æ¶ˆæ¯å‘ç»™å¯¹è±¡æ—¶ï¼Œå¦‚æœä¸çŸ¥é“å¯¹æ–¹å¯¹å…·ä½“ç±»å‹æ˜¯ä»€ä¹ˆï¼Œä½†é‡‡å–çš„è¡ŒåŠ¨åŒæ ·æ˜¯æ­£ç¡®çš„ï¼Œè¿™ç§æƒ…å†µç§°ä½œâ€œ<strong>å¤šå½¢æ€§</strong>â€ï¼Œå®ç°â€œå¤šå½¢æ€§â€çš„åŠæ³•å«åšâ€œ<strong>åŠ¨æ€ç»‘å®š</strong>â€ã€‚</p><p>å¯¹äºåŠ¨æ€ç»‘å®šï¼Œç¼–è¯‘å™¨ä¼šè‡ªå·±å¤„ç†ç»†èŠ‚ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p><p>åœ¨ Java ä¸­ï¼Œæˆ‘ä»¬æ— éœ€ä½¿ç”¨å…³é”®å­—æ¥å®ç° åŠ¨æ€ç»‘å®šï¼Œå®ƒå°†æ˜¯è‡ªåŠ¨çš„ã€‚</p><h4 id="æŠ½è±¡çš„åŸºç¡€ç±»å’Œæ¥å£"><a href="#æŠ½è±¡çš„åŸºç¡€ç±»å’Œæ¥å£" class="headerlink" title="æŠ½è±¡çš„åŸºç¡€ç±»å’Œæ¥å£"></a>æŠ½è±¡çš„åŸºç¡€ç±»å’Œæ¥å£</h4><p><strong>åŸºç¡€ç±»</strong> åªæ˜¯ä¸ºè‡ªå·±çš„è¡ç”Ÿç±»æä¾›ä¸€ä¸ªæ¥å£çš„ç±»ï¼ˆä¸Šæº¯é€ å‹æˆå®ƒï¼‰ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›å®é™…åˆ›å»ºè¿™ç§ç±»çš„å®ä¾‹å¯¹è±¡ã€‚<br>è¿™æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠè¿™ä¸ªç±»å£°æ˜æˆâ€œæŠ½è±¡çš„â€ã€‚</p><blockquote><p>åœ¨ Java ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ å…³é”®å­— <code>abstract</code> æ¥è¯´æ˜ä¸€ä¸ªç±»æ˜¯æŠ½è±¡çš„ã€‚ç¼–è¯‘å™¨å°†é˜»æ­¢åˆ›å»º<strong>æŠ½è±¡ç±»</strong>çš„å®ä¾‹ã€‚</p></blockquote><p><strong><code>interface</code> å…³é”®å­—</strong> å°†æŠ½è±¡ç±»çš„æ¦‚å¿µå»¶ä¼¸ï¼Œå®ƒå®Œå…¨ç¦æ­¢æ‰€æœ‰å‡½æ•°çš„å®šä¹‰ã€‚</p><hr><p>ã€æ³¨ã€‘è¿™ç¯‡æ–‡ç« ï¼Œæ˜¯å­¦ä¹ ã€ŠThinking in Javaã€‹çš„ç¬”è®°ä¸æ‘˜å½•æ•´ç†è€Œæˆçš„ã€‚</p><p>ç”±äºæ‰¾åˆ°çš„è¿™æœ¬ä¹¦å¤ªè€ï¼ŒåŠ ä¸Šä¸€äº›ç¿»è¯‘ä¸Šçš„é—®é¢˜ï¼Œæ‰€ä»¥æœ‰äº›åœ°æ–¹çš„è¡¨è¿°å¯èƒ½å’Œç°åœ¨çš„ä¸»æµæ–¹å¼ä¸åŒï¼ˆå¦‚ä¹¦ä¸­å¯¹â€œé‡è½½â€ã€â€œå¤šæ€â€ç­‰è¯çš„è¡¨è¿°ğŸ˜‚ï¼‰ã€‚</p><p>è¿™éƒ¨åˆ†ä¸»è¦å­¦ä¹ é‚£ç§æ€æƒ³ï¼Œå°±ä¸çº ç»“è¿™äº›é£è¯é€ å¥æ˜¯çš„ç»†èŠ‚äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java-åŸºç¡€è¯­æ³•</title>
      <link href="/2019/04/12/Java_intro/Day1_Java_Basic/"/>
      <url>/2019/04/12/Java_intro/Day1_Java_Basic/</url>
      
        <content type="html"><![CDATA[<h1 id="Java-åŸºç¡€è¯­æ³•"><a href="#Java-åŸºç¡€è¯­æ³•" class="headerlink" title="Java åŸºç¡€è¯­æ³•"></a>Java åŸºç¡€è¯­æ³•</h1><p><code>Java</code>  æ˜¯ä¸€é—¨<strong>é¢å‘å¯¹è±¡</strong>çš„<strong>è§£é‡Šå‹</strong>ç¼–ç¨‹è¯­è¨€ã€‚</p><p><strong>é¢å‘å¯¹è±¡</strong> æ„å‘³ç€æˆ‘ä»¬åº”è¯¥æŠŠä¸€ä¸ª Java ç¨‹åºçœ‹ä½œä¸€ç³»åˆ—å¯¹è±¡çš„é›†åˆï¼Œæˆ‘ä»¬çš„å·¥ä½œå°±æ˜¯æ„å»ºè¿™äº›å¯¹è±¡ï¼Œå¹¶é€šè¿‡è°ƒç”¨å½¼æ­¤çš„æ–¹æ³•æ¥è®©å„ç§å¯¹è±¡ååŒå·¥ä½œï¼Œè§£å†³å®é™…çš„é—®é¢˜ã€‚</p><p><strong>è§£é‡Šå‹</strong> æ„å‘³ç€ï¼š</p><p>Javaç¼–è¯‘ç¨‹åºç”Ÿæˆå­—èŠ‚ç ï¼ˆ<em>byte-code</em>ï¼‰ï¼Œè€Œä¸æ˜¯é€šå¸¸çš„æœºå™¨ç ã€‚<br>ç›¸åŒçš„ä»£ç è®¾è®¡æˆå¯æœ‰æ•ˆåœ°ä¼ é€ç¨‹åºåˆ°å¤šä¸ªå¹³å°ã€‚</p><h2 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h2><ul><li>Java å¤§å°å†™æ•æ„Ÿ</li><li>Java æºæ–‡ä»¶åå¿…é¡»å’Œç±»åç›¸åŒï¼ˆå¦‚æœæ–‡ä»¶åå’Œç±»åä¸ç›¸åŒåˆ™ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ï¼‰</li><li>Java ç¨‹åºç”± <code>public static void main(String []args) </code>æ–¹æ³•å¼€å§‹æ‰§è¡Œã€‚</li></ul><h2 id="æ ‡è¯†ç¬¦ï¼ˆåˆæ³•çš„å˜é‡åï¼‰"><a href="#æ ‡è¯†ç¬¦ï¼ˆåˆæ³•çš„å˜é‡åï¼‰" class="headerlink" title="æ ‡è¯†ç¬¦ï¼ˆåˆæ³•çš„å˜é‡åï¼‰"></a>æ ‡è¯†ç¬¦ï¼ˆåˆæ³•çš„å˜é‡åï¼‰</h2><ul><li>Java æ ‡è¯†ç¬¦å¯ä»¥åŒ…å«ä»¥ä¸‹å­—ç¬¦ï¼š<ul><li><em>å­—æ¯</em>ï¼š<code>A</code>-<code>Z</code>ã€<code>a</code>-<code>z</code></li><li><em>æ•°å­—</em>ï¼š<code>0</code>-<code>9</code></li><li><em>ç¬¦å·</em>ï¼š<code>$</code>ã€<code>_</code></li></ul></li><li>é¦–å­—ç¬¦ä¸èƒ½æ˜¯<em>æ•°å­—</em></li><li>Java æ ‡è¯†ç¬¦å¤§å°å†™æ•æ„Ÿ</li><li>å…³é”®å­—ä¸èƒ½ç”¨ä½œæ ‡è¯†ç¬¦</li></ul><h2 id="å…³é”®å­—ï¼ˆä¿ç•™å­—ï¼‰"><a href="#å…³é”®å­—ï¼ˆä¿ç•™å­—ï¼‰" class="headerlink" title="å…³é”®å­—ï¼ˆä¿ç•™å­—ï¼‰"></a>å…³é”®å­—ï¼ˆä¿ç•™å­—ï¼‰</h2><table><thead><tr><th>å…³é”®å­—</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>abstract</td><td>è¡¨æ˜ç±»æˆ–è€…æˆå‘˜æ–¹æ³•å…·æœ‰æŠ½è±¡å±æ€§</td></tr><tr><td>assert</td><td>æ–­è¨€ï¼Œç”¨æ¥è¿›è¡Œç¨‹åºè°ƒè¯•</td></tr><tr><td>boolean</td><td>åŸºæœ¬æ•°æ®ç±»å‹ä¹‹ä¸€ï¼Œå£°æ˜å¸ƒå°”ç±»å‹çš„å…³é”®å­—</td></tr><tr><td>break</td><td>æå‰è·³å‡ºä¸€ä¸ªå—</td></tr><tr><td>byte</td><td>åŸºæœ¬æ•°æ®ç±»å‹ä¹‹ä¸€ï¼Œå­—èŠ‚ç±»å‹</td></tr><tr><td>case</td><td>ç”¨åœ¨switchè¯­å¥ä¹‹ä¸­ï¼Œè¡¨ç¤ºå…¶ä¸­çš„ä¸€ä¸ªåˆ†æ”¯</td></tr><tr><td>catch</td><td>ç”¨åœ¨å¼‚å¸¸å¤„ç†ä¸­ï¼Œç”¨æ¥æ•æ‰å¼‚å¸¸</td></tr><tr><td>char</td><td>åŸºæœ¬æ•°æ®ç±»å‹ä¹‹ä¸€ï¼Œå­—ç¬¦ç±»å‹</td></tr><tr><td>class</td><td>å£°æ˜ä¸€ä¸ªç±»</td></tr><tr><td>const</td><td>ä¿ç•™å…³é”®å­—ï¼Œæ²¡æœ‰å…·ä½“å«ä¹‰</td></tr><tr><td>continue</td><td>å›åˆ°ä¸€ä¸ªå—çš„å¼€å§‹å¤„</td></tr><tr><td>default</td><td>é»˜è®¤ï¼Œä¾‹å¦‚ï¼Œç”¨åœ¨switchè¯­å¥ä¸­ï¼Œè¡¨æ˜ä¸€ä¸ªé»˜è®¤çš„åˆ†æ”¯</td></tr><tr><td>do</td><td>ç”¨åœ¨do-whileå¾ªç¯ç»“æ„ä¸­</td></tr><tr><td>double</td><td>åŸºæœ¬æ•°æ®ç±»å‹ä¹‹ä¸€ï¼ŒåŒç²¾åº¦æµ®ç‚¹æ•°ç±»å‹</td></tr><tr><td>else</td><td>ç”¨åœ¨æ¡ä»¶è¯­å¥ä¸­ï¼Œè¡¨æ˜å½“æ¡ä»¶ä¸æˆç«‹æ—¶çš„åˆ†æ”¯</td></tr><tr><td>enum</td><td>æšä¸¾</td></tr><tr><td>extends</td><td>è¡¨æ˜ä¸€ä¸ªç±»å‹æ˜¯å¦ä¸€ä¸ªç±»å‹çš„å­ç±»å‹ï¼Œè¿™é‡Œå¸¸è§çš„ç±»å‹æœ‰ç±»å’Œæ¥å£</td></tr><tr><td>final</td><td>ç”¨æ¥è¯´æ˜æœ€ç»ˆå±æ€§ï¼Œè¡¨æ˜ä¸€ä¸ªç±»ä¸èƒ½æ´¾ç”Ÿå‡ºå­ç±»ï¼Œæˆ–è€…æˆå‘˜æ–¹æ³•ä¸èƒ½è¢«è¦†ç›–ï¼Œæˆ–è€…æˆå‘˜åŸŸçš„å€¼ä¸èƒ½è¢«æ”¹å˜ï¼Œç”¨æ¥å®šä¹‰å¸¸é‡</td></tr><tr><td>finally</td><td>ç”¨äºå¤„ç†å¼‚å¸¸æƒ…å†µï¼Œç”¨æ¥å£°æ˜ä¸€ä¸ªåŸºæœ¬è‚¯å®šä¼šè¢«æ‰§è¡Œåˆ°çš„è¯­å¥å—</td></tr><tr><td>float</td><td>åŸºæœ¬æ•°æ®ç±»å‹ä¹‹ä¸€ï¼Œå•ç²¾åº¦æµ®ç‚¹æ•°ç±»å‹</td></tr><tr><td>for</td><td>ä¸€ç§å¾ªç¯ç»“æ„çš„å¼•å¯¼è¯</td></tr><tr><td>goto</td><td>ä¿ç•™å…³é”®å­—ï¼Œæ²¡æœ‰å…·ä½“å«ä¹‰</td></tr><tr><td>if</td><td>æ¡ä»¶è¯­å¥çš„å¼•å¯¼è¯</td></tr><tr><td>implements</td><td>è¡¨æ˜ä¸€ä¸ªç±»å®ç°äº†ç»™å®šçš„æ¥å£</td></tr><tr><td>import</td><td>è¡¨æ˜è¦è®¿é—®æŒ‡å®šçš„ç±»æˆ–åŒ…</td></tr><tr><td>instanceof</td><td>ç”¨æ¥æµ‹è¯•ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯æŒ‡å®šç±»å‹çš„å®ä¾‹å¯¹è±¡</td></tr><tr><td>int</td><td>åŸºæœ¬æ•°æ®ç±»å‹ä¹‹ä¸€ï¼Œæ•´æ•°ç±»å‹</td></tr><tr><td>interface</td><td>æ¥å£</td></tr><tr><td>long</td><td>åŸºæœ¬æ•°æ®ç±»å‹ä¹‹ä¸€ï¼Œé•¿æ•´æ•°ç±»å‹</td></tr><tr><td>native</td><td>ç”¨æ¥å£°æ˜ä¸€ä¸ªæ–¹æ³•æ˜¯ç”±ä¸è®¡ç®—æœºç›¸å…³çš„è¯­è¨€ï¼ˆå¦‚C/C++/FORTRANè¯­è¨€ï¼‰å®ç°çš„</td></tr><tr><td>new</td><td>ç”¨æ¥åˆ›å»ºæ–°å®ä¾‹å¯¹è±¡</td></tr><tr><td>package</td><td>åŒ…</td></tr><tr><td>private</td><td>ä¸€ç§è®¿é—®æ§åˆ¶æ–¹å¼ï¼šç§ç”¨æ¨¡å¼</td></tr><tr><td>protected</td><td>ä¸€ç§è®¿é—®æ§åˆ¶æ–¹å¼ï¼šä¿æŠ¤æ¨¡å¼</td></tr><tr><td>public</td><td>ä¸€ç§è®¿é—®æ§åˆ¶æ–¹å¼ï¼šå…±ç”¨æ¨¡å¼</td></tr><tr><td>return</td><td>ä»æˆå‘˜æ–¹æ³•ä¸­è¿”å›æ•°æ®</td></tr><tr><td>short</td><td>åŸºæœ¬æ•°æ®ç±»å‹ä¹‹ä¸€,çŸ­æ•´æ•°ç±»å‹</td></tr><tr><td>static</td><td>è¡¨æ˜å…·æœ‰é™æ€å±æ€§</td></tr><tr><td>strictfp</td><td>ç”¨æ¥å£°æ˜FP_strictï¼ˆå•ç²¾åº¦æˆ–åŒç²¾åº¦æµ®ç‚¹æ•°ï¼‰è¡¨è¾¾å¼éµå¾ªIEEE 754ç®—æœ¯è§„èŒƒ[1]</td></tr><tr><td>super</td><td>è¡¨æ˜å½“å‰å¯¹è±¡çš„çˆ¶ç±»å‹çš„å¼•ç”¨æˆ–è€…çˆ¶ç±»å‹çš„æ„é€ æ–¹æ³•</td></tr><tr><td>switch</td><td>åˆ†æ”¯è¯­å¥ç»“æ„çš„å¼•å¯¼è¯</td></tr><tr><td>synchronized</td><td>è¡¨æ˜ä¸€æ®µä»£ç éœ€è¦åŒæ­¥æ‰§è¡Œ</td></tr><tr><td>this</td><td>æŒ‡å‘å½“å‰å®ä¾‹å¯¹è±¡çš„å¼•ç”¨</td></tr><tr><td>throw</td><td>æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸</td></tr><tr><td>throws</td><td>å£°æ˜åœ¨å½“å‰å®šä¹‰çš„æˆå‘˜æ–¹æ³•ä¸­æ‰€æœ‰éœ€è¦æŠ›å‡ºçš„å¼‚å¸¸</td></tr><tr><td>transient</td><td>å£°æ˜ä¸ç”¨åºåˆ—åŒ–çš„æˆå‘˜åŸŸ</td></tr><tr><td>try</td><td>å°è¯•ä¸€ä¸ªå¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ç¨‹åºå—</td></tr><tr><td>void</td><td>å£°æ˜å½“å‰æˆå‘˜æ–¹æ³•æ²¡æœ‰è¿”å›å€¼</td></tr><tr><td>volatile</td><td>è¡¨æ˜ä¸¤ä¸ªæˆ–è€…å¤šä¸ªå˜é‡å¿…é¡»åŒæ­¥åœ°å‘ç”Ÿå˜åŒ–</td></tr><tr><td>while</td><td>ç”¨åœ¨å¾ªç¯ç»“æ„ä¸­</td></tr></tbody></table><h2 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h2><p>Java ä¸­çš„æ³¨é‡Šå’Œ C è¯­è¨€ç›¸åŒï¼Œæœ‰<code>/* ... */</code> å’Œ <code>// ...</code> ä¸¤ç§ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">å¤šè¡Œ</span></span><br><span class="line"><span class="comment">æ³¨é‡Š</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* è¡Œä¸­æ³¨é‡Š */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¡Œå°¾æ³¨é‡Š</span></span><br></pre></td></tr></table></figure><h2 id="Java-åŒ…"><a href="#Java-åŒ…" class="headerlink" title="Java åŒ…"></a>Java åŒ…</h2><p>åŒ…ä¸»è¦ç”¨æ¥å¯¹ç±»å’Œæ¥å£è¿›è¡Œåˆ†ç±»ã€‚å½“å¼€å‘Javaç¨‹åºæ—¶ï¼Œå¯èƒ½ç¼–å†™æˆç™¾ä¸Šåƒçš„ç±»ï¼Œå› æ­¤å¾ˆæœ‰å¿…è¦å¯¹ç±»å’Œæ¥å£è¿›è¡Œåˆ†ç±»ã€‚</p><h3 id="package-è¯­å¥"><a href="#package-è¯­å¥" class="headerlink" title="package è¯­å¥"></a><code>package</code> è¯­å¥</h3><p><code>package</code> æŒ‡å®šçš„ä¿¡æ¯ç›´æ¥å°†ç”Ÿæˆçš„ <code>class</code> æ–‡ä»¶ç”Ÿæˆåˆ°å¯¹åº”ç›®å½•ä¸‹ã€‚å¦‚ <code>package aaa.bbb.ccc</code> ç¼–è¯‘å™¨å°±å°†è¯¥ <code>.java</code> æ–‡ä»¶ä¸‹çš„å„ä¸ªç±»ç”Ÿæˆåˆ° <code>./aaa/bbb/ccc/</code> è¿™ä¸ªç›®å½•ã€‚</p><h3 id="import-è¯­å¥"><a href="#import-è¯­å¥" class="headerlink" title="import è¯­å¥"></a><code>import</code> è¯­å¥</h3><p><code>import</code> æ˜¯ä¸ºäº†ç®€åŒ–ä½¿ç”¨ <code>package</code> ä¹‹åçš„å®ä¾‹åŒ–çš„ä»£ç ã€‚å‡è®¾ <code>./aaa/bbb/ccc/</code> ä¸‹çš„ <code>A</code> ç±»:</p><p>å‡å¦‚æ²¡æœ‰ <code>import</code>ï¼Œå®ä¾‹åŒ–Aç±»ä¸ºï¼š<code>new aaa.bbb.ccc.A()</code>;</p><p>ä½¿ç”¨ <code>import aaa.bbb.ccc.A</code> åï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>new A()</code> äº†;<br>ä¹Ÿå°±æ˜¯ç¼–è¯‘å™¨åŒ¹é…å¹¶æ‰©å±•äº† <code>aaa.bbb.ccc.</code> è¿™ä¸²å­—ç¬¦ä¸²ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸‹é¢çš„å‘½ä»¤è¡Œå°†ä¼šå‘½ä»¤ç¼–è¯‘å™¨è½½å…¥ <code>java_installation/java/io</code> è·¯å¾„ä¸‹çš„æ‰€æœ‰ç±»:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br></pre></td></tr></table></figure><h2 id="æºæ–‡ä»¶å£°æ˜è§„åˆ™"><a href="#æºæ–‡ä»¶å£°æ˜è§„åˆ™" class="headerlink" title="æºæ–‡ä»¶å£°æ˜è§„åˆ™"></a>æºæ–‡ä»¶å£°æ˜è§„åˆ™</h2><ul><li>ä¸€ä¸ªæºæ–‡ä»¶ä¸­åªèƒ½æœ‰ä¸€ä¸ª <code>public</code> ç±»ï¼ˆé <code>public</code> çš„ä¸é™ï¼‰</li><li>æºæ–‡ä»¶çš„åç§°åº”è¯¥å’Œ <code>public</code> ç±»çš„ç±»åä¿æŒä¸€è‡´ã€‚ï¼ˆæºæ–‡ä»¶ä¸­ public ç±»çš„ç±»åæ˜¯ Employeeï¼Œé‚£ä¹ˆæºæ–‡ä»¶åº”è¯¥å‘½åä¸ºEmployee.javaï¼‰</li><li>å¦‚æœä¸€ä¸ªç±»å®šä¹‰åœ¨æŸä¸ªåŒ…ä¸­ï¼Œé‚£ä¹ˆ <code>package</code> è¯­å¥åº”è¯¥åœ¨æºæ–‡ä»¶çš„é¦–è¡Œã€‚</li><li>å¦‚æœæºæ–‡ä»¶åŒ…å«importè¯­å¥ï¼Œé‚£ä¹ˆåº”è¯¥æ”¾åœ¨ <code>package</code> è¯­å¥å’Œ <code>ç±»å®šä¹‰</code> ä¹‹é—´ã€‚å¦‚æœæ²¡æœ‰packageè¯­å¥ï¼Œé‚£ä¹ˆimportè¯­å¥åº”è¯¥åœ¨æºæ–‡ä»¶ä¸­æœ€å‰é¢ã€‚</li><li><code>import</code> è¯­å¥å’Œ <code>package</code> è¯­å¥å¯¹æºæ–‡ä»¶ä¸­å®šä¹‰çš„æ‰€æœ‰ç±»éƒ½æœ‰æ•ˆã€‚åœ¨åŒä¸€æºæ–‡ä»¶ä¸­ï¼Œä¸èƒ½ç»™ä¸åŒçš„ç±»ä¸åŒçš„åŒ…å£°æ˜ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java-èµ·æ­¥</title>
      <link href="/2019/04/11/Java_intro/Day0_Java_Begining/"/>
      <url>/2019/04/11/Java_intro/Day0_Java_Begining/</url>
      
        <content type="html"><![CDATA[<h1 id="Java-èµ·æ­¥"><a href="#Java-èµ·æ­¥" class="headerlink" title="Java èµ·æ­¥"></a>Java èµ·æ­¥</h1><h2 id="Java-ç®€ä»‹ï¼ˆåºŸè¯ï¼‰"><a href="#Java-ç®€ä»‹ï¼ˆåºŸè¯ï¼‰" class="headerlink" title="Java ç®€ä»‹ï¼ˆåºŸè¯ï¼‰"></a>Java ç®€ä»‹ï¼ˆåºŸè¯ï¼‰</h2><p>Java æ˜¯ç”±Sun Microsystemså…¬å¸äº1995å¹´5æœˆæ¨å‡ºçš„é«˜çº§ç¨‹åºè®¾è®¡è¯­è¨€ï¼ˆç°å±äºOracleï¼‰ã€‚<br>Javaå¯è¿è¡Œäºå¤šä¸ªå¹³å°ï¼Œå¦‚Windows, Mac OSï¼ŒåŠå…¶ä»–å¤šç§UNIXç‰ˆæœ¬çš„ç³»ç»Ÿã€‚ </p><h2 id="Java-å¼€å‘ç¯å¢ƒé…ç½®"><a href="#Java-å¼€å‘ç¯å¢ƒé…ç½®" class="headerlink" title="Java å¼€å‘ç¯å¢ƒé…ç½®"></a>Java å¼€å‘ç¯å¢ƒé…ç½®</h2><h3 id="JDK-Java-Development-Kit"><a href="#JDK-Java-Development-Kit" class="headerlink" title="JDK (Java Development Kit)"></a>JDK (Java Development Kit)</h3><blockquote><p>Java æ˜¯ä¸€ç§è·¨å¹³å°çš„ç¼–ç¨‹è¯­è¨€ï¼Œæƒ³è¦è®©ä½ çš„è®¡ç®—æœºèƒ½å¤Ÿè¿è¡Œ Java ç¨‹åºé‚£ä¹ˆå°±éœ€è¦å®‰è£… JREï¼Œè€Œæƒ³è¦å¼€å‘ Java ç¨‹åºï¼Œé‚£ä¹ˆå°±éœ€è¦å®‰è£… JDKã€‚   </p></blockquote><ul><li><a href="https://www.oracle.com/technetwork/java/javase/downloads/index.html">å®˜ç½‘ä¸‹è½½JDK</a> </li><li>å®‰è£… </li><li>é…ç½®ï¼ˆ<a href="https://docs.oracle.com/en/java/javase/12/install/installation-jdk-microsoft-windows-platforms.html">Windows ä¸‹éœ€è¦é…ç½®å‡ ä¸ªç¯å¢ƒå˜é‡</a>ï¼‰ </li></ul><h3 id="Eclipse-IDE"><a href="#Eclipse-IDE" class="headerlink" title="Eclipse (IDE)"></a>Eclipse (IDE)</h3><blockquote><p>Eclipse æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ Java å¼€å‘ç¯å¢ƒã€‚   </p></blockquote><ul><li><a href="https://www.eclipse.org/">å®˜ç½‘</a>ä¸‹è½½ </li><li>å®‰è£… (ä¸å†æ¨èä½¿ç”¨ Eclipseï¼Œè¦å®‰è£…çš„è¯æ–¹æ³•è‡ªå¯»)</li></ul><p>ï¼ˆUpdate 2020.02.19ğŸ‘†å¯¹ Eclipse çš„æ¨èæ—¶å¾ˆé•¿å¾ˆé•¿æ—¶é—´å‰å†™çš„äº†ï¼Œé‚£æ—¶å€™æˆ‘è¿˜æ²¡æœ‰æ¥è§¦è¿‡ IDEAã€‚æ—¶è‡³ä»Šæ—¥ï¼Œæˆ‘ä¸å¦ä¸º Eclipse ä»ç„¶è¿˜æ˜¯å¼ºå¤§çš„ IDEï¼Œä½†æˆ‘ç°åœ¨æ›´å–œæ¬¢æ›´åŠ ç°ä»£åŒ–ã€äººæ€§åŒ–ã€æ›´åŠ ä¼˜é›…å¼ºå¤§çš„IDEAï¼‰</p><h3 id="IntelliJ-IDEA-ï¼ˆæ¨èï¼‰"><a href="#IntelliJ-IDEA-ï¼ˆæ¨èï¼‰" class="headerlink" title="IntelliJ IDEA ï¼ˆæ¨èï¼‰"></a>IntelliJ IDEA ï¼ˆæ¨èï¼‰</h3><p><a href="https://www.jetbrains.com/">JetBrains</a> å‡ºå“çš„å¼ºå¤§ç°ä»£åŒ– IDEã€‚</p><ul><li><a href="https://www.jetbrains.com/idea/">å®˜ç½‘</a></li></ul><h2 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h2><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123; </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123; </span><br><span class="line">System.out.println(<span class="string">&quot;Hello, world!&quot;</span>); </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h4 id="è¿è¡Œæ–¹æ³•"><a href="#è¿è¡Œæ–¹æ³•" class="headerlink" title="è¿è¡Œæ–¹æ³•"></a>è¿è¡Œæ–¹æ³•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ vim HelloWorld.java </span><br><span class="line">$ javac hello.java </span><br><span class="line">$ java HelloWorld </span><br></pre></td></tr></table></figure><p><strong><code>javac</code></strong> åé¢è·Ÿç€çš„æ˜¯javaæ–‡ä»¶çš„æ–‡ä»¶åï¼Œä¾‹å¦‚ <code>HelloWorld.java</code>ã€‚ è¯¥å‘½ä»¤ç”¨äºå°† java æºæ–‡ä»¶ç¼–è¯‘ä¸º class å­—èŠ‚ç æ–‡ä»¶ï¼Œå¦‚ï¼š <code>javac HelloWorld.java</code>ã€‚<br>è¿è¡Œjavacå‘½ä»¤åï¼Œå¦‚æœæˆåŠŸç¼–è¯‘æ²¡æœ‰é”™è¯¯çš„è¯ï¼Œä¼šå‡ºç°ä¸€ä¸ª <code>HelloWorld.class</code> çš„æ–‡ä»¶ã€‚</p><p><strong><code>java</code></strong> åé¢è·Ÿç€çš„æ˜¯javaæ–‡ä»¶ä¸­çš„ç±»å(åé¢ä¸åŠ <code>.class</code>)ï¼Œå¦‚: <code>java HelloWorld</code>ã€‚ </p><p>âš ï¸ã€æ³¨æ„ã€‘æ–‡ä»¶åå¿…é¡»å’Œç±»åä¸€è‡´ï¼å¦åˆ™ä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š<br><code>é”™è¯¯: ç±» HelloWorld æ˜¯å…¬å…±çš„, åº”åœ¨åä¸º HelloWorld.java çš„æ–‡ä»¶ä¸­å£°æ˜</code> </p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ajaxæ•°æ®çˆ¬å–</title>
      <link href="/2019/02/22/PythonAndCrawler/crawler-13-ajax/"/>
      <url>/2019/02/22/PythonAndCrawler/crawler-13-ajax/</url>
      
        <content type="html"><![CDATA[<h1 id="Ajax-æ•°æ®çˆ¬å–"><a href="#Ajax-æ•°æ®çˆ¬å–" class="headerlink" title="Ajax æ•°æ®çˆ¬å–"></a>Ajax æ•°æ®çˆ¬å–</h1><blockquote><p>æœ¬èŠ‚ä¸»è¦ä»‹ç»å¦‚ä½•çˆ¬å– Ajax æ¸²æŸ“çš„ç½‘é¡µã€‚</p></blockquote><h2 id="Ajax-ç®€ä»‹"><a href="#Ajax-ç®€ä»‹" class="headerlink" title="Ajax ç®€ä»‹"></a>Ajax ç®€ä»‹</h2><blockquote><p>Ajaxï¼Œå…¨ç§°ä¸º Asynchronous JavaScript and XMLï¼Œå³å¼‚æ­¥çš„ JavaScript å’Œ XMLã€‚</p></blockquote><p>Ajax æ˜¯ä¸€ç§åˆ©ç”¨ JavaScript åœ¨ä¿è¯é¡µé¢ä¸è¢«åˆ·æ–°ã€é¡µé¢é“¾æ¥ä¸æ”¹å˜çš„æƒ…å†µä¸‹ä¸æœåŠ¡å™¨äº¤æ¢æ•°æ®å¹¶æ›´æ–°éƒ¨åˆ†ç½‘é¡µçš„æŠ€æœ¯ã€‚</p><p>å‘é€ Ajax è¯·æ±‚åˆ°ç½‘é¡µæ›´æ–°çš„è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç®€å•åˆ†ä¸ºä¸‰æ­¥ï¼š</p><ul><li>å‘é€è¯·æ±‚</li><li>è§£æå†…å®¹</li><li>æ¸²æŸ“ç½‘é¡µ</li></ul><h4 id="å‘é€è¯·æ±‚"><a href="#å‘é€è¯·æ±‚" class="headerlink" title="å‘é€è¯·æ±‚"></a>å‘é€è¯·æ±‚</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xmlhttp;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest) &#123;</span><br><span class="line">    <span class="comment">// code for IE7+, Firefox, Chrome, Opera, Safari</span></span><br><span class="line">    xmlhttp=<span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;<span class="comment">// code for IE6, IE5</span></span><br><span class="line">    xmlhttp=<span class="keyword">new</span> ActiveXObject(<span class="string">&quot;Microsoft.XMLHTTP&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">xmlhttp.onreadystatechange=<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (xmlhttp.readyState==<span class="number">4</span> &amp;&amp; xmlhttp.status==<span class="number">200</span>) &#123;</span><br><span class="line">        <span class="built_in">document</span>.getElementById(<span class="string">&quot;myDiv&quot;</span>).innerHTML=xmlhttp.responseText;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">xmlhttp.open(<span class="string">&quot;POST&quot;</span>,<span class="string">&quot;/ajax/&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">xmlhttp.send();</span><br></pre></td></tr></table></figure><p>JavaScript å¯¹ Ajax æœ€åº•å±‚çš„å®ç°ï¼Œ<br>å®é™…ä¸Šå°±æ˜¯æ–°å»ºäº† XMLHttpRequest å¯¹è±¡ï¼Œ<br>ç„¶åè°ƒç”¨äº†onreadystatechange å±æ€§è®¾ç½®äº†ç›‘å¬ï¼Œ<br>ç„¶åè°ƒç”¨ open() å’Œ send() æ–¹æ³•å‘æŸä¸ªé“¾æ¥ä¹Ÿå°±æ˜¯æœåŠ¡å™¨å‘é€äº†ä¸€ä¸ªè¯·æ±‚ï¼Œ<br>å½“æœåŠ¡å™¨è¿”å›å“åº”æ—¶ï¼Œonreadystatechange å¯¹åº”çš„æ–¹æ³•ä¾¿ä¼šè¢«è§¦å‘ï¼Œ<br>ç„¶ååœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢è§£æå“åº”å†…å®¹ã€‚</p><h4 id="è§£æå†…å®¹"><a href="#è§£æå†…å®¹" class="headerlink" title="è§£æå†…å®¹"></a>è§£æå†…å®¹</h4><p>å¾—åˆ°å“åº”ä¹‹åï¼Œonreadystatechange å±æ€§å¯¹åº”çš„æ–¹æ³•ä¾¿ä¼šè¢«è§¦å‘ï¼Œæ­¤æ—¶åˆ©ç”¨ xmlhttp çš„ responseText å±æ€§ä¾¿å¯ä»¥å–åˆ°å“åº”çš„å†…å®¹ã€‚</p><p>è¿”å›å†…å®¹å¯èƒ½æ˜¯ HTMLï¼Œå¯èƒ½æ˜¯ Jsonï¼Œæ¥ä¸‹æ¥åªéœ€è¦åœ¨æ–¹æ³•ä¸­ç”¨ JavaScript è¿›ä¸€æ­¥å¤„ç†å³å¯ã€‚æ¯”å¦‚å¦‚æœæ˜¯ Json çš„è¯ï¼Œå¯ä»¥è¿›è¡Œè§£æå’Œè½¬åŒ–ã€‚</p><h4 id="æ¸²æŸ“ç½‘é¡µ"><a href="#æ¸²æŸ“ç½‘é¡µ" class="headerlink" title="æ¸²æŸ“ç½‘é¡µ"></a>æ¸²æŸ“ç½‘é¡µ</h4><p> DOM æ“ä½œï¼Œå³å¯¹ Documentç½‘é¡µæ–‡æ¡£è¿›è¡Œæ“ä½œï¼Œå¦‚æ›´æ”¹ã€åˆ é™¤ç­‰ã€‚</p><h2 id="Ajax-åˆ†ææ–¹æ³•"><a href="#Ajax-åˆ†ææ–¹æ³•" class="headerlink" title="Ajax åˆ†ææ–¹æ³•"></a>Ajax åˆ†ææ–¹æ³•</h2><p>åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„Networkä¸­ï¼ŒAjaxçš„è¯·æ±‚ç±»å‹æ˜¯ <code>xhr</code>ã€‚</p><p>åœ¨Request Headersä¸­æœ‰ä¸€é¡¹ <code>X-Requested-With: XMLHttpRequest</code> æ ‡è®°äº†è¯¥è¯·æ±‚ä¸º Ajaxã€‚</p><p>åœ¨ Preview ä¸­å¯ä»¥çœ‹åˆ°å“åº”çš„å†…å®¹ã€‚</p><p>æœ‰äº†Request URLã€Request Headersã€Response Headersã€Response Bodyç­‰å†…å®¹ï¼Œå°±å¯ä»¥æ¨¡æ‹Ÿå‘é€Ajaxè¯·æ±‚äº†ã€‚</p><h2 id="Python-æ¨¡æ‹Ÿ-Ajax-è¯·æ±‚"><a href="#Python-æ¨¡æ‹Ÿ-Ajax-è¯·æ±‚" class="headerlink" title="Python æ¨¡æ‹Ÿ Ajax è¯·æ±‚"></a>Python æ¨¡æ‹Ÿ Ajax è¯·æ±‚</h2><p>çˆ¬å–ã€äººæ°‘æ—¥æŠ¥ã€‘çš„å¾®åšï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">url_base = <span class="string">&#x27;https://m.weibo.cn/api/container/getIndex?type=uid&amp;value=2803301701&amp;containerid=1076032803301701&#x27;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">        <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/json, text/plain, */*&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;X-Requested-With&#x27;</span>: <span class="string">&#x27;XMLHttpRequest&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;MWeibo-Pwa&#x27;</span>: <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_page</span>(<span class="params">basicUrl, headers, page</span>):</span></span><br><span class="line">    url = basicUrl + <span class="string">&#x27;&amp;page=%s&#x27;</span> % page</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(url, headers=headers)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">return</span> response.json()      <span class="comment"># Would return a dict</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;Response Status Code != 200&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">&#x27;Get Page False:&#x27;</span>, e)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_html</span>(<span class="params">html</span>):</span></span><br><span class="line">    soup = BeautifulSoup(html, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> soup.get_text()</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_content</span>(<span class="params">data</span>):</span></span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">if</span> data <span class="keyword">and</span> data.get(<span class="string">&#x27;data&#x27;</span>).get(<span class="string">&#x27;cards&#x27;</span>):</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> data.get(<span class="string">&#x27;data&#x27;</span>).get(<span class="string">&#x27;cards&#x27;</span>):</span><br><span class="line">            useful = &#123;&#125;</span><br><span class="line">            useful[<span class="string">&#x27;source&#x27;</span>] = item.get(<span class="string">&#x27;mblog&#x27;</span>).get(<span class="string">&#x27;source&#x27;</span>)</span><br><span class="line">            useful[<span class="string">&#x27;text&#x27;</span>] = parse_html(item.get(<span class="string">&#x27;mblog&#x27;</span>).get(<span class="string">&#x27;text&#x27;</span>))</span><br><span class="line"></span><br><span class="line">            result.append(useful)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_data</span>(<span class="params">data</span>):</span>    <span class="comment"># è¿™é‡Œä¸ä¿å­˜äº†ï¼Œåªæ˜¯æŠŠå®ƒæ‰“å°å‡ºæ¥</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">        print(i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">for</span> page <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">3</span>):    <span class="comment"># è®°å¾—è°ƒæ•´éœ€è¦çš„é¡µæ•°ã€‚</span></span><br><span class="line">        r = get_page(url_base, headers, page)</span><br><span class="line">        d = get_content(r)</span><br><span class="line">        save_data(d)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Crawler </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crawler </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonä¹‹Redis</title>
      <link href="/2019/02/21/PythonAndCrawler/crawler-12-redis/"/>
      <url>/2019/02/21/PythonAndCrawler/crawler-12-redis/</url>
      
        <content type="html"><![CDATA[<h1 id="Pythonçˆ¬è™«å‚¨å­˜åº“çš„ä½¿ç”¨ä¹‹Redis"><a href="#Pythonçˆ¬è™«å‚¨å­˜åº“çš„ä½¿ç”¨ä¹‹Redis" class="headerlink" title="Pythonçˆ¬è™«å‚¨å­˜åº“çš„ä½¿ç”¨ä¹‹Redis"></a>Pythonçˆ¬è™«å‚¨å­˜åº“çš„ä½¿ç”¨ä¹‹Redis</h1><blockquote><p>æœ¬æ–‡ä¸»è¦ä»‹ç» Python ä¸‹ Redis çš„ä½¿ç”¨ï¼ˆRedisPyåº“ï¼‰ã€‚</p></blockquote><h2 id="Redis-ç®€ä»‹"><a href="#Redis-ç®€ä»‹" class="headerlink" title="Redis ç®€ä»‹"></a>Redis ç®€ä»‹</h2><blockquote><p>Redis æ˜¯ä¸€ä¸ª<strong>åŸºäºå†…å­˜</strong>çš„é«˜æ•ˆçš„é”®å€¼å‹éå…³ç³»å‹æ•°æ®åº“ï¼Œå­˜å–æ•ˆç‡æé«˜ï¼Œè€Œä¸”æ”¯æŒå¤šç§å­˜å‚¨æ•°æ®ç»“æ„ã€‚</p></blockquote><p>RedisPy åº“æä¾›ä¸¤ä¸ªç±» Redis å’Œ StrictRedis ç”¨äºå®ç°Redis çš„å‘½ä»¤æ“ä½œã€‚<br>æ¨èä½¿ç”¨çš„æ˜¯ StrictRedisï¼Œå®ƒå®ç°äº†ç»å¤§éƒ¨åˆ†Redisçš„å‘½ä»¤ï¼Œå‚æ•°ä¹Ÿä¸€ä¸€å¯¹åº”ã€‚<br>Redis ä¸»è¦ç”¨æ¥å…¼å®¹æ—§ç‰ˆæœ¬ã€‚</p><h2 id="è¿æ¥-Redis"><a href="#è¿æ¥-Redis" class="headerlink" title="è¿æ¥ Redis"></a>è¿æ¥ Redis</h2><p>é¦–å…ˆéœ€è¦ç¡®å®šæ­£ç¡®åœ¨æœ¬åœ°å®‰è£…äº†Redisï¼Œå¹¶å¼€å¯äº†æœåŠ¡ã€‚</p><h4 id="ä½¿ç”¨-StrictRedis-è¿æ¥"><a href="#ä½¿ç”¨-StrictRedis-è¿æ¥" class="headerlink" title="ä½¿ç”¨ StrictRedis è¿æ¥"></a>ä½¿ç”¨ StrictRedis è¿æ¥</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> redis <span class="keyword">import</span> StrictRedis</span><br><span class="line"></span><br><span class="line">redis = StrictRedis(host=<span class="string">&#x27;localhost&#x27;</span>, port=<span class="number">6379</span>, db=<span class="number">0</span>, password=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># è¿™é‡Œä½¿ç”¨çš„è¿™å‡ ä¸ªå‚æ•°å’Œé»˜è®¤å€¼æ˜¯ç­‰æ•ˆçš„ï¼Œå³å¯ä»¥ç›´æ¥ä½¿ç”¨ `StrictRedis()` æ¥ä»£æ›¿ã€‚</span></span><br><span class="line"></span><br><span class="line">redis.<span class="built_in">set</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;Foo&#x27;</span>)    <span class="comment"># è®¾ç½®äº†ä¸€ä¸ªé”®å€¼å¯¹</span></span><br><span class="line">print(redis.get(<span class="string">&#x27;name&#x27;</span>))    <span class="comment"># è·å–ä¸€ä¸ªæ•°æ®</span></span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨-ConnectionPool-è¿æ¥"><a href="#ä½¿ç”¨-ConnectionPool-è¿æ¥" class="headerlink" title="ä½¿ç”¨ ConnectionPool è¿æ¥"></a>ä½¿ç”¨ ConnectionPool è¿æ¥</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> redis <span class="keyword">import</span> StrictRedis, ConnectionPool</span><br><span class="line"></span><br><span class="line">pool = ConnectionPool(host=<span class="string">&#x27;localhost&#x27;</span>, port=<span class="number">6379</span>, db=<span class="number">0</span>, password=<span class="literal">None</span>)</span><br><span class="line">redis = StrictRedis(connection_pool=pool)</span><br><span class="line"></span><br><span class="line">redis.<span class="built_in">set</span>(<span class="string">&#x27;age&#x27;</span>, <span class="number">100</span>)</span><br><span class="line">print(redis.get(<span class="string">&#x27;age&#x27;</span>))</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ ConnectionPool è¿˜å¯ä»¥ç”¨ URL æ¥æ„å»ºï¼š</p><p>æœ‰ä¸‰ç§å¯ç”¨çš„ URL æ ¼å¼ï¼š</p><ul><li>Redis TCP è¿æ¥ï¼š<code>redis://[:password]@host:port/db</code></li><li>Redis TCP+SSL è¿æ¥ï¼š<code>rediss://[:password]@host:port/db</code></li><li>Redis Unix Socketè¿æ¥ï¼š<code>unix://[:password]@/path/to/socket.sock?db=db</code></li></ul><p>ä½¿ç”¨çš„å§¿åŠ¿å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> redis <span class="keyword">import</span> StrictRedis, ConnectionPool</span><br><span class="line"><span class="comment"># æ³¨æ„å¤šå¯¼å…¥äº†ä¸€ä¸ªConnectionPoolã€‚</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;redis://@localhost:6379/0&#x27;</span></span><br><span class="line">pool = ConnectionPool.from_url(url)</span><br><span class="line">redis = StrictRedis(connection_pool=pool)</span><br><span class="line"></span><br><span class="line">redis.<span class="built_in">set</span>(<span class="string">&quot;test&quot;</span>, <span class="string">&#x27;test&#x27;</span>)</span><br><span class="line">r = redis.get(<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line">print(<span class="built_in">type</span>(r), r, sep=<span class="string">&#x27;\n&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="Key-æ“ä½œ"><a href="#Key-æ“ä½œ" class="headerlink" title="Key æ“ä½œ"></a>Key æ“ä½œ</h2><p>è¿™æ˜¯ä¸€äº›å¸¸ç”¨çš„å¯¹ key çš„æ“ä½œï¼Œé€šè¿‡ä½¿ç”¨å¦‚ <code>redis.exists(&#39;neme&#39;)</code> è¿™æ ·çš„è¯­å¥æ¥ä½¿ç”¨ä»–ä»¬ï¼š</p><table><thead><tr><th>æ–¹æ³•</th><th>ä½œç”¨</th><th>å‚æ•°è¯´æ˜</th><th>ç¤ºä¾‹</th><th>ç¤ºä¾‹è¯´æ˜</th><th>ç¤ºä¾‹ç»“æœ</th></tr></thead><tbody><tr><td>exists(name)</td><td>åˆ¤æ–­ä¸€ä¸ªkeyæ˜¯å¦å­˜åœ¨</td><td>name: keyå</td><td>redis.exists(â€˜nameâ€™)</td><td>æ˜¯å¦å­˜åœ¨nameè¿™ä¸ªkey</td><td>1</td></tr><tr><td>delete(name)</td><td>åˆ é™¤ä¸€ä¸ªkey</td><td>name: keyå</td><td>redis.delete(â€˜nameâ€™)</td><td>åˆ é™¤nameè¿™ä¸ªkey</td><td>1</td></tr><tr><td>type(name)</td><td>åˆ¤æ–­keyç±»å‹</td><td>name: keyå</td><td>redis.type(â€˜nameâ€™)</td><td>åˆ¤æ–­nameè¿™ä¸ªkeyç±»å‹</td><td>bâ€™stringâ€™</td></tr><tr><td>keys(pattern)</td><td>è·å–æ‰€æœ‰ç¬¦åˆè§„åˆ™çš„key</td><td>pattern: åŒ¹é…è§„åˆ™</td><td>redis.keys(â€˜n*â€™)</td><td>è·å–æ‰€æœ‰ä»¥nå¼€å¤´çš„key</td><td>[bâ€™nameâ€™]</td></tr><tr><td>randomkey()</td><td>è·å–éšæœºçš„ä¸€ä¸ªkey</td><td></td><td>randomkey()</td><td>è·å–éšæœºçš„ä¸€ä¸ªkey</td><td>bâ€™nameâ€™</td></tr><tr><td>rename(src, dst)</td><td>å°†keyé‡å‘½å</td><td>src: åŸkeyå dst: æ–°keyå</td><td>redis.rename(â€˜nameâ€™, â€˜nicknameâ€™)</td><td>å°†nameé‡å‘½åä¸ºnickname</td><td>True</td></tr><tr><td>dbsize()</td><td>è·å–å½“å‰æ•°æ®åº“ä¸­keyçš„æ•°ç›®</td><td></td><td>dbsize()</td><td>è·å–å½“å‰æ•°æ®åº“ä¸­keyçš„æ•°ç›®</td><td>100</td></tr><tr><td>expire(name, time)</td><td>è®¾å®škeyçš„è¿‡æœŸæ—¶é—´ï¼Œå•ä½ç§’</td><td>name: keyå time: ç§’æ•°</td><td>redis.expire(â€˜nameâ€™, 2)</td><td>å°†nameè¿™keyçš„è¿‡æœŸæ—¶é—´è®¾ç½®2ç§’</td><td>True</td></tr><tr><td>ttl(name)</td><td>è·å–keyçš„è¿‡æœŸæ—¶é—´ï¼Œå•ä½ç§’ï¼Œ-1ä¸ºæ°¸ä¹…ä¸è¿‡æœŸ</td><td>name: keyå</td><td>redis.ttl(â€˜nameâ€™)</td><td>è·å–nameè¿™keyçš„è¿‡æœŸæ—¶é—´</td><td>-1</td></tr><tr><td>move(name, db)</td><td>å°†keyç§»åŠ¨åˆ°å…¶ä»–æ•°æ®åº“</td><td>name: keyå db: æ•°æ®åº“ä»£å·</td><td>move(â€˜nameâ€™, 2)</td><td>å°†nameç§»åŠ¨åˆ°2å·æ•°æ®åº“</td><td>True</td></tr><tr><td>flushdb()</td><td>åˆ é™¤å½“å‰é€‰æ‹©æ•°æ®åº“ä¸­çš„æ‰€æœ‰key</td><td></td><td>flushdb()</td><td>åˆ é™¤å½“å‰é€‰æ‹©æ•°æ®åº“ä¸­çš„æ‰€æœ‰key</td><td>True</td></tr><tr><td>flushall()</td><td>åˆ é™¤æ‰€æœ‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰key</td><td></td><td>flushall()</td><td>åˆ é™¤æ‰€æœ‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰key</td><td>True</td></tr></tbody></table><h2 id="String-æ“ä½œ"><a href="#String-æ“ä½œ" class="headerlink" title="String æ“ä½œ"></a>String æ“ä½œ</h2><p>String æ˜¯ Redis ä¸­æœ€åŸºæœ¬çš„Valueå‚¨å­˜æ–¹å¼ï¼Œä»–çš„æ“ä½œå¦‚ä¸‹ï¼Œ</p><table><thead><tr><th>æ–¹æ³•</th><th>ä½œç”¨</th><th>å‚æ•°è¯´æ˜</th><th>ç¤ºä¾‹</th><th>ç¤ºä¾‹è¯´æ˜</th><th>ç¤ºä¾‹ç»“æœ</th></tr></thead><tbody><tr><td>set(name, value)</td><td>ç»™æ•°æ®åº“ä¸­keyä¸ºnameçš„stringèµ‹äºˆå€¼value</td><td>name: keyå value: å€¼</td><td>redis.set(â€˜nameâ€™, â€˜Bobâ€™)</td><td>ç»™nameè¿™ä¸ªkeyçš„valueèµ‹å€¼ä¸ºBob</td><td>True</td></tr><tr><td>get(name)</td><td>è¿”å›æ•°æ®åº“ä¸­keyä¸ºnameçš„stringçš„value</td><td>name: keyå</td><td>redis.get(â€˜nameâ€™)</td><td>è¿”å›nameè¿™ä¸ªkeyçš„value</td><td>bâ€™Bobâ€™</td></tr><tr><td>getset(name, value)</td><td>ç»™æ•°æ®åº“ä¸­keyä¸ºnameçš„stringèµ‹äºˆå€¼valueå¹¶è¿”å›ä¸Šæ¬¡çš„value</td><td>name: keyå value: æ–°å€¼</td><td>redis.getset(â€˜nameâ€™, â€˜Mikeâ€™)</td><td>èµ‹å€¼nameä¸ºMikeå¹¶å¾—åˆ°ä¸Šæ¬¡çš„value</td><td>bâ€™Bobâ€™</td></tr><tr><td>mget(keys, *args)</td><td>è¿”å›å¤šä¸ªkeyå¯¹åº”çš„value</td><td>keys: keyçš„åˆ—è¡¨</td><td>redis.mget([â€˜nameâ€™, â€˜nicknameâ€™])</td><td>è¿”å›nameå’Œnicknameçš„value</td><td>[bâ€™Mikeâ€™, bâ€™Mikerâ€™]</td></tr><tr><td>setnx(name, value)</td><td>å¦‚æœkeyä¸å­˜åœ¨æ‰è®¾ç½®value</td><td>name: keyå</td><td>redis.setnx(â€˜newnameâ€™, â€˜Jamesâ€™)</td><td>å¦‚æœnewnameè¿™keyä¸å­˜åœ¨åˆ™è®¾ç½®å€¼ä¸ºJames</td><td>ç¬¬ä¸€æ¬¡è¿è¡ŒTrueï¼Œç¬¬äºŒæ¬¡False</td></tr><tr><td>setex(name, time, value)</td><td>è®¾ç½®å¯ä»¥å¯¹åº”çš„å€¼ä¸ºstringç±»å‹çš„valueï¼Œå¹¶æŒ‡å®šæ­¤é”®å€¼å¯¹åº”çš„æœ‰æ•ˆæœŸ</td><td>name: keyå time: æœ‰æ•ˆæœŸ value: å€¼</td><td>redis.setex(â€˜nameâ€™, 1, â€˜Jamesâ€™)</td><td>å°†nameè¿™keyçš„å€¼è®¾ä¸ºJamesï¼Œæœ‰æ•ˆæœŸ1ç§’</td><td>True</td></tr><tr><td>setrange(name, offset, value)</td><td>è®¾ç½®æŒ‡å®škeyçš„valueå€¼çš„å­å­—ç¬¦ä¸²</td><td>name: keyå offset: åç§»é‡ value: å€¼</td><td>redis.set(â€˜nameâ€™, â€˜Helloâ€™) redis.setrange(â€˜nameâ€™, 6, â€˜Worldâ€™)</td><td>è®¾ç½®nameä¸ºHelloå­—ç¬¦ä¸²ï¼Œå¹¶åœ¨indexä¸º6çš„ä½ç½®è¡¥World</td><td>11ï¼Œä¿®æ”¹åçš„å­—ç¬¦ä¸²é•¿åº¦</td></tr><tr><td>mset(mapping)</td><td>æ‰¹é‡èµ‹å€¼</td><td>mapping: å­—å…¸</td><td>redis.mset({â€˜name1â€™: â€˜Durantâ€™, â€˜name2â€™: â€˜Jamesâ€™})</td><td>å°†name1è®¾ä¸ºDurantï¼Œname2è®¾ä¸ºJames</td><td>True</td></tr><tr><td>msetnx(mapping)</td><td>keyå‡ä¸å­˜åœ¨æ—¶æ‰æ‰¹é‡èµ‹å€¼</td><td>mapping: å­—å…¸</td><td>redis.msetnx({â€˜name3â€™: â€˜Smithâ€™, â€˜name4â€™: â€˜Curryâ€™})</td><td>åœ¨name3å’Œname4å‡ä¸å­˜åœ¨çš„æƒ…å†µä¸‹æ‰è®¾ç½®äºŒè€…å€¼</td><td>True</td></tr><tr><td>incr(name, amount=1)</td><td>keyä¸ºnameçš„valueå¢å€¼æ“ä½œï¼Œé»˜è®¤1ï¼Œkeyä¸å­˜åœ¨åˆ™è¢«åˆ›å»ºå¹¶è®¾ä¸ºamount</td><td>name: keyå amount:å¢é•¿çš„å€¼</td><td>redis.incr(â€˜ageâ€™, 1)</td><td>ageå¯¹åº”çš„å€¼å¢1ï¼Œè‹¥ä¸å­˜åœ¨åˆ™ä¼šåˆ›å»ºå¹¶è®¾ç½®ä¸º1</td><td>1ï¼Œå³ä¿®æ”¹åçš„å€¼</td></tr><tr><td>decr(name, amount=1)</td><td>keyä¸ºnameçš„valueå‡å€¼æ“ä½œï¼Œé»˜è®¤1ï¼Œkeyä¸å­˜åœ¨åˆ™è¢«åˆ›å»ºå¹¶è®¾ç½®ä¸º-amount</td><td>name: keyå amount:å‡å°‘çš„å€¼</td><td>redis.decr(â€˜ageâ€™, 1)</td><td>ageå¯¹åº”çš„å€¼å‡1ï¼Œè‹¥ä¸å­˜åœ¨åˆ™ä¼šåˆ›å»ºå¹¶è®¾ç½®ä¸º-1</td><td>-1ï¼Œå³ä¿®æ”¹åçš„å€¼</td></tr><tr><td>append(key, value)</td><td>keyä¸ºnameçš„stringçš„å€¼é™„åŠ value</td><td>key: keyå</td><td>redis.append(â€˜nicknameâ€™, â€˜OKâ€™)</td><td>å‘keyä¸ºnicknameçš„å€¼åè¿½åŠ OK</td><td>13ï¼Œå³ä¿®æ”¹åçš„å­—ç¬¦ä¸²é•¿åº¦</td></tr><tr><td>substr(name, start, end=-1)</td><td>è¿”å›keyä¸ºnameçš„stringçš„valueçš„å­ä¸²</td><td>name: keyå start: èµ·å§‹ç´¢å¼• end: ç»ˆæ­¢ç´¢å¼•ï¼Œé»˜è®¤-1æˆªå–åˆ°æœ«å°¾</td><td>redis.substr(â€˜nameâ€™, 1, 4)</td><td>è¿”å›keyä¸ºnameçš„å€¼çš„å­—ç¬¦ä¸²ï¼Œæˆªå–ç´¢å¼•ä¸º1-4çš„å­—ç¬¦</td><td>bâ€™elloâ€™</td></tr><tr><td>getrange(key, start, end)</td><td>è·å–keyçš„valueå€¼ä»startåˆ°endçš„å­å­—ç¬¦ä¸²</td><td>key: keyå start: èµ·å§‹ç´¢å¼• end: ç»ˆæ­¢ç´¢å¼•</td><td>redis.getrange(â€˜nameâ€™, 1, 4)</td><td>è¿”å›keyä¸ºnameçš„å€¼çš„å­—ç¬¦ä¸²ï¼Œæˆªå–ç´¢å¼•ä¸º1-4çš„å­—ç¬¦</td><td>bâ€™elloâ€™</td></tr></tbody></table><h2 id="List-æ“ä½œ"><a href="#List-æ“ä½œ" class="headerlink" title="List æ“ä½œ"></a>List æ“ä½œ</h2><p>List æ˜¯ Redis ä¸­ value ä¸ºåˆ—è¡¨çš„ä¸€ç§æ•°æ®ã€‚</p><table><thead><tr><th>æ–¹æ³•</th><th>ä½œç”¨</th><th>å‚æ•°è¯´æ˜</th><th>ç¤ºä¾‹</th><th>ç¤ºä¾‹è¯´æ˜</th><th>ç¤ºä¾‹ç»“æœ</th></tr></thead><tbody><tr><td>rpush(name, *values)</td><td>åœ¨keyä¸ºnameçš„listå°¾æ·»åŠ å€¼ä¸ºvalueçš„å…ƒç´ ï¼Œå¯ä»¥ä¼ å¤šä¸ª</td><td>name: keyå values: å€¼</td><td>redis.rpush(â€˜listâ€™, 1, 2, 3)</td><td>ç»™listè¿™ä¸ªkeyçš„listå°¾æ·»åŠ 1ã€2ã€3</td><td>3ï¼Œlistå¤§å°</td></tr><tr><td>lpush(name, *values)</td><td>åœ¨keyä¸ºnameçš„listå¤´æ·»åŠ å€¼ä¸ºvalueçš„å…ƒç´ ï¼Œå¯ä»¥ä¼ å¤šä¸ª</td><td>name: keyå values: å€¼</td><td>redis.lpush(â€˜listâ€™, 0)</td><td>ç»™listè¿™ä¸ªkeyçš„listå¤´æ·»åŠ 0</td><td>4ï¼Œlistå¤§å°</td></tr><tr><td>llen(name)</td><td>è¿”å›keyä¸ºnameçš„listçš„é•¿åº¦</td><td>name: keyå</td><td>redis.llen(â€˜listâ€™)</td><td>è¿”å›keyä¸ºlistçš„åˆ—è¡¨çš„é•¿åº¦</td><td>4</td></tr><tr><td>lrange(name, start, end)</td><td>è¿”å›keyä¸ºnameçš„listä¸­startè‡³endä¹‹é—´çš„å…ƒç´ </td><td>name: keyå start: èµ·å§‹ç´¢å¼• end: ç»ˆæ­¢ç´¢å¼•</td><td>redis.lrange(â€˜listâ€™, 1, 3)</td><td>è¿”å›èµ·å§‹ä¸º1ç»ˆæ­¢ä¸º3çš„ç´¢å¼•èŒƒå›´å¯¹åº”çš„list</td><td>[bâ€™3â€™, bâ€™2â€™, bâ€™1â€™]</td></tr><tr><td>ltrim(name, start, end)</td><td>æˆªå–keyä¸ºnameçš„listï¼Œä¿ç•™ç´¢å¼•ä¸ºstartåˆ°endçš„å†…å®¹</td><td>name:keyå start: èµ·å§‹ç´¢å¼• end: ç»ˆæ­¢ç´¢å¼•</td><td>ltrim(â€˜listâ€™, 1, 3)</td><td>ä¿ç•™keyä¸ºlistçš„ç´¢å¼•ä¸º1åˆ°3çš„å…ƒç´ </td><td>True</td></tr><tr><td>lindex(name, index)</td><td>è¿”å›keyä¸ºnameçš„listä¸­indexä½ç½®çš„å…ƒç´ </td><td>name: keyå index: ç´¢å¼•</td><td>redis.lindex(â€˜listâ€™, 1)</td><td>è¿”å›keyä¸ºlistçš„åˆ—è¡¨indexä¸º1çš„å…ƒç´ </td><td>bâ€™2â€™</td></tr><tr><td>lset(name, index, value)</td><td>ç»™keyä¸ºnameçš„listä¸­indexä½ç½®çš„å…ƒç´ èµ‹å€¼ï¼Œè¶Šç•Œåˆ™æŠ¥é”™</td><td>name: keyå index: ç´¢å¼•ä½ç½® value: å€¼</td><td>redis.lset(â€˜listâ€™, 1, 5)</td><td>å°†keyä¸ºlistçš„listç´¢å¼•1ä½ç½®èµ‹å€¼ä¸º5</td><td>True</td></tr><tr><td>lrem(name, count, value)</td><td>åˆ é™¤countä¸ªkeyçš„listä¸­å€¼ä¸ºvalueçš„å…ƒç´ </td><td>name: keyå count: åˆ é™¤ä¸ªæ•° value: å€¼</td><td>redis.lrem(â€˜listâ€™, 2, 3)</td><td>å°†keyä¸ºlistçš„åˆ—è¡¨åˆ é™¤2ä¸ª3</td><td>1ï¼Œå³åˆ é™¤çš„ä¸ªæ•°</td></tr><tr><td>lpop(name)</td><td>è¿”å›å¹¶åˆ é™¤keyä¸ºnameçš„listä¸­çš„é¦–å…ƒç´ </td><td>name: keyå</td><td>redis.lpop(â€˜listâ€™)</td><td>è¿”å›å¹¶åˆ é™¤åä¸ºlistçš„listç¬¬ä¸€ä¸ªå…ƒç´ </td><td>bâ€™5â€™</td></tr><tr><td>rpop(name)</td><td>è¿”å›å¹¶åˆ é™¤keyä¸ºnameçš„listä¸­çš„å°¾å…ƒç´ </td><td>name: keyå</td><td>redis.rpop(â€˜listâ€™)</td><td>è¿”å›å¹¶åˆ é™¤åä¸ºlistçš„listæœ€åä¸€ä¸ªå…ƒç´ </td><td>bâ€™2â€™</td></tr><tr><td>blpop(keys, timeout=0)</td><td>è¿”å›å¹¶åˆ é™¤åç§°ä¸ºåœ¨keysä¸­çš„listä¸­çš„é¦–å…ƒç´ ï¼Œå¦‚æœlistä¸ºç©ºï¼Œåˆ™ä¼šä¸€ç›´é˜»å¡ç­‰å¾…</td><td>keys: keyåˆ—è¡¨ timeout: è¶…æ—¶ç­‰å¾…æ—¶é—´ï¼Œ0ä¸ºä¸€ç›´ç­‰å¾…</td><td>redis.blpop(â€˜listâ€™)</td><td>è¿”å›å¹¶åˆ é™¤åä¸ºlistçš„listçš„ç¬¬ä¸€ä¸ªå…ƒç´ </td><td>[bâ€™5â€™]</td></tr><tr><td>brpop(keys, timeout=0)</td><td>è¿”å›å¹¶åˆ é™¤keyä¸ºnameçš„listä¸­çš„å°¾å…ƒç´ ï¼Œå¦‚æœlistä¸ºç©ºï¼Œåˆ™ä¼šä¸€ç›´é˜»å¡ç­‰å¾…</td><td>keys: keyåˆ—è¡¨ timeout: è¶…æ—¶ç­‰å¾…æ—¶é—´ï¼Œ0ä¸ºä¸€ç›´ç­‰å¾…</td><td>redis.brpop(â€˜listâ€™)</td><td>è¿”å›å¹¶åˆ é™¤åä¸ºlistçš„listçš„æœ€åä¸€ä¸ªå…ƒç´ </td><td>[bâ€™2â€™]</td></tr><tr><td>rpoplpush(src, dst)</td><td>è¿”å›å¹¶åˆ é™¤åç§°ä¸ºsrcçš„listçš„å°¾å…ƒç´ ï¼Œå¹¶å°†è¯¥å…ƒç´ æ·»åŠ åˆ°åç§°ä¸ºdstçš„listçš„å¤´éƒ¨</td><td>src: æºlistçš„key dst: ç›®æ ‡listçš„key</td><td>redis.rpoplpush(â€˜listâ€™, â€˜list2â€™)</td><td>å°†keyä¸ºlistçš„listå°¾å…ƒç´ åˆ é™¤å¹¶è¿”å›å¹¶å°†å…¶æ·»åŠ åˆ°keyä¸ºlist2çš„listå¤´éƒ¨</td><td>bâ€™2â€™</td></tr></tbody></table><h2 id="Set-ã€Sorted-Setæ“ä½œ"><a href="#Set-ã€Sorted-Setæ“ä½œ" class="headerlink" title="Set ã€Sorted Setæ“ä½œ"></a>Set ã€Sorted Setæ“ä½œ</h2><p>è¯¦è§ <a href="https://germey.gitbooks.io/python3webspider/content/5.3.2-Redis%E5%AD%98%E5%82%A8.html">Redisæ•™ç¨‹</a>ã€‚</p><h2 id="Hash-æ“ä½œ"><a href="#Hash-æ“ä½œ" class="headerlink" title="Hash æ“ä½œ"></a>Hash æ“ä½œ</h2><p>Redis ä¸­å¯ä»¥ç”¨nameæŒ‡å®šä¸€ä¸ªå“ˆå¸Œè¡¨çš„åç§°ï¼Œç„¶åè¡¨å†…å­˜å‚¨äº†å„ä¸ªé”®å€¼å¯¹ã€‚</p><table><thead><tr><th>æ–¹æ³•</th><th>ä½œç”¨</th><th>å‚æ•°è¯´æ˜</th><th>ç¤ºä¾‹</th><th>ç¤ºä¾‹è¯´æ˜</th><th>ç¤ºä¾‹ç»“æœ</th></tr></thead><tbody><tr><td>hset(name, key, value)</td><td>å‘keyä¸ºnameçš„hashä¸­æ·»åŠ æ˜ å°„</td><td>name: keyå key: æ˜ å°„é”®å value: æ˜ å°„é”®å€¼</td><td>hset(â€˜priceâ€™, â€˜cakeâ€™, 5)</td><td>å‘keyä¸ºpriceçš„hashä¸­æ·»åŠ æ˜ å°„å…³ç³»ï¼Œcakeçš„å€¼ä¸º5</td><td>1ï¼Œå³æ·»åŠ çš„æ˜ å°„ä¸ªæ•°</td></tr><tr><td>hsetnx(name, key, value)</td><td>å‘keyä¸ºnameçš„hashä¸­æ·»åŠ æ˜ å°„ï¼Œå¦‚æœæ˜ å°„é”®åä¸å­˜åœ¨</td><td>name: keyå key: æ˜ å°„é”®å value: æ˜ å°„é”®å€¼</td><td>hsetnx(â€˜priceâ€™, â€˜bookâ€™, 6)</td><td>å‘keyä¸ºpriceçš„hashä¸­æ·»åŠ æ˜ å°„å…³ç³»ï¼Œbookçš„å€¼ä¸º6</td><td>1ï¼Œå³æ·»åŠ çš„æ˜ å°„ä¸ªæ•°</td></tr><tr><td>hget(name, key)</td><td>è¿”å›keyä¸ºnameçš„hashä¸­fieldå¯¹åº”çš„value</td><td>name: keyå key: æ˜ å°„é”®å</td><td>redis.hget(â€˜priceâ€™, â€˜cakeâ€™)</td><td>è·å–keyä¸ºpriceçš„hashä¸­é”®åä¸ºcakeçš„value</td><td>5</td></tr><tr><td>hmget(name, keys, *args)</td><td>è¿”å›keyä¸ºnameçš„hashä¸­å„ä¸ªé”®å¯¹åº”çš„value</td><td>name: keyå keys: æ˜ å°„é”®ååˆ—è¡¨</td><td>redis.hmget(â€˜priceâ€™, [â€˜appleâ€™, â€˜orangeâ€™])</td><td>è·å–keyä¸ºpriceçš„hashä¸­appleå’Œorangeçš„å€¼</td><td>[bâ€™3â€™, bâ€™7â€™]</td></tr><tr><td>hmset(name, mapping)</td><td>å‘keyä¸ºnameçš„hashä¸­æ‰¹é‡æ·»åŠ æ˜ å°„</td><td>name: keyå mapping: æ˜ å°„å­—å…¸</td><td>redis.hmset(â€˜priceâ€™, {â€˜bananaâ€™: 2, â€˜pearâ€™: 6})</td><td>å‘keyä¸ºpriceçš„hashä¸­æ‰¹é‡æ·»åŠ æ˜ å°„</td><td>True</td></tr><tr><td>hincrby(name, key, amount=1)</td><td>å°†keyä¸ºnameçš„hashä¸­æ˜ å°„çš„valueå¢åŠ amount</td><td>name: keyå key: æ˜ å°„é”®å amount: å¢é•¿é‡</td><td>redis.hincrby(â€˜priceâ€™, â€˜appleâ€™, 3)</td><td>keyä¸ºpriceçš„hashä¸­appleçš„å€¼å¢åŠ 3</td><td>6ï¼Œä¿®æ”¹åçš„å€¼</td></tr><tr><td>hexists(name, key)</td><td>keyä¸ºnamehashä¸­æ˜¯å¦å­˜åœ¨é”®åä¸ºkeyçš„æ˜ å°„</td><td>name: keyå key: æ˜ å°„é”®å</td><td>redis.hexists(â€˜priceâ€™, â€˜bananaâ€™)</td><td>keyä¸ºpriceçš„hashä¸­bananaçš„å€¼æ˜¯å¦å­˜åœ¨</td><td>True</td></tr><tr><td>hdel(name, *keys)</td><td>keyä¸ºnamehashä¸­åˆ é™¤é”®åä¸ºkeyçš„æ˜ å°„</td><td>name: keyå key: æ˜ å°„é”®å</td><td>redis.hdel(â€˜priceâ€™, â€˜bananaâ€™)</td><td>ä»keyä¸ºpriceçš„hashä¸­åˆ é™¤é”®åä¸ºbananaçš„æ˜ å°„</td><td>True</td></tr><tr><td>hlen(name)</td><td>ä»keyä¸ºnameçš„hashä¸­è·å–æ˜ å°„ä¸ªæ•°</td><td>name: keyå</td><td>redis.hlen(â€˜priceâ€™)</td><td>ä»keyä¸ºpriceçš„hashä¸­è·å–æ˜ å°„ä¸ªæ•°</td><td>6</td></tr><tr><td>hkeys(name)</td><td>ä»keyä¸ºnameçš„hashä¸­è·å–æ‰€æœ‰æ˜ å°„é”®å</td><td>name: keyå</td><td>redis.hkeys(â€˜priceâ€™)</td><td>ä»keyä¸ºpriceçš„hashä¸­è·å–æ‰€æœ‰æ˜ å°„é”®å</td><td>[bâ€™cakeâ€™, bâ€™bookâ€™, bâ€™bananaâ€™, bâ€™pearâ€™]</td></tr><tr><td>hvals(name)</td><td>ä»keyä¸ºnameçš„hashä¸­è·å–æ‰€æœ‰æ˜ å°„é”®å€¼</td><td>name: keyå</td><td>redis.hvals(â€˜priceâ€™)</td><td>ä»keyä¸ºpriceçš„hashä¸­è·å–æ‰€æœ‰æ˜ å°„é”®å€¼</td><td>[bâ€™5â€™, bâ€™6â€™, bâ€™2â€™, bâ€™6â€™]</td></tr><tr><td>hgetall(name)</td><td>ä»keyä¸ºnameçš„hashä¸­è·å–æ‰€æœ‰æ˜ å°„é”®å€¼å¯¹</td><td>name: keyå</td><td>redis.hgetall(â€˜priceâ€™)</td><td>ä»keyä¸ºpriceçš„hashä¸­è·å–æ‰€æœ‰æ˜ å°„é”®å€¼å¯¹</td><td>{bâ€™cakeâ€™: bâ€™5â€™, bâ€™bookâ€™: bâ€™6â€™, bâ€™orangeâ€™: bâ€™7â€™, bâ€™pearâ€™: bâ€™6â€™}</td></tr></tbody></table><h2 id="RedisDump"><a href="#RedisDump" class="headerlink" title="RedisDump"></a>RedisDump</h2><p>RedisDump æä¾›äº† Redis æ•°æ®çš„å¯¼å…¥å’Œå¯¼å‡ºåŠŸèƒ½ã€‚</p><p>RedisDump æä¾›ä¸¤ä¸ªå¯æ‰§è¡Œå‘½ä»¤ï¼š</p><ul><li><code>redis-dump</code> ç”¨äº å¯¼å‡º æ•°æ®ï¼›è¯¦è§ <code>redis-dump -h</code><ul><li>e.g. <code>$ redis-dump -u :foobared@localhost:6379 &gt; ./redis_data.jl</code></li></ul></li><li><code>redis-load</code> ç”¨äº å¯¼å…¥ æ•°æ®ï¼›è¯¦è§ <code>redis-load -h</code><ul><li>e.g. <code>$ redis-load -u :foobared@localhost:6379 &lt; redis_data.json</code></li><li>ç­‰ä»·äº<code>$ cat redis_data.json | redis-load -u :foobared@localhost:6379</code></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> Crawler </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crawler </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonä¹‹MongoDB</title>
      <link href="/2019/02/20/PythonAndCrawler/crawler-11-mongodb/"/>
      <url>/2019/02/20/PythonAndCrawler/crawler-11-mongodb/</url>
      
        <content type="html"><![CDATA[<h1 id="Pythonçˆ¬è™«å‚¨å­˜åº“çš„ä½¿ç”¨ä¹‹MongoDB"><a href="#Pythonçˆ¬è™«å‚¨å­˜åº“çš„ä½¿ç”¨ä¹‹MongoDB" class="headerlink" title="Pythonçˆ¬è™«å‚¨å­˜åº“çš„ä½¿ç”¨ä¹‹MongoDB"></a>Pythonçˆ¬è™«å‚¨å­˜åº“çš„ä½¿ç”¨ä¹‹MongoDB</h1><blockquote><p>æœ¬æ–‡ä¸»è¦ä»‹ç» Python ä¸‹ MongoDB çš„ä½¿ç”¨ï¼ˆPyMongoåº“ï¼‰ã€‚</p></blockquote><h2 id="MongoDB-ç®€ä»‹"><a href="#MongoDB-ç®€ä»‹" class="headerlink" title="MongoDB ç®€ä»‹"></a>MongoDB ç®€ä»‹</h2><blockquote><p>MongoDB æ˜¯ç”± C++ è¯­è¨€ç¼–å†™çš„éå…³ç³»å‹æ•°æ®åº“ï¼Œæ˜¯ä¸€ä¸ªåŸºäºåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨çš„å¼€æºæ•°æ®åº“ç³»ç»Ÿï¼Œå…¶å†…å®¹å­˜å‚¨å½¢å¼ç±»ä¼¼ Json å¯¹è±¡ï¼Œå®ƒçš„å­—æ®µå€¼å¯ä»¥åŒ…å«å…¶ä»–æ–‡æ¡£ï¼Œæ•°ç»„åŠæ–‡æ¡£æ•°ç»„ï¼Œéå¸¸çµæ´»ã€‚</p></blockquote><p>åœ¨ä½¿ç”¨å‰è¦å…ˆç¡®å®š MongoDB å®‰è£…å¥½ï¼Œå¹¶å·²ç»å¼€å¯äº†æœåŠ¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ brew services start mongodb</span><br><span class="line">$ sudo mongod</span><br><span class="line">$ mongo</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä¸‰æ¡å‘½ä»¤å¼€å¯äº† MongoDB çš„æœåŠ¡ï¼Œå¹¶æ‰“å¼€å®¢æˆ·ç«¯ã€‚</p><h2 id="è¿æ¥æ•°æ®åº“"><a href="#è¿æ¥æ•°æ®åº“" class="headerlink" title="è¿æ¥æ•°æ®åº“"></a>è¿æ¥æ•°æ®åº“</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line">client = pymongo.MongoClient(host=<span class="string">&#x27;localhost&#x27;</span>, port=<span class="number">27017</span>)</span><br><span class="line"><span class="comment"># client = pymongo.MongoClient(&#x27;mongodb://localhost:27017/&#x27;)    æ•ˆæœæ˜¯ä¸€æ ·çš„</span></span><br></pre></td></tr></table></figure><h2 id="æŒ‡å®šæ•°æ®åº“"><a href="#æŒ‡å®šæ•°æ®åº“" class="headerlink" title="æŒ‡å®šæ•°æ®åº“"></a>æŒ‡å®šæ•°æ®åº“</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db = client.test</span><br><span class="line"><span class="comment"># db = client[&#x27;test&#x27;]   ç­‰ä»·</span></span><br></pre></td></tr></table></figure><h2 id="æŒ‡å®šé›†åˆ"><a href="#æŒ‡å®šé›†åˆ" class="headerlink" title="æŒ‡å®šé›†åˆ"></a>æŒ‡å®šé›†åˆ</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">collection = db.students    <span class="comment"># è¿˜æ˜¯å¯ä»¥ç”¨`[&#x27;&#x27;]`æ¥å–</span></span><br></pre></td></tr></table></figure><h2 id="æ’å…¥æ•°æ®"><a href="#æ’å…¥æ•°æ®" class="headerlink" title="æ’å…¥æ•°æ®"></a>æ’å…¥æ•°æ®</h2><p>æ’å…¥æ•°æ®æœ‰3ç§æ–¹æ³•ï¼š</p><ul><li><code>collection.insert()</code>ï¼šæ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®ï¼Œä¼ å…¥ä¸€ä¸ªå¯¹è±¡åˆ™æ’å…¥ä¸€ä¸ªï¼Œä¼ å…¥ä¸€ä¸ªå¯¹è±¡çš„listå¯ä»¥æ’å…¥å¤šä¸ªï¼ˆå®˜æ–¹ä¸æ¨èä½¿ç”¨ï¼‰ï¼›</li><li><code>collection.insert_one()</code>ï¼šæ’å…¥ä¸€ä¸ªæ•°æ®ï¼Œä¼ å…¥ä¸€ä¸ªdictï¼›</li><li><code>collection.insert_many()</code>ï¼šæ’å…¥å¤šä¸ªæ•°æ®ï¼Œä¼ å…¥ä¸€ä¸ªdictçš„listï¼›</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">client = pymongo.MongoClient(host=<span class="string">&#x27;localhost&#x27;</span>, port=<span class="number">27017</span>)</span><br><span class="line">db = client.test</span><br><span class="line">collection = db.students</span><br><span class="line"></span><br><span class="line">student1 = &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;2099133201&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Foo&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;age&#x27;</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="string">&#x27;gender&#x27;</span>: <span class="string">&#x27;male&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">student2 = &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;2099133202&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Bar&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;age&#x27;</span>: <span class="number">11</span>,</span><br><span class="line">        <span class="string">&#x27;gender&#x27;</span>: <span class="string">&#x27;male&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">student3 = &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;2099133203&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Moo&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;age&#x27;</span>: <span class="number">12</span>,</span><br><span class="line">        <span class="string">&#x27;gender&#x27;</span>: <span class="string">&#x27;female&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">result0 = collection.insert_one(student1)</span><br><span class="line">result1 = collection.insert_many([student2, student3])</span><br><span class="line">print(result0, result0.inserted_id, sep=<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">print(result1, result1.inserted_ids, sep=<span class="string">&#x27;\n&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="æŸ¥è¯¢"><a href="#æŸ¥è¯¢" class="headerlink" title="æŸ¥è¯¢"></a>æŸ¥è¯¢</h2><p>æŸ¥è¯¢ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ï¼š</p><ul><li><code>find_one()</code>ï¼šæŸ¥å¾—å•ä¸ªç»“æœ</li><li><code>find()</code>ï¼šè¿”å›ä¸€ä¸ªç»“æœçš„ç”Ÿæˆå™¨</li></ul><p>å¦‚æœæŸ¥è¯¢çš„ç»“æœä¸å­˜åœ¨ï¼Œä¼šè¿”å› <code>None</code>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">res_of_find = collection.find()     <span class="comment"># å¾—åˆ°æ‰€æœ‰æ•°æ®</span></span><br><span class="line">print(<span class="string">&#x27;find:\n&#x27;</span>, res_of_find)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res_of_find:</span><br><span class="line">    print(i)</span><br><span class="line"></span><br><span class="line">res_of_findone = collection.find_one(&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Foo&#x27;</span>&#125;)   <span class="comment"># é€šè¿‡ä¼ å…¥ä¸€ç»„å­—å…¸é”®å€¼æ¥æŸ¥è¯¢</span></span><br><span class="line">print(<span class="string">&#x27;find_one:\n&#x27;</span>, res_of_findone)</span><br></pre></td></tr></table></figure><p>å¦‚æœè¦é€šè¿‡ MongoDB ä¸ºæ¯æ¡æ•°æ®æ·»åŠ çš„ <code>_id</code> å±æ€§æ¥æŸ¥è¯¢ï¼Œéœ€è¦è¿™æ ·åšï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res_of_find_by_id = collection.find_one(&#123;<span class="string">&#x27;_id&#x27;</span>: ObjectId(<span class="string">&#x27;5c78e0c6b92a4e5f17d70cfa&#x27;</span>)&#125;)</span><br><span class="line">print(<span class="string">&#x27;find by id:\n&#x27;</span>, res_of_find_by_id)</span><br></pre></td></tr></table></figure><p>å¦‚æœè¦æŸ¥è¯¢ â€œå¹´é¾„å¤§äº10â€ çš„æ•°æ®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">collection.find(&#123;<span class="string">&#x27;age&#x27;</span>: &#123;<span class="string">&#x27;$gt&#x27;</span>: <span class="number">10</span>&#125;&#125;)</span><br></pre></td></tr></table></figure><p>è¿™é‡ŒæŸ¥è¯¢æ¡ä»¶çš„valueå˜æˆäº†ä¸€ä¸ªç¬¦å·åŠ è¿ç®—å€¼çš„å­—å…¸ï¼Œå¯ç”¨çš„æ“ä½œå¦‚ä¸‹ï¼š</p><table><thead><tr><th>ç¬¦å·</th><th>å«ä¹‰</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>$lt</code></td><td>å°äº</td><td><code>&#123;&#39;age&#39;: &#123;&#39;$lt&#39;: 20&#125;&#125;</code></td></tr><tr><td><code>$gt</code></td><td>å¤§äº</td><td><code>&#123;&#39;age&#39;: &#123;&#39;$gt&#39;: 20&#125;&#125;</code></td></tr><tr><td><code>$lte</code></td><td>å°äºç­‰äº</td><td><code>&#123;&#39;age&#39;: &#123;&#39;$lte&#39;: 20&#125;&#125;</code></td></tr><tr><td><code>$gte</code></td><td>å¤§äºç­‰äº</td><td><code>&#123;&#39;age&#39;: &#123;&#39;$gte&#39;: 20&#125;&#125;</code></td></tr><tr><td><code>$ne</code></td><td>ä¸ç­‰äº</td><td><code>&#123;&#39;age&#39;: &#123;&#39;$ne&#39;: 20&#125;&#125;</code></td></tr><tr><td><code>$in</code></td><td>åœ¨èŒƒå›´å†…</td><td><code>&#123;&#39;age&#39;: &#123;&#39;$in&#39;: [20, 23]&#125;&#125;</code></td></tr><tr><td><code>$nin</code></td><td>ä¸åœ¨èŒƒå›´å†…</td><td><code>&#123;&#39;age&#39;: &#123;&#39;$nin&#39;: [20, 23]&#125;&#125;</code></td></tr></tbody></table><p>è¿˜æœ‰å¤šç§æŸ¥è¯¢æ–¹å¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">collection.find(&#123;<span class="string">&#x27;name&#x27;</span>: &#123;<span class="string">&#x27;$regex&#x27;</span>: <span class="string">&#x27;^M.*&#x27;</span>&#125;&#125;)</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨æ“ä½œå¦‚ä¸‹ï¼š</p><table><thead><tr><th>ç¬¦å·</th><th>å«ä¹‰</th><th>ç¤ºä¾‹</th><th>ç¤ºä¾‹å«ä¹‰</th></tr></thead><tbody><tr><td><code>$regex</code></td><td>åŒ¹é…æ­£åˆ™</td><td><code>&#123;&#39;name&#39;: &#123;&#39;$regex&#39;: &#39;^M.*&#39;&#125;&#125;</code></td><td>name ä»¥ Må¼€å¤´</td></tr><tr><td><code>$exists</code></td><td>å±æ€§æ˜¯å¦å­˜åœ¨</td><td><code>&#123;&#39;name&#39;: &#123;&#39;$exists&#39;: True&#125;&#125;</code></td><td>name å±æ€§å­˜åœ¨</td></tr><tr><td><code>$type</code></td><td>ç±»å‹åˆ¤æ–­</td><td><code>&#123;&#39;age&#39;: &#123;&#39;$type&#39;: &#39;int&#39;&#125;&#125;</code></td><td>age çš„ç±»å‹ä¸º int</td></tr><tr><td><code>$mod</code></td><td>æ•°å­—æ¨¡æ“ä½œ</td><td><code>&#123;&#39;age&#39;: &#123;&#39;$mod&#39;: [5, 0]&#125;&#125;</code></td><td>å¹´é¾„æ¨¡ 5 ä½™ 0</td></tr><tr><td><code>$text</code></td><td>æ–‡æœ¬æŸ¥è¯¢</td><td><code>&#123;&#39;$text&#39;: &#123;&#39;$search&#39;: &#39;Mike&#39;&#125;&#125;</code></td><td>text ç±»å‹çš„å±æ€§ä¸­åŒ…å« Mike å­—ç¬¦ä¸²</td></tr><tr><td><code>$where</code></td><td>é«˜çº§æ¡ä»¶æŸ¥è¯¢</td><td><code>&#123;&#39;$where&#39;: &#39;obj.fans_count == obj.follows_count&#39;&#125;</code></td><td>è‡ªèº«ç²‰ä¸æ•°ç­‰äºå…³æ³¨æ•°</td></tr></tbody></table><h4 id="å»æ‰-id"><a href="#å»æ‰-id" class="headerlink" title="å»æ‰ _id"></a>å»æ‰ <code>_id</code></h4><p>Mongo è¿”å›çš„æ•°æ®ä¸­ä¼šæœ‰ä¸€é¡¹ <code>_id</code> ï¼ˆMongoè‡ªåŠ¨åŠ å…¥çš„ç”¨æ¥è¯†åˆ«å¯¹è±¡çš„å­—æ®µï¼‰ï¼Œæˆ‘ä»¬å¸¸ä¸æƒ³çœ‹å®ƒ ï¼Œå¯ä»¥åœ¨æŸ¥è¯¢æ—¶åŠ å…¥å¯¹ç»“æœçš„è¿‡æ»¤ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">collection.find(projection=&#123;<span class="string">&#x27;_id&#x27;</span>: <span class="literal">False</span>&#125;)</span><br></pre></td></tr></table></figure><h2 id="è®¡æ•°"><a href="#è®¡æ•°" class="headerlink" title="è®¡æ•°"></a>è®¡æ•°</h2><p>è¦ç»Ÿè®¡æŸ¥è¯¢åˆ°çš„ç»“æœæ¡æ•°ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨æŸ¥è¯¢ç»“æœçš„ <code>count()</code> æ–¹æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">collection.find(&#123;<span class="string">&#x27;age&#x27;</span>: &#123;<span class="string">&#x27;$gt&#x27;</span>: <span class="number">0</span>&#125;&#125;).count()</span><br></pre></td></tr></table></figure><hr><p>P.S. ä¸€ç‚¹é¢˜å¤–è¯ï¼š</p><blockquote><p>å†™åˆ°è¿™é‡Œï¼Œåˆæ˜¯ä¸€ä¸ªç†„ç¯åçš„ç¾ä¸½å¤œæ™šã€‚è°ƒæš—å±å¹•èƒŒå…‰ï¼Œå°å¿ƒç¿¼ç¿¼åœ°æ§èµ·é‚£è ¢è ¢æ¬²åŠ¨çš„ç™½è‰²æ¨±æ¡ƒæœºæ¢°é”®ç›˜ï¼ŒæŠŠå®ƒå®‰ç½®åˆ°å…‰æ˜ä¹‹å¤–ï¼Œé¿å¼€çº¢ç»¿è“çš„çº·äº‰ã€‚è¶ç€è¿™äº”å½©ç¼¤çº·çš„é»‘æš—ï¼ŒæŠŠä¸‹ä¸€è¡Œè®©äººè¿·é†‰çš„ä»£ç ï¼Œä½œä¸ºè™”è¯šçš„ç¤¼ç‰©ï¼Œé€ç»™é¥¥é¥¿è‰¯ä¹…çš„ç¼–è¯‘å™¨ã€‚é™å¾…å¥¹æ–½å±•åŠ¨äººçš„é­”æ³•ï¼Œå˜å‡ºä¸€ä¸²æ²¡æœ‰é—´æ–­ç‚¹çš„äºŒè¿›åˆ¶ä½å‘é‡ï¼Œåœ¨ 0 å’Œ 1 çš„æ’åˆ—ç»„åˆä¸­ï¼Œå…‰å½±æµè½¬ï¼Œä¼¼ç°æ˜Ÿæ²³é¹­èµ·ï¼Œä¼¼æœ‰é«˜å±±æµæ°´ã€‚åœ¨å¿ƒé©°ç¥å¾€çš„ä¸€ç¬ï¼Œä¸å¦¨å†åˆ†ä¸ªç¥ï¼Œæ¬£èµå¼€å’Œå…³ä¹‹é—´ï¼Œä¸€æ‰‡å›åˆ°æœªæ¥çš„å¤æœ´å¤§é—¨ã€‚</p></blockquote><hr><h2 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h2><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨ <code>sort()</code> æ–¹æ³•ï¼Œä¼ å…¥ç”¨æ¥æ’åºçš„å­—æ®µã€å‡é™åºçš„æ ‡å¿—å³å¯å¯¹æŸ¥è¯¢çš„ç»“æœæ’åºã€‚</p><ul><li><code>pymongo.ASCENDING</code>ï¼šæŒ‡å®šå‡åºï¼›</li><li><code>pymongo.DESCENDING</code>ï¼šæŒ‡å®šé™åºï¼›</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">r = collection.find().sort(<span class="string">&#x27;name&#x27;</span>, pymongo.ASCENDING)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> r:</span><br><span class="line">    print(i[<span class="string">&#x27;name&#x27;</span>])</span><br></pre></td></tr></table></figure><h2 id="åç§»"><a href="#åç§»" class="headerlink" title="åç§»"></a>åç§»</h2><p>åç§»ï¼šåç§»xä¸ªå…ƒç´ ï¼Œå³å¿½ç•¥ï¼ˆè·³è¿‡ï¼‰å‰é¢çš„xä¸ªå…ƒç´ ï¼Œå¾—åˆ°ç¬¬x+1å¼€å§‹ä¸ªå…ƒç´ ã€‚<br>è¿™ä¸ªæ“ä½œè°ƒç”¨æŸ¥è¯¢ç»“æœçš„ <code>skip()</code> æ–¹æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r = collection.find().skip(<span class="number">2</span>)</span><br><span class="line">print([i <span class="keyword">for</span> i <span class="keyword">in</span> r])</span><br></pre></td></tr></table></figure><h2 id="æ›´æ–°"><a href="#æ›´æ–°" class="headerlink" title="æ›´æ–°"></a>æ›´æ–°</h2><p>æ›´æ–°ä¸æ’å…¥ç±»ä¼¼ï¼Œä¸»è¦æœ‰ä¸‰ç§æ–¹æ³•ï¼š</p><ul><li><code>update()</code>ï¼šæ›´æ–°ä¸€æ¡æˆ–å¤šæ¡æ•°æ®ï¼Œä¸æ¨èä½¿ç”¨</li><li><code>update_one()</code>ï¼šæ›´æ–°ä¸€æ¡æ•°æ®</li><li><code>update_many()</code>ï¼šæ›´æ–°å¤šæ¡æ•°æ®</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">condition = &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Foo&#x27;</span>&#125;</span><br><span class="line">student = collection.find_one(condition)</span><br><span class="line">student[<span class="string">&#x27;age&#x27;</span>] = <span class="number">25</span></span><br><span class="line">result = collection.update(condition, &#123;<span class="string">&#x27;$set&#x27;</span>: student&#125;)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆæŸ¥è¯¢å‡ºäº†ç›®æ ‡æ¡ç›®ï¼Œç„¶åæŠŠå®ƒä¿®æ”¹æˆäº†æ–°çš„æ•°æ®ï¼Œè°ƒç”¨updateï¼Œä¼ å…¥æŸ¥è¯¢æ¡ä»¶å’Œä¸€ä¸ªä»£è¡¨æ“ä½œçš„å­—å…¸å®Œæˆæ›´æ–°ã€‚<br>å¸¸ç”¨çš„æ“ä½œæœ‰:</p><ul><li><code>$set</code>: <code>&#123;&#39;$set&#39;: value&#125;</code>: æŠŠvalueä¸­æœ‰çš„å±æ€§æ›´æ–°æˆæ–°çš„</li><li><code>$inc</code>: <code>&#123;&#39;$inc&#39;: &#123;&#39;age&#39;: 1&#125;&#125;</code>: æŠŠageåŠ 1</li></ul><h2 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h2><p>ä¹Ÿæ˜¯æœ‰ä¸‰ä¸ªï¼š<code>remove()</code>ï¼Œ<code>delete_one()</code>ï¼Œ<code>delete_many()</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">collection.remove(&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Kevin&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><h2 id="æ›´å¤š"><a href="#æ›´å¤š" class="headerlink" title="æ›´å¤š"></a>æ›´å¤š</h2><p>æ›´å®Œå–„çš„MongoDBè¿˜åœ¨å®˜ç½‘ç­‰å¾…æˆ‘ä»¬å»å­¦ä¹ ï¼š<a href="http://api.mongodb.com/python/current/api/pymongo/">å®˜æ–¹æ–‡æ¡£ğŸ”—é“¾æ¥</a>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Crawler </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crawler </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonä¹‹MySQL</title>
      <link href="/2019/02/19/PythonAndCrawler/crawler-10-mysql/"/>
      <url>/2019/02/19/PythonAndCrawler/crawler-10-mysql/</url>
      
        <content type="html"><![CDATA[<h1 id="Pythonçˆ¬è™«å‚¨å­˜åº“çš„ä½¿ç”¨ä¹‹MySQL"><a href="#Pythonçˆ¬è™«å‚¨å­˜åº“çš„ä½¿ç”¨ä¹‹MySQL" class="headerlink" title="Pythonçˆ¬è™«å‚¨å­˜åº“çš„ä½¿ç”¨ä¹‹MySQL"></a>Pythonçˆ¬è™«å‚¨å­˜åº“çš„ä½¿ç”¨ä¹‹MySQL</h1><blockquote><p>æœ¬æ–‡ä¸»è¦ä»‹ç» Python ä¸‹ MySQL çš„ä½¿ç”¨ï¼ˆPyMySQLåº“ï¼‰ã€‚</p></blockquote><h2 id="è¿æ¥æ•°æ®åº“"><a href="#è¿æ¥æ•°æ®åº“" class="headerlink" title="è¿æ¥æ•°æ®åº“"></a>è¿æ¥æ•°æ®åº“</h2><p>æˆ‘ä»¬ç°åœ¨æ¥è¿æ¥ä½äºæœ¬åœ°çš„MySQLæ•°æ®åº“ï¼Œåœ¨è¿™ä¹‹å‰è¦å…ˆç¡®å®šæœ¬åœ°çš„MYSQLæ­£åœ¨è¿è¡Œï¼Œä¸”å¤„äºå¯è®¿é—®çš„çŠ¶æ€ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql  <span class="comment"># å¯¼å…¥åº“</span></span><br><span class="line"></span><br><span class="line">db = pymysql.connect(host=<span class="string">&#x27;localhost&#x27;</span>, user=<span class="string">&#x27;*&#x27;</span>, password=<span class="string">&#x27;***&#x27;</span>) <span class="comment"># è¿æ¥æ•°æ®åº“ï¼Œè¿˜å¯ä»¥ä¼ å…¥ port = æ•´æ•°å€¼ æ¥æŒ‡å®šç«¯å£ï¼Œè¿™é‡Œä½¿ç”¨é»˜è®¤å€¼ï¼ˆ3306ï¼‰ã€‚</span></span><br><span class="line">cursor = db.cursor()    <span class="comment"># è·å– MySQL æ“ä½œæ¸¸æ ‡ï¼Œåˆ©ç”¨æ“ä½œæ¸¸æ ‡æ‰èƒ½æ‰§è¡ŒSQLè¯­å¥</span></span><br><span class="line">cursor.execute(<span class="string">&#x27;SELECT VERSION()&#x27;</span>)  <span class="comment"># æ‰§è¡ŒSQLè¯­å¥</span></span><br><span class="line">data = cursor.fetchone()    <span class="comment"># è·å–ç¬¬ä¸€æ¡æ•°æ®</span></span><br><span class="line">print(<span class="string">&quot;Database Version:&quot;</span>, data)</span><br><span class="line">cursor.execute(<span class="string">&quot;CREATE DATABASE spiders DEFAULT CHARACTER SET utf8&quot;</span>)    <span class="comment"># æ–°å»ºä¸€ä¸ªç”¨æ¥çˆ¬è™«çš„æ•°æ®åº“</span></span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºè¡¨"><a href="#åˆ›å»ºè¡¨" class="headerlink" title="åˆ›å»ºè¡¨"></a>åˆ›å»ºè¡¨</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">db = pymysql.connect(host=<span class="string">&quot;localhost&quot;</span>, user=<span class="string">&quot;*&quot;</span>, password=<span class="string">&quot;***&quot;</span>, port=<span class="number">3306</span>, db=<span class="string">&#x27;spiders&#x27;</span>)    <span class="comment"># ç›´æ¥è¿æ¥åˆ°åˆšæ‰æ–°å»ºçš„æ•°æ®åº“</span></span><br><span class="line">cursor = db.cursor()</span><br><span class="line">sql = <span class="string">&#x27;CREATE TABLE IF NOT EXISTS students (id VARCHAR(255) NOT NULL, name VARCHAR(255) NOT NULL, age INT NOT NULL, PRIMARY KEY (id))&#x27;</span></span><br><span class="line">cursor.execute(sql)</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure><h2 id="æ’å…¥æ•°æ®"><a href="#æ’å…¥æ•°æ®" class="headerlink" title="æ’å…¥æ•°æ®"></a>æ’å…¥æ•°æ®</h2><h4 id="ä½¿ç”¨ä¸€ç³»åˆ—å˜é‡æ’å…¥"><a href="#ä½¿ç”¨ä¸€ç³»åˆ—å˜é‡æ’å…¥" class="headerlink" title="ä½¿ç”¨ä¸€ç³»åˆ—å˜é‡æ’å…¥"></a>ä½¿ç”¨ä¸€ç³»åˆ—å˜é‡æ’å…¥</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line"><span class="built_in">id</span> = <span class="string">&#x27;2099133201&#x27;</span></span><br><span class="line">name = <span class="string">&#x27;Foo.Bar&#x27;</span></span><br><span class="line">age = <span class="number">101</span></span><br><span class="line"></span><br><span class="line">db = pymysql.connect(host=<span class="string">&#x27;localhost&#x27;</span>, user=<span class="string">&#x27;*&#x27;</span>, password=<span class="string">&#x27;***&#x27;</span>, db=<span class="string">&#x27;spiders&#x27;</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line">sql = <span class="string">&#x27;INSERT INTO students (id, name, age) VALUES (%s, %s, %s)&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql, (<span class="built_in">id</span>, name, age))</span><br><span class="line">    db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    db.rollback()</span><br><span class="line"></span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure><p>âš ï¸ã€æ³¨æ„ã€‘ï¼š</p><ol><li>æˆ‘ä»¬åœ¨executeçš„æ—¶å€™å¹¶ä¸å¿…ä½¿ç”¨pythonçš„æ–¹æ³•æŠŠå­—ç¬¦ä¸²æå‰æ„é€ å¥½ï¼Œå¯ä»¥åœ¨éœ€è¦æ’å…¥çš„åœ°æ–¹ä½¿ç”¨ <code>%s</code>ï¼Œç„¶åè¿è¡Œexecuteçš„æ—¶å€™æŠŠå‚æ•°åˆ—è¡¨ç”¨ä¸€ä¸ªå…ƒç»„ä¼ å…¥å³å¯ï¼Œç„¶è€Œï¼Œè¿™æ ·åšçš„é‡ç‚¹æ˜¯ï¼š<strong>é¿å…å¼•å·çš„é—®é¢˜ï¼</strong>ã€‚</li><li>æ³¨æ„MySQLçš„äº‹åŠ¡æœºåˆ¶ï¼Œå¯¹äºæ•°æ®åº“çš„ <strong>æ’å…¥ã€æ›´æ–°ã€åˆ é™¤</strong> æ“ä½œçš„æ ‡å‡†æ¨¡ç‰ˆæ˜¯ï¼š</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(â€˜æ›´æ”¹æ“ä½œè¯­å¥â€™)</span><br><span class="line">    db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    db.rollback()</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨å­—å…¸æ’å…¥"><a href="#ä½¿ç”¨å­—å…¸æ’å…¥" class="headerlink" title="ä½¿ç”¨å­—å…¸æ’å…¥"></a>ä½¿ç”¨å­—å…¸æ’å…¥</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">db = pymysql.connect(host=<span class="string">&#x27;localhost&#x27;</span>, user=<span class="string">&#x27;*&#x27;</span>, password=<span class="string">&#x27;***&#x27;</span>, db=<span class="string">&#x27;spiders&#x27;</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;2099133202&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Fuzz.Buzz&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;age&#x27;</span>: <span class="string">&#x27;104&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">table = <span class="string">&#x27;students&#x27;</span></span><br><span class="line"></span><br><span class="line">keys = <span class="string">&#x27;, &#x27;</span>.join(data.keys())</span><br><span class="line">values = <span class="string">&#x27;, &#x27;</span>.join([<span class="string">&#x27;%s&#x27;</span>] * <span class="built_in">len</span>(data))</span><br><span class="line"></span><br><span class="line">sql = <span class="string">&#x27;INSERT  INTO &#123;table&#125; (&#123;keys&#125;) VALUES (&#123;values&#125;)&#x27;</span>.<span class="built_in">format</span>(table=table, keys=keys, values=values)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">if</span> cursor.execute(sql, <span class="built_in">tuple</span>(data.values())):</span><br><span class="line">        print(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">        db.commit()</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">&#x27;Failed:\n&#x27;</span>, e)</span><br><span class="line">    db.rollback()</span><br><span class="line"></span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­å¦‚æœä¸ä½¿ç”¨ <code>%s</code> + ä¼ å…¥ tuple çš„é‚£ä¸ªæ–¹æ³•åŠ¨æ€æ„é€ è¯­å¥ï¼Œè€Œç›´æ¥ç”¨ <code>values = &#39;, &#39;.join(data.values())</code> ç„¶å <code>cursor.execute(sql)</code> å°±ä¼š Failed äº†ã€‚</p><h2 id="æ›´æ–°æ•°æ®"><a href="#æ›´æ–°æ•°æ®" class="headerlink" title="æ›´æ–°æ•°æ®"></a>æ›´æ–°æ•°æ®</h2><h4 id="ç®€å•çš„æ•°æ®æ›´æ–°"><a href="#ç®€å•çš„æ•°æ®æ›´æ–°" class="headerlink" title="ç®€å•çš„æ•°æ®æ›´æ–°"></a>ç®€å•çš„æ•°æ®æ›´æ–°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sql = <span class="string">&#x27;UPDATE students SET age = %s WHERE name = %s&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql, (<span class="number">999</span>, <span class="string">&#x27;Foo.Bar&#x27;</span>))</span><br><span class="line">    db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    db.rollback()</span><br><span class="line"></span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure><h4 id="æ›´å®ç”¨çš„å­—å…¸æ›´æ–°"><a href="#æ›´å®ç”¨çš„å­—å…¸æ›´æ–°" class="headerlink" title="æ›´å®ç”¨çš„å­—å…¸æ›´æ–°"></a>æ›´å®ç”¨çš„å­—å…¸æ›´æ–°</h4><p>åœ¨å®é™…æ•°æ®æŠ“å–è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‡ºç°äº†é‡å¤æ•°æ®ï¼Œæˆ‘ä»¬æ›´å¸Œæœ›çš„åšæ³•æ˜¯æ›´æ–°æ•°æ®ï¼š<br>å¦‚æœé‡å¤åˆ™æ›´æ–°æ•°æ®ï¼Œå¦‚æœæ•°æ®ä¸å­˜åœ¨åˆ™æ’å…¥æ•°æ®ï¼Œå¦å¤–æ”¯æŒçµæ´»çš„å­—å…¸ä¼ å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">db = pymysql.connect(host=<span class="string">&#x27;localhost&#x27;</span>, user=<span class="string">&#x27;*&#x27;</span>, password=<span class="string">&#x27;***&#x27;</span>, db=<span class="string">&#x27;spiders&#x27;</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;2099133203&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;SomeOne&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;age&#x27;</span>: <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">table = <span class="string">&#x27;students&#x27;</span></span><br><span class="line"></span><br><span class="line">keys = <span class="string">&#x27;, &#x27;</span>.join(data.keys())</span><br><span class="line">values = <span class="string">&#x27;, &#x27;</span>.join([<span class="string">&#x27;%s&#x27;</span>] * <span class="built_in">len</span>(data))</span><br><span class="line"></span><br><span class="line">sql = <span class="string">&#x27;INSERT INTO &#123;table&#125; (&#123;keys&#125;) VALUES (&#123;values&#125;) ON DUPLICATE KEY UPDATE&#x27;</span>.<span class="built_in">format</span>(table=table, keys=keys, values=values)</span><br><span class="line">update = <span class="string">&#x27;, &#x27;</span>.join([<span class="string">&#x27; &#123;key&#125; = %s&#x27;</span>.<span class="built_in">format</span>(key=key) <span class="keyword">for</span> key <span class="keyword">in</span> data])</span><br><span class="line"></span><br><span class="line">sql += update</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">if</span> cursor.execute(sql, <span class="built_in">tuple</span>(data.values()) * <span class="number">2</span>):</span><br><span class="line">        print(<span class="string">&quot;Success!&quot;</span>)</span><br><span class="line">        db.commit()</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">&#x27;Failed:\n&#x27;</span>, e)</span><br><span class="line">    db.rollback()</span><br><span class="line"></span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤æ•°æ®"><a href="#åˆ é™¤æ•°æ®" class="headerlink" title="åˆ é™¤æ•°æ®"></a>åˆ é™¤æ•°æ®</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">db = pymysql.connect(host=<span class="string">&#x27;localhost&#x27;</span>, user=<span class="string">&#x27;*&#x27;</span>, password=<span class="string">&#x27;***&#x27;</span>, db=<span class="string">&#x27;spiders&#x27;</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line">table = <span class="string">&#x27;students&#x27;</span></span><br><span class="line">condition = <span class="string">&#x27;age &gt; 200&#x27;</span></span><br><span class="line"></span><br><span class="line">sql = <span class="string">&#x27;DELETE FROM &#123;table&#125; WHERE &#123;condition&#125;&#x27;</span>.<span class="built_in">format</span>(table=table, condition=condition)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    db.rollback()</span><br><span class="line"></span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure><h2 id="æŸ¥è¯¢æ•°æ®"><a href="#æŸ¥è¯¢æ•°æ®" class="headerlink" title="æŸ¥è¯¢æ•°æ®"></a>æŸ¥è¯¢æ•°æ®</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sql = <span class="string">&#x27;SELECT * FROM students&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    print(<span class="string">&#x27;Count:&#x27;</span>, cursor.rowcount)</span><br><span class="line">    one = cursor.fetchone()</span><br><span class="line">    print(<span class="string">&#x27;One:&#x27;</span>, one)</span><br><span class="line">    results = cursor.fetchall()</span><br><span class="line">    print(<span class="string">&#x27;Results:&#x27;</span>, results)</span><br><span class="line">    print(<span class="string">&#x27;Results Type:&#x27;</span>, <span class="built_in">type</span>(results))</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> results:</span><br><span class="line">        print(row)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">&#x27;Error&#x27;</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Crawler </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crawler </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonä¹‹CSV</title>
      <link href="/2019/02/18/PythonAndCrawler/crawler-9-csv/"/>
      <url>/2019/02/18/PythonAndCrawler/crawler-9-csv/</url>
      
        <content type="html"><![CDATA[<h1 id="Pythonçˆ¬è™«å‚¨å­˜åº“çš„ä½¿ç”¨ä¹‹CSV"><a href="#Pythonçˆ¬è™«å‚¨å­˜åº“çš„ä½¿ç”¨ä¹‹CSV" class="headerlink" title="Pythonçˆ¬è™«å‚¨å­˜åº“çš„ä½¿ç”¨ä¹‹CSV"></a>Pythonçˆ¬è™«å‚¨å­˜åº“çš„ä½¿ç”¨ä¹‹CSV</h1><blockquote><p>æœ¬æ–‡ä¸»è¦ä»‹ç»å‚¨å­˜åº“ CSV çš„ä½¿ç”¨ã€‚</p></blockquote><h2 id="CSV-ç®€ä»‹"><a href="#CSV-ç®€ä»‹" class="headerlink" title="CSV ç®€ä»‹"></a>CSV ç®€ä»‹</h2><p><strong>CSV</strong>ï¼ˆComma-Separated Valuesï¼‰ï¼Œ<strong>é€—å·åˆ†éš”å€¼</strong>ï¼Œæˆ–<strong>å­—ç¬¦åˆ†éš”å€¼</strong>ï¼Œä»¥çº¯æ–‡æœ¬å½¢å¼å‚¨å­˜è¡¨æ ¼æ•°æ®ã€‚ä¸€ä¸ªCSVæ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">id,name,age</span><br><span class="line">0,foo,10</span><br><span class="line">1,bar,11</span><br><span class="line">2,foobar,100</span><br></pre></td></tr></table></figure><h2 id="Python-å†™-CSV"><a href="#Python-å†™-CSV" class="headerlink" title="Python å†™ CSV"></a>Python å†™ CSV</h2><h4 id="åˆ—è¡¨å†™å…¥-CSV"><a href="#åˆ—è¡¨å†™å…¥-CSV" class="headerlink" title="åˆ—è¡¨å†™å…¥ CSV"></a>åˆ—è¡¨å†™å…¥ CSV</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line">d = [[<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;10&#x27;</span>], [<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;11&#x27;</span>], [<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;foobar&#x27;</span>, <span class="string">&#x27;100&#x27;</span>]]</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;data.csv&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> csvfile:</span><br><span class="line">    writer = csv.writer(csvfile)    <span class="comment"># è¦æ”¹åˆ†éš”ç¬¦ï¼Œå¯ä»¥ä¼ å…¥`delimiter=&#x27;åˆ†éš”ç¬¦&#x27;`</span></span><br><span class="line">    </span><br><span class="line">    writer.writerow([<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>])  <span class="comment"># å†™ä¸€è¡Œï¼Œä¼ å…¥list</span></span><br><span class="line">    writer.writerows(d)     <span class="comment"># å†™å…¥å¤šè¡Œï¼Œä¼ å…¥äºŒç»´list</span></span><br></pre></td></tr></table></figure><p>âš ï¸ã€æ³¨æ„ã€‘å†™ä¸­æ–‡çš„æ—¶å€™ï¼Œè¦åœ¨opençš„æ—¶å€™ä¼ å…¥ <code>encoding=&#39;utf-8&#39;</code>ï¼Œé˜²æ­¢ä¹±ç ã€‚</p><h4 id="å­—å…¸å†™å…¥-CSV"><a href="#å­—å…¸å†™å…¥-CSV" class="headerlink" title="å­—å…¸å†™å…¥ CSV"></a>å­—å…¸å†™å…¥ CSV</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;data.csv&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> csvfile:</span><br><span class="line">    fieldnames = [<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>]</span><br><span class="line">    writer = csv.DictWriter(csvfile, fieldnames=fieldnames)</span><br><span class="line">    writer.writeheader()</span><br><span class="line">    writer.writerow(&#123;<span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;fuzz&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="string">&#x27;666&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><h2 id="Python-è¯»-CSV"><a href="#Python-è¯»-CSV" class="headerlink" title="Python è¯» CSV"></a>Python è¯» CSV</h2><h4 id="ç”¨-CSVåº“-è¯»å–"><a href="#ç”¨-CSVåº“-è¯»å–" class="headerlink" title="ç”¨ CSVåº“ è¯»å–"></a>ç”¨ CSVåº“ è¯»å–</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;data.csv&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> csvfile:</span><br><span class="line">    reader = csv.reader(csvfile)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> reader:</span><br><span class="line">        print(<span class="built_in">type</span>(row), row)</span><br></pre></td></tr></table></figure><p>ä»ç»“æœä¸­å¯ä»¥çœ‹åˆ°ï¼Œè¯»å–å‡ºæ¥çš„æ˜¯å„è¡Œçš„listã€‚</p><h4 id="ç”¨-Pandasåº“-è¯»å–"><a href="#ç”¨-Pandasåº“-è¯»å–" class="headerlink" title="ç”¨ Pandasåº“ è¯»å–"></a>ç”¨ Pandasåº“ è¯»å–</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;data.csv&#x27;</span>)</span><br><span class="line">print(df)</span><br><span class="line">print(<span class="built_in">type</span>(df))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Crawler </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crawler </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonä¹‹PyQuery</title>
      <link href="/2019/02/17/PythonAndCrawler/crawler-8-pyquery/"/>
      <url>/2019/02/17/PythonAndCrawler/crawler-8-pyquery/</url>
      
        <content type="html"><![CDATA[<h1 id="Pythonçˆ¬è™«è§£æåº“çš„ä½¿ç”¨ä¹‹PyQuery"><a href="#Pythonçˆ¬è™«è§£æåº“çš„ä½¿ç”¨ä¹‹PyQuery" class="headerlink" title="Pythonçˆ¬è™«è§£æåº“çš„ä½¿ç”¨ä¹‹PyQuery"></a>Pythonçˆ¬è™«è§£æåº“çš„ä½¿ç”¨ä¹‹PyQuery</h1><blockquote><p>æœ¬æ–‡ä¸»è¦ä»‹ç»è§£æåº“ PyQuery çš„ä½¿ç”¨ã€‚</p></blockquote><h2 id="PyQuery"><a href="#PyQuery" class="headerlink" title="PyQuery"></a>PyQuery</h2><blockquote><p>pyquery: a jquery-like library for python</p></blockquote><p>PyQuery çš„ä½¿ç”¨æ–¹æ³•å’ŒjQueryåŸºæœ¬ç›¸åŒã€‚</p><p>âš ï¸ã€æ³¨æ„ã€‘éœ€è¦å®‰è£…å¥½ PyQueryã€‚</p><h4 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h4><p>PyQuery åˆå§‹åŒ–æ—¶å¯ä»¥ä¼ å…¥å¤šç§å½¢å¼çš„æ•°æ®æºï¼Œå¦‚å†…å®¹æ˜¯ HTML çš„å­—ç¬¦ä¸²ã€æºçš„URLã€æœ¬åœ°çš„æ–‡ä»¶åç­‰ã€‚</p><h5 id="å­—ç¬¦ä¸²åˆå§‹åŒ–"><a href="#å­—ç¬¦ä¸²åˆå§‹åŒ–" class="headerlink" title="å­—ç¬¦ä¸²åˆå§‹åŒ–"></a>å­—ç¬¦ä¸²åˆå§‹åŒ–</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line"></span><br><span class="line">html = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;h1&gt;Header&lt;/h1&gt;</span></span><br><span class="line"><span class="string">&lt;p&gt;Something&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;p&gt;Other thing&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;div&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;In div&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">doc = pq(html)      <span class="comment"># ä¼ å…¥HTMLå­—ç¬¦ä¸²</span></span><br><span class="line">print(doc(<span class="string">&#x27;p&#x27;</span>))     <span class="comment"># ä¼ å…¥CSSé€‰æ‹©å™¨</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;(results)</span></span><br><span class="line"><span class="string">&lt;p&gt;Something&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;p&gt;Other thing&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;p&gt;In div&lt;/p&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><h5 id="URLåˆå§‹åŒ–"><a href="#URLåˆå§‹åŒ–" class="headerlink" title="URLåˆå§‹åŒ–"></a>URLåˆå§‹åŒ–</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line">doc = pq(url=<span class="string">&#x27;http://www.baidu.com&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)      <span class="comment"># è¿™é‡Œä¸å†™encodingå¯èƒ½ä¸­æ–‡ä¹±ç </span></span><br><span class="line">print(doc(<span class="string">&#x27;title&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;(result)</span></span><br><span class="line"><span class="string">&lt;title&gt;ç™¾åº¦ä¸€ä¸‹ï¼Œä½ å°±çŸ¥é“&lt;/title&gt;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="CSSé€‰æ‹©å™¨"><a href="#CSSé€‰æ‹©å™¨" class="headerlink" title="CSSé€‰æ‹©å™¨"></a>CSSé€‰æ‹©å™¨</h4><p>è¯¦è§ <a href="http://www.w3school.com.cn/cssref/css_selectors.asp">CSS é€‰æ‹©å™¨è¡¨</a>ã€‚</p><h4 id="æŸ¥æ‰¾èŠ‚ç‚¹"><a href="#æŸ¥æ‰¾èŠ‚ç‚¹" class="headerlink" title="æŸ¥æ‰¾èŠ‚ç‚¹"></a>æŸ¥æ‰¾èŠ‚ç‚¹</h4><ul><li>æŸ¥æ‰¾<strong>å­</strong>èŠ‚ç‚¹ç”¨ <code>children(&#39;css-selector&#39;)</code> æ–¹æ³•ï¼Œå‚æ•°ä¸ºç©ºåˆ™ä¸ºå…¨éƒ¨ã€‚</li><li>æŸ¥æ‰¾<strong>å­å­™</strong>èŠ‚ç‚¹ç”¨ <code>find(&#39;css-selector&#39;)</code> æ–¹æ³•ï¼Œ<strong>å‚æ•°ä¸å¯ä¸ºç©ºï¼</strong></li><li>æŸ¥æ‰¾<strong>çˆ¶</strong>èŠ‚ç‚¹ç”¨ <code>parent(&#39;css-selector&#39;)</code> æ–¹æ³•ï¼Œå‚æ•°ä¸ºç©ºåˆ™ä¸ºå…¨éƒ¨ã€‚</li><li>æŸ¥æ‰¾<strong>ç¥–å…ˆ</strong>èŠ‚ç‚¹ç”¨ <code>parents(&#39;css-selector&#39;)</code> æ–¹æ³•ï¼Œå‚æ•°ä¸ºç©ºåˆ™ä¸ºå…¨éƒ¨ã€‚</li><li>æŸ¥æ‰¾<strong>å…„å¼Ÿ</strong>èŠ‚ç‚¹ç”¨ <code>siblings(&#39;css-selector&#39;)</code> æ–¹æ³•ï¼Œå‚æ•°ä¸ºç©ºåˆ™ä¸ºå…¨éƒ¨ã€‚</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = doc(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p</span><br><span class="line">[&lt;div<span class="comment">#wrapper&gt;, &lt;div#head&gt;, &lt;div.head_wrapper&gt;, &lt;div.s_form&gt;, &lt;div.s_form_wrapper&gt;, &lt;div#lg&gt;, &lt;div#u1&gt;, &lt;div#ftCon&gt;, &lt;div#ftConw&gt;]</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(p)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">pyquery</span>.<span class="title">pyquery</span>.<span class="title">PyQuery</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">p</span>.<span class="title">find</span>(<span class="params"><span class="string">&#x27;#head&#x27;</span></span>)</span></span><br><span class="line"><span class="class">[&lt;<span class="title">div</span>#<span class="title">head</span>&gt;]</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">print</span>(<span class="params">p.find(<span class="params"><span class="string">&#x27;#head&#x27;</span></span>)</span>)</span></span><br><span class="line">&lt;div id=&quot;head&quot;&gt; ... &lt;/div&gt; </span><br></pre></td></tr></table></figure><h4 id="éå†"><a href="#éå†" class="headerlink" title="éå†"></a>éå†</h4><p>ç”¨ PyQuery é€‰æ‹©åˆ°çš„ç»“æœå¯ä»¥éå†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span>  p.parent():</span><br><span class="line"><span class="meta">... </span>    print(i, <span class="built_in">type</span>(i))</span><br><span class="line"><span class="meta">... </span></span><br><span class="line">&lt;Element a at <span class="number">0x1055332c8</span>&gt; &lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">lxml</span>.<span class="title">html</span>.<span class="title">HtmlElement</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">Element</span> <span class="title">a</span> <span class="title">at</span> 0<span class="title">x105533368</span>&gt; &lt;<span class="title">class</span> &#x27;<span class="title">lxml</span>.<span class="title">html</span>.<span class="title">HtmlElement</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">Element</span> <span class="title">a</span> <span class="title">at</span> 0<span class="title">x105533458</span>&gt; &lt;<span class="title">class</span> &#x27;<span class="title">lxml</span>.<span class="title">html</span>.<span class="title">HtmlElement</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„æ˜¯lxmlçš„Elementäº†ï¼Œè¦ç”¨lxmlçš„æ–¹æ³•å¤„ç†ã€‚</p><h4 id="è·å–ä¿¡æ¯"><a href="#è·å–ä¿¡æ¯" class="headerlink" title="è·å–ä¿¡æ¯"></a>è·å–ä¿¡æ¯</h4><h5 id="attr-è·å–å±æ€§"><a href="#attr-è·å–å±æ€§" class="headerlink" title="attr() è·å–å±æ€§"></a><code>attr()</code> è·å–å±æ€§</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = doc(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">print(a.attr(<span class="string">&#x27;href&#x27;</span>))</span><br></pre></td></tr></table></figure><p>attr() å¿…é¡»ä¼ å…¥è¦é€‰æ‹©çš„å±æ€§åã€‚<br>è‹¥å¯¹è±¡åŒ…å«å¤šä¸ªèŠ‚ç‚¹ï¼Œè°ƒç”¨å¯¹è±¡çš„attr()ï¼Œåªä¼šè¿”å›ç¬¬ä¸€ä¸ªå¯¹è±¡çš„å¯¹åº”ç»“æœã€‚è¦è¿”å›æ¯ä¸€ä¸ªçš„éœ€è¦éå†ã€‚</p><h5 id="text-è·å–æ–‡æœ¬"><a href="#text-è·å–æ–‡æœ¬" class="headerlink" title="text() è·å–æ–‡æœ¬"></a><code>text()</code> è·å–æ–‡æœ¬</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = doc(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">a.text()</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¼šè¾“å‡ºæ‰€æœ‰åŒ…å«èŠ‚ç‚¹çš„æ–‡æœ¬joinçš„ç»“æœã€‚</p><h4 id="èŠ‚ç‚¹æ“ä½œ"><a href="#èŠ‚ç‚¹æ“ä½œ" class="headerlink" title="èŠ‚ç‚¹æ“ä½œ"></a>èŠ‚ç‚¹æ“ä½œ</h4><p>PyQuery è¿˜å¯ä»¥æ“ä½œèŠ‚ç‚¹ï¼Œè¿™ä¸ªä¸æ˜¯é‡ç‚¹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Crawler </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crawler </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonä¹‹BeautifulSoup</title>
      <link href="/2019/02/16/PythonAndCrawler/crawler-7-beautifulsoup/"/>
      <url>/2019/02/16/PythonAndCrawler/crawler-7-beautifulsoup/</url>
      
        <content type="html"><![CDATA[<h1 id="Pythonçˆ¬è™«è§£æåº“çš„ä½¿ç”¨ä¹‹BeautifulSoup"><a href="#Pythonçˆ¬è™«è§£æåº“çš„ä½¿ç”¨ä¹‹BeautifulSoup" class="headerlink" title="Pythonçˆ¬è™«è§£æåº“çš„ä½¿ç”¨ä¹‹BeautifulSoup"></a>Pythonçˆ¬è™«è§£æåº“çš„ä½¿ç”¨ä¹‹BeautifulSoup</h1><blockquote><p>æœ¬æ–‡ä¸»è¦ä»‹ç»è§£æåº“ BeautifulSoup çš„ä½¿ç”¨ã€‚</p></blockquote><h2 id="BeautifulSoup"><a href="#BeautifulSoup" class="headerlink" title="BeautifulSoup"></a>BeautifulSoup</h2><blockquote><p>BeautifulSoup æä¾›ä¸€äº›ç®€å•çš„ã€Pythonå¼çš„å‡½æ•°ç”¨æ¥å¤„ç†å¯¼èˆªã€æœç´¢ã€ä¿®æ”¹åˆ†ææ ‘ç­‰åŠŸèƒ½ã€‚å®ƒé€šè¿‡è§£ææ–‡æ¡£ä¸ºç”¨æˆ·æä¾›éœ€è¦æŠ“å–çš„æ•°æ®ã€‚åˆ©ç”¨å®ƒæˆ‘ä»¬å¯ä»¥æé«˜è§£ææ•ˆç‡ã€‚</p></blockquote><p>BeautifulSoup æ‹¥æœ‰å®Œå–„çš„å®˜æ–¹ä¸­æ–‡æ–‡æ¡£ï¼Œå¯ä»¥æŸ¥çœ‹ <a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc.zh/">BeautifulSoupå®˜æ–¹æ–‡æ¡£</a></p><p>âš ï¸ã€æ³¨æ„ã€‘éœ€è¦å®‰è£…å¥½ BeautifulSoup å’Œ LXMLã€‚</p><p>BeautifulSoup å¯ä»¥ä½¿ç”¨å¤šç§è§£æå™¨ï¼Œä¸»è¦çš„å‡ ç§å¦‚ä¸‹ï¼š</p><table><thead><tr><th>è§£æå™¨</th><th>ä½¿ç”¨æ–¹æ³•</th><th>ä¼˜åŠ¿</th><th>åŠ£åŠ¿</th></tr></thead><tbody><tr><td>Pythonæ ‡å‡†åº“</td><td>BeautifulSoup(markup, â€œhtml.parserâ€)</td><td>Pythonçš„å†…ç½®æ ‡å‡†åº“ã€æ‰§è¡Œé€Ÿåº¦é€‚ä¸­ ã€æ–‡æ¡£å®¹é”™èƒ½åŠ›å¼º</td><td>Python 2.7.3 or 3.2.2)å‰çš„ç‰ˆæœ¬ä¸­æ–‡å®¹é”™èƒ½åŠ›å·®</td></tr><tr><td>LXML HTML è§£æå™¨</td><td>BeautifulSoup(markup, â€œlxmlâ€)</td><td>é€Ÿåº¦å¿«ã€æ–‡æ¡£å®¹é”™èƒ½åŠ›å¼º</td><td>éœ€è¦å®‰è£…Cè¯­è¨€åº“</td></tr><tr><td>LXML XML è§£æå™¨</td><td>BeautifulSoup(markup, â€œxmlâ€)</td><td>é€Ÿåº¦å¿«ã€å”¯ä¸€æ”¯æŒXMLçš„è§£æå™¨</td><td>éœ€è¦å®‰è£…Cè¯­è¨€åº“</td></tr><tr><td>html5lib</td><td>BeautifulSoup(markup, â€œhtml5libâ€)</td><td>æœ€å¥½çš„å®¹é”™æ€§ã€ä»¥æµè§ˆå™¨çš„æ–¹å¼è§£ææ–‡æ¡£ã€ç”Ÿæˆ HTML5 æ ¼å¼çš„æ–‡æ¡£</td><td>é€Ÿåº¦æ…¢ã€ä¸ä¾èµ–å¤–éƒ¨æ‰©å±•</td></tr></tbody></table><p>æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ LXML è§£æå™¨æ¥è¿›è¡Œè§£æï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(<span class="string">&#x27;&lt;p&gt;Hello&lt;/p&gt;&#x27;</span>, <span class="string">&#x27;lxml&#x27;</span>)    </span><br><span class="line">print(soup.p.string)</span><br></pre></td></tr></table></figure><h4 id="BeaufulSoupå¯¹è±¡çš„åˆå§‹åŒ–"><a href="#BeaufulSoupå¯¹è±¡çš„åˆå§‹åŒ–" class="headerlink" title="BeaufulSoupå¯¹è±¡çš„åˆå§‹åŒ–"></a>BeaufulSoupå¯¹è±¡çš„åˆå§‹åŒ–</h4><p>ä½¿ç”¨å¦‚ä¸‹ä»£ç å°±å¯ä»¥å¯¼å…¥HTMLï¼Œå®ŒæˆBeautifulSoupå¯¹è±¡çš„åˆå§‹åŒ–ï¼Œå¹¶è‡ªåŠ¨æ›´æ­£ï¼ˆå¦‚é—­åˆæœªé—­åˆçš„æ ‡ç­¾ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">soup = BeautifulSoup(markup, <span class="string">&quot;lxml&quot;</span>)   <span class="comment"># markup æ˜¯ HTML çš„ str</span></span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–ä¹‹åæˆ‘ä»¬è¿˜å¯ä»¥å¯¹è¦è§£æçš„å­—ç¬¦ä¸²ä»¥æ ‡å‡†çš„ç¼©è¿›æ ¼å¼è¾“å‡ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(soup.prettify())</span><br></pre></td></tr></table></figure><h4 id="èŠ‚ç‚¹é€‰æ‹©å™¨"><a href="#èŠ‚ç‚¹é€‰æ‹©å™¨" class="headerlink" title="èŠ‚ç‚¹é€‰æ‹©å™¨"></a>èŠ‚ç‚¹é€‰æ‹©å™¨</h4><h5 id="é€‰æ‹©æ ‡ç­¾"><a href="#é€‰æ‹©æ ‡ç­¾" class="headerlink" title="é€‰æ‹©æ ‡ç­¾"></a>é€‰æ‹©æ ‡ç­¾</h5><p>é€‰æ‹©å…ƒç´ çš„æ—¶å€™ç›´æ¥é€šè¿‡è°ƒç”¨èŠ‚ç‚¹çš„åç§°å°±å¯ä»¥é€‰æ‹©èŠ‚ç‚¹å…ƒç´ ï¼Œ<br>è°ƒç”¨ string å±æ€§å°±å¯ä»¥å¾—åˆ°èŠ‚ç‚¹å†…çš„æ–‡æœ¬ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">html = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;html&gt;&lt;head&gt;&lt;title&gt;The Dormouse&#x27;s story&lt;/title&gt;&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">&lt;p class=&quot;title&quot; name=&quot;dromouse&quot;&gt;&lt;b&gt;The Dormouse&#x27;s story&lt;/b&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;p class=&quot;story&quot;&gt;Once upon a time there were three little sisters; and their names were</span></span><br><span class="line"><span class="string">&lt;a href=&quot;http://example.com/elsie&quot; class=&quot;sister&quot; id=&quot;link1&quot;&gt;&lt;!-- Elsie --&gt;&lt;/a&gt;,</span></span><br><span class="line"><span class="string">&lt;a href=&quot;http://example.com/lacie&quot; class=&quot;sister&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; and</span></span><br><span class="line"><span class="string">&lt;a href=&quot;http://example.com/tillie&quot; class=&quot;sister&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;;</span></span><br><span class="line"><span class="string">and they lived at the bottom of a well.&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;p class=&quot;story&quot;&gt;...&lt;/p&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">soup = BeautifulSoup(html, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line"></span><br><span class="line">print(soup.title)           <span class="comment"># &lt;title&gt;The Dormouse&#x27;s story&lt;/title&gt;</span></span><br><span class="line">print(<span class="built_in">type</span>(soup.title))     <span class="comment"># &lt;class &#x27;bs4.element.Tag&#x27;&gt;</span></span><br><span class="line">print(soup.title.string)    <span class="comment"># The Dormouse&#x27;s story</span></span><br><span class="line">print(soup.head)            <span class="comment"># &lt;head&gt;&lt;title&gt;The Dormouse&#x27;s story&lt;/title&gt;&lt;/head&gt;</span></span><br><span class="line">print(soup.p)               <span class="comment"># &lt;p class=&quot;title&quot; name=&quot;dromouse&quot;&gt;&lt;b&gt;The Dormouse&#x27;s story&lt;/b&gt;&lt;/p&gt;</span></span><br></pre></td></tr></table></figure><h5 id="åµŒå¥—é€‰æ‹©"><a href="#åµŒå¥—é€‰æ‹©" class="headerlink" title="åµŒå¥—é€‰æ‹©"></a>åµŒå¥—é€‰æ‹©</h5><p>æˆ‘ä»¬è¿˜å¯ä»¥è¿›è¡Œ <strong>åµŒå¥—é€‰æ‹©</strong>ï¼Œå³åšç±»ä¼¼ <code>çˆ¶.å­.å­™</code> çš„é€‰æ‹©ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(soup.head.title.string)</span><br></pre></td></tr></table></figure><h5 id="å…³è”é€‰æ‹©"><a href="#å…³è”é€‰æ‹©" class="headerlink" title="å…³è”é€‰æ‹©"></a>å…³è”é€‰æ‹©</h5><p>æœ‰æ—¶å€™æˆ‘ä»¬éš¾ä»¥åšåˆ°ä¸€æ­¥å°±å¯ä»¥é€‰æ‹©åˆ°æƒ³è¦çš„èŠ‚ç‚¹å…ƒç´ ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥å…ˆé€‰ä¸­æŸä¸€ä¸ªèŠ‚ç‚¹å…ƒç´ ï¼Œç„¶åä»¥å®ƒä¸ºåŸºå‡†å†é€‰æ‹©å®ƒçš„å­èŠ‚ç‚¹ã€çˆ¶èŠ‚ç‚¹ã€å…„å¼ŸèŠ‚ç‚¹ç­‰ç­‰</p><h6 id="è·å–å­å­™èŠ‚ç‚¹"><a href="#è·å–å­å­™èŠ‚ç‚¹" class="headerlink" title="è·å–å­å­™èŠ‚ç‚¹"></a>è·å–<strong>å­å­™èŠ‚ç‚¹</strong></h6><p>é€‰å–åˆ°äº†ä¸€ä¸ªèŠ‚ç‚¹å…ƒç´ ä¹‹åï¼Œå¦‚æœæƒ³è¦è·å–å®ƒçš„ç›´æ¥ <strong>å­èŠ‚ç‚¹</strong> å¯ä»¥è°ƒç”¨ <code>contents</code> å±æ€§ï¼Œå°†è¿”å›ä¸€ä¸ªä¾æ¬¡åˆ—æœ‰æ‰€æœ‰å­èŠ‚ç‚¹çš„listã€‚</p><p>å¦‚pæ ‡ç­¾ä¹‹ç±»çš„èŠ‚ç‚¹ä¸­å¯èƒ½æ—¢åŒ…å«æ–‡æœ¬ï¼ŒåˆåŒ…å«èŠ‚ç‚¹ï¼Œè¿”å›çš„ç»“æœä¼šå°†ä»–ä»¬ä»¥åˆ—è¡¨å½¢å¼éƒ½ç»Ÿä¸€è¿”å›ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">soup.p.contents     <span class="comment"># æ³¨æ„é‡Œé¢çš„æ–‡å­—è¢«åˆ‡æˆäº†å‡ éƒ¨åˆ†</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;(result)</span></span><br><span class="line"><span class="string">[</span></span><br><span class="line"><span class="string">    &#x27;Once upon a time ... were\n&#x27;,</span></span><br><span class="line"><span class="string">    &lt;a class=&quot;sister&quot; href=&quot;...&quot; id=&quot;link1&quot;&gt;&lt;!-- Elsie --&gt;&lt;/a&gt;,</span></span><br><span class="line"><span class="string">    &#x27;,\n&#x27;,</span></span><br><span class="line"><span class="string">    &lt;a class=&quot;sister&quot; href=&quot;...&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;,</span></span><br><span class="line"><span class="string">    &#x27; and\n&#x27;,</span></span><br><span class="line"><span class="string">    &lt;a class=&quot;sister&quot; href=&quot;...&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;,</span></span><br><span class="line"><span class="string">    &#x27;;\nand ... well.&#x27;</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>åŒæ—¶ï¼ŒæŸ¥è¯¢ <strong>å­èŠ‚ç‚¹</strong>ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ <code>children</code> å±æ€§ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ª list_iterator objectï¼ŒåŒ–ä¸º list ä¹‹åï¼Œå°±å’Œ contents ä¸€æ ·äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.p.children</span><br><span class="line">&lt;list_iterator <span class="built_in">object</span> at <span class="number">0x109d6a8d0</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="built_in">list</span>(soup.p.children)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = soup.p.contents</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a == b</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥é€ä¸ªç¼–å·è¾“å‡ºå­èŠ‚ç‚¹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i, child <span class="keyword">in</span> <span class="built_in">enumerate</span>(soup.p.children):</span><br><span class="line">    print(i, child)</span><br></pre></td></tr></table></figure><p>è¦å¾—åˆ°æ‰€æœ‰çš„ <strong>å­å­™èŠ‚ç‚¹</strong>ï¼ˆæ‰€æœ‰ä¸‹å±èŠ‚ç‚¹ï¼‰çš„è¯å¯ä»¥è°ƒç”¨ descendants å±æ€§ï¼Œdescendants ä¼šé€’å½’åœ°æŸ¥è¯¢æ‰€æœ‰å­èŠ‚ç‚¹ï¼ˆæ·±åº¦ä¼˜å…ˆï¼‰ï¼Œå¾—åˆ°çš„æ˜¯æ‰€æœ‰çš„å­å­™èŠ‚ç‚¹ï¼Œè¿”å›ç»“æœæ˜¯ä¸€ä¸ª <code>&lt;generator object Tag.descendants at 0x109d297c8&gt;</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line">print(soup.p.descendants)</span><br><span class="line"><span class="keyword">for</span> i, d <span class="keyword">in</span> <span class="built_in">enumerate</span>(soup.p.descendants):</span><br><span class="line">    print(i, d)</span><br></pre></td></tr></table></figure><h6 id="è·å–çˆ¶èŠ‚ç‚¹å’Œç¥–å…ˆèŠ‚ç‚¹"><a href="#è·å–çˆ¶èŠ‚ç‚¹å’Œç¥–å…ˆèŠ‚ç‚¹" class="headerlink" title="è·å–çˆ¶èŠ‚ç‚¹å’Œç¥–å…ˆèŠ‚ç‚¹"></a>è·å–çˆ¶èŠ‚ç‚¹å’Œç¥–å…ˆèŠ‚ç‚¹</h6><p>å¦‚æœè¦è·å–æŸä¸ªèŠ‚ç‚¹å…ƒç´ çš„çˆ¶èŠ‚ç‚¹ï¼Œå¯ä»¥è°ƒç”¨ <code>parent</code> å±æ€§ï¼Œè¿”å›ä¸€ä¸ªèŠ‚ç‚¹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>soup.span.parent</span><br><span class="line"><span class="comment"># ç»“æœæ˜¯ &lt;p&gt;...&lt;/p&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬è¦æƒ³è·å–æ‰€æœ‰çš„ç¥–å…ˆèŠ‚ç‚¹(ä¸€å±‚å±‚å‘ä¸Šæ‰¾ï¼Œç›´åˆ°æ•´ä¸ªhtml)ï¼Œå¯ä»¥è°ƒç”¨ <code>parents</code> å±æ€§ï¼Œè¿”å›ä¸€ä¸ªgeneratorï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>soup.span.parents</span><br><span class="line">&lt;generator <span class="built_in">object</span> PageElement.parents at <span class="number">0x109d29ed0</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(soup.span.parents)</span><br><span class="line"><span class="comment"># ç»“æœæ˜¯ [&lt;p&gt;...&lt;/p&gt;, &lt;div&gt;...&lt;/div&gt;, &lt;body&gt;...&lt;/body&gt;, &lt;html&gt;...&lt;/html&gt;]</span></span><br></pre></td></tr></table></figure><p>âš ï¸ã€æ³¨æ„ã€‘çˆ¶æ˜¯ parentï¼Œç¥–å…ˆæ˜¯ parents</p><h6 id="è·å–å…„å¼ŸèŠ‚ç‚¹"><a href="#è·å–å…„å¼ŸèŠ‚ç‚¹" class="headerlink" title="è·å–å…„å¼ŸèŠ‚ç‚¹"></a>è·å–å…„å¼ŸèŠ‚ç‚¹</h6><p>è¦è·å–åŒçº§çš„èŠ‚ç‚¹ä¹Ÿå°±æ˜¯å…„å¼ŸèŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨äº†å››ä¸ªä¸åŒçš„å±æ€§ï¼Œå®ƒä»¬çš„ä½œç”¨ä¸å°½ç›¸åŒï¼š</p><ul><li>next_siblingï¼šè·å–èŠ‚ç‚¹<strong>å‘ä¸‹ä¸€ä¸ª</strong>å…„å¼ŸèŠ‚ç‚¹ï¼Œè¿”å›èŠ‚ç‚¹ã€‚</li><li>previous_siblingï¼šè·å–<strong>å‘ä¸Šä¸€ä¸ª</strong>å…„å¼ŸèŠ‚ç‚¹ï¼Œè¿”å›èŠ‚ç‚¹ã€‚</li><li>next_siblingsï¼šè·å–<strong>å‘ä¸‹æ‰€æœ‰</strong>å…„å¼ŸèŠ‚ç‚¹ï¼Œè¿”å›ä¸€ä¸ªgeneratorã€‚</li><li>previous_siblingsï¼šè·å–<strong>å‘ä¸Šæ‰€æœ‰</strong>å…„å¼ŸèŠ‚ç‚¹ï¼Œè¿”å›ä¸€ä¸ªgeneratorã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>html = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"><span class="meta">... </span>&lt;html&gt;</span></span><br><span class="line"><span class="string"><span class="meta">... </span>    &lt;body&gt;</span></span><br><span class="line"><span class="string"><span class="meta">... </span>        &lt;p class=&quot;story&quot;&gt;</span></span><br><span class="line"><span class="string"><span class="meta">... </span>            Once upon a time there were three little sisters; and their names were</span></span><br><span class="line"><span class="string"><span class="meta">... </span>            &lt;a href=&quot;http://example.com/elsie&quot; class=&quot;sister&quot; id=&quot;link1&quot;&gt;</span></span><br><span class="line"><span class="string"><span class="meta">... </span>                &lt;span&gt;Elsie&lt;/span&gt;</span></span><br><span class="line"><span class="string"><span class="meta">... </span>            &lt;/a&gt;</span></span><br><span class="line"><span class="string"><span class="meta">... </span>            Hello</span></span><br><span class="line"><span class="string"><span class="meta">... </span>            &lt;a href=&quot;http://example.com/lacie&quot; class=&quot;sister&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; </span></span><br><span class="line"><span class="string"><span class="meta">... </span>            and</span></span><br><span class="line"><span class="string"><span class="meta">... </span>            &lt;a href=&quot;http://example.com/tillie&quot; class=&quot;sister&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;</span></span><br><span class="line"><span class="string"><span class="meta">... </span>            and they lived at the bottom of a well.</span></span><br><span class="line"><span class="string"><span class="meta">... </span>        &lt;/p&gt;</span></span><br><span class="line"><span class="string"><span class="meta">... </span>&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>soup = BeautifulSoup(html, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>soup.a</span><br><span class="line">&lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;</span><br><span class="line">&lt;span&gt;Elsie&lt;/span&gt;</span><br><span class="line">&lt;/a&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>soup.a.next_sibling</span><br><span class="line"><span class="string">&#x27;\n            Hello\n            &#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>soup.a.previous_sibling</span><br><span class="line"><span class="string">&#x27;\n            Once upon a time there were three little sisters; and their names were\n            &#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>soup.a.next_siblings</span><br><span class="line">&lt;generator <span class="built_in">object</span> PageElement.next_siblings at <span class="number">0x1110e57c8</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>soup.a.previous_siblings</span><br><span class="line">&lt;generator <span class="built_in">object</span> PageElement.previous_siblings at <span class="number">0x1110e5de0</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> soup.a.previous_siblings:</span><br><span class="line"><span class="meta">... </span>    print(i)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"></span><br><span class="line">            Once upon a time there were three little sisters; <span class="keyword">and</span> their names were</span><br><span class="line">            </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> soup.a.next_siblings:</span><br><span class="line"><span class="meta">... </span>    print(i)</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"></span><br><span class="line">            Hello</span><br><span class="line">            </span><br><span class="line">&lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">and</span></span><br><span class="line">            </span><br><span class="line">&lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">and</span> they lived at the bottom of a well.</span><br><span class="line">        </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><h4 id="æ–¹æ³•é€‰æ‹©å™¨"><a href="#æ–¹æ³•é€‰æ‹©å™¨" class="headerlink" title="æ–¹æ³•é€‰æ‹©å™¨"></a>æ–¹æ³•é€‰æ‹©å™¨</h4><p>æœ‰æ—¶éš¾ä»¥åˆ©ç”¨èŠ‚ç‚¹é€‰æ‹©å™¨ç›´æ¥æ‰¾åˆ°æƒ³è¦çš„èŠ‚ç‚¹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ find_all()ã€find() ç­‰æ–¹æ³•ï¼Œä¼ å…¥ç›¸åº”ç­‰å‚æ•°å°±å¯ä»¥çµæ´»åœ°è¿›è¡ŒæŸ¥è¯¢ï¼Œå¾—åˆ°æƒ³è¦çš„èŠ‚ç‚¹ï¼Œç„¶åé€šè¿‡å…³è”é€‰æ‹©å°±å¯ä»¥è½»æ¾è·å–éœ€è¦çš„ä¿¡æ¯ã€‚</p><h5 id="find"><a href="#find" class="headerlink" title="find()"></a><code>find()</code></h5><p>find() ä¼ å…¥ä¸€äº›å±æ€§æˆ–æ–‡æœ¬æ¥å¾—åˆ°ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ï¼Œè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…çš„å…ƒç´ ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find(name , attrs , recursive , text , **kwargs)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å®ä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">html=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;div class=&quot;panel&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;panel-heading&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;h4&gt;Hello&lt;/h4&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;panel-body&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;ul class=&quot;list&quot; id=&quot;list-1&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;li class=&quot;element&quot;&gt;Foo&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li class=&quot;element&quot;&gt;Bar&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li class=&quot;element&quot;&gt;Jay&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">        &lt;ul class=&quot;list list-small&quot; id=&quot;list-2&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;li class=&quot;element&quot;&gt;Foo&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li class=&quot;element&quot;&gt;Bar&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">soup = BeautifulSoup(html, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line">print(soup.find(name=<span class="string">&#x27;ul&#x27;</span>)</span><br><span class="line">print(soup.find(attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;element&#x27;</span>&#125;))</span><br><span class="line">print(soup.find(text=re.<span class="built_in">compile</span>(<span class="string">&#x27;.*?o.*?&#x27;</span>, re.S)))      <span class="comment"># ç»“æœä¼šè¿”å›åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„æ–‡æœ¬ï¼ˆç»“æœä¸æ˜¯èŠ‚ç‚¹ï¼‰</span></span><br></pre></td></tr></table></figure><h5 id="findall"><a href="#findall" class="headerlink" title="findall()"></a><code>findall()</code></h5><p>find_allï¼Œç±»ä¼¼äº findï¼Œä½†æ˜¯ find_all æŸ¥è¯¢æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ï¼Œè¿”å›æ‰€æœ‰åŒ¹é…çš„å…ƒç´ ç»„æˆçš„åˆ—è¡¨ã€‚</p><h5 id="æ›´å¤š"><a href="#æ›´å¤š" class="headerlink" title="æ›´å¤š"></a>æ›´å¤š</h5><p>è¿˜æœ‰è¯¸å¦‚find_parents()ã€find_next_siblings()ã€find_previous_siblings()ç­‰çš„findï¼ŒåŸºæœ¬ä½¿ç”¨éƒ½å·®ä¸å¤šï¼Œåªæ˜¯æœç´¢èŒƒå›´ä¸åŒï¼Œè¯¦è§ <a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc.zh/">æ–‡æ¡£</a>ã€‚</p><hr><h4 id="CSSé€‰æ‹©å™¨"><a href="#CSSé€‰æ‹©å™¨" class="headerlink" title="CSSé€‰æ‹©å™¨"></a>CSSé€‰æ‹©å™¨</h4><p>BeautifulSoup è¿˜æä¾›äº† CSS é€‰æ‹©å™¨ã€‚<br>ä½¿ç”¨ CSS é€‰æ‹©å™¨ï¼Œåªéœ€è¦è°ƒç”¨ select() æ–¹æ³•ï¼Œä¼ å…¥ç›¸åº”çš„ CSS é€‰æ‹©å™¨å³å¯ï¼Œè¿”å›çš„ç»“æœæ˜¯ç¬¦åˆ CSS é€‰æ‹©å™¨çš„èŠ‚ç‚¹ç»„æˆçš„åˆ—è¡¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">html=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;div class=&quot;panel&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;panel-heading&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;h4&gt;Hello&lt;/h4&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;panel-body&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;ul class=&quot;list&quot; id=&quot;list-1&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;li class=&quot;element&quot;&gt;Foo&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li class=&quot;element&quot;&gt;Bar&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li class=&quot;element&quot;&gt;Jay&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">        &lt;ul class=&quot;list list-small&quot; id=&quot;list-2&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;li class=&quot;element&quot;&gt;Foo&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li class=&quot;element&quot;&gt;Bar&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">soup = BeautifulSoup(html, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line">print(soup.select(<span class="string">&#x27;.panel .panel-heading&#x27;</span>))</span><br><span class="line">print(soup.select(<span class="string">&#x27;ul li&#x27;</span>))</span><br><span class="line">print(soup.select(<span class="string">&#x27;#list-2 .element&#x27;</span>))</span><br><span class="line">print(<span class="built_in">type</span>(soup.select(<span class="string">&#x27;ul&#x27;</span>)[<span class="number">0</span>]))</span><br></pre></td></tr></table></figure><hr><h4 id="æå–ä¿¡æ¯"><a href="#æå–ä¿¡æ¯" class="headerlink" title="æå–ä¿¡æ¯"></a>æå–ä¿¡æ¯</h4><h5 id="è·å–å®Œæ•´æ ‡ç­¾"><a href="#è·å–å®Œæ•´æ ‡ç­¾" class="headerlink" title="è·å–å®Œæ•´æ ‡ç­¾"></a>è·å–å®Œæ•´æ ‡ç­¾</h5><p>è¦è·å–ä¸€ä¸ªæ ‡ç­¾çš„å®Œæ•´htmlä»£ç ï¼Œåªéœ€è¦å†™å®ƒçš„èŠ‚ç‚¹é€‰æ‹©å™¨å³å¯ï¼š </p><p><code>soup.title</code></p><h5 id="è·å–æ ‡ç­¾ç±»å‹"><a href="#è·å–æ ‡ç­¾ç±»å‹" class="headerlink" title="è·å–æ ‡ç­¾ç±»å‹"></a>è·å–æ ‡ç­¾ç±»å‹</h5><p>åˆ©ç”¨ name å±æ€§æ¥è·å–èŠ‚ç‚¹çš„ç±»å‹ï¼ˆpã€aã€titleã€pre ç­‰ï¼‰ï¼š</p><p><code>print(soup.title.name)</code></p><h5 id="è·å–æ ‡ç­¾å†…å®¹"><a href="#è·å–æ ‡ç­¾å†…å®¹" class="headerlink" title="è·å–æ ‡ç­¾å†…å®¹"></a>è·å–æ ‡ç­¾å†…å®¹</h5><p>æ­£å¦‚æˆ‘ä»¬ä¹‹å‰æ‰€è¯´ï¼Œè°ƒç”¨ string å±æ€§å°±å¯ä»¥å¾—åˆ°èŠ‚ç‚¹å†…çš„æ–‡æœ¬ï¼š</p><p><code>soup.title.string</code></p><p>âš ï¸ã€æ³¨æ„ã€‘å¦‚æœæ ‡ç­¾ä¸‹åŒ…å«å…¶ä»–æ ‡ç­¾ï¼Œ<code>.string</code> æ˜¯ä¸èµ·ä½œç”¨çš„ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª Noneï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>html = <span class="string">&#x27;&lt;p&gt;Foo&lt;a href=&quot;#None&quot;&gt;Bar&lt;/a&gt;&lt;/p&gt;&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>soup = BeautifulSoup(html, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(soup.p.string)</span><br><span class="line"><span class="literal">None</span></span><br></pre></td></tr></table></figure><p>è·å–å†…å®¹ï¼Œè¿˜å¯ä»¥ä½¿ç”¨èŠ‚ç‚¹çš„ get_text() æ–¹æ³•ï¼š</p><p><code>soup.p.get_text()</code></p><p>åˆ©ç”¨get_textï¼Œå¯ä»¥è·å–æ ‡ç­¾ä¸‹æ‰€æœ‰æ–‡æœ¬ï¼ŒåŒ…æ‹¬å…¶å­èŠ‚ç‚¹ä¸­çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>html = <span class="string">&#x27;&lt;p&gt;Foo&lt;a href=&quot;#None&quot;&gt;Bar&lt;/a&gt;&lt;/p&gt;&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>soup = BeautifulSoup(html, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(soup.p.string)</span><br><span class="line"><span class="literal">None</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(soup.p.get_text())</span><br><span class="line">FooBar</span><br></pre></td></tr></table></figure><h5 id="è·å–å±æ€§"><a href="#è·å–å±æ€§" class="headerlink" title="è·å–å±æ€§"></a>è·å–å±æ€§</h5><p>æ¯ä¸ªèŠ‚ç‚¹å¯èƒ½æœ‰å¤šä¸ªå±æ€§ï¼Œæ¯”å¦‚ idï¼Œclassï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ attrs è·å–æ‰€æœ‰å±æ€§ï¼Œè¿›è€Œå¯ä»¥é€šè¿‡å­—å…¸çš„å–å€¼æ–¹æ³•(ä¸­æ‹¬å·åŠ å±æ€§åç§°ï¼Œæˆ–è°ƒç”¨å…¶<code>get()</code>æ–¹æ³•)è·å–ç‰¹å®šå±æ€§ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">print(soup.p.attrs)</span><br><span class="line">print(soup.p.attrs[<span class="string">&#x27;name&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;(results)</span></span><br><span class="line"><span class="string">&#123;&#x27;class&#x27;: [&#x27;title&#x27;], &#x27;name&#x27;: &#x27;dromouse&#x27;&#125;</span></span><br><span class="line"><span class="string">dromouse</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ä¸­æ‹¬å·å’Œå±æ€§åï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> ul <span class="keyword">in</span> soup.select(<span class="string">&#x27;ul&#x27;</span>):</span><br><span class="line">    print(ul[<span class="string">&#x27;id&#x27;</span>])</span><br><span class="line">    print(ul.attrs[<span class="string">&#x27;id&#x27;</span>])</span><br><span class="line">    <span class="comment"># å¾ªç¯ä½“çš„ä¸¤è¡Œä»£ç ç­‰æ•ˆ</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Crawler </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crawler </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonä¹‹LXML</title>
      <link href="/2019/02/15/PythonAndCrawler/crawler-6-lxml/"/>
      <url>/2019/02/15/PythonAndCrawler/crawler-6-lxml/</url>
      
        <content type="html"><![CDATA[<h1 id="Pythonçˆ¬è™«è§£æåº“çš„ä½¿ç”¨ä¹‹LXML"><a href="#Pythonçˆ¬è™«è§£æåº“çš„ä½¿ç”¨ä¹‹LXML" class="headerlink" title="Pythonçˆ¬è™«è§£æåº“çš„ä½¿ç”¨ä¹‹LXML"></a>Pythonçˆ¬è™«è§£æåº“çš„ä½¿ç”¨ä¹‹LXML</h1><blockquote><p>æœ¬æ–‡ä¸»è¦ä»‹ç» XPath å’Œè§£æåº“ LXML çš„ä½¿ç”¨ã€‚</p></blockquote><h2 id="XPath-amp-LXML"><a href="#XPath-amp-LXML" class="headerlink" title="XPath &amp; LXML"></a>XPath &amp; LXML</h2><p>XPath (XML Path Language) æ˜¯è®¾è®¡æ¥åœ¨XMLæ–‡æ¡£ä¸­æŸ¥æ‰¾ä¿¡æ¯çš„è¯­è¨€ï¼Œå®ƒåŒæ ·é€‚ç”¨äºHTMLã€‚</p><p>æˆ‘ä»¬åœ¨çˆ¬è™«æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ XPath æ¥åšç›¸åº”çš„ä¿¡æ¯æŠ½å–ã€‚</p><p>âš ï¸ã€æ³¨æ„ã€‘éœ€è¦å®‰è£…å¥½ LXMLã€‚</p><h4 id="XPathå¸¸ç”¨è§„åˆ™"><a href="#XPathå¸¸ç”¨è§„åˆ™" class="headerlink" title="XPathå¸¸ç”¨è§„åˆ™"></a>XPathå¸¸ç”¨è§„åˆ™</h4><table><thead><tr><th>è¡¨è¾¾å¼</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>nodename</code></td><td>é€‰å–æ­¤èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹</td></tr><tr><td><code>/</code></td><td>ä»å½“å‰èŠ‚ç‚¹é€‰å–ç›´æ¥å­èŠ‚ç‚¹</td></tr><tr><td><code>//</code></td><td>ä»å½“å‰èŠ‚ç‚¹é€‰å–å­å­™èŠ‚ç‚¹</td></tr><tr><td><code>.</code></td><td>é€‰å–å½“å‰èŠ‚ç‚¹</td></tr><tr><td><code>..</code></td><td>é€‰å–å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹</td></tr><tr><td><code>@</code></td><td>é€‰å–å±æ€§</td></tr></tbody></table><p>æˆ‘ä»¬å¸¸ç”¨ <code>//</code> å¼€å¤´çš„ XPath è§„åˆ™æ¥é€‰å–æ‰€æœ‰ç¬¦åˆè¦æ±‚çš„èŠ‚ç‚¹ã€‚</p><p>å¦å¤–ï¼Œå¸¸ç”¨è¿ç®—ç¬¦è§ <a href="http://www.w3school.com.cn/xpath/xpath_operators.asp">XPath è¿ç®—ç¬¦</a>ã€‚</p><h4 id="å¯¼å…¥-HTML"><a href="#å¯¼å…¥-HTML" class="headerlink" title="å¯¼å…¥ HTML"></a>å¯¼å…¥ HTML</h4><h5 id="ä»å­—ç¬¦ä¸²å¯¼å…¥-HTML"><a href="#ä»å­—ç¬¦ä¸²å¯¼å…¥-HTML" class="headerlink" title="ä»å­—ç¬¦ä¸²å¯¼å…¥ HTML"></a>ä»å­—ç¬¦ä¸²å¯¼å…¥ HTML</h5><p>å¯¼å…¥äº† LXML åº“çš„ etree æ¨¡å—ï¼Œç„¶åå£°æ˜äº†ä¸€æ®µ HTML æ–‡æœ¬ï¼Œè°ƒç”¨ HTML ç±»è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™æ ·æˆ‘ä»¬å°±æˆåŠŸæ„é€ äº†ä¸€ä¸ª XPath è§£æå¯¹è±¡ã€‚</p><p>âš ï¸ã€æ³¨æ„ã€‘etree æ¨¡å—å¯ä»¥å¯¹ HTML æ–‡æœ¬è¿›è¡Œä¿®æ­£ã€‚</p><p>è°ƒç”¨ tostring() æ–¹æ³•å³å¯è¾“å‡ºä¿®æ­£åçš„ HTML ä»£ç ï¼Œç»“æœæ˜¯ bytes ç±»å‹ï¼ˆå¯ä»¥åˆ©ç”¨ decode() æ–¹æ³•è½¬æˆ str ç±»å‹ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line">text = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;div&gt;</span></span><br><span class="line"><span class="string">    &lt;ul&gt;</span></span><br><span class="line"><span class="string">         &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link1.html&quot;&gt;first item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">         &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link2.html&quot;&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">         &lt;li class=&quot;item-inactive&quot;&gt;&lt;a href=&quot;link3.html&quot;&gt;third item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">         &lt;li class=&quot;item-1&quot;&gt;&lt;a href=&quot;link4.html&quot;&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">         &lt;li class=&quot;item-0&quot;&gt;&lt;a href=&quot;link5.html&quot;&gt;fifth item&lt;/a&gt;</span></span><br><span class="line"><span class="string">     &lt;/ul&gt;</span></span><br><span class="line"><span class="string"> &lt;/div&gt;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">html = etree.HTML(text)</span><br><span class="line">result = etree.tostring(html)</span><br><span class="line">print(result.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure><h5 id="ä»æ–‡ä»¶å¯¼å…¥-HTML"><a href="#ä»æ–‡ä»¶å¯¼å…¥-HTML" class="headerlink" title="ä»æ–‡ä»¶å¯¼å…¥ HTML"></a>ä»æ–‡ä»¶å¯¼å…¥ HTML</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">html = etree.parse(<span class="string">&#x27;./test.html&#x27;</span>, etree.HTMLParser())</span><br><span class="line">result = etree.tostring(html)</span><br><span class="line">print(result.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure><h4 id="è·å–èŠ‚ç‚¹"><a href="#è·å–èŠ‚ç‚¹" class="headerlink" title="è·å–èŠ‚ç‚¹"></a>è·å–èŠ‚ç‚¹</h4><h5 id="è·å–æ‰€æœ‰èŠ‚ç‚¹"><a href="#è·å–æ‰€æœ‰èŠ‚ç‚¹" class="headerlink" title="è·å–æ‰€æœ‰èŠ‚ç‚¹"></a>è·å–æ‰€æœ‰èŠ‚ç‚¹</h5><p>è·å–ä¸€ä¸ª HTML ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œä½¿ç”¨è§„åˆ™ <code>//*</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line">html = etree.parse(<span class="string">&#x27;./test.html&#x27;</span>, etree.HTMLParser())</span><br><span class="line"></span><br><span class="line">result = html.xpath(<span class="string">&#x27;//*&#x27;</span>)</span><br><span class="line"></span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ª ç”± Element ç±»å‹ç»„æˆçš„åˆ—è¡¨ã€‚</p><h5 id="è·å–æ‰€æœ‰æŒ‡å®šæ ‡ç­¾"><a href="#è·å–æ‰€æœ‰æŒ‡å®šæ ‡ç­¾" class="headerlink" title="è·å–æ‰€æœ‰æŒ‡å®šæ ‡ç­¾"></a>è·å–æ‰€æœ‰æŒ‡å®šæ ‡ç­¾</h5><p>å¦‚æœæˆ‘ä»¬æƒ³è·å–æ‰€æœ‰ li æ ‡ç­¾ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸Šä¾‹ä¸­çš„html.xpath() ä¸­çš„è§„åˆ™æ”¹ä¸º <code>&#39;//li&#39;</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line">html = etree.parse(<span class="string">&#x27;./test.html&#x27;</span>, etree.HTMLParser())</span><br><span class="line">result = html.xpath(<span class="string">&#x27;//li&#x27;</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p>å¦‚æœæ— æ³•è·å–ä»»ä½•åŒ¹é…ç»“æœï¼Œhtml.xpath å°†ä¼šè¿”å› <code>[]</code></p><h5 id="è·å–å­èŠ‚ç‚¹"><a href="#è·å–å­èŠ‚ç‚¹" class="headerlink" title="è·å–å­èŠ‚ç‚¹"></a>è·å–å­èŠ‚ç‚¹</h5><p>é€‰æ‹© li èŠ‚ç‚¹æ‰€æœ‰ç›´æ¥ a å­èŠ‚ç‚¹ï¼Œä½¿ç”¨è§„åˆ™ <code>&#39;//li/a&#39;</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">html = etree.parse(<span class="string">&#x27;./test.html&#x27;</span>, etree.HTMLParser())</span><br><span class="line">result = html.xpath(<span class="string">&#x27;//li/a&#x27;</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p>è¦è·å–å…¶ä¸‹æ‰€æœ‰å­å­™aèŠ‚ç‚¹å¯ä»¥è¿™æ ·ï¼š<code>//li//a</code></p><h5 id="è·å–ç‰¹å®šå±æ€§çš„èŠ‚ç‚¹"><a href="#è·å–ç‰¹å®šå±æ€§çš„èŠ‚ç‚¹" class="headerlink" title="è·å–ç‰¹å®šå±æ€§çš„èŠ‚ç‚¹"></a>è·å–ç‰¹å®šå±æ€§çš„èŠ‚ç‚¹</h5><p>ç”¨ @ ç¬¦å·è¿›è¡Œå±æ€§è¿‡æ»¤ã€‚<br>smt[â€¦] æ˜¯æœ‰ â€¦ é™åˆ¶çš„smtã€‚</p><p>é€‰ä¸­ href æ˜¯ link4.html çš„ a èŠ‚ç‚¹ï¼Œè§„åˆ™æ˜¯ <code>&#39;//a[@href=&quot;link4.html&quot;]</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">html = etree.parse(<span class="string">&#x27;./test.html&#x27;</span>, etree.HTMLParser())</span><br><span class="line">result = html.xpath(<span class="string">&#x27;//a[@href=&quot;link4.html&quot;]&#x27;</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><h5 id="è·å–çˆ¶èŠ‚ç‚¹"><a href="#è·å–çˆ¶èŠ‚ç‚¹" class="headerlink" title="è·å–çˆ¶èŠ‚ç‚¹"></a>è·å–çˆ¶èŠ‚ç‚¹</h5><p>å¦‚æœæˆ‘ä»¬æƒ³è·å–ä¸Šä¾‹çš„çˆ¶èŠ‚ç‚¹, ç„¶åå†è·å–å…¶ class å±æ€§ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">html = etree.parse(<span class="string">&#x27;./test.html&#x27;</span>, etree.HTMLParser())</span><br><span class="line">result = html.xpath(<span class="string">&#x27;//a[@href=&quot;link4.html&quot;]/../@class&#x27;</span>)</span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥ç”¨â€œèŠ‚ç‚¹è½´â€ &#x27;//a[@href=&quot;link4.html&quot;]/parent::*/@class&#x27;</span></span><br><span class="line"></span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p>å…³äºèŠ‚ç‚¹è½´çš„ä½¿ç”¨ï¼Œè¯¦è§ <a href="http://www.w3school.com.cn/xpath/xpath_axes.asp">XPath Axes</a></p><h5 id="è·å–èŠ‚ç‚¹ä¸­çš„çš„æ–‡æœ¬"><a href="#è·å–èŠ‚ç‚¹ä¸­çš„çš„æ–‡æœ¬" class="headerlink" title="è·å–èŠ‚ç‚¹ä¸­çš„çš„æ–‡æœ¬"></a>è·å–èŠ‚ç‚¹ä¸­çš„çš„æ–‡æœ¬</h5><p>XPath ä¸­çš„ text() æ–¹æ³•å¯ä»¥è·å–èŠ‚ç‚¹ä¸­çš„ç›´æ¥æ–‡æœ¬ï¼ˆä¸åŒ…æ‹¬å…¶å­èŠ‚ç‚¹ä¸­çš„æ–‡æœ¬ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">html = etree.parse(<span class="string">&#x27;./test.html&#x27;</span>, etree.HTMLParser())</span><br><span class="line">result = html.xpath(<span class="string">&#x27;//li[@class=&quot;item-0&quot;]/text()&#x27;</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><h5 id="è·å–å±æ€§"><a href="#è·å–å±æ€§" class="headerlink" title="è·å–å±æ€§"></a>è·å–å±æ€§</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">html = etree.parse(<span class="string">&#x27;./test.html&#x27;</span>, etree.HTMLParser())</span><br><span class="line">result = html.xpath(<span class="string">&#x27;//li/a/@href&#x27;</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p>ç”¨ä¸Šé¢è¿™ç§æ–¹æ³•åªèƒ½è·å–åªæœ‰ä¸€ä¸ªå€¼çš„å±æ€§ï¼Œ<br>å¯¹äºä¸‹é¢è¿™ç§ï¼š</p><p><code>&lt;li class=&quot;li li-first&quot;&gt;&lt;a href=&quot;link.html&quot;&gt;first item&lt;/a&gt;&lt;/li&gt;</code></p><p> li èŠ‚ç‚¹çš„ class å±æ€§æœ‰ä¸¤ä¸ªå€¼ï¼Œä¸Šé¢è¿™ä¸ªæ–¹æ³•ä¼šå¤±æ•ˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ contains() å‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line">text = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;li class=&quot;li li-first&quot;&gt;&lt;a href=&quot;link.html&quot;&gt;first item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">html = e<span class="comment">#tree.HTML(text)</span></span><br><span class="line">result = html.xpath(<span class="string">&#x27;//li[contains(@class, &quot;li&quot;)]/a/text()&#x27;</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜å¯ä»¥ä½¿ç”¨è¿ç®—ç¬¦ and æ¥è¿æ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line">text = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;li class=&quot;li li-first&quot; name=&quot;item&quot;&gt;&lt;a href=&quot;link.html&quot;&gt;first item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">html = etree.HTML(text)</span><br><span class="line">result = html.xpath(<span class="string">&#x27;//li[contains(@class, &quot;li&quot;) and @name=&quot;item&quot;]/a/text()&#x27;</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><h4 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h4><p>ç‚¹å‡»é“¾æ¥æŸ¥çœ‹è¯¦ç»†çš„ <a href="http://www.w3school.com.cn/xpath/index.asp">XPath æ•™ç¨‹</a> ã€ <a href="https://lxml.de/">lxml åº“</a>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Crawler </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crawler </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonçˆ¬è™«æŠ“å–ç”µå½±æ’è¡Œ</title>
      <link href="/2019/02/14/PythonAndCrawler/crawler-5-ex-topmoives/"/>
      <url>/2019/02/14/PythonAndCrawler/crawler-5-ex-topmoives/</url>
      
        <content type="html"><![CDATA[<h1 id="çˆ¬è™«åŸºæœ¬åº“å®è·µ-â€“-æŠ“å–ç”µå½±æ’è¡Œ"><a href="#çˆ¬è™«åŸºæœ¬åº“å®è·µ-â€“-æŠ“å–ç”µå½±æ’è¡Œ" class="headerlink" title="çˆ¬è™«åŸºæœ¬åº“å®è·µ â€“ æŠ“å–ç”µå½±æ’è¡Œ"></a>çˆ¬è™«åŸºæœ¬åº“å®è·µ â€“ æŠ“å–ç”µå½±æ’è¡Œ</h1><blockquote><p>çˆ¬è™«å®è·µï¼šåˆ©ç”¨ Requests å’Œæ­£åˆ™è¡¨è¾¾å¼æ¥æŠ“å–çŒ«çœ¼ç”µå½± TOP100 çš„ç›¸å…³å†…å®¹ã€‚</p></blockquote><h3 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h3><p>æˆ‘ä»¬æ‰“ç®—æå–å‡º <a href="http://maoyan.com/board/4">çŒ«çœ¼ç”µå½± TOP100 æ¦œ</a> çš„ç”µå½±åç§°ã€æ—¶é—´ã€è¯„åˆ†ã€å›¾ç‰‡ç­‰ä¿¡æ¯ï¼Œæå–çš„ç»“æœæˆ‘ä»¬ä»¥æ–‡ä»¶å½¢å¼ä¿å­˜ä¸‹æ¥ã€‚</p><h3 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h3><ul><li>ç³»ç»Ÿç¯å¢ƒï¼šmacOS High Sierra 10.13.6</li><li>å¼€å‘è¯­è¨€ï¼šPython 3.7.2 (default)</li><li>ç¬¬ä¸‰æ–¹åº“ï¼šRequests</li></ul><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p><a href="https://maoyan.com/board/4">ç›®æ ‡ç«™ç‚¹</a>ï¼š<code>https://maoyan.com/board/4</code></p><p>æ‰“å¼€é¡µé¢åæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œé¡µé¢ä¸­æ˜¾ç¤ºçš„æœ‰æ•ˆä¿¡æ¯æœ‰ <strong>å½±ç‰‡åç§°</strong>ã€<strong>ä¸»æ¼”</strong>ã€<strong>ä¸Šæ˜ æ—¶é—´</strong>ã€<strong>ä¸Šæ˜ åœ°åŒº</strong>ã€<strong>è¯„åˆ†</strong>ã€<strong>å›¾ç‰‡</strong>ã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹æ’åç¬¬ä¸€çš„æ¡ç›®çš„ html æºç ï¼Œä¸€ä¼šå„¿æˆ‘ä»¬å°±ä»è¿™æ®µä»£ç å…¥æ‰‹è®¾è®¡æ­£åˆ™è¡¨è¾¾å¼ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dd</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;board-index board-index-1&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/films/1203&quot;</span> <span class="attr">title</span>=<span class="string">&quot;éœ¸ç‹åˆ«å§¬&quot;</span> <span class="attr">class</span>=<span class="string">&quot;image-link&quot;</span> <span class="attr">data-act</span>=<span class="string">&quot;boarditem-click&quot;</span> <span class="attr">data-val</span>=<span class="string">&quot;&#123;movieId:1203&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;//s0.meituan.net/bs/?f=myfe/mywww:/image/loading_2.e3d934bf.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">class</span>=<span class="string">&quot;poster-default&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">data-src</span>=<span class="string">&quot;https://p1.meituan.net/movie/20803f59291c47e1e116c11963ce019e68711.jpg@160w_220h_1e_1c&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">alt</span>=<span class="string">&quot;éœ¸ç‹åˆ«å§¬&quot;</span> <span class="attr">class</span>=<span class="string">&quot;board-img&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;board-item-main&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;board-item-content&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;movie-item-info&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/films/1203&quot;</span> <span class="attr">title</span>=<span class="string">&quot;éœ¸ç‹åˆ«å§¬&quot;</span> <span class="attr">data-act</span>=<span class="string">&quot;boarditem-click&quot;</span></span></span><br><span class="line"><span class="tag">                                                <span class="attr">data-val</span>=<span class="string">&quot;&#123;movieId:1203&#125;&quot;</span>&gt;</span>éœ¸ç‹åˆ«å§¬<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;star&quot;</span>&gt;</span></span><br><span class="line">                                        ä¸»æ¼”ï¼šå¼ å›½è£,å¼ ä¸°æ¯…,å·©ä¿</span><br><span class="line">                                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;releasetime&quot;</span>&gt;</span>ä¸Šæ˜ æ—¶é—´ï¼š1993-01-01<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;movie-item-number score-num&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;score&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;integer&quot;</span>&gt;</span>9.<span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fraction&quot;</span>&gt;</span>6<span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å†æ¥çœ‹çœ‹ç¿»é¡µä¼šå‘ç”Ÿä»€ä¹ˆï¼š<br>url ä» <code>https://maoyan.com/board/4</code> å˜æˆäº† <code>https://maoyan.com/board/4?offset=10</code>ã€‚<br>å—¯ï¼Œå¤šäº†ä¸€ä¸ª <code>?offset=10</code>ã€‚<br>å†ä¸‹ä¸€é¡µï¼Œå˜æˆäº†<code>?offset=20</code>ã€‚<br>åŸæ¥ï¼Œæ¯ç¿»ä¸€é¡µoffsetå°±åŠ 10ï¼ˆä¸€é¡µæ˜¾ç¤ºåˆšå¥½æ˜¯10ä¸ªæ¡ç›®ï¼Œè¿™å¾ˆåˆç†ã€‚ï¼‰<br>å…¶å®æˆ‘ä»¬ç”šè‡³å¯ä»¥å°è¯•æŠŠå€¼æ”¹æˆ0ï¼ˆé¦–é¡µï¼‰ï¼Œæˆ–ä»»ä½•åœ¨èŒƒå›´ <code>[0, 100)</code> å†…çš„å€¼ã€‚</p><h3 id="è®¾è®¡"><a href="#è®¾è®¡" class="headerlink" title="è®¾è®¡"></a>è®¾è®¡</h3><p>æˆ‘ä»¬ç°åœ¨è®¾è®¡ä¸€ä¸ªå¯ä»¥å®Œæˆç›®æ ‡çš„çˆ¬è™«ç¨‹åºã€‚</p><p>è¿™ä¸ªçˆ¬è™«åº”è¯¥æœ‰è¿™å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>æŠ“å–é¡µé¢ï¼ˆåŒæ—¶ä¹Ÿè¦æ³¨æ„é…åˆç¿»é¡µçš„é—®é¢˜å¤„ç†ï¼‰ï¼šå¯ä»¥ç”¨ <code>requests.get()</code> æ¥è¯·æ±‚ï¼Œæœ€å¥½å†ä¼ªé€ ä¸€ç»„headersã€‚</li><li>æ­£åˆ™æå–ï¼ˆåŒ¹é…å‡º å½±ç‰‡åç§°ã€ä¸»æ¼”ã€ä¸Šæ˜ æ—¶é—´ã€ä¸Šæ˜ åœ°åŒºã€è¯„åˆ†ã€å›¾ç‰‡ï¼‰ï¼šç”¨ <code>re.findall()</code> å’Œé€‚å½“çš„æ­£åˆ™è¡¨è¾¾å¼æ¥æå–ä¿¡æ¯ã€‚</li><li>å†™å…¥æ–‡ä»¶ï¼ˆç”¨JSONæ ¼å¼å»ä¿å­˜ä¿¡æ¯ï¼‰ï¼šæ¶‰åŠåˆ° <code>json.dumps()</code> ä¸ æ–‡ä»¶å†™å…¥</li></ul><p>ç°åœ¨ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®¾è®¡å°¤ä¸ºå…³é”®çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#39;&lt;dd&gt;.*?board-index.*?&gt;(.*?)&lt;&#x2F;i&gt;.*?data-src&#x3D;&quot;(.*?)@.*?title&#x3D;&quot;(.*?)&quot;.*?ä¸»æ¼”ï¼š(.*?)\s*&lt;&#x2F;p&gt;.*?ä¸Šæ˜ æ—¶é—´ï¼š(.*?)&lt;&#x2F;p&gt;.*?integer&quot;&gt;(.*?)&lt;&#x2F;i&gt;.*?fraction&quot;&gt;(.*?)&lt;&#x2F;i&gt;&lt;&#x2F;p&gt;&#39;</span><br><span class="line">åŒ¹é…åˆ°çš„é¡ºåºæ˜¯ï¼š(æ’å, å›¾ç‰‡åœ°å€, åç§°, ä¸»æ¼”, ä¸Šæ˜ æ—¶é—´, è¯„åˆ†æ•´æ•°éƒ¨åˆ†, è¯„åˆ†å°æ•°éƒ¨åˆ†)</span><br><span class="line">éœ€è¦ä½¿ç”¨ re.S</span><br></pre></td></tr></table></figure><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>æˆ‘ä»¬ç°åœ¨æ¥æŒ‰ç…§è®¾è®¡å®ç°ç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„ç¨‹åºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://maoyan.com/board/4&#x27;</span></span><br><span class="line">filename = <span class="string">&#x27;./movies.txt&#x27;</span></span><br><span class="line">pattern = <span class="string">r&#x27;&lt;dd&gt;.*?board-index.*?&gt;(.*?)&lt;/i&gt;.*?data-src=&quot;(.*?)@.*?title=&quot;(.*?)&quot;.*?ä¸»æ¼”ï¼š(.*?)\s*&lt;/p&gt;.*?ä¸Šæ˜ æ—¶é—´ï¼š(.*?)&lt;/p&gt;.*?integer&quot;&gt;(.*?)&lt;/i&gt;.*?fraction&quot;&gt;(.*?)&lt;/i&gt;&lt;/p&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">        <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;zh-cn&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_page</span>(<span class="params">url</span>):</span>   <span class="comment"># æŠ“å–é¡µé¢ï¼Œè¿”å›htmlå­—ç¬¦ä¸²</span></span><br><span class="line">    print(<span class="string">&#x27;\tGetting...&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(url, headers=headers)</span><br><span class="line">        <span class="keyword">return</span> response.text</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">&#x27;[Error]&#x27;</span>, e)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">extract</span>(<span class="params">html</span>):</span>  <span class="comment"># æ­£åˆ™æå–ï¼Œè¿”å›ç»“æœdictçš„list</span></span><br><span class="line">    print(<span class="string">&#x27;\tExtracting...&#x27;</span>)</span><br><span class="line">    raws = re.findall(pattern, html, re.S)   <span class="comment"># [(æ’å, å›¾ç‰‡åœ°å€, åç§°, ä¸»æ¼”, ä¸Šæ˜ æ—¶é—´, è¯„åˆ†æ•´æ•°éƒ¨åˆ†, è¯„åˆ†å°æ•°éƒ¨åˆ†), ...]</span></span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">for</span> raw <span class="keyword">in</span> raws:</span><br><span class="line">        dc = &#123;                      <span class="comment"># åœ¨è¿™é‡Œè°ƒæ•´äº†é¡ºåº</span></span><br><span class="line">                <span class="string">&#x27;index&#x27;</span>: raw[<span class="number">0</span>],</span><br><span class="line">                <span class="string">&#x27;title&#x27;</span>: raw[<span class="number">2</span>],</span><br><span class="line">                <span class="string">&#x27;stars&#x27;</span>: raw[<span class="number">3</span>],</span><br><span class="line">                <span class="string">&#x27;otime&#x27;</span>: raw[<span class="number">4</span>],</span><br><span class="line">                <span class="string">&#x27;score&#x27;</span>: raw[<span class="number">5</span>] + raw[<span class="number">6</span>],   <span class="comment"># åˆå¹¶æ•´æ•°ã€å°æ•°</span></span><br><span class="line">                <span class="string">&#x27;image&#x27;</span>: raw[<span class="number">1</span>]</span><br><span class="line">                &#125;</span><br><span class="line">        result.append(dc)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save</span>(<span class="params">data</span>):</span>      <span class="comment"># å†™å…¥æ–‡ä»¶</span></span><br><span class="line">    print(<span class="string">&#x27;\tSaving...&#x27;</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;a&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">            f.write(json.dumps(i, ensure_ascii=<span class="literal">False</span>) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">100</span>, <span class="number">10</span>):     <span class="comment"># ç¿»é¡µ</span></span><br><span class="line">        target = url + <span class="string">&#x27;?offset=&#x27;</span> + <span class="built_in">str</span>(i)</span><br><span class="line">        print(<span class="string">&#x27;[%s%%](%s)&#x27;</span> % (i, target))</span><br><span class="line">        page = get_page(target)</span><br><span class="line">        data = extract(page)</span><br><span class="line">        save(data)</span><br><span class="line">        time.sleep(<span class="number">0.5</span>)     <span class="comment"># é˜²åˆ¶è¯·æ±‚è¿‡å¯†é›†è¢«å°</span></span><br><span class="line"></span><br><span class="line">    print(<span class="string">&#x27;[100%] All Finished.\n Results in&#x27;</span>, filename)</span><br></pre></td></tr></table></figure><h3 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h3><p>è¿è¡Œç¨‹åºï¼Œå¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;index&quot;</span>: <span class="string">&quot;1&quot;</span>, <span class="string">&quot;title&quot;</span>: <span class="string">&quot;éœ¸ç‹åˆ«å§¬&quot;</span>, <span class="string">&quot;stars&quot;</span>: <span class="string">&quot;å¼ å›½è£,å¼ ä¸°æ¯…,å·©ä¿&quot;</span>, <span class="string">&quot;otime&quot;</span>: <span class="string">&quot;1993-01-01&quot;</span>, <span class="string">&quot;score&quot;</span>: <span class="string">&quot;9.6&quot;</span>, <span class="string">&quot;image&quot;</span>: <span class="string">&quot;https://p1.meituan.net/movie/20803f59291c47e1e116c11963ce019e68711.jpg&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;index&quot;</span>: <span class="string">&quot;2&quot;</span>, <span class="string">&quot;title&quot;</span>: <span class="string">&quot;è‚–ç”³å…‹çš„æ•‘èµ&quot;</span>, <span class="string">&quot;stars&quot;</span>: <span class="string">&quot;è’‚å§†Â·ç½—å®¾æ–¯,æ‘©æ ¹Â·å¼—é‡Œæ›¼,é²å‹ƒÂ·å†ˆé¡¿&quot;</span>, <span class="string">&quot;otime&quot;</span>: <span class="string">&quot;1994-10-14(ç¾å›½)&quot;</span>, <span class="string">&quot;score&quot;</span>: <span class="string">&quot;9.5&quot;</span>, <span class="string">&quot;image&quot;</span>: <span class="string">&quot;https://p0.meituan.net/movie/283292171619cdfd5b240c8fd093f1eb255670.jpg&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;index&quot;</span>: <span class="string">&quot;3&quot;</span>, <span class="string">&quot;title&quot;</span>: <span class="string">&quot;ç½—é©¬å‡æ—¥&quot;</span>, <span class="string">&quot;stars&quot;</span>: <span class="string">&quot;æ ¼åˆ©é«˜é‡ŒÂ·æ´¾å…‹,å¥¥é»›ä¸½Â·èµ«æœ¬,åŸƒè¿ªÂ·è‰¾ä¼¯ç‰¹&quot;</span>, <span class="string">&quot;otime&quot;</span>: <span class="string">&quot;1953-09-02(ç¾å›½)&quot;</span>, <span class="string">&quot;score&quot;</span>: <span class="string">&quot;9.1&quot;</span>, <span class="string">&quot;image&quot;</span>: <span class="string">&quot;https://p0.meituan.net/movie/54617769d96807e4d81804284ffe2a27239007.jpg&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;index&quot;</span>: <span class="string">&quot;4&quot;</span>, <span class="string">&quot;title&quot;</span>: <span class="string">&quot;è¿™ä¸ªæ€æ‰‹ä¸å¤ªå†·&quot;</span>, <span class="string">&quot;stars&quot;</span>: <span class="string">&quot;è®©Â·é›·è¯º,åŠ é‡ŒÂ·å¥¥å¾·æ›¼,å¨œå¡”è‰Â·æ³¢ç‰¹æ›¼&quot;</span>, <span class="string">&quot;otime&quot;</span>: <span class="string">&quot;1994-09-14(æ³•å›½)&quot;</span>, <span class="string">&quot;score&quot;</span>: <span class="string">&quot;9.5&quot;</span>, <span class="string">&quot;image&quot;</span>: <span class="string">&quot;https://p0.meituan.net/movie/e55ec5d18ccc83ba7db68caae54f165f95924.jpg&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;index&quot;</span>: <span class="string">&quot;5&quot;</span>, <span class="string">&quot;title&quot;</span>: <span class="string">&quot;æ³°å¦å°¼å…‹å·&quot;</span>, <span class="string">&quot;stars&quot;</span>: <span class="string">&quot;è±æ˜‚çº³å¤šÂ·è¿ªå¡æ™®é‡Œå¥¥,å‡¯ç‰¹Â·æ¸©ä¸è±ç‰¹,æ¯”åˆ©Â·èµæ©&quot;</span>, <span class="string">&quot;otime&quot;</span>: <span class="string">&quot;1998-04-03&quot;</span>, <span class="string">&quot;score&quot;</span>: <span class="string">&quot;9.6&quot;</span>, <span class="string">&quot;image&quot;</span>: <span class="string">&quot;https://p1.meituan.net/movie/0699ac97c82cf01638aa5023562d6134351277.jpg&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>ä¹ä¸€çœ‹å¥½åƒæ²¡æœ‰é—®é¢˜äº†ï¼Œæˆ‘ä»¬éœ€è¦çš„ç»“æœéƒ½å¾—åˆ°äº†ã€‚<br>ä½†æ˜¯ï¼Œä»”ç»†æŸ¥çœ‹ï¼Œå‘ç°è¿˜æ˜¯ä¼šæœ‰å‡ ä¸ªé—®é¢˜å­˜åœ¨ï¼š</p><ol><li>ä¸»æ¼”ï¼ˆstarsï¼‰ä¸€èˆ¬éƒ½æœ‰å‡ ä¸ªäººï¼Œæˆ‘ä»¬æœ€å¥½æŠŠä»–ä»¬åˆ†å¼€ç”¨ä¸€ä¸ªlistæˆ–æ˜¯tupleæ¥å®‰ç½®ã€‚</li><li>ä¿¡æ¯æ¯ä¸€ä¸ªæ¡ç›®ç›´æ¥ç›¸äº’åˆ†ç¦»ï¼Œä¸ä¾¿äºä¼ è¾“ä¸å–ç”¨ã€‚</li></ol><p>è¦è§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ extract ä¸­å¢åŠ ä¸€éƒ¨åˆ†æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œè€Œç¬¬äºŒä¸ªé—®é¢˜åˆ™éœ€è¦æˆ‘ä»¬å°†æ‰€æœ‰é¡µéƒ½è¯»å–å®Œæˆï¼Œæ”¾åˆ°æŒ‡å®šä½ç½®ï¼Œå†ç»Ÿä¸€å†™å…¥æ–‡ä»¶ã€‚</p><p>ä¿®æ”¹æºç¨‹åºï¼š</p><p>æ–°å¢ å‡½æ•°ï¼Œå¤„ç†ä¸»æ¼”ä¿¡æ¯ï¼Œå¾—åˆ°ä¸€ä¸ªlist:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stars_split</span>(<span class="params">st</span>):</span></span><br><span class="line">    <span class="keyword">return</span> st.split(<span class="string">&#x27;,&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ extract()ï¼Œåœ¨å…¶ä¸­æ·»åŠ  stars_split çš„è°ƒç”¨:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">extract</span>(<span class="params">html</span>):</span>  <span class="comment"># æ­£åˆ™æå–ï¼Œè¿”å›ç»“æœdictçš„list</span></span><br><span class="line">    print(<span class="string">&#x27;\tExtracting...&#x27;</span>)</span><br><span class="line">    raws = re.findall(pattern, html, re.S)   <span class="comment"># [(æ’å, å›¾ç‰‡åœ°å€, åç§°, ä¸»æ¼”, ä¸Šæ˜ æ—¶é—´, è¯„åˆ†æ•´æ•°éƒ¨åˆ†, è¯„åˆ†å°æ•°éƒ¨åˆ†), ...]</span></span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">for</span> raw <span class="keyword">in</span> raws:</span><br><span class="line">        dc = &#123;                      <span class="comment"># åœ¨è¿™é‡Œè°ƒæ•´äº†é¡ºåº</span></span><br><span class="line">                <span class="string">&#x27;index&#x27;</span>: raw[<span class="number">0</span>],</span><br><span class="line">                <span class="string">&#x27;title&#x27;</span>: raw[<span class="number">2</span>],</span><br><span class="line">                <span class="string">&#x27;stars&#x27;</span>: stars_split(raw[<span class="number">3</span>]),   <span class="comment"># ã€ä¿®æ”¹ã€‘ï¼šåˆ†ç¦»ä¸»æ¼”</span></span><br><span class="line">                <span class="string">&#x27;otime&#x27;</span>: raw[<span class="number">4</span>],</span><br><span class="line">                <span class="string">&#x27;score&#x27;</span>: raw[<span class="number">5</span>] + raw[<span class="number">6</span>],       <span class="comment"># åˆå¹¶æ•´æ•°ã€å°æ•°</span></span><br><span class="line">                <span class="string">&#x27;image&#x27;</span>: raw[<span class="number">1</span>]</span><br><span class="line">                &#125;</span><br><span class="line">        result.append(dc)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure><p>æ–°å¢ ä¸€ä¸ªå…¨å±€å˜é‡ã€å‡½æ•°ï¼Œå®ç°ç»“æœçš„æ•´åˆ:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">result = &#123;<span class="string">&#x27;top movies&#x27;</span>: []&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">merge</span>(<span class="params">data</span>):</span></span><br><span class="line">    print(<span class="string">&#x27;\tMerging...&#x27;</span>)</span><br><span class="line">    result[<span class="string">&#x27;top movies&#x27;</span>] += data</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ saveï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save</span>(<span class="params">data</span>):</span>      <span class="comment"># å†™å…¥æ–‡ä»¶</span></span><br><span class="line">    print(<span class="string">&#x27;Saving...&#x27;</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;a&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(json.dumps(data, ensure_ascii=<span class="literal">False</span>))</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ç¨‹åºæ¡†æ¶ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">100</span>, <span class="number">10</span>):     <span class="comment"># ç¿»é¡µ</span></span><br><span class="line">        target = url + <span class="string">&#x27;?offset=&#x27;</span> + <span class="built_in">str</span>(i)</span><br><span class="line">        print(<span class="string">&#x27;[%s%%](%s)&#x27;</span> % (i, target))</span><br><span class="line">        page = get_page(target)</span><br><span class="line">        data = extract(page)</span><br><span class="line">        merge(data)</span><br><span class="line">        time.sleep(<span class="number">0.5</span>)     <span class="comment"># é˜²åˆ¶è¯·æ±‚è¿‡å¯†é›†è¢«å°</span></span><br><span class="line">        </span><br><span class="line">    save(result)</span><br><span class="line">    print(<span class="string">&#x27;[100%] All Finished.\n Results in&#x27;</span>, filename)</span><br></pre></td></tr></table></figure><p>æ•´åˆä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://maoyan.com/board/4&#x27;</span></span><br><span class="line">result = &#123;<span class="string">&#x27;top movies&#x27;</span>: []&#125;</span><br><span class="line">filename = <span class="string">&#x27;./movies.json&#x27;</span>      <span class="comment"># ï¼ˆæœ€å¥½æŠŠä¿å­˜çš„æ–‡ä»¶åæ”¹ä¸€ä¸‹ï¼Œå¦åˆ™ä¼šæ·»åŠ åˆ°ä¸Šæ¬¡è¿è¡Œç»“æœçš„åé¢ï¼‰</span></span><br><span class="line"></span><br><span class="line">pattern = <span class="string">r&#x27;&lt;dd&gt;.*?board-index.*?&gt;(.*?)&lt;/i&gt;.*?data-src=&quot;(.*?)@.*?title=&quot;(.*?)&quot;.*?ä¸»æ¼”ï¼š(.*?)\s*&lt;/p&gt;.*?ä¸Šæ˜ æ—¶é—´ï¼š(.*?)&lt;/p&gt;.*?integer&quot;&gt;(.*?)&lt;/i&gt;.*?fraction&quot;&gt;(.*?)&lt;/i&gt;&lt;/p&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">        <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;zh-cn&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_page</span>(<span class="params">url</span>):</span>   <span class="comment"># æŠ“å–é¡µé¢ï¼Œè¿”å›htmlå­—ç¬¦ä¸²</span></span><br><span class="line">    print(<span class="string">&#x27;\tGetting...&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(url, headers=headers)</span><br><span class="line">        <span class="keyword">return</span> response.text</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">&#x27;[Error]&#x27;</span>, e)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stars_split</span>(<span class="params">st</span>):</span></span><br><span class="line">    <span class="keyword">return</span> st.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">extract</span>(<span class="params">html</span>):</span>  <span class="comment"># æ­£åˆ™æå–ï¼Œè¿”å›ç»“æœdictçš„list</span></span><br><span class="line">    print(<span class="string">&#x27;\tExtracting...&#x27;</span>)</span><br><span class="line">    raws = re.findall(pattern, html, re.S)   <span class="comment"># [(æ’å, å›¾ç‰‡åœ°å€, åç§°, ä¸»æ¼”, ä¸Šæ˜ æ—¶é—´, è¯„åˆ†æ•´æ•°éƒ¨åˆ†, è¯„åˆ†å°æ•°éƒ¨åˆ†), ...]</span></span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">for</span> raw <span class="keyword">in</span> raws:</span><br><span class="line">        dc = &#123;                      <span class="comment"># åœ¨è¿™é‡Œè°ƒæ•´äº†é¡ºåº</span></span><br><span class="line">                <span class="string">&#x27;index&#x27;</span>: raw[<span class="number">0</span>],</span><br><span class="line">                <span class="string">&#x27;title&#x27;</span>: raw[<span class="number">2</span>],</span><br><span class="line">                <span class="string">&#x27;stars&#x27;</span>: stars_split(raw[<span class="number">3</span>]),   <span class="comment"># åˆ†ç¦»ä¸»æ¼”</span></span><br><span class="line">                <span class="string">&#x27;otime&#x27;</span>: raw[<span class="number">4</span>],</span><br><span class="line">                <span class="string">&#x27;score&#x27;</span>: raw[<span class="number">5</span>] + raw[<span class="number">6</span>],       <span class="comment"># åˆå¹¶æ•´æ•°ã€å°æ•°</span></span><br><span class="line">                <span class="string">&#x27;image&#x27;</span>: raw[<span class="number">1</span>]</span><br><span class="line">                &#125;</span><br><span class="line">        result.append(dc)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">merge</span>(<span class="params">data</span>):</span></span><br><span class="line">    print(<span class="string">&#x27;\tMerging...&#x27;</span>)</span><br><span class="line">    result[<span class="string">&#x27;top movies&#x27;</span>] += data</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save</span>(<span class="params">data</span>):</span>      <span class="comment"># å†™å…¥æ–‡ä»¶</span></span><br><span class="line">    print(<span class="string">&#x27;Saving...&#x27;</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;a&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(json.dumps(data, ensure_ascii=<span class="literal">False</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">100</span>, <span class="number">10</span>):     <span class="comment"># ç¿»é¡µ</span></span><br><span class="line">        target = url + <span class="string">&#x27;?offset=&#x27;</span> + <span class="built_in">str</span>(i)</span><br><span class="line">        print(<span class="string">&#x27;[%s%%](%s)&#x27;</span> % (i, target))</span><br><span class="line">        page = get_page(target)</span><br><span class="line">        data = extract(page)</span><br><span class="line">        merge(data)</span><br><span class="line">        time.sleep(<span class="number">0.5</span>)     <span class="comment"># é˜²åˆ¶è¯·æ±‚è¿‡å¯†é›†è¢«å°</span></span><br><span class="line">        </span><br><span class="line">    save(result)</span><br><span class="line">    print(<span class="string">&#x27;[100%] All Finished.\n Results in&#x27;</span>, filename)</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¿®æ”¹å®Œæ¯•çš„ç¨‹åºï¼Œå¾—åˆ°æ–°çš„ç»“æœï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;top movies&quot;</span>: [&#123;<span class="attr">&quot;index&quot;</span>: <span class="string">&quot;1&quot;</span>, <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;éœ¸ç‹åˆ«å§¬&quot;</span>, <span class="attr">&quot;stars&quot;</span>: [<span class="string">&quot;å¼ å›½è£&quot;</span>, <span class="string">&quot;å¼ ä¸°æ¯…&quot;</span>, <span class="string">&quot;å·©ä¿&quot;</span>], <span class="attr">&quot;otime&quot;</span>: <span class="string">&quot;1993-01-01&quot;</span>, <span class="attr">&quot;score&quot;</span>: <span class="string">&quot;9.6&quot;</span>, <span class="attr">&quot;image&quot;</span>: <span class="string">&quot;https://p1.meituan.net/movie/20803f59291c47e1e116c11963ce019e68711.jpg&quot;</span>&#125;, &#123;<span class="attr">&quot;index&quot;</span>: <span class="string">&quot;2&quot;</span>, <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;è‚–ç”³å…‹çš„æ•‘èµ&quot;</span>, <span class="attr">&quot;stars&quot;</span>: [<span class="string">&quot;è’‚å§†Â·ç½—å®¾æ–¯&quot;</span>, <span class="string">&quot;æ‘©æ ¹Â·å¼—é‡Œæ›¼&quot;</span>, <span class="string">&quot;é²å‹ƒÂ·å†ˆé¡¿&quot;</span>], <span class="attr">&quot;otime&quot;</span>: <span class="string">&quot;1994-10-14(ç¾å›½)&quot;</span>, <span class="attr">&quot;score&quot;</span>: <span class="string">&quot;9.5&quot;</span>, <span class="attr">&quot;image&quot;</span>: <span class="string">&quot;https://p0.meituan.net/movie/283292171619cdfd5b240c8fd093f1eb255670.jpg&quot;</span>&#125;, ..., &#123;<span class="attr">&quot;index&quot;</span>: <span class="string">&quot;100&quot;</span>, <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;é¾™çŒ«&quot;</span>, <span class="attr">&quot;stars&quot;</span>: [<span class="string">&quot;ç§¦å²š&quot;</span>, <span class="string">&quot;ç³¸äº•é‡é‡Œ&quot;</span>, <span class="string">&quot;å²›æœ¬é¡»ç¾&quot;</span>], <span class="attr">&quot;otime&quot;</span>: <span class="string">&quot;2018-12-14&quot;</span>, <span class="attr">&quot;score&quot;</span>: <span class="string">&quot;9.2&quot;</span>, <span class="attr">&quot;image&quot;</span>: <span class="string">&quot;https://p0.meituan.net/movie/c304c687e287c7c2f9e22cf78257872d277201.jpg&quot;</span>&#125;]&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±æ¯”è¾ƒç†æƒ³äº†ã€‚</p><h3 id="å®Œæˆ"><a href="#å®Œæˆ" class="headerlink" title="å®Œæˆ"></a>å®Œæˆ</h3><p>è¯¥çˆ¬è™«é¡¹ç›®ç»“æŸäº†ã€‚<br>æ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¸»è¦ç”¨äº† <code>requests.get()</code> å®Œæˆè¯·æ±‚ï¼Œè¿˜ä¼ªé€ äº† <code>headers</code>ï¼›ç”¨ <code>re.findall()</code> æ­£åˆ™è§£æç»“æœï¼Œç„¶åè°ƒæ•´äº†ä¿¡æ¯çš„é¡ºåºï¼›ç”¨ <code>json</code> æ ¼å¼åŒ–ä¿å­˜ç»“æœã€‚</p><p>å…¶å®ï¼Œè¿™ä¸ªé¡¹ç›®åªè¦ç¨ä½œä¿®æ”¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨æ¥çˆ¬å–å…¶ä»–å¾ˆå¤šç§ç”µå½±æ’è¡Œæ¦œï¼Œå¦‚æˆ‘ä»¬å…¶å®è¿˜å®ç°äº†ä¸€ä¸ªçˆ¬å–è±†ç“£top250çš„ç¨‹åºï¼ŒçœŸçš„åªæ˜¯ç¨å¾®æ”¹åŠ¨ï¼Œéå¸¸å®¹æ˜“äº†ã€‚</p><p>æˆ‘ä»¬å±•ç°äº†è¿™ä¸ªé¡¹ç›®å¼€å‘çš„è¿‡ç¨‹ï¼Œä»ç›®æ ‡åˆ°æœ€åå®Œæˆï¼Œä¸€æ­¥ä¸€æ­¥è¿›è¡Œï¼Œè¿™ä¸ªå¼€å‘é¡ºåºé€‚ç”¨äºå¾ˆå¤šé¡¹ç›®ï¼Œå¹¶ä¸”å¯Œæœ‰å“²ç†ï¼Œæˆ‘ä»¬è®¤ä¸ºå€¼å¾—æ„Ÿæ‚Ÿä¸è·µè¡Œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Crawler </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crawler </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonä¹‹æ­£åˆ™è¡¨è¾¾å¼</title>
      <link href="/2019/02/13/PythonAndCrawler/crawler-4-re/"/>
      <url>/2019/02/13/PythonAndCrawler/crawler-4-re/</url>
      
        <content type="html"><![CDATA[<h1 id="çˆ¬è™«åŸºæœ¬åº“çš„ä½¿ç”¨ä¹‹RE"><a href="#çˆ¬è™«åŸºæœ¬åº“çš„ä½¿ç”¨ä¹‹RE" class="headerlink" title="çˆ¬è™«åŸºæœ¬åº“çš„ä½¿ç”¨ä¹‹RE"></a>çˆ¬è™«åŸºæœ¬åº“çš„ä½¿ç”¨ä¹‹RE</h1><blockquote><p>æœ¬æ–‡ä¸»è¦ä»‹ç» <strong>æ­£åˆ™è¡¨è¾¾å¼</strong> åŠ <strong>RE åº“</strong>ã€‚</p></blockquote><h2 id="æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a>æ­£åˆ™è¡¨è¾¾å¼</h2><p>æ­£åˆ™è¡¨è¾¾å¼æ˜¯ä¸€ç§å¤„ç†å­—ç¬¦ä¸²çš„å¼ºå¤§çš„å·¥å…·ï¼Œå®ƒæœ‰è‡ªå·±ç‰¹å®šçš„è¯­æ³•ç»“æ„ï¼Œå¯ä»¥é«˜æ•ˆåœ°å®ç°å­—ç¬¦ä¸²çš„æ£€ç´¢ã€æ›¿æ¢ã€åŒ¹é…éªŒè¯ç­‰æ“ä½œã€‚</p><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥æå– HTML ä¸­æˆ‘ä»¬æ„Ÿå…´è¶£çš„ä¿¡æ¯ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨ä½¿ç”¨ requests åº“çˆ¬å–çŸ¥ä¹å‘ç°ä¸­çš„é—®é¢˜æ—¶é‚£æ ·ã€‚</p><p>ä¸‹è¡¨ä¸º æ­£åˆ™è¡¨è¾¾å¼ çš„å¸¸ç”¨åŒ¹é…è§„åˆ™ï¼š</p><table><thead><tr><th>æ¨¡å¼</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>\w</code></td><td>åŒ¹é…å­—æ¯æ•°å­—åŠä¸‹åˆ’çº¿</td></tr><tr><td><code>\W</code></td><td>åŒ¹é…éå­—æ¯æ•°å­—åŠä¸‹åˆ’çº¿</td></tr><tr><td><code>\s</code></td><td>åŒ¹é…ä»»æ„ç©ºç™½å­—ç¬¦ï¼Œç­‰ä»·äº <code>[\t\n\r\f]</code></td></tr><tr><td><code>\S</code></td><td>åŒ¹é…ä»»æ„éç©ºå­—ç¬¦</td></tr><tr><td><code>\d</code></td><td>åŒ¹é…ä»»æ„æ•°å­—ï¼Œç­‰ä»·äº <code>[0-9]</code></td></tr><tr><td><code>\D</code></td><td>åŒ¹é…ä»»æ„éæ•°å­—</td></tr><tr><td><code>\A</code></td><td>åŒ¹é…å­—ç¬¦ä¸²å¼€å§‹</td></tr><tr><td><code>\Z</code></td><td>åŒ¹é…å­—ç¬¦ä¸²ç»“æŸï¼Œå¦‚æœæ˜¯å­˜åœ¨æ¢è¡Œï¼ŒåªåŒ¹é…åˆ°æ¢è¡Œå‰çš„ç»“æŸå­—ç¬¦ä¸²</td></tr><tr><td><code>\z</code></td><td>åŒ¹é…å­—ç¬¦ä¸²ç»“æŸ</td></tr><tr><td><code>\G</code></td><td>åŒ¹é…æœ€ååŒ¹é…å®Œæˆçš„ä½ç½®</td></tr><tr><td><code>\n</code></td><td>åŒ¹é…ä¸€ä¸ªæ¢è¡Œç¬¦</td></tr><tr><td><code>\t</code></td><td>åŒ¹é…ä¸€ä¸ªåˆ¶è¡¨ç¬¦</td></tr><tr><td><code>^</code></td><td>åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å¤´</td></tr><tr><td><code>$</code></td><td>åŒ¹é…å­—ç¬¦ä¸²çš„æœ«å°¾</td></tr><tr><td><code>.</code></td><td>åŒ¹é…ä»»æ„å­—ç¬¦ï¼Œé™¤äº†æ¢è¡Œç¬¦ï¼Œå½“ re.DOTALL æ ‡è®°è¢«æŒ‡å®šæ—¶ï¼Œåˆ™å¯ä»¥åŒ¹é…åŒ…æ‹¬æ¢è¡Œç¬¦çš„ä»»æ„å­—ç¬¦</td></tr><tr><td><code>[...]</code></td><td>ç”¨æ¥è¡¨ç¤ºä¸€ç»„å­—ç¬¦ï¼Œå•ç‹¬åˆ—å‡ºï¼š<code>[amk]</code> åŒ¹é… â€˜aâ€™ï¼Œâ€™mâ€™ æˆ– â€˜kâ€™</td></tr><tr><td><code>[^...]</code></td><td>ä¸åœ¨ [] ä¸­çš„å­—ç¬¦ï¼š<code>[^abc]</code> åŒ¹é…é™¤äº† a,b,c ä¹‹å¤–çš„å­—ç¬¦ã€‚</td></tr><tr><td><code>*</code></td><td>åŒ¹é… 0 ä¸ªæˆ–å¤šä¸ªçš„è¡¨è¾¾å¼ã€‚</td></tr><tr><td><code>+</code></td><td>åŒ¹é… 1 ä¸ªæˆ–å¤šä¸ªçš„è¡¨è¾¾å¼ã€‚</td></tr><tr><td><code>?</code></td><td>åŒ¹é… 0 ä¸ªæˆ– 1 ä¸ªç”±å‰é¢çš„æ­£åˆ™è¡¨è¾¾å¼å®šä¹‰çš„ç‰‡æ®µï¼Œéè´ªå©ªæ–¹å¼</td></tr><tr><td><code>&#123;n&#125;</code></td><td>ç²¾ç¡®åŒ¹é… n ä¸ªå‰é¢è¡¨è¾¾å¼ã€‚</td></tr><tr><td><code>&#123;n, m&#125;</code></td><td>åŒ¹é… n åˆ° m æ¬¡ç”±å‰é¢çš„æ­£åˆ™è¡¨è¾¾å¼å®šä¹‰çš„ç‰‡æ®µï¼Œè´ªå©ªæ–¹å¼</td></tr><tr><td>`a</td><td>b`</td></tr><tr><td><code>( )</code></td><td>åŒ¹é…æ‹¬å·å†…çš„è¡¨è¾¾å¼ï¼Œä¹Ÿè¡¨ç¤ºä¸€ä¸ªç»„</td></tr></tbody></table><p>âš ï¸ã€æ³¨æ„ã€‘è´ªå©ªåŒ¹é…ä¸‹ï¼Œ<code>.*</code> ä¼šåŒ¹é…å°½å¯èƒ½å¤šçš„å­—ç¬¦ï¼›éè´ªå©ªåŒ¹é…åˆ™å°½å¯èƒ½åŒ¹é…å°‘çš„å­—ç¬¦ã€‚<br>âš ï¸ã€æ³¨æ„ã€‘è½¬ä¹‰ï¼šå¦‚æœåœ¨æ­£åˆ™ä¸­æƒ³è¡¨ç°è¡¨ä¸­æœ‰çš„é‚£äº›ç¬¦å·ï¼Œæˆ‘ä»¬éœ€è¦è½¬ä¹‰ï¼Œå³ä½¿ç”¨ <code>\</code>+ ç¬¦å·ã€‚ä¾‹å¦‚è¦è¡¨ç°æ‹¬å·<code>(</code>ï¼Œæˆ‘ä»¬éœ€è¦å†™ <code>\(</code></p><p>ä¾‹å¦‚ï¼Œä¹‹å‰æˆ‘ä»¬æŠ“å–ã€ŒçŸ¥ä¹-å‘ç°ã€ä¸­çš„é—®é¢˜æ—¶ï¼Œä½¿ç”¨çš„æ˜¯å¦‚ä¸‹æ­£åˆ™è¡¨è¾¾å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explore-feed.*?question_link.*?&gt;(.*?)&lt;&#x2F;</span><br></pre></td></tr></table></figure><p>å®ƒå°±å¯ä»¥åŒ¹é…è¯·æ±‚åˆ°çš„ html ä¸­çš„ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;explore-feed feed-item&quot;</span> <span class="attr">data-offset</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;question_link&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/question/311635229/answer/...&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">data-id</span>=<span class="string">&quot;...&quot;</span> <span class="attr">data-za-element-name</span>=<span class="string">&quot;Title&quot;</span>&gt;</span></span><br><span class="line">......</span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="RE-åº“"><a href="#RE-åº“" class="headerlink" title="RE åº“"></a>RE åº“</h2><p>Python å†…ç½®çš„ <code>re</code> åº“æä¾›äº†å¯¹æ­£åˆ™è¡¨è¾¾å¼çš„æ”¯æŒã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æ¥äº†è§£ re åº“çš„ä½¿ç”¨ï¼š</p><h4 id="match"><a href="#match" class="headerlink" title="match()"></a><code>match()</code></h4><p>match() æ–¹æ³•ï¼Œéœ€è¦æˆ‘ä»¬ä¼ å…¥<em>è¦åŒ¹é…çš„å­—ç¬¦ä¸²</em>ä»¥åŠ<em>æ­£åˆ™è¡¨è¾¾å¼</em>ï¼Œæ¥æ£€æµ‹è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç¬¦åˆè¯¥æ­£åˆ™è¡¨è¾¾å¼ã€‚</p><p>match() æ–¹æ³•åˆ¤æ–­æ˜¯å¦åŒ¹é…ï¼Œå¦‚æœåŒ¹é…æˆåŠŸï¼Œè¿”å›ä¸€ä¸ªMatchå¯¹è±¡ï¼Œå¦åˆ™è¿”å›Noneã€‚</p><p>match() ä¼šä»ä¸€å¼€å§‹åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦å°±åŒ¹é…ä¸ä¸Šå»ï¼Œåˆ™å°±ä¸åŒ¹é…ã€‚</p><p>æˆ‘ä»¬å¸¸å¯ä»¥è¿™æ ·ç”¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">test = <span class="string">&#x27;å¾…æµ‹å­—ç¬¦ä¸²&#x27;</span></span><br><span class="line"><span class="keyword">if</span> re.match(<span class="string">r&#x27;æ­£åˆ™è¡¨è¾¾å¼&#x27;</span>, test):</span><br><span class="line">    print(<span class="string">&#x27;Match&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">&#x27;Failed&#x27;</span>)</span><br></pre></td></tr></table></figure><p>æå–åˆ†ç»„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>text = <span class="string">&#x27;abc 123&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(re.match(<span class="string">r&#x27;\s+\w\d&#x27;</span>, text))</span><br><span class="line"><span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = re.match(<span class="string">r&#x27;\w*? (\d&#123;3&#125;)&#x27;</span>, text)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r</span><br><span class="line">&lt;re.Match <span class="built_in">object</span>; span=(<span class="number">0</span>, <span class="number">7</span>), match=<span class="string">&#x27;abc 123&#x27;</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.group()</span><br><span class="line"><span class="string">&#x27;abc 123&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.group(<span class="number">0</span>)</span><br><span class="line"><span class="string">&#x27;abc 123&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.group(<span class="number">1</span>)</span><br><span class="line"><span class="string">&#x27;123&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>group()ã€group(0) ä¼šè¾“å‡ºå®Œæ•´çš„åŒ¹é…ç»“æœã€‚</li><li>group(1)ï¼Œä»¥åŠæ­¤ä¾‹ä¸­æ²¡æœ‰çš„group(2)ï¼Œgroup(3)â€¦ åˆ™ä¼šè¾“å‡ºç¬¬ä¸€ã€äºŒã€ä¸‰â€¦ä¸ªè¢« <code>()</code> åŒ…å›´çš„åŒ¹é…ç»“æœã€‚</li></ul><h4 id="ä¿®é¥°ç¬¦"><a href="#ä¿®é¥°ç¬¦" class="headerlink" title="ä¿®é¥°ç¬¦"></a>ä¿®é¥°ç¬¦</h4><table><thead><tr><th>ä¿®é¥°ç¬¦</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>re.I</code></td><td>ä½¿åŒ¹é…å¯¹å¤§å°å†™ä¸æ•æ„Ÿ</td></tr><tr><td><code>re.L</code></td><td>åšæœ¬åœ°åŒ–è¯†åˆ«ï¼ˆlocale-awareï¼‰åŒ¹é…</td></tr><tr><td><code>re.M</code></td><td>å¤šè¡ŒåŒ¹é…ï¼Œå½±å“ <code>^</code> å’Œ <code>$</code></td></tr><tr><td><code>re.S</code></td><td>ä½¿ <code>.</code> åŒ¹é…åŒ…æ‹¬æ¢è¡Œåœ¨å†…çš„æ‰€æœ‰å­—ç¬¦</td></tr><tr><td><code>re.U</code></td><td>æ ¹æ®Unicodeå­—ç¬¦é›†è§£æå­—ç¬¦ã€‚è¿™ä¸ªæ ‡å¿—å½±å“ <code>\w</code>, <code>\W</code>, <code>\b</code>, <code>\B</code>.</td></tr><tr><td><code>re.X</code></td><td>è¯¥æ ‡å¿—é€šè¿‡ç»™äºˆä½ æ›´çµæ´»çš„æ ¼å¼ä»¥ä¾¿ä½ å°†æ­£åˆ™è¡¨è¾¾å¼å†™å¾—æ›´æ˜“äºç†è§£ã€‚</td></tr></tbody></table><p>è¿™äº›ä¿®é¥°ç¬¦å¯ä»¥ä½œä¸º re.match çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ å…¥ï¼Œäº§ç”Ÿä¸Šé¢æè¿°ä¸­çš„æ•ˆæœã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result = re.match(<span class="string">&#x27;^He.*?(\d+).*?Demo$&#x27;</span>, content, re.S)</span><br></pre></td></tr></table></figure><h4 id="search"><a href="#search" class="headerlink" title="search()"></a><code>search()</code></h4><p>ä¸ match() ä¸åŒï¼Œsearch() åœ¨åŒ¹é…æ—¶ä¼šæ‰«ææ•´ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶åè¿”å›ç¬¬ä¸€ä¸ªæˆåŠŸåŒ¹é…çš„ç»“æœï¼Œå¦‚æœä¸€å¤„éƒ½æ²¡æœ‰ï¼Œåˆ™è¿”å› None.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = <span class="string">&#x27;\d+&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c = <span class="string">&#x27;asd123sss&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = re.search(p, c)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r</span><br><span class="line">&lt;re.Match <span class="built_in">object</span>; span=(<span class="number">3</span>, <span class="number">6</span>), match=<span class="string">&#x27;123&#x27;</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.group()</span><br><span class="line"><span class="string">&#x27;123&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="findall"><a href="#findall" class="headerlink" title="findall()"></a><code>findall()</code></h4><p><code>findall()</code> ä¼šæœç´¢æ•´ä¸ªå­—ç¬¦ä¸²ç„¶åè¿”å›åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„æ‰€æœ‰å†…å®¹ï¼Œè¿”å›çš„ç»“æœä¸ºä¸€ä¸ªlistã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> re</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = <span class="string">&#x27;\d+&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c = <span class="string">&#x27;asd123dfg456;;;789&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>re.findall(p, c)</span><br><span class="line">[<span class="string">&#x27;123&#x27;</span>, <span class="string">&#x27;456&#x27;</span>, <span class="string">&#x27;789&#x27;</span>]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Crawler </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crawler </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pythonè¯·æ±‚åº“requests</title>
      <link href="/2019/02/12/PythonAndCrawler/crawler-3-requests/"/>
      <url>/2019/02/12/PythonAndCrawler/crawler-3-requests/</url>
      
        <content type="html"><![CDATA[<h1 id="çˆ¬è™«è¯·æ±‚åº“çš„ä½¿ç”¨ä¹‹Requests"><a href="#çˆ¬è™«è¯·æ±‚åº“çš„ä½¿ç”¨ä¹‹Requests" class="headerlink" title="çˆ¬è™«è¯·æ±‚åº“çš„ä½¿ç”¨ä¹‹Requests"></a>çˆ¬è™«è¯·æ±‚åº“çš„ä½¿ç”¨ä¹‹Requests</h1><blockquote><p>æœ¬æ–‡ä¸»è¦ä»‹ç» <strong>Requests åº“</strong>ã€‚</p></blockquote><h2 id="requests"><a href="#requests" class="headerlink" title="requests"></a>requests</h2><p>ç›¸è¾ƒäº Python å†…ç½®çš„ Urllibï¼Œç¬¬ä¸‰æ–¹åº“ Requests ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ›´åŠ ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚<br>å¾—ç›Šäº <code>requests</code> çš„å¼ºå¤§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è§£å†³ Cookiesã€ç™»å½•éªŒè¯ã€ä»£ç†è®¾ç½® ç­‰é—®é¢˜æ—¶æ›´åŠ æ–¹ä¾¿å¿«æ·ï¼Œè€Œæ— éœ€å†ç¢ç£¨ Urllib çš„ Openerã€Handlerã€‚</p><h3 id="requests-get-â€”â€”-GETè¯·æ±‚"><a href="#requests-get-â€”â€”-GETè¯·æ±‚" class="headerlink" title="requests.get() â€”â€” GETè¯·æ±‚"></a>requests.get() â€”â€” GETè¯·æ±‚</h3><p>ä½¿ç”¨ <code>requests.get(url, *params=&#123;&#125;, headers=&#123;&#125;, timeout=None)</code> å¯ä»¥å®Œæˆ GET è¯·æ±‚ï¼Œè¿”å› response çš„å„ç§å†…å®¹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">&#x27;http://httpbin.org/get&#x27;</span>)</span><br><span class="line">print(r.text)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;status_code: &#x27;</span>, <span class="built_in">type</span>(r.status_code), r.status_code)</span><br><span class="line">print(<span class="string">&#x27;headers: &#x27;</span>, <span class="built_in">type</span>(r.headers), r.headers)</span><br><span class="line">print(<span class="string">&#x27;cookies: &#x27;</span>, <span class="built_in">type</span>(r.cookies), r.cookies)</span><br><span class="line">print(<span class="string">&#x27;url: &#x27;</span>, <span class="built_in">type</span>(r.url), r.url)</span><br><span class="line">print(<span class="string">&#x27;history: &#x27;</span>, <span class="built_in">type</span>(r.history), r.history)</span><br></pre></td></tr></table></figure><p>status_code å±æ€§å¾—åˆ°çŠ¶æ€ç ï¼Œ headers å±æ€§å¾—åˆ° Response Headersï¼Œcookies å±æ€§å¾—åˆ° Cookiesï¼Œurl å±æ€§å¾—åˆ° URLï¼Œhistory å±æ€§å¾—åˆ°è¯·æ±‚å†å²ã€‚</p><p>ä½¿ç”¨ <code>params=&#123;&#125;</code> ï¼Œå°±ç­‰äºåœ¨urlä¸­æ·»åŠ äº† <code>&#39;?xxx&amp;xxx&#39;</code> çš„ä¿¡æ¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;germey&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;age&#x27;</span>: <span class="number">22</span></span><br><span class="line">&#125;</span><br><span class="line">r = requests.get(<span class="string">&quot;http://httpbin.org/get&quot;</span>, params=data)    <span class="comment"># ç›¸å½“äº GETè¯·æ±‚ â€˜http://httpbin.org/get?name=germey&amp;age=22â€™</span></span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿”å›çš„ r.text å®é™…ä¸Šæ˜¯ JSON çš„å­—ç¬¦ä¸²ï¼Œrequests æä¾›äº† ä¸€ä¸ª <code>Response.json()</code> å¯ä»¥ç›´æ¥æŠŠ JSON è§£ææˆ dictï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  æ‰¿æ¥ä¸Šä¸€ä»£ç å—</span></span><br><span class="line">d = r.json()</span><br><span class="line">print(<span class="built_in">type</span>(d), d, sep=<span class="string">&#x27;\n&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è‹¥è¿”å›ç»“æœä¸æ˜¯ Json æ ¼å¼ï¼Œè°ƒç”¨ <code>Response.json()</code>ï¼Œä¼šæŠ›å‡º <a href="https://www.zhihu.com/explorejson.decoder.JSONDecodeError">https://www.zhihu.com/explorejson.decoder.JSONDecodeError</a> çš„å¼‚å¸¸ã€‚</p><p>æˆ‘ä»¬è¿˜å¯ä»¥åœ¨è°ƒç”¨ requests.get() çš„æ—¶å€™ä¼ å…¥ä¸€ä¸ª dict ä½œä¸º headersï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">&#x27;http://httpbin.org/get&#x27;</span>, headers=headers)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜å¯ä»¥è®¾ç½®è¶…æ—¶ï¼Œæœ‰ä¸‰ç§æ–¹æ³•ï¼š</p><ul><li><code>r = requests.get(&#39;https://www.taobao.com&#39;, timeout=None)</code>ï¼Œconnect å’Œ read äºŒè€…éƒ½æ˜¯ æ°¸ä¹…ç­‰å¾…ï¼Œè¿™æ˜¯é»˜è®¤è®¾ç½®</li><li><code>r = requests.get(&#39;https://www.taobao.com&#39;, timeout=1)</code>ï¼Œconnect å’Œ read äºŒè€…çš„ timeout æ€»å’Œè®¾ç½®ä¸º 1 ç§’</li><li><code>r = requests.get(&#39;https://www.taobao.com&#39;, timeout=(5, 11))</code>ï¼Œconnect 5ç§’ï¼Œread 11ç§’</li></ul><h3 id="è·å–äºŒè¿›åˆ¶æ•°æ®"><a href="#è·å–äºŒè¿›åˆ¶æ•°æ®" class="headerlink" title="è·å–äºŒè¿›åˆ¶æ•°æ®"></a>è·å–äºŒè¿›åˆ¶æ•°æ®</h3><p>å½“æˆ‘ä»¬è·å–å¾—äºŒè¿›åˆ¶çš„æ•°æ®æ—¶ï¼ŒResponse.text æ˜¾ç„¶æ˜¯ä¸å¥½ç”¨äº†ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>Response.content</code> å–å¾—äºŒè¿›åˆ¶æ•°æ®ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">&quot;https://github.com/favicon.ico&quot;</span>)</span><br><span class="line"></span><br><span class="line">print(r.text)       <span class="comment"># è¾“å‡ºä¹±ç </span></span><br><span class="line">print(r.content)    <span class="comment"># è¾“å‡ºåå…­è¿›åˆ¶ç çš„bytesï¼ˆb&#x27;\x..\x........&#x27;ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;favicon.ico&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:        <span class="comment"># ä¿å­˜åˆ°æ–‡ä»¶</span></span><br><span class="line">    f.write(r.content)</span><br></pre></td></tr></table></figure><h3 id="æŠ“å–ç½‘é¡µ"><a href="#æŠ“å–ç½‘é¡µ" class="headerlink" title="æŠ“å–ç½‘é¡µ"></a>æŠ“å–ç½‘é¡µ</h3><p>æˆ‘ä»¬æ¥åšä¸€ä¸ªç®€å•çš„çˆ¬è™«å®è·µâ€”â€”â€”â€”çˆ¬å– <a href="https://www.zhihu.com/explore">çŸ¥ä¹-å‘ç°</a> é‡Œçš„é—®é¢˜ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="comment"># çŸ¥ä¹-å‘ç°çš„url</span></span><br><span class="line">url = <span class="string">&#x27;https://www.zhihu.com/explore&#x27;</span></span><br><span class="line"><span class="comment"># åŒ¹é…é—®é¢˜çš„æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line">pattern = re.<span class="built_in">compile</span>(<span class="string">&#x27;explore-feed.*?question_link.*?&gt;(.*?)&lt;/&#x27;</span>, re.S)       <span class="comment"># *ï¼Ÿè¡¨ç¤ºæƒ°æ€§åŒ¹é…</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = requests.get(url, headers=headers)</span><br><span class="line">    questions = re.findall(pattern, response.text)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> questions:</span><br><span class="line">        print(i)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    print(e)</span><br></pre></td></tr></table></figure><h3 id="requests-post-â€”â€”-POSTè¯·æ±‚"><a href="#requests-post-â€”â€”-POSTè¯·æ±‚" class="headerlink" title="requests.post() â€”â€” POSTè¯·æ±‚"></a>requests.post() â€”â€” POSTè¯·æ±‚</h3><p>ç”¨ <code>requests.post(url, data=&#123;&#125;)</code> æˆ‘ä»¬å°±å¯ä»¥ POST è¯·æ±‚ï¼Œè¿™å’Œä½¿ç”¨ requests.get() éå¸¸ç±»ä¼¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">data = &#123;<span class="string">&#x27;Data&#x27;</span>: <span class="string">&#x27;Hello, world!&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">r = requests.post(<span class="string">&#x27;http://httpbin.org/post&#x27;</span>, data=data)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åŒæ ·å¯ä»¥ä» Response ä¸­è·å–å„ç§æ•°æ®ï¼Œä¾‹å¦‚ï¼šstatus_code å±æ€§å¾—åˆ°çŠ¶æ€ç ï¼Œ headers å±æ€§å¾—åˆ° Response Headersï¼Œcookies å±æ€§å¾—åˆ° Cookiesï¼Œurl å±æ€§å¾—åˆ° URLï¼Œhistory å±æ€§å¾—åˆ°è¯·æ±‚å†å²ã€‚</p><h3 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ POSTè¯·æ±‚ æ¥å®Œæˆæ–‡ä»¶çš„ä¸Šä¼ ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">files = &#123;<span class="string">&#x27;file&#x27;</span>: <span class="built_in">open</span>(<span class="string">&#x27;favicon.ico&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>)&#125;</span><br><span class="line">r = requests.post(<span class="string">&#x27;http://httpbin.org/post&#x27;</span>, files=files)</span><br><span class="line"></span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><h3 id="Cookies"><a href="#Cookies" class="headerlink" title="Cookies"></a>Cookies</h3><h4 id="è·å–Cookies"><a href="#è·å–Cookies" class="headerlink" title="è·å–Cookies"></a>è·å–Cookies</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">&#x27;https://www.baidu.com&#x27;</span>)</span><br><span class="line">print(r.cookies)</span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> r.cookies.items():</span><br><span class="line">    print(key + <span class="string">&#x27;=&#x27;</span> + value)</span><br></pre></td></tr></table></figure><h4 id="è°ƒç”¨Cookies"><a href="#è°ƒç”¨Cookies" class="headerlink" title="è°ƒç”¨Cookies"></a>è°ƒç”¨Cookies</h4><p>æˆ‘ä»¬å…ˆç™»å½•ä¸€ä¸ªç½‘ç«™ï¼Œç„¶åä»è®°å½•ä¸‹Cookiesï¼Œåœ¨å¦ä¸€æ¬¡ç™»å½•ä¸­ï¼ŒæŠŠè¿™ä¸ªCookiesä¼ ä¸Šå»ï¼Œå°±å¯ä»¥ç»´æŒç™»å½•ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬ç°åœ¨ç”¨æµè§ˆå™¨ç™»å½•ã€Œç™¾åº¦ã€ï¼Œç„¶åæ‰“å¼€ä¸€æ¬¡ç™¾åº¦é¦–é¡µï¼Œæˆ‘ä»¬æ£€æŸ¥ <code>www.baidu.com</code> çš„ Request Headersï¼Œæˆ‘ä»¬ä¼šå‘ç°ä¸€é¡¹ <code>Cookies</code>ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªå€¼å¤åˆ¶ä¸‹æ¥ï¼Œè®©çˆ¬è™«ä¼ªé€  headersï¼Œå¸¦ä¸Šè¿™ä¸ª Cookiesï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¨¡æ‹Ÿç™»å½•äº†:)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://www.baidu.com&#x27;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Cookie&#x27;</span>: <span class="string">&#x27;BDORZ******3254&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Connection&#x27;</span>: <span class="string">&#x27;keep-alive&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Host&#x27;</span>: <span class="string">&#x27;www.baidu.com&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">r = requests.get(url, headers=headers)</span><br><span class="line"></span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><p>ä»ç»“æœä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è‡ªå·±çš„åå­—ï¼Œè¯´æ˜æˆåŠŸæ¨¡ä»¿ç™»å½•ï¼</p><p>ä¹Ÿå¯ä»¥è¿™æ ·ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">cookies = <span class="string">&#x27;q_c1=316******3b0&#x27;</span></span><br><span class="line">jar = requests.cookies.RequestsCookieJar()</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Host&#x27;</span>: <span class="string">&#x27;www.zhihu.com&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> cookie <span class="keyword">in</span> cookies.split(<span class="string">&#x27;;&#x27;</span>):</span><br><span class="line">    key, value = cookie.split(<span class="string">&#x27;=&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">    jar.<span class="built_in">set</span>(key, value)</span><br><span class="line">    </span><br><span class="line">r = requests.get(<span class="string">&#x27;http://www.zhihu.com&#x27;</span>, cookies=jar, headers=headers)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><h4 id="ä¼šè¯ç»´æŒ"><a href="#ä¼šè¯ç»´æŒ" class="headerlink" title="ä¼šè¯ç»´æŒ"></a>ä¼šè¯ç»´æŒ</h4><p>åœ¨ Requests ä¸­ï¼Œæˆ‘ä»¬å¦‚æœç›´æ¥åˆ©ç”¨ get() æˆ– post() ç­‰æ–¹æ³•çš„ç¡®å¯ä»¥åšåˆ°æ¨¡æ‹Ÿç½‘é¡µçš„è¯·æ±‚ã€‚<br>ä½†æ˜¯è¿™å®é™…ä¸Šæ˜¯ç›¸å½“äºä¸åŒçš„ä¼šè¯ï¼Œå³ä¸åŒçš„ Sessionï¼Œä¹Ÿå°±æ˜¯è¯´<strong>æ¯è¯·æ±‚ä¸€æ¬¡</strong>éƒ½ç›¸å½“äºç”¨<strong>ä¸åŒæµè§ˆå™¨æ‰“å¼€</strong>ï¼Œä¼šè¯ä¸ä¼šç»´æŒã€‚<br>ä½†æˆ‘ä»¬å¸¸éœ€è¦æ¨¡æ‹Ÿåœ¨ä¸€ä¸ªæµè§ˆå™¨ä¸­æ‰“å¼€åŒä¸€ç«™ç‚¹çš„ä¸åŒé¡µé¢ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬è¿›è¡Œä¼šè¯ç»´æŒã€‚</p><h6 id="ä¸ä½¿ç”¨ä¼šè¯ç»´æŒ"><a href="#ä¸ä½¿ç”¨ä¼šè¯ç»´æŒ" class="headerlink" title="ä¸ä½¿ç”¨ä¼šè¯ç»´æŒ"></a>ä¸ä½¿ç”¨ä¼šè¯ç»´æŒ</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">requests.get(<span class="string">&#x27;http://httpbin.org/cookies/set/number/123456789&#x27;</span>)     <span class="comment"># ä¸€æ¬¡ä¼šè¯</span></span><br><span class="line">r = requests.get(<span class="string">&#x27;http://httpbin.org/cookies&#x27;</span>)      <span class="comment"># å¦ä¸€æ¬¡ä¼šè¯</span></span><br><span class="line">print(r.text)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;(result)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;cookies&quot;: &#123;&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¾—åˆ°çš„ç»“æœæ˜¯ç©ºçš„ï¼Œè¯´æ˜ä¸¤æ¬¡getä¸æ˜¯åŒä¸€ä¼šè¯äº†ã€‚</p><h6 id="ä½¿ç”¨ä¼šè¯ç»´æŒ"><a href="#ä½¿ç”¨ä¼šè¯ç»´æŒ" class="headerlink" title="ä½¿ç”¨ä¼šè¯ç»´æŒ"></a>ä½¿ç”¨ä¼šè¯ç»´æŒ</h6><p>ä½¿ç”¨ä¼šè¯ç»´æŒæœ€ç›´æ¥çš„åŠæ³•å°±æ˜¯æˆ‘ä»¬å¯ä»¥è·å–ä¸Šä¸€æ¬¡çš„ Cookiesï¼Œä¸‹ä¸€æ¬¡è¯·æ±‚æ—¶æŠŠå®ƒä¼ ä¸Šå»ï¼Œä½†è¿™æ ·åšè¿‡äºç¹çï¼Œrequests ä¸ºæˆ‘ä»¬æä¾›äº†æ›´åŠ ç®€æ´ã€ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆ â€”â€” <code>requests.Session</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">s = requests.Session()      <span class="comment"># å¼€å¯ä¸€ä¸ªæ–°ä¼šè¯ s</span></span><br><span class="line">s.get(<span class="string">&#x27;http://httpbin.org/cookies/set/number/123456789&#x27;</span>)    <span class="comment"># ä¼šè¯ s</span></span><br><span class="line">r = s.get(<span class="string">&#x27;http://httpbin.org/cookies&#x27;</span>)     <span class="comment"># åŒæ ·è¿˜æ˜¯ä¼šè¯ s</span></span><br><span class="line">print(r.text)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;(result)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;cookies&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;number&quot;: &quot;123456789&quot;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬å°±ç»´æŒäº†ä¼šè¯äº†ã€‚</p><h4 id="SSL-è¯ä¹¦éªŒè¯"><a href="#SSL-è¯ä¹¦éªŒè¯" class="headerlink" title="SSL è¯ä¹¦éªŒè¯"></a>SSL è¯ä¹¦éªŒè¯</h4><p>Requests æä¾›äº†è¯ä¹¦éªŒè¯çš„åŠŸèƒ½ï¼Œå½“å‘é€ HTTP è¯·æ±‚çš„æ—¶å€™ï¼Œå®ƒä¼šæ£€æŸ¥ SSL è¯ä¹¦ï¼ˆé’ˆå¯¹httpsï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>verify</code> å‚æ•°æ¥æ§åˆ¶æ˜¯å¦æ£€æŸ¥æ­¤è¯ä¹¦ï¼Œç¼ºçœå€¼æ˜¯ Trueï¼Œä¼šè‡ªåŠ¨éªŒè¯ã€‚<br>å¦‚æœæˆ‘ä»¬ä¸éœ€è¦æ£€æŸ¥è¯ä¹¦ï¼Œå¯ä»¥è®© <code>verify=False</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">&#x27;https://www.12306.cn&#x27;</span>, verify=<span class="literal">False</span>)</span><br><span class="line">print(response.status_code)</span><br></pre></td></tr></table></figure><p>æŒ‡å®šæœ¬åœ°è¯ä¹¦ç”¨ä½œå®¢æˆ·ç«¯è¯ä¹¦:</p><p>å®¢æˆ·ç«¯è¯ä¹¦å¯ä»¥æ˜¯å•ä¸ªæ–‡ä»¶ï¼ˆåŒ…å«å¯†é’¥å’Œè¯ä¹¦ï¼‰æˆ–ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªæ–‡ä»¶è·¯å¾„çš„å…ƒç»„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">&#x27;https://www.12306.cn&#x27;</span>, cert=(<span class="string">&#x27;/path/server.crt&#x27;</span>, <span class="string">&#x27;/path/key&#x27;</span>))</span><br><span class="line">print(response.status_code)</span><br></pre></td></tr></table></figure><p>âš ï¸ã€æ³¨æ„ã€‘æœ¬åœ°ç§æœ‰è¯ä¹¦çš„ key å¿…é¡»è¦æ˜¯è§£å¯†çŠ¶æ€ï¼ŒåŠ å¯†çŠ¶æ€çš„ key æ˜¯ä¸æ”¯æŒçš„ã€‚</p><h4 id="ä»£ç†è®¾ç½®"><a href="#ä»£ç†è®¾ç½®" class="headerlink" title="ä»£ç†è®¾ç½®"></a>ä»£ç†è®¾ç½®</h4><p>æ‰¾ä¸€ä¸ª<a href="https://www.xicidaili.com/nn/">å…è´¹çš„ä»£ç†æœåŠ¡å™¨</a>ï¼Œç„¶åç”¨è¿™ä¸ªæœåŠ¡å™¨æ¥ä»£ç†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;zh-cn&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Accept-Encoding&#x27;</span>: <span class="string">&#x27;br, gzip, deflate&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">        <span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://110.52.235.57:9999&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;https&#x27;</span>: <span class="string">&#x27;https://110.52.235.57:9999&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">&#x27;http://www.taobao.com&#x27;</span>, proxies=proxies, headers=headers)</span><br><span class="line"></span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œè‹¥ä½¿ç”¨éå…è´¹çš„ä»£ç†ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ HTTP Basic Authï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼ <a href="http://user:password@host:port">http://user:password@host:port</a> è¿™æ ·çš„è¯­æ³•æ¥è®¾ç½®ä»£ç†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">&#x27;https&#x27;</span>: <span class="string">&#x27;http://user:password@10.10.1.10:3128/&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line">requests.get(<span class="string">&#x27;https://www.taobao.com&#x27;</span>, proxies=proxies)</span><br></pre></td></tr></table></figure><p>Requests è¿˜æ”¯æŒ SOCKS åè®®çš„ä»£ç†:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip3 install <span class="string">&quot;requests[socks]&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;socks5://user:password@host:port&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https&#x27;</span>: <span class="string">&#x27;socks5://user:password@host:port&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">requests.get(<span class="string">&#x27;https://www.taobao.com&#x27;</span>, proxies=proxies)</span><br></pre></td></tr></table></figure><h4 id="HTTP-åŸºæœ¬è®¤è¯"><a href="#HTTP-åŸºæœ¬è®¤è¯" class="headerlink" title="HTTP åŸºæœ¬è®¤è¯"></a>HTTP åŸºæœ¬è®¤è¯</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.auth <span class="keyword">import</span> HTTPBasicAuth</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">&#x27;http://pythonscraping.com/pages/auth/login.php&#x27;</span>, auth=HTTPBasicAuth(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;password&#x27;</span>))</span><br><span class="line">print(r.status_code)</span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥æ›´ç®€å•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">&#x27;http://pythonscraping.com/pages/auth/login.php&#x27;</span>, auth=(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;password&#x27;</span>))</span><br><span class="line">print(r.status_code)</span><br></pre></td></tr></table></figure><p>Requests è¿˜æ”¯æŒå…¶ä»–çš„è®¤è¯ï¼Œå¦‚ OAuthã€‚å…³äºè¿™æ–¹é¢ï¼Œå¯ä»¥æŸ¥çœ‹ <a href="https://requests-oauthlib.readthedocs.io/en/latest/">æ–‡æ¡£</a> ã€‚</p><h4 id="Prepared-Request"><a href="#Prepared-Request" class="headerlink" title="Prepared Request"></a>Prepared Request</h4><p>ç±»ä¼¼äº Urllib ä¸­çš„ Request ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Requests ä¸­ä½¿ç”¨ Prepared Request æ¥è¡¨ç¤ºä¸€ä¸ªè¯·æ±‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> Request, Session</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://httpbin.org/post&#x27;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;germey&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">s = Session()</span><br><span class="line">req = Request(<span class="string">&#x27;POST&#x27;</span>, url, data=data, headers=headers)</span><br><span class="line">prepped = s.prepare_request(req)</span><br><span class="line">r = s.send(prepped)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬å¼•å…¥äº† Requestï¼Œç„¶åç”¨ urlã€dataã€headers å‚æ•°æ„é€ äº†ä¸€ä¸ª Request å¯¹è±¡ï¼Œè¿™æ—¶æˆ‘ä»¬éœ€è¦å†è°ƒç”¨ Session çš„ prepare_request() æ–¹æ³•å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ª Prepared Request å¯¹è±¡ï¼Œç„¶åè°ƒç”¨ send() æ–¹æ³•å‘é€å³å¯</p><p>é€šè¿‡ Request å¯¹è±¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†ä¸€ä¸ªä¸ªè¯·æ±‚å½“åšä¸€ä¸ªç‹¬ç«‹çš„å¯¹è±¡æ¥çœ‹å¾…ï¼Œè¿™å¯ä»¥æ–¹ä¾¿è°ƒåº¦ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Crawler </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crawler </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pythonè¯·æ±‚åº“urllib</title>
      <link href="/2019/02/11/PythonAndCrawler/crawler-2-urllib/"/>
      <url>/2019/02/11/PythonAndCrawler/crawler-2-urllib/</url>
      
        <content type="html"><![CDATA[<h1 id="çˆ¬è™«è¯·æ±‚åº“çš„ä½¿ç”¨ä¹‹Urllib"><a href="#çˆ¬è™«è¯·æ±‚åº“çš„ä½¿ç”¨ä¹‹Urllib" class="headerlink" title="çˆ¬è™«è¯·æ±‚åº“çš„ä½¿ç”¨ä¹‹Urllib"></a>çˆ¬è™«è¯·æ±‚åº“çš„ä½¿ç”¨ä¹‹Urllib</h1><blockquote><p>æœ¬æ–‡ä¸»è¦ä»‹ç» <strong>Urllib åº“</strong>ã€‚</p></blockquote><h2 id="urllib"><a href="#urllib" class="headerlink" title="urllib"></a>urllib</h2><p><code>urllib</code> æ˜¯ Python å†…ç½®çš„ HTTP è¯·æ±‚åº“ã€‚</p><p>urllib æœ‰ requestï¼Œerrorï¼Œparseï¼Œrobotparser å››ä¸ªæ¨¡å—ã€‚</p><h3 id="urllib-request-å‘é€è¯·æ±‚"><a href="#urllib-request-å‘é€è¯·æ±‚" class="headerlink" title="urllib.request å‘é€è¯·æ±‚"></a>urllib.request å‘é€è¯·æ±‚</h3><h4 id="urlopen-å‘é€è¯·æ±‚"><a href="#urlopen-å‘é€è¯·æ±‚" class="headerlink" title="urlopen(): å‘é€è¯·æ±‚"></a><code>urlopen()</code>: å‘é€è¯·æ±‚</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·å– python å®˜ç½‘ HTML æºç </span></span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">response = urllib.request.urlopen(<span class="string">&#x27;https://www.python.org&#x27;</span>)</span><br><span class="line"></span><br><span class="line">print(response.read().decode(<span class="string">&#x27;utf-8&#x27;</span>))  <span class="comment"># æŸ¥çœ‹responseå†…å®¹</span></span><br><span class="line">print(<span class="built_in">type</span>(response))                   <span class="comment"># æŸ¥çœ‹responseç±»å‹</span></span><br><span class="line">print(response.status)                  <span class="comment"># æŸ¥çœ‹responseçŠ¶æ€ç </span></span><br><span class="line">print(response.getheaders())            <span class="comment"># æŸ¥çœ‹å“åº”å¤´</span></span><br><span class="line">print(response.getheader(<span class="string">&#x27;Server&#x27;</span>))     <span class="comment"># æŸ¥çœ‹ç‰¹å®šçš„å“åº”å¤´é¡¹</span></span><br></pre></td></tr></table></figure><p><code>urllib.request.urlopen(url, data=None, [timeout, ]*, cafile=None, capath=None, cadefault=False, context=None)</code></p><h5 id="urlopen-å¸¦-data-å‚æ•°-ç”¨-POST-å‘é€ä¸€äº›æ•°æ®"><a href="#urlopen-å¸¦-data-å‚æ•°-ç”¨-POST-å‘é€ä¸€äº›æ•°æ®" class="headerlink" title="urlopen() å¸¦ data å‚æ•°: ç”¨ POST å‘é€ä¸€äº›æ•°æ®"></a><code>urlopen()</code> å¸¦ <code>data</code> å‚æ•°: ç”¨ POST å‘é€ä¸€äº›æ•°æ®</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">data = <span class="built_in">bytes</span>(</span><br><span class="line">    urllib.parse.urlencode(&#123;<span class="string">&#x27;Hello&#x27;</span>: <span class="string">&#x27;World&#x27;</span>&#125;),</span><br><span class="line">    encoding=<span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">    )</span><br><span class="line">response = urllib.request.urlopen(<span class="string">&#x27;http://httpbin.org/post&#x27;</span>, data=data)</span><br><span class="line">print(response.read().decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure><h5 id="urlopen-å¸¦-timeout-å‚æ•°-å¦‚æœè¯·æ±‚è¶…å‡ºäº†è®¾ç½®çš„è¿™ä¸ªæ—¶é—´ï¼Œè¿˜æ²¡æœ‰å¾—åˆ°å“åº”ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚"><a href="#urlopen-å¸¦-timeout-å‚æ•°-å¦‚æœè¯·æ±‚è¶…å‡ºäº†è®¾ç½®çš„è¿™ä¸ªæ—¶é—´ï¼Œè¿˜æ²¡æœ‰å¾—åˆ°å“åº”ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚" class="headerlink" title="urlopen() å¸¦ timeout å‚æ•°: å¦‚æœè¯·æ±‚è¶…å‡ºäº†è®¾ç½®çš„è¿™ä¸ªæ—¶é—´ï¼Œè¿˜æ²¡æœ‰å¾—åˆ°å“åº”ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚"></a><code>urlopen()</code> å¸¦ <code>timeout</code> å‚æ•°: å¦‚æœè¯·æ±‚è¶…å‡ºäº†è®¾ç½®çš„è¿™ä¸ªæ—¶é—´ï¼Œè¿˜æ²¡æœ‰å¾—åˆ°å“åº”ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</h5><p>è®¾ç½®<code>timeout=Sec</code>ï¼ŒSce ä¸ºè¶…æ—¶çš„ç§’æ•°ï¼ˆå¯ä»¥ä¸ºå°æ•°ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = urllib.request.urlopen(<span class="string">&#x27;http://httpbin.org/get&#x27;</span>, timeout=<span class="number">0.1</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    print(e)</span><br><span class="line">        </span><br><span class="line">print(response.read().decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure><h4 id="Request-ç±»æ„å»º-Headers"><a href="#Request-ç±»æ„å»º-Headers" class="headerlink" title="Request ç±»æ„å»º Headers"></a>Request ç±»æ„å»º Headers</h4><p>åˆ©ç”¨æ›´å¼ºå¤§çš„ Requestç±»æ¥æ„å»ºä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">request = urllib.request.Request(<span class="string">&#x27;http://python.org&#x27;</span>)</span><br><span class="line">response = urllib.request.urlopen(request)</span><br><span class="line">print(response.read().decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure><h5 id="Requestç±»-çš„æ„å»ºå‚æ•°"><a href="#Requestç±»-çš„æ„å»ºå‚æ•°" class="headerlink" title="Requestç±» çš„æ„å»ºå‚æ•°"></a>Requestç±» çš„æ„å»ºå‚æ•°</h5><p><code>class urllib.request.Request(ur1, data=None, headers=&#123;&#125;,origin_req_host=None, unverifiable=False, method=None)</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request, parse</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://httpbin.org/post&#x27;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Host&#x27;</span>: <span class="string">&#x27;httpbin.org&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">dic = &#123;</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;CDFMLR&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">data = <span class="built_in">bytes</span>(parse.urlencode(dic), encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">req = request.Request(url=url, data=data, headers=headers, method=<span class="string">&#x27;POST&#x27;</span>)</span><br><span class="line">response = request.urlopen(req)</span><br><span class="line">print(response.read().decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure><h4 id="é«˜çº§ç”¨æ³•"><a href="#é«˜çº§ç”¨æ³•" class="headerlink" title="é«˜çº§ç”¨æ³•"></a>é«˜çº§ç”¨æ³•</h4><h5 id="Handler"><a href="#Handler" class="headerlink" title="Handler"></a>Handler</h5><p>Handler åŒ…å« å„ç§å¤„ç†å™¨ï¼Œæœ‰ä¸“é—¨å¤„ç†ç™»å½•éªŒè¯çš„ï¼Œæœ‰å¤„ç† Cookies çš„ï¼Œæœ‰å¤„ç†ä»£ç†è®¾ç½®çš„â€¦</p><p>urllib.request æ¨¡å—é‡Œçš„ <code>BaseHandler</code> ç±»æ˜¯æ‰€æœ‰å…¶ä»– Handler çš„çˆ¶ç±»ï¼Œå®ƒæä¾›æœ€åŸºæœ¬çš„æ–¹æ³•ã€‚</p><p>å…¶ä»–çš„ Handler è¯¦è§ <a href="https://docs.python.org/3/library/urllib.request.html#urllib.request.BaseHandler">Handler</a></p><h5 id="Opener"><a href="#Opener" class="headerlink" title="Opener"></a>Opener</h5><p>ä¹‹å‰ç”¨è¿‡ urlopen()æ–¹æ³•ï¼Œå®é™…ä¸Šå°±æ˜¯ urllib æä¾›çš„ä¸€ä¸ª Openerã€‚ </p><p>urlopen() ç›¸å½“äºç±»åº“å°è£…å¥½äº†æå…¶å¸¸ç”¨çš„è¯·æ±‚æ–¹æ³•ï¼Œåˆ©ç”¨å®ƒå¯ä»¥å®ŒæˆåŸºæœ¬çš„è¯·æ±‚ï¼Œä½†å¦‚æœéœ€è¦å®ç°æ›´é«˜çº§çš„åŠŸèƒ½ï¼Œå°±éœ€è¦æ·±å…¥ä¸€å±‚è¿›è¡Œé…ç½®ï¼Œä½¿ç”¨æ›´åº•å±‚çš„å®ä¾‹æ¥å®Œæˆæ“ä½œï¼Œå°±ç”¨åˆ°äº† Openerã€‚ </p><p>Opener å¯ä»¥ä½¿ç”¨ open()æ–¹æ³•ï¼Œè¿”å›çš„ç±»å‹å’Œ urlopen()å¦‚å‡ºä¸€è¾™ã€‚ </p><p>æˆ‘ä»¬éœ€è¦åˆ©ç”¨ Handleræ¥æ„å»º Openerã€‚ </p><hr><p>ï¼ˆä»¥ä¸‹æ˜¯å‡ ä¸ª Hander &amp; Opener çš„åº”ç”¨ï¼‰</p><h5 id="å¤„ç†-HTTP-åŸºæœ¬è®¤è¯"><a href="#å¤„ç†-HTTP-åŸºæœ¬è®¤è¯" class="headerlink" title="å¤„ç† HTTP åŸºæœ¬è®¤è¯"></a>å¤„ç† <code>HTTP åŸºæœ¬è®¤è¯</code></h5><p><code>HTTPåŸºæœ¬è®¤è¯</code>ï¼š</p><blockquote><p>æœ‰ä¸€ç§ web ç™»å½•æ–¹å¼ä¸æ˜¯é€šè¿‡ <code>cookie</code>ï¼Œè€Œæ˜¯æŠŠ <code>ç”¨æˆ·å:å¯†ç </code> ç”¨ <code>base64</code> ç¼–ç ä¹‹åçš„å­—ç¬¦ä¸²æ”¾åœ¨ request ä¸­çš„ <code>header Authorization</code> ä¸­å‘é€ç»™æœåŠ¡ç«¯ã€‚<br>å½“æ‰“å¼€ç½‘é¡µæç¤ºéœ€è¦è¾“å…¥è´¦å·å’Œå¯†ç æ—¶ï¼Œå‡è®¾å¯†ç /è´¦å·é”™è¯¯ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›401é”™è¯¯ã€‚</p></blockquote><p>è¿™ç§ç½‘ç«™åœ¨æ‰“å¼€æ—¶å°±ä¼šå¼¹å‡ºæç¤ºæ¡†ï¼Œç›´æ¥æç¤ºè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼ŒéªŒè¯æˆåŠŸåæ‰èƒ½æŸ¥çœ‹é¡µé¢ï¼Œæˆ‘ä»¬ç°åœ¨æ¥å¤„ç†è¿™ç§é¡µé¢ã€‚</p><p>è¦è¯·æ±‚è¿™ç§é¡µé¢ï¼Œå¯ä»¥å€Ÿç”¨ <code>HTTPBasicAuthHandler</code> å®Œæˆï¼š</p><p><em>åœ¨æˆ‘ä»¬æ‰“ç®—è‡ªå·±å®ç°ä¸€ä¸ªä½¿ç”¨ httpåŸºæœ¬è®¤è¯ çš„ç¤ºä¾‹ç½‘ç«™æ—¶ï¼Œæˆ‘ä»¬å‘ç°äº† <a href="http://pythonscraping.com/pages/auth/login.php">ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­</a>ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ç°åœ¨æ¥çˆ¬å–å®ƒã€‚</em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> HTTPPasswordMgrWithDefaultRealm, HTTPBasicAuthHandler, build_opener</span><br><span class="line"><span class="keyword">from</span> urllib.error <span class="keyword">import</span> URLError</span><br><span class="line"></span><br><span class="line">username = <span class="string">&#x27;username&#x27;</span></span><br><span class="line">password = <span class="string">&#x27;password&#x27;</span></span><br><span class="line">url = <span class="string">&#x27;http://pythonscraping.com/pages/auth/login.php&#x27;</span></span><br><span class="line"></span><br><span class="line">p = HTTPPasswordMgrWithDefaultRealm()</span><br><span class="line">p.add_password(<span class="literal">None</span>, url, username, password)</span><br><span class="line">auth_handler = HTTPBasicAuthHandler(p)</span><br><span class="line">opener = build_opener(auth_handler)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = opener.<span class="built_in">open</span>(url)</span><br><span class="line">    html = result.read().decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">    print(html)</span><br><span class="line"><span class="keyword">except</span> URLError <span class="keyword">as</span> e:</span><br><span class="line">    print(e.reason)</span><br></pre></td></tr></table></figure><p>åœ¨æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿæƒ³é™„ä¸Šè¿™ç§ <code>httpåŸºæœ¬è®¤è¯</code> çš„ php å®ç°ï¼Œä»¥ä¾›å®è·µï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_AUTH_USER&#x27;</span>])) &#123;</span><br><span class="line">    header(<span class="string">&#x27;WWW-Authenticate: Basic realm=&quot;My Realm&quot;&#x27;</span>);</span><br><span class="line">    header(<span class="string">&#x27;HTTP/1.0 401 Unauthorized&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Text to send if user hits Cancel button&#x27;</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Hello <span class="subst">&#123;$_SERVER[&#x27;PHP_AUTH_USER&#x27;]&#125;</span>.&lt;/p&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;You entered <span class="subst">&#123;$_SERVER[&#x27;PHP_AUTH_PW&#x27;]&#125;</span> as your password.&lt;/p&gt;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h5 id="ä½¿ç”¨-ä»£ç†"><a href="#ä½¿ç”¨-ä»£ç†" class="headerlink" title="ä½¿ç”¨ ä»£ç†"></a>ä½¿ç”¨ <code>ä»£ç†</code></h5><p> å°è¯•æ‰¾ä¸€ä¸ª<a href="https://www.xicidaili.com/nn/">å…è´¹çš„ä»£ç†æœåŠ¡å™¨</a>ï¼Œç„¶åç”¨è¿™ä¸ªæœåŠ¡å™¨æ¥ä»£ç†ï¼š</p><p> <em>å¯»æ‰¾å¯ç”¨ä»£ç†çš„æ—¶å€™å¯ä»¥å°è¯•åœ¨æµè§ˆå™¨ä¸­è®¿é—®ä»£ç†æœåŠ¡å™¨çš„ IP:Portï¼Œå¯ç”¨çš„æ˜¯ä¼šå‡ºç°ç»“æœçš„:)</em></p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.error <span class="keyword">import</span> URLError</span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> ProxyHandler, build_opener</span><br><span class="line"></span><br><span class="line">proxy_handler = ProxyHandler(&#123;</span><br><span class="line">    <span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://171.41.80.197:9999&#x27;</span>,        <span class="comment"># ç”¨ â€˜&lt;http||https&gt;://ä»£ç†æœåŠ¡å™¨_IP:ä»£ç†æœåŠ¡å™¨_ç«¯å£â€™</span></span><br><span class="line">    <span class="string">&#x27;https&#x27;</span>: <span class="string">&#x27;https://171.41.80.197:9999&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">opener = build_opener(proxy_handler)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = opener.<span class="built_in">open</span>(<span class="string">&#x27;http://www.baidu.com&#x27;</span>)  <span class="comment"># è¦é€šè¿‡ä»£ç†çˆ¬å–çš„ç½‘é¡µ</span></span><br><span class="line">    print(response.read().decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>))</span><br><span class="line">    print(response.getheaders())</span><br><span class="line"><span class="keyword">except</span> URLError <span class="keyword">as</span> e:</span><br><span class="line">    print(e.reason)</span><br></pre></td></tr></table></figure><h5 id="å¤„ç†-Cookies"><a href="#å¤„ç†-Cookies" class="headerlink" title="å¤„ç† Cookies"></a>å¤„ç† Cookies</h5><h6 id="è·å–-Cookies"><a href="#è·å–-Cookies" class="headerlink" title="è·å– Cookies"></a>è·å– Cookies</h6><p>è·å– <code>http://www.baidu.com</code> çš„ Cookiesï¼Œä¾æ¬¡æ‰“å°å‡º name = valueï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http.cookiejar</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">cookie = http.cookiejar.CookieJar()</span><br><span class="line">handler = urllib.request.HTTPCookieProcessor(cookie)</span><br><span class="line">opener = urllib.request.build_opener(handler)</span><br><span class="line"></span><br><span class="line">response = opener.<span class="built_in">open</span>(<span class="string">&#x27;http://www.baidu.com&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> cookie:</span><br><span class="line">    print(item.name, <span class="string">&#x27;=&#x27;</span>, item.value)</span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯è·å– <code>http://www.baidu.com</code> çš„ Cookiesï¼ŒæŠŠå®ƒä»¬ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼ˆæ­£å¦‚å®é™…ä¸Š Cookies çš„ä¿å­˜æ–¹å¼é‚£æ ·ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http.cookiejar</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">filename = <span class="string">&#x27;cookies_from_baidu.txt&#x27;</span></span><br><span class="line"></span><br><span class="line">cookie = http.cookiejar.MozillaCookieJar(filename)      <span class="comment"># ç”¨ MozillaCookieJar ç±»æŠŠ Cookies å‚¨å­˜ä¸º Mozilla å‹æµè§ˆå™¨çš„æ ¼å¼ã€‚</span></span><br><span class="line"><span class="comment"># cookie = http.cookiejar.LWPCookieJar(filename)         # ç”¨è¿™è¡Œä»£æ›¿ä¸Šä¸€è¡Œï¼Œå¯ä»¥æŠŠ Cookies å‚¨å­˜ä¸º libwww-perl(LWP) çš„æ ¼å¼ã€‚</span></span><br><span class="line"></span><br><span class="line">handler = urllib.request.HTTPCookieProcessor(cookie)</span><br><span class="line">opener = urllib.request.build_opener(handler)</span><br><span class="line"></span><br><span class="line">response = opener.<span class="built_in">open</span>(<span class="string">&#x27;http://www.baidu.com&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie.save(ignore_discard=<span class="literal">True</span>, ignore_expires=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p><code>MozillaCookieJar</code> å’Œ <code>LWPCookieJar</code> éƒ½å¯ä»¥<strong>è¯»å–</strong>å’Œ<strong>ä¿å­˜</strong> Cookiesã€‚åªæ˜¯å®ƒä»¬çš„ä¿å­˜æ ¼å¼æœ‰åˆ«ã€‚</p><h6 id="å–ç”¨-Cookies"><a href="#å–ç”¨-Cookies" class="headerlink" title="å–ç”¨ Cookies"></a>å–ç”¨ Cookies</h6><p>å–ç”¨æˆ‘ä»¬åˆšæ‰ä¿å­˜ä¸‹æ¥çš„ Cookiesï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http.cookiejar</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">cookie = http.cookiejar.MozillaCookieJar()</span><br><span class="line">cookie.load(<span class="string">&#x27;cookies_from_baidu.txt&#x27;</span>, ignore_discard=<span class="literal">True</span>, ignore_expires=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">handler = urllib.request.HTTPCookieProcessor(cookie)</span><br><span class="line">opener = urllib.request.build_opener(handler)</span><br><span class="line"></span><br><span class="line">response = opener.<span class="built_in">open</span>(<span class="string">&#x27;http://www.baidu.com&#x27;</span>)</span><br><span class="line">print(response.read().decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>))</span><br></pre></td></tr></table></figure><h3 id="urllib-error-å¤„ç†å¼‚å¸¸"><a href="#urllib-error-å¤„ç†å¼‚å¸¸" class="headerlink" title="urllib.error å¤„ç†å¼‚å¸¸"></a>urllib.error å¤„ç†å¼‚å¸¸</h3><h4 id="URLError"><a href="#URLError" class="headerlink" title="URLError:"></a>URLError:</h4><p><code>URLError</code> ç±»æ¥è‡ª <code>Urllib</code> åº“çš„ <code>error</code> æ¨¡å—ï¼Œå®ƒç»§æ‰¿è‡ª <code>OSError</code> ç±»ï¼Œæ˜¯ error å¼‚å¸¸æ¨¡å—çš„åŸºç±»ï¼Œç”± request æ¨¡å—ç”Ÿçš„å¼‚å¸¸éƒ½å¯ä»¥é€šè¿‡æ•è·è¿™ä¸ªç±»æ¥å¤„ç†ã€‚</p><p>å®ƒå…·æœ‰ä¸€ä¸ªå±æ€§ <code>reason</code>ï¼Œå³è¿”å›é”™è¯¯çš„åŸå› :</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request, error</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = request.urlopen(<span class="string">&#x27;http://www.google.com&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> error.URLError <span class="keyword">as</span> e:</span><br><span class="line">    print(e.reason)</span><br></pre></td></tr></table></figure><p>é€šè¿‡å¦‚ä¸Šæ“ä½œï¼Œæˆ‘ä»¬å°±å¯ä»¥é¿å…ç¨‹åºå¼‚å¸¸ç»ˆæ­¢ï¼ŒåŒæ—¶å¼‚å¸¸å¾—åˆ°äº†æœ‰æ•ˆå¤„ç†ã€‚</p><h4 id="HTTPError"><a href="#HTTPError" class="headerlink" title="HTTPError"></a>HTTPError</h4><p><code>HTTPError</code> æ˜¯ <code>URLError</code> çš„å­ç±»ã€‚ç”¨æ¥å¤„ç† <strong>HTTP è¯·æ±‚é”™è¯¯</strong>ï¼Œæ¯”å¦‚è®¤è¯è¯·æ±‚å¤±è´¥ç­‰ç­‰ã€‚</p><p><code>HTTPError</code> çš„å±æ€§ï¼š</p><ul><li><code>code</code>ï¼Œè¿”å› HTTP Status Codeï¼Œå³çŠ¶æ€ç ï¼Œæ¯”å¦‚ 404 ç½‘é¡µä¸å­˜åœ¨ï¼Œ500 æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ç­‰ç­‰ã€‚</li><li><code>reason</code>ï¼ŒåŒçˆ¶ç±»ä¸€æ ·ï¼Œè¿”å›é”™è¯¯çš„åŸå› ã€‚</li><li><code>headers</code>ï¼Œè¿”å› Request Headersã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request,error</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = request.urlopen(<span class="string">&#x27;http://cr0123.gz01.bdysite.com/no_such_a_page.html&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> error.HTTPError <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">&#x27;\n[Reason]&#x27;</span>, e.reason,</span><br><span class="line">        <span class="string">&#x27;\n[code]&#x27;</span>, e.code,</span><br><span class="line">        <span class="string">&#x27;\n[headers]&#x27;</span>, e.headers</span><br><span class="line">        )</span><br></pre></td></tr></table></figure><h4 id="ç»¼åˆä½¿ç”¨ï¼š"><a href="#ç»¼åˆä½¿ç”¨ï¼š" class="headerlink" title="ç»¼åˆä½¿ç”¨ï¼š"></a>ç»¼åˆä½¿ç”¨ï¼š</h4><p>åœ¨å®é™…çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆé€‰æ‹©æ•è·å­ç±»çš„é”™è¯¯ï¼Œå†å»æ•è·çˆ¶ç±»çš„é”™è¯¯ï¼Œä»è€Œä½¿å¤„ç†å®Œæ•´ï¼Œå±‚æ¬¡æ¸…æ™°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request, error</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = request.urlopen(<span class="string">&#x27;http://www.google.com&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> error.HTTPError <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">&#x27;HTTPError:&#x27;</span>)</span><br><span class="line">    print(<span class="string">&#x27;[Reason]&#x27;</span>, e.reason, <span class="string">&#x27;[code]&#x27;</span>, e.code, <span class="string">&#x27;[headers]&#x27;</span>, e.headers, sep=<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> error.URLError <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">&#x27;URLError:&#x27;</span>)</span><br><span class="line">    print(<span class="string">&#x27;[Error Reason]\n&#x27;</span>, e.reason)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">&#x27;Exception:&#x27;</span>)</span><br><span class="line">    print(e)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">&#x27;Request Successfully&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="urllib-parse-è§£æé“¾æ¥"><a href="#urllib-parse-è§£æé“¾æ¥" class="headerlink" title="urllib.parse è§£æé“¾æ¥"></a>urllib.parse è§£æé“¾æ¥</h3><p><code>urllib.parse</code> æ¨¡å—å®šä¹‰äº†å¤„ç† URL çš„æ ‡å‡†æ¥å£ï¼Œä¾‹å¦‚å®ç° URL å„éƒ¨åˆ†çš„æŠ½å–ï¼Œåˆå¹¶ä»¥åŠé“¾æ¥è½¬æ¢ã€‚</p><h4 id="quote-å°†å†…å®¹è½¬åŒ–ä¸º-URL-ç¼–ç çš„æ ¼å¼"><a href="#quote-å°†å†…å®¹è½¬åŒ–ä¸º-URL-ç¼–ç çš„æ ¼å¼" class="headerlink" title="quote() å°†å†…å®¹è½¬åŒ–ä¸º URL ç¼–ç çš„æ ¼å¼"></a>quote() å°†å†…å®¹è½¬åŒ–ä¸º URL ç¼–ç çš„æ ¼å¼</h4><p>å¯ä»¥ç”¨æ¥æŠŠä¸­æ–‡å­—ç¬¦è½¬åŒ–ä¸º URL ç¼–ç ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>quote(<span class="string">&#x27;ä¸­æ–‡&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;%E4%B8%AD%E6%96%87&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>url = <span class="string">&#x27;https://www.baidu.com/s?wd=&#x27;</span> + quote(<span class="string">&#x27;URL ç¼–ç &#x27;</span>)    <span class="comment"># åˆæˆçš„ç½‘å€å³å¯ç™¾åº¦æœç´¢â€˜URL ç¼–ç â€™</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(url)</span><br><span class="line">https://www.baidu.com/s?wd=URL%20%E7%BC%96%E7%A0%81</span><br></pre></td></tr></table></figure><p>è¦è§£ç ï¼Œå¯æ˜¯ä½¿ç”¨å¯¹åº”çš„ <code>unquote()</code>ã€‚</p><h4 id="urlparse-URLçš„è¯†åˆ«å’Œåˆ†æ®µ"><a href="#urlparse-URLçš„è¯†åˆ«å’Œåˆ†æ®µ" class="headerlink" title="urlparse() URLçš„è¯†åˆ«å’Œåˆ†æ®µ"></a>urlparse() URLçš„è¯†åˆ«å’Œåˆ†æ®µ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse</span><br><span class="line"></span><br><span class="line">result = urlparse(<span class="string">&#x27;http://www.baidu.com/index.html;user?id=5#comment&#x27;</span>)</span><br><span class="line">print(<span class="built_in">type</span>(result))</span><br><span class="line">print(result)</span><br><span class="line">print(result.netloc)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;(results)</span></span><br><span class="line"><span class="string">&lt;class &#x27;urllib.parse.ParseResult&#x27;&gt;</span></span><br><span class="line"><span class="string">ParseResult(scheme=&#x27;http&#x27;, netloc=&#x27;www.baidu.com&#x27;, path=&#x27;/index.html&#x27;, params=&#x27;user&#x27;, query=&#x27;id=5&#x27;, fragment=&#x27;comment&#x27;)</span></span><br><span class="line"><span class="string">www.baidu.com</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>ParseResult åŒ…å«ï¼š</p><ul><li>scheme â€”â€”â€”â€” åè®®</li><li>netloc â€”â€”â€”â€” ä¸»æœºå</li><li>path â€”â€”â€”â€” è·¯å¾„</li><li>params â€”â€”â€”â€” <code>;XXX</code></li><li>query â€”â€”â€”â€” <code>?XXX</code></li><li>fragment â€”â€”â€”â€” <code>#XXX</code></li></ul><h4 id="urlunparse-åˆæˆURL"><a href="#urlunparse-åˆæˆURL" class="headerlink" title="urlunparse() åˆæˆURL"></a>urlunparse() åˆæˆURL</h4><p><strong>ä¾æ¬¡</strong>ä¼ å…¥å…­ä¸ªéƒ¨åˆ†ï¼š(scheme, netloc, path, params, query, fragment)ï¼Œ<br>å°†åˆæˆä¸€ä¸ª: <code>scheme://netloc/path;params?query#fragment</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlunparse</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>data = [<span class="string">&#x27;https&#x27;</span>, <span class="string">&#x27;www.baidu.com&#x27;</span>, <span class="string">&#x27;/index.php&#x27;</span>, <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;id=5&#x27;</span>, <span class="string">&#x27;123&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>urlunparse(data)</span><br><span class="line"><span class="string">&#x27;https://www.baidu.com/index.php;user?id=5#123&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="urlencode-å­—å…¸ç±»å‹-è½¬åŒ–ä¸º-GETè¯·æ±‚å‚æ•°"><a href="#urlencode-å­—å…¸ç±»å‹-è½¬åŒ–ä¸º-GETè¯·æ±‚å‚æ•°" class="headerlink" title="urlencode()  å­—å…¸ç±»å‹ è½¬åŒ–ä¸º GETè¯·æ±‚å‚æ•°"></a>urlencode()  å­—å…¸ç±»å‹ è½¬åŒ–ä¸º GETè¯·æ±‚å‚æ•°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlencode</span><br><span class="line"></span><br><span class="line">params = &#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;germey&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;age&#x27;</span>: <span class="number">22</span></span><br><span class="line">&#125;</span><br><span class="line">base_url = <span class="string">&#x27;http://www.baidu.com?&#x27;</span></span><br><span class="line">url = base_url + urlencode(params)</span><br><span class="line">print(url)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;(result)</span></span><br><span class="line"><span class="string">http://www.baidu.com?name=germey&amp;age=22</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="parse-qs-GETè¯·æ±‚å‚æ•°-è½¬åŒ–ä¸º-å­—å…¸ç±»å‹"><a href="#parse-qs-GETè¯·æ±‚å‚æ•°-è½¬åŒ–ä¸º-å­—å…¸ç±»å‹" class="headerlink" title="parse_qs()  GETè¯·æ±‚å‚æ•° è½¬åŒ–ä¸º å­—å…¸ç±»å‹"></a>parse_qs()  GETè¯·æ±‚å‚æ•° è½¬åŒ–ä¸º å­—å…¸ç±»å‹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> parse_qs</span><br><span class="line"></span><br><span class="line">query = <span class="string">&#x27;name=germey&amp;age=22&#x27;</span></span><br><span class="line">print(parse_qs(query))</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;(result)</span></span><br><span class="line"><span class="string">&#123;&#x27;name&#x27;: [&#x27;germey&#x27;], &#x27;age&#x27;: [&#x27;22&#x27;]&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>å¦æœ‰ä¸€ä¸ª <code>parse_qsl()</code> ä¸ <code>parse_qs()</code> ç±»ä¼¼ï¼Œåªæ˜¯å¾—åˆ°çš„ç»“æœæ˜¯ å…ƒç»„</p><h4 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h4><p>è¿™ä¸ªåº“ä¸­è¿˜æœ‰ä¸€äº› <code>urljoin</code> ç­‰æ–¹å¼ï¼Œå¯ä»¥åœ¨ <a href="https://germey.gitbooks.io/python3webspider/content/3.1.3-%E8%A7%A3%E6%9E%90%E9%93%BE%E6%8E%A5.html">è¿™é‡Œ</a> æŸ¥çœ‹ã€‚</p><h3 id="urllib-robotparser-åˆ†æRobotsåè®®"><a href="#urllib-robotparser-åˆ†æRobotsåè®®" class="headerlink" title="urllib.robotparser åˆ†æRobotsåè®®"></a>urllib.robotparser åˆ†æRobotsåè®®</h3><h4 id="Robotsåè®®"><a href="#Robotsåè®®" class="headerlink" title="Robotsåè®®"></a>Robotsåè®®</h4><p>ç½‘ç»œçˆ¬è™«æ’é™¤æ ‡å‡†ï¼ˆRobots Exclusion Protocolï¼‰ï¼Œç”¨æ¥å‘Šè¯‰çˆ¬è™«å’Œæœç´¢å¼•æ“å“ªäº›é¡µé¢å¯ä»¥æŠ“å–ï¼Œå“ªäº›ä¸å¯ä»¥æŠ“å–ã€‚<br>å®ƒé€šå¸¸æ˜¯ä¸€ä¸ªå«åš robots.txt çš„æ–‡æœ¬æ–‡ä»¶ï¼Œæ”¾åœ¨ç½‘ç«™çš„æ ¹ç›®å½•ä¸‹ã€‚</p><p>Robotsåè®®çš„å†™æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *               è¿™é‡Œçš„*ä»£è¡¨çš„æ‰€æœ‰çš„æœç´¢å¼•æ“ç§ç±»ï¼Œ*æ˜¯ä¸€ä¸ªé€šé…ç¬¦</span><br><span class="line">Disallow: &#x2F;admin&#x2F;           è¿™é‡Œå®šä¹‰æ˜¯ç¦æ­¢çˆ¬å¯»adminç›®å½•ä¸‹é¢çš„ç›®å½•</span><br><span class="line">Disallow: &#x2F;require&#x2F;         è¿™é‡Œå®šä¹‰æ˜¯ç¦æ­¢çˆ¬å¯»requireç›®å½•ä¸‹é¢çš„ç›®å½•</span><br><span class="line">Disallow: &#x2F;ABC&#x2F;             è¿™é‡Œå®šä¹‰æ˜¯ç¦æ­¢çˆ¬å¯»ABCç›®å½•ä¸‹é¢çš„ç›®å½•</span><br><span class="line">Disallow: &#x2F;cgi-bin&#x2F;*.htm    ç¦æ­¢è®¿é—®&#x2F;cgi-bin&#x2F;ç›®å½•ä¸‹çš„æ‰€æœ‰ä»¥&quot;.htm&quot;ä¸ºåç¼€çš„URL(åŒ…å«å­ç›®å½•)ã€‚</span><br><span class="line">Disallow: &#x2F;*?*              ç¦æ­¢è®¿é—®ç½‘ç«™ä¸­æ‰€æœ‰åŒ…å«é—®å· (?) çš„ç½‘å€</span><br><span class="line">Disallow: &#x2F;.jpg$            ç¦æ­¢æŠ“å–ç½‘é¡µæ‰€æœ‰çš„.jpgæ ¼å¼çš„å›¾ç‰‡</span><br><span class="line">Disallow:&#x2F;ab&#x2F;adc.html       ç¦æ­¢çˆ¬å–abæ–‡ä»¶å¤¹ä¸‹é¢çš„adc.htmlæ–‡ä»¶ã€‚</span><br><span class="line">Allow: &#x2F;cgi-bin&#x2F;ã€€          è¿™é‡Œå®šä¹‰æ˜¯å…è®¸çˆ¬å¯»cgi-binç›®å½•ä¸‹é¢çš„ç›®å½•</span><br><span class="line">Allow: &#x2F;tmp                 è¿™é‡Œå®šä¹‰æ˜¯å…è®¸çˆ¬å¯»tmpçš„æ•´ä¸ªç›®å½•</span><br><span class="line">Allow: .htm$                ä»…å…è®¸è®¿é—®ä»¥&quot;.htm&quot;ä¸ºåç¼€çš„URLã€‚</span><br><span class="line">Allow: .gif$                å…è®¸æŠ“å–ç½‘é¡µå’Œgifæ ¼å¼å›¾ç‰‡</span><br><span class="line">Sitemap:                    ç½‘ç«™åœ°å›¾ å‘Šè¯‰çˆ¬è™«è¿™ä¸ªé¡µé¢æ˜¯ç½‘ç«™åœ°å›¾</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ç¦æ­¢æ‰€æœ‰æœç´¢å¼•æ“è®¿é—®ç½‘ç«™çš„ä»»ä½•éƒ¨åˆ†</span><br><span class="line">User-agent: *</span><br><span class="line">Disallow: &#x2F;</span><br><span class="line"></span><br><span class="line">å…è®¸æ‰€æœ‰çš„robotè®¿é—®</span><br><span class="line">User-agent: *</span><br><span class="line">Allow:ã€€&#x2F;</span><br><span class="line"></span><br><span class="line">å…è®¸æŸä¸ªæœç´¢å¼•æ“çš„è®¿é—®</span><br><span class="line">User-agent: Baiduspider</span><br><span class="line">allow:&#x2F;</span><br></pre></td></tr></table></figure><h4 id="è§£æ-Robots-txt-â€”-urllib-robotparser-RobotFileParser-ç±»"><a href="#è§£æ-Robots-txt-â€”-urllib-robotparser-RobotFileParser-ç±»" class="headerlink" title="è§£æ Robots.txt â€”- urllib.robotparser.RobotFileParser ç±»"></a>è§£æ Robots.txt â€”- <code>urllib.robotparser.RobotFileParser</code> ç±»</h4><p>robotparser æ¨¡å—æä¾›äº†ä¸€ä¸ª <code>RobotFileParser</code> ç±»ã€‚å®ƒå¯ä»¥æ ¹æ®æŸç½‘ç«™çš„ robots.txt æ–‡ä»¶æ¥åˆ¤æ–­ä¸€ä¸ªçˆ¬å–çˆ¬è™«æ˜¯å¦æœ‰æƒé™æ¥çˆ¬å–è¿™ä¸ªç½‘é¡µã€‚</p><h5 id="RobotFileParser-å®ä¾‹çš„æ„é€ "><a href="#RobotFileParser-å®ä¾‹çš„æ„é€ " class="headerlink" title="RobotFileParser å®ä¾‹çš„æ„é€ "></a><code>RobotFileParser</code> å®ä¾‹çš„æ„é€ </h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">urllib.robotparser.RobotFileParser(url&#x3D;&#39;&#39;)      # ä¼ å…¥ robots.txt çš„é“¾æ¥</span><br></pre></td></tr></table></figure><h5 id="RobotFileParser-å¸¸ç”¨æ–¹æ³•"><a href="#RobotFileParser-å¸¸ç”¨æ–¹æ³•" class="headerlink" title="RobotFileParser å¸¸ç”¨æ–¹æ³•"></a><code>RobotFileParser</code> å¸¸ç”¨æ–¹æ³•</h5><ul><li><code>set_url(url)</code> ç”¨æ¥è®¾ç½® robots.txt çš„é“¾æ¥</li><li><code>read()</code> è¯»å– robots.txt æ–‡ä»¶å¹¶è¿›è¡Œåˆ†æã€‚<br>âš ï¸ã€æ³¨æ„ã€‘å¦‚æœä¸ read()ï¼Œæ‰€æœ‰çš„åˆ¤æ–­å‡½æ•°éƒ½ä¼šè¿”å› Falseï¼</li><li><code>parse()</code> ç”¨æ¥è§£æ robots.txt æ–‡ä»¶ï¼Œä¼ å…¥çš„å‚æ•°æ˜¯ robots.txt æŸäº›è¡Œçš„å†…å®¹ï¼Œå®ƒä¼šæŒ‰ç…§ robots.txt çš„è¯­æ³•è§„åˆ™æ¥åˆ†æè¿™äº›å†…å®¹ã€‚</li><li><code>can_fetch()</code> ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ User-agentï¼Œç¬¬äºŒä¸ªæ˜¯è¦æŠ“å–çš„ URLï¼Œè¿”å›çš„å†…å®¹æ˜¯è¯¥æœç´¢å¼•æ“æ˜¯å¦å¯ä»¥æŠ“å–è¿™ä¸ª URLï¼Œè¿”å›ç»“æœæ˜¯ True æˆ– Falseã€‚</li><li><code>mtime()</code>ï¼Œè¿”å›çš„æ˜¯ä¸Šæ¬¡æŠ“å–å’Œåˆ†æ robots.txt çš„æ—¶é—´ï¼Œè¿™ä¸ªå¯¹äºé•¿æ—¶é—´åˆ†æå’ŒæŠ“å–çš„æœç´¢çˆ¬è™«æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œä½ å¯èƒ½éœ€è¦å®šæœŸæ£€æŸ¥æ¥æŠ“å–æœ€æ–°çš„ robots.txtã€‚</li><li><code>modified()</code>ï¼ŒåŒæ ·çš„å¯¹äºé•¿æ—¶é—´åˆ†æå’ŒæŠ“å–çš„æœç´¢çˆ¬è™«å¾ˆæœ‰å¸®åŠ©ï¼Œå°†å½“å‰æ—¶é—´è®¾ç½®ä¸ºä¸Šæ¬¡æŠ“å–å’Œåˆ†æ robots.txt çš„æ—¶é—´ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> Crawler </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crawler </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çˆ¬è™«åŸºç¡€</title>
      <link href="/2019/02/10/PythonAndCrawler/crawler-1-basic/"/>
      <url>/2019/02/10/PythonAndCrawler/crawler-1-basic/</url>
      
        <content type="html"><![CDATA[<h1 id="çˆ¬è™«åŸºç¡€"><a href="#çˆ¬è™«åŸºç¡€" class="headerlink" title="çˆ¬è™«åŸºç¡€"></a>çˆ¬è™«åŸºç¡€</h1><blockquote><p>æœ¬æ–‡ä¸»è¦ä»‹ç»çˆ¬è™«æ¶‰åŠåˆ°çš„åŸºç¡€çŸ¥è¯†ã€‚</p></blockquote><h2 id="HTTP-åŸºæœ¬åŸç†"><a href="#HTTP-åŸºæœ¬åŸç†" class="headerlink" title="HTTP åŸºæœ¬åŸç†"></a>HTTP åŸºæœ¬åŸç†</h2><h3 id="URI-amp-URL"><a href="#URI-amp-URL" class="headerlink" title="URI &amp; URL"></a>URI &amp; URL</h3><table><thead><tr><th>ç®€å†™</th><th>å…¨å</th><th>ä¸­æ–‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>URI</td><td>Uniform Resource Identifier</td><td>ç»Ÿä¸€èµ„æºæ ‡å¿—ç¬¦</td><td>å¯¹åº”ç€ä¸€ä¸ªèµ„æº</td></tr><tr><td>URL</td><td>Uniform Resource Locator</td><td>ç»Ÿä¸€èµ„æºå®šä½ç¬¦</td><td>è¯´æ˜ä»å“ªé‡Œå¯ä»¥æ‰¾åˆ°ä¸€ä¸ªèµ„æº</td></tr><tr><td>URN</td><td>Universal Resource Name</td><td>ç»Ÿä¸€èµ„æºåç§°</td><td>è¯´æ˜ä¸€ä¸ªèµ„æºçš„å”¯ä¸€åå­—</td></tr></tbody></table><p>URI åŒ…å«ç€ URL å’Œ URNã€‚</p><p>é€šå¸¸ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„ç½‘å€ï¼Œå°±æ˜¯ä¸€ä¸ªURIï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªURLã€‚</p><h3 id="è¶…æ–‡æœ¬"><a href="#è¶…æ–‡æœ¬" class="headerlink" title="è¶…æ–‡æœ¬"></a>è¶…æ–‡æœ¬</h3><blockquote><p>è¶…æ–‡æœ¬æ˜¯ç”¨è¶…é“¾æ¥çš„æ–¹æ³•ï¼Œå°†å„ç§ä¸åŒç©ºé—´çš„æ–‡å­—ä¿¡æ¯ç»„ç»‡åœ¨ä¸€èµ·çš„ç½‘çŠ¶æ–‡æœ¬ã€‚</p></blockquote><p>æˆ‘ä»¬å¹³æ—¶çœ‹åˆ°çš„ç½‘é¡µçš„æºä»£ç ä½¿ç”¨ HTML å†™å‡ºçš„ï¼ŒHTML å°±æ˜¯ä¸€ç§è¶…æ–‡æœ¬ã€‚</p><h3 id="HTTP-amp-HTTPS"><a href="#HTTP-amp-HTTPS" class="headerlink" title="HTTP &amp; HTTPS"></a>HTTP &amp; HTTPS</h3><p>æˆ‘ä»¬ç”¨URLè®¿é—®èµ„æºéœ€è¦æŒ‡å®šä½¿ç”¨çš„åè®®ç±»å‹ï¼Œåè®®å°±æ˜¯URLåœ°å€ä¸€å¼€å§‹çš„é‚£ä¸ªå­—æ®µã€‚</p><table><thead><tr><th>åè®®</th><th>å…¨ç§°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>HTTP</td><td>Hyper Text Transfer Protocolï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰</td><td>ç”¨äºä»ç½‘ç»œä¼ è¾“è¶…æ–‡æœ¬æ•°æ®åˆ°æœ¬åœ°æµè§ˆå™¨çš„ä¼ é€åè®®ï¼Œå®ƒèƒ½ä¿è¯é«˜æ•ˆè€Œå‡†ç¡®åœ°ä¼ é€è¶…æ–‡æœ¬æ–‡æ¡£</td></tr><tr><td>HTTPS</td><td>Hyper Text Transfer Protocol over Secure Socket Layerï¼ˆåœ¨SSLä¸Šçš„HTTPï¼‰</td><td>ä»¥å®‰å…¨ä¸ºç›®æ ‡çš„ HTTP é€šé“ï¼Œæ˜¯ HTTP çš„å®‰å…¨ç‰ˆ</td></tr></tbody></table><p>HTTPS ç›¸è¾ƒäº HTTP æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p><ul><li>å»ºç«‹ä¸€ä¸ªä¿¡æ¯å®‰å…¨é€šé“æ¥ä¿è¯æ•°æ®ä¼ è¾“çš„å®‰å…¨ã€‚</li><li>ç¡®è®¤ç½‘ç«™çš„çœŸå®æ€§ï¼Œå‡¡æ˜¯ä½¿ç”¨äº† HTTPS çš„ç½‘ç«™ï¼Œéƒ½å¯ä»¥é€šè¿‡ç‚¹å‡»æµè§ˆå™¨åœ°å€æ çš„é”å¤´æ ‡å¿—æ¥<br>æŸ¥çœ‹ç½‘ç«™è®¤è¯ä¹‹åçš„çœŸå®ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ CA æœºæ„é¢å‘çš„å®‰å…¨ç­¾ç« æ¥æŸ¥è¯¢ã€‚</li></ul><h3 id="HTTP-è¯·æ±‚è¿‡ç¨‹"><a href="#HTTP-è¯·æ±‚è¿‡ç¨‹" class="headerlink" title="HTTP è¯·æ±‚è¿‡ç¨‹"></a>HTTP è¯·æ±‚è¿‡ç¨‹</h3><p>æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ç½‘å€ï¼Œä¾¿æ˜¾ç¤ºå‡ºä¸€ä¸ªç½‘é¡µçš„è¿‡ç¨‹å®é™…ä¸Šæ˜¯ï¼š</p><ol start="0"><li>æµè§ˆå™¨å‘ç½‘ç«™çš„æœåŠ¡å™¨å‘é€äº†ä¸€ä¸ªè¯·æ±‚ï¼›</li><li>æœåŠ¡å™¨æ¥æ”¶åˆ°è¿™ä¸ªè¯·æ±‚åè¿›è¡Œè§£æå’Œå¤„ç†ï¼›</li><li>æœåŠ¡å™¨è¿”å›å¯¹åº”çš„å“åº”ï¼›</li><li>æµè§ˆå™¨å¯¹æ”¶åˆ°çš„å“åº”è§£æï¼›</li><li>æµè§ˆå™¨å°†è§£æçš„ç»“æœæ˜¾ç¤ºå‡ºæ¥ï¼Œå³æœ€åæˆ‘ä»¬çœ‹åˆ°çš„ç½‘é¡µã€‚</li></ol><p>æˆ‘ä»¬å¯ä»¥åœ¨ Chromeæµè§ˆå™¨ çš„å¼€å‘è€…å·¥å…·çš„â€œNetworkâ€é¡µé¢çœ‹åˆ°çš„ä¸€ä¸ªæ¡ç›®å°±æ˜¯ä¸€æ¬¡ <em>å‘é€è¯·æ±‚å’Œæ¥æ”¶å“åº”</em> çš„è¿‡ç¨‹ã€‚</p><table><thead><tr><th>Networkçš„åˆ—</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Name</td><td>è¯·æ±‚çš„åç§°ï¼Œä¸€èˆ¬ä¼šå°† URL çš„æœ€åä¸€éƒ¨åˆ†å†…å®¹å½“ä½œåç§° ã€‚</td></tr><tr><td>Status</td><td>å“åº”çš„çŠ¶æ€ç ï¼Œè¿™é‡Œæ˜¾ç¤ºä¸º 200ï¼Œ ä»£è¡¨å“åº”æ˜¯æ­£å¸¸çš„ ã€‚ é€šè¿‡çŠ¶æ€ç ï¼Œæˆ‘ä»¬å¯ä»¥åˆ¤æ–­å‘é€äº†è¯·æ±‚ä¹‹åæ˜¯æå¾—åˆ°äº†æ­£å¸¸çš„å“åº” ã€‚</td></tr><tr><td>Type</td><td>è¯·æ±‚çš„æ–‡æ¢¢ç±»å‹ ã€‚ è¿™é‡Œä¸º documentï¼Œä»£è¡¨æˆ‘ä»¬è¿™æ¬¡è¯·æ±‚çš„æ˜¯ä¸€ä¸ª HTMLæ–‡æ¡£ï¼Œ å†…å®¹å°±æ˜¯ä¸€äº› HTMLä»£ç ã€‚</td></tr><tr><td>Initiator</td><td>è¯·æ±‚æº ã€‚ ç”¨æ¥æ ‡è®°è¯·æ±‚æ˜¯ç”±å“ªä¸ªå¯¹è±¡æˆ–è¿›ç¨‹å‘èµ·çš„ ã€‚</td></tr><tr><td>Size</td><td>ä»æœåŠ¡å™¨ä¸‹è½½çš„æ–‡ä»¶å’Œè¯·æ±‚çš„èµ„æºå¤§å° ã€‚ å¦‚æœæ˜¯ä»ç¼“å­˜ä¸­å–å¾—çš„èµ„æºï¼Œåˆ™è¯¥åˆ—ä¼šæ˜¾ç¤ºfrom cacheã€‚</td></tr><tr><td>Time</td><td>å‘èµ·è¯·æ±‚åˆ°è·å–å“åº”æ‰€ç”¨çš„æ€»æ—¶é—´ ã€‚</td></tr><tr><td>Waterfall</td><td>ç½‘ç»œè¯·æ±‚çš„å¯è§†åŒ–ç€‘å¸ƒæµ ã€‚</td></tr></tbody></table><p>ç‚¹å‡»æ¡ç›®ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°æ›´åŠ è¯¦ç»†çš„è¯·æ±‚ã€å“åº”ä¿¡æ¯ã€‚</p><h3 id="è¯·æ±‚ï¼ˆRequestï¼‰"><a href="#è¯·æ±‚ï¼ˆRequestï¼‰" class="headerlink" title="è¯·æ±‚ï¼ˆRequestï¼‰"></a>è¯·æ±‚ï¼ˆRequestï¼‰</h3><p>è¯·æ±‚ï¼Œæ˜¯ç”± <strong>å®¢æˆ·ç«¯</strong> å‘ <strong>æœåŠ¡ç«¯</strong> å‘å‡ºçš„ã€‚</p><p>è¯·æ±‚åˆ†ä¸º4éƒ¨åˆ†ï¼š</p><ul><li><p><strong>è¯·æ±‚æ–¹æ³•</strong>ï¼ˆRequest Methodï¼‰ï¼šå¸¸è§çš„è¯·æ±‚æ–¹æ³•åˆ†ä¸ºä¸¤ç§ GET å’Œ POSTï¼š</p><ul><li><code>GET</code> è¯·æ±‚ä¸­çš„å‚æ•°åŒ…å«åœ¨ URL é‡Œé¢ï¼Œæ•°æ®å¯ä»¥åœ¨ URL ä¸­çœ‹åˆ°ï¼ˆå¯èƒ½æš´éœ²æ•æ„Ÿä¿¡æ¯ï¼‰ã€‚GETè¯·æ±‚æäº¤çš„æ•°æ®æœ€å¤šåªæœ‰ 1024 å­—èŠ‚ã€‚</li><li><code>POST</code> è¯·æ±‚ä¸­çš„ URL ä¸åŒ…å«æ•°æ®ï¼Œæ•°æ®éƒ½æ˜¯é€šè¿‡è¡¨å•å½¢å¼ä¼ è¾“çš„ï¼Œä¼šåŒ…å«åœ¨è¯·æ±‚ä½“ä¸­ã€‚POSTæ–¹å¼æ²¡æœ‰å¤§å°é™åˆ¶ï¼ˆå¯ä»¥ä¼ æ–‡ä»¶ï¼‰ã€‚</li><li>æˆ‘ä»¬è¾“å…¥ä¸€ä¸ªç½‘å€ï¼Œè¿™æ˜¯ä¸€ä¸ª GET è¯·æ±‚ã€‚</li><li>å…¶å®è¿˜æœ‰ä¸€äº›å…¶ä»–çš„è¯·æ±‚æ–¹æ³•ï¼Œå¯ä»¥å‚è€ƒ <a href="http://www.runoob.com/http/http-methods.html">HTTPè¯·æ±‚æ–¹æ³•</a></li></ul></li><li><p><strong>è¯·æ±‚åœ°å€</strong>ï¼ˆRequest URLï¼‰ï¼šç»Ÿä¸€èµ„æƒŠå®šä½ç¬¦ URLï¼Œå”¯ä¸€ç¡®å®šæˆ‘ä»¬æƒ³è¯·æ±‚çš„èµ„æºã€‚</p></li><li><p><strong>è¯·æ±‚å¤´</strong>ï¼ˆRequest Headersï¼‰ï¼šç”¨æ¥è¯´æ˜æœåŠ¡å™¨è¦ä½¿ç”¨çš„é™„åŠ ä¿¡æ¯ï¼Œæ¯”è¾ƒé‡è¦çš„ä¿¡æ¯æœ‰ Cookieã€ Refererã€ User-Agentï¼š</p><ul><li><code>Accept</code>: è¯·æ±‚æŠ¥å¤´åŸŸï¼Œç”¨äºæŒ‡å®šå®¢æˆ·ç«¯å¯ <strong>æ¥å—å“ªäº›ç±»å‹çš„ä¿¡æ¯</strong>ã€‚</li><li><code>Accept-Language</code>: æŒ‡å®šå®¢æˆ·ç«¯å¯æ¥å—çš„ <strong>è¯­è¨€ç±»å‹</strong>ã€‚</li><li><code>Acceot-Encoding</code>: æŒ‡å®šå®¢æˆ·ç«¯å¯æ¥å—çš„ <strong>å†…å®¹ç¼–ç </strong>ã€‚</li><li><code>Host</code>: æŒ‡å®š <strong>è¯·æ±‚èµ„æºçš„ä¸»æœº IP å’Œç«¯å£å·</strong>ï¼Œå…¶å†…å®¹ä¸º <strong>è¯·æ±‚ URL çš„åŸå§‹æœåŠ¡å™¨æˆ–ç½‘å…³çš„ä½ç½®</strong>ã€‚</li><li><code>Cookies</code>: ç½‘ç«™ä¸ºäº†è¾¨åˆ«ç”¨æˆ·è¿›è¡Œä¼šè¯è·Ÿè¸ªè€Œ <strong>å­˜å‚¨åœ¨ç”¨æˆ·æœ¬åœ°çš„æ•°æ®</strong>ã€‚å®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯ <strong>ç»´æŒå½“å‰è®¿é—®ä¼šè¯</strong>ï¼Œå¦‚æ£€æŸ¥ç”¨æˆ·ç™»å½•ã€‚</li><li><code>Referer</code>: æ­¤å†…å®¹ç”¨æ¥æ ‡è¯†è¿™ä¸ªè¯·æ±‚æ˜¯ä»å“ªä¸ªé¡µé¢å‘è¿‡æ¥çš„ï¼ŒæœåŠ¡å™¨å¯ä»¥æ‹¿åˆ°è¿™ä¸€ä¿¡æ¯å¹¶åšç›¸ åº”çš„å¤„ç†ï¼Œå¦‚åšæ¥æºç»Ÿè®¡ã€é˜²ç›—é“¾å¤„ç†ç­‰ ã€‚</li><li><code>User-Agent</code>: ç®€ç§° UAï¼Œå®ƒå¯ä»¥ä½¿æœåŠ¡å™¨è¯†åˆ«å®¢æˆ·ä½¿ç”¨çš„æ“ä½œç³»ç»ŸåŠç‰ˆæœ¬ã€æµè§ˆå™¨åŠç‰ˆæœ¬ç­‰ä¿¡æ¯ã€‚ <strong>åœ¨åšçˆ¬è™«æ—¶åŠ ä¸Šæ­¤ä¿¡æ¯ï¼Œå¯ä»¥ä¼ªè£…ä¸ºæµè§ˆå™¨; å¦‚æœä¸åŠ ï¼Œå¾ˆå¯èƒ½ä¼šè¢«è¯†åˆ«å·ä¸ºçˆ¬è™« ã€‚</strong></li><li><code>Content-Type</code>: ä¹Ÿå«äº’è”ç½‘åª’ä½“ç±»å‹( Internet Media Type )æˆ–è€… MIMEç±»å‹ï¼Œåœ¨ HTTPåè®®æ¶ˆæ¯å¤´ä¸­ï¼Œå®ƒç”¨æ¥è¡¨ç¤ºå…·ä½“è¯·æ±‚ä¸­çš„åª’ä½“ç±»å‹ä¿¡æ¯ã€‚è¯·æ±‚å¤´æ˜¯è¯·æ±‚çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œåœ¨å†™çˆ¬è™«æ—¶ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½éœ€è¦è®¾å®šè¯·æ±‚å¤´ã€‚<ul><li>text/html ä»£è¡¨ HTML æ ¼å¼</li><li>image/gifä»£è¡¨ GIF å›¾ç‰‡</li><li>application/jsonä»£è¡¨ JSONç±»å‹</li><li>è¯¦è§ <a href="http://tool.oschina.net/commons/">Content-Type è¯·æ±‚å¤´æ˜¯è¯·æ±‚çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œåœ¨å†™çˆ¬è™«æ—¶ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½éœ€è¦è®¾å®šè¯·æ±‚å¤´ã€‚å¯¹ç…§è¡¨</a></li></ul></li></ul></li><li><p><strong>è¯·æ±‚ä½“</strong>ï¼ˆRequest Bodyï¼‰ï¼š</p><ul><li><code>POST</code> çš„è¯·æ±‚ä½“æ˜¯è¡¨å•æ•°æ®;</li><li><code>GET</code> çš„è¯·æ±‚ä½“ä¸ºç©º;</li></ul></li></ul><h3 id="å“åº”ï¼ˆResponseï¼‰"><a href="#å“åº”ï¼ˆResponseï¼‰" class="headerlink" title="å“åº”ï¼ˆResponseï¼‰"></a>å“åº”ï¼ˆResponseï¼‰</h3><p>å“åº”ï¼Œç”± <strong>æœåŠ¡ç«¯</strong> è¿”å›ç»™ <strong>å®¢æˆ·ç«¯</strong>ï¼š</p><ul><li><strong>å“åº”çŠ¶æ€ç </strong>ï¼ˆResponse Status Codeï¼‰ï¼šè¡¨ç¤ºæœåŠ¡å™¨çš„å“åº”çŠ¶æ€<ul><li>HTTPçŠ¶æ€ç åˆ†ç±»ï¼Œå…·ä½“HTTPçŠ¶æ€ç åˆ—è¡¨ï¼Œè§<a href="http://www.runoob.com/http/http-status-codes.html">HTTPçŠ¶æ€ç </a></li></ul></li></ul><table><thead><tr><th>åˆ†ç±»</th><th>åˆ†ç±»æè¿°</th></tr></thead><tbody><tr><td>1**</td><td>ä¿¡æ¯ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œéœ€è¦è¯·æ±‚è€…ç»§ç»­æ‰§è¡Œæ“ä½œ</td></tr><tr><td>2**</td><td>æˆåŠŸï¼Œæ“ä½œè¢«æˆåŠŸæ¥æ”¶å¹¶å¤„ç†</td></tr><tr><td>3**</td><td>é‡å®šå‘ï¼Œéœ€è¦è¿›ä¸€æ­¥çš„æ“ä½œä»¥å®Œæˆè¯·æ±‚</td></tr><tr><td>4**</td><td>å®¢æˆ·ç«¯é”™è¯¯ï¼Œè¯·æ±‚åŒ…å«è¯­æ³•é”™è¯¯æˆ–æ— æ³•å®Œæˆè¯·æ±‚</td></tr><tr><td>5**</td><td>æœåŠ¡å™¨é”™è¯¯ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯</td></tr></tbody></table><ul><li><p><strong>å“åº”å¤´</strong>ï¼ˆResponse Headersï¼‰: å“åº”å¤´åŒ…å«äº†æœåŠ¡å™¨å¯¹è¯·æ±‚çš„åº”ç­”ä¿¡æ¯</p><ul><li><code>Date</code>: æ ‡è¯† <strong>å“åº”äº§ç”Ÿçš„æ—¶é—´</strong></li><li><code>Last-Modified</code>: æŒ‡å®š <strong>èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´</strong></li><li><code>Content-Encoding</code>: æŒ‡å®šå“åº” <strong>å†…å®¹çš„ç¼–ç </strong></li><li><code>Server</code>: åŒ…å« <strong>æœåŠ¡å™¨çš„ä¿¡æ¯</strong>ï¼Œæ¯”å¦‚åç§°ã€ç‰ˆæœ¬å·ç­‰</li><li><code>Content-Type</code>: æ–‡æ¡£ç±»å‹ï¼ŒæŒ‡å®š <strong>è¿”å›çš„æ•°æ®ç±»å‹</strong> æ˜¯ä»€ä¹ˆï¼ˆå’Œ Request çš„ä¸€æ ·ï¼‰</li><li><code>Set-Cookie</code>: <strong>è®¾ç½® Cookies</strong>ã€‚å‘Šè¯‰æµè§ˆå™¨éœ€è¦å°†æ­¤å†…å®¹æ”¾åœ¨ Cookies ä¸­ï¼Œ ä¸‹æ¬¡è¯·æ±‚æºå¸¦ Cookies è¯·æ±‚</li><li><code>Expires</code>: <strong>æŒ‡å®šå“åº”çš„è¿‡æœŸæ—¶é—´</strong>ï¼Œå¯ä»¥ä½¿ä»£ç†æœåŠ¡å™¨æˆ–æµè§ˆå™¨å°†åŠ è½½çš„å†…å®¹æ›´æ–°åˆ°ç¼“å­˜ä¸­ã€‚å¦‚æœå†æ¬¡è®¿é—®æ—¶ï¼Œå°±å¯ä»¥ç›´æ¥ä»<strong>ç¼“å­˜</strong>ä¸­åŠ è½½ï¼Œé™ä½æœåŠ¡å™¨è´Ÿè½½ï¼Œç¼©çŸ­åŠ è½½æ—¶é—´ã€‚</li></ul></li><li><p><strong>å“åº”ä½“</strong>ï¼ˆResponse Bodyï¼‰å“åº”çš„æ­£æ–‡æ•°æ®éƒ½åœ¨å“åº”ä½“ä¸­</p><ul><li>è¯·æ±‚ç½‘é¡µæ—¶ï¼Œå®ƒçš„å“åº”ä½“å°± æ˜¯ç½‘é¡µçš„ HTMLä»£ç </li><li>è¯·æ±‚ä¸€å¼ å›¾ç‰‡æ—¶ï¼Œ å®ƒçš„å“åº”ä½“å°±æ˜¯å›¾ç‰‡çš„äºŒè¿›åˆ¶æ•°æ®</li><li>æˆ‘ä»¬åšçˆ¬è™«è¯·æ±‚ç½‘é¡µåï¼Œè¦è§£æçš„å†…å®¹å°±æ˜¯å“åº”ä½“</li></ul></li></ul><h2 id="ç½‘é¡µåŸºç¡€"><a href="#ç½‘é¡µåŸºç¡€" class="headerlink" title="ç½‘é¡µåŸºç¡€"></a>ç½‘é¡µåŸºç¡€</h2><p>ç½‘é¡µåˆ†ä¸ºä¸‰å¤§éƒ¨åˆ† â€”â€”â€”â€” HTMLï¼ˆæ¡†æ¶ï¼‰ï¼ŒCSSï¼ˆæ ·å¼ï¼‰ï¼ŒJavaScriptï¼ˆé€»è¾‘ï¼‰ã€‚</p><h3 id="HTML-è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€"><a href="#HTML-è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€" class="headerlink" title="HTML, è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€"></a>HTML, è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€</h3><p>è¯¦è§ <a href="http://www.w3school.com.cn/html/index.asp">HTML æ•™ç¨‹</a>ã€‚</p><p>Another recommended HTML guide: <a href="https://www.websiteplanet.com/blog/html-guide-beginners/">https://www.websiteplanet.com/blog/html-guide-beginners/</a></p><h3 id="CSS-å±‚å æ ·å¼è¡¨"><a href="#CSS-å±‚å æ ·å¼è¡¨" class="headerlink" title="CSS, å±‚å æ ·å¼è¡¨"></a>CSS, å±‚å æ ·å¼è¡¨</h3><p>è¯¦è§ <a href="http://www.w3school.com.cn/css/index.asp">CSS æ•™ç¨‹</a></p><h3 id="JavaScript-è„šæœ¬è¯­è¨€"><a href="#JavaScript-è„šæœ¬è¯­è¨€" class="headerlink" title="JavaScript, è„šæœ¬è¯­è¨€"></a>JavaScript, è„šæœ¬è¯­è¨€</h3><p>è¯¦è§ <a href="http://www.w3school.com.cn/js/index.asp">JavaScript æ•™ç¨‹</a></p><h3 id="ç½‘é¡µç»“æ„"><a href="#ç½‘é¡µç»“æ„" class="headerlink" title="ç½‘é¡µç»“æ„"></a>ç½‘é¡µç»“æ„</h3><p>åœ¨ HTML ä¸­ï¼Œæ‰€æœ‰æ ‡ç­¾å®šä¹‰çš„å†…å®¹éƒ½æ˜¯èŠ‚ç‚¹ï¼Œå®ƒä»¬æ„æˆäº†ä¸€ä¸ª HTML DOM æ ‘ã€‚ï¼ˆDOMï¼šæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰<br>é€šè¿‡ HTML DOMï¼Œæ ‘ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹å‡å¯é€šè¿‡ JavaScriptè®¿é—®ï¼Œæ‰€æœ‰ HTML èŠ‚ç‚¹å…ƒç´ å‡å¯è¢«ä¿®æ”¹ï¼Œä¹Ÿå¯ä»¥è¢«åˆ›å»ºæˆ–åˆ é™¤ ã€‚</p><p>è¯¦è§ <a href="http://www.w3school.com.cn/htmldom/index.asp">HTML DOM æ•™ç¨‹</a></p><h3 id="é€‰æ‹©å™¨"><a href="#é€‰æ‹©å™¨" class="headerlink" title="é€‰æ‹©å™¨"></a>é€‰æ‹©å™¨</h3><p>åœ¨ css ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ css é€‰æ‹©å™¨æ¥å®šä½èŠ‚ç‚¹ã€‚</p><p>è¯¦è§ <a href="http://www.w3school.com.cn/cssref/css_selectors.asp">CSS é€‰æ‹©å™¨è¡¨</a></p><h2 id="çˆ¬è™«çš„åŸºæœ¬åŸç†"><a href="#çˆ¬è™«çš„åŸºæœ¬åŸç†" class="headerlink" title="çˆ¬è™«çš„åŸºæœ¬åŸç†"></a>çˆ¬è™«çš„åŸºæœ¬åŸç†</h2><p>çˆ¬è™«æ˜¯<strong>è·å–</strong>ç½‘é¡µå¹¶<strong>æå–</strong>å’Œ<strong>ä¿å­˜</strong>ä¿¡æ¯çš„<strong>è‡ªåŠ¨åŒ–ç¨‹åº</strong>ã€‚</p><p>å¯ä»¥è¯´ï¼Œæˆ‘ä»¬èƒ½åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°çš„ä¸€åˆ‡å†…å®¹ï¼Œéƒ½å¯ä»¥é€šè¿‡çˆ¬è™«å¾—åˆ°ï¼ˆåŒ…æ‹¬é‚£äº›ç”±JavaScriptæ¸²æŸ“å‡ºæ¥çš„ç½‘é¡µï¼‰ã€‚</p><p>çˆ¬è™«ä¸»è¦è§£å†³ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p><h4 id="è·å–ç½‘é¡µ"><a href="#è·å–ç½‘é¡µ" class="headerlink" title="è·å–ç½‘é¡µ"></a>è·å–ç½‘é¡µ</h4><p>æ„é€ ä¸€ä¸ªè¯·æ±‚å¹¶å‘é€ç»™æœåŠ¡å™¨ï¼Œç„¶åæ¥æ”¶åˆ°å“åº”å¹¶å°†å…¶è§£æå‡ºæ¥ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç”¨urllibã€ requests ç­‰åº“æ¥å¸®åŠ©æˆ‘ä»¬å®ç° HTTPè¯·æ±‚æ“ä½œï¼Œè¯·æ±‚å’Œå“åº”éƒ½å¯ä»¥ç”¨ç±»åº“æä¾›çš„æ•°æ®ç»“æ„æ¥è¡¨ç¤ºï¼Œå¾—åˆ°å“åº”ä¹‹ååªéœ€è¦è§£ææ•°æ®ç»“æ„ä¸­çš„ Body éƒ¨åˆ†å³å¯ï¼Œå³å¾—åˆ°ç½‘é¡µçš„æºä»£ç ã€‚</p><h4 id="æå–ä¿¡æ¯"><a href="#æå–ä¿¡æ¯" class="headerlink" title="æå–ä¿¡æ¯"></a>æå–ä¿¡æ¯</h4><p>åˆ†æç½‘é¡µæºä»£ç ï¼Œä»ä¸­æå–æˆ‘ä»¬æƒ³è¦çš„æ•°æ®ã€‚ </p><p>æœ€é€šç”¨çš„æ–¹æ³•æ˜¯é‡‡ç”¨ <strong>æ­£åˆ™è¡¨è¾¾å¼</strong> æå–ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸‡èƒ½çš„æ–¹æ³•ï¼Œä½†æ˜¯åœ¨æ„é€ æ­£åˆ™è¡¨è¾¾å¼æ—¶æ¯”è¾ƒå¤æ‚ä¸”å®¹æ˜“å‡ºé”™ã€‚<br>ä½¿ç”¨ Beautiful Soupã€ pyqueryã€ lxml ç­‰åº“ï¼Œæˆ‘ä»¬å¯ä»¥é«˜æ•ˆå¿«é€Ÿåœ°ä»ä¸­æ å–ç½‘é¡µä¿¡æ¯ï¼Œå¦‚èŠ‚ç‚¹çš„å±æ€§ã€æ–‡æœ¬å€¼ç­‰ã€‚</p><h4 id="ä¿å­˜æ•°æ®"><a href="#ä¿å­˜æ•°æ®" class="headerlink" title="ä¿å­˜æ•°æ®"></a>ä¿å­˜æ•°æ®</h4><p>å°†æå–åˆ°çš„æ•°æ®ä¿å­˜åˆ°æŸå¤„ä»¥ä¾¿åç»­ä½¿ç”¨ã€‚ </p><h4 id="è‡ªåŠ¨åŒ–ç¨‹åº"><a href="#è‡ªåŠ¨åŒ–ç¨‹åº" class="headerlink" title="è‡ªåŠ¨åŒ–ç¨‹åº"></a>è‡ªåŠ¨åŒ–ç¨‹åº</h4><p>è®©çˆ¬è™«æ¥ä»£æ›¿äººï¼Œå®Œæˆä¸Šè¿°è¿™äº›æ“ä½œã€‚<br>å¹¶åœ¨æŠ“å–è¿‡ç¨‹ä¸­è¿›è¡Œå„ç§å¼‚å¸¸å¤„ç†ã€é”™è¯¯é‡è¯•ç­‰æ“ä½œï¼Œç¡®ä¿çˆ¬å–æŒç»­é«˜æ•ˆåœ°è¿è¡Œã€‚</p><h2 id="ä¼šè¯-å’Œ-Cookies"><a href="#ä¼šè¯-å’Œ-Cookies" class="headerlink" title="ä¼šè¯ å’Œ Cookies"></a>ä¼šè¯ å’Œ Cookies</h2><p>HTTP æœ¬èº«æ˜¯<em>æ— çŠ¶æ€</em>çš„ï¼Œè¿™æ˜¯æŒ‡ HTTP åè®®å¯¹äº‹ç‰©çš„å¤„ç†æ˜¯æ²¡æœ‰è®°å¿†èƒ½åŠ›çš„ã€‚<br>æ¢è¨€ä¹‹ï¼ŒæœåŠ¡å™¨ ä¸çŸ¥é“ å®¢æˆ·ç«¯æ˜¯è¯´æ˜çŠ¶æ€ã€‚</p><p>ç„¶è€Œï¼Œæˆ‘ä»¬æ—¥å¸¸æ¥è§¦çš„å¾ˆå¤šç½‘é¡µéƒ½å¯ä»¥å®ç°ç”¨æˆ·ç™»å½•ç­‰éœ€è¦æœåŠ¡å™¨<em>è®°ä½</em>å®¢æˆ·ç«¯çš„æ“ä½œã€‚<br>å®ç°è¿™ä¸€ç±»æ“ä½œï¼Œå°±ä¼šç”¨åˆ° <strong>ä¼šè¯</strong> å’Œ <strong>Cookies</strong>ã€‚</p><h4 id="ä¼šè¯"><a href="#ä¼šè¯" class="headerlink" title="ä¼šè¯"></a>ä¼šè¯</h4><p><strong>ä¼šè¯</strong>ï¼Œæ˜¯ä¸€ç³»åˆ—æœ‰å§‹æœ‰ç»ˆçš„åŠ¨ä½œ/æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼Œä»æ‹¿èµ·ç”µè¯æ‹¨å·åˆ°æŒ‚æ–­ ç”µè¯è¿™ä¸­é—´çš„ä¸€ç³»åˆ—è¿‡ç¨‹å¯ä»¥ç§°ä¸ºä¸€ä¸ªä¼šè¯ã€‚ </p><p>åœ¨ Web ä¸­ï¼Œ<strong>ä¼šè¯å¯¹è±¡</strong> ç”¨æ¥å­˜å‚¨ç‰¹å®šç”¨æˆ·ä¼šè¯æ‰€éœ€çš„å±æ€§åŠé…ç½®ä¿¡æ¯ã€‚</p><p>å½“ç”¨æˆ·åœ¨åº”ç”¨ç¨‹åºçš„ Web é¡µä¹‹é—´è·³è½¬æ—¶ï¼Œå­˜å‚¨åœ¨ä¼šè¯å¯¹è±¡ä¸­çš„å˜é‡å°†ä¸ä¼šä¸¢å¤±ï¼ˆå¦‚ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼‰ï¼›<br>å½“ç”¨æˆ·è¯·æ±‚æ¥è‡ªåº”ç”¨ç¨‹åºçš„ Web é¡µæ—¶å¦‚æœè¯¥ç”¨æˆ·è¿˜æ²¡æœ‰ä¼šè¯ï¼Œåˆ™æœåŠ¡å™¨å°†è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªä¼šè¯å¯¹è±¡ ï¼›<br>å½“ä¼šè¯è¿‡æœŸæˆ–è¢«æ”¾å¼ƒåï¼ŒæœåŠ¡å™¨å°†ç»ˆæ­¢è¯¥ä¼šè¯ï¼›</p><h4 id="Cookies"><a href="#Cookies" class="headerlink" title="Cookies"></a>Cookies</h4><p>CookiesæŒ‡æŸäº›ç½‘ç«™ä¸ºäº†è¾¨åˆ«ç”¨æˆ·èº«ä»½ã€è¿›è¡Œä¼šè¯è·Ÿè¸ªè€Œå­˜å‚¨åœ¨ç”¨æˆ·æœ¬åœ°ç»ˆç«¯ä¸Šçš„æ•°æ®ã€‚</p><p>æœåŠ¡å™¨å¯ä»¥é€šè¿‡ Cookies å¾—çŸ¥ é‚£ä¸ªå®¢æˆ·ç«¯å¯¹åº”ç€é‚£ä¸ªä¼šè¯ã€é‚£ä¸ªç”¨æˆ·ã€‚<br>åœ¨ <strong>å®¢æˆ·ç«¯</strong> çš„ <em>Cookies</em> å’Œ <strong>æœåŠ¡ç«¯</strong> çš„ <em>ä¼šè¯</em> çš„åä½œä¸‹ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥å®ç°ä¼šè¯çš„ç»´æŒã€‚</p><p>Cookieæœ‰å¦‚ä¸‹å‡ ä¸ªå±æ€§ ï¼š</p><ul><li><p><code>Name</code>: è¯¥ Cookie çš„åç§°ã€‚ä¸€æ—¦åˆ›å»ºï¼Œè¯¥åç§°ä¾¿ä¸å¯æ›´æ”¹ã€‚ </p></li><li><p><code>Value</code>: è¯¥ Cookie çš„å€¼ã€‚</p><ul><li>å¦‚æœå€¼ä¸º <code>Unicode</code> å­—ç¬¦ï¼Œéœ€è¦ä¸ºå­—ç¬¦ç¼–ç ã€‚</li><li>å¦‚æœå€¼ä¸ºäºŒè¿›åˆ¶æ•°æ®ï¼Œåˆ™éœ€è¦ä½¿ç”¨ <code>BASE64</code> ç¼–ç ã€‚</li></ul></li><li><p><code>Domain</code>: å¯ä»¥è®¿é—®è¯¥ Cookieçš„åŸŸåã€‚ä¾‹å¦‚ï¼Œå¦‚æœè®¾ç½®ä¸º <code>.zhihu.com</code>ï¼Œåˆ™æ‰€æœ‰ä»¥ <code>zhihu.com</code> ç»“å°¾çš„åŸŸåéƒ½å¯ä»¥è®¿é—®è¯¥ Cookieã€‚</p></li><li><p><code>MaxAge</code>: è¯¥ Cookieå¤±æ•ˆçš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’ï¼Œä¹Ÿå¸¸å’Œ <code>Expires</code> ä¸€èµ·ä½¿ç”¨ï¼Œé€šè¿‡å®ƒå¯ä»¥è®¡ç®—æœ‰æ•ˆæ—¶é—´ã€‚</p><ul><li>MaxAge å¦‚æœä¸ºæ­£æ•°ï¼Œåˆ™è¯¥Cookieåœ¨MaxAgeç§’ä¹‹åå¤±æ•ˆã€‚</li><li>å¦‚æœä¸ºè´Ÿæ•°ï¼Œåˆ™å…³é—­ æµè§ˆå™¨æ—¶ Cookie å³å¤±æ•ˆï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šä»¥ä»»ä½•å½¢å¼ä¿å­˜è¯¥ Cookieã€‚  </li></ul></li><li><p><code>Path</code> : è¯¥ Cookie çš„ä½¿ç”¨è·¯å¾„ã€‚<br>å¦‚æœè®¾ç½®ä¸º <code>/path/</code>ï¼Œåˆ™åªæœ‰è·¯å¾„ä¸º <code>/path/</code> çš„é¡µé¢å¯ä»¥è®¿é—®è¯¥ Cookieã€‚<br>å¦‚æœè®¾ç½®ä¸º <code>/</code> åˆ™æœ¬åŸŸåä¸‹çš„æ‰€æœ‰é¡µé¢éƒ½å¯ä»¥è®¿é—®è¯¥ Cookieã€‚</p></li><li><p><code>Size</code>å­—æ®µ: æ­¤ Cookie çš„å¤§å°ã€‚</p></li><li><p><code>HTTP</code> å­—æ®µ: Cookie çš„ httponly å±æ€§ã€‚</p><ul><li>è‹¥æ­¤å±æ€§ä¸º trueï¼Œåˆ™åªæœ‰åœ¨ HTTP å¤´ä¸­ä¼šå¸¦æœ‰æ­¤ Cookieçš„ä¿¡æ¯ï¼Œè€Œä¸èƒ½é€šè¿‡ document.cookieæ¥è®¿é—®æ­¤ Cookieã€‚</li></ul></li><li><p><code>Secure</code>: è¯¥ Cookie æ˜¯å¦ä»…è¢«ä½¿ç”¨å®‰å…¨åè®®ä¼ è¾“ã€‚å®‰å…¨åè®®æœ‰ HTTPS å’Œ SSL ç­‰ï¼Œåœ¨ç½‘ç»œä¸Šä¼ è¾“æ•°æ®ä¹‹å‰å…ˆå°†æ•°æ®åŠ å¯†ã€‚é»˜è®¤ä¸º falseã€‚ </p></li></ul><h2 id="ä»£ç†çš„åŸºæœ¬åŸç†"><a href="#ä»£ç†çš„åŸºæœ¬åŸç†" class="headerlink" title="ä»£ç†çš„åŸºæœ¬åŸç†"></a>ä»£ç†çš„åŸºæœ¬åŸç†</h2><p>åœ¨æˆ‘ä»¬æ­£å¸¸è¯·æ±‚ä¸€ä¸ªç½‘ç«™æ—¶ï¼Œæˆ‘ä»¬ç›´æ¥æŠŠè¯·æ±‚å‘ç»™äº†WebæœåŠ¡å™¨ï¼ŒWebæœåŠ¡å™¨åˆç›´æ¥æŠŠå“åº”å›ä¼ ç»™æˆ‘ä»¬ã€‚</p><p>è€Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ <strong>ä»£ç†æœåŠ¡</strong>ï¼Œå°±ç­‰äºæ˜¯å¤šäº†ä¸€ä¸ªä¸­é—´äººï¼Œå³<em>ä»£ç†æœåŠ¡å™¨</em>ï¼Œè¿™ä¸ªè¿‡ç¨‹å˜æˆäº†ï¼š<br>æˆ‘ä»¬ç›´æ¥æŠŠè¯·æ±‚å‘ç»™ ä»£ç†æœåŠ¡å™¨ï¼Œä»£ç†æœåŠ¡å™¨ æŠŠå“åº”å›ä¼ ç»™ ä»£ç†æœåŠ¡å™¨ï¼Œä»£ç†æœåŠ¡å™¨å†æŠŠè¿™ä¸ªæ¶ˆæ¯ä¼ ç»™æˆ‘ä»¬ã€‚</p><p>é€šè¿‡ä»£ç†ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¼ªè£…IPï¼Œé˜²åˆ¶åœ¨çˆ¬è™«æ—¶è¢«æŸ¥å‡ºæ¥å°IPæˆ–äº‹éœ€è¦æä¾›éªŒè¯ç ï¼Œå½±å“çˆ¬è™«è¿è¡Œã€‚</p><p>âš ï¸ã€æ³¨æ„ã€‘å¹¶ä¸æ˜¯æ‰€æœ‰çš„ ä»£ç† éƒ½å¯ä»¥è®©æˆ‘ä»¬éšè— IPï¼<br>æœ‰çš„ ä»£ç†æœåŠ¡ ä¼šåœ¨å‘ webæœåŠ¡å™¨ çš„è¯·æ±‚ æ—¶ï¼Œä¸ä¼šåŸå°ä¸åŠ¨çš„è½¬å‘æˆ‘ä»¬çš„æ¶ˆæ¯ï¼Œè€Œæ˜¯åœ¨å…¶ä¸­æ·»åŠ ä¸Šæˆ‘ä»¬çš„çœŸå®IPç­‰ä¿¡æ¯ï¼Œè¿™æ—¶å°±éšè—ä¸äº†äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Crawler </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crawler </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python3çˆ¬è™«ç¯å¢ƒé…ç½®</title>
      <link href="/2019/02/09/PythonAndCrawler/crawler-0-env/"/>
      <url>/2019/02/09/PythonAndCrawler/crawler-0-env/</url>
      
        <content type="html"><![CDATA[<h1 id="å¼€å‘ç¯å¢ƒé…ç½®"><a href="#å¼€å‘ç¯å¢ƒé…ç½®" class="headerlink" title="å¼€å‘ç¯å¢ƒé…ç½®"></a>å¼€å‘ç¯å¢ƒé…ç½®</h1><blockquote><p>æœ¬æ–‡ä¸»è¦ä»‹ç» Python 3 ç½‘ç»œçˆ¬è™« æ‰€éœ€è¦çš„è½¯ä»¶çš„å®‰è£…åŠé…ç½®ã€‚</p></blockquote><h2 id="å¼€å‘ç¯å¢ƒ"><a href="#å¼€å‘ç¯å¢ƒ" class="headerlink" title="å¼€å‘ç¯å¢ƒ"></a>å¼€å‘ç¯å¢ƒ</h2><ul><li>æˆ‘ä»¬åœ¨ <code>macOS X</code> ä¸Šä½¿ç”¨ <code>Python 3.7</code> æ¥å¼€å‘çˆ¬è™«ã€‚</li></ul><h2 id="è¯·æ±‚åº“-å®‰è£…"><a href="#è¯·æ±‚åº“-å®‰è£…" class="headerlink" title="è¯·æ±‚åº“ å®‰è£…"></a><strong>è¯·æ±‚åº“</strong> å®‰è£…</h2><p>ç½‘ç»œçˆ¬è™«ï¼Œé¦–å…ˆè¦è·å–ç½‘ç»œä¸Šçš„æ•°æ®ï¼Œå³æŠ“å–é¡µé¢ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬æ¨¡æ‹Ÿæµè§ˆå™¨å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ã€‚<br>æˆ‘ä»¬å¯ä»¥å®‰è£…ä¸€äº› Python åº“æ¥å¸®åŠ©æˆ‘ä»¬æ¯”è¾ƒå®¹æ˜“åœ°å®Œæˆè¿™ä¸ªæ“ä½œã€‚</p><p>è®©æˆ‘ä»¬æ¥å®‰è£…å®ƒä»¬å§ï¼š</p><ul><li><p><strong>requests</strong> : ç½‘ç»œè¯·æ±‚: </p><ul><li><code>pip3 inastal requests</code></li></ul></li><li><p><strong>Selenium</strong> : è‡ªåŠ¨æµ‹è¯•å·¥å…·ï¼ˆé©±åŠ¨æµè§ˆå™¨æ‰§è¡Œç‰¹å®šçš„åŠ¨ä½œï¼Œå¦‚ç‚¹å‡»ã€ä¸‹æ‹‰ç­‰ æ“ä½œ ï¼‰:</p><ul><li> <code>pip3 install selenium</code></li></ul></li><li><p><strong>ChromeDriver</strong> : ç”¨ <em>Chrome</em> ä¸ Selenium é…åˆå·¥ä½œ:</p><ul><li>å®‰è£… Chrome æµè§ˆå™¨</li><li>åœ¨ Chrome èœå•ï¼ˆâ€œÂ·Â·Â·â€ï¼‰ -&gt; â€œå…³äº Google Chromeâ€ï¼ŒæŸ¥çœ‹å½“å‰Chromeç‰ˆæœ¬ã€‚</li><li>ä» <a href="http://chromedriver.chromium.org/">ChromeDriverå®˜ç½‘</a> ä¸‹è½½é…å¯¹ Chrome ç‰ˆæœ¬çš„ ChromeDriverï¼ˆâš ï¸ã€æ³¨æ„ã€‘ChromeDriver ä¸€å®šè¦ä¸ Chrome çš„ç‰ˆæœ¬å…¼å®¹ï¼ï¼‰ã€‚</li><li>è§£å‹ä¸‹è½½çš„æ–‡ä»¶ï¼Œå¾—åˆ°å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå°†å…¶åŠ å…¥ç¯å¢ƒå˜é‡ï¼ˆå¯ä»¥ç®€å•åœ°æŠŠå®ƒæ”¾åˆ°ç¯å¢ƒå˜é‡ä¸­æœ‰çš„ç›®å½•ä¸‹ï¼‰ã€‚</li></ul></li><li><p><strong>GeckoDriver</strong>: ç”¨ <em>Firefox</em> ä¸ Selenium é…åˆå·¥ä½œ:</p><ul><li><em>æš‚æ—¶å¹¶æ²¡æœ‰ä½¿ç”¨ Firefoxï¼Œæ‰€ä»¥æ²¡æœ‰å®‰è£…è¿™ä¸ªğŸ˜‚ã€‚</em></li></ul></li><li><p>~~<strong>PhantomJS</strong>: è¿˜æ˜¯é…åˆ Selenium å·¥ä½œçš„:</p><ul><li>(PhantomJS ç®€ä»‹)PhantomJSæ˜¯ä¸€ä¸ªæ— ç•Œé¢çš„ã€å¯è„šæœ¬ç¼–ç¨‹çš„ WebKitæµè§ˆå™¨å¼•æ“ï¼Œå®ƒåŸç”Ÿæ”¯æŒå¤šç§ Webæ ‡å‡†: DOMæ“ä½œã€ cssé€‰æ‹©å™¨ã€ JSONã€ Canvasä»¥åŠ SVGã€‚Seleniumæ”¯æŒ PhantomJSï¼Œè¿™æ ·åœ¨è¿è¡Œçš„æ—¶å€™å°±ä¸ä¼šå†å¼¹å‡º ä¸€ä¸ªæµè§ˆå™¨äº† ã€‚ è€Œä¸” PhantomJS çš„è¿è¡Œæ•ˆç‡ä¹Ÿå¾ˆé«˜ï¼Œè¿˜æ”¯æŒå„ç§å‚æ•°é…ç½®ï¼Œä½¿ç”¨éå¸¸æ–¹ä¾¿ã€‚</li><li>ä» <a href="http://phantomjs.org/">PhantomJSå®˜ç½‘</a> ä¸‹è½½ PhantomJSã€‚</li><li>å°†ä¸‹è½½å¾—åˆ°çš„ç›®å½•ä¸­çš„ å¯æ‰§è¡Œæ–‡ä»¶ åŠ å…¥ç¯å¢ƒå˜é‡ã€‚</li><li>âš ï¸ã€æ³¨æ„ã€‘åœ¨ 2018å¹´3æœˆ4æ—¥ï¼Œ PhantomJS å®£å¸ƒ<a href="https://github.com/ariya/phantomjs/issues/15344">æš‚åœå¼€å‘</a>äº†ï¼Selenium ä¹Ÿä¸å†èµåŒä½¿ç”¨ PhantomJSäº†ã€‚~~</li></ul></li><li><p><strong>aiohttp</strong>: ä¸€ä¸ªå¼‚æ­¥çš„ Web æœåŠ¡åº“ï¼ˆç›¸æ¯”ä¹‹ä¸‹ <code>requests</code> æ˜¯é˜»å¡å¼çš„ï¼‰:</p><ul><li><code>pip3 install aiohttp</code></li></ul></li><li><p><strong>cchardet</strong>: å­—ç¬¦ç¼–ç æ£€æµ‹åº“ï¼ˆaiohttpå®˜æ–¹æ¨èå®‰è£…çš„ï¼‰:</p><ul><li><code>pip3 install cchardet</code></li></ul></li><li><p><strong>aiodns</strong>: åŠ é€Ÿ DNS çš„è§£æåº“ï¼ˆaiohttpå®˜æ–¹æ¨èå®‰è£…çš„ï¼‰:</p><ul><li><code>pip3 install aiodns</code></li></ul></li></ul><h2 id="è§£æåº“-å®‰è£…"><a href="#è§£æåº“-å®‰è£…" class="headerlink" title="è§£æåº“ å®‰è£…"></a><strong>è§£æåº“</strong> å®‰è£…</h2><p>æŠ“å–ç½‘é¡µä¹‹åï¼Œæˆ‘ä»¬å°±è¦ä»ä¸­æå–æœ‰ç”¨çš„ä¿¡æ¯äº†ã€‚<br>æˆ‘ä»¬å½“ç„¶å¯ä»¥ä½¿ç”¨ä»¤äººæœ›è€Œç”Ÿç•çš„ <strong>æ­£åˆ™è¡¨è¾¾å¼</strong> æ¥å®Œæˆè¿™ä¸€æ“ä½œï¼›<br>ä¸è¿‡ï¼Œæœ‰å¾ˆå¤šå¼ºå¤§çš„åº“å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´ä¼˜é›…åœ°å¤„ç†è¿™ä¸€é—®é¢˜ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°†å®‰è£…è¿™äº›åº“ï¼š</p><ul><li><p><strong>lxml</strong>: ä¸€ä¸ª Python çš„ HTMLã€XML è§£æåº“ï¼Œæ”¯æŒXPath:</p><ul><li><code>pip3 install lxml</code></li><li>è¿™ä¸ªåº“å®‰è£…å¸¸æœ‰é—®é¢˜ï¼Œä¸»è¦å¯èƒ½æ˜¯ç¼ºå°‘å¿…è¦çš„åº“ï¼Œä¸åŒçš„å¹³å°ï¼Œè§£å†³åŠæ³•å·®å¼‚å¤ªå¤§ï¼Œåº”è‡ªè¡ŒGoogleã€‚</li></ul></li><li><p><strong>Beautiful Soup</strong>: ä¸€ä¸ª Python çš„ HTMLã€XML è§£æåº“ï¼Œæ‹¥æœ‰å¼ºå¤§çš„APIå’Œå¤šç§è§£ææ–¹å¼:</p><ul><li><code>pip3 install beautifulsoup4</code></li><li>âš ï¸ã€æ³¨æ„ã€‘Beautiful Soup å®‰è£…å¥½ä¹‹åçš„åº“åæ˜¯<code>bs4</code>ï¼Œæ‰€ä»¥ import çš„æ—¶å€™æ˜¯<code>import bs4</code>ã€‚</li></ul></li><li><p><strong>pyquery</strong>: ä¸€ä¸ªæä¾›äº†ç±»ä¼¼äº jQuery çš„è¯­æ³•çš„ HTML è§£æå·¥å…·ï¼Œæ”¯æŒ CSS é€‰æ‹©å™¨:</p><ul><li><code>pip3 install pyquery</code></li></ul></li><li><p><strong>tesserocr</strong>: ä¸€ä¸ª OCR åº“ï¼Œç”¨æ¥å¤„ç†éªŒè¯ç :</p><ul><li>tesserocr æ˜¯å¯¹ tesseract çš„ Python API å°è£…ï¼Œæ•…è¦å…ˆå®‰è£… <strong>tesseract</strong><ul><li><code>$ brew install imagemagick</code></li><li><code>$ brew install tesseract</code></li></ul></li><li><code>pip3 install tesserocr pillow</code></li><li>âš ï¸ è¿™æ—¶ï¼Œåœ¨ Mac ä¸Šè¯•å›¾ <code>&gt;&gt;&gt; import tesserocr</code> ä¼šé‡åˆ° <code>!strcmp(locale, &quot;C&quot;):Error:Assert failed:in file baseapi.cpp</code> çš„æ–­è¨€å¤±è´¥ï¼Œå¯¼è‡´ <code>Illegal instruction: 4</code> ä½¿ Python é”™è¯¯é€€å‡ºã€‚</li><li>è¦è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ <code>$ export LC_ALL=C</code>ï¼ˆä¸´æ—¶æ€§ï¼‰ï¼Œæˆ–æŠŠ <code>export LC_ALL=C</code> å†™å…¥ <code>~/.bashrc</code>ï¼ˆæ°¸ä¹…æ€§ï¼‰ã€‚</li></ul></li></ul><h2 id="æ•°æ®åº“-å®‰è£…"><a href="#æ•°æ®åº“-å®‰è£…" class="headerlink" title="æ•°æ®åº“ å®‰è£…"></a>æ•°æ®åº“ å®‰è£…</h2><ul><li><p><strong>MySQL</strong>: å…³ç³»å‹æ•°æ®åº“:</p><ul><li><code>$ brew install mysql</code></li></ul></li><li><p><strong>MongoDB</strong>: éå…³ç³»å‹æ•°æ®åº“:</p><ul><li><code>$ brew install mongodb</code></li></ul></li><li><p><strong>Redis</strong>: ä¸€ä¸ªåŸºäºå†…å­˜çš„é«˜æ•ˆéå…³ç³»å‹æ•°æ®åº“:</p><ul><li><code>$ brew install redis</code></li></ul></li></ul><h2 id="å‚¨å­˜åº“-å®‰è£…"><a href="#å‚¨å­˜åº“-å®‰è£…" class="headerlink" title="å‚¨å­˜åº“ å®‰è£…"></a><strong>å‚¨å­˜åº“</strong> å®‰è£…</h2><p>å‚¨å­˜åº“ æ˜¯è®© Python ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰å®‰è£…å¥½çš„æ•°æ®åº“çš„åº“ã€‚</p><ul><li><p><strong>PyMySQL</strong>: è®© Python ä¸ MySQL äº¤äº’:</p><ul><li><code>pip3 install pymysql</code></li></ul></li><li><p><strong>PyMongo</strong>: è®© Python ä¸ MongoDB äº¤äº’:</p><ul><li><code>pip3 install pymongo</code></li></ul></li><li><p><strong>redis-py</strong>: è®© Python ä¸ Redis äº¤äº’:</p><ul><li><code>pip3 install redis</code></li></ul></li><li><p><strong>RedisDump</strong>: ä¸€ä¸ªç”¨äº Redis æ•°æ®å¯¼å…¥/å¯¼å‡ºçš„å·¥å…·ï¼ŒåŸºäºRuby:</p><ul><li>å®‰è£… RedisDump é¦–å…ˆè¦å®‰è£… <code>Ruby</code>ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ MacOS è‡ªå¸¦çš„ Rubyã€‚</li><li>ä½¿ç”¨ Ruby çš„ gemï¼ˆç±»ä¼¼äºpipï¼‰å®‰è£… RedisDumpï¼š<ul><li><code>$ sudo gem install redis-dump</code></li><li>âš ï¸ã€æ³¨æ„ã€‘ç”±äºå®‰è£…ç›®å½•æ˜¯ MacOS çš„ä¸€éƒ¨åˆ†ï¼Œå¿…é¡»è¦sudoï¼Œå¦åˆ™æ— æƒå®‰è£…ï¼</li></ul></li></ul></li></ul><h2 id="Webåº“-å®‰è£…"><a href="#Webåº“-å®‰è£…" class="headerlink" title="Webåº“ å®‰è£…"></a><strong>Webåº“</strong> å®‰è£…</h2><p>æˆ‘ä»¬éœ€è¦ç”¨åˆ° WebæœåŠ¡ç¨‹åº æ¥æ­å»ºä¸€äº› APIæ¥å£ï¼Œä¾›çˆ¬è™«ä½¿ç”¨ã€‚</p><ul><li><p><strong>Flask</strong>: ä¸€ä¸ªè½»é‡çº§ Web æœåŠ¡ç¨‹åºï¼Œè¿™é‡Œç”¨æ¥åšä¸€äº› API æœåŠ¡:</p><ul><li><code>pip3 install flask</code></li></ul></li><li><p><strong>Tornado</strong>: ä¸€ä¸ªå¼‚æ­¥çš„ Web æ¡†æ¶:</p><ul><li><code>pip3 install tornado</code></li></ul></li></ul><h2 id="Appçˆ¬å–ç›¸å…³åº“-å®‰è£…"><a href="#Appçˆ¬å–ç›¸å…³åº“-å®‰è£…" class="headerlink" title="Appçˆ¬å–ç›¸å…³åº“ å®‰è£…"></a><strong>Appçˆ¬å–ç›¸å…³åº“</strong> å®‰è£…</h2><h2 id="çˆ¬è™«æ¡†æ¶-å®‰è£…"><a href="#çˆ¬è™«æ¡†æ¶-å®‰è£…" class="headerlink" title="çˆ¬è™«æ¡†æ¶ å®‰è£…"></a><strong>çˆ¬è™«æ¡†æ¶</strong> å®‰è£…</h2><ul><li><p><strong>pyspider</strong>:</p><ul><li>é¦–å…ˆè¦<em>è§£å†³ä¸€ä¸ªä¾èµ–é—®é¢˜</em>ï¼š<code>$ PYCURL_SSL_LIBRARY=openssl LDFLAGS=&quot;-L/usr/local/opt/openssl/lib&quot; CPPFLAGS=&quot;-I/usr/local/opt/openssl/include&quot; pip3 install --no-cache-dir pycurl</code></li><li><code>$ pip3 install pyspider</code></li><li>pyspider v0.3.10 ä¸­ä½¿ç”¨äº†ä¸€ä¸ªåä¸º <code>async</code> çš„å˜é‡ï¼Œè¿™ä¸ªåå­—åœ¨ <code>Python 3.7</code> ä¸­è¢«åˆ—ä¸ºäº†ä¿ç•™å­—ï¼Œè¿™æ„å‘³ç€äºŒè€…åˆä½œå°†æ— æ³•è¿è¡Œï¼</li><li>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç®€å•åœ°æŠŠ pyspider æ¨¡å—ä¸­æ‰€æœ‰çš„ <code>async</code> æ›¿æ¢æˆäº† <code>async_</code>ğŸ˜‚ã€‚</li></ul></li><li><p><strong>Scrapy</strong>: </p><ul><li>å¤§å¤šæ•°çš„å®‰è£…æ•™ç¨‹éƒ½è¦å…ˆ: <code>$ xcode-select --install</code>ï¼Œä½†æˆ‘ä»¬è·³è¿‡äº†è¿™ä¸€æ­¥ï¼Œå¹¶æ²¡æœ‰é‡åˆ°é—®é¢˜ã€‚</li><li><code>pip3 install Scrapy</code></li></ul></li><li><p><strong>Scrapy-Splash</strong>: ä¸€ä¸ª Scripy ä¸­æ”¯æŒ JavaScript æ¸²æŸ“çš„å·¥å…·:</p><ul><li>è¿™æ˜¯ä¸€ä¸ªå®‰è£…çš„é“¾æ¡ï¼šScrapy-Splash &lt;- Splash &lt;- Docker</li><li>å®‰è£… <strong>Docker</strong>ï¼š<code>$ brew cask install docker</code></li><li>ç™»å½• <strong>Docker</strong>ï¼š<code>$ docker login</code></li><li>å®‰è£… <strong>Splash</strong>ï¼š<code>$ docker run -p 8050:8050 scrapinghub/splash</code></li><li>å®‰è£… <strong>Scrapy-Splash</strong>ï¼š<code>pip3 install scrapy-splash</code></li></ul></li><li><p><strong>Scrapy-Redis</strong>: Scrapy çš„åˆ†å¸ƒå¼æ‹“å±•æ¨¡å—:</p><ul><li><code>pip3 install scrapy_redis</code></li></ul></li></ul><h2 id="éƒ¨ç½²ç›¸å…³åº“çš„å®‰è£…"><a href="#éƒ¨ç½²ç›¸å…³åº“çš„å®‰è£…" class="headerlink" title="éƒ¨ç½²ç›¸å…³åº“çš„å®‰è£…"></a>éƒ¨ç½²ç›¸å…³åº“çš„å®‰è£…</h2><ul><li><p>å®‰è£… &amp; é…ç½® <strong>Docker</strong>ï¼š</p><ul><li><code>$ brew cask install docker</code></li><li><a href="https://www.daocloud.io/mirror">ä½¿ç”¨ Docker åŠ é€Ÿå™¨</a></li></ul></li><li><p>å®‰è£… <strong>Scrapyd</strong>ï¼š</p><ul><li><code>pip3 install scrapyd</code></li><li><code>$ sudo mkdir /etc/scrapyd</code></li><li><code>$ sudo vim /etc/scrapyd/scrapyd.conf</code>ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–ä»»ä½•æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ã€‚</li><li>åœ¨å…¶ä¸­å†™å…¥ä»¥ä¸‹å†…å®¹ï¼ˆä¸»è¦æ˜¯å‚è€ƒ<a href="https://scrapyd.readthedocs.io/en/stable/config.html#example">å®˜æ–¹æ–‡æ¡£</a>ï¼Œä½†åšäº†æœ‰é™çš„æ”¹åŠ¨ã€‚ï¼‰ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[scrapyd]</span><br><span class="line">eggs_dir    &#x3D; eggs</span><br><span class="line">logs_dir    &#x3D; logs</span><br><span class="line">items_dir   &#x3D;</span><br><span class="line">jobs_to_keep &#x3D; 5</span><br><span class="line">dbs_dir     &#x3D; dbs</span><br><span class="line">max_proc    &#x3D; 0</span><br><span class="line">max_proc_per_cpu &#x3D; 4</span><br><span class="line">finished_to_keep &#x3D; 100</span><br><span class="line">poll_interval &#x3D; 5.0</span><br><span class="line">bind_address &#x3D; 0.0.0.0</span><br><span class="line">http_port   &#x3D; 6800</span><br><span class="line">debug       &#x3D; off</span><br><span class="line">runner      &#x3D; scrapyd.runner</span><br><span class="line">application &#x3D; scrapyd.app.application</span><br><span class="line">launcher    &#x3D; scrapyd.launcher.Launcher</span><br><span class="line">webroot     &#x3D; scrapyd.website.Root</span><br><span class="line"></span><br><span class="line">[services]</span><br><span class="line">schedule.json     &#x3D; scrapyd.webservice.Schedule</span><br><span class="line">cancel.json       &#x3D; scrapyd.webservice.Cancel</span><br><span class="line">addversion.json   &#x3D; scrapyd.webservice.AddVersion</span><br><span class="line">listprojects.json &#x3D; scrapyd.webservice.ListProjects</span><br><span class="line">listversions.json &#x3D; scrapyd.webservice.ListVersions</span><br><span class="line">listspiders.json  &#x3D; scrapyd.webservice.ListSpiders</span><br><span class="line">delproject.json   &#x3D; scrapyd.webservice.DeleteProject</span><br><span class="line">delversion.json   &#x3D; scrapyd.webservice.DeleteVersion</span><br><span class="line">listjobs.json     &#x3D; scrapyd.webservice.ListJobs</span><br><span class="line">daemonstatus.json &#x3D; scrapyd.webservice.DaemonStatus</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>Scrapyrt</strong>:</p><ul><li><code>pip3 install scrapyrt</code></li></ul></li><li><p><strong>Gerapy</strong>:</p><ul><li><code>pip3 install gerapy</code></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> Crawler </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Crawler </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-9.2-awk</title>
      <link href="/2017/01/12/Linux/linux-9-2-Awk/"/>
      <url>/2017/01/12/Linux/linux-9-2-Awk/</url>
      
        <content type="html"><![CDATA[<h1 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h1><h2 id="awkå‘½ä»¤çš„é€šç”¨è¯­æ³•æ ¼å¼"><a href="#awkå‘½ä»¤çš„é€šç”¨è¯­æ³•æ ¼å¼" class="headerlink" title="awkå‘½ä»¤çš„é€šç”¨è¯­æ³•æ ¼å¼"></a>awkå‘½ä»¤çš„é€šç”¨è¯­æ³•æ ¼å¼</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">awk &#39;&#123;commands&#125;&#39;</span><br><span class="line">    commandsä¸ºä¸€ä¸ªæˆ–å¤šä¸ªå‘½ä»¤</span><br><span class="line">    å¸¸ç”¨é€‰é¡¹ï¼š</span><br><span class="line">        -fï¼Œè¡¨æ˜awkå‘½ä»¤å°†ä»è¯¥æ ‡å¿—ä¹‹åçš„æ–‡ä»¶ä¸­è¯»å–æŒ‡ä»¤è€Œä¸æ˜¯ä»å‘½ä»¤è¡Œè¯»å–ï¼›</span><br><span class="line">        -Fcï¼Œè¿™ä¸ªæ ‡å¿—è¡¨æ˜å­—æ®µä¹‹é—´çš„åˆ†éš”ç¬¦æ˜¯cè€Œä¸æ˜¯é»˜è®¤çš„ç©ºç™½å­—ç¬¦ï¼ˆå¦‚åˆ¶è¡¨é”®ã€ä¸€ä¸ªæˆ–å¤šä¸ªç©ºæ ¼ç¬¦ï¼‰ã€‚</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨ç‚¹ï¼š</p><ul><li><strong>print</strong>ï¼šå°†ä¸€è¡Œæ¥ä¸€è¡Œåœ°æ‰“å°å‡ºæ–‡ä»¶ä¸­çš„æ‰€æœ‰æ•°æ®è¡Œã€‚</li></ul><p>å¯ç”¨ <code>print str1 str2 int1,int2...</code></p><p>ä¹Ÿå¯<code>print(A,B,C,...)</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ who | awk &#39;&#123; print &#125;&#39;</span><br><span class="line">        &#x3D;&#x3D;ç›´æ¥ä½¿ç”¨ã€Œwhoã€</span><br></pre></td></tr></table></figure><p>awk ä¸­ä¹Ÿå¯ä»¥ç”¨ c é£æ ¼çš„ printf()ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">printf(&quot;Total: %s\n&quot;,totalsize)</span><br><span class="line">    ç”¨printfæ³¨æ„&#39;\n&#39;</span><br></pre></td></tr></table></figure><h2 id="nï¼šå­—æ®µå˜é‡"><a href="#nï¼šå­—æ®µå˜é‡" class="headerlink" title="$nï¼šå­—æ®µå˜é‡"></a><code>$n</code>ï¼šå­—æ®µå˜é‡</h2><p>åœ¨æ–‡ä»¶å’ŒLinuxå‘½ä»¤çš„ç»“æœæ˜¾ç¤ºä¸­:</p><pre><code>    æ¯è¡Œä¿¡æ¯è¢«æŒ‡å®šçš„åˆ†éš”ç¬¦åˆ†éš”æˆè‹¥å¹²ä¸ªå­—æ®µï¼Œ    æ¯ä¸ªå­—æ®µéƒ½è¢«èµ‹äºˆä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚    å¦‚ï¼Œå­—æ®µ1çš„æ ‡è¯†ç¬¦æ˜¯ `$1`ï¼Œå­—æ®µ2çš„æ ‡è¯†ç¬¦æ˜¯ `$2` ç­‰ã€‚    ç‰¹æ®Šåœ°ï¼Œæœ‰å˜é‡ `$0` è¡¨ç¤ºæ•´è¡Œ ã€Œ`$0=re(&#39;^\*$&#39;)`ã€</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ who | awk &#39;&#123; print $1 &#125;&#39;</span><br><span class="line">    åˆ—å‡ºwhoå‘½ä»¤æ˜¾ç¤ºç»“æœä¸­æ¯è¡Œçš„ç¬¬1ä¸ªå­—æ®µï¼Œå³ç›®å‰ç™»å½•Linuxç³»ç»Ÿçš„ç”¨æˆ·å</span><br><span class="line">$ who | awk &#39;&#123; print &quot;User  &quot; $1 &quot; is on terminal line &quot; $2&#125;&#39;</span><br><span class="line">    å†ä¸Šä¸€ä¸ªå‘½ä»¤çš„åŸºç¡€ä¸ŠåŠ å…¥ä¸€äº›è§£é‡Šæ€§çš„è¯</span><br><span class="line">$ awk &#39;&#123; print &quot;Employee  &quot; $2 &quot; has salary &quot; $4&#125;&#39; emp.data</span><br><span class="line">    emp.dataæ–‡ä»¶ä¸­çš„ç¬¬2ä¸ªå­—æ®µä¸ºå‘˜å·¥å§“ï¼Œç¬¬4ä¸ªå­—æ®µä¸ºå·¥èµ„ï¼Œ</span><br><span class="line">    åœ¨å‘˜å·¥å§“å‰åŠ ä¸ŠEmployeeï¼Œ</span><br><span class="line">    åœ¨å‘˜å·¥çš„å§“å’Œå·¥èµ„ä¹‹é—´åŠ ä¸Šhas salaryå­—ç¬¦ä¸²</span><br><span class="line">$ egrep &#39;foo|bar&#39; &#x2F;etc&#x2F;passwd | awk -F: &#39;&#123; print $1&quot; has &quot; $7 &quot; as loggin shell.&quot; &#125;&#39;</span><br><span class="line">        # åœ¨&#x2F;etc&#x2F;passwdä¸­æ‰€æœ‰çš„å­—æ®µéƒ½æ˜¯ä»¥:åˆ†éš”çš„ã€‚</span><br><span class="line">  è·å–æŸäº›ç”¨æˆ·ç™»å½•æ—¶ä½¿ç”¨çš„shellï¼š</span><br><span class="line">    egrepå‘½ä»¤ä»&#x2F;etc&#x2F;passwdæ–‡ä»¶ä¸­æŠ½å–åŒ…å«fooæˆ–barçš„æ•°æ®è¡Œï¼›</span><br><span class="line">    awkå‘½ä»¤æŠŠå†’å·çœ‹æˆå­—æ®µçš„åˆ†éš”ç¬¦å¹¶å°†åˆ—å‡ºç¬¬1ä¸ªï¼ˆç”¨æˆ·åï¼‰å’Œç¬¬7ä¸ªå­—æ®µï¼ˆç™»å½•æ—¶çš„shellï¼‰ï¼Œ</span><br><span class="line">    åŒæ—¶è¿˜å°†åœ¨æ˜¾ç¤ºç»“æœä¸­åŠ å…¥ä¸€äº›æè¿°ä¿¡æ¯ä»¥å¸®åŠ©é˜…è¯»å’Œç†è§£ï¼›</span><br><span class="line">$ awk -F: &#39;&#123; print $7 &#125;&#39; &#x2F;etc&#x2F;passwd | sort | uniq -c</span><br><span class="line">    è·å–ç³»ç»Ÿä¸Šå„ä¸ªshellåˆ†åˆ«è¢«å‡ ä¸ªç”¨æˆ·é»˜è®¤ä½¿ç”¨</span><br><span class="line">$ grep &#x2F;bin&#x2F; &#x2F;etc&#x2F;passwd | awk -F: &#39;&#123; print $1&quot; &quot; $7 &#125;&#39; | sed &#39;&#x2F;sync&#x2F;d&#39; | sort</span><br><span class="line">    è·å–å“ªäº›ç”¨æˆ·åœ¨ç™»å½•æ—¶ä½¿ç”¨çš„shellæ˜¯å­˜æ”¾åœ¨&#x2F;binç›®å½•ä¸­ä»¥åŠè¿™ä¸ªshellçš„åå­—ï¼›</span><br><span class="line">    å¹¶ä¸”æœ‰ä¸ªç”¨&#x2F;bin&#x2F;syncçš„syncç”¨æˆ·ï¼Œä¸è®©å®ƒå‡ºç°åœ¨æ˜¾ç¤ºçš„ç»“æœï¼›</span><br><span class="line">    æœ€åè¿›è¡Œæ’åºã€‚</span><br><span class="line">$ who | awk &#39;&#123; print $6&quot;: &quot;$0&#125;&#39;</span><br><span class="line">     åœ¨æ¯ä¸ªç”¨æˆ·è®°å½•çš„æœ€å‰é¢æ˜¾ç¤ºè¿™ä¸ªç”¨æˆ·ç™»å½•Linuxç³»ç»Ÿæ‰€ä½¿ç”¨çš„è®¡ç®—æœº</span><br><span class="line">     # whoæ˜¾ç¤ºç»“æœä¸­çš„æœ€åä¸€ä¸ªå­—æ®µæ˜¯ç”¨æˆ·ç™»å½•Linuxç³»ç»Ÿæ‰€ä½¿ç”¨çš„è®¡ç®—æœºçš„IPåœ°å€ï¼Œå¦‚æœä¸ºç©ºè¡¨ç¤ºæ˜¯æœ¬æœºç™»å½•</span><br></pre></td></tr></table></figure><h2 id="NFã€NRå˜é‡"><a href="#NFã€NRå˜é‡" class="headerlink" title="NFã€NRå˜é‡"></a><code>NF</code>ã€<code>NR</code>å˜é‡</h2><ul><li><code>NF</code></li></ul><p>è‹¥ åœ¨å‘½ä»¤è¡¨è¾¾å¼ä¸­ä½¿ç”¨æ²¡æœ‰ <code>$</code> ç¬¦å·çš„NFå˜é‡ï¼š</p><pre><code>     `NF` å°†æ˜¾ç¤ºä¸€è¡Œè®°å½•ä¸­**æœ‰å¤šå°‘ä¸ªå­—æ®µ**ã€‚</code></pre><p>è‹¥ åœ¨å‘½ä»¤è¡¨è¾¾å¼ä¸­ä½¿ç”¨å¸¦æœ‰<code>$</code>ç¬¦å·çš„NFå˜é‡ï¼Œ</p><pre><code>     `$NF` å°†æ˜¾ç¤ºä¸€è¡Œè®°å½•ä¸­**æœ€åä¸€ä¸ªå­—æ®µ**(å³ï¼Œç¬¬NFä¸ªå­—æ®µ -&gt; æœ€åä¸€ä¸ªå­—æ®µ)</code></pre><ul><li><code>NR</code></li></ul><p>å˜é‡ <code>NR</code> ç”¨æ¥è¿½è¸ªæ‰€æ˜¾ç¤ºçš„æ•°æ®è¡Œçš„æ•°ç›®ï¼Œå³<strong>æ˜¾ç¤ºæ•°æ®è¡Œçš„ç¼–å·</strong>ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ who | awk &#39;&#123; print NF &#125;&#39;</span><br><span class="line">    åˆ—å‡ºwhoå‘½ä»¤æ˜¾ç¤ºç»“æœä¸­æ¯ä¸€è¡Œçš„å­—æ®µæ•°ï¼ˆåˆ—æ•°ï¼‰</span><br><span class="line">$ who | awk &#39;&#123; print $NF &#125;&#39;</span><br><span class="line">    åˆ—å‡ºwhoå‘½ä»¤æ˜¾ç¤ºç»“æœä¸­æ¯ä¸€è¡Œçš„æœ€åä¸€ä¸ªå­—æ®µ</span><br><span class="line">$ egrep &#39;bin|sbin&#39; &#x2F;etc&#x2F;passwd | awk -F: &#39;&#123; print $NF &#125;&#39; | sort | uniq -c | sort -n</span><br><span class="line">    egrep    ï¼šä»&#x2F;etc&#x2F;passwdæ–‡ä»¶ä¸­æŠ½å–åŒ…å«binæˆ–sbinçš„æ•°æ®è¡Œ</span><br><span class="line">    awk      ï¼šæŠŠå†’å·çœ‹æˆå­—æ®µçš„åˆ†éš”ç¬¦ï¼Œåˆ—å‡ºæ¯ä¸€è¡Œçš„æœ€åä¸€ä¸ªå­—æ®µ</span><br><span class="line">    sort     ï¼šå°†é‚£äº›å­—æ®µè¿›è¡Œæ’åº</span><br><span class="line">    uniq -c  ï¼šåˆå¹¶ç›¸åŒè¡Œï¼Œå¹¶åœ¨æ¯è¡Œå‰é¢å† ä»¥è¯¥è¡Œå‡ºç°æ¬¡æ•°</span><br><span class="line">    sort -n  ï¼šæŒ‰æ¬¡æ•°çš„å¤§å°è¿›è¡Œæ’åºã€‚</span><br><span class="line">$ ls -l ~&#x2F;wolf | awk &#39;&#123; print NR&quot;: &quot;$0&#125;&#39;        # ç”¨Nç»™æ¯è¡Œä¸€ä¸ªç¼–å·</span><br><span class="line">1: total 16</span><br><span class="line">2: drwxrwxr-x  2 dog dog 4096 Jan 25  2009 boywolf</span><br><span class="line">3: -rw-rw-r--  1 dog dog   84 Dec 22 19:07 delete_disable\</span><br><span class="line">......</span><br></pre></td></tr></table></figure><ul><li>awkçš„commandä¸­printå¯æ‰“å° <code>\n</code>, <code>\t</code> ç­‰</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ls -lF &#x2F;boot | awk &#39;&#123; print $5 &quot;\t&quot; $9&#125;&#39; | sort -rn | head -3</span><br><span class="line">    åˆ—å‡º&#x2F;bootç›®å½•ä¸­æ¯ä¸€ä¸ªæ–‡ä»¶çš„æ–‡ä»¶åå’Œå¤§å°ï¼Œæ–‡ä»¶çš„å¤§å°åœ¨å‰ï¼Œè€Œæ–‡ä»¶åéšåï¼Œæ–‡ä»¶å¤§å°å’Œæ–‡ä»¶åç”±åˆ¶è¡¨é”®éš”å¼€ã€‚</span><br><span class="line">    æŒ‰å¤§å°ååºæ’åˆ—ï¼ˆä»å¤§åˆ°å°ï¼‰</span><br><span class="line">    æŠŠå…¶ä¸­æœ€å¤§çš„3ä¸ªæ–‡ä»¶</span><br></pre></td></tr></table></figure><h2 id="awkä¸­è®¡ç®—"><a href="#awkä¸­è®¡ç®—" class="headerlink" title="awkä¸­è®¡ç®—"></a>awkä¸­è®¡ç®—</h2><p>å˜é‡ä½¿ç”¨å‰ä¸ç”¨å£°æ˜</p><p>ä½¿ç”¨cè¯­è¨€çš„è¿ç®—ç¬¦</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ls -lF &#x2F;boot | awk &#39;&#123; totalsize +&#x3D; $5; print totalsize &#125;&#39;</span><br><span class="line">    è·å–&#x2F;bootç›®å½•ä¸­æ‰€æœ‰æ–‡ä»¶å¤§å°çš„æ€»å’Œ</span><br><span class="line">    ï¼ˆå°†å¾—åˆ°ç´¯åŠ è¿‡ç¨‹ä¸­æ¯ä¸€æ­¥çš„totalsizeå€¼ï¼‰</span><br><span class="line">ä¸ºå¾—åˆ°æœ€ç»ˆç»“æœï¼Œä¸è¾“å‡ºä¸­é—´å€¼ï¼š</span><br><span class="line">$ ls -lF &#x2F;boot | awk &#39;&#123; totalsize +&#x3D; $5; print totalsize &#125;&#39; | tail -1</span><br><span class="line">    é™¤äº†ä½¿ç”¨tailå‘½ä»¤ä¹‹å¤–ï¼Œä¸€ç§æ›´å¥½çš„æ–¹æ³•æ˜¯åœ¨awkå‘½ä»¤ä¸­ä½¿ç”¨ENDå…³é”®å­—ï¼š</span><br><span class="line">$ ls -lF &#x2F;boot | awk &#39;&#123; totalsize +&#x3D; $5&#125; END &#123; print totalsize &#125;&#39;</span><br></pre></td></tr></table></figure><h2 id="END-å…³é”®å­—ï¼š"><a href="#END-å…³é”®å­—ï¼š" class="headerlink" title="END å…³é”®å­—ï¼š"></a><code>END</code> å…³é”®å­—ï¼š</h2><p>åœ¨æœ€åä¸€æ­¥æ‰§è¡ŒENDåçš„{statements}ï¼Œå¦‚ä¸Šä¾‹æœ€åä¸€ä¸ªå‘½ä»¤ã€‚</p><h2 id="å°†-commandsè¡¨è¾¾å¼æ”¾å…¥æ–‡ä»¶"><a href="#å°†-commandsè¡¨è¾¾å¼æ”¾å…¥æ–‡ä»¶" class="headerlink" title="å°† commandsè¡¨è¾¾å¼æ”¾å…¥æ–‡ä»¶"></a>å°† <code>commands</code>è¡¨è¾¾å¼æ”¾å…¥æ–‡ä»¶</h2><ul><li>ç”¨cat</li></ul><p>æ¡†ä¸­ä¸ºè¦è¾“å…¥çš„ï¼ˆæ³¨æ„æœ«å°¾æ–°è¡Œé”®å…¥EOFåå›è½¦ï¼ˆ&lt;&lt;EOFï¼‰å¯ä»¥è‡ªåŠ¨é€€å‡ºï¼‰</p><p>ï¼ˆç›´æ¥ç”¨cat &gt; script2å†™å®Œåctrl+Dä¹Ÿå¯ä»¥ï¼‰</p><p>ç”¨æ­¤æ³•ä¼šæœ‰å†™å®Œåæ–‡ä»¶ä¸­â€œ$5â€å­—æ ·ç¼ºå¤±çš„é—®é¢˜ã€‚</p><ul><li>ç”¨viç›´æ¥å†™å®Œä¿å­˜æ›´å¥½ï¼ˆä¸ç”¨å†™EOFï¼Œä¹Ÿæ²¡æœ‰$nç¼ºå¤±çš„é—®é¢˜ï¼‰</li></ul><p>ä¿å­˜å…¥æ–‡ä»¶åå¯ä»¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ls -lF &#x2F;boot | awk -f script1</span><br></pre></td></tr></table></figure><ul><li>å°†awkå†™å…¥shellè„šæœ¬</li></ul><p>å°†ä¸€äº›ç»å¸¸ä½¿ç”¨çš„å‘½ä»¤æ”¾å…¥ä¸€ä¸ªæ­£æ–‡æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯æ‰€è°“çš„shellè„šæœ¬æ–‡ä»¶ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å†™å…¥ï¼šï¼ˆæ³¨æ„ç”¨&quot;&quot;æŠŠå‘½ä»¤æ‹¬èµ·æ¥ï¼Œå¦åˆ™å°†æŠŠ&quot;$(ls ...)&quot;å†™å…¥ï¼‰</span><br><span class="line">$ echo &quot;ls -lF &#x2F;boot | awk -f script1&quot; &gt; boot_size</span><br><span class="line">è°ƒç”¨ï¼š</span><br><span class="line">$ bash boot_size</span><br><span class="line">$ sh boot_size</span><br><span class="line">$ ksh boot_size</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="awkä¸­ä½¿ç”¨ifæ¡ä»¶ã€forå¾ªç¯ä¸-C-è¯­è¨€ç›¸ä¼¼"><a href="#awkä¸­ä½¿ç”¨ifæ¡ä»¶ã€forå¾ªç¯ä¸-C-è¯­è¨€ç›¸ä¼¼" class="headerlink" title="awkä¸­ä½¿ç”¨ifæ¡ä»¶ã€forå¾ªç¯ä¸ C è¯­è¨€ç›¸ä¼¼"></a>awkä¸­ä½¿ç”¨ifæ¡ä»¶ã€forå¾ªç¯ä¸ C è¯­è¨€ç›¸ä¼¼</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ awk  &#39;&#123; if (length($4) &#x3D;&#x3D; 3  ) print $0 &#125;&#39; emp.data | wc -l</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6b0tm7hpgj30go04qjrv.jpg" alt="IMG_1074"></p><p><code>count[length($1)]++</code>ï¼šå°†ç¬¬1ä¸ªå­—æ®µçš„é•¿åº¦ä½œä¸ºæ•°ç»„å…ƒç´ çš„ä¸‹æ ‡ï¼Œå¹¶å°†è¿™ä¸ªæ•°ç»„å…ƒç´ çš„ä¸ªæ•°åŠ 1å†é‡æ–°å­˜å›åˆ°åŸæ¥çš„æ•°ç»„å…ƒç´ ä¸­ã€‚ï¼ˆä¼¼åŠ¨æ€è¯­è¨€ï¼‰</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-9.1-sed</title>
      <link href="/2017/01/11/Linux/linux-9-1-Sed/"/>
      <url>/2017/01/11/Linux/linux-9-1-Sed/</url>
      
        <content type="html"><![CDATA[<h1 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h1><p>åˆ©ç”¨è¢«ç§°ä¸ºç®¡é“æ“ä½œç¬¦çš„|ï¼Œå¤šä¸ªå‘½ä»¤ç”±ç®¡é“ç¬¦è¿æˆäº†ç®¡é“çº¿ã€‚</p><p>åœ¨UNIXæˆ–Linuxç³»ç»Ÿä¸­ï¼Œæµè¿‡ç®¡é“çº¿çš„ä¿¡æ¯ï¼ˆæ•°æ®ï¼‰å°±å«åšæµï¼ˆstreamï¼‰;</p><p>ä¸ºäº†ç¼–è¾‘æˆ–ä¿®æ”¹ä¸€æ¡ç®¡é“ä¸­çš„ä¿¡æ¯ï¼Œå°±ä½¿ç”¨æµç¼–è¾‘å™¨ï¼ˆstream editorï¼‰;</p><p>è¿™æ˜¯sedè¿™ä¸ªå‘½ä»¤çš„åå­—çš„ç”±æ¥ã€‚</p><p>sedç¼–è¾‘æ–‡ä»¶ï¼Œå°†ç»“æœè¾“å‡ºåˆ°1ï¼Œä¸æ”¹å˜åŸæ–‡ä»¶ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sed [é€‰é¡¹] &#39;ä»¥å¼•å·æ‹¬èµ·æ¥çš„å‘½ä»¤è¡¨è¾¾å¼&#39; [è¾“å…¥æ–‡ä»¶]</span><br><span class="line">    -e &lt;expression&gt;ï¼šeæ˜¯expression, ä»¥é€‰é¡¹ä¸­æŒ‡å®šçš„scriptæ¥å¤„ç†è¾“å…¥çš„æ–‡æœ¬æ–‡ä»¶ï¼Œåæ¥è¡¨è¾¾å¼</span><br><span class="line">    -f &lt;file&gt;ï¼šä»¥é€‰é¡¹ä¸­æŒ‡å®šçš„scriptæ–‡ä»¶æ¥å¤„ç†è¾“å…¥çš„æ–‡æœ¬æ–‡ä»¶ã€‚</span><br><span class="line">    -iï¼šç›´æ¥åœ¨æ–‡ä»¶ä¸­æ›¿æ¢ï¼Œä¸åœ¨ç»ˆç«¯è¾“å‡º</span><br><span class="line">            -iå¸¸å’Œ å¤‡ä»½åŸæœ¬æ–‡ä»¶çš„-l é…åˆä½¿ç”¨ã€‚</span><br><span class="line">    åœ¨sedå‘½ä»¤ä¸­ä½¿ç”¨å¤šä¸ªå‘½ä»¤è¡¨è¾¾å¼ï¼Œè¿™å‘½ä»¤è¡¨è¾¾å¼ä¸­é—´è¦ä½¿ç”¨åˆ†å·ï¼ˆ;ï¼‰åˆ†éš”å¼€</span><br></pre></td></tr></table></figure><p><span style="color: rgb(51, 51, 51);">åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­æŒ‡å®šæ•°æ®è¡Œçš„èŒƒå›´å†…æŠ½å–æŸä¸€å­—ç¬¦ä¸²å¹¶ç”¨æ–°çš„æ¨¡å¼æ›¿ä»£å®ƒï¼š</span></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed -e &#39;s&#x2F;æ—§æ¨¡å¼&#x2F;æ–°æ¨¡å¼&#x2F;æ ‡å¿—&#39; file</span><br><span class="line">        sæ˜¯substituteï¼Œ</span><br><span class="line">        ä¸¤ä¸ªæœ€æœ‰ç”¨çš„æ ‡å¿—åˆ†åˆ«æ˜¯gå’Œnã€‚</span><br><span class="line">            gæ˜¯globallyï¼Œè¡¨ç¤ºè¦æ›¿ä»£æ¯ä¸€è¡Œä¸­æ‰€å‡ºç°çš„å…¨éƒ¨æ¨¡å¼ã€‚ï¼ˆæ— gåªæ¢æ¯è¡Œçš„å¤´ä¸€ä¸ªï¼‰</span><br><span class="line">            nå‘Šè¯‰sedåªæ›¿ä»£å‰nè¡Œä¸­æ‰€å‡ºç°çš„æ¨¡å¼ã€‚</span><br></pre></td></tr></table></figure><p>Â Â  Â e.g.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grep CLERK emp.fmt | sed -e &#39;s&#x2F; &#x2F;;&#x2F;g;s&#x2F;CLERK&#x2F;ASSISTANT MANAGER&#x2F;g&#39;</span><br><span class="line">    1. grepå°†æ‰€æœ‰å¸¦CLERKçš„è¡Œæ‰¾å‡ºï¼›</span><br><span class="line">    2. sed å°†æ‰€æœ‰çš„ç©ºæ ¼ï¼ˆåˆ†éš”ç¬¦ï¼‰éƒ½è½¬æ¢æˆåˆ†å·ï¼ˆ;ï¼‰ï¼›</span><br><span class="line">    3. sed å°†æ‰€æœ‰çš„CLERKå­—ç¬¦ä¸²éƒ½æ›¿æ¢æˆASSISTANT MANAGERï¼›</span><br></pre></td></tr></table></figure><p>åˆ é™¤æŸè¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ sed &#39;nd&#39; file</span><br><span class="line">    åœ¨æ˜¾ç¤ºç»“æœä¸­åˆ é™¤ç¬¬nè¡Œ</span><br><span class="line">$ sed &#39;m,nd&#39; file</span><br><span class="line">    åœ¨æ˜¾ç¤ºç»“æœä¸­åˆ é™¤ç¬¬måˆ°nè¡Œ</span><br><span class="line">$ sed &#39;&#x2F;str&#x2F;d&#39; file</span><br><span class="line">    åˆ é™¤æ‰€æœ‰å¸¦strçš„è¡Œ</span><br><span class="line">$ sed &#39;&#x2F;^$&#x2F;d&#39; file</span><br><span class="line">    åˆ é™¤æ‰€æœ‰ç©ºè¡Œ        # re(&quot;^$&quot;) means a line without any word.(åªæœ‰å¼€å§‹ç¬¦^å’Œç»“å°¾ç¬¦$çš„è¡Œ)</span><br><span class="line">$ sed &#39;1,&#x2F;str&#x2F;d&#39; file</span><br><span class="line">    åˆ é™¤ä»ç¬¬1è¡Œå¼€å§‹ç›´åˆ°åŒ…å«æœ‰strçš„æ•°æ®è¡Œï¼ˆåŒ…æ‹¬æœ‰strçš„é‚£è¡Œï¼‰</span><br></pre></td></tr></table></figure><p>e.g.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ï¼ˆ1ï¼‰ç”µå­é‚®ä»¶å’Œä¸€äº›åº”ç”¨ç¨‹åºæ˜¾ç¤ºçš„æ¯ä¸€è¡Œä¿¡æ¯éƒ½æ˜¯ä»¥&gt;å¼€å§‹çš„ï¼Œä½¿ç”¨ä¸‹é¢çš„ä¸€æ¡sedå‘½ä»¤æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼š</span><br><span class="line">$ sed &#39;&#x2F;^$&#x2F;d;s&#x2F;^&#x2F;&gt; &#x2F;g&#39; source &gt;result</span><br><span class="line">    ç¬¬1ä¸ªå‘½ä»¤è¡¨è¾¾å¼&#x2F;^$&#x2F;dè¡¨ç¤ºè¦åˆ é™¤æ‰€æœ‰çš„ç©ºè¡Œï¼Œ</span><br><span class="line">    ç¬¬2ä¸ªå‘½ä»¤è¡¨è¾¾å¼s&#x2F;^&#x2F;&gt;&#x2F;è¡¨ç¤ºå°†å¼€å§‹ç¬¦å·æ›¿æ¢æˆå¤§äºç¬¦å·å’Œç©ºæ ¼ç¬¦ï¼Œ</span><br><span class="line">    æœ€åçš„&gt;resultè¡¨ç¤ºå°†sedå‘½ä»¤çš„ç»“æœå­˜å…¥resultæ–‡ä»¶ã€‚</span><br><span class="line">------------------------------------------------------------------------------------------</span><br><span class="line">ï¼ˆ2ï¼‰åœ¨åˆ é™¤æ‰€æœ‰ç©ºè¡Œçš„åŒæ—¶ï¼Œåˆ é™¤æ‰€æœ‰åŒ…å«äº†â€œcalâ€œçš„è¡Œï¼Œå¹¶å°†æ‰€æœ‰çš„å­—ç¬¦ä¸²â€œtieâ€œå˜æˆâ€œfoxâ€œ,å°†ç»“æœä¿å­˜ï¼š</span><br><span class="line">$ sed &#39;&#x2F;^$&#x2F;d;&#x2F;cal&#x2F;d;s&#x2F;tie&#x2F;fox&#x2F;g&#39; source &gt;result</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-9.0-grep</title>
      <link href="/2017/01/10/Linux/linux-9-0-Grep/"/>
      <url>/2017/01/10/Linux/linux-9-0-Grep/</url>
      
        <content type="html"><![CDATA[<h1 id="grep-egrep-fgrep"><a href="#grep-egrep-fgrep" class="headerlink" title="grep/egrep/fgrep"></a>grep/egrep/fgrep</h1><p>grepã€egrepã€fgrepï¼šæœç´¢æ–‡ä»¶ä¸­æ»¡è¶³ç‰¹å®šæ¨¡å¼(pattern)æˆ–å­—ç¬¦ä¸²çš„å†…å®¹ï¼Œå°†ç»“æœè¾“å‡ºåˆ°1ï¼Œä¸æ”¹å˜åŸæ–‡ä»¶ã€‚</p><p>ï¼ˆUNIXä¸­çš„patternsè¢«ç§°ä¸ºÂ _Regular Expressions_ï¼‰</p><blockquote><p>grep=â€Globalï¼ŒRegular Expressionsï¼ŒPrintâ€ï¼Œå³â€œåœ¨æ–‡ä»¶å…¨å±€ä¸­ç”¨æ­£åˆ™è¡¨è¾¾å¼æœç´¢ç»“æœæ‰“å°è¾“å‡ºâ€</p></blockquote><p>grepã€egrepèƒ½åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ç­‰å†…å®¹ä¸­æœç´¢æŸä¸€ç‰¹å®šçš„Character Patternï¼ˆR.E.ï¼‰ã€‚</p><h3 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h3><p>grepå‘½ä»¤æ”¯æŒä»¥ä¸‹å‡ ç§æ­£åˆ™è¡¨è¾¾å¼çš„å…ƒå­—ç¬¦ï¼ˆregular expression metacharactersï¼‰ï¼Œå³é€šé…ç¬¦ï¼š</p><ul><li><code>c*</code> ï¼šå°†åŒ¹é…0ä¸ªï¼ˆå³ç©ºç™½ï¼‰æˆ–å¤šä¸ªå­—ç¬¦cï¼ˆcä¸ºä»»ä¸€å­—ç¬¦ï¼‰ã€‚</li><li><code>.</code> ï¼šå°†åŒ¹é…ä»»ä½•ä¸€ä¸ªå­—ç¬¦è€Œä¸”åªèƒ½æ˜¯ä¸€ä¸ªå­—ç¬¦ã€‚</li><li><code>[xyz]</code> ï¼šå°†åŒ¹é…æ–¹æ‹¬å·ä¸­çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚</li><li><code>[^xyz]</code> Â ï¼šå°†åŒ¹é…ä¸åŒ…æ‹¬æ–¹æ‹¬å·ä¸­çš„å­—ç¬¦çš„æ‰€æœ‰å­—ç¬¦ã€‚</li><li><code>^</code> ï¼šé”å®šè¡Œçš„å¼€å¤´ã€‚</li><li><code>$</code> ï¼šé”å®šè¡Œçš„ç»“å°¾ã€‚</li></ul><p>åœ¨åŸºæœ¬æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼š</p><p>Â Â  Â Â Â  Â å¦‚å…ƒå­—ç¬¦<code>*</code>ã€<code>+</code>ã€<code>&#123;</code>ã€<code>|</code>ã€<code>(</code>Â å’ŒÂ <code>)</code> å·²ç»å¤±å»äº†å®ƒä»¬åŸæ¥çš„å«ä¹‰ï¼Œ</p><p>Â Â  Â Â Â  Â å¦‚æœè¦æ¢å¤å®ƒä»¬åŸæœ¬çš„å«ä¹‰è¦åœ¨ä¹‹å‰å† ä»¥åæ–œçº¿â€™\â€˜ï¼Œå¦‚ <code>\*</code>ã€<code>\+</code>ã€<code>\&#123;</code>ã€<code>\|</code>ã€<code>\(</code>Â å’Œ <code>\)</code>ã€‚</p><p>grepå‘½ä»¤æ˜¯ç”¨æ¥åœ¨æ¯ä¸€ä¸ªæ–‡ä»¶ä¸­æˆ–æ ‡å‡†è¾“å‡ºä¸Šæœç´¢ç‰¹å®šçš„æ¨¡å¼ã€‚</p><p>å½“ä½¿ç”¨grepå‘½ä»¤æ—¶ï¼ŒåŒ…å«ä¸€ä¸ªæŒ‡å®šå­—ç¬¦æ¨¡å¼çš„æ¯ä¸€è¡Œéƒ½ä¼šè¢«æ‰“å°åœ¨å±å¹•ä¸Šï¼Œ</p><p>ä½¿ç”¨grepå‘½ä»¤å¹¶ä¸æ”¹å˜æ–‡ä»¶ä¸­çš„å†…å®¹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">grep é€‰é¡¹ æ¨¡å¼ æ–‡ä»¶å</span><br><span class="line">        é€‰é¡¹å¯ä»¥æ”¹å˜grepå‘½ä»¤çš„æœå¯»æ–¹å¼ï¼š</span><br><span class="line">            -cï¼šä»…åˆ—å‡ºåŒ…å«æ¨¡å¼çš„è¡Œçš„æ•°é‡ã€‚</span><br><span class="line">            -iï¼šå¿½ç•¥æ¨¡å¼ä¸­çš„å­—æ¯å¤§å°å†™ã€‚</span><br><span class="line">            -lï¼šåˆ—å‡ºå¸¦æœ‰åŒ¹é…è¡Œçš„æ–‡ä»¶åã€‚</span><br><span class="line">            -nï¼šåœ¨æ¯è¡Œçš„æœ€å‰é¢åˆ—å‡ºè¡Œå·ã€‚</span><br><span class="line">            -vï¼šåˆ—å‡ºæ²¡æœ‰åŒ¹é…æ¨¡å¼çš„è¡Œã€‚</span><br><span class="line">            -wï¼šæŠŠè¡¨è¾¾å¼ä½œä¸ºä¸€ä¸ªå®Œæ•´çš„å•å­—æ¥æœå¯»ï¼Œå¿½ç•¥é‚£äº›éƒ¨åˆ†åŒ¹é…çš„è¡Œã€‚</span><br><span class="line">[âš ï¸]é™¤äº†-wé€‰é¡¹ä¹‹å¤–ï¼Œå…¶ä»–çš„æ¯ä¸ªé€‰é¡¹éƒ½å¯ä»¥åœ¨egrepå’Œfgrepå‘½ä»¤ä¸­ä½¿ç”¨ã€‚</span><br><span class="line">[âš ï¸]å¦‚æœæ˜¯æœç´¢å¤šä¸ªæ–‡ä»¶ï¼Œgrepå‘½ä»¤çš„ç»“æœåªæ˜¾ç¤ºåœ¨æ–‡ä»¶ä¸­å‘ç°åŒ¹é…æ¨¡å¼çš„æ–‡ä»¶åï¼Œè€Œæœç´¢çš„æ˜¯å•ä¸€çš„æ–‡ä»¶ï¼Œgrepå‘½ä»¤çš„ç»“æœå°†æ˜¾ç¤ºæ¯ä¸€ä¸ªåŒ…å«åŒ¹é…æ¨¡å¼çš„è¡Œã€‚</span><br></pre></td></tr></table></figure><p><em>e.g.</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ grep CLERK emp.data        #æ˜¾ç¤ºåŒ…å«äº†CLERKçš„è¡Œ</span><br><span class="line">7369    SMITH   CLERK   800     17-DEC-80</span><br><span class="line">7876    ADAMS  CLERK   1100    23-MAY-87</span><br><span class="line">$ grep -c CLERK emp.data        # åªæ˜¾ç¤ºç”¨å‡ ä¸ªæ»¡è¶³è¡Œ</span><br><span class="line">2</span><br><span class="line">$ grep ^78 emp.data      # åˆ—å‡ºåœ¨emp.dataæ–‡ä»¶ä¸­æ‰€æœ‰ä»¥78å¼€å§‹çš„æ•°æ®è¡Œ</span><br><span class="line">$ grep &#39;1..0&#39; emp.data    #&#39;1..0&#39;è¡¨ç¤ºä»¥1å¼€å§‹éšåæ˜¯ä¸¤ä¸ªä»»æ„å­—ç¬¦æœ€åæ˜¯0çš„å­—ç¬¦ä¸²ã€‚</span><br><span class="line">$ grep &#39;[12]..0&#39;        # &#39;[12]..0&#39;è¡¨ç¤ºä»¥1æˆ–2å¼€å§‹éšåæ˜¯ä¸¤ä¸ªä»»æ„å­—ç¬¦æœ€åæ˜¯0çš„å­—ç¬¦ä¸²ã€‚</span><br><span class="line">$ grep -l root group passwd hosts    # åœ¨å½“å‰ç›®å½•ä¸­çš„groupã€passwdå’Œhosts 3ä¸ªæ–‡ä»¶ä¸­æœç´¢æ¨¡å¼rootå¹¶åˆ—å‡ºåŒ…å«è¿™ä¸€æ¨¡å¼çš„æ–‡ä»¶åã€‚</span><br><span class="line">$ grep &#39;&#x2F;bash$&#39; passwd    # åˆ—å‡ºåœ¨passwdæ–‡ä»¶ä¸­æ‰€æœ‰ä»¥&#x2F;bashç»“å°¾çš„è¡Œï¼ˆGetæ‰€æœ‰é»˜è®¤ä½¿ç”¨bashçš„ç”¨æˆ·ï¼‰ã€‚</span><br><span class="line">$ ps -e | grep ftp    # è·å–ç›®å‰ç³»ç»Ÿä½¿ç”¨çš„ftpæœåŠ¡çš„è¿›ç¨‹å</span><br><span class="line">$ ps -e | grep ora    # To know is Oracle Database runing</span><br></pre></td></tr></table></figure><h3 id="egrep"><a href="#egrep" class="headerlink" title="egrep"></a>egrep</h3><p align="left"><span style="color: rgb(253, 4, 4);">/* egrep åœ¨RHELç­‰Linuxä¸Šå…¶å®æ˜¯ã€Œgrep -Eã€çš„åˆ«å \*/</span></p><p align="left">egrepçš„è¯­æ³•æ ¼å¼ä¸grepå‘½ä»¤ç›¸åŒï¼Œ</p>ä½†egrepæ˜¯ç”¨æ¥åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶çš„å†…å®¹ä¸­åˆ©ç”¨**æ‰©å±•çš„æ­£åˆ™è¡¨è¾¾å¼**çš„å…ƒå­—ç¬¦æœç´¢ç‰¹å®šçš„æ¨¡å¼ã€‚<p>egrepæ‰€å¢åŠ çš„å…ƒå­—ç¬¦ï¼š</p><ul><li>+ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå‰å¯¼å­—ç¬¦ã€‚</li><li>a|bï¼šåŒ¹é…aæˆ–bã€‚</li><li>(RE)ï¼šåŒ¹é…æ‹¬å·ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼REã€‚</li></ul><p>e.g.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ egrep &#39;[1-5]+000&#39; emp.data        # åŒ¹é…1000ï¼Œ2000ï¼Œ3000ï¼Œ4000ï¼Œ5000</span><br><span class="line">$ egrep &#39;S[A-Z]+MAN&#39; emp.fmt        # åŒ¹é…â€œSxx...xxMANâ€</span><br><span class="line">$ egrep &#39;E(S|R) &#39; emp.fmt           # åœ¨æ¯ä¸€è¡Œæ•°æ®ä¸­æœå¯»å­—æ¯Eåé¢ç´§è·Ÿç€Sæˆ–R</span><br></pre></td></tr></table></figure><h3 id="fgrep"><a href="#fgrep" class="headerlink" title="fgrep"></a>fgrep</h3><p><span style="color: rgb(253, 4, 4);">/* fgrep åœ¨RHELç­‰Linuxä¸Šå…¶å®æ˜¯ã€Œgrep -Fã€çš„åˆ«å */</span></p><p>fgrepä¹Ÿç”¨æ¥åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ä¸­æœç´¢ä¸æŒ‡å®šå­—ç¬¦ä¸²åŒ¹é…çš„è¡Œã€‚</p><p>æœç´¢æ–‡ä»¶fgrepçš„é€Ÿåº¦è¦æ¯”grepå¿«ï¼Œ</p><p>fgrepå¯ä»¥ä¸€æ¬¡è¿…é€Ÿåœ°æœç´¢å¤šä¸ªæ¨¡å¼ã€‚</p><p>ä¸grepä¸åŒï¼Œfgrepå‘½ä»¤ä¸èƒ½æœç´¢ä»»ä½•æ­£åˆ™è¡¨è¾¾å¼ï¼Œ</p><p>å³å°†<strong>é€šé…ç¬¦å½“ä½œæ™®é€šå­—ç¬¦</strong>æ¥å¤„ç†ï¼ˆæŒ‰è¯¥å­—ç¬¦çš„å­—é¢æ„æ€æ¥å¤„ç†ï¼‰ã€‚</p><p>æœç´¢æ–‡ä»¶å‘½ä»¤fgrepä¸èƒ½ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ï¼Œåªèƒ½æœç´¢ç¡®å®šçš„æ¨¡å¼ã€‚</p><p>fgrepæ—¢å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸Šé”®å…¥æœç´¢çš„æ¨¡å¼ï¼Œ</p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨-fé€‰é¡¹ä»æ–‡ä»¶ä¸­è¯»å–è¦æœç´¢çš„æ¨¡å¼ã€‚</p><p>e.g.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cat emp.fmt | fgrep -f conditions</span><br><span class="line">    # ç­‰ä»·äº</span><br><span class="line">$  fgrep -f conditions.txt emp.fmt</span><br><span class="line"># grepä¹Ÿå¯ä»¥å¦‚ä»¥ä¸ŠäºŒè€…æ“ä½œ: åˆ—å‡ºemp.fmtæ–‡ä»¶ä¸­æ‰€æœ‰ä¸conditions.txtæ–‡ä»¶ä¸­å†…å®¹ç›¸åŒ¹é…çš„æ•°æ®è¡Œã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-8-é‚®ä»¶ç³»ç»Ÿ</title>
      <link href="/2017/01/09/Linux/linux-8-Mail/"/>
      <url>/2017/01/09/Linux/linux-8-Mail/</url>
      
        <content type="html"><![CDATA[<h1 id="é‚®ä»¶ç³»ç»Ÿ"><a href="#é‚®ä»¶ç³»ç»Ÿ" class="headerlink" title="é‚®ä»¶ç³»ç»Ÿ"></a>é‚®ä»¶ç³»ç»Ÿ</h1><h2 id="ä½¿ç”¨-mail-å‘½ä»¤å‘é€é‚®ä»¶ï¼š"><a href="#ä½¿ç”¨-mail-å‘½ä»¤å‘é€é‚®ä»¶ï¼š" class="headerlink" title="ä½¿ç”¨ mail å‘½ä»¤å‘é€é‚®ä»¶ï¼š"></a>ä½¿ç”¨ <code>mail</code> å‘½ä»¤å‘é€é‚®ä»¶ï¼š</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ mail -s &quot;ä¸»é¢˜&quot; ç›®æ ‡ [&lt; å†…å®¹]</span><br><span class="line">        ç›®æ ‡ï¼šå¯ä»¥æ˜¯æœ¬æœºä¸Šçš„ç”¨æˆ·åï¼›</span><br><span class="line">            ä¹Ÿå¯ä»¥æ˜¯ä¸€èˆ¬çš„é‚®ä»¶åœ°å€ï¼›</span><br><span class="line">        è‹¥ä½¿ç”¨é‡å®šå‘è¾“å…¥å†…å®¹ï¼ŒEnteråç›´æ¥å‘é€ï¼Œä¸å›æ˜¾ï¼›</span><br><span class="line">        è‹¥ä¸é‡å®šå‘ï¼Œé”®å…¥å‘½ä»¤åä»stdinè¯»é‚®ä»¶æ­£æ–‡ï¼ˆç±»ä¼¼äºâ€œcat &gt; fileâ€ï¼‰ã€‚</span><br><span class="line">    </span><br><span class="line">        è¦ç»“æŸé‚®ä»¶å†…å®¹ï¼Œåœ¨ä¸€ä¸ªç©ºç™½è¡Œè¾“å…¥ä¸€ä¸ªç‚¹(&#39;.&#39;)ï¼Œç„¶åEnterï¼›</span><br><span class="line">        ä¹‹åä¼šå‡ºç°â€œCc: â€ï¼ˆCarbon copyï¼Œå‰¯æœ¬ï¼‰å¡«å†™æŠ„é€ç›®æ ‡ï¼ŒEnterï¼›</span><br><span class="line">        ä¹‹åï¼Œmailå‘é€é‚®ä»¶å¹¶é€€å‡ºã€‚</span><br></pre></td></tr></table></figure><p>e.g.Â Â  Â <strong>foo</strong> ç”¨æˆ·å‘é€é‚®ä»¶ç»™ <strong>bar</strong> ç”¨æˆ·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[foo@Example ~]$ mail -s &quot;A Testing Mail&quot; bar        # To bar</span><br><span class="line">Hi Bar,</span><br><span class="line">Its a testing mail.        # æ­£æ–‡</span><br><span class="line">From foo</span><br><span class="line">.                          # ç»“æŸ</span><br><span class="line">Cc:                        # Enterï¼Œå‘é€ï¼Œé€€å‡º</span><br><span class="line">[foo@Example ~]</span><br></pre></td></tr></table></figure><h2 id="é˜…è¯»ç”µå­é‚®ä»¶"><a href="#é˜…è¯»ç”µå­é‚®ä»¶" class="headerlink" title="é˜…è¯»ç”µå­é‚®ä»¶"></a>é˜…è¯»ç”µå­é‚®ä»¶</h2><ul><li>æ”¶ä»¶ç®±ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ls -l &#x2F;var&#x2F;spool&#x2F;mail</span><br><span class="line">        Linuxä¸ºæ¯ä¸ªç”¨æˆ·å‡†å¤‡äº†ä¸€ä¸ªé‚®ç®±ï¼ˆfileï¼‰</span><br><span class="line">        ä»¥å­˜æ”¾ç”¨æˆ·çš„é‚®ä»¶ï¼ˆincluding all mailsï¼‰</span><br><span class="line">$ cat &#x2F;var&#x2F;spool&#x2F;mail&#x2F;USER_NAME</span><br><span class="line">        æŸ¥çœ‹æŸç”¨æˆ·çš„æ‰€æœ‰é‚®ä»¶ï¼ˆæ”¶ä»¶ç®±ï¼‰</span><br></pre></td></tr></table></figure><ul><li>æ˜¾ç¤ºæ”¶ä»¶ç®±ä¸­çš„é‚®ä»¶åˆ—è¡¨ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[User@Example ~]$ mail        # to get a mail list.</span><br><span class="line">Heirloom Mail version 12.4 7&#x2F;29&#x2F;08.  Type ? for help.</span><br><span class="line">&quot;&#x2F;var&#x2F;spool&#x2F;mail&#x2F;User&quot;: 2 messages 2 new</span><br><span class="line">&gt;N  1 Mail Delivery System  Thu Aug 23 12:46  80&#x2F;2695  &quot;Undelivered Mail Retu&quot;</span><br><span class="line"> N  2 Mail Delivery System  Thu Aug 23 12:52  94&#x2F;3407  &quot;Undelivered Mail Retu&quot;</span><br><span class="line">&amp; 2        # Enter the number after &#39;N&#39; to see the E-mail which you want.</span><br><span class="line">Head</span><br><span class="line">......        # Details.</span><br><span class="line">End</span><br><span class="line">&amp; x    # Enter &#123;x&#125; to keep that mail in Mail-Box,</span><br><span class="line">       # while &#123;q&#125; to move it to Trush-Box(mbox,a file to keep removed mail in $HOME).</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-7.1-ç®¡é“(|)æ“ä½œ</title>
      <link href="/2017/01/07/Linux/linux-7-1-Pipes/"/>
      <url>/2017/01/07/Linux/linux-7-1-Pipes/</url>
      
        <content type="html"><![CDATA[<h1 id="ç®¡é“-æ“ä½œ"><a href="#ç®¡é“-æ“ä½œ" class="headerlink" title="ç®¡é“(|)æ“ä½œ"></a>ç®¡é“(|)æ“ä½œ</h1><h2 id="ï¼šç®¡é“ï¼š"><a href="#ï¼šç®¡é“ï¼š" class="headerlink" title="|ï¼šç®¡é“ï¼š"></a><code>|</code>ï¼šç®¡é“ï¼š</h2><p>â€œ<span style="color: rgb(9, 175, 255);">$ </span><span style="color: rgb(9, 175, 255);">cmd1 | cmd2</span>â€ ï¼šå°†cmd1çš„<strong>è¾“å‡º</strong>  <u>é‡å®šå‘</u> ä¸ºcmd2çš„<strong>è¾“å…¥ã€‚</strong></p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6b05sda96j31kw0km75u.jpg" alt="ink-image"></p><p>ä½¿ç”¨ç®¡é“ç¬¦å·å°†ä¸¤ä¸ªå‘½ä»¤ç»„åˆèµ·æ¥å°±ç›¸å½“äºä½¿ç”¨æ°´ç®¡æ¥å¤´å°†æ°´é¾™å¤´ä¸é«˜å‹æ°´æªæ¥åœ¨ä¸€èµ·ï¼Œè¿˜å¯ä»¥å…ˆå°†æ°´é¾™å¤´æ¥çš„æ°´é€åˆ°çƒ­æ°´ç‚‰åŠ æ¸©åå†é€åˆ°é«˜å‹æ°´æªï¼Œä½¿ç”¨æ°´ç®¡æ¥å¤´å°†3ä¸ªç°æœ‰çš„æ­£å¸¸å·¥ä½œå™¨ç³»ç»Ÿç»„åˆæˆä¸€ä¸ªæ–°çš„åŠŸèƒ½æ›´å¼ºçš„ç³»ç»Ÿã€‚</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6b05sl6pxj30go01i0so.jpg" alt="IMG_1047"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ who | wc -l</span><br><span class="line">        æ˜¾ç¤ºå·¥ä½œç”¨æˆ·æ•°</span><br><span class="line">$ cat &#x2F;etc&#x2F;passwd | wc -l</span><br><span class="line">        æ˜¾ç¤ºæ³¨å†Œç”¨æˆ·æ•°</span><br><span class="line">$ ls -lF &#x2F;bin | more</span><br><span class="line">        ç”¨moreæ˜¾ç¤ºlsçš„å¤§é‡ä¿¡æ¯ï¼ˆå¯ç¿»é¡µï¼‰</span><br></pre></td></tr></table></figure><h2 id="xargsâ€ï¼šå°†ç®¡é“å¯¼å…¥çš„æ•°æ®è½¬æ¢æˆåé¢å‘½ä»¤çš„è¾“å…¥å‚æ•°"><a href="#xargsâ€ï¼šå°†ç®¡é“å¯¼å…¥çš„æ•°æ®è½¬æ¢æˆåé¢å‘½ä»¤çš„è¾“å…¥å‚æ•°" class="headerlink" title="| xargsâ€ï¼šå°†ç®¡é“å¯¼å…¥çš„æ•°æ®è½¬æ¢æˆåé¢å‘½ä»¤çš„è¾“å…¥å‚æ•°"></a><code>| xargs</code>â€ï¼šå°†ç®¡é“å¯¼å…¥çš„æ•°æ®è½¬æ¢æˆåé¢å‘½ä»¤çš„è¾“å…¥å‚æ•°</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cat bd.txt</span><br><span class="line">a.txt</span><br><span class="line">b.txt</span><br><span class="line">c.txt</span><br><span class="line">$ cat bd.txt | xargs rm -f        # åˆ é™¤a.txtï¼Œb.txtï¼Œc.txt</span><br></pre></td></tr></table></figure><h2 id="teeï¼šå‘½ä»¤åˆ†æµè¾“å‡ºï¼šï¼ˆTå‹ç®¡é“ï¼‰"><a href="#teeï¼šå‘½ä»¤åˆ†æµè¾“å‡ºï¼šï¼ˆTå‹ç®¡é“ï¼‰" class="headerlink" title="|teeï¼šå‘½ä»¤åˆ†æµè¾“å‡ºï¼šï¼ˆTå‹ç®¡é“ï¼‰"></a><code>|tee</code>ï¼šå‘½ä»¤åˆ†æµè¾“å‡ºï¼šï¼ˆTå‹ç®¡é“ï¼‰</h2><p>å°†å‰ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºç»“æœç›´æ¥è¾“å…¥ç»™åä¸€ä¸ªå‘½ä»¤ï¼ŒåŒæ—¶è¿˜è¦å°†å‰é¢å‘½ä»¤çš„ç»“æœå­˜å…¥ä¸€ä¸ªæ–‡ä»¶ã€‚</p><blockquote><p>teeå‘½ä»¤çš„åŠŸèƒ½å°±æ˜¯å°†æ ‡å‡†è¾“å…¥å¤åˆ¶ç»™æ¯ä¸€ä¸ªæŒ‡å®šçš„æ–‡ä»¶å’Œæ ‡å‡†è¾“å‡ºã€‚</p></blockquote><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6b10dk5pcj31kw0km40s.jpg" alt="ink-image"></p><p> Tå‹ç®¡é“çš„æ¦‚å¿µæ¥è‡ªç”Ÿæ´»ä¸­çš„è‡ªæ¥æ°´ç®¡çš„Tå‹æ¥å¤´ã€‚åœ¨ä¸€ä¸ªå…¬å•çš„æ°´ç®¡é˜€é—¨ä¸Šæ¥äº†ä¸€ä¸ªTå‹æ¥å¤´å°†â€œå…è´¹â€çš„æ°´è¿›è¡Œäº†åˆ†æµï¼ŒåŒæ—¶æ¥å…¥äº†æ´—è½¦çš„é«˜å‹æ°´æªå’ŒæŠ½æ°´é©¬æ¡¶ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g6b10nyojhj30bu043weo.jpg" alt="IMG_1048"></p><p>e.g.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cut -f1 -d: &#x2F;etc&#x2F;passwd | tee passwd.cut | sort -r | tee passwd.sort | more</span><br><span class="line">        ä»&#x2F;etc&#x2F;passwdä¸­å‰ªå‡ºæ³¨å†Œç”¨æˆ·ååˆ—è¡¨ï¼Œé€šè¿‡åœ¨sort -rå‘½ä»¤ä¹‹å‰å’Œä¹‹ååŠ å…¥ç®¡é“ç¬¦å’Œteeå‘½ä»¤çš„æ–¹å¼å°†æ’åºä¹‹å‰å’Œä¹‹åçš„æ•°æ®åˆ†åˆ«å­˜å…¥passwd.cutå’Œpasswd.sortæ–‡ä»¶ã€‚</span><br><span class="line">        tee passwd.cutå‘½ä»¤å°†ç”±ç®¡é“é€è¿‡æ¥çš„æ•°æ®å­˜å…¥passwd.cutæ–‡ä»¶ï¼ŒåŒæ—¶è¿˜é€šè¿‡ç®¡é“å°†è¿™äº›æ•°æ®é€ç»™ä¸‹ä¸€ä¸ªå‘½ä»¤è¿›è¡Œå¤„ç†ï¼ˆsort -rå‘½ä»¤è¿›è¡Œåå‘æ’åºï¼‰ã€‚tee passwd.sortå‘½ä»¤å°†ç”±ç®¡é“é€è¿‡æ¥çš„æ•°æ®ï¼ˆåå‘æ’åºåçš„ç”¨æˆ·åï¼‰å­˜å…¥passwd.sortæ–‡ä»¶ï¼ŒåŒæ—¶è¿˜é€šè¿‡ç®¡é“å°†è¿™äº›æ•°æ®é€ç»™ä¸‹ä¸€ä¸ªå‘½ä»¤è¿›è¡Œå¤„ç†ï¼ˆmoreå‘½ä»¤è¿›è¡Œåˆ†é¡µæ˜¾ç¤ºï¼‰ã€‚</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-7.0-æ–‡ä»¶æè¿°ç¬¦ä¸é‡å®šå‘</title>
      <link href="/2017/01/06/Linux/linux-7-0-IORedirections/"/>
      <url>/2017/01/06/Linux/linux-7-0-IORedirections/</url>
      
        <content type="html"><![CDATA[<h1 id="æ–‡ä»¶æè¿°ç¬¦ä¸é‡å®šå‘"><a href="#æ–‡ä»¶æè¿°ç¬¦ä¸é‡å®šå‘" class="headerlink" title="æ–‡ä»¶æè¿°ç¬¦ä¸é‡å®šå‘"></a>æ–‡ä»¶æè¿°ç¬¦ä¸é‡å®šå‘</h1><h2 id="æ–‡ä»¶æè¿°ï¼šå†³å®šä»å“ªé‡Œè¯»è¾“å…¥ï¼Œå‘å“ªé‡Œå†™-è¾“å‡º-ä¸-é”™è¯¯"><a href="#æ–‡ä»¶æè¿°ï¼šå†³å®šä»å“ªé‡Œè¯»è¾“å…¥ï¼Œå‘å“ªé‡Œå†™-è¾“å‡º-ä¸-é”™è¯¯" class="headerlink" title="æ–‡ä»¶æè¿°ï¼šå†³å®šä»å“ªé‡Œè¯»è¾“å…¥ï¼Œå‘å“ªé‡Œå†™ è¾“å‡º ä¸ é”™è¯¯"></a>æ–‡ä»¶æè¿°ï¼šå†³å®šä»å“ªé‡Œè¯»è¾“å…¥ï¼Œå‘å“ªé‡Œå†™ è¾“å‡º ä¸ é”™è¯¯</h2><p><strong>æ–‡ä»¶æè¿°ç¬¦ï¼š</strong></p><p> ç”± <code>$ ls -l /dev/std*</code> å¯è§:</p><ul><li><code>0</code> ï¼šstdin</li><li><code>1</code> ï¼šstdout</li><li><code>2</code> ï¼šstderr</li></ul><h2 id="è¾“å‡ºé‡å®šå‘ï¼š"><a href="#è¾“å‡ºé‡å®šå‘ï¼š" class="headerlink" title="è¾“å‡ºé‡å®šå‘ï¼š"></a>è¾“å‡ºé‡å®šå‘ï¼š</h2><ul><li><code>cmd [1|2]&gt; file</code> ï¼šè¦†ç›–æºæ–‡ä»¶ï¼Œæ— åˆ™å»º</li><li><code>cmd [1|2\]&gt;&gt; file</code> ï¼šè¿½åŠ ï¼Œæ— åˆ™å»º</li></ul><blockquote><ol><li>ä¸ä¼šè‡ªåŠ¨é€’å½’è¡¥å…¨è·¯å¾„</li><li><code>[1|2]</code>ï¼Œæ–‡ä»¶æè¿°ç¬¦ï¼ˆstdin|stderrï¼‰ï¼Œç¼ºçœä¸º <code>1</code>ï¼Œä¸ <code>&gt;</code> ä¹‹é—´æ— ç©ºæ ¼</li></ol></blockquote><ul><li><code>$ ls &gt; outfile 2&gt;&amp;1</code> -&gt;Â Â  Â å°†stdoutã€stderrä¸€åŒé‡å®šå‘åˆ°Â <code>outfile</code></li></ul><blockquote><p><code>1</code> çœç•¥ï¼Œ<code>2</code> é‡å®šå‘åˆ° <code>1</code> æŒ‡å‘çš„æ–‡ä»¶</p></blockquote><ul><li><code>cmd &amp;&gt; file</code> ï¼šæŠŠ0ï¼Œ1ï¼Œ2éƒ½é‡å®šå‘è‡³fileã€‚ï¼ˆ<code>&amp;</code> ä»£è¡¨ <code>0&amp;1&amp;2</code>ï¼‰</li></ul><blockquote><p>ç”¨<code>&amp;&gt;</code>å¯èƒ½ä¼šåœ¨æ–‡æ–‡ä»¶ä¸­äº§ç”Ÿä¸€äº›æ— ç”¨çš„ä¿¡æ¯</p></blockquote><h2 id="è¾“å…¥é‡å®šå‘ï¼ˆ-lt-ï¼‰ï¼š"><a href="#è¾“å…¥é‡å®šå‘ï¼ˆ-lt-ï¼‰ï¼š" class="headerlink" title="è¾“å…¥é‡å®šå‘ï¼ˆ&lt;ï¼‰ï¼š"></a>è¾“å…¥é‡å®šå‘ï¼ˆ<code>&lt;</code>ï¼‰ï¼š</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ tr &#39;A-Z&#39; &#39;a-z&#39; &lt; w.txt &gt; u.txt        # å°†wä¸­çš„å¤§å†™-&gt;å°å†™ï¼Œæ”¾å…¥uä¸­</span><br><span class="line">                # 0 -&gt; w.txt</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-6-è®¡ç®—ä¸é€ƒé€¸</title>
      <link href="/2017/01/05/Linux/linux-6-Computation/"/>
      <url>/2017/01/05/Linux/linux-6-Computation/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¡ç®—ä¸é€ƒé€¸"><a href="#è®¡ç®—ä¸é€ƒé€¸" class="headerlink" title="è®¡ç®—ä¸é€ƒé€¸"></a>è®¡ç®—ä¸é€ƒé€¸</h1><ol><li>ç”¨Linuxå‘½ä»¤è¿›è¡Œæ•°å­—è¿ç®—</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ $a1&#x3D;1;a2&#x3D;2;        # å®šä¹‰å˜é‡ï¼Œä¸€è¡Œå¯å¤šä¸ª</span><br><span class="line">$ echo $a1           # è¾“å‡ºa1çš„å€¼</span><br><span class="line">$ echo $[$a1+$a2]    # è¾“å‡ºa1+a2çš„å€¼</span><br><span class="line"># å¯ç”¨è¿ç®—æœ‰ï¼š</span><br><span class="line">     + - * &#x2F; % **    # åŒPythonï¼Œå¯¹æ•´æ•°ç”¨ï¼è¦å»å°¾</span><br></pre></td></tr></table></figure><ol start="2"><li><code>\</code>â€”â€”é€ƒé€¸ç¬¦å·</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ echo &quot;$6830&quot;        # æœªå®šä¹‰çš„ç©ºå˜é‡$6</span><br><span class="line">830        # output</span><br><span class="line">$ echo &quot;\$6830&quot;       # ç”¨â€œ\â€é€ƒé€¸ç¬¦å·è¿˜åŸâ€œ$â€</span><br><span class="line">$6830      # output</span><br></pre></td></tr></table></figure><p>â€˜\â€˜è¿˜å¯ä»¥æ”¾åœ¨å‘½ä»¤æœ€åè¡¨ç»­è¡Œï¼ˆåœ¨ä¸‹ä¸€è¡Œç»§ç»­è¾“å…¥è¯¥å‘½ä»¤ï¼‰</p><ol start="3"><li><p><code>&#39;str&#39;</code>ã€<code>&quot;str&quot;</code>ï¼šæ–‡å­— -&gt; å­—ç¬¦ä¸²</p><ul><li><code>&#39;abc&#39;</code>   ï¼šç¦æ­¢æ‰€æœ‰å‘½ä»¤è¡Œæ‹“å±•åŠŸèƒ½</li><li><code>&quot;abc&quot;</code>Â  ï¼šå…è®¸ä»¥ä¸‹æ‹“å±•ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$</span><br><span class="line">&#96;</span><br><span class="line">\</span><br><span class="line">!</span><br></pre></td></tr></table></figure></li><li><p>åˆ©ç”¨æ‹“å±•ï¼š</p></li></ol><p>å°†ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºä½œä¸ºå¦ä¸€ä¸ªçš„å‚æ•°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ echo &quot;Today is &#96;date&#96;&quot;</span><br><span class="line">ç­‰ä»·äº</span><br><span class="line">$ echo &quot;Today is $(date)&quot;</span><br><span class="line">å³ï¼š</span><br><span class="line">    ç”¨â€œ &#96;cmd&#96; â€æˆ–â€œ $(cmd) â€å®ç°ï¼š</span><br><span class="line">        print(&#39;Today is %s&#39; % cmd())</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-5-å¿«æ·æ“ä½œ</title>
      <link href="/2017/01/04/Linux/linux-5-ShellShortcuts/"/>
      <url>/2017/01/04/Linux/linux-5-ShellShortcuts/</url>
      
        <content type="html"><![CDATA[<h1 id="å¿«æ·æ“ä½œ"><a href="#å¿«æ·æ“ä½œ" class="headerlink" title="å¿«æ·æ“ä½œ"></a>å¿«æ·æ“ä½œ</h1><h2 id="å¿«é€Ÿå‘½ä»¤"><a href="#å¿«é€Ÿå‘½ä»¤" class="headerlink" title="å¿«é€Ÿå‘½ä»¤"></a>å¿«é€Ÿå‘½ä»¤</h2><ul><li>è®¤è¯†é»˜è®¤bashæç¤ºç¬¦ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#96;whoami&#96; @ &#96;uname -n&#96;   &#96;pwd&#96;]</span><br></pre></td></tr></table></figure><ul><li>ç”¨<code>&#123;Tab&#125;</code>è¡¥å…¨å‘½ä»¤ã€‚</li></ul><p>è‹¥æœ‰å¤šä¸ªå¯é€‰æ–¹æ¡ˆï¼ŒæŒ‰ä¸€æ¬¡ä¸æ˜¾ç¤ºï¼ŒæŒ‰ä¸¤æ¬¡æ˜¾ç¤ºå…¨éƒ¨ã€‚</p><ul><li>Linux é€šé…ç¬¦</li></ul><table><thead><tr><th>é€šé…ç¬¦</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>*</td><td>åŒ¹é…0æˆ–å¤šä¸ªå­—ç¬¦</td></tr><tr><td>?</td><td>åŒ¹é…ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td>[xyz]</td><td>åŒ¹é…æ‹¬å·ä¸­çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td>[x-y]</td><td>åŒ¹é…xï½yèŒƒå›´å†…æ‰€æœ‰å­—ç¬¦</td></tr><tr><td>[^a-z]</td><td>é™¤aï½zçš„å­—ç¬¦</td></tr><tr><td>[^xyz]</td><td>é™¤æ‹¬å·ä¸­çš„ä»»æ„å­—ç¬¦</td></tr></tbody></table><ul><li>ä½¿ç”¨<code>&#123;&#125;</code></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ touch &#123;a,b&#125;</span><br><span class="line">        åˆ†åˆ«touchæ–‡ä»¶aå’Œb</span><br><span class="line">$ touch a.&#123;b,c&#125;</span><br><span class="line">        åˆ†åˆ«touchæ–‡ä»¶a.bå’Œa.c</span><br><span class="line">$ touch &#123;a,b&#125;.&#123;c,d&#125;</span><br><span class="line">        åˆ†åˆ«touchæ–‡ä»¶a.cå’Œa.då’Œb.cå’Œb.d</span><br></pre></td></tr></table></figure><ul><li><p><code>history</code>å‘½ä»¤ï¼šåˆ—å‡ºç”¨æˆ·æœ€è¿‘è¾“å…¥è¿‡çš„å‘½ä»¤</p><p>â€‹    å·¦è¾¹æ˜¯å‘½ä»¤çš„ç¼–å·</p><p>â€‹    ç”¨<code>$ !&lt;n&gt;</code>ï¼šé‡æ–°è¿è¡Œç¼–å·ä¸º<code>&lt;n&gt;</code>çš„å‘½ä»¤</p></li><li><p><code>^x^y</code>ï¼šå°†ä¸Šä¸€å‘½ä»¤ä¸­çš„xæ”¹ä¸ºyåé‡æ–°æ‰§è¡Œ</p></li><li><p><code>&#123;ä¸Šä¸‹ç®­å¤´&#125;</code>ï¼šåœ¨ä»¥å‰ä½¿ç”¨è¿‡çš„å‘½ä»¤ä¸­ç§»åŠ¨</p></li><li><p><code>&#123;ctrl+r&#125;</code>åœ¨å‘½ä»¤çš„å†å²ä¸­æŸ¥æ‰¾:</p><ul><li>å‡ºç°<code>(reverse-i-search)&#39;:</code></li><li>è¾“å…¥å…³é”®å­—</li><li>å‡ºç°å‘½ä»¤ï¼Œå›è½¦æ‰§è¡Œ</li></ul></li><li><p>å…ˆæŒ‰<code>&#123;Esc&#125;</code>å†æŒ‰<code>&#123;.&#125;</code> æˆ– åŒæ—¶æŒ‰<code>&#123;Alt+.&#125;</code>ï¼šæå–ä¸Šä¸€å‘½ä»¤çš„æœ€åä¸€ä¸ªå‚æ•°</p></li></ul><h2 id="ç»ˆç«¯å¿«æ·é”®"><a href="#ç»ˆç«¯å¿«æ·é”®" class="headerlink" title="ç»ˆç«¯å¿«æ·é”®"></a>ç»ˆç«¯å¿«æ·é”®</h2><ul><li><code>ctrl+A</code>: å…‰æ ‡ç§»åˆ°å‘½ä»¤è¡Œ<strong>å¼€å¤´</strong>å¤„</li><li><code>ctrl+E</code>: å…‰æ ‡ç§»åˆ°å‘½ä»¤è¡Œ<strong>ç»“å°¾</strong>å¤„</li><li><code>ctrl+U</code>: å‘å‰<strong>åˆ é™¤å†…å®¹</strong>è‡³æç¤ºç¬¦</li><li><code>ctrl+K</code>: å‘å<strong>åˆ é™¤å†…å®¹</strong>è‡³ç»“å°¾</li><li><code>ctrl+å·¦|å³</code>: å‘å·¦å³<strong>ç§»åŠ¨</strong>ä¸€ä¸ªå­—</li></ul><h2 id="Gnomeç»ˆç«¯å¿«æ·é”®"><a href="#Gnomeç»ˆç«¯å¿«æ·é”®" class="headerlink" title="Gnomeç»ˆç«¯å¿«æ·é”®"></a>Gnomeç»ˆç«¯å¿«æ·é”®</h2><ul><li><code>ctrl+shift+T</code>: å¼€å¯æ–°é€‰é¡¹å¡</li><li><code>ctrl+PgUp/PgDn</code>: åˆ‡æ¢åˆ°ä¸Š/ä¸‹ä¸ªé€‰é¡¹å¡</li><li><code>alt+N</code>: åˆ‡æ¢åˆ°ç¬¬Nä¸ªé€‰é¡¹å¡</li><li><code>ctrl+shift+C/V</code>: å¤åˆ¶ï¼Œç²˜è´´</li><li><code>ctrl+shift+W</code>: å…³é—­ä¸€ä¸ªé€‰é¡¹å¡</li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-4.2-æ­£æ–‡å¤„ç†</title>
      <link href="/2017/01/03/Linux/linux-4-2-TextHandle/"/>
      <url>/2017/01/03/Linux/linux-4-2-TextHandle/</url>
      
        <content type="html"><![CDATA[<h1 id="æ­£æ–‡-å¤„ç†"><a href="#æ­£æ–‡-å¤„ç†" class="headerlink" title="æ­£æ–‡.å¤„ç†"></a>æ­£æ–‡.å¤„ç†</h1><h2 id="unix2dos-dos2unixï¼šUnix-ä¸-DOS-æ­£æ–‡è½¬åŒ–"><a href="#unix2dos-dos2unixï¼šUnix-ä¸-DOS-æ­£æ–‡è½¬åŒ–" class="headerlink" title="unix2dos, dos2unixï¼šUnix ä¸ DOS æ­£æ–‡è½¬åŒ–"></a><code>unix2dos</code>, <code>dos2unix</code>ï¼šUnix ä¸ DOS æ­£æ–‡è½¬åŒ–</h2><p>UNIX ç³»ç»Ÿçš„æ­£æ–‡ï¼ˆçº¯æ–‡å­—ï¼‰æ ¼å¼ä¸­åªç”¨æ¢è¡Œç¬¦<code>\n</code>ä½œä¸ºè¡Œç»“æŸç¬¦ï¼›</p><p>DOS &amp; Windows ç³»ç»Ÿçš„æ­£æ–‡ä¸­æ˜¯ä»¥å›è½¦ç¬¦ <code>\r</code> å’Œæ¢è¡Œç¬¦ <code>\n</code> ä½œä¸ºè¡Œç»“æŸç¬¦ï¼›</p><p>ç”¨ <code>cat -A filename</code> å¯è§äºŒè€…åŒºåˆ«ã€‚</p><p>å°† DOS æ ¼å¼çš„æ–‡ä»¶è½¬æ¢æˆ UNIX æ ¼å¼çš„æ–‡ä»¶ç”¨ <code>dos2unix file_name</code>ï¼›</p><p>å°† UNIX æ ¼å¼çš„æ–‡ä»¶è½¬æ¢æˆ DOS æ ¼å¼çš„æ–‡ä»¶ç”¨ <code>unix2dos file_name</code>ï¼›</p><h2 id="diff-sdiffï¼šæ¯”è¾ƒä¸¤ä¸ªæ–‡ä»¶çš„å·®åˆ«"><a href="#diff-sdiffï¼šæ¯”è¾ƒä¸¤ä¸ªæ–‡ä»¶çš„å·®åˆ«" class="headerlink" title="diff, sdiffï¼šæ¯”è¾ƒä¸¤ä¸ªæ–‡ä»¶çš„å·®åˆ«"></a><code>diff</code>, <code>sdiff</code>ï¼šæ¯”è¾ƒä¸¤ä¸ªæ–‡ä»¶çš„å·®åˆ«</h2><h3 id="diff-file-1-file-2ï¼šåªè¾“å‡ºä¸¤è€…ä¸åŒç‚¹"><a href="#diff-file-1-file-2ï¼šåªè¾“å‡ºä¸¤è€…ä¸åŒç‚¹" class="headerlink" title="diff file_1 file_2ï¼šåªè¾“å‡ºä¸¤è€…ä¸åŒç‚¹"></a><code>diff file_1 file_2</code>ï¼šåªè¾“å‡ºä¸¤è€…ä¸åŒç‚¹</h3><p>æ˜¾ç¤ºç»“æœä¸­ï¼š</p><ul><li>å­—æ¯cä¸º æ¯”è¾ƒï¼Œæ¯”è¾ƒæŸè¡ŒäºŒè€…ä¸åŒç‚¹ï¼›</li><li>å­—æ¯dæ˜¯ ä¸åŒï¼Œæ˜¾ç¤ºä¸€æ–‡æ— ä¸€æ–‡æœ‰çš„ï¼›</li><li>â€œ&lt;â€è¡¨ç¤ºç¬¬1ä¸ªæ–‡ä»¶ä¸­çš„æ•°æ®è¡Œã€‚</li><li>â€œ&gt;â€è¡¨ç¤ºç¬¬2ä¸ªæ–‡ä»¶ä¸­çš„æ•°æ®è¡Œã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ diff letters.upper letters</span><br><span class="line">2c2        # ç¬¬1ä¸ªæ–‡ä»¶çš„ç¬¬2è¡Œä¸ç¬¬2ä¸ªæ–‡ä»¶çš„ç¬¬2è¡Œæ¯”è¾ƒã€‚</span><br><span class="line">&lt; B        # ç¬¬1ä¸ªæ–‡ä»¶çš„ç¬¬2è¡Œä¸ºBã€‚</span><br><span class="line">---</span><br><span class="line">&gt; b        # ç¬¬2ä¸ªæ–‡ä»¶çš„ç¬¬2è¡Œä¸ºbã€‚</span><br><span class="line">6c6        # ç¬¬1ä¸ªæ–‡ä»¶çš„ç¬¬6è¡Œä¸ç¬¬2ä¸ªæ–‡ä»¶çš„ç¬¬6è¡Œæ¯”è¾ƒã€‚</span><br><span class="line">&lt; F        # ç¬¬1ä¸ªæ–‡ä»¶çš„ç¬¬6è¡Œä¸ºFã€‚</span><br><span class="line">---</span><br><span class="line">&gt; f        # ç¬¬2ä¸ªæ–‡ä»¶çš„ç¬¬6è¡Œä¸ºfã€‚</span><br><span class="line">8d7        # ç¬¬1ä¸ªæ–‡ä»¶ä¸€å…±æœ‰8è¡Œï¼Œè€Œç¬¬2ä¸ªæ–‡ä»¶ä¸€å…±æœ‰7è¡Œã€‚</span><br><span class="line">&lt; H        # ç¬¬1ä¸ªæ–‡ä»¶çš„ç¬¬8è¡Œï¼ˆä¹Ÿæ˜¯æœ€åä¸€è¡Œï¼‰ä¸ºHã€‚</span><br></pre></td></tr></table></figure><h3 id="sdiff-file-1-file-2ï¼šside-by-side-è¾“å‡ºä¸¤è€…æ‰€æœ‰è¡Œï¼Œæ ‡ç¤ºä¸åŒ"><a href="#sdiff-file-1-file-2ï¼šside-by-side-è¾“å‡ºä¸¤è€…æ‰€æœ‰è¡Œï¼Œæ ‡ç¤ºä¸åŒ" class="headerlink" title="sdiff file_1 file_2ï¼šside-by-side è¾“å‡ºä¸¤è€…æ‰€æœ‰è¡Œï¼Œæ ‡ç¤ºä¸åŒ"></a><code>sdiff file_1 file_2</code>ï¼šside-by-side è¾“å‡ºä¸¤è€…æ‰€æœ‰è¡Œï¼Œæ ‡ç¤ºä¸åŒ</h3><p>æ˜¾ç¤ºç»“æœä¸­ï¼š</p><ul><li><p>â€œ|â€å·¦ä¾§è¡¨ç¤ºç¬¬1ä¸ªæ–‡ä»¶ä¸­çš„æ•°æ®è¡Œã€‚</p></li><li><p>â€œ|â€å³ä¾§è¡¨ç¤ºç¬¬2ä¸ªæ–‡ä»¶ä¸­çš„æ•°æ®è¡Œã€‚</p></li><li><p>â€œ&lt;â€è¡¨ç¤ºç¬¬1ä¸ªæ–‡ä»¶ä¸­çš„æ•°æ®è¡Œï¼ˆå½“ç¬¬1ä¸ªæ–‡ä»¶ä¸­æœ‰æ•°æ®ï¼Œä½†ç¬¬2ä¸ªæ–‡ä»¶ä¸­æ²¡æœ‰æ—¶ï¼‰ã€‚</p></li><li><p>â€œ&gt;â€è¡¨ç¤ºç¬¬2ä¸ªæ–‡ä»¶ä¸­çš„æ•°æ®è¡Œï¼ˆå½“ç¬¬2ä¸ªæ–‡ä»¶ä¸­æœ‰æ•°æ®ï¼Œä½†ç¬¬1ä¸ªæ–‡ä»¶ä¸­æ²¡æœ‰æ—¶ï¼‰ã€‚</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ sdiff letters.upper letters</span><br><span class="line">A                             A</span><br><span class="line">B                            | b            # ç¬¬1ä¸ªæ–‡ä»¶ä¸­ä¸ºBï¼Œç¬¬2ä¸ªæ–‡ä»¶ä¸­ä¸ºbã€‚</span><br><span class="line">C                             C </span><br><span class="line">D                             D</span><br><span class="line">E                             E</span><br><span class="line">F                            | f            # ç¬¬1ä¸ªæ–‡ä»¶ä¸­ä¸ºFï¼Œç¬¬2ä¸ªæ–‡ä»¶ä¸­ä¸ºfã€‚</span><br><span class="line">G                             G</span><br><span class="line">H                             &lt;            # ç¬¬1ä¸ªæ–‡ä»¶ä¸­ä¸ºHï¼Œç¬¬2ä¸ªæ–‡ä»¶ä¸­çš„è¿™ä¸€è¡Œä¸ºç©ºã€‚</span><br></pre></td></tr></table></figure><blockquote><p><code>sdiff</code> å‘½ä»¤çš„æ˜¾ç¤ºç»“æœæ›´å®¹æ˜“é˜…è¯»ã€‚<br>ä½†æ˜¯å¦‚æœæ¯”è¾ƒçš„ä¸¤ä¸ªæ–‡ä»¶å¾ˆå¤§ï¼Œè€Œå…¶ä¸­çš„å·®åˆ«åˆå¾ˆå°‘ï¼Œä½¿ç”¨ <code>diff</code> å‘½ä»¤å¯èƒ½æ›´å¥½äº›ã€‚</p></blockquote><h2 id="aspell-lookï¼šæ£€æŸ¥å•è¯çš„æ‹¼å†™"><a href="#aspell-lookï¼šæ£€æŸ¥å•è¯çš„æ‹¼å†™" class="headerlink" title="aspell, lookï¼šæ£€æŸ¥å•è¯çš„æ‹¼å†™"></a><code>aspell</code>, <code>look</code>ï¼šæ£€æŸ¥å•è¯çš„æ‹¼å†™</h2><p>aspellï¼Œlook çš„å­—å…¸æ˜¯ <code>/usr/share/dict/words </code></p><h3 id="aspell"><a href="#aspell" class="headerlink" title="aspell"></a><code>aspell</code></h3><p><code>aspell</code> æ˜¯Linuxç³»ç»Ÿä¸Šçš„ä¸€ä¸ªäº¤äº’å¼çš„è‹±è¯­æ‹¼å†™æ£€æŸ¥ç¨‹åºï¼Œè¯¥ç¨‹åºé€šè¿‡ä¸€ä¸ªç®€å•çš„èœå•é©±åŠ¨çš„ç•Œé¢æ¥æä¾›æ”¹æ­£è‹±æ–‡å•è¯çš„å»ºè®®ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ aspell check file_name</span><br><span class="line">        Enteråï¼Œ</span><br><span class="line">        å…‰æ ‡åœç•™åœ¨ç¬¬1ä¸ªæœ‰æ‹¼å†™é”™è¯¯çš„å•è¯ä¸Šï¼Œ</span><br><span class="line">        å¹¶åœ¨ç»ˆç«¯çª—å£ä¸‹éƒ¨ç»™å‡ºä¸€äº›å¯ä¾›é€‰æ‹©çš„æ­£ç¡®å•è¯ï¼›</span><br><span class="line">        è¾“å…¥æŸä¸ªå•è¯å‰é¢çš„ç¼–å·æ¥é€‰æ‹©è¿™ä¸ªå•è¯ï¼Œ</span><br><span class="line">        ç³»ç»Ÿå°±ä¼šç«‹å³ä¿®æ”¹å…‰æ ‡æ‰€åœ¨å¤„çš„å•è¯ï¼›</span><br><span class="line">        ä¹‹åå…‰æ ‡å°†ç§»åˆ°ä¸‹ä¸€ä¸ªæœ‰æ‹¼å†™é”™è¯¯çš„å•è¯ã€‚</span><br><span class="line">$ aspell list &lt; file_name</span><br><span class="line">            ä»¥éäº¤äº’çš„æ–¹å¼åœ¨ç»ˆç«¯çª—å£ä¸­åˆ—å‡ºæŸä¸ªæ–‡ä»¶ä¸­çš„å…¨éƒ¨æœ‰æ‹¼æ³•é”™è¯¯çš„è‹±è¯­å•è¯</span><br></pre></td></tr></table></figure><p>â€¢ <code>look  &lt;sth&gt;</code>ï¼šåˆ—å‡ºæ‰€æœ‰ä»¥sthå¼€å¤´çš„è‹±è¯­å•è¯ä»¥ä¾›é€‰æ‹©ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ look progra</span><br><span class="line">prograde</span><br><span class="line">program</span><br><span class="line">......</span><br></pre></td></tr></table></figure><h2 id="expand-fmt-pr-é‡æ–°æ ¼å¼åŒ–æ­£æ–‡"><a href="#expand-fmt-pr-é‡æ–°æ ¼å¼åŒ–æ­£æ–‡" class="headerlink" title="expand, fmt, pr: é‡æ–°æ ¼å¼åŒ–æ­£æ–‡"></a><code>expand</code>, <code>fmt</code>, <code>pr</code>: é‡æ–°æ ¼å¼åŒ–æ­£æ–‡</h2><h3 id="expandï¼šå°†TabåŒ–ä¸ºç©ºæ ¼"><a href="#expandï¼šå°†TabåŒ–ä¸ºç©ºæ ¼" class="headerlink" title="expandï¼šå°†TabåŒ–ä¸ºç©ºæ ¼"></a><code>expand</code>ï¼šå°†TabåŒ–ä¸ºç©ºæ ¼</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ expand [-t 1] data.tab &gt; data.spaces</span><br><span class="line">        -t nï¼šè¡¨ç¤ºå°†åˆ¶è¡¨é”®è½¬æ¢æˆnä¸ªç©ºæ ¼ç¬¦ã€‚</span><br></pre></td></tr></table></figure><h3 id="fmt-æ ¼å¼åŒ–æ–‡æœ¬"><a href="#fmt-æ ¼å¼åŒ–æ–‡æœ¬" class="headerlink" title="fmt: æ ¼å¼åŒ–æ–‡æœ¬"></a><code>fmt</code>: æ ¼å¼åŒ–æ–‡æœ¬</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ fmt -u -w48 news &gt; news.fmt</span><br><span class="line">        fmtå°†å®ƒçš„è¾“å…¥æ ¼å¼åŒ–æˆä¸€äº›æ®µè½ï¼Œ</span><br><span class="line">        å…¶ä¸­æ®µè½å®½åº¦æ˜¯ä½¿ç”¨-wné€‰é¡¹æ¥å®šä¹‰çš„ï¼ˆwä¸ºwidthï¼Œnä¸ºå­—ç¬¦çš„æ•°ç›®ï¼Œç³»ç»Ÿé»˜è®¤å®½åº¦ä¸º75ä¸ªå­—ç¬¦ï¼‰ã€‚</span><br><span class="line">        åˆ©ç”¨-ué€‰é¡¹å°†æ–‡ä»¶ä¸­çš„ç©ºæ ¼ç»Ÿä¸€åŒ–ï¼ˆæ¯ä¸ªå•è¯ä¹‹é—´ä½¿ç”¨ä¸€ä¸ªç©ºæ ¼åˆ†éš”ï¼Œæ¯ä¸ªå¥å­ä¹‹é—´ä½¿ç”¨ä¸¤ä¸ªç©ºæ ¼åˆ†éš”ï¼‰ã€‚</span><br><span class="line">            </span><br><span class="line">        fmtå‘½ä»¤å°†å®ƒçš„è¾“å…¥ä¸­çš„ç©ºè¡Œå½“ä½œæ®µè½åˆ†éš”ç¬¦çœ‹å¾…ã€‚</span><br></pre></td></tr></table></figure><h3 id="prï¼šæŒ‰ç…§æ‰“å°æœºçš„æ ¼å¼é‡æ–°ç¼–æ’çº¯æ–‡æœ¬æ–‡ä»¶ä¸­çš„å†…å®¹"><a href="#prï¼šæŒ‰ç…§æ‰“å°æœºçš„æ ¼å¼é‡æ–°ç¼–æ’çº¯æ–‡æœ¬æ–‡ä»¶ä¸­çš„å†…å®¹" class="headerlink" title="prï¼šæŒ‰ç…§æ‰“å°æœºçš„æ ¼å¼é‡æ–°ç¼–æ’çº¯æ–‡æœ¬æ–‡ä»¶ä¸­çš„å†…å®¹"></a><code>pr</code>ï¼šæŒ‰ç…§æ‰“å°æœºçš„æ ¼å¼é‡æ–°ç¼–æ’çº¯æ–‡æœ¬æ–‡ä»¶ä¸­çš„å†…å®¹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ pr file</span><br><span class="line">        prå‘½ä»¤çš„é»˜è®¤è¾“å‡ºä¸ºæ¯é¡µ66è¡Œï¼Œå…¶ä¸­56è¡Œä¸ºæ­£æ–‡å†…å®¹ï¼Œå¹¶åŒ…æ‹¬è¡¨å¤´ã€‚</span><br><span class="line">        è‹¥æ²¡æœ‰æŒ‡å®šåˆ—è¡¨å¤´ï¼ˆHeaderï¼‰ï¼Œç³»ç»Ÿé»˜è®¤ä½¿ç”¨æ–‡ä»¶åä½œä¸ºåˆ—è¡¨å¤´ï¼Œå¹¶åœ¨æ¯é¡µçš„é¡µé¦–éƒ¨åˆ†æ˜¾ç¤ºã€‚</span><br><span class="line">        å¦å¤–ï¼Œæ¯é¡µçš„é¡µé¦–éƒ¨åˆ†è¿˜æœ‰é¡µç å’Œæ—¶é—´(inode.M_time)ã€‚</span><br><span class="line">$ pr -h&quot;English Dictionary on Linux&quot; -l18 -5 &#x2F;usr&#x2F;share&#x2F;dict&#x2F;words | more</span><br><span class="line">        -hé€‰é¡¹ä¸ºåˆ—è¡¨å¤´ï¼ˆHeaderï¼‰ï¼Œ</span><br><span class="line">        åœ¨håé¢ä½¿ç”¨åŒå¼•å·æ‹¬èµ·æ¥çš„å°±æ˜¯è¦æ˜¾ç¤ºçš„è¡¨å¤´ä¿¡æ¯ï¼Œ</span><br><span class="line">        -lé€‰é¡¹ç”¨æ¥å®šä¹‰æ¯é¡µçš„è¡Œæ•°ï¼Œ-l18è¡¨ç¤ºæ¯é¡µéƒ½æœ‰18è¡Œï¼Œ</span><br><span class="line">                ï¼ˆ-lé€‰é¡¹åçš„æ•°ç›®ä¸èƒ½å¤ªå°ï¼Œå¦‚æœå¤ªå°prå‘½ä»¤ä¼šå¿½ç•¥è¿™ä¸€é€‰é¡¹ï¼‰</span><br><span class="line">        -5è¡¨ç¤ºæ¯é¡µæ‰“å°5åˆ—ã€‚</span><br><span class="line">        </span><br><span class="line">---------------------------</span><br><span class="line">        </span><br><span class="line"># Outputï¼š</span><br><span class="line"></span><br><span class="line">2006-10-08 02:00           English Dictionary on Linux            Page 1</span><br><span class="line">&amp;c             &#39;prentice      &#39;shun          &#39;tis          &#39;un</span><br><span class="line">&#39;d             &#39;re            &#39;slid          &#39;twas         &#39;ve</span><br><span class="line">......</span><br><span class="line">2006-10-08 02:00           English Dictionary on Linux            Page 2</span><br><span class="line">-acal          -acy          -age          -ana           -ar</span><br><span class="line">-acea          -ad           -agogue       -ance          -arch</span><br><span class="line">--More--</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-4.1-æ­£æ–‡æ–‡æœ¬æ“ä½œ</title>
      <link href="/2017/01/02/Linux/linux-4-1-TextOperate/"/>
      <url>/2017/01/02/Linux/linux-4-1-TextOperate/</url>
      
        <content type="html"><![CDATA[<h1 id="æ­£æ–‡æ–‡æœ¬æ“ä½œ"><a href="#æ­£æ–‡æ–‡æœ¬æ“ä½œ" class="headerlink" title="æ­£æ–‡æ–‡æœ¬æ“ä½œ"></a>æ­£æ–‡æ–‡æœ¬æ“ä½œ</h1><h3 id="trï¼šå­—ç¬¦è½¬æ¢"><a href="#trï¼šå­—ç¬¦è½¬æ¢" class="headerlink" title="trï¼šå­—ç¬¦è½¬æ¢"></a><code>tr</code>ï¼šå­—ç¬¦è½¬æ¢</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ tr &#39;A-Z&#39; &#39;a-z&#39; &lt; w.txt &gt; u.txt        # å°†wä¸­çš„å¤§å†™-&gt;å°å†™ï¼Œæ”¾å…¥uä¸­</span><br><span class="line">$ tr -d &quot;\r&quot; &lt; dept.data &gt; dept.data.unix        # å°†DOSæ ¼å¼çš„æ­£æ–‡æ–‡ä»¶ï¼ˆä»¥å›è½¦â€œ\râ€ç¬¦å’Œæ¢è¡Œâ€œ\nâ€ç¬¦ç»“æŸä¸€è¡Œï¼‰è½¬æ¢æˆLinuxæ ¼å¼çš„æ–‡ä»¶ï¼ˆåªç”¨æ¢è¡Œç¬¦â€œ\nâ€æ¥ç»“æŸä¸€è¡Œï¼‰</span><br></pre></td></tr></table></figure><h3 id="cutï¼šä»æ–‡ä»¶ä¸­å‰ªå‡ºä¸€ä¸ªå­—æ®µ-åˆ—-è‡³1-stdout"><a href="#cutï¼šä»æ–‡ä»¶ä¸­å‰ªå‡ºä¸€ä¸ªå­—æ®µ-åˆ—-è‡³1-stdout" class="headerlink" title="cutï¼šä»æ–‡ä»¶ä¸­å‰ªå‡ºä¸€ä¸ªå­—æ®µ(åˆ—)è‡³1(stdout)"></a><code>cut</code>ï¼šä»æ–‡ä»¶ä¸­å‰ªå‡ºä¸€ä¸ªå­—æ®µ(åˆ—)è‡³1(stdout)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ cut [options] [file]</span><br><span class="line">        -fï¼šè¯´æ˜(å®šä¹‰)å­—æ®µ(åˆ—)</span><br><span class="line">        -cï¼šè¦å‰ªåˆ‡çš„å­—ç¬¦ï¼š</span><br><span class="line">                ã€Œ-c4-7ã€ï¼šå‰ªä¸‹æ¯è¡Œ4ï½7çš„å­—ç¬¦</span><br><span class="line">        -dï¼šè¯´æ˜(å®šä¹‰)å­—æ®µçš„åˆ†éš”ç¬¦(é»˜è®¤ä¸ºTab)</span><br><span class="line">                ã€Œ-d,ã€ï¼šä»¥â€œ,â€ä¸ºåˆ†éš”ç¬¦</span><br><span class="line">$ cut -f2 emp.data</span><br><span class="line">        æ˜¾ç¤ºemp.dataä¸­çš„ç¬¬äºŒåˆ—è‡³stdout</span><br></pre></td></tr></table></figure><h3 id="pasteï¼šç²˜è´´"><a href="#pasteï¼šç²˜è´´" class="headerlink" title="pasteï¼šç²˜è´´"></a><code>paste</code>ï¼šç²˜è´´</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ paste  -d,  name.txt  score.txt  &gt;  student.txt</span><br><span class="line">        -dï¼šè¯´æ˜(å®šä¹‰)å­—æ®µçš„åˆ†éš”ç¬¦(é»˜è®¤ä¸ºTab)</span><br><span class="line">                ã€Œ-d,ã€ï¼šä»¥â€œ,â€ä¸ºåˆ†éš”ç¬¦</span><br><span class="line">        &gt; ï¼šæ¨ªå‘åˆå¹¶æ–‡ä»¶ï¼š</span><br><span class="line">            |Mike|         |99|          |Mike,99|</span><br><span class="line">            |Jake|    +    |98|    -&gt;    |Jake,98|</span><br><span class="line">            |Anny|         |97|          |Anny,97|</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="uniqï¼šå»æ‰æ–‡ä»¶ä¸­ç›¸é‚»çš„é‡å¤è¡Œ"><a href="#uniqï¼šå»æ‰æ–‡ä»¶ä¸­ç›¸é‚»çš„é‡å¤è¡Œ" class="headerlink" title="uniqï¼šå»æ‰æ–‡ä»¶ä¸­ç›¸é‚»çš„é‡å¤è¡Œ"></a><code>uniq</code>ï¼šå»æ‰æ–‡ä»¶ä¸­ç›¸é‚»çš„é‡å¤è¡Œ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ uniq [opts] [file]</span><br><span class="line">        -cï¼šåœ¨æ˜¾ç¤ºçš„è¡Œå‰å† ä»¥è¯¥è¡Œå‡ºç°çš„æ¬¡æ•°</span><br><span class="line">        -dï¼šåªæ˜¾ç¤ºé‡å¤è¡Œ</span><br><span class="line">        -iï¼šå¿½ç•¥å­—ç¬¦çš„å¤§å°å†™</span><br><span class="line">        -uï¼šåªæ˜¾ç¤ºå”¯ä¸€çš„è¡Œ</span><br></pre></td></tr></table></figure><h3 id="sortï¼šæ’åº"><a href="#sortï¼šæ’åº" class="headerlink" title="sortï¼šæ’åº"></a><code>sort</code>ï¼šæ’åº</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sort [opt] [file]</span><br><span class="line">         -rï¼šåå‘æ’åº</span><br><span class="line">         -fï¼šå¿½ç•¥å¤§å°å†™</span><br><span class="line">         -nï¼šæŒ‰æ•°å­—é¡ºåºæ’åº</span><br><span class="line">          -uï¼šå»æ‰é‡å¤è¡Œ</span><br><span class="line">          -t cï¼šä»¥å­—ç¬¦cä¸ºåˆ†å‰²ç¬¦</span><br><span class="line">          -k N1,[N2]ï¼šæŒ‰N1-&gt;N2å­—æ®µæ’åº</span><br></pre></td></tr></table></figure><h3 id="col-Tabè½¬ç©ºæ ¼ï¼š"><a href="#col-Tabè½¬ç©ºæ ¼ï¼š" class="headerlink" title="col: Tabè½¬ç©ºæ ¼ï¼š"></a><code>col</code>: Tabè½¬ç©ºæ ¼ï¼š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ col -x &lt; e.tabs &gt;e.spaces</span><br><span class="line">        å°†e.tabsä¸­çš„Tabå­—ç¬¦(^I)åŒ–ä¸ºç©ºæ ¼å­˜åœ¨e.spacesä¸­</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-4.0-æ­£æ–‡æµè§ˆ</title>
      <link href="/2017/01/01/Linux/linux-4-0-TextRead/"/>
      <url>/2017/01/01/Linux/linux-4-0-TextRead/</url>
      
        <content type="html"><![CDATA[<h1 id="æ­£æ–‡æµè§ˆ"><a href="#æ­£æ–‡æµè§ˆ" class="headerlink" title="æ­£æ–‡æµè§ˆ"></a>æ­£æ–‡æµè§ˆ</h1><blockquote><p>æ­£æ–‡ï¼Œå³å­—ç¬¦ä¸² / çº¯æ–‡æœ¬æ–‡ä»¶çš„å†…å®¹ã€‚</p></blockquote><h3 id="catï¼šæµè§ˆæ­£æ–‡æ–‡ä»¶å†…å®¹"><a href="#catï¼šæµè§ˆæ­£æ–‡æ–‡ä»¶å†…å®¹" class="headerlink" title="catï¼šæµè§ˆæ­£æ–‡æ–‡ä»¶å†…å®¹"></a><code>cat</code>ï¼šæµè§ˆæ­£æ–‡æ–‡ä»¶å†…å®¹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ cat [options] [files]</span><br><span class="line">    -Aï¼šæ˜¾ç¤ºå†…å®¹ï¼ŒåŒ…æ‹¬ä¸å¯è§çš„ç‰¹æ®Šå­—ç¬¦</span><br><span class="line">    -sï¼šå°†ä¸¤ä¸ªåŠä»¥ä¸Šçš„ç©ºè¡Œçœç•¥ä¸ºä¸€ä¸ªç©ºè¡Œ</span><br><span class="line">    -bï¼šåŠ å…¥è¡Œå·</span><br><span class="line">$ cat &gt; filename</span><br><span class="line">    åˆ›å»ºæ–°æ–‡æœ¬æ–‡ä»¶ï¼Œå†™å…¥å†…å®¹</span><br><span class="line">    ç©ºè¡Œ&#123;Ctr+d&#125;ï¼Œä¿å­˜é€€å‡º        # &#123;Ctr+c&#125;:å¼ºè¡Œç»ˆæ­¢</span><br><span class="line">            [æ³¨æ„]ï¼šç”¨catæ‰“å¼€äºŒè¿›åˆ¶æ–‡ä»¶ä¼šé€ æˆç»ˆç«¯åœæ­¢å·¥ä½œï¼Œå¯å¼€å¯ä¸€ä¸ªæ–°çš„ç»ˆç«¯ä»¥è§£å†³ã€‚</span><br></pre></td></tr></table></figure><pre><code>       âš ï¸ \[æ³¨æ„\]ï¼šç”¨ cat æ‰“å¼€äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½ä¼šé€ æˆç»ˆç«¯åœæ­¢å·¥ä½œï¼Œå¯å¼€å¯ä¸€ä¸ªæ–°çš„ç»ˆç«¯ä»¥è§£å†³ã€‚</code></pre><h3 id="headï¼šæµè§ˆæ–‡ä»¶å¤´å‡ è¡Œ"><a href="#headï¼šæµè§ˆæ–‡ä»¶å¤´å‡ è¡Œ" class="headerlink" title="headï¼šæµè§ˆæ–‡ä»¶å¤´å‡ è¡Œ"></a><code>head</code>ï¼šæµè§ˆæ–‡ä»¶å¤´å‡ è¡Œ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ head [-n x] file</span><br><span class="line">    æµè§ˆæ–‡ä»¶å¤´xè¡Œ</span><br><span class="line">    è‹¥çœå»[-n x]åˆ™æ˜¾ç¤ºå¤´10è¡Œ</span><br></pre></td></tr></table></figure><h3 id="tailï¼šæµè§ˆæ–‡ä»¶åå‡ è¡Œ"><a href="#tailï¼šæµè§ˆæ–‡ä»¶åå‡ è¡Œ" class="headerlink" title="tailï¼šæµè§ˆæ–‡ä»¶åå‡ è¡Œ"></a><code>tail</code>ï¼šæµè§ˆæ–‡ä»¶åå‡ è¡Œ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ tail file</span><br><span class="line">    æµè§ˆæ–‡ä»¶å10è¡Œ</span><br><span class="line">$ tail -[n]x  file</span><br><span class="line">    æ˜¾ç¤ºä»æœ«å°¾ç®—èµ·çš„xè¡Œ</span><br><span class="line">    æœ‰æ— néƒ½ä¸€æ ·</span><br><span class="line">$ tail +[n]x  file</span><br><span class="line">    æ˜¾ç¤ºä»æ–‡ä»¶ç¬¬xè¡Œä¹‹åçš„å†…å®¹</span><br><span class="line">    æœ‰æ— néƒ½ä¸€æ ·</span><br><span class="line">$tail -f file</span><br><span class="line">    â€œ-fâ€œ &#x3D;&#x3D; â€--followâ€œ</span><br><span class="line">    å½“ä¸€ä¸ªæ­£æ–‡æ–‡ä»¶å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒæŠŠå˜åŒ–æ˜¾ç¤ºå‡ºæ¥</span><br><span class="line">    &#123;ctrl+c&#125;é€€å‡º</span><br><span class="line"># tail -f &#x2F;var&#x2F;log&#x2F;messages</span><br><span class="line">    ç›‘è§†æ—¥å¿—</span><br></pre></td></tr></table></figure><h3 id="wcï¼š-word-count-å­—æ•°ç»Ÿè®¡"><a href="#wcï¼š-word-count-å­—æ•°ç»Ÿè®¡" class="headerlink" title="wcï¼š(word count)å­—æ•°ç»Ÿè®¡"></a><code>wc</code>ï¼š(word count)å­—æ•°ç»Ÿè®¡</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ wc [-options] file</span><br><span class="line">    æ˜¾ç¤ºæ–‡ä»¶ è¡Œã€å•è¯ã€å­—ç¬¦ æ•°</span><br><span class="line">        æ— é€‰é¡¹ä¾æ¬¡æ˜¾ç¤ºlï¼Œwï¼Œc</span><br><span class="line">        -lï¼šè¡Œæ•°</span><br><span class="line">        -wï¼šå•è¯æ•°</span><br><span class="line">        -cï¼šå­—ç¬¦æ•°</span><br></pre></td></tr></table></figure><h3 id="more-file-ï¼šå¯ç¿»é¡µåœ°æµè§ˆæ–‡ä»¶"><a href="#more-file-ï¼šå¯ç¿»é¡µåœ°æµè§ˆæ–‡ä»¶" class="headerlink" title="more [file]ï¼šå¯ç¿»é¡µåœ°æµè§ˆæ–‡ä»¶"></a><code>more [file]</code>ï¼šå¯ç¿»é¡µåœ°æµè§ˆæ–‡ä»¶</h3><p>åœ¨moreä¸­é”®å…¥ï¼š</p><ul><li><p><code>&#123;ç©ºæ ¼&#125;</code>ï¼šä¸‹ä¸€é¡µ</p></li><li><p><code>&#123;Enter&#125;</code>ï¼šç§»åŠ¨ä¸€è¡Œ</p></li><li><p><code>&#123;b&#125;</code>ï¼šä¸Šä¸€é¡µ</p></li><li><p><code>&#123;h&#125;</code>ï¼šå¸®åŠ©</p></li><li><p><code>&#123;/str&#125;</code>ï¼šå‘å‰æœç´¢str</p></li><li><p><code>&#123;n&#125;</code>ï¼šå‘ç°è¿™ä¸ªå­—ç¬¦ä¸²çš„ä¸‹ä¸€æ¬¡å‡ºç°</p></li><li><p><code>&#123;q&#125;</code>ï¼šé€€å‡º more</p></li><li><p><code>&#123;v&#125;</code>ï¼šåœ¨å½“å‰è¡Œå¯åŠ¨ vi</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-3.1.3-æ–‡ä»¶å½’æ¡£ä¸å‹ç¼©</title>
      <link href="/2016/12/30/Linux/linux-3-1-3-Archiving/"/>
      <url>/2016/12/30/Linux/linux-3-1-3-Archiving/</url>
      
        <content type="html"><![CDATA[<h1 id="æ–‡ä»¶å½’æ¡£ä¸å‹ç¼©"><a href="#æ–‡ä»¶å½’æ¡£ä¸å‹ç¼©" class="headerlink" title="æ–‡ä»¶å½’æ¡£ä¸å‹ç¼©"></a>æ–‡ä»¶å½’æ¡£ä¸å‹ç¼©</h1><h2 id="å½’æ¡£"><a href="#å½’æ¡£" class="headerlink" title="å½’æ¡£"></a>å½’æ¡£</h2><p>å½’æ¡£ï¼ˆarchivingï¼‰å°±æ˜¯å°†è®¸å¤šæ–‡ä»¶ï¼ˆæˆ–ç›®å½•ï¼‰æ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶ã€‚</p><p>å½’æ¡£çš„ç›®çš„å°±æ˜¯æ–¹ä¾¿å¤‡ä»½ã€è¿˜åŸåŠæ–‡ä»¶çš„ä¼ è¾“æ“ä½œã€‚</p><p>Linuxæ“ä½œç³»ç»Ÿçš„æ ‡å‡†å½’æ¡£å‘½ä»¤æ˜¯tarï¼ˆtape archiveï¼‰ã€‚</p><p>tarå‘½ä»¤çš„åŠŸèƒ½æ˜¯å°†å¤šä¸ªæ–‡ä»¶ï¼ˆä¹Ÿå¯æœ‰ç›®å½•ï¼‰æ”¾åœ¨ä¸€èµ·å­˜æ”¾åˆ°ä¸€ä¸ªç£å¸¦æˆ–ç£ç›˜å½’æ¡£æ–‡ä»¶ä¸­ï¼Œ</p><p>å¹¶ä¸”å°†æ¥å¯ä»¥æ ¹æ®éœ€è¦åªè¿˜åŸå½’æ¡£æ–‡ä»¶ä¸­çš„æŸäº›æŒ‡å®šçš„æ–‡ä»¶ã€‚</p><p>tarå‘½ä»¤é»˜è®¤å¹¶ä¸è¿›è¡Œæ–‡ä»¶çš„å‹ç¼©ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">tar [é€‰é¡¹]... [å½’æ¡£æ–‡ä»¶å]...</span><br><span class="line">    å¿…é¡»è‡³å°‘ä½¿ç”¨å¦‚ä¸‹é€‰é¡¹ä¸­çš„ä¸€ä¸ªï¼š</span><br><span class="line">        cï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„taræ–‡ä»¶ã€‚</span><br><span class="line">        tï¼šåˆ—å‡ºtaræ–‡ä»¶ä¸­å†…å®¹çš„ç›®å½•ã€‚</span><br><span class="line">        xï¼šä»taræ–‡ä»¶ä¸­æŠ½å–æ–‡ä»¶ã€‚</span><br><span class="line">        fï¼šæŒ‡å®šå½’æ¡£æ–‡ä»¶æˆ–ç£å¸¦ï¼ˆä¹Ÿå¯èƒ½æ˜¯è½¯ç›˜ï¼‰è®¾å¤‡ï¼ˆä¸€èˆ¬éƒ½è¦é€‰ï¼‰</span><br><span class="line">            ï¼ˆåœ¨RHEL 4ä¹‹å‰çš„ç‰ˆæœ¬ä¸­è§„å®šåœ¨fé€‰é¡¹ä¹‹åå¿…é¡»ç´§è·Ÿç€æ–‡ä»¶åè€Œä¸èƒ½å†åŠ å…¶ä»–å‚æ•°ï¼Œ</span><br><span class="line">                ä½†æ˜¯ä»RHEL 4å¼€å§‹å·²ç»å–æ¶ˆäº†è¿™ä¸€é™åˆ¶ã€‚ï¼‰</span><br><span class="line">ä»¥ä¸‹ä¸ºå¯é€‰çš„é€‰é¡¹ï¼š</span><br><span class="line">        vï¼šæ˜¾ç¤ºæ‰€æ‰“åŒ…çš„æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼ˆvæ˜¯verboseï¼‰</span><br><span class="line">                (æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šæ˜¾ç¤ºæ‰€æœ‰æ‰“åŒ…çš„æ–‡ä»¶å’Œç›®å½•)</span><br><span class="line">        zï¼šä½¿ç”¨gzipå‹ç¼©ç®—æ³•æ¥å‹ç¼©æ‰“åŒ…åçš„æ–‡ä»¶ã€‚</span><br><span class="line">                ã€Œ$ tar cvfz arch.tar.gz dir2archã€</span><br><span class="line">        jï¼šä½¿ç”¨bzip2å‹ç¼©ç®—æ³•æ¥å‹ç¼©æ‰“åŒ…åçš„æ–‡ä»¶ã€‚</span><br><span class="line">                ã€Œ$ tar cvfj arch.tar.bz2 dirarchã€</span><br><span class="line">ã€æ³¨æ„ã€‘åœ¨tarå‘½ä»¤ä¸­ï¼Œæ‰€æœ‰çš„é€‰é¡¹ä¹‹å‰éƒ½ä¸èƒ½ä½¿ç”¨å‰å¯¼çš„â€œ-â€ã€‚</span><br></pre></td></tr></table></figure><p>åˆ›å»ºæ–°çš„å½’æ¡£æ–‡ä»¶ï¼š<code>c\[v\]f</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ tar  cvf  arch.tar  dir2arch    # File to be archived should be a RELATIVE path</span><br><span class="line">dir2arch&#x2F;</span><br><span class="line">dir2arch&#x2F;learning.txt</span><br><span class="line">dir2arch&#x2F;name.txt</span><br><span class="line">â€¦â€¦</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹å½’æ¡£æ–‡ä»¶å†…å®¹ï¼š<code>t\[v\]f</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ tar tf arch.tar</span><br><span class="line">dir2arch&#x2F;</span><br><span class="line">dir2arch&#x2F;learning.txt</span><br><span class="line">dir2arch&#x2F;name.txt </span><br><span class="line">â€¦â€¦</span><br><span class="line"># å¯ä»¥åœ¨tarå‘½ä»¤ä¸­å†åŠ å…¥vå‘½ä»¤æ¥æ˜¾ç¤ºæ–‡ä»¶æ›´åŠ è¯¦ç»†çš„ä¿¡æ¯(like ã€Œls -lã€):</span><br><span class="line">$ tar tvf arch.tar</span><br><span class="line">drwxrwxr-x User&#x2F;User           0 2010-02-04 05:09:43 dir2arch&#x2F;</span><br><span class="line">-rw-r--r--   User&#x2F;User        4720 2010-02-04 05:07:22 dir2arch&#x2F;learning.txt</span><br><span class="line">-rw-rw-r--   User&#x2F;User          84 2010-02-04 05:07:22 dir2arch&#x2F;name.txt </span><br><span class="line">â€¦â€¦</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è§£å¼€æ‰“åŒ…å¥½çš„æ–‡ä»¶ï¼š<code>x\[v\]f</code></p><p>[âš ï¸]<span style="color: #fd0404;">è§£å¼€å‰è¦å°†å·¥ä½œç›®å½•åˆ‡æ¢åˆ°æ‰“åŒ…æ—¶æ‰€åœ¨çš„ç›®å½•ï¼Œæ‰èƒ½ä¿è¯æŠ½å–çš„æ–‡ä»¶æ”¾å›åˆ°åŸæ¥çš„ä½ç½®ã€‚</span></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ tar xvf arch.tar</span><br><span class="line">dir2arch&#x2F;</span><br><span class="line">dir2arch&#x2F;learning.txt</span><br><span class="line">dir2arch&#x2F;name.txt</span><br><span class="line">dir2arch&#x2F;flowers.JPG</span><br><span class="line">dir2arch&#x2F;dog.JPG  â€¦â€¦</span><br></pre></td></tr></table></figure><h2 id="å‹ç¼©"><a href="#å‹ç¼©" class="headerlink" title="å‹ç¼©"></a>å‹ç¼©</h2><p>è¿›è¡Œæ–‡ä»¶å‹ç¼©çš„ä¸»è¦ç›®çš„æ˜¯ç¼©å°æ–‡ä»¶çš„å¤§å°ã€‚</p><p>ä¸€èˆ¬å¯¹æ­£æ–‡æ–‡ä»¶è¿›è¡Œå‹ç¼©ä¹‹åï¼Œæ–‡ä»¶çš„å¤§å°å¯ä»¥è¢«å‹ç¼©å¤§çº¦75%ã€‚</p><p>ä½†æ˜¯äºŒè¿›åˆ¶çš„æ–‡ä»¶ï¼Œå¦‚å›¾åƒæ–‡ä»¶é€šå¸¸ä¸ä¼šè¢«å‹ç¼©å¤šå°‘ã€‚</p><p>Linuxç³»ç»Ÿä¸­ä¸¤ç»„å¸¸ç”¨çš„å‹ç¼©å·¥å…·ï¼š</p><ol><li><code>gzip \ gunzip -&gt; [*.gz]</code></li></ol><p>[âš ï¸]<span style="color: #fcb100;">ç”¨gzipä¸èƒ½å‹ç¼©<strong>ç›®å½•</strong></span></p><p>ç”¨gzipæ¥å‹ç¼©æ–‡ä»¶ï¼Œå°±å¿…é¡»ä½¿ç”¨gunzipæ¥è§£å‹ç¼©ã€‚</p><p>å®ƒä»¬æ˜¯Linuxç³»ç»Ÿä¸Šæ ‡å‡†çš„å‹ç¼©å’Œè§£å‹ç¼©å·¥å…·ï¼Œ</p><p><em>gzipå¯¹æ­£æ–‡æ–‡ä»¶çš„å‹ç¼©æ¯”ä¸€èˆ¬è¶…è¿‡75%</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gzip [é€‰é¡¹] [å‹ç¼©æ–‡ä»¶åâ€¦]</span><br><span class="line">        è‹¥ä¸ç”¨-cåˆ™ä¼šå‹ç¼©æºæ–‡ä»¶ï¼ˆæŠŠåŸæ¥å¤šfoo.txtå˜æˆä¸€ä¸ªfoo.txt.gzï¼‰</span><br><span class="line">        -vï¼šåœ¨å±å¹•ä¸Šæ˜¾ç¤ºå‡ºæ–‡ä»¶çš„å‹ç¼©æ¯”ï¼ˆvæ˜¯verboseçš„ç¬¬1ä¸ªå­—æ¯ï¼‰ã€‚</span><br><span class="line">        -cï¼šä¿ç•™åŸæ¥çš„æ–‡ä»¶ï¼Œè€Œæ–°åˆ›å»ºä¸€ä¸ªå‹ç¼©æ–‡ä»¶(è¦é‡å®šå‘å‡ºæ¥)ï¼Œå…¶ä¸­å‹ç¼©æ–‡ä»¶åä»¥.gzç»“å°¾ã€‚</span><br><span class="line">                ï¼ˆgzip -vc bar.txt &gt; foobar.gzï¼‰</span><br><span class="line">è§£å‹ç¼©æ—¶ï¼Œè¾“å…¥gunzipç©ºæ ¼åè·Ÿè¦è§£å‹ç¼©çš„æ–‡ä»¶ï¼Œå¦‚å‘½ä»¤gunzip arch.gzã€‚</span><br></pre></td></tr></table></figure><ol start="2"><li><code>bzip2 \ bunzip2 -&gt;[*.bz2]</code></li></ol><p>ç”¨bzip2å‹ç¼©ï¼Œå¿…é¡»ç”¨bunzip2è§£å‹ã€‚</p><p>å®ƒä»¬æ˜¯Linuxç³»ç»Ÿä¸Šæ¯”è¾ƒæ–°çš„å‹ç¼©å’Œè§£å‹ç¼©å·¥å…·ï¼Œ</p><p>é€šå¸¸bzip2å¯¹å½’æ¡£æ–‡ä»¶çš„å‹ç¼©æ¯”è¦ä¼˜äºgzipå·¥å…·ã€‚</p><p>æ¯”è¾ƒæ–°çš„Linuxç‰ˆæœ¬æ‰æ”¯æŒbzip2å’Œbunzip2å‘½ä»¤ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-3.1.2-ç£ç›˜ï¼Œå¯ç§»é™¤å¼åª’ä½“</title>
      <link href="/2016/12/29/Linux/linux-3-1-2-Disk-RemovableMedia/"/>
      <url>/2016/12/29/Linux/linux-3-1-2-Disk-RemovableMedia/</url>
      
        <content type="html"><![CDATA[<h1 id="ç£ç›˜ï¼Œå¯ç§»é™¤å¼åª’ä½“"><a href="#ç£ç›˜ï¼Œå¯ç§»é™¤å¼åª’ä½“" class="headerlink" title="ç£ç›˜ï¼Œå¯ç§»é™¤å¼åª’ä½“"></a>ç£ç›˜ï¼Œå¯ç§»é™¤å¼åª’ä½“</h1><ul><li><strong>æ£€æŸ¥ç£ç›˜ç©ºé—´</strong></li></ul><p>ç›‘ç£æ–‡ä»¶ç³»ç»Ÿçš„ä½¿ç”¨æƒ…å†µï¼Œå¯ä½¿ç”¨å¦‚ä¸‹ä¸¤ä¸ªå‘½ä»¤ï¼š</p><ul><li>dfï¼šæ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿä¸­ç£ç›˜ä½¿ç”¨å’Œç©ºé—²åŒºçš„æ•°é‡</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ df [é€‰é¡¹] [dir|file|è®¾å¤‡]</span><br><span class="line">    æ— [dir|file]ï¼šä»¥KBä¸ºå•ä½åˆ—å‡ºæ¯ä¸ª(Every)æ–‡ä»¶ç³»ç»Ÿä¸­ æ‰€æœ‰çš„ç©ºé—´ï¼Œå·²ç”¨ç©ºé—´ï¼Œç©ºé—²ç©ºé—´</span><br><span class="line">    åŠ ä¸Š dir|fileï¼šæ˜¾ç¤ºè¯¥æ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶ç³»ç»Ÿçš„æƒ…å†µ</span><br><span class="line">    åŠ ä¸Š è®¾å¤‡(å¦‚ &#x2F;dev&#x2F;sda1)ï¼šæ˜¾ç¤ºè¯¥è®¾å¤‡çš„æ–‡ä»¶ç³»ç»Ÿçš„æƒ…å†µ</span><br><span class="line">    é€‰é¡¹ï¼š</span><br><span class="line">        -hæˆ–-H ï¼šä»¥äººç±»å®¹æ˜“ç†è§£çš„æ–¹å¼è¡¨ç¤º</span><br><span class="line">        -iï¼šåˆ—å‡ºinodeçš„ä½¿ç”¨æƒ…å†µ</span><br></pre></td></tr></table></figure><ul><li>duï¼šæ˜¾ç¤ºç£ç›˜ä½¿ç”¨çš„æ€»é‡ï¼ˆxxç›®å½•ï¼Œæœ‰å¤šå¤§ï¼‰</li></ul><p>duå‘½ä»¤<u>ä»¥KBä¸ºå•ä½</u>ğŸ±æ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿç£ç›˜ç©ºé—´ä½¿ç”¨çš„æ€»é‡ï¼Œå¹¶å°†é€’å½’åœ°æ˜¾ç¤ºæ‰€æœ‰å­ç›®å½•çš„ç£ç›˜ç©ºé—´ä½¿ç”¨é‡ã€‚</p><p>å¦‚æœåœ¨è¿™ä¸ªå‘½ä»¤ä¸­ä½¿ç”¨-sé€‰é¡¹ï¼Œå‘½ä»¤çš„ç»“æœå°±åªæ˜¾ç¤ºä¸€ä¸ªç›®å½•æ€»çš„ç£ç›˜ç©ºé—´ä½¿ç”¨é‡ã€‚</p><p>åœ¨duå‘½ä»¤ä¸­ä¹ŸåŒæ ·å¯ä»¥åŠ ä¸Š-hæˆ–-Hé€‰é¡¹ã€‚</p><p>ğŸ±. éƒ¨åˆ†UNIXä¸Šï¼ˆå¦‚Solarisä¸Šï¼‰ï¼Œduçš„å•ä½æ˜¯ <em>512B</em> çš„æ•°æ®å—æ•°ã€‚</p><ul><li><strong>å¯ç§»é™¤å¼åª’ä½“</strong></li></ul><p><strong><em>Removable Media</em></strong>ï¼ˆä¸€ç§ç¿»è¯‘ä¸º  å¯ç§»é™¤å¼åª’ä½“ï¼‰ï¼šæŒ‡USBé—ªå­˜ã€è½¯ç›˜ã€CDã€DVDç­‰ä»‹è´¨ã€‚</p><p><em>Removable Media</em> çš„<strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li><p>åœ¨è®¿é—®ä¹‹å‰ï¼Œå¿…é¡»å°†è¿™ä¸ªRemovable MediaæŒ‚è½½ï¼ˆmountï¼‰åˆ°ç³»ç»Ÿä¸Šã€‚</p></li><li><p>åœ¨ç§»é™¤ä¹‹å‰ï¼Œå¿…é¡»å°†è¿™ä¸ªRemovable Mediaä»ç³»ç»Ÿä¸Šå¸è½½æ‰ã€‚</p></li><li><p>åœ¨é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œä¸€èˆ¬érootçš„æ™®é€šç”¨æˆ·åªèƒ½æŒ‚è½½æŸäº›ç‰¹å®šçš„è®¾å¤‡ï¼ˆå¦‚USBé—ªå­˜ã€è½¯ç›˜ã€CDã€DVDç­‰ï¼‰ã€‚</p></li><li><p>é»˜è®¤çš„æŒ‚è½½ç‚¹ä¸€èˆ¬æ˜¯æ ¹ç›®å½•ä¸‹çš„mediaï¼Œå³/mediaã€‚</p></li></ul><p><strong>MOUNT</strong> Removable Mediaï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mount</span><br><span class="line">    åˆ—å‡ºå½“å‰ç³»ç»Ÿä¸­æŒ‚è½½çš„æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿ</span><br></pre></td></tr></table></figure><ul><li>Mount <strong>CD/DVD:</strong>  </li></ul><p>åœ¨gnomeæˆ–KDEçš„ä¸­ï¼Œåªè¦åœ¨å…‰é©±ä¸­æ”¾å…¥CDæˆ–DVDï¼Œå°±ä¼šè¢«è‡ªåŠ¨åœ°æŒ‚è½½åˆ°ç³»ç»Ÿä¸­æ¥ã€‚</p><p>å¦‚æœæ²¡æœ‰è¢«è‡ªåŠ¨åœ°æŒ‚è½½åˆ°ç³»ç»Ÿä¸­æ¥ï¼Œå°±å¿…é¡»æ‰‹åŠ¨åœ°æŒ‚è½½CD/DVDã€‚</p><p>å¦‚æœæ˜¯CD/DVD Readerï¼Œå°†ä½¿ç”¨ <code>mount  ...  /media/cdrom</code> å‘½ä»¤å°†CD/DVDæŒ‚è½½åˆ° <code>/media/cdrom</code> ä¹‹ä¸‹ã€‚</p><p>å¦‚æœæ˜¯CD/DVD Writerï¼Œå°†ä½¿ç”¨ <code>mount ... /media/cdrecorder</code> å‘½ä»¤å°†CD/DVDæŒ‚è½½åˆ° <code>/media/cdrecorder</code> ä¹‹ä¸‹ã€‚</p><p>å¯ä»¥ä½¿ç”¨ejectå‘½ä»¤é€€å‡ºï¼ˆumountï¼‰CD/DVDã€‚</p><p>[âš ï¸]<span style="color: #fcb100;">å½“å®‰è£…æœ‰<strong>å¤šä¸ªå…‰ç›˜</strong>è½¯ä»¶æ—¶ï¼Œåƒä¸‡<strong>ä¸è¦å°†å·¥ä½œç›®å½•è®¾ä¸ºCDæ‰€åœ¨çš„ç›®å½•</strong>ï¼Œè¿™æ ·å°†æ— æ³•æ›´æ¢å…‰ç›˜ï¼Œå› ä¸ºæ‰§è¡Œejectæˆ–umountå‘½ä»¤æ—¶ç³»ç»Ÿè¦æ±‚CDç›®å½•ä¸­æ²¡æœ‰ä»»ä½•æ“ä½œã€‚</span></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">æŒ‚è½½CDï¼DVDï¼š</span><br><span class="line"># mount  &#x2F;dev&#x2F;hdc  &#x2F;media&#x2F;cdrom        # Only root can do that</span><br><span class="line">Read itï¼š</span><br><span class="line">$ ls -l &#x2F;media&#x2F;cdrom</span><br><span class="line">Umount itï¼š</span><br><span class="line"># eject &#x2F;media&#x2F;cdrom</span><br></pre></td></tr></table></figure><ul><li>Mount <strong>USBé—ªå­˜ï¼š</strong>  </li></ul><p>å°†USBé—ªå­˜æ’å…¥è®¡ç®—æœºï¼ŒLinuxå†…æ ¸ä¼šè‡ªåŠ¨æ¢æµ‹åˆ°è¿™ä¸€è®¾å¤‡ï¼Œå¹¶å°†å…¶è‡ªåŠ¨å®‰è£…ä¸ºSCSIè®¾å¤‡ã€‚</p><p>é€šå¸¸å®ƒä¼šè¢«æŒ‚è½½åœ¨<code>/media/&lt;Device ID&gt;</code>ã€‚</p><p>æ‰‹åŠ¨æŒ‚è½½ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># mount &#x2F;media&#x2F;KINGSTON</span><br><span class="line">æˆ–</span><br><span class="line"># mount  &#x2F;dev&#x2F;sdb1  &#x2F;media&#x2F;KINGSTON</span><br></pre></td></tr></table></figure><p>åªæœ‰rootå¯ä»¥ umount USB é—ªå­˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-3.1.1-è¿æ¥(link)</title>
      <link href="/2016/12/28/Linux/linux-3-1-1-Link/"/>
      <url>/2016/12/28/Linux/linux-3-1-1-Link/</url>
      
        <content type="html"><![CDATA[<h1 id="è¿æ¥-link"><a href="#è¿æ¥-link" class="headerlink" title="è¿æ¥(link)"></a>è¿æ¥(link)</h1><ol><li><strong>ç¬¦å·è¿æ¥ï¼ˆè½¯è¿æ¥ï¼‰</strong>ï¼šæŒ‡å‘å¦ä¸€ä¸ªæ–‡ä»¶çš„æ–‡ä»¶</li></ol><p>ç¬¦å·è¿æ¥ä¹Ÿåªèƒ½åŒ…å«ä¸€ç§ç±»å‹çš„æ•°æ®ï¼›</p><p>ä¸€ä¸ªç¬¦å·è¿æ¥åŒ…å«äº†å®ƒæ‰€æŒ‡å‘çš„æ–‡ä»¶çš„è·¯å¾„ï¼›</p><p>å› ä¸ºç¬¦å·è¿æ¥ä½¿ç”¨çš„æ˜¯æŒ‡å‘å…¶ä»–æ–‡ä»¶çš„è·¯å¾„åï¼Œ</p><p>æ‰€ä»¥ç¬¦å·è¿æ¥å¯ä»¥æŒ‡å‘å…¶ä»–æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ã€‚</p><p>Âºã€‚æŸ¥çœ‹ç¬¦å·è¿æ¥ï¼šä½¿ç”¨ <code>ls -l</code>ï¼š</p><pre><code>    æ–‡ä»¶ç±»å‹ç å¦‚æœæ˜¯â€œlâ€è¡¨ç¤ºæ˜¯ä¸€ä¸ªè¿æ¥ã€‚</code></pre><p>å¦å¤–åœ¨æ˜¾ç¤ºç»“æœçš„æœ€åä¸€åˆ—ä¸­ï¼Œ</p><p>åœ¨-&gt;å·¦è¾¹çš„æ˜¯ç¬¦å·è¿æ¥åï¼Œ</p><p>åœ¨-&gt;å³è¾¹çš„æ˜¯æ‰€æŒ‡å‘å¯¹è±¡çš„å®Œæ•´è·¯å¾„ï¼Œ</p><p>æ˜¾ç¤ºç»“æœä¸­çš„å¤§å°ä¸ºè¿™ä¸ªå®Œæ•´è·¯å¾„çš„å­—ç¬¦ä¸ªæ•°ã€‚  </p><p>Âºã€‚åˆ›å»ºè½¯è¿æ¥ï¼š  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ln  -s  abs_path&#x2F;æ–‡ä»¶å  abs_path&#x2F;[è¿æ¥å]</span><br><span class="line">    [âš ï¸]å¯ä»¥å¯¹ç›®å½•å»ºç«‹è½¯è¿æ¥</span><br><span class="line">    æ–‡ä»¶åï¼šè¿æ¥æŒ‡å‘çš„æ–‡ä»¶</span><br><span class="line">    è¿æ¥åï¼šæ–°å»ºçš„link fileçš„åå­—</span><br><span class="line">            ç¼ºçœä¸ºä¸æŒ‡å‘æ–‡ä»¶åŒå</span><br><span class="line">    [âš ï¸]æ³¨æ„ä¸¤æ–‡ä»¶çš„pathéƒ½è¦å†™ç»å¯¹è·¯å¾„</span><br><span class="line">            è‹¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„ä¼šå‡ºç°è½¯è¿æ¥æ–­å¼€çš„é—®é¢˜ï¼š</span><br><span class="line">                ä½¿ç”¨è¿æ¥æ—¶ä¼šæŠ¥é”™ï¼š</span><br><span class="line">                    Too many levels of symbolic links.</span><br><span class="line">                å¯å¯¹link fileä½¿ç”¨fileå‘½ä»¤å‘ç°é”™è¯¯ï¼š</span><br><span class="line">                    $ file link_file</span><br><span class="line">                    abs_path&#x2F;link_file:broken symbolic links to &#39;pointing file&#39;</span><br></pre></td></tr></table></figure><p>Âºã€‚è½¯è¿æ¥çš„ä½¿ç”¨ï¼š</p><p>å¯¹ link_file rwx == å¯¹ pointing_file rwx</p><p>Âºã€‚è½¯è¿æ¥çš„å·¥ä½œåŸç†</p><p>ï¼*ç¬¦å·è¿æ¥ä¹Ÿè¦å ç”¨ä¸€ä¸ªièŠ‚ç‚¹ï¼Œå³è½¯è¿æ¥æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæ–‡ä»¶*ï¼</p><p>ä½¿ç”¨symbolic linkï¼š</p><p>ï¼ˆ1ï¼‰é¦–å…ˆç³»ç»Ÿåˆ©ç”¨_ç¬¦å·è¿æ¥å_æŸ¥æ‰¾åˆ°è¿™ä¸ªè½¯è¿æ¥æ‰€å¯¹åº”çš„ièŠ‚ç‚¹ã€‚</p><p>ï¼ˆ2ï¼‰é€šè¿‡ièŠ‚ç‚¹ä¸­çš„æŒ‡é’ˆæŸ¥æ‰¾åˆ°_link file_çš„æ•°æ®å—ï¼ˆå…¶ä¸­ï¼Œå­˜æ”¾ç€æ‰€_æŒ‡å‘æ–‡ä»¶_çš„å…¨è·¯å¾„å’Œå¯¹åº”çš„ièŠ‚ç‚¹å·ï¼‰ã€‚</p><p>ï¼ˆ3ï¼‰åˆ©ç”¨_link file_æ•°æ®å—ä¸­çš„æ•°æ®æŸ¥æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶æ‰€å¯¹åº”çš„ièŠ‚ç‚¹å·ã€‚</p><p>ï¼ˆ4ï¼‰é€šè¿‡ièŠ‚ç‚¹ä¸­çš„æŒ‡é’ˆæŸ¥æ‰¾åˆ°_pointing file_å¯¹åº”çš„æ•°æ®å—ã€‚</p><p>ï¼ˆ5ï¼‰å¯¹_pointing file_çš„æ•°æ®å—ä¸­çš„æ•°æ®è¿›è¡Œæ“ä½œã€‚</p><ol start="2"><li><strong>ç¡¬è¿æ¥ï¼š</strong>æŠŠæ–‡ä»¶åå¯¹åº”åˆ°inode</li></ol><p>ä¸€ä¸ªç¡¬è¿æ¥ï¼ˆHard Linkï¼‰æ˜¯ä¸€ä¸ªæ–‡ä»¶åä¸ä¸€ä¸ªièŠ‚ç‚¹ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚</p><p>æ·»åŠ ä¸€ä¸ªç¡¬è¿æ¥æ˜¯åœ¨æ‰€å¯¹åº”çš„æ–‡ä»¶ä¸Šæ·»åŠ ä¸€ä¸ªè·¯å¾„åã€‚</p><p>æ¯ä¸€ä¸ªæ–‡ä»¶éƒ½è‡³å°‘ä½¿ç”¨ä¸€ä¸ªç¡¬è¿æ¥ï¼Œ</p><p>åœ¨ä¸€ä¸ªç›®å½•ä¸­çš„æ¯ä¸€ä¸ªè®°å½•éƒ½æ„æˆäº†ä¸€ä¸ªç¡¬è¿æ¥ã€‚</p><p>å¯ä»¥å°†æ¯ä¸€ä¸ªæ–‡ä»¶åéƒ½çœ‹æˆä¸ºå¯¹åº”äºä¸€ä¸ªièŠ‚ç‚¹çš„ç¡¬è¿æ¥ã€‚  </p><p>ä¸ºæ–‡ä»¶æ·»åŠ é¢å¤–çš„hard linkå¯ä»¥é¿å…ä¸€äº›é‡è¦çš„ä¿¡æ¯è¢«è¯¯åˆ ï¼Œå› ä¸ºå½“å­˜å‚¨ä¿¡æ¯çš„æ–‡ä»¶è¢«åˆ é™¤åï¼Œè¿˜å¯ä»¥é€šè¿‡ç¡¬è¿æ¥è®¿é—®å¯¹åº”çš„ièŠ‚ç‚¹å¹¶æ‰¾åˆ°å­˜å‚¨ä¿¡æ¯çš„æ•°æ®å—ã€‚  </p><p>è‹¥å°†åä¸ºfooå’Œbarçš„ä¸¤ä¸ªæ–‡ä»¶å¯¹åº”åˆ°ä¸€ä¸ªièŠ‚ç‚¹ä¸Šï¼š</p><p>fooã€barä½¿ç”¨ç›¸åŒçš„ièŠ‚ç‚¹è®°å½•ã€‚</p><pre><code>    å°†æ–‡ä»¶fooè¯¯åˆ ï¼Œè¿˜å¯ä»¥é€šè¿‡æ–‡ä»¶baræŠŠä¿¡æ¯æ‰¾å›æ¥ã€‚</code></pre><p>Âºã€‚åˆ›å»ºhard link</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln æ–‡ä»¶å [è¿æ¥å]</span><br><span class="line">    [âš ï¸]åªèƒ½å¯¹æ–‡ä»¶å»ºç«‹ç¡¬è¿æ¥ï¼Œè€Œä¸èƒ½å¯¹ä¸€ä¸ªç›®å½•å»ºç«‹ç¡¬è¿æ¥ã€‚</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-3.1.0-æ–‡ä»¶ç³»ç»Ÿä¸inode</title>
      <link href="/2016/12/27/Linux/linux-3-1-0-FileSystem-inode/"/>
      <url>/2016/12/27/Linux/linux-3-1-0-FileSystem-inode/</url>
      
        <content type="html"><![CDATA[<h1 id="Linuxæ–‡ä»¶ç³»ç»Ÿä¸inode"><a href="#Linuxæ–‡ä»¶ç³»ç»Ÿä¸inode" class="headerlink" title="Linuxæ–‡ä»¶ç³»ç»Ÿä¸inode"></a>Linuxæ–‡ä»¶ç³»ç»Ÿä¸inode</h1><h2 id="ç¡¬ç›˜åˆ†åŒºå’Œæ–‡ä»¶ç³»ç»Ÿ"><a href="#ç¡¬ç›˜åˆ†åŒºå’Œæ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="ç¡¬ç›˜åˆ†åŒºå’Œæ–‡ä»¶ç³»ç»Ÿ"></a>ç¡¬ç›˜åˆ†åŒºå’Œæ–‡ä»¶ç³»ç»Ÿ</h2><p>ä¸€ä¸ªæ–°çš„ç¡¬ç›˜ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ã€‚é¦–å…ˆå¿…é¡»æŠŠè¿™ä¸ªç¡¬ç›˜åˆ’åˆ†æˆæ•°ä¸ªï¼ˆä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªï¼‰<span style="background-color: rgb(255, 250, 165);">åˆ†åŒº</span>ï¼Œä¹‹åå†æŠŠæ¯ä¸€ä¸ªåˆ†åŒº<span style="background-color: rgb(255, 250, 165);">æ ¼å¼åŒ–</span>ä¸ºæ–‡ä»¶ç³»ç»Ÿï¼Œç„¶åLinuxç³»ç»Ÿæ‰èƒ½åœ¨æ ¼å¼åŒ–åçš„ç¡¬ç›˜åˆ†åŒºä¸Šå­˜å‚¨æ•°æ®å’Œè¿›è¡Œç›¸åº”çš„æ–‡ä»¶ç®¡ç†åŠç»´æŠ¤ã€‚</p><p>Linuxæˆ–UNIXç³»ç»Ÿä¸Šçš„ç£ç›˜åˆ†åŒºå°±ç›¸å½“äºWindowsç³»ç»Ÿä¸Šçš„é€»è¾‘ç›˜ã€‚</p><p>æŠŠä¸€ä¸ªåˆ†åŒºæ ¼å¼åŒ–ä¸ºæ–‡ä»¶ç³»ç»Ÿå°±æ˜¯å°†è¿™ä¸ªåˆ†åŒºåˆ’åˆ†æˆè®¸å¤šå¤§å°ç›¸ç­‰çš„å°å•å…ƒï¼Œ</p><p>å¹¶å°†è¿™äº›å°å•å…ƒé¡ºåºåœ°ç¼–å·ã€‚</p><p>è¿™äº›å°å•å…ƒè¢«ç§°ä¸ºå—ï¼ˆblockï¼‰ï¼ŒLinuxé»˜è®¤çš„blockå¤§å°ä¸º4KBã€‚</p><p>Blockæ˜¯å­˜å‚¨æ•°æ®çš„æœ€å°å•ä½ï¼Œ</p><p>æ¯ä¸ªblockæœ€å¤šåªèƒ½å­˜å‚¨ä¸€ä¸ªæ–‡ä»¶ï¼Œ</p><p>å¦‚æœä¸€ä¸ªæ–‡ä»¶çš„å¤§å°è¶…è¿‡4KBï¼Œé‚£ä¹ˆå°±ä¼šå ç”¨å¤šä¸ªblocksã€‚</p><h2 id="inode"><a href="#inode" class="headerlink" title="inode"></a>inode</h2><h3 id="inode-æ¦‚å¿µ"><a href="#inode-æ¦‚å¿µ" class="headerlink" title="inode æ¦‚å¿µ"></a>inode æ¦‚å¿µ</h3><p>ièŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªä¸æŸä¸ªç‰¹å®šçš„å¯¹è±¡ï¼ˆå¦‚æ–‡ä»¶æˆ–ç›®å½•ï¼‰ç›¸å…³çš„ä¿¡æ¯åˆ—è¡¨ã€‚</p><p>ièŠ‚ç‚¹å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œå®ƒå­˜æ”¾äº†æœ‰å…³ä¸€ä¸ªæ™®é€šæ–‡ä»¶ã€ç›®å½•æˆ–å…¶ä»–æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡çš„åŸºæœ¬ä¿¡æ¯ã€‚</p><p>å½“ä¸€ä¸ªç£ç›˜è¢«æ ¼å¼åŒ–æˆæ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ext2æˆ–ext3ï¼‰æ—¶ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªièŠ‚ç‚¹ï¼ˆinodeï¼‰è¡¨ï¼›</p><p>åœ¨è¯¥è¡¨ä¸­åŒ…å«äº†æ‰€æœ‰æ–‡ä»¶çš„å…ƒæ•°æ®ï¼ˆmetadataï¼Œæè¿°æ•°æ®çš„æ•°æ®ï¼‰ï¼Œæ¯ä¸€ä¸ªæ–‡ä»¶å’Œç›®å½•éƒ½ä¼šå¯¹åº”äºä¸€ä¸ªå”¯ä¸€çš„ièŠ‚ç‚¹ï¼Œè€Œè¿™ä¸ªièŠ‚ç‚¹æ˜¯ä½¿ç”¨ä¸€ä¸ªièŠ‚ç‚¹å·ï¼ˆinode numberç®€å†™æˆinode-noï¼‰æ¥æ ‡è¯†çš„ï¼›</p><p>inodesçš„æ•°é‡å†³å®šäº†åœ¨è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸­æœ€å¤šå¯ä»¥å­˜å‚¨å¤šå°‘ä¸ªæ–‡ä»¶ï¼Œåœ¨ä¸€ä¸ªåˆ†åŒºï¼ˆpartitionï¼‰ä¸­æœ‰å¤šå°‘ä¸ªièŠ‚ç‚¹å°±åªèƒ½å¤Ÿå­˜å‚¨å¤šå°‘ä¸ªæ–‡ä»¶å’Œç›®å½•ã€‚</p><p>åœ¨å¤šæ•°ç±»å‹çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼ŒièŠ‚ç‚¹çš„æ•°ç›®æ˜¯å›ºå®šçš„ï¼Œå¹¶ä¸”æ˜¯åœ¨åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿæ—¶ç”Ÿæˆçš„ã€‚</p><p>åœ¨ä¸€ä¸ªå…¸å‹çš„UNIXæˆ–Linuxæ–‡ä»¶ç³»ç»Ÿä¸­ï¼ŒièŠ‚ç‚¹æ‰€å ç”¨çš„ç©ºé—´å¤§çº¦æ˜¯æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿå¤§å°çš„1%ã€‚</p><hr><h3 id="inode-è§£è¯»"><a href="#inode-è§£è¯»" class="headerlink" title="inode è§£è¯»"></a>inode è§£è¯»</h3><p>ièŠ‚ç‚¹ä¸­æ‰€æœ‰çš„å±æ€§éƒ½æ˜¯ç”¨æ¥æè¿°æ–‡ä»¶çš„ï¼Œè€Œä¸æ˜¯æ–‡ä»¶ä¸­çš„å†…å®¹ã€‚</p><p>ièŠ‚ç‚¹ç±»ä¼¼å›¾ä¹¦é¦†ä¸­çš„å›¾ä¹¦ç›®å½•ï¼Œåœ¨æ¯ä¸€æœ¬ä¹¦çš„å›¾ä¹¦ç›®å½•ä¸­å°æœ‰è¯¥ä¹¦çš„å†…å®¹ç®€ä»‹ã€ä½œè€…ä¿¡æ¯ã€å‡ºç‰ˆæ—¥æœŸã€é¡µæ•°ç­‰<strong>æ‘˜è¦ä¿¡æ¯</strong>ã€‚</p><p>é€šå¸¸æ¯ä¸ªièŠ‚ç‚¹ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œç¬¬1éƒ¨åˆ†æ˜¯æœ‰å…³æ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯ï¼Œç¬¬2éƒ¨åˆ†æ˜¯æŒ‡å‘å­˜å‚¨æ–‡ä»¶ä¿¡æ¯çš„æ•°æ®å—çš„æŒ‡é’ˆï¼š</p><p><img src="http://ww2.sinaimg.cn/large/006tNc79ly1g60fl18enfj30go0730tl.jpg" alt="IMG_1066"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ï¼ˆ1ï¼‰inode-no ï¼šièŠ‚ç‚¹å·ã€‚</span><br><span class="line">åœ¨ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ¯ä¸€ä¸ªièŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç¼–å·ã€‚</span><br><span class="line">ï¼ˆ2ï¼‰File type ï¼šæ–‡ä»¶çš„ç±»å‹ã€‚</span><br><span class="line">&#39;-&#39;ä¸º  æ™®é€šæ–‡ä»¶ï¼Œ</span><br><span class="line">&#39;d&#39;ä¸º ç›®å½•ã€‚</span><br><span class="line">ï¼ˆ3ï¼‰permission ï¼šæƒé™ã€‚</span><br><span class="line">åœ¨ièŠ‚ç‚¹ä¸­ä½¿ç”¨æ•°å­—è¡¨ç¤ºæ³•æ¥è¡¨ç¤ºæ–‡ä»¶çš„æƒé™ã€‚</span><br><span class="line">ï¼ˆ4ï¼‰Link count ï¼šç¡¬è¿æ¥ï¼ˆhard linkï¼‰æ•°ã€‚</span><br><span class="line">ï¼ˆ5ï¼‰UID ï¼šæ–‡ä»¶æ‰€æœ‰è€…çš„UIDã€‚</span><br><span class="line">ï¼ˆ6ï¼‰GID ï¼šowneræ‰€å±ç¾¤ç»„çš„GIDã€‚</span><br><span class="line">ï¼ˆ7ï¼‰size ï¼šæ–‡ä»¶çš„å¤§å°ã€‚</span><br><span class="line">ï¼ˆ8ï¼‰Time stampï¼šæ—¶é—´æˆ³ã€‚</span><br><span class="line">æ—¶é—´æˆ³åŒ…å«äº†3ä¸ªæ—¶é—´ï¼š</span><br><span class="line">â‘ Access timeï¼ˆA timeï¼‰ ï¼šæœ€åä¸€æ¬¡å­˜å–çš„æ—¶é—´ã€‚</span><br><span class="line">â‘¡Modify timeï¼ˆM timeï¼‰ ï¼šæœ€åä¸€æ¬¡ç¼–è¾‘çš„æ—¶é—´ã€‚</span><br><span class="line">â‘¢Change timeï¼ˆC timeï¼‰ï¼šè¯¥æ–‡ä»¶inodeä¸­ä»»ä¸€å…ƒæ•°æ®å‘ç”Ÿå˜åŒ–çš„æ—¶é—´ã€‚</span><br><span class="line">å¦‚æœM timeè¢«æ›´æ–°æ—¶ï¼Œé€šå¸¸A timeå’ŒC timeä¹Ÿä¼šè·Ÿç€ä¸€èµ·è¢«æ›´æ–°ï¼š</span><br><span class="line">åœ¨æ›´æ–°ä¸€ä¸ªæ–‡ä»¶ä¹‹å‰å¿…é¡»å…ˆæ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥è¦å…ˆæ›´æ–°A timeï¼›</span><br><span class="line">ç¼–è¾‘å®Œä¹‹åä¸€èˆ¬æ–‡ä»¶çš„å¤§å°è¦å‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥C timeä¹Ÿä¼šè¢«æ›´æ–°ã€‚</span><br><span class="line">ï¼ˆ9ï¼‰Other information</span><br><span class="line">ï¼ˆ10ï¼‰pointerï¼šæŒ‡å‘ä¿å­˜æ–‡ä»¶çš„blocksçš„æŒ‡é’ˆã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æ–‡ä»¶çš„-inode-numberï¼š"><a href="#æŸ¥çœ‹æ–‡ä»¶çš„-inode-numberï¼š" class="headerlink" title="æŸ¥çœ‹æ–‡ä»¶çš„ inode numberï¼š"></a>æŸ¥çœ‹æ–‡ä»¶çš„ inode numberï¼š</h3><p>å¯ä»¥ä½¿ç”¨å¸¦æœ‰-ié€‰é¡¹çš„lså‘½ä»¤ï¼Œåœ¨æ¯ä¸€è¡Œè®°å½•çš„å¼€å§‹æ˜¾ç¤ºè¿™ä¸ªæ–‡ä»¶çš„ièŠ‚ç‚¹å·ç ã€‚</p><h3 id="æ™®é€šæ–‡ä»¶-ä¸-ç›®å½•"><a href="#æ™®é€šæ–‡ä»¶-ä¸-ç›®å½•" class="headerlink" title="æ™®é€šæ–‡ä»¶ ä¸ ç›®å½•"></a><em>æ™®é€šæ–‡ä»¶</em> ä¸ <em>ç›®å½•</em></h3><p>1.æ™®é€šæ–‡ä»¶ï¼ˆRegular Fileï¼‰ï¼šåªå­˜æ”¾æ•°æ®ï¼Œ</p><p>å¯ä»¥å­˜æ”¾å¤šç§ä¸åŒç±»å‹çš„æ•°æ®ã€‚</p><p>2.ç›®å½•ï¼šâ€œç‰¹æ®Šâ€çš„æ–‡ä»¶ï¼Œç›®å½•ä¸­å­˜å‚¨çš„æ˜¯æ–‡ä»¶åå’Œä¸æ–‡ä»¶åç›¸å…³çš„ièŠ‚ç‚¹å·ç çš„ä¿¡æ¯ã€‚ç›®å½•ä¸­åªèƒ½å­˜æ”¾ä¸€ç±»æ•°æ®ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">struct file_list&#123;</span><br><span class="line">    char name[MAX];</span><br><span class="line">    unsign inode;</span><br><span class="line">    struct file_list next;</span><br><span class="line">&#125; * pBarFiles;</span><br><span class="line">char * make_the_list(struct file_list *);</span><br><span class="line">fooDirectoty.content &#x3D; make_the_list(pBarFiles);</span><br></pre></td></tr></table></figure><h3 id="cpã€rmã€mv-çš„-operate-inode"><a href="#cpã€rmã€mv-çš„-operate-inode" class="headerlink" title="cpã€rmã€mv çš„ operate(inode)"></a>cpã€rmã€mv çš„ operate(inode)</h3><ol><li><code>cp</code>ï¼š</li></ol><p>ï¼ˆ1ï¼‰æ‰¾åˆ°ä¸€ä¸ªç©ºé—²çš„ièŠ‚ç‚¹è®°å½•ï¼ˆinode numberï¼‰ï¼ŒæŠŠæ–°æ–‡ä»¶çš„meta dataå†™å…¥åˆ°è¿™ä¸ªç©ºé—²çš„ièŠ‚ç‚¹ä¸­å¹¶å°†è¿™ä¸ªæ–°è®°å½•æ”¾å…¥inodeè¡¨ä¸­ã€‚</p><p>ï¼ˆ2ï¼‰äº§ç”Ÿä¸€æ¡ç›®å½•è®°å½•ï¼ŒæŠŠæ–°å¢çš„æ–‡ä»¶åå¯¹åº”åˆ°è¿™ä¸ªç©ºçš„inodeå·ç ã€‚</p><p>ï¼ˆ3ï¼‰å°†æ–‡ä»¶çš„å†…å®¹ï¼ˆæ•°æ®ï¼‰å¤åˆ¶åˆ°æ–°å¢çš„æ–‡ä»¶ä¸­å»ã€‚</p><ol start="2"><li><code>rm</code>ï¼š</li></ol><p>ï¼ˆ1ï¼‰é¦–å…ˆå°†è¿™ä¸ªæ–‡ä»¶çš„è¿æ¥æ•°ï¼ˆhard linkï¼‰å‡1ï¼›</p><p>ï¼ˆå¦‚åŸæ–‡ä»¶çš„link countä¸º3ï¼Œè¿è¡Œäº†rmåï¼Œå®ƒçš„link countå°†ä¸º2ï¼‰</p><p>ä¹‹åè¿™ä¸ªæ–‡ä»¶çš„link countå¦‚æœå°äº1ï¼Œ</p><p>å°±é‡Šæ”¾è¿™ä¸ªièŠ‚ç‚¹ä»¥ä¾¿é‡ç”¨ã€‚</p><p>ï¼ˆ2ï¼‰é‡Šæ”¾å­˜å‚¨è¿™ä¸ªæ–‡ä»¶å†…å®¹çš„æ•°æ®å—ï¼›</p><pre><code>            ï¼ˆå³å°†è¿™äº›æ•°æ®å—æ ‡è®°ä¸ºå¯ä»¥ä½¿ç”¨ï¼‰</code></pre><p>ï¼ˆ3ï¼‰åˆ é™¤è®°å½•è¿™ä¸ªæ–‡ä»¶åå’ŒièŠ‚ç‚¹å·çš„ç›®å½•è®°å½•ã€‚</p><ol start="3"><li><code>mv</code>ï¼š</li></ol><p>è‹¥ <em>åŸä½ç½®</em> ä¸ <em>ç›®æ ‡ä½ç½®</em>  ä½äº <strong>åŒä¸€æ–‡ä»¶ç³»ç»Ÿ</strong>ï¼š  </p><pre><code>ï¼ˆ1ï¼‰é¦–å…ˆäº§ç”Ÿä¸€ä¸ªæ–°çš„ç›®å½•è®°å½•ï¼ŒæŠŠæ–°çš„æ–‡ä»¶åå¯¹åº”åˆ°æºæ–‡ä»¶çš„ièŠ‚ç‚¹ã€‚  ï¼ˆ2ï¼‰åˆ é™¤å¸¦æœ‰æ—§æ–‡ä»¶åçš„åŸæœ‰çš„ç›®å½•è®°å½•ã€‚/* è¿™æ˜¯&lt;u&gt;é€»è¾‘ç§»åŠ¨&lt;/u&gt;ï¼šé™¤äº†æ›´æ–°æ—¶é—´æˆ³å¤–ï¼Œç§»åŠ¨æ–‡ä»¶è¡Œä¸ºå¯¹åŸæœ¬åœ¨inodeè¡¨ä¸­çš„æ•°æ®ä¸ä¼šæœ‰ä»»ä½•å½±å“ï¼Œä¹Ÿ**ä¸ä¼šå°†æ•°æ®ç§»åŠ¨**åˆ°å…¶ä»–çš„æ–‡ä»¶ä¸­å»ï¼Œå³**æ²¡æœ‰å‘ç”ŸçœŸæ­£çš„æ•°æ®ç§»åŠ¨**ã€‚\*/</code></pre><p>è‹¥ <em>æºä½ç½®</em> ä¸ <em>ç›®çš„ä½ç½®</em> æ˜¯åœ¨ <strong>ä¸åŒæ–‡ä»¶ç³»ç»Ÿ</strong>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp(source, destination)ï¼›</span><br><span class="line">rm(source)ï¼›</span><br></pre></td></tr></table></figure><p>å¿…è¦æƒ…å†µä¸‹ï¼šä¸ºç¡®ä¿æ•°æ®ç¡®å®å‘ç”Ÿç§»åŠ¨ï¼Œåº”ä½¿ç”¨cpï¼Œrmè€Œémv</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li><p>å…³äºæ–‡ä»¶çš„å‡ ä¸ªæœ¯è¯­ï¼š</p><p>  ï¼ˆ1ï¼‰æ–‡ä»¶åæ˜¯è®¿é—®å’Œç»´æŠ¤æ–‡ä»¶æ—¶æœ€å¸¸ä½¿ç”¨çš„ã€‚</p><p>  ï¼ˆ2ï¼‰ièŠ‚ç‚¹ï¼ˆinodesï¼‰æ˜¯ç³»ç»Ÿç”¨æ¥è®°å½•æœ‰å…³æ–‡ä»¶ä¿¡æ¯çš„å¯¹è±¡ã€‚</p><p>  ï¼ˆ3ï¼‰æ•°æ®å—æ˜¯ç”¨æ¥å­˜å‚¨æ•°æ®çš„ç£ç›˜ç©ºé—´çš„å•ä½ã€‚</p></li><li><p>å…¶ä¸­å…³è”ï¼š</p><p>  æ¯ä¸ªæ–‡ä»¶å¿…é¡»å…·æœ‰ä¸€ä¸ªåå­—å¹¶ä¸”ä¸ä¸€ä¸ªièŠ‚ç‚¹ç›¸å…³ã€‚</p><p>  é€šå¸¸ç³»ç»Ÿé€šè¿‡æ–‡ä»¶åå°±å¯ä»¥ç¡®å®šièŠ‚ç‚¹ï¼Œ</p><p>  ä¹‹åé€šè¿‡ièŠ‚ç‚¹ä¸­çš„æŒ‡é’ˆå°±å¯ä»¥å®šä½å­˜å‚¨æ•°æ®çš„æ•°æ®å—</p></li></ul><p><img src="http://ww2.sinaimg.cn/large/006tNc79gy1g60oehim96j30go00v0sr.jpg" alt="IMG_1067"></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-3.0.1-æ–‡ä»¶åŠå…¶æ“ä½œ</title>
      <link href="/2016/12/26/Linux/linux-3-0-1-Files/"/>
      <url>/2016/12/26/Linux/linux-3-0-1-Files/</url>
      
        <content type="html"><![CDATA[<h1 id="æ–‡ä»¶åŠå…¶æ“ä½œ"><a href="#æ–‡ä»¶åŠå…¶æ“ä½œ" class="headerlink" title="æ–‡ä»¶åŠå…¶æ“ä½œ"></a>æ–‡ä»¶åŠå…¶æ“ä½œ</h1><h2 id="Linuxæ–‡ä»¶ç±»å‹ï¼š"><a href="#Linuxæ–‡ä»¶ç±»å‹ï¼š" class="headerlink" title="Linuxæ–‡ä»¶ç±»å‹ï¼š"></a>Linuxæ–‡ä»¶ç±»å‹ï¼š</h2><table><thead><tr><th>è¡¨ç¤º</th><th>åç§°</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>-</td><td>regular file</td><td>æ™®é€šæ–‡ä»¶ï¼Œæˆ–ç§°æ­£è§„æ–‡ä»¶</td></tr><tr><td>d</td><td>directory</td><td>ç›®å½•</td></tr><tr><td>l</td><td>symbolic linkğŸ</td><td>ç¬¦å·ï¼ˆè½¯ï¼‰è¿æ¥</td></tr><tr><td>b</td><td>block</td><td>å—ç‰¹æ®Šæ–‡ä»¶ï¼šä¸€èˆ¬æ˜¯æŒ‡å—è®¾å¤‡ï¼Œå¦‚ç¡¬ç›˜ã€‚</td></tr><tr><td>c</td><td>character</td><td>å­—ç¬¦ç‰¹æ®Šæ–‡ä»¶ï¼šä¸€èˆ¬æ˜¯æŒ‡å­—ç¬¦è®¾å¤‡ï¼Œå¦‚é”®ç›˜ã€‚</td></tr><tr><td>p</td><td>pipe</td><td>å‘½åçš„ç®¡é“æ–‡ä»¶ï¼šä¸€èˆ¬ç”¨äºåœ¨è¿›ç¨‹ä¹‹é—´ä¼ è¾“æ•°æ®ã€‚</td></tr><tr><td>s</td><td>socketğŸ¶</td><td>å¥—æ¥å­—ï¼šé€šä¿¡ï¼ˆè¿‡ç¨‹ä¸­ï¼‰çš„ä¸€ä¸ªç»ˆç‚¹ã€‚</td></tr></tbody></table><p>ğŸ. è¯¦è§æœ¬ç³»åˆ—æ–‡ç« çš„â€œ<u>è¿æ¥(link)</u>â€</p><p>ğŸ¶.  socket çš„æ¯”å–»æ€§è§£é‡Šï¼š</p><p><strong>socketä¸ç”µè¯ååˆ†ç›¸ä¼¼ï¼š</strong></p><p><em>å½“ä¸æŸäººé€šè¯æ—¶å°±è¦å»ºç«‹ä¸¤ä¸ªé€šä¿¡çš„ç»ˆç‚¹ï¼š</em></p><p><em>ï¼ˆ1ï¼‰è‡ªå·±çš„ç”µè¯</em></p><p><em>ï¼ˆ2ï¼‰å¯¹æ–¹çš„ç”µè¯</em></p><p><em>åªè¦åŒæ–¹è¿›è¡Œé€šè¯ï¼Œå°±å¿…é¡»æœ‰ä¸¤ä¸ªé€šè¯æ‰€å¿…éœ€çš„ç»ˆç‚¹ï¼ˆç”µè¯ï¼‰å’Œä¸€æ¡åœ¨å®ƒä»¬ä¹‹é—´çš„é€šä¿¡çº¿è·¯å­˜åœ¨ã€‚</em></p><p>Â Â  Â Â Â  Â socketå°±ç›¸å½“äºä¸€æ¡é€šä¿¡çº¿è·¯çš„ç»ˆç‚¹ï¼ˆç”µè¯ï¼‰ï¼Œè€Œåœ¨è¿™äº›ç»ˆç‚¹ï¼ˆsocketsï¼‰ä¹‹é—´å­˜åœ¨ç€æ•°æ®é€šä¿¡ç½‘ç»œã€‚</p><p><em>å½“æ‰“ç”µè¯ç»™ä»–äººæ—¶ï¼Œéœ€è¦æ‹¨æ‰“å¯¹æ–¹çš„ç”µè¯å·ç ã€‚</em></p><p>Â Â  Â Â Â  Â socketsä½¿ç”¨ç½‘ç»œåœ°å€å–ä»£äº†ç”µè¯å·ç ã€‚é€šè¿‡è®¿é—®è¿œç¨‹ï¼ˆè®¡ç®—æœºï¼‰çš„socketåœ°å€ï¼Œæœ¬æœºç¨‹åºå°±å¯ä»¥ç”¨çš„æœ¬æœºsocketä¸è¿œç¨‹çš„ç»ˆç‚¹ï¼ˆsocketï¼‰ä¹‹é—´å»ºç«‹èµ·ä¸€æ¡é€šä¿¡çº¿è·¯ã€‚</p><h2 id="æ–‡ä»¶æ“ä½œ"><a href="#æ–‡ä»¶æ“ä½œ" class="headerlink" title="æ–‡ä»¶æ“ä½œ"></a>æ–‡ä»¶æ“ä½œ</h2><ul><li>fileï¼šç¡®å®šæ–‡ä»¶ç±»å‹</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ file æ–‡ä»¶å</span><br></pre></td></tr></table></figure><ul><li>touchï¼šåˆ·æ–°ã€æ–°å»ºæ–‡ä»¶</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ touch file(s)</span><br><span class="line">Â Â  Â Â  Â  è‹¥fileå­˜åœ¨ï¼Œæ›´æ–°æ—¶é—´æˆ³</span><br><span class="line">Â Â  Â Â  Â  è‹¥fileä¸å­˜åœ¨ï¼Œæ–°å»ºç©ºæ–‡ä»¶</span><br></pre></td></tr></table></figure><ul><li>cpï¼šå¤åˆ¶</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ cp [-option(s)]  source(s)  target</span><br><span class="line">    æŠŠsourceå¤åˆ¶åˆ°targetï¼š</span><br><span class="line">        -iï¼šäº¤äº’å¼ï¼šé˜²æ­¢è¦†ç›–ï¼Œè¦†ç›–å‰æç¤º</span><br><span class="line">        -fï¼šå¼ºåˆ¶å¼ï¼šæœ‰åŒåï¼Œå¼ºåˆ¶è¦†ç›–ï¼Œä¸æç¤º</span><br><span class="line">        -rï¼šé€’å½’å¼ï¼šå¤åˆ¶ç›®å½•æ—¶åŒ…æ‹¬å­ç›®å½•</span><br><span class="line">        -pï¼šç»´æŒå¼ï¼šä¿ç•™å±æ€§ï¼ˆå¦‚æ—¶é—´æˆ³ï¼‰</span><br><span class="line">        sourceæ˜¯ç›®å½•åæˆ–æ–‡ä»¶å</span><br><span class="line">        targetæ˜¯ç›®å½•åæˆ– æ–°æ–‡ä»¶å(å¤åˆ¶å¹¶é‡å‘½å)</span><br></pre></td></tr></table></figure><ul><li>mvï¼šç§»åŠ¨åŠä¿®æ”¹æ–‡ä»¶ã€ç›®å½•å</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mv file(s) target</span><br><span class="line">    æŠŠsourceç§»åŠ¨åˆ°targetï¼š</span><br><span class="line">        sourceæ˜¯ç›®å½•åæˆ–æ–‡ä»¶å</span><br><span class="line">        targetæ˜¯ç›®å½•åæˆ– æ–°æ–‡ä»¶å(ç§»åŠ¨å¹¶é‡å‘½å)</span><br></pre></td></tr></table></figure><p>Â Â  Â Â  Â  é‡å‘½åå¯ç”¨â€œ<strong>mv Â path/old_name Â path/new_nam</strong>eâ€å®ç°</p><ul><li>rmï¼šåˆ é™¤</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ rm  [option(s)]  file(s)|directory(s)</span><br><span class="line">    åˆ é™¤æ–‡ä»¶æˆ– ç›®å½•(åŠ -r)ï¼š</span><br><span class="line">        -iï¼šäº¤äº’å¼ï¼šåˆ å‰æç¤º</span><br><span class="line">        -rï¼šé€’å½’å¼ï¼šåŒ…æ‹¬å­ç›®å½•ã€æ–‡ä»¶</span><br><span class="line">        -fï¼šå¼ºåˆ¶æ€§ï¼šä¸è¯¢é—®ï¼Œç›´æ¥åˆ </span><br></pre></td></tr></table></figure><ul><li>findï¼šæœç´¢æ–‡ä»¶å’Œç›®å½•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$ find Pathname Expressions Actions</span><br><span class="line">    â€¢Pathnameï¼šéå†èµ·å§‹è·¯å¾„</span><br><span class="line">    â€¢Expressionsï¼šæ¡ä»¶è¡¨è¾¾å¼ï¼š</span><br><span class="line">        -nameâ€œæŒ‡å®šæ–‡ä»¶åâ€</span><br><span class="line">        -size[+|-]n</span><br><span class="line">                æ–‡ä»¶å¤§å°å¤§äºå°äºæˆ–ç­‰äº(n*512B)</span><br><span class="line">        -atime[+|-]n</span><br><span class="line">                è®¿é—®å¤©æ•°</span><br><span class="line">        -mtime[+|-]nï¼šæ›´æ”¹å¤©æ•°</span><br><span class="line">        -user LoginIDï¼šå±äºæŸç”¨æˆ·çš„æ‰€æœ‰æ–‡ä»¶</span><br><span class="line">        -typeï¼šæŸä¸€ç±»å‹çš„æ–‡ä»¶ï¼š</span><br><span class="line">                fï¼šæ–‡ä»¶</span><br><span class="line">                dï¼šç›®å½•</span><br><span class="line">                eâ€†tâ€†c</span><br><span class="line">        -permï¼šæŸ¥æ‰¾å…·æœ‰æŸäº›ç‰¹å®šè®¿é—®è®¸å¯ä½çš„æ–‡ä»¶</span><br><span class="line">    â€¢Actionsï¼šå¯¹æ‰¾å‡ºçš„æ–‡ä»¶è¿›è¡Œçš„æ“ä½œï¼š</span><br><span class="line">        -execå‘½ä»¤&#123;&#125; \;</span><br><span class="line">                åœ¨æ¯ä¸€ä¸ªæ‰€å®šä½çš„æ–‡ä»¶ä¸Šè¿è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚</span><br><span class="line">                â€œ&#123;&#125;â€œ  è¡¨æ˜æ–‡ä»¶åå°†ä¼ ç»™å‰é¢çš„å‘½ä»¤ã€‚</span><br><span class="line">                â€œ \;â€ è¡¨ç¤ºå‘½ä»¤çš„ç»“æŸã€‚</span><br><span class="line">                ï¼ˆåœ¨å¤§æ‹¬å·ä¸åæ–œçº¿ä¹‹é—´å¿…é¡»æœ‰ä¸€ä¸ªç©ºæ ¼ã€‚ï¼‰</span><br><span class="line">        -okå‘½ä»¤&#123;&#125; \;</span><br><span class="line">                -execå‘½ä»¤çš„äº¤äº’æ–¹å¼</span><br><span class="line">                ï¼ˆåœ¨findå‘½ä»¤å¯¹æ¯ä¸ªå®šä½çš„æ–‡ä»¶æ‰§è¡Œå‘½ä»¤ä¹‹å‰éœ€è¦ç¡®è®¤ï¼‰</span><br><span class="line">        -print</span><br><span class="line">                æŒ‡ç¤ºfindå‘½ä»¤å°†å½“å‰çš„è·¯å¾„åæ‰“å°åœ¨ç»ˆç«¯å±å¹•ä¸Š</span><br><span class="line">                ï¼ˆé»˜è®¤æ–¹å¼ï¼‰</span><br><span class="line">        -ls</span><br><span class="line">                æ˜¾ç¤ºå½“å‰è·¯å¾„åå’Œç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯</span><br><span class="line">                å¦‚ièŠ‚ç‚¹ï¼ˆinodeï¼‰æ•°ã€ä»¥Kå­—èŠ‚ä¸ºå•ä½çš„å¤§å°ï¼ˆå°ºå¯¸ï¼‰ã€ä¿æŠ¤æ¨¡å¼ã€ç¡¬è¿æ¥å’Œç”¨æˆ·</span><br></pre></td></tr></table></figure><p>Â  Â  å¯ç”¨<code>find /etc -name passwd Â 2&gt;finderrs.txt</code>é‡å®šå‘ï¼ŒæŠŠæƒé™ä¸è¶³çš„é”™è¯¯ä¸åœ¨å±å¹•æ˜¾ç¤ºã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-3.0.0-ç›®å½•åŠå…¶æ“ä½œ</title>
      <link href="/2016/12/25/Linux/linux-3-0-0-Directory/"/>
      <url>/2016/12/25/Linux/linux-3-0-0-Directory/</url>
      
        <content type="html"><![CDATA[<h1 id="ç›®å½•åŠå…¶æ“ä½œ"><a href="#ç›®å½•åŠå…¶æ“ä½œ" class="headerlink" title="ç›®å½•åŠå…¶æ“ä½œ"></a>ç›®å½•åŠå…¶æ“ä½œ</h1><h3 id="å‡ ä¸ªç‰¹æ®Šç›®å½•"><a href="#å‡ ä¸ªç‰¹æ®Šç›®å½•" class="headerlink" title="å‡ ä¸ªç‰¹æ®Šç›®å½•"></a>å‡ ä¸ªç‰¹æ®Šç›®å½•</h3><table><thead><tr><th>ç›®å½•</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>/</td><td>æ ¹ç›®å½•</td></tr><tr><td>~ï¼ˆ==$HOMEï¼‰</td><td>å®¶ç›®å½•ğŸš©</td></tr><tr><td>.</td><td>å½“å‰ç›®å½•</td></tr><tr><td>..</td><td>ä¸Šä¸€å±‚ç›®å½•</td></tr></tbody></table><p>ä»¥â€™ . â€˜å¼€å¤´çš„æ–‡ä»¶æˆ–ç›®å½•è¡¨ç¤ºéšè—ï¼›</p><p>ğŸš©. æ™®é€šç”¨æˆ·çš„å®¶ç›®å½•ä¸º <code>/home</code> çš„å­ç›®å½•ï¼Œrootçš„æ˜¯ <code>/root</code></p><p>Â  Â  â€œ<code>ï½</code>â€ä»£è¡¨å½“å‰ç”¨æˆ·çš„å®¶ç›®å½•ï¼Œ</p><p>Â  Â  â€œ<code>ï½username</code>â€ä»£è¡¨æŸç”¨æˆ·çš„å®¶ç›®å½•ã€‚</p><p>ç™»å½•ç³»ç»Ÿæˆ–é‡å¯ shellåé»˜è®¤çš„ <code>pwd</code> æ˜¯ <code>$(whoami)</code>çš„ <code>$HOME</code></p><h3 id="ä¸ç¨‹åºç›¸å…³çš„å‡ ä¸ªç›®å½•ï¼š"><a href="#ä¸ç¨‹åºç›¸å…³çš„å‡ ä¸ªç›®å½•ï¼š" class="headerlink" title="ä¸ç¨‹åºç›¸å…³çš„å‡ ä¸ªç›®å½•ï¼š"></a>ä¸ç¨‹åºç›¸å…³çš„å‡ ä¸ªç›®å½•ï¼š</h3><table><thead><tr><th>ç›®å½•</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>/bin</td><td>å­˜æ”¾å¯æ‰§è¡Œæ–‡ä»¶</td></tr><tr><td>/sbin</td><td>å­˜æ”¾ç³»ç»Ÿå¯æ‰§è¡Œæ–‡ä»¶</td></tr><tr><td>/usr(Unix System Resources)</td><td>å­˜æ”¾ç³»ç»Ÿçš„åº”ç”¨ç¨‹åºå’Œä¸å‘½ä»¤ç›¸å…³çš„ç³»ç»Ÿæ•°æ®ï¼ˆç±»ä¼¼äº Windows çš„C:\Program Fileï¼‰</td></tr></tbody></table><h3 id="ç›®å½•æ“ä½œï¼š"><a href="#ç›®å½•æ“ä½œï¼š" class="headerlink" title="ç›®å½•æ“ä½œï¼š"></a><strong>ç›®å½•æ“ä½œï¼š</strong></h3><ul><li>pwd</li></ul><p><code>$ pwd</code></p><p> æ‰“å°å·¥ä½œï¼ˆå½“å‰ï¼‰ç›®å½•çš„ç»å¯¹è·¯å¾„</p><ul><li>cd</li></ul><p><code>$ cd path</code></p><p> åˆ‡æ¢å·¥ä½œç›®å½•</p><p>Â Â  Â Â Â  Â Â Â  Â Â  Â  â€œ<code>cd ~</code>â€ == â€œcdâ€æ— å‚ï¼šåˆ‡æ¢åˆ° <code>$HOME</code></p><p>Â Â  Â Â Â  Â Â Â  Â Â  Â  â€œ<code>cd -</code>â€ï¼šåˆ‡æ¢åˆ°ä¸Šä¸€å·¥ä½œç›®å½•</p><ul><li>ls</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ ls [keyword]</span><br><span class="line"> æ— keywordï¼šåˆ—å‡ºå½“å‰ç›®å½•ä¸‹å†…å®¹</span><br><span class="line">Â  Â  æœ‰keywordï¼šåˆ—å‡ºç›®å½•ä¸­åå«keywordçš„å†…å®¹</span><br><span class="line">Â  Â  </span><br><span class="line">$ ls dirA dirB</span><br><span class="line">Â Â  Â åŒæ—¶æ˜¾ç¤ºdirAä¸dirBä¸­çš„å†…å®¹</span><br><span class="line">Â Â  Â </span><br><span class="line">$ ls -F</span><br><span class="line">Â  Â  æ˜¾ç¤º *æ–‡ä»¶ç±»å‹*ğŸš</span><br><span class="line"></span><br><span class="line">$ ls -a</span><br><span class="line">Â  Â  Â &#x3D;&#x3D; â€œls --allâ€</span><br><span class="line">Â  Â  æ˜¾ç¤ºæ­£å¸¸ã€éšè—æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">$ ls -l</span><br><span class="line">Â  Â  åˆ—å‡ºæ–‡ä»¶è¯¦ç»†ä¿¡æ¯ï¼ˆå…¶ä¸­å¤§å°ä¸ºå­—èŠ‚ï¼‰</span><br><span class="line">Â  Â  å†åŠ ä¸Š-hï¼šå¤§å°ä»¥æƒ¯ä¾‹è¡¨ç¤º</span><br><span class="line"></span><br><span class="line">$ ls -d</span><br><span class="line">Â  Â  åªåˆ—å‡ºå½“å‰ç›®å½•çš„ä¿¡æ¯ï¼Œä¸åŒ…å«å­ç›®å½•ä¸‹çš„ä¿¡æ¯</span><br></pre></td></tr></table></figure><p>ğŸš. æ–‡ä»¶ç±»å‹ï¼šè¯¦è§æœ¬ç³»åˆ—æ–‡ç« çš„â€œæ–‡ä»¶åŠå…¶æ“ä½œâ€</p><ul><li>mkdir</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir ç›®å½•å</span><br><span class="line">Â Â  Â åˆ›å»ºç›®å½•</span><br><span class="line"></span><br><span class="line">$ mkdir -p å‘½ä»¤å</span><br><span class="line">Â  Â  åˆ›å»ºç›®å½•ï¼ˆè¡¥è¶³ä¸å­˜åœ¨çš„è·¯å¾„ï¼‰</span><br></pre></td></tr></table></figure><ul><li>rmdirï¼šåˆ é™¤ç›®å½•</li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-2.3-æ–‡ä»¶çš„å®‰å…¨æ§åˆ¶</title>
      <link href="/2016/12/24/Linux/linux-2-3-fileSafe/"/>
      <url>/2016/12/24/Linux/linux-2-3-fileSafe/</url>
      
        <content type="html"><![CDATA[<h1 id="æ–‡ä»¶çš„å®‰å…¨æ§åˆ¶"><a href="#æ–‡ä»¶çš„å®‰å…¨æ§åˆ¶" class="headerlink" title="æ–‡ä»¶çš„å®‰å…¨æ§åˆ¶"></a>æ–‡ä»¶çš„å®‰å…¨æ§åˆ¶</h1><ul><li><p>Linuxç³»ç»Ÿçš„å®‰å…¨æ¨¡å‹</p></li><li><p>ç”¨æˆ·<strong>ç™»å½•</strong>ç³»ç»Ÿæ—¶å¿…é¡»<strong>æä¾›ç”¨æˆ·åå’Œå¯†ç </strong>ã€‚</p></li></ul><p>/* Â ç”¨æˆ·æ˜¯ç”±rootç”¨æˆ·åˆ›å»ºçš„ï¼Œæœ€åˆçš„å¯†ç ä¹Ÿæ˜¯rootç”¨æˆ·è®¾å®šçš„ */</p><ul><li><p>ä½¿ç”¨<strong>ç”¨æˆ·</strong>å’Œ<strong>ç¾¤ç»„</strong>æ¥æ§åˆ¶ä½¿ç”¨è€…<strong>è®¿é—®</strong>æ–‡ä»¶å’Œå…¶ä»–èµ„æºçš„<strong>æƒé™</strong>ã€‚</p></li><li><p>ç³»ç»Ÿä¸Šçš„æ¯ä¸€ä¸ª<strong>æ–‡ä»¶</strong>éƒ½ä¸€å®š<strong>å±äº</strong>ä¸€ä¸ª<strong>ç”¨æˆ·</strong>ï¼ˆä¸€èˆ¬è¯¥ç”¨æˆ·å°±æ˜¯æ–‡ä»¶çš„åˆ›å»ºè€…ï¼‰å¹¶<strong>ä¸</strong>ä¸€ä¸ª<strong>ç¾¤ç»„ç›¸å…³</strong>ã€‚</p></li><li><p>æ¯ä¸€ä¸ª<strong>è¿›ç¨‹</strong>éƒ½ä¼š<strong>ä¸</strong>ä¸€ä¸ª<strong>ç”¨æˆ·å’Œç¾¤ç»„</strong>ç›¸<strong>å…³è”</strong>ã€‚å¯ä»¥é€šè¿‡åœ¨æ‰€æœ‰çš„æ–‡ä»¶å’Œèµ„æºä¸Šè®¾å®šæƒé™æ¥åªå…è®¸è¯¥æ–‡ä»¶çš„<strong>æ‰€æœ‰è€…</strong>æˆ–è€…æŸä¸ª<strong>ç¾¤ç»„</strong>çš„æˆå‘˜è®¿é—®å®ƒä»¬ã€‚</p></li><li><p>Linux ä¸Šæ–‡ä»¶æœ‰ä¸‰ç§ç±»å‹çš„æƒé™ï¼š</p></li><li><p>æ‰€æœ‰è€… Â ï¼šï¼ˆuï¼‰ï¼šæ–‡ä»¶çš„**<u>æ‰€æœ‰è€…</u>**çš„æƒé™</p></li><li><p>åŒç»„ç”¨æˆ·ï¼šï¼ˆgï¼‰ï¼šä¸æ‰€æœ‰è€…**<u>åŒä¸€ç¾¤ç»„</u>**çš„å…¶ä»–ç”¨æˆ·çš„æƒé™</p></li><li><p>å…¶ä»–ç”¨æˆ·ï¼šï¼ˆoï¼‰ï¼šéæ‰€æœ‰è€…ä¹Ÿ**<u>ä¸åŒç¾¤</u>**çš„ç”¨æˆ·çš„æƒé™</p></li></ul><p>/* rootç”¨æˆ·ä¸å—æƒé™é™åˆ¶ï¼Œå¯ä»¥è®¿é—®Linuxä¸Šçš„ä»»ä½•èµ„æº */</p><ul><li><p>æƒé™çš„è¡¨ç¤ºï¼š</p><table><thead><tr><th>å­—æ¯è¡¨ç¤º</th><th>æ•°å­—è¡¨ç¤º</th><th>å«ä¹‰</th><th>å¯¹æ–‡ä»¶çš„æƒé™</th><th>å¯¹ç›®å½•çš„æƒé™</th></tr></thead><tbody><tr><td>r</td><td>4</td><td>Read</td><td>å¯é˜…è¯»æ–‡ä»¶</td><td>ä½¿ç”¨lsåˆ—å‡ºç›®å½•å†…å®¹</td></tr><tr><td>w</td><td>2</td><td>Write</td><td>å¯ç¼–è¾‘æ–‡ä»¶</td><td>ç¼–è¾‘ç›®å½•(åœ¨å…¶ä¸­åˆ›å»ºã€åˆ é™¤ç­‰)</td></tr><tr><td>x</td><td>1</td><td>eXecute</td><td>å¯æ‰§è¡Œç¨‹åº(å¯æ‰§è¡Œæ–‡ä»¶)</td><td>ä½¿ç”¨cdè¿›å…¥ç›®å½•ï¼Œç”¨ls -læŸ¥çœ‹ç›®å½•è¯¦æƒ…</td></tr><tr><td>- ï¼ˆè¿å­—ç¬¦ï¼‰</td><td>0</td><td>no</td><td>æ²¡ç”¨ç›¸åº”çš„æƒé™(åŒä½çš„r|w|x)</td><td>æ²¡ç”¨ç›¸åº”çš„æƒé™(åŒä½çš„r|w|x)</td></tr></tbody></table></li><li><p>æŸ¥çœ‹æ–‡ä»¶çš„æƒé™</p></li></ul><p>ç”¨Â **ls -lÂ **å‘½ä»¤ï¼šæ˜¾ç¤ºç»“æœä¸­çš„ç¬¬1åˆ—ï¼ˆ10ä¸ªå­—ç¬¦ï¼‰è¡¨ç¤ºæ–‡ä»¶çš„modeï¼š</p><p><img src="http://ww3.sinaimg.cn/large/006tNc79gy1g60eo9tu5zj306n02j74b.jpg" alt="IMG_1065"></p><p align="left">å…¶ä¸­ç¬¬1ä¸ªå­—ç¬¦è¡¨ç¤ºæ–‡ä»¶çš„ç±»å‹ï¼š</p>- å¦‚æœæ˜¯då°±è¡¨ç¤ºæ˜¯ç›®å½•<ul><li>å¦‚æœæ˜¯-å°±è¡¨ç¤ºæ˜¯æ–‡ä»¶ã€‚</li></ul><p>ç´§æ¥å…¶åçš„9ä¸ªå­—ç¬¦æ˜¯è¿™ä¸ªæ–‡ä»¶æˆ–å‘½ä»¤çš„æƒé™ï¼š</p><p><img src="http://ww2.sinaimg.cn/large/006tNc79gy1g60ep4llfaj30ax02fglj.jpg" alt="IMG_1062"></p><ul><li>Linux çš„å®‰å…¨æ£€æµ‹æµç¨‹</li></ul><p><img src="http://ww4.sinaimg.cn/large/006tNc79ly1g60epak066j30go072aak.jpg" alt="IMG_1060"></p><ul><li>è®¾å®šæ–‡ä»¶æˆ–ç›®å½•ä¸Šçš„æƒé™è¦ç”¨chmodå‘½ä»¤ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod [-R] mode æ–‡ä»¶æˆ–ç›®å½•å</span><br><span class="line">        -Rï¼šé€’å½’çš„ï¼Œè®¾ç½®åŒæ—¶åº”ç”¨äºç›®å½•ä¸­çš„å­ç›®å½•å’Œæ‰€æœ‰æ–‡ä»¶ï¼Œåªæœ‰rootå¯ç”¨ã€‚</span><br><span class="line">        mode: è¯¦è§ğŸ‘‡</span><br></pre></td></tr></table></figure><p><span style="color: rgb(38, 180, 80);"><em>*.</em></span><strong><em>mode</em></strong>ï¼š</p><ol><li>ç”¨<strong>è¡¨è¾¾å¼</strong>è¡¨ç¤ºï¼š</li></ol><p><em>ç”¨â€œ{who} Â {operator} Â {permission}â€è¡¨ç¤ºmodeï¼š</em></p><p><img src="http://ww1.sinaimg.cn/large/006tNc79ly1g60eps4gcej30go03nmxf.jpg" alt="IMG_1061"></p><p>æƒé™çŠ¶æ€å¯ä»¥åˆ†æˆ3ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><p>ç¬¬1éƒ¨åˆ†ï¼Œè¡¨ç¤ºè¦è®¾å®š<strong>è°</strong>çš„çŠ¶æ€ï¼š</p></li><li><p>uï¼š<span style="background-color: rgb(255, 250, 165);">æ‰€æœ‰è€…</span>çš„æƒé™ã€‚</p></li><li><p>gï¼š<span style="background-color: rgb(255, 250, 165);">ç¾¤ç»„</span>çš„æƒé™ã€‚</p></li><li><p>oï¼šæ—¢ä¸æ˜¯ownerä¹Ÿä¸ä¸owneråœ¨åŒä¸€ä¸ªgroupçš„<span style="background-color: rgb(255, 250, 165);">å…¶ä»–ç”¨æˆ·</span>çš„æƒé™ã€‚</p></li><li><p>aï¼šæ‰€ä»¥ï¼Œä»¥ä¸Š3ç»„ï¼Œä¹Ÿå°±æ˜¯<span style="background-color: rgb(255, 250, 165);"><u>æ‰€æœ‰ç”¨æˆ·</u></span>çš„æƒé™ã€‚</p></li><li><p>ç¬¬2éƒ¨åˆ†ï¼Œ<strong>è¿ç®—ç¬¦</strong>ï¼ˆæ“ä½œç¬¦ï¼‰</p></li><li><p>+ï¼š<span style="background-color: rgb(255, 250, 165);">åŠ å…¥</span>æƒé™ã€‚</p></li><li><ul><li>ï¼š<span style="background-color: rgb(255, 250, 165);">å»æ‰</span>æƒé™ã€‚</li></ul></li><li><p>=ï¼š<span style="background-color: rgb(255, 250, 165);">è®¾å®š</span>æƒé™ã€‚</p></li><li><p>ç¬¬3éƒ¨åˆ†ï¼Œ<strong>æƒé™</strong>ï¼ˆpermissionï¼‰</p></li><li><p>r Â ï¼šreadæƒé™ã€‚</p></li><li><p>wï¼šwriteæƒé™ã€‚</p></li><li><p>x ï¼šexecuteæƒé™ã€‚</p></li></ul><p>e.g.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ chmod ug+x tastingFile</span><br><span class="line">Â Â  Â Â Â  Â åœ¨tastingFileæ–‡ä»¶ä¸Šæ·»åŠ ä¸Šæ‰€æœ‰è€…å’ŒåŒç»„ç”¨æˆ·çš„å¯æ‰§è¡Œæƒé™</span><br></pre></td></tr></table></figure><ol start="2"><li>ç”¨<strong>æ•°å­—</strong>è¡¨ç¤ºï¼š</li></ol><p><em>ç”¨ Â ä¸€ç»„ä¸‰ä½æ•° Â è¡¨ç¤ºmodeï¼š</em></p><p>ï¼ˆ1ï¼‰ç¬¬1ä¸ªæ•°å­— Â ä»£è¡¨ Â æ‰€æœ‰è€… Â  Â  Â (own user) Â  Â çš„æƒé™ Â  ï¼ˆuï¼‰</p><p>ï¼ˆ2ï¼‰ç¬¬2ä¸ªæ•°å­— Â ä»£è¡¨ Â ç¾¤ç»„ Â  Â  Â  ï¼ˆgroupï¼‰ Â Â  Â  Â çš„æƒé™ Â  ï¼ˆgï¼‰</p><p>ï¼ˆ3ï¼‰ç¬¬3ä¸ªæ•°å­— Â ä»£è¡¨ Â å…¶ä»–ç”¨æˆ·ï¼ˆotherï¼‰Â Â  Â Â Â  Â çš„æƒé™ Â  ï¼ˆoï¼‰</p><p>è¿™ç»„3ä½æ•°ä¸­çš„æ¯ä¸€ä½æ•°å­—éƒ½æ˜¯ç”±ä»¥ä¸‹è¡¨ç¤ºèµ„æºæƒé™çŠ¶æ€çš„æ•°å­—ï¼ˆå³4ã€2ã€1å’Œ0ï¼‰ç›¸åŠ è€Œè·å¾—çš„æ€»å’Œï¼š</p><p>Â Â  Â Â Â  Â 4ï¼š100(2)ï¼šè¡¨ç¤ºå…·æœ‰Â Â  Â readÂ  Â  Â  Â æƒé™ã€‚</p><p>Â Â  Â Â Â  Â 2ï¼š010(2)ï¼šè¡¨ç¤ºå…·æœ‰Â Â  Â writeÂ  Â  Â  æƒé™ã€‚</p><p>Â Â  Â Â Â  Â 1ï¼š001(2)ï¼šè¡¨ç¤ºå…·æœ‰Â Â execute Â  æƒé™ã€‚</p><p>Â Â  Â Â Â  Â 0ï¼š000(2)ï¼šè¡¨ç¤º Â æ²¡æœ‰ç›¸åº”çš„æƒé™ã€‚</p><p>å³ï¼š</p><p><img src="http://ww3.sinaimg.cn/large/006tNc79ly1g60eq5o2mej30go05i3z4.jpg" alt="IMG_1064"></p><p>e.g.</p><p><img src="http://ww2.sinaimg.cn/large/006tNc79ly1g60eqx53n4j30e204jwep.jpg"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># chmod -R 754 &#x2F;home&#x2F;foo&#x2F;bar</span><br><span class="line"></span><br><span class="line">Â Â  Â Â Â  Â å¯¹owner(foo)å¼€æ”¾å®¶ç›®å½•çš„barå­ç›®å½•å’Œå…¶ä¸­æ‰€æœ‰æ–‡ä»¶çš„ä¸€åˆ‡æƒé™ï¼Œä½†æ˜¯å¯¹åŒç»„ç”¨æˆ·å¼€æ”¾è¯»å’Œæ‰§è¡Œæƒé™è€Œå¯¹å…¶ä»–ç”¨æˆ·åªå¼€æ”¾è¯»æƒé™</span><br></pre></td></tr></table></figure><ul><li><strong>ç‰¹æ®Šæƒé™</strong>ï¼ˆç¬¬4ç»„æƒé™ï¼‰</li></ul><p>ç¬¬4ç»„æƒé™åŒ…æ‹¬suidã€sgidå’Œsticky 3ç§æƒé™ã€‚</p><p>å…¶ä¸­ï¼Œ</p><ul><li><p>suid Â ï¼š100ï¼š4ï¼šå€Ÿç”¨uçš„å¯æ‰§è¡Œæƒé™ä½ï¼Œå¹¶ä»¥ <strong>s</strong> æ¥è¡¨ç¤ºï¼›  </p></li><li><p>sgid Â ï¼š Â 10ï¼š2ï¼šå€Ÿç”¨gçš„å¯æ‰§è¡Œæƒé™ä½ï¼Œå¹¶ä»¥ <strong>s</strong> æ¥è¡¨ç¤ºï¼›</p></li><li><p>sticky ï¼š Â  Â 1ï¼š1ï¼šå€Ÿç”¨oçš„å¯æ‰§è¡Œæƒé™ä½ï¼Œå¹¶ä»¥ <strong>t</strong> æ¥è¡¨ç¤ºï¼›</p></li></ul><p>å½“åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸ŠåŠ å…¥suid|sgid|stickyç‰¹æ®Šæƒé™æ—¶ï¼š</p><p>å¦‚æœåŸæ¥çš„æ–‡ä»¶çš„u|g|oå…·æœ‰xæƒé™ï¼š</p><p>å°±ä½¿ç”¨å°å†™çš„s|s|tæ¥ä»£æ›¿xï¼›</p><p>å¦‚æœåŸæ¥æ²¡æœ‰xï¼š</p><p>å°±ç”¨å¤§å†™çš„S|S|Tæ¥ä»£æ›¿ï¼›</p><p><u>è®¾ç½®</u>ç‰¹æ®Šæƒé™ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># å­—ç¬¦ï¼š</span><br><span class="line">$ chmod [u|g|o][+,-,&#x3D;][s|s|t] file</span><br><span class="line"># æ•°å­—ï¼šï¼ˆç¬¬å››ç»„è¡¨ç¤ºç‰¹æ®Šæƒé™ï¼‰</span><br><span class="line">$ chmod [0-7][0-7][0-7][0-7] file</span><br></pre></td></tr></table></figure><p>ç‰¹æ®Šæƒé™<u>ä½œç”¨</u>ï¼š</p><p>å°†suidå’Œsgidè®¾å®šåœ¨<em>å¯æ‰§è¡Œæ–‡ä»¶</em>ä¸Šï¼š</p><ul><li><p>è¿è¡Œæœ‰suidç‰¹æ®Šæƒé™çš„å¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼šæ˜¯ä»¥å¯æ‰§è¡Œæ–‡ä»¶çš„<strong>æ‰€æœ‰è€…æƒé™æ¥è¿è¡Œ</strong>è¿™ä¸€å¯æ‰§è¡Œæ–‡ä»¶çš„ï¼Œè€Œä¸æ˜¯ä»¥æ‰§è¡Œè€…çš„æƒé™æ¥è¿è¡Œè¯¥å‘½ä»¤ã€‚</p></li><li><p>sgidç‰¹æ®Šæƒé™ä¸suidç±»ä¼¼ï¼Œæ˜¯ä»¥å‘½ä»¤çš„ç¾¤ç»„çš„æƒé™æ¥è¿è¡Œè¿™ä¸€å‘½ä»¤çš„ã€‚</p></li></ul><p>å°†sgidå’Œstickyè®¾å®šåœ¨<em>ç›®å½•</em>ä¸Šï¼š  </p><ul><li><p>ä¸€ä¸ªç›®å½•ä¸Šè®¾ç½®äº†stickyæƒé™ï¼Œå°±åªæœ‰æ–‡ä»¶çš„æ‰€æœ‰è€…å’Œrootç”¨æˆ·æ‰å¯ä»¥åˆ é™¤è¯¥ç›®å½•ä¸­çš„æ–‡ä»¶ï¼Œè€ŒLinuxç³»ç»Ÿä¸ä¼šç†ä¼šgroupæˆ–otherçš„å†™æƒé™ã€‚</p></li><li><p>ä¸€ä¸ªç›®å½•ä¸Šè®¾ç½®äº†sgidæƒé™ï¼Œåªè¦æ˜¯åŒä¸€ç¾¤ç»„çš„æˆå‘˜ï¼Œéƒ½å¯ä»¥åœ¨è¿™ä¸ªç›®å½•ä¸­åˆ›å»ºæ–‡ä»¶ã€‚</p></li><li><p>é€šå¸¸ä¼šå¯¹ç›®å½•åŒæ—¶è®¾ç½®stickyå’Œsgidè¿™ä¸¤ä¸ªç‰¹æ®Šæƒé™ä»¥æ–¹ä¾¿é¡¹ç›®çš„ç®¡ç†ï¼ˆå°†åŒä¸€ä¸ªé¡¹ç›®çš„æ–‡ä»¶éƒ½æ”¾åˆ°è¿™ä¸€ä¸ªç›®å½•ä¸­ä»¥æ–¹ä¾¿åŒä¸€é¡¹ç›®çš„æˆå‘˜ä¹‹é—´å…±äº«ä¿¡æ¯ï¼‰ã€‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-2.2-ç¾¤ç»„</title>
      <link href="/2016/12/23/Linux/linux-2-2-Group/"/>
      <url>/2016/12/23/Linux/linux-2-2-Group/</url>
      
        <content type="html"><![CDATA[<h1 id="ç¾¤ç»„ï¼ˆGroupï¼‰"><a href="#ç¾¤ç»„ï¼ˆGroupï¼‰" class="headerlink" title="ç¾¤ç»„ï¼ˆGroupï¼‰"></a>ç¾¤ç»„ï¼ˆGroupï¼‰</h1><ul><li><p>Linuxç¾¤ç»„çš„<strong>ç‰¹æ€§</strong>ï¼š</p></li><li><p>Linuxç³»ç»Ÿä¸­ï¼Œæ¯ä¸€ä¸ª<strong>ç”¨æˆ·</strong>éƒ½ä¸€å®š<strong>éš¶å±äº</strong>è‡³å°‘ä¸€ä¸ª<strong>ç¾¤ç»„</strong>ï¼Œè€Œæ¯ä¸€ä¸ªç¾¤ç»„éƒ½æœ‰ä¸€ä¸ªgroupæ ‡è¯†ç¬¦ï¼ˆå·ç ï¼‰ï¼Œå³gidã€‚</p></li><li><p>æ‰€æœ‰çš„ç¾¤ç»„å’Œå¯¹åº”çš„gidséƒ½å­˜æ”¾åœ¨_<u>/etc/group</u>_æ–‡ä»¶ä¸­ã€‚</p></li><li><p>Linuxç³»ç»Ÿåœ¨<strong>åˆ›å»ºç”¨æˆ·æ—¶</strong>ä¸ºæ¯ä¸€ä¸ªç”¨æˆ·<strong>åˆ›å»º</strong>ä¸€ä¸ª<strong>åŒåçš„ç¾¤ç»„</strong>å¹¶ä¸”æŠŠè¿™ä¸ªç”¨æˆ·åŠ å…¥åˆ°è¯¥ç¾¤ç»„ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªç”¨æˆ·è‡³å°‘ä¼šåŠ å…¥ä¸€ä¸ªä¸ä»–åŒåçš„ç¾¤ç»„ä¸­ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥åŠ å…¥åˆ°å…¶ä»–çš„ç¾¤ç»„ä¸­ã€‚åŠ å…¥åˆ°å…¶ä»–ç¾¤ç»„çš„ç›®çš„æ˜¯ä¸ºäº†è·å–é€‚å½“çš„æƒé™æ¥è®¿é—®ï¼ˆå­˜å–ï¼‰ç‰¹å®šçš„èµ„æºã€‚</p></li><li><p>å¦‚æœæœ‰ä¸€ä¸ªæ–‡ä»¶å±äºæŸä¸ªç¾¤ç»„ï¼Œé‚£ä¹ˆè¿™ä¸ªç¾¤ç»„ä¸­æ‰€æœ‰çš„ç”¨æˆ·éƒ½å¯ä»¥å­˜å–è¿™ä¸ªæ–‡ä»¶ã€‚</p></li><li><p><span style="color: #fd0404;"><span style="color: rgb(253, 4, 4);"><strong>group</strong></span></span>æ–‡ä»¶</p></li></ul><p><strong><em>/etc/group</em></strong> ä¿å­˜ç€ç¾¤ç»„ä¿¡æ¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;groupçš„å†…å®¹ï¼š</span><br><span class="line"></span><br><span class="line"> e.g.| foobar **:   **x   **: **503 **: **foo**,**bar</span><br><span class="line"></span><br><span class="line">means| ç¾¤ç»„å  **: **å¯†ç å¦ **: **gid **: **ç¾¤ç»„æˆå‘˜</span><br></pre></td></tr></table></figure><pre><code>    # ç¬¬äºŒå­—æ®µä¸ºxè¡¨ç¤ºè¿™ä¸ªç¾¤ç»„åœ¨ç™»å½•Linuxæ—¶å¿…é¡»ä½¿ç”¨å¯†ç ã€‚</code></pre><ul><li><span style="color: rgb(253, 4, 4);"><strong>gshadow</strong></span>æ–‡ä»¶</li></ul><p><strong>_/etc/gshadow _</strong>ä¿å­˜ç€ç¾¤ç»„ä¿¡æ¯ã€‚</p><p>[âš ï¸]æ™®é€šç”¨æˆ·æ— æƒè®¿é—®<em><u>/etc/gshadow</u></em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># more &#x2F;etc&#x2F;gshadow</span><br><span class="line"></span><br><span class="line">root:::root            # åœ¨gshadowä¸­ï¼Œæ¯ä¸ªç¾¤ç»„å ä¸€è¡Œè®°å½•</span><br><span class="line"></span><br><span class="line">bin:::root,bin,daemon ......</span><br><span class="line"></span><br><span class="line">foo:!::</span><br><span class="line"></span><br><span class="line">bar:!::</span><br><span class="line"></span><br><span class="line">ç¾¤ç»„å:åŠ å¯†åçš„å¯†ç ::</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-2.1-ç”¨æˆ·</title>
      <link href="/2016/12/22/Linux/linux-2-1-User/"/>
      <url>/2016/12/22/Linux/linux-2-1-User/</url>
      
        <content type="html"><![CDATA[<h1 id="ç”¨æˆ·ï¼ˆUserï¼‰"><a href="#ç”¨æˆ·ï¼ˆUserï¼‰" class="headerlink" title="ç”¨æˆ·ï¼ˆUserï¼‰"></a>ç”¨æˆ·ï¼ˆUserï¼‰</h1><ul><li><p>ç”¨æˆ·ï¼ˆUsersï¼‰</p></li><li><p>ç³»ç»Ÿä¸­çš„æ¯ä¸€ä¸ª<strong>ç”¨æˆ·</strong>éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„<strong>ç”¨æˆ·æ ‡è¯†ç¬¦</strong>ï¼ˆå·ç ï¼‰ï¼Œå³<strong>uid</strong>ï¼ˆuser identifierï¼‰</p></li></ul><p>ï¼ˆ<em>uid 0</em> ä¸º <code>root</code> ç”¨æˆ·çš„æ ‡è¯†ç¬¦ã€‚ï¼‰</p><ul><li><p>æ‰€æœ‰çš„ç”¨æˆ·åå’Œ_ç”¨æˆ·æ ‡è¯†ç¬¦_éƒ½è¢«å­˜æ”¾åœ¨ <code>/etc/passwd</code> æ–‡ä»¶ä¸­ã€‚</p></li><li><p>åœ¨ <em>passwd</em> æ–‡ä»¶ä¸­è¿˜å­˜æ”¾äº†æ¯ä¸ªç”¨æˆ·çš„å®¶ç›®å½•ï¼Œä»¥åŠè¯¥ç”¨æˆ·ç™»å½•åç¬¬ä¸€ä¸ªæ‰§è¡Œçš„ç¨‹åº</p></li></ul><p>ï¼ˆé€šå¸¸æ˜¯ shellï¼Œåœ¨ Linux ç³»ç»Ÿä¸­é»˜è®¤æ˜¯ bashã€‚ï¼‰</p><ul><li><p>å¦‚æœæ²¡æœ‰ç›¸åº”çš„æƒé™å°±ä¸èƒ½<strong>è¯»ã€å†™æˆ–æ‰§è¡Œ</strong>å…¶ä»–ç”¨æˆ·çš„æ–‡ä»¶ã€‚</p></li><li><p>passwd æ–‡ä»¶ï¼šç”¨æˆ·ä¿¡æ¯æ•°æ®åº“</p></li></ul><p><em><u>/etc/passwd</u></em> å‚¨å­˜ç”¨æˆ·ä¿¡æ¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;passwd çš„å†…å®¹ï¼š</span><br><span class="line">e.g|  exp :  x  :     500    :       500     :Example_User:&#x2F;home&#x2F;exp :   &#x2F;bin&#x2F;bash</span><br><span class="line">è¯´æ˜| ç”¨æˆ·å:å¯†ç å¦:uidï¼ˆç”¨æˆ·IDï¼‰:gidï¼ˆæ‰€å±ç¾¤ç»„IDï¼‰:   æ³¨é‡Šä¿¡æ¯  :   å®¶ç›®å½•  :å¯åŠ¨åç¬¬ä¸€ä¸ªæ‰§è¡Œç¨‹åº</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…³äºç¬¬äºŒä¸ªå­—æ®µï¼šå¦‚æœæ˜¯<strong>x</strong>ï¼Œè¡¨ç¤ºè¿™ä¸ªç”¨æˆ·ç™»å½•Linuxç³»ç»Ÿæ—¶å¿…é¡»ä½¿ç”¨å¯†ç ï¼Œå¦‚æœä¸º<strong>ç©º</strong>åˆ™è¯¥ç”¨æˆ·åœ¨ç™»å½•ç³»ç»Ÿæ—¶æ— é¡»æä¾›å¯†ç ã€‚</p><ul><li>shadowæ–‡ä»¶ï¼šç”¨æˆ·å¯†ç æ•°æ®åº“</li></ul><p>[âš ï¸]æ™®é€šç”¨æˆ·æ— æƒè®¿é—®<em><u>/etc/shadow</u></em></p><p><em><u>/etc/shadow</u></em> å‚¨å­˜ç”¨æˆ·å¯†ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;shadow çš„å†…å®¹ï¼š</span><br><span class="line">e.g|  exp :$1$wg...w4:14561:0:99999:7:::</span><br><span class="line">è¯´æ˜| ç”¨æˆ·å:   å¯†ç    :      :      :  :::</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…³äºç¬¬äºŒä¸ªå­—æ®µï¼šç¬¬2åˆ—æ˜¯å¯†ç ï¼Œè¿™ä¸ªå¯†ç æ˜¯ç»è¿‡MD5åŠ å¯†ç®—æ³•åŠ å¯†è¿‡çš„å¯†ç ã€‚</p><ul><li><p>å¦‚æœè¯¥åˆ—ä»¥$1$å¼€å¤´ï¼Œåˆ™è¡¨ç¤ºè¿™ä¸ªç”¨æˆ·å·²ç»è®¾å®šäº†å¯†ç ã€‚<br>  ï¼ˆåŒ…æ‹¬æ‰‹åŠ¨æŠŠpasswdä¸­çš„xå»æ‰ï¼Œä¸ç”¨å¯†ç å³å¯ç™»å½•çš„â€œç©ºç§˜å¯†â€ï¼‰</p></li><li><p>å¦‚æœè¯¥åˆ—ä»¥!!å¼€å¤´ï¼Œåˆ™è¡¨ç¤ºè¿™ä¸ªç”¨æˆ·è¿˜æ²¡æœ‰è®¾å®šå¯†ç ã€‚<br>  ï¼ˆæ–°å»ºå<strong>passwd -S</strong>æ˜¾ç¤º_Password locked_çš„çŠ¶æ€ï¼Œè¿™ç§ç”¨æˆ·ä¸å¯ç™»å½•ï¼‰</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-2.0-ç”¨æˆ·ç®¡ç†</title>
      <link href="/2016/12/21/Linux/linux-2-0-UsersManage/"/>
      <url>/2016/12/21/Linux/linux-2-0-UsersManage/</url>
      
        <content type="html"><![CDATA[<h1 id="ç”¨æˆ·ç®¡ç†"><a href="#ç”¨æˆ·ç®¡ç†" class="headerlink" title="ç”¨æˆ·ç®¡ç†"></a>ç”¨æˆ·ç®¡ç†</h1><ul><li><code>su</code>ï¼šåˆ‡æ¢ç”¨æˆ·</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ su [-]ç”¨æˆ·å</span><br><span class="line">    -   ï¼šæœ‰åˆ™é‡å¯shellï¼Œé‡è£…$PATHï¼ˆç¯å¢ƒå˜é‡ï¼‰ï¼Œpwdåˆ‡æ¢è‡³ç”¨æˆ·åçš„$HOMEï¼ˆå®¶ç›®å½•ï¼‰</span><br><span class="line">         æ— åˆ™ä¸å˜ ç¯å¢ƒå˜é‡ï¼ˆæ£€ç´¢å‘½ä»¤çš„ç›®å½•ï¼‰ï¼Œpwdä¸å˜</span><br></pre></td></tr></table></figure><p>ç”¨æˆ·å ï¼šç¼ºçœä¸º root</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[me@Example ~]$ su - root</span><br><span class="line">å¯†ç ï¼š</span><br><span class="line">[root@Example~]# whoami</span><br><span class="line">root</span><br><span class="line">[root@Example~]# exit</span><br><span class="line">logout</span><br><span class="line">[me@Example~]$ whoami</span><br><span class="line">me</span><br></pre></td></tr></table></figure><ul><li><code>passwd</code>ï¼šä¿®æ”¹å¯†ç </li></ul><p>1âƒ£ï¸ <em>æ™®é€šç”¨æˆ·ï¼š</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ passwd            ä¿®æ”¹å½“å‰ç”¨æˆ·å¯†ç </span><br></pre></td></tr></table></figure><p>å¤šæŒ‰å‡ ä¸ªå›è½¦å¯å–æ¶ˆé€€å‡º</p><p>å¯¹äºroot â€œtoo shortâ€çš„å¯†ç é‡è¾“ä¹Ÿå¯ä»¥æˆåŠŸ</p><p>2âƒ£ï¸ <em>rootï¼š</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># passwd username    ä¿®æ”¹æŸç”¨æˆ·å¯†ç </span><br><span class="line"># passwd -S username    æŸ¥çœ‹å¯†ç çŠ¶æ€ï¼Œã€æ³¨æ„ã€‘Så¤§å†™</span><br></pre></td></tr></table></figure><ul><li>æ–°å»ºï¼Œåˆ é™¤ ç”¨æˆ·</li></ul><ol><li>useraddï¼šæ–°å»ºç”¨æˆ·ï¼š<code># useradd new_user_name</code></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@Example ~]# useradd newone</span><br><span class="line">[root@Example ~]# passwd -S newone</span><br><span class="line">newone LK [2016-12-18 0 99999 7 -1](tel:2016-12-18 0 99999 7 -1)(å¯†ç å·²è¢«é”å®šã€‚)       # è¯´æ˜å¯†ç æœªè®¾å®š</span><br><span class="line">[root@Example ~]# passwd newone</span><br><span class="line">æ›´æ”¹ç”¨æˆ· newone çš„å¯†ç  ã€‚</span><br><span class="line">æ–°çš„ å¯†ç ï¼š             # å°è¯•é”®å…¥ä¸€ä¸ªå¼±å£ä»¤</span><br><span class="line">æ— æ•ˆçš„å¯†ç :  è¿‡äºç®€å•åŒ–&#x2F;ç³»ç»ŸåŒ–        # æç¤ºå£ä»¤è¿‡äºç®€å•ï¼Œä½†ä¸é˜»æ­¢</span><br><span class="line">é‡æ–°è¾“å…¥æ–°çš„ å¯†ç :                   # ä»è¾“å…¥é‚£ä¸ªå¼±å£ä»¤ï¼Œå¯ä»¥æˆåŠŸï¼Œå› ä¸ºæ˜¯root</span><br><span class="line">passwdï¼š æ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚</span><br><span class="line"># å¦‚æœæ˜¯æ™®é€šç”¨æˆ·ï¼Œé”®å…¥å¼±å£ä»¤ä¸å¯æˆã€‚ï¼ˆä¸ä¼šå«â€œRetypeâ€œï¼Œè€Œæ˜¯â€œNewâ€œï¼‰</span><br><span class="line">[root@Example ~]# passwd -S newone</span><br><span class="line">newone PS [2016-12-18 0 99999 7 -1](tel:2016-12-18 0 99999 7 -1)(å¯†ç å·²è®¾ç½®ï¼Œä½¿ç”¨ SHA512 åŠ å¯†ã€‚</span><br></pre></td></tr></table></figure><ol start="2"><li>userdelï¼šåˆ é™¤ç”¨æˆ·:  <code>userdel [-r] [-f] user_name</code></li></ol><p>â€‹                <code>-r</code> ï¼šåŒæ—¶åˆ é™¤ç”¨æˆ·çš„å®¶ç›®å½•</p><p>â€‹                        æ— â€™-râ€™æ—¶ï¼Œå®¶ç›®å½•ä¸ä¼šè¢«åˆ é™¤</p><p>â€‹                <code>-f</code> ï¼šå¼ºè¡Œåˆ é™¤ï¼Œå“ªæ€•ç”¨æˆ·å·²ç™»å½•ï¼Œè¿™ä¸ªé€‰é¡¹æœ‰äº›å±é™©ï¼Œä¼šä½¿ç³»ç»Ÿè¿›å…¥ä¸ä¸€è‡´çŠ¶æ€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@Example ~]# userdel -r newone</span><br><span class="line">userdel: user newone is currently used by process 3848    # ç”¨æˆ·æ­£ç™»å½•ï¼Œåˆ é™¤å¤±è´¥</span><br><span class="line">[root@Example ~]# userdel -fr newone                        #ç”¨ -f å¼ºè¡Œåˆ é™¤</span><br><span class="line">userdel: user newone is currently used by process 3848    # è¯´æ˜ç”¨æˆ·æ­£ç™»å½•ï¼Œä½†å‘½ä»¤æœ¬èº«å·²ç»æˆåŠŸ</span><br><span class="line"># è¿™æ—¶è™½ç„¶è¿˜è¢«åˆ userè¿˜æ˜¯ç™»å…¥ã€æ´»è·ƒçŠ¶æ€ï¼Œä½†å·²ç»è¢«åˆ é™¤ï¼Œç™»å‡ºåä¸å¯å†ç™»å…¥</span><br><span class="line"></span><br><span class="line">--------------------</span><br><span class="line"></span><br><span class="line">[newone@Example ~]$ exit                                    #é€€å‡ºç”¨æˆ·</span><br><span class="line">logout</span><br><span class="line"></span><br><span class="line">--------------------</span><br><span class="line"></span><br><span class="line">[root@Example ~]# userdel -r newone</span><br><span class="line">userdelï¼šç”¨æˆ·â€œnewoneâ€ä¸å­˜åœ¨                            #å†ä½œå°è¯•æ—¶ï¼Œç¡®å®šç”¨æˆ·å·²è¢«ä¹‹å‰çš„ -f åˆ é™¤</span><br><span class="line">[root@Example ~]# ls &#x2F;home</span><br><span class="line">c  lost+found                                        #å®¶ç›®å½•è¢« -r åˆ é™¤</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š</p><p><a href="https://www.linuxidc.com/Linux/2016-05/131755.htm">https://www.linuxidc.com/Linux/2016-05/131755.htm</a></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-1.2-å¸®åŠ©ä¿¡æ¯</title>
      <link href="/2016/12/20/Linux/linux-1-2-getHelp/"/>
      <url>/2016/12/20/Linux/linux-1-2-getHelp/</url>
      
        <content type="html"><![CDATA[<h1 id="å¸®åŠ©ä¿¡æ¯"><a href="#å¸®åŠ©ä¿¡æ¯" class="headerlink" title="å¸®åŠ©ä¿¡æ¯"></a>å¸®åŠ©ä¿¡æ¯</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ whatis *å‘½ä»¤å*</span><br></pre></td></tr></table></figure><p>â€‹                è¯´æ˜<em>å‘½ä»¤</em>æ˜¯ä»€ä¹ˆï¼Œäº†è§£å‘½ä»¤çš„åŠŸèƒ½ï¼›</p><p>â€‹                â€œwhatis  <em>cmd</em>â€å‘½ä»¤ == â€œ<strong>man -f</strong> <em>cmd</em>â€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ type [-options] å‘½ä»¤å</span><br></pre></td></tr></table></figure><p>â€‹    æ— é€‰ï¼šæ˜¾ç¤ºå‘½ä»¤ç±»å‹</p><p>â€‹    <code>-t</code>ï¼šæ˜¾ç¤ºæ–‡ä»¶çš„ç±»å‹ï¼š</p><p>â€‹        <code>file</code>ï¼šå¤–éƒ¨å‘½ä»¤</p><p>â€‹        <code>alias</code>ï¼šåˆ«å</p><p>â€‹        <code>builtin</code>ï¼šshellå†…ç½®å‘½ä»¤</p><p>â€‹    <code>-a</code>ï¼šåˆ—å‡ºæ‰€æœ‰åŒ…å«æŒ‡å®šå‘½ä»¤åçš„å‘½ä»¤ï¼ŒåŒ…æ‹¬åˆ«å</p><p>â€‹    <code>-p</code>ï¼šæ˜¾ç¤ºå®Œæ•´çš„æ–‡ä»¶åï¼ˆå¤–éƒ¨å‘½ä»¤ï¼‰æˆ–å†…éƒ¨å‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ which å‘½ä»¤å</span><br></pre></td></tr></table></figure><p>â€‹    åˆ—å‡ºå‘½ä»¤çš„ç±»å‹ç›¸å…³çš„ä¿¡æ¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ *å‘½ä»¤å* --help</span><br></pre></td></tr></table></figure><p>â€‹                æ˜¾ç¤º<em>å‘½ä»¤</em>çš„<strong>ç®€è¦è¯´æ˜</strong>å’Œ<strong>é€‰é¡¹åˆ—è¡¨</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ man *å‘½ä»¤å*</span><br></pre></td></tr></table></figure><p>â€‹                æµè§ˆ<em>å‘½ä»¤</em>çš„ <strong>Man Page</strong> 1âƒ£ï¸</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ man -k **keyword**</span><br></pre></td></tr></table></figure><p>â€‹                æ¬²ä½¿ç”¨ä¸€ä¸ªå‘½ä»¤ï¼Œåˆæ— æ³•ç¡®å®šå®ƒçš„åå­—æ˜¯ç”¨ -ké€‰é¡¹+<em>å…³é”®å­—</em>æœå¯»å®ƒï¼›</p><p>â€‹                â€œman -k  <em>kw</em>â€å‘½ä»¤ == â€œ<strong>apropos</strong> <em>kw</em>â€å‘½ä»¤ï¼›</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ info *cmd*</span><br></pre></td></tr></table></figure><p>â€‹                â€œinfo2âƒ£ï¸â€ä¸â€œmanâ€ç±»ä¼¼ï¼Œä½†infoæ›´åŠ ç®€æ´è¯¦å°½(å¼€å‘è€…è®¤ä¸ºçš„)ï¼›</p><p>1âƒ£ï¸ã€2âƒ£ï¸.  æµè§ˆ <strong>Man page</strong> <em>æˆ–</em>  <strong>Info Page</strong> ï¼š</p><ul><li><ul><li><p>ä½¿ç”¨man \ infoå‘½ä»¤è¿›å…¥Man \ Info Page</p></li><li><p>é”®ç›˜ &lt; , &gt; , ^, v , PgUp, PgDn, ç©ºæ ¼ï¼šç¿»é¡µ</p></li><li><p>Homeé”®ï¼šç§»åˆ°ç¬¬ä¸€é¡µ</p></li><li><p>Endé”®ï¼š æœ€åä¸€é¡µ</p></li><li><p>åœ¨å±å¹•åº•éƒ¨<code>: </code>å¤„è¾“å…¥<code>?string</code>ï¼šå‘å‰æœç´¢string</p></li><li><ul><li>æŒ‰ n é”®ç»§ç»­ä¸‹ä¸€ä¸ªæœç´¢</li><li>æŒ‰ N é”®è¿›è¡Œåå‘æœç´¢</li></ul></li><li><p>æŒ‰ q é”®é€€å‡ºPage</p></li></ul></li></ul><p>åœ¨ <strong>Info Page</strong> ä¸­è¿˜æœ‰ï¼š</p><ul><li><ul><li>æŒ‰Tabï¼šè·³åˆ°ä¸‹ä¸€ä¸ªâ€œ*<strong>**</strong>â€ï¼ˆè¶…é“¾æ¥ï¼‰</li><li>{Tab}*3ï¼šIndex</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-1.1-ç³»ç»Ÿä¿¡æ¯</title>
      <link href="/2016/12/19/Linux/linux-1-1-SystemInformation/"/>
      <url>/2016/12/19/Linux/linux-1-1-SystemInformation/</url>
      
        <content type="html"><![CDATA[<h1 id="ç³»ç»Ÿä¿¡æ¯"><a href="#ç³»ç»Ÿä¿¡æ¯" class="headerlink" title="ç³»ç»Ÿä¿¡æ¯"></a>ç³»ç»Ÿä¿¡æ¯</h1><ul><li><p><code>uname</code> å‘½ä»¤:  è·å–ç³»ç»Ÿä¿¡æ¯<br>(å…¶ä¸­â€™uâ€™ä»£è¡¨UNIX)</p></li><li><p><code>$ uname</code>       æ˜¾ç¤ºå½“å‰æ“ä½œç³»ç»Ÿ</p><pre><code>  `-n`    æ˜¾ç¤ºä¸»æœºå  `-i`    ç¡¬ä»¶å¹³å°å  `-r`    ç³»ç»Ÿå‘å¸ƒç‰ˆæœ¬ä¿¡æ¯  `-s`    ç³»ç»Ÿå  `-m`    æœºå™¨ç¡¬ä»¶å  `-p`    æ˜¾ç¤ºCPUä¿¡æ¯  `-a`    ä»¥ä¸Šå…¨éƒ¨</code></pre><p>ç”¨ <code>-n -r</code> == <code>-i -n</code> == <code>-ni</code> == <code>-in</code>ï¼›<br>(è¯¦è§ <code>$ man uname</code>ã€‚)</p></li><li><p><code>$ date</code>       æ˜¾ç¤ºå½“å‰ç³»ç»Ÿæ—¥æœŸã€æ—¶é—´</p></li><li><p><code>$ cal</code>         æ˜¾ç¤ºæ—¥å†ï¼š</p><ul><li><p><code>$ cal</code>         æ— å‚æ˜¾ç¤ºæœ¬æœˆæ—¥å†</p></li><li><p><code>$ cal m y</code>    m yæ˜¯æœˆä»½ å¹´ä»½ï¼Œæ˜¾ç¤ºyå¹´mæœˆçš„</p></li><li><p><code>$ cal y</code>      y æ˜¯å¹´ä»½ï¼Œ     æ˜¾ç¤ºyå…¨å¹´</p><p>(è¯¦è§ <code>$ man cal</code>ã€‚)</p></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-1.0-ç”¨æˆ·ä¿¡æ¯</title>
      <link href="/2016/12/18/Linux/linux-1-0-UsersInfomation/"/>
      <url>/2016/12/18/Linux/linux-1-0-UsersInfomation/</url>
      
        <content type="html"><![CDATA[<h1 id="ç”¨æˆ·ä¿¡æ¯"><a href="#ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="ç”¨æˆ·ä¿¡æ¯"></a>ç”¨æˆ·ä¿¡æ¯</h1><ul><li><code>$ whoami</code><br>è¾“å‡ºå½“å‰ç”¨æˆ·å</li><li><code>$ users</code><br>åˆ—å‡ºå½“å‰ç™»å½•çš„æ‰€æœ‰ç”¨æˆ·å</li><li><code>$ who am i</code><br>æ˜¾ç¤ºç”¨æˆ·åï¼Œç™»å½•ç»ˆç«¯ï¼Œå½“å‰æ—¶é—´ï¼ŒIP</li><li><code>$ who</code><br>æ¯”â€œwho am iâ€å¤šå‡º å…¶ä»–ç”¨æˆ·çš„ä¿¡æ¯</li><li><code>$ w</code><br>ä¿¡æ¯æ›´å¤šçš„â€œwhoâ€ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[Me@Example ~]$ w</span><br><span class="line"> 10:59:09 up 4 min,  1 user,  load average:  0.46 , 0.35 ,  0.15</span><br><span class="line"> å½“å‰æ—¶é—´ up å¯åŠ¨æ—¶é•¿, ç™»å½•ç”¨æˆ·æ•°, å¹³å‡æäº¤ä»»åŠ¡æ•°: 1minå†…, 10minå†…, 15minå†…</span><br><span class="line">USER     TTY      FROM              LOGIN@    IDLE       JCPU       PCPU     WHAT</span><br><span class="line">ç”¨æˆ·å    ç™»å½•ç»ˆç«¯   ç™»å½•åœ°            ç™»å½•æ—¶é—´   ç©ºé—²æ—¶é•¿    ä¸€å…±ä½¿ç”¨CPUæ—¶é•¿    å½“å‰ç¨‹åºç”¨CPUæ—¶é•¿    å½“å‰ä»»åŠ¡CPUæ—¶é•¿</span><br><span class="line">                                                        </span><br><span class="line">Me        pts&#x2F;0    MyComputer       10:58     0.00s      0.06s      0.02s     w</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-0.2-ç³»ç»Ÿå¼€å…³</title>
      <link href="/2016/12/17/Linux/linux-0-2-StartHalt/"/>
      <url>/2016/12/17/Linux/linux-0-2-StartHalt/</url>
      
        <content type="html"><![CDATA[<h1 id="ç³»ç»Ÿå¼€å…³"><a href="#ç³»ç»Ÿå¼€å…³" class="headerlink" title="ç³»ç»Ÿå¼€å…³"></a>ç³»ç»Ÿå¼€å…³</h1><ul><li>å…³é—­ç³»ç»Ÿï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># sync</span><br><span class="line"># init 0    æˆ–    shutdown -n    æˆ–    halt</span><br></pre></td></tr></table></figure><ul><li>é‡å¯ç³»ç»Ÿï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># sync</span><br><span class="line"># init 6    æˆ–    shutdown -rn</span><br></pre></td></tr></table></figure><ul><li>é€€å‡ºå½“å‰ç”¨æˆ·ç™»å½•ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ exit</span><br></pre></td></tr></table></figure><p>Linuxçš„ <code>exit</code> ç±»ä¼¼äº Windows çš„æ³¨é”€ï¼›</p><ul><li>æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„è™šæ‹Ÿç»ˆç«¯ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ tty</span><br><span class="line">&#x2F;dev&#x2F;tty2        #äºŒå·è™šæ‹Ÿç»ˆç«¯</span><br></pre></td></tr></table></figure><ul><li>åˆ‡æ¢ç»ˆç«¯ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;Ctr + Alt + Fn&#125;</span><br><span class="line">#å…¶ä¸­ n &#x3D; &#123;1, 2, 3, ... ,7&#125;,ä»£è¡¨ tty n</span><br></pre></td></tr></table></figure><p>åˆ‡æ¢è‡³å›¾å½¢ç»ˆç«¯ï¼ˆä¹Ÿæ˜¯ä¸€ä¸ªttyï¼‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;Ctr + Alt + F7&#125;</span><br></pre></td></tr></table></figure><ul><li>æ¸…ç©ºå±å¹•ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ clear</span><br></pre></td></tr></table></figure><ul><li>æ‰¾åˆ°ç³»ç»Ÿä¸­æ‰€æœ‰shellï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cat &#x2F;etc&#x2F;shells</span><br></pre></td></tr></table></figure><ul><li>åˆ‡æ¢shellï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sh# åˆ‡æ¢è‡³Bourn Shell</span><br><span class="line">$ ksh# åˆ‡æ¢è‡³Korn Shell</span><br></pre></td></tr></table></figure><p>å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„å‘½ä»¤ï¼ˆå¦‚<code>OK</code>ï¼‰ï¼Œä»¥ç¡®å®šç”¨æˆ·å½“å‰çš„shellã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-0.1-ç³»ç»Ÿå®‰è£…</title>
      <link href="/2016/12/16/Linux/linux-0-1-Install/"/>
      <url>/2016/12/16/Linux/linux-0-1-Install/</url>
      
        <content type="html"><![CDATA[<h1 id="ç³»ç»Ÿå®‰è£…"><a href="#ç³»ç»Ÿå®‰è£…" class="headerlink" title="ç³»ç»Ÿå®‰è£…"></a>ç³»ç»Ÿå®‰è£…</h1><h3 id="æŒ‚è½½å»ºè®®ï¼š"><a href="#æŒ‚è½½å»ºè®®ï¼š" class="headerlink" title="æŒ‚è½½å»ºè®®ï¼š"></a>æŒ‚è½½å»ºè®®ï¼š</h3><p>Linuxåªè¦æ±‚ä¸¤ä¸ªåŸºæœ¬åˆ†åŒº <code>ï¼</code> å’Œ <code>swap</code>ï¼› </p><p>å¦‚æœ<code>ï¼</code>è¶³å¤Ÿçš„ï¼Œå¯ä»¥åœ¨æ¡Œé¢æ”¾å¾ˆå¤šä¸œè¥¿è€Œä¸å½±å“è¿›å…¥ Linux çš„é€Ÿåº¦ï¼› </p><table><thead><tr><th>åˆ†åŒº</th><th>å¤§å°</th><th>æ ¼å¼</th></tr></thead><tbody><tr><td>/boot1âƒ£ï¸</td><td>128MB</td><td>ext3</td></tr><tr><td>swap</td><td>2âƒ£ï¸</td><td></td></tr><tr><td>ï¼</td><td>8GB</td><td>ext3</td></tr><tr><td>ï¼home</td><td>ä½™ä¸‹å…¨éƒ¨</td><td>ext3</td></tr></tbody></table><p>è‹¥è¦å®‰è£…å¾ˆå¤šè½¯ä»¶æœ€å¥½åˆ†é…ä¸ª <code>/usr</code>ï¼› </p><p>è‹¥è¦ä½œæœåŠ¡å™¨æœ€å¥½åˆ†é…è¾ƒå¤§çš„ <code>/var</code>ï¼› </p><p>1âƒ£ï¸.  <code>/boot</code>ï¼š </p><p>2018å¹´åçš„æ–°ç‰ˆæœ¬éƒ½å¯ä»¥ä¸åˆ†ï¼› </p><p>å¯ä»¥åˆ†é…10MB-100MB </p><p>å¦‚æœç¡¬ç›˜ä¸æ”¯æŒLBAæ¨¡å¼ï¼Œæœ€å¥½æŒ‚è½½/bootäºç¬¬ä¸€ä¸ªåˆ†åŒºï¼Œä»¥ä¿ç¨³å¦¥ã€‚ </p><p>å‚è€ƒï¼š<a href="https://wapbaike.baidu.com/item/boot%E5%88%86%E5%8C%BA/16830421?ms=1&rid=8645769021174590193">https://wapbaike.baidu.com/item/bootåˆ†åŒº/16830421?ms=1&amp;rid=8645769021174590193</a></p><p>2âƒ£ï¸. <code>swap</code>ï¼š </p><p><img src="http://ww1.sinaimg.cn/large/006tNc79gy1g60bdmoskaj30d108xglx.jpg" alt="Image 20180817 230902"></p><table><thead><tr><th>ç‰©ç†å†…å­˜</th><th>swap</th><th>swap(å¼€å¯ä¼‘çœ )</th></tr></thead><tbody><tr><td>2GB</td><td>2å€RAM</td><td>3å€RAM</td></tr><tr><td>&gt;2GB-8GB</td><td>=RAM</td><td>2å€RAM</td></tr><tr><td>&gt;8GB-64GB</td><td>4GB+</td><td>1.5å€RAM</td></tr><tr><td>&gt;64GB</td><td>4GB+</td><td>ä¸å»ºè®®ä¼‘çœ </td></tr></tbody></table><p>å‚è€ƒï¼š<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/installation_guide/s2-diskpartrecommend-ppc#id4394007">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/installation_guide/s2-diskpartrecommend-ppc#id4394007</a> </p><p>å¼€å§‹çš„å‡ ä¸ªæœåŠ¡é…ç½®ï¼š</p><ul><li>æ£€æŸ¥<em>telnet</em>æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼š </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># chkconfig telnet --list</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨<em>telnet</em>æœåŠ¡ï¼š </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># chkonfig telnet on</span><br></pre></td></tr></table></figure><p>å¼€å¯telnetååœ¨winä¸‹å¯ç”¨â€&gt; telnet $IPâ€è¿æ¥Linuxã€‚ </p><ul><li>æ£€éªŒ<em>FTP</em>æœåŠ¡å½“å‰çŠ¶æ€ï¼š </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># service vsftpd status </span><br></pre></td></tr></table></figure><ul><li>å¼€å¯<em>FTP</em>æœåŠ¡ï¼š </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># service vsftpd start</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-0.0-Linux?</title>
      <link href="/2016/12/15/Linux/linux-0-0-Linux/"/>
      <url>/2016/12/15/Linux/linux-0-0-Linux/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘ä¼šå‘ä¸€ç³»åˆ— Linux å­¦ä¹ ç¬”è®°ï¼ˆå®ƒä»¬æœ€å¤šå¯ä»¥ç®—æ˜¯â€œæ“ä½œæ‰‹å†Œâ€ï¼Œæˆ‘ä¸è®¤ä¸ºå®ƒä»¬å¯ä»¥ä»£æ›¿ä¸€æœ¬æ­£ç»çš„å…¥é—¨ä¹¦ï¼‰ï¼Œè¿™äº›ä¸œè¥¿æ˜¯å¾ˆä¹…ä»¥å‰å†™çš„äº†ï¼Œå¯èƒ½åœ¨ æ’ç‰ˆã€å†…å®¹ ä¸Šè´¨é‡éƒ½ä¸é«˜ï¼Œè¯·è§è°…ã€‚</p><h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><blockquote><p>Linux (/ËˆlÉªnÉ™ks/ LIN-É™ks) is a family of open source Unix-like operating systems based on the Linux kernel, an operating system kernel first released on September 17, 1991 by Linus Torvalds. Linux is typically packaged in a Linux distribution.<br>ã€ç¿»è¯‘ã€‘Linux æ˜¯ä¸€ç³»åˆ—åŸºäº Linux å†…æ ¸(ä¸€ä¸ªæœ€æ—©ç”± Linus Torvalds åœ¨ 1991 å¹´ 9 æœˆ 17 æ—¥å‘å¸ƒçš„æ“ä½œç³»ç»Ÿå†…æ ¸)çš„ç±» Unix å¼€æºæ“ä½œç³»ç»Ÿã€‚Linux é€šå¸¸æ‰“åŒ…åœ¨ Linux å‘è¡Œç‰ˆä¸­ã€‚</p></blockquote><p>ğŸ‘†è¿™æ˜¯ <a href="https://en.wikipedia.org/wiki/Linux">ç»´åŸºç™¾ç§‘</a> å¯¹ Linux çš„ä»‹ç»ã€‚</p><p>Linux æ˜¯ä»€ä¹ˆä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯ä¸ºä»€ä¹ˆç”¨Linuxã€‚å°±åƒå¯¹ç”¨æˆ·æ¥è¯´è½¯ä»¶çš„ä»£ç å®ç°ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯è¿™ä¸ªè½¯ä»¶å¯ä»¥ç”¨æ¥å¹²ä»€ä¹ˆã€‚</p><h2 id="ä¸ºä»€ä¹ˆç”¨-Linuxï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆç”¨-Linuxï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆç”¨ Linuxï¼Ÿ"></a>ä¸ºä»€ä¹ˆç”¨ Linuxï¼Ÿ</h2><p>æˆ‘ä»¬å¸¸è¯´ï¼Œç”¨ Linux æ˜¯å› ä¸ºå®ƒå®‰å…¨ï¼Œæˆ–è€…å› ä¸ºå®ƒè‡ªç”±ã€å› ä¸ºå®ƒçš„é«˜åº¦å¯å®šåˆ¶ã€å› ä¸ºå®ƒå…è´¹ã€å› ä¸ºå®ƒçš„èƒŒåæœ‰ä¸“ä¸šçš„ç¤¾åŒºæ”¯æŒâ€¦â€¦</p><p>ç„¶è€Œï¼Œæ‰€æœ‰çš„è¿™äº›å…¨æ˜¯çæ‰¯ï¼æˆ‘ä»¬è¯´è¿™ç§é¬¼è¯æ¥æ¬ºéª—é Linux ç”¨æˆ·ï¼Œåªå› ä»–ä»¬ä¸ä¼šæ‡‚å¾— Linux çš„çœŸè°›ã€‚<br>ä¹…è€Œä¹…ä¹‹ï¼Œè¯´çš„å¤šäº†ï¼Œæœ‰æ—¶å€™è¿æˆ‘ä»¬è‡ªå·±éƒ½å¼€å§‹ç›¸ä¿¡è¿™äº›ä¹±ä¸ƒå…«ç³Ÿçš„â€œå……åˆ†ç†ç”±â€äº†ã€‚</p><p>å¤œæ·±äººé™æ—¶å†æ‰ªå¿ƒè‡ªé—®ï¼Œæˆ‘ä»¬ç”¨ Linux çš„åŸå› åˆ°åº•ä½•åœ¨ï¼Ÿ</p><p>â€¦â€¦</p><p>æˆ‘ä»¬ç”¨ Linux â€”â€” â€”â€” æ˜¯å› ä¸ºå®ƒå¥½ç©å‘€ï¼</p><p>å¯¹ç€å„ç§è®¾ç½®ä¸€é˜µæ£é¼“ã€æŠŠç³»ç»Ÿæ— æƒ…åœ°ç©å¼„åˆ°å´©åï¼Œå†å¤¹ç€å°¾å·´è·‘åˆ°æ¢å¤ç³»ç»Ÿã€ç¬¨æ‹™åœ°ä¸ºå¥¹ç¼åˆä¼¤å£ã€è™”è¯šä¸ºå¥¹ç¥ˆç¥·ç—Šæ„ˆã€æœŸå¾…ç€ä¸‹ä¸€æ¬¡æŠŠå¥¹æ‘†å¸ƒæˆä¸ä¸€æ ·çš„å§¿åŠ¿ï¼Œè¿™éš¾é“ä¸å¥½ç©å—ï¼Ÿ<br>åœ¨é‚£æ•°ç™¾ç§å‘è¡Œç‰ˆä¸­è‚†æ„å°è¯•å¥¹ä»¬å„ä¸ç›¸åŒçš„å‘½ä»¤è¡Œä¸å¥½ç©å—ï¼Ÿ</p><p>æ˜¯çš„ï¼Œæˆ‘ä»¬è§‰å¾—å‘½ä»¤è¡Œè¶…çº§æœ‰è¶£ï¼</p><p>å…¶å® Linux çˆ±å¥½è€…ä»¬çˆ±ä¸Š Linuxï¼Œçˆ±çš„åªæ˜¯ Linux æœ¬èº«ï¼</p><p>æ˜¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ Linux å®Œæˆè€æ¿å¸ƒç½®çš„å·¥ä½œï¼›<br>æ˜¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ Linux ä¿éšœå®‰å…¨ã€è¿œç¦»ç—…æ¯’ï¼›<br>æ˜¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ Linux çœä¸‹å‡ ä¸ªæŸ´ç±³æ²¹ç›é’±ï¼›<br>ä½†ï¼Œè¿™äº›éƒ½åªæ˜¯æˆ‘ä»¬ä½¿ç”¨ Linux çš„å‰¯ä½œç”¨ï¼ </p><p>çœŸæ­£é‡è¦çš„æ˜¯ â€”â€” â€”â€” è¿™ç³»ç»Ÿå¥½ç©å•Šï¼</p><p>Linux è®©æˆ‘ä»¬åƒæ¢é™©å®¶ä¸€æ ·æ¸¸è¡åœ¨ç³»ç»Ÿæ·±å¤„ï¼Œå››å¤„æ…åˆï¼Œéšæ€§å‘æ˜ï¼Œåœ¨è½¯ä»¶çš„èƒŒåå¯»è§…å¯çˆ±çš„è¯—ç¯‡ï¼</p><p>ï¼ˆç¿»è¯‘è‡ªä¸€ç¯‡å‡ºå¤„éš¾å¯»çš„æ–‡ç« ï¼‰</p><h2 id="ç”¨-Linux-åšä»€ä¹ˆï¼Ÿ"><a href="#ç”¨-Linux-åšä»€ä¹ˆï¼Ÿ" class="headerlink" title="ç”¨ Linux åšä»€ä¹ˆï¼Ÿ"></a>ç”¨ Linux åšä»€ä¹ˆï¼Ÿ</h2><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬åˆ°åº•å¯ä»¥ç”¨ Linux å¹²ä»€ä¹ˆï¼Ÿ</p><p>æ¯«æ— ç–‘é—®â€”â€”<strong>ç©</strong>ï¼</p><h2 id="Linux-UNIXï¼ŒMacOSï¼ŒWindows"><a href="#Linux-UNIXï¼ŒMacOSï¼ŒWindows" class="headerlink" title="Linux/UNIXï¼ŒMacOSï¼ŒWindows"></a>Linux/UNIXï¼ŒMacOSï¼ŒWindows</h2><p>Linux/UNIXï¼ŒMacOSï¼ŒWindowsï¼Œè¿™å‡ ä¹å°±æ˜¯æˆ‘ä»¬å¹³æ—¶æ¥è§¦åˆ°çš„æ‰€æœ‰æ“ä½œç³»ç»Ÿäº†ã€‚</p><p>æŠ›å¼€åˆšæ‰å†™çš„é‚£ä¹ˆå¤š Linux çš„å¥½å¤„ä¸çœ‹ï¼Œå®¢è§‚åœ°æ¯”è¾ƒä¸€ä¸‹å®ƒä»¬ï¼š</p><ul><li><p>Linux/UNIX ä»¥è‡ªç”±è‘—ç§°ï¼Œä½†æ­£å¦‚å¾ˆå¤šå¼€æºçš„ä¸œè¥¿ï¼Œè®¾è®¡ä¸Šä¼šæœ‰ä¸€äº›ç¼ºé™·ï¼Œç”¨æˆ·ä½“éªŒç»å¯¹ä¸æ˜¯æœ€å¥½çš„ï¼Œä½†å®ƒå‡ ä¹å¯ä»¥æ»¡è¶³ä½ åœ¨è®¡ç®—æœºç¼–ç¨‹ã€å·¥ä½œä¸Šçš„å…¨éƒ¨éœ€æ±‚ï¼ˆåªæ˜¯æ“ä½œèµ·æ¥å¯èƒ½éœ€è¦æ—¶é—´ã€ç²¾åŠ›ï¼‰ã€‚å…¶å®åœ¨ Linux/UNIX çš„å†…éƒ¨æœ‰å¾ˆå¤šå¾ˆç³Ÿç³•çš„éƒ¨åˆ†ï¼Œè¿™æ˜¯å†å²é—ç•™é—®é¢˜äº†ï¼Œåœ¨å­¦ä¼š  Linux çš„åŸºç¡€ä¹‹å‰æˆ‘ä»¬æœ€å¥½ä¸å»è¿‡å¤šç ”ç©¶ã€‚</p></li><li><p>MacOSï¼Œè¿™æ˜¯æˆ‘ç°åœ¨æ—¥å¸¸ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿï¼ŒAppleä¸€å‘ä»¥ç”¨æˆ·ä½“éªŒè‘—ç§°ã€‚MacOSç»å¯¹æ˜¯æˆ‘ç”¨è¿‡çš„ä½“éªŒæœ€å¥½çš„è®¡ç®—æœºæ“ä½œç³»ç»Ÿï¼Œä½ ä¸ç”¨äº†è§£å¤ªå¤šçš„ä¸œè¥¿å°±å¯ä»¥ä¸“å¿ƒåœ°é«˜æ•ˆå®Œæˆä½ çš„å·¥ä½œã€‚ä½† MacOS æ— è®ºå¦‚ä½•è¿˜æ˜¯è„±ç¦»ä¸äº† UNIX çš„å½±å“ï¼ŒUNIX æœ‰çš„é—®é¢˜ï¼ŒMacOS ä¹Ÿä¼šæœ‰ï¼Œåªæ˜¯åœ¨è¡¨é¢ä¸Šçœ‹ä¸å‡ºæ¥ã€‚åœ¨å¼€å‘æ–¹é¢ï¼ŒæŒ‰ç…§ Apple çš„æ–‡æ¡£ï¼Œä½ è™½ç„¶å¯ä»¥å¿«é€Ÿåœ°å¼€å‘å‡ºä¸€ä¸ª Appï¼Œä½†ä½ å¾ˆéš¾å»äº†è§£åº•å±‚çš„ä¸œè¥¿ï¼Œè¿™ç»™ç§»æ¤ä¹‹ç±»çš„å·¥ä½œå¸¦æ¥äº†å¾ˆå¤§çš„éº»çƒ¦ï¼Œä¸è¿‡è¿‘å¹´æ¥ä¹Ÿæœ‰å¥½è½¬ã€‚</p></li><li><p>Windowsï¼Œæˆ‘æ‰¿è®¤å¾®è½¯å¾ˆå‰å®³ï¼ŒWindowsçš„è®¾è®¡ä¹Ÿæœ‰å¾ˆå¤šå¾ˆå¥½çš„åœ°æ–¹ï¼Œä½†æˆ‘å§‹ç»ˆæ— æ³•æ¥å— Windows å‘ˆç°ç»™ç”¨æˆ·çš„é‚£ç§â€¦â€¦ï¼Œæˆ‘æƒ³æ˜¯æˆ‘çš„ç¨‹åºè®¾è®¡åŠŸå¤«è¿˜ä¸åˆ°å®¶ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿä¸å–œæ¬¢å¾®è½¯é£æ ¼çš„ä»£ç â€”â€”è™½ç„¶å®¢è§‚åœ°è¯´æˆ‘æ‰¿è®¤å®ƒä»¬å…¶å®å¾ˆå¥½ã€‚åœ¨ Windows 10 ä¸­æˆ‘å·²ç»çœ‹åˆ°äº†å®ƒæœæˆ‘æƒ³è¦çš„æ–¹å‘æœ‰äº†åè¶³çš„è¿›æ­¥ï¼Œä½†è¿™è¿˜ä¸å¤Ÿï¼æˆ‘æœŸæœ›å¾®è½¯æœ‰ä¸€å¤©å¯ä»¥è®©æˆ‘ç”¨å› Windowsï¼Œæ¯•ç«Ÿå®ƒæ˜¯æˆ‘å¯¹è®¡ç®—æœºçš„æœ€åˆå›å¿†ã€‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Beginning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>helloworld</title>
      <link href="/2016/08/14/helloworld/"/>
      <url>/2016/08/14/helloworld/</url>
      
        <content type="html"><![CDATA[<h1 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h1>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
