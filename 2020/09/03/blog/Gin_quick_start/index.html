<!DOCTYPE html>
<html lang=zh>
<head><meta name="generator" content="Hexo 3.9.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Gin 入门 用 Go 好久了，也写了好几个小 Web 服务，基本都是在用标准库的 net/http + database/sql，其实开发难度、性能都还不错啦。写的多了还是觉得用标准库有些部分代码重复性还是很高的，慢慢地自己总结出一些通用的“框架”，但不成熟，问题很多。所以开始学一些成熟的框架，之前我开始用 Gorm 简化数据库这方面的流程，这次是考虑学一个 Web 框架啦—— Gin 足够简">
<meta name="keywords" content="Golang,Web">
<meta property="og:type" content="article">
<meta property="og:title" content="Gin入门">
<meta property="og:url" content="https://clownote.github.io/2020/09/03/blog/Gin_quick_start/index.html">
<meta property="og:site_name" content="clownote">
<meta property="og:description" content="Gin 入门 用 Go 好久了，也写了好几个小 Web 服务，基本都是在用标准库的 net/http + database/sql，其实开发难度、性能都还不错啦。写的多了还是觉得用标准库有些部分代码重复性还是很高的，慢慢地自己总结出一些通用的“框架”，但不成熟，问题很多。所以开始学一些成熟的框架，之前我开始用 Gorm 简化数据库这方面的流程，这次是考虑学一个 Web 框架啦—— Gin 足够简">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-09-06T14:14:25.451Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Gin入门">
<meta name="twitter:description" content="Gin 入门 用 Go 好久了，也写了好几个小 Web 服务，基本都是在用标准库的 net/http + database/sql，其实开发难度、性能都还不错啦。写的多了还是觉得用标准库有些部分代码重复性还是很高的，慢慢地自己总结出一些通用的“框架”，但不成熟，问题很多。所以开始学一些成熟的框架，之前我开始用 Gorm 简化数据库这方面的流程，这次是考虑学一个 Web 框架啦—— Gin 足够简">
    
    
        
          
              <link rel="shortcut icon" href="/images/rabbit.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/rabbit_192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/rabbit_180.png">
          
        
    
    <!-- title -->
    <title>Gin入门</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
    <!--Google search varification (PRIVATE)-->
    <meta name="google-site-verification" content="MrqlpFAD8nDanw3Ypv7ZsIWHLnTdhRuLa4QhSVwxIvc">
    <!--Google AdSense 关联 (PRIVATE)-->
    <script data-ad-client="ca-pub-1510963483941114" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="https://github.com/cdfmlr">项目</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="/2020/08/24/DeepLearningWithPython/Deep-Learning with-Python-ch8_5/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://clownote.github.io/2020/09/03/blog/Gin_quick_start/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://clownote.github.io/2020/09/03/blog/Gin_quick_start/&text=Gin入门"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://clownote.github.io/2020/09/03/blog/Gin_quick_start/&title=Gin入门"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://clownote.github.io/2020/09/03/blog/Gin_quick_start/&is_video=false&description=Gin入门"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Gin入门&body=Check out this article: https://clownote.github.io/2020/09/03/blog/Gin_quick_start/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://clownote.github.io/2020/09/03/blog/Gin_quick_start/&title=Gin入门"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://clownote.github.io/2020/09/03/blog/Gin_quick_start/&title=Gin入门"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://clownote.github.io/2020/09/03/blog/Gin_quick_start/&title=Gin入门"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://clownote.github.io/2020/09/03/blog/Gin_quick_start/&title=Gin入门"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://clownote.github.io/2020/09/03/blog/Gin_quick_start/&name=Gin入门&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#gin-入门"><span class="toc-number">1.</span> <span class="toc-text"> Gin 入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装"><span class="toc-number">1.1.</span> <span class="toc-text"> 安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#起步"><span class="toc-number">1.2.</span> <span class="toc-text"> 起步</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#路由"><span class="toc-number">1.3.</span> <span class="toc-text"> 路由</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#路径参数"><span class="toc-number">1.3.1.</span> <span class="toc-text"> 路径参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#重定向"><span class="toc-number">1.3.2.</span> <span class="toc-text"> 重定向</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#路由分组"><span class="toc-number">1.3.3.</span> <span class="toc-text"> 路由分组</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#请求内容"><span class="toc-number">1.4.</span> <span class="toc-text"> 请求内容</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#querystring-参数"><span class="toc-number">1.4.1.</span> <span class="toc-text"> Querystring 参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#post-form-参数"><span class="toc-number">1.4.2.</span> <span class="toc-text"> POST Form 参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#map-作为参数"><span class="toc-number">1.4.3.</span> <span class="toc-text"> Map 作为参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#上传文件"><span class="toc-number">1.4.4.</span> <span class="toc-text"> 上传文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#单个文件"><span class="toc-number">1.4.4.1.</span> <span class="toc-text"> 单个文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#多个文件"><span class="toc-number">1.4.4.2.</span> <span class="toc-text"> 多个文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#响应渲染"><span class="toc-number">1.5.</span> <span class="toc-text"> 响应渲染</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#json-xml-yaml"><span class="toc-number">1.5.1.</span> <span class="toc-text"> JSON, XML, YAML</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#protobuf"><span class="toc-number">1.5.2.</span> <span class="toc-text"> ProtoBuf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#html"><span class="toc-number">1.5.3.</span> <span class="toc-text"> HTML</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文件服务"><span class="toc-number">1.6.</span> <span class="toc-text"> 文件服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#静态文件服务"><span class="toc-number">1.6.1.</span> <span class="toc-text"> 静态文件服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件数据服务"><span class="toc-number">1.6.2.</span> <span class="toc-text"> 文件数据服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#用-reader-数据响应"><span class="toc-number">1.6.3.</span> <span class="toc-text"> 用 Reader 数据响应</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模型绑定"><span class="toc-number">1.7.</span> <span class="toc-text"> 模型绑定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#中间件"><span class="toc-number">1.8.</span> <span class="toc-text"> 中间件</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Gin入门
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">clownote</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-09-03T22:50:28.321Z" itemprop="datePublished">2020-09-03</time>
        
        (Updated: <time datetime="2020-09-06T14:14:25.451Z" itemprop="dateModified">2020-09-06</time>)
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/Golang/">Golang</a>, <a class="tag-link" href="/tags/Web/">Web</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="gin-入门"><a class="markdownIt-Anchor" href="#gin-入门"></a> Gin 入门</h1>
<p>用 Go 好久了，也写了好几个小 Web 服务，基本都是在用标准库的 <code>net/http</code> + <code>database/sql</code>，其实开发难度、性能都还不错啦。写的多了还是觉得用标准库有些部分代码重复性还是很高的，慢慢地自己总结出一些通用的“框架”，但不成熟，问题很多。所以开始学一些成熟的框架，之前我开始用 Gorm 简化数据库这方面的流程，这次是考虑学一个 Web 框架啦—— Gin 足够简洁，使用的也比较广泛，所以就它了。</p>
<h2 id="安装"><a class="markdownIt-Anchor" href="#安装"></a> 安装</h2>
<ol>
<li>下载安装 Gin 包：</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go get -u github.com/gin-gonic/gin</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>在代码中导入：</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"github.com/gin-gonic/gin"</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>(可选)如果要使用诸如 <code>http.StatusOK</code> 的常量，还要导入 <code>net/http</code></li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"net/http"</span></span><br></pre></td></tr></table></figure>
<h2 id="起步"><a class="markdownIt-Anchor" href="#起步"></a> 起步</h2>
<p>首先，创建一个文件 <code>example.go</code>，接下来的代码就写在这个文件里：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ touch example.go</span><br></pre></td></tr></table></figure>
<p>编辑文件，写代码：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	r := gin.Default() <span class="comment">// r 是 router 的意思</span></span><br><span class="line">	r.GET(<span class="string">"/ping"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line">			<span class="string">"message"</span>: <span class="string">"pong"</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">	r.Run() <span class="comment">// listen and serve on 0.0.0.0:8080</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行它：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go run example.go</span><br></pre></td></tr></table></figure>
<p>然后就可以在浏览器里访问 <code>0.0.0.0:8080/ping</code> 了。可以看到返回的 pong，以及终端输出的精美日志。</p>
<hr>
<p>在这个 Ping-Pong 程序里，我们使用 <code>gin.Default</code> 来生成一个框架的实例（称为 Engine）。Default 生成的 Engine 里包括了默认的 Logger 和 Recovery 中间件。Engine “继承”了 RouterGroup，所以可以直接往里面添加路由：</p>
<p><code>r.GET('/url', handlerFunc)</code> 声明一个路由。GET 访问 URL 触发 handlerFunc 函数，这个函数（属于函数类型<code>type HandlerFunc func(*Context)</code>）响应请求，这里用<code>c.JSON</code> 返回一个 <code>application/json</code>  的响应。</p>
<p><code>r.Run()</code> 让 Engine 跑起来，默认的服务地址是 <code>:8080</code>，可以用 <code>r.Run(&quot;:9999&quot;)</code> 来自定义。</p>
<h2 id="路由"><a class="markdownIt-Anchor" href="#路由"></a> 路由</h2>
<p>Ping-Pong 程序的例子里，已经展现了固定路径、无参数的 GET 请求路由。除了 <code>r.GET</code>，还可以在 <code>r.</code> 后面使用 <code>POST</code>, <code>PUT</code>, <code>PATCH</code>, <code>DELETE</code>, <code>OPTIONS</code> 以及 <code>Any</code> 来添加各种请求类型的路由。</p>
<h3 id="路径参数"><a class="markdownIt-Anchor" href="#路径参数"></a> 路径参数</h3>
<p>路径参数可以实现动态路由。</p>
<ul>
<li><code>/user/:name</code> 匹配 <code>/user/xxx</code></li>
</ul>
<p>例如，我们希望对不同的用户访问 <code>/user/foo</code>、<code>/user/bar</code>。则可以使用：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">"/user/:name"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    name := c.Param(<span class="string">"name"</span>)</span><br><span class="line">    c.String(http.StatusOK, <span class="string">"Hello, %s"</span>, name)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ curl 0.0.0.0:8080/user/foobar</span><br><span class="line">Hello, foobar</span><br><span class="line">$ curl 0.0.0.0:8080/user/foobar/</span><br><span class="line">&lt;a href=<span class="string">"/user/foobar"</span>&gt;Moved Permanently&lt;/a&gt;.</span><br><span class="line">$ curl 0.0.0.0:8080/user/</span><br><span class="line">404 page not found</span><br></pre></td></tr></table></figure>
<ul>
<li><code>/user/:name/*action</code>  匹配 <code>/user/xxx/</code> 以及 <code>/user/xxx/yyy/...</code>;</li>
</ul>
<p>要匹配 <code>/user/:name/...</code>，使用如下玩法：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">"/user/:name/*action"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    name := c.Param(<span class="string">"name"</span>)</span><br><span class="line">    action := c.Param(<span class="string">"action"</span>)</span><br><span class="line">    message := name + <span class="string">" is "</span> + action</span><br><span class="line">    c.String(http.StatusOK, message)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ curl 0.0.0.0:8080/user/foobar/</span><br><span class="line">foobar is /</span><br><span class="line">$ curl 0.0.0.0:8080/user/foobar/doing/something</span><br><span class="line">foobar is /doing/something</span><br></pre></td></tr></table></figure>
<blockquote>
<p>P.S. For each matched request Context will hold the route</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; router.POST(<span class="string">"/user/:name/*action"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">&gt;         c.FullPath() == <span class="string">"/user/:name/*action"</span> <span class="comment">// true</span></span><br><span class="line">&gt; &#125;)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="重定向"><a class="markdownIt-Anchor" href="#重定向"></a> 重定向</h3>
<ul>
<li>外部的重定向，使用 Redirect 通知浏览器去重定向：</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GET 用 301 Moved Permanently</span></span><br><span class="line">r.GET(<span class="string">"/tobaidu"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.Redirect(http.StatusMovedPermanently, <span class="string">"https://www.baidu.com"</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// POST 用 302 Found</span></span><br><span class="line">r.POST(<span class="string">"toping"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.Redirect(http.StatusFound, <span class="string">"/ping"</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ curl -i <span class="string">'0.0.0.0:8080/tobaidu'</span></span><br><span class="line">HTTP/1.1 301 Moved Permanently</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Location: https://www.baidu.com</span><br><span class="line">Date: Fri, 04 Sep 2020 13:23:35 GMT</span><br><span class="line">Content-Length: 56</span><br><span class="line"></span><br><span class="line">&lt;a href=<span class="string">"https://www.baidu.com"</span>&gt;Moved Permanently&lt;/a&gt;.</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ curl -i <span class="string">'0.0.0.0:8080/toping'</span> -X POST</span><br><span class="line">HTTP/1.1 302 Found</span><br><span class="line">Location: /ping</span><br><span class="line">Date: Fri, 04 Sep 2020 13:23:56 GMT</span><br><span class="line">Content-Length: 0</span><br></pre></td></tr></table></figure>
<ul>
<li>内部的重定向，把请求的 Path 硬改了然后重新处理：</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">"/test"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.Request.URL.Path = <span class="string">"/test2"</span></span><br><span class="line">    r.HandleContext(c)</span><br><span class="line">&#125;)</span><br><span class="line">r.GET(<span class="string">"/test2"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123;<span class="string">"hello"</span>: <span class="string">"world"</span>&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ curl -i <span class="string">'0.0.0.0:8080/test'</span></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json; charset=utf-8</span><br><span class="line">Date: Fri, 04 Sep 2020 13:24:41 GMT</span><br><span class="line">Content-Length: 17</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">"hello"</span>:<span class="string">"world"</span>&#125;</span><br></pre></td></tr></table></figure>
<h3 id="路由分组"><a class="markdownIt-Anchor" href="#路由分组"></a> 路由分组</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">defaultHandler := <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">        <span class="string">"endpoint"</span>: c.FullPath(),</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">v1 := r.Group(<span class="string">"/v1"</span>)</span><br><span class="line">&#123;</span><br><span class="line">    v1.GET(<span class="string">"/hello"</span>, defaultHandler)</span><br><span class="line">    v1.POST(<span class="string">"/login"</span>, defaultHandler)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">v2 := r.Group(<span class="string">"/v2"</span>)</span><br><span class="line">&#123;</span><br><span class="line">    v2.GET(<span class="string">"/hello"</span>, defaultHandler)</span><br><span class="line">    v2.POST(<span class="string">"/login"</span>, defaultHandler)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>P.S. 这里的大括号是代表把其中的内容看作一个单独的语句块（独立的作用域）。</p>
</blockquote>
<p>Gin 会自动给分组的路由变成 <code>/v1/...</code> 这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET    /v1/hello</span><br><span class="line">POST   /v1/login</span><br><span class="line">GET    /v2/hello</span><br><span class="line">POST   /v2/login</span><br></pre></td></tr></table></figure>
<p>调用测试：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ curl <span class="string">'0.0.0.0:8080/v1/hello'</span></span><br><span class="line">&#123;<span class="string">"endpoint"</span>:<span class="string">"/v1/hello"</span>&#125;</span><br><span class="line">$ curl -X POST <span class="string">'0.0.0.0:8080/v2/login'</span></span><br><span class="line">&#123;<span class="string">"endpoint"</span>:<span class="string">"/v2/login"</span>&#125;</span><br></pre></td></tr></table></figure>
<h2 id="请求内容"><a class="markdownIt-Anchor" href="#请求内容"></a> 请求内容</h2>
<h3 id="querystring-参数"><a class="markdownIt-Anchor" href="#querystring-参数"></a> Querystring 参数</h3>
<p>GET 请求中，我们常用 Querystring 即 <code>http://example.com/welcome?firstname=Jane&amp;lastname=Doe</code> 的这种查询方式。</p>
<p>使用 <code>context.Query()</code> 来获取参数：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">"/welcome"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    firstname := c.DefaultQuery(<span class="string">"firstname"</span>, <span class="string">"Guest"</span>)</span><br><span class="line">    lastname := c.Query(<span class="string">"lastname"</span>)</span><br><span class="line">    <span class="comment">// shortcut for c.Request.URL.Query().Get("lastname")</span></span><br><span class="line">    c.String(http.StatusOK, <span class="string">"Hello, %s %s"</span>, firstname, lastname)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ curl <span class="string">'0.0.0.0:8080/welcome?firstname=Jane'</span></span><br><span class="line">Hello, Jane </span><br><span class="line">$ curl <span class="string">'0.0.0.0:8080/welcome?lastname=Doe'</span></span><br><span class="line">Hello, Guest Doe</span><br><span class="line">$ curl <span class="string">'0.0.0.0:8080/welcome?firstname=Jane&amp;lastname=Doe'</span></span><br><span class="line">Hello, Jane Doe</span><br></pre></td></tr></table></figure>
<h3 id="post-form-参数"><a class="markdownIt-Anchor" href="#post-form-参数"></a> POST Form 参数</h3>
<p>对于 POST 等请求方式，我们常用 Multipart/Urlencoded Form 来传递参数信息。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">r.POST(<span class="string">"/form_post"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    message := c.PostForm(<span class="string">"message"</span>)</span><br><span class="line">    nick := c.DefaultPostForm(<span class="string">"nick"</span>, <span class="string">"anonymous"</span>)</span><br><span class="line"></span><br><span class="line">    c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line">        <span class="string">"status"</span>:  <span class="string">"posted"</span>,</span><br><span class="line">        <span class="string">"message"</span>: message,</span><br><span class="line">        <span class="string">"nick"</span>:    nick,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ curl <span class="string">'0.0.0.0:8080/form_post'</span> -X POST</span><br><span class="line">&#123;<span class="string">"message"</span>:<span class="string">""</span>,<span class="string">"nick"</span>:<span class="string">"anonymous"</span>,<span class="string">"status"</span>:<span class="string">"posted"</span>&#125;</span><br><span class="line">$ curl <span class="string">'0.0.0.0:8080/form_post'</span> -X POST -d <span class="string">'message=hello&amp;nick=Foobar'</span></span><br><span class="line">&#123;<span class="string">"message"</span>:<span class="string">"hello"</span>,<span class="string">"nick"</span>:<span class="string">"Foobar"</span>,<span class="string">"status"</span>:<span class="string">"posted"</span>&#125;</span><br></pre></td></tr></table></figure>
<h3 id="map-作为参数"><a class="markdownIt-Anchor" href="#map-作为参数"></a> Map 作为参数</h3>
<p>对于使用 Map 作为参数的情况，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /post?ids[a]=1234&amp;ids[b]=hello HTTP/1.1</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">names[first]=thinkerou&amp;names[second]=tianou</span><br></pre></td></tr></table></figure>
<p>使用 <code>QueryMap</code> 和 <code>PostFormMap</code> 来获取：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">r.POST(<span class="string">"/post"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span>&#123;</span><br><span class="line">    ids := c.QueryMap(<span class="string">"ids"</span>)</span><br><span class="line">    names := c.PostFormMap(<span class="string">"names"</span>)</span><br><span class="line">    c.String(http.StatusOK, <span class="string">"ids: %v; names: %v"</span>,  ids, names)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl -g <span class="string">'http://0.0.0.0:8080/post?ids[a]=1234&amp;ids[b]=hello'</span> -X POST -d <span class="string">'names[first]=thinkerou&amp;names[second]=tianou'</span></span><br><span class="line">ids: map[a:1234 b:hello]; names: map[first:thinkerou second:tianou]</span><br></pre></td></tr></table></figure>
<h3 id="上传文件"><a class="markdownIt-Anchor" href="#上传文件"></a> 上传文件</h3>
<p>在上传文件的时候，如果需要，可以设置一个较低的 multipart forms 内存限制（默认是 32 MiB）。</p>
<p>注意，这个只是限制在上传时程序可以使用的内存，并不是限制上传文件的大小！See <a href="https://stackoverflow.com/questions/56143325/gin-web-framework-limit-upload-file-size-not-working" target="_blank" rel="noopener">Stackoverflow: gin web framework limit upload file size not working</a>.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r := gin.Default()</span><br><span class="line">r.MaxMultipartMemory = <span class="number">8</span> &lt;&lt; <span class="number">20</span>  <span class="comment">// 8 MiB</span></span><br></pre></td></tr></table></figure>
<h4 id="单个文件"><a class="markdownIt-Anchor" href="#单个文件"></a> 单个文件</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">r.POST(<span class="string">"/upload/single"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    file, err := c.FormFile(<span class="string">"file"</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        c.String(http.StatusBadRequest, <span class="string">"get form err: %s"</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    filename := filepath.Base(file.Filename)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err := c.SaveUploadedFile(file, filepath.Join(<span class="string">"./upload"</span>, filename)); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        c.String(http.StatusBadRequest, <span class="string">"upload file err: %s"</span>, err.Error())</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    c.String(http.StatusOK, <span class="string">"File %s uploaded successfully"</span>, filename)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>⚠️注意，不要直接用 <code>file.Filename</code>，详见 <a href="https://github.com/gin-gonic/gin/issues/1693" target="_blank" rel="noopener">Gin Issue #1693</a>。</p>
<p>使用 curl 测试：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X POST <span class="string">'0.0.0.0:8080/upload/single'</span> \</span><br><span class="line">	-F <span class="string">"file=@/Users/c/Desktop/test.png"</span> \</span><br><span class="line">	-H <span class="string">"Content-Type: multipart/form-data"</span></span><br><span class="line">File test.png uploaded successfully</span><br></pre></td></tr></table></figure>
<h4 id="多个文件"><a class="markdownIt-Anchor" href="#多个文件"></a> 多个文件</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">r.POST(<span class="string">"/upload/multiple"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    form, _ := c.MultipartForm()</span><br><span class="line">    files := form.File[<span class="string">"upload[]"</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, file := <span class="keyword">range</span> files &#123;</span><br><span class="line">        filename := filepath.Base(file.Filename)</span><br><span class="line">        c.SaveUploadedFile(file, filepath.Join(<span class="string">"./upload"</span>, filename))</span><br><span class="line">        log.Println(<span class="string">"upload: "</span>, filename)</span><br><span class="line">    &#125;</span><br><span class="line">    c.String(http.StatusOK, <span class="string">"%d files uploaded!"</span>, <span class="built_in">len</span>(files))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>异常处理参考“单个文件”部分的代码，这里略了。</p>
<p>测试：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ curl <span class="string">'0.0.0.0:8080/upload/multiple'</span> -X POST \</span><br><span class="line">	-F <span class="string">"upload[]=@/Users/c/Desktop/test1.png"</span> \</span><br><span class="line">	-F <span class="string">"upload[]=@/Users/c/Desktop/test2.png"</span> \</span><br><span class="line">	-H <span class="string">"Content-Type: multipart/form-data"</span></span><br><span class="line">2 files uploaded!</span><br></pre></td></tr></table></figure>
<h2 id="响应渲染"><a class="markdownIt-Anchor" href="#响应渲染"></a> 响应渲染</h2>
<h3 id="json-xml-yaml"><a class="markdownIt-Anchor" href="#json-xml-yaml"></a> JSON, XML, YAML</h3>
<p>前面我们已经用过好几次 JSON 了。XML、YAML 和 JSON 很类似，调用对应的方法，传入状态码以及结果信息的结构体即可写入响应：</p>
<ul>
<li>JSON：<code>func (c *Context) JSON(code int, obj interface{})</code></li>
<li>XML：<code>func (c *Context) XML(code int, obj interface{})</code></li>
<li>YAML：<code>func (c *Context) YAML(code int, obj interface{})</code></li>
</ul>
<p>对于一般简单的内容，可以使用 <code>gin.H</code> 来表示数据。<code>gin.H</code> 是 <code>map[string]interface{}</code> 的简写。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">"/someJSON"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123;<span class="string">"message"</span>: <span class="string">"hey"</span>, <span class="string">"status"</span>: http.StatusOK&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">r.GET(<span class="string">"/someXML"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.XML(http.StatusOK, gin.H&#123;<span class="string">"message"</span>: <span class="string">"hey"</span>, <span class="string">"status"</span>: http.StatusOK&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">r.GET(<span class="string">"/someYAML"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.YAML(http.StatusOK, gin.H&#123;<span class="string">"message"</span>: <span class="string">"hey"</span>, <span class="string">"status"</span>: http.StatusOK&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>对于复杂的情况，也可以使用 <code>struct</code> 。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">"/moreJSON"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> msg <span class="keyword">struct</span> &#123;</span><br><span class="line">        Name    <span class="keyword">string</span> <span class="string">`json:"user"`</span></span><br><span class="line">        Message <span class="keyword">string</span></span><br><span class="line">        Number  <span class="keyword">int</span></span><br><span class="line">    &#125;</span><br><span class="line">    msg.Name = <span class="string">"Lena"</span></span><br><span class="line">    msg.Message = <span class="string">"hey"</span></span><br><span class="line">    msg.Number = <span class="number">123</span></span><br><span class="line">    <span class="comment">// Note that msg.Name becomes "user" in the JSON</span></span><br><span class="line">    <span class="comment">// Will output  :   &#123;"user": "Lena", "Message": "hey", "Number": 123&#125;</span></span><br><span class="line">    c.JSON(http.StatusOK, msg)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>对于 JSON，Gin 还提供各种需求的 <a href="https://github.com/gin-gonic/gin#securejson" target="_blank" rel="noopener">SecureJSON</a>，<a href="https://github.com/gin-gonic/gin#jsonp" target="_blank" rel="noopener">JSONP</a>，<a href="https://github.com/gin-gonic/gin#asciijson" target="_blank" rel="noopener">AsciiJSON</a>，<a href="https://github.com/gin-gonic/gin#purejson" target="_blank" rel="noopener">PureJSON</a>。</p>
<h3 id="protobuf"><a class="markdownIt-Anchor" href="#protobuf"></a> ProtoBuf</h3>
<p>Gin 还可以直接渲染 ProtoBuf：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">"/someProtoBuf"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    reps := []<span class="keyword">int64</span>&#123;<span class="keyword">int64</span>(<span class="number">1</span>), <span class="keyword">int64</span>(<span class="number">2</span>)&#125;</span><br><span class="line">    label := <span class="string">"test"</span></span><br><span class="line">    <span class="comment">// The specific definition of protobuf is written in the testdata/protoexample file.</span></span><br><span class="line">    data := &amp;protoexample.Test&#123;</span><br><span class="line">        Label: &amp;label,</span><br><span class="line">        Reps:  reps,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Note that data becomes binary data in the response</span></span><br><span class="line">    <span class="comment">// Will output protoexample.Test protobuf serialized data</span></span><br><span class="line">    c.ProtoBuf(http.StatusOK, data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="html"><a class="markdownIt-Anchor" href="#html"></a> HTML</h3>
<p>读取模版 HTML 文件：</p>
<ul>
<li><code>func (engine *Engine) LoadHTMLGlob(pattern string)</code></li>
<li><code>func (engine *Engine) LoadHTMLFiles(files ...string)</code></li>
</ul>
<p>渲染 HTML，写入响应：</p>
<ul>
<li><code>func (c *Context) HTML(code int, name string, obj interface{})</code> 其中 name 是模版文件路径，obj 是要填充的数据。</li>
</ul>
<p>默认渲染用的是和标准库一样的模版，详见 <a href="https://golang.org/pkg/text/template/" target="_blank" rel="noopener">text/template</a> 和 <a href="https://golang.org/pkg/html/template/" target="_blank" rel="noopener">html/template</a>。</p>
<p>E.g.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	router := gin.Default()</span><br><span class="line">	router.LoadHTMLGlob(<span class="string">"templates/*"</span>)</span><br><span class="line">	<span class="comment">//router.LoadHTMLFiles("templates/template1.html", "templates/template2.html")</span></span><br><span class="line">	router.GET(<span class="string">"/index"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.HTML(http.StatusOK, <span class="string">"index.tmpl"</span>, gin.H&#123;</span><br><span class="line">			<span class="string">"title"</span>: <span class="string">"Main website"</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">	router.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>templates/index.tmpl</code>:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">		&#123;&#123; .title &#125;&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>还有好多高级用法，我不太用这东西，去看文档吧：<a href="https://github.com/gin-gonic/gin#html-rendering" target="_blank" rel="noopener">gin#html-rendering</a>。</p>
<h2 id="文件服务"><a class="markdownIt-Anchor" href="#文件服务"></a> 文件服务</h2>
<h3 id="静态文件服务"><a class="markdownIt-Anchor" href="#静态文件服务"></a> 静态文件服务</h3>
<p>Serving static files</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	router := gin.Default()</span><br><span class="line">    </span><br><span class="line">	router.Static(<span class="string">"/assets"</span>, <span class="string">"./assets"</span>)</span><br><span class="line">	router.StaticFS(<span class="string">"/more_static"</span>, http.Dir(<span class="string">"my_file_system"</span>))</span><br><span class="line">	router.StaticFile(<span class="string">"/favicon.ico"</span>, <span class="string">"./resources/favicon.ico"</span>)</span><br><span class="line"></span><br><span class="line">	router.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>Static(relativePath, root string)</code>：在 root 路径处开静态文件服务。</li>
<li><code>StaticFS(relativePath string, fs http.FileSystem)</code>：类似 <code>Static()</code>，但可以用 <code>http.FileSystem</code>。</li>
<li><code>StaticFile(relativePath, filepath string)</code>：注册服务单个文件。</li>
</ul>
<h3 id="文件数据服务"><a class="markdownIt-Anchor" href="#文件数据服务"></a> 文件数据服务</h3>
<p>Serving data from file，就是把文件写入响应啦。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	router := gin.Default()</span><br><span class="line"></span><br><span class="line">	router.GET(<span class="string">"/local/file"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.File(<span class="string">"local/file.go"</span>)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> fs http.FileSystem = <span class="comment">// ...</span></span><br><span class="line">	router.GET(<span class="string">"/fs/file"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.FileFromFS(<span class="string">"fs/file.go"</span>, fs)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="用-reader-数据响应"><a class="markdownIt-Anchor" href="#用-reader-数据响应"></a> 用 Reader 数据响应</h3>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	router := gin.Default()</span><br><span class="line">	router.GET(<span class="string">"/someDataFromReader"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		response, err := http.Get(<span class="string">"https://raw.githubusercontent.com/gin-gonic/logo/master/color.png"</span>)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> || response.StatusCode != http.StatusOK &#123;</span><br><span class="line">			c.Status(http.StatusServiceUnavailable)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		reader := response.Body</span><br><span class="line">		contentLength := response.ContentLength</span><br><span class="line">		contentType := response.Header.Get(<span class="string">"Content-Type"</span>)</span><br><span class="line"></span><br><span class="line">		extraHeaders := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;</span><br><span class="line">			<span class="string">"Content-Disposition"</span>: <span class="string">`attachment; filename="gopher.png"`</span>,</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		c.DataFromReader(http.StatusOK, contentLength, contentType, reader, extraHeaders)</span><br><span class="line">	&#125;)</span><br><span class="line">	router.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="模型绑定"><a class="markdownIt-Anchor" href="#模型绑定"></a> 模型绑定</h2>
<p>日常的开发中，把请求体中的内容放到一个结构体里，并验证给的信息是否完整是很常用的功能。Gin 提供模型绑定(model binding)来完成这一功能。模型绑定可以把 Form 值、JSON、XML、YAML 形式的数据绑定到 Go 的结构体。</p>
<p>Gin 提供两套绑定的方法：<code>Bind</code> 和 <code>ShouldBind</code>。<code>Bind</code> 在绑定出错时把 400 aborted 写入响应（<code>c.AbortWithError(400, err).SetType(ErrorTypeBind)</code>）。<code>ShouldBind</code> 在绑定失败时返回一个错误，我们需要手动去处理错误。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Login <span class="keyword">struct</span> &#123;</span><br><span class="line">	User <span class="keyword">string</span> <span class="string">`form:"user" json:"user" xml:"user" binding:"required"`</span></span><br><span class="line">	Password <span class="keyword">string</span> <span class="string">`form:"password" json:"password" xml:"password" binding:"required"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	router := gin.Default()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Example for binding JSON:</span></span><br><span class="line">	<span class="comment">//     &#123;"user": "manu", "password": "123"&#125;</span></span><br><span class="line">	router.POST(<span class="string">"/loginJSON"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		<span class="keyword">var</span> json Login</span><br><span class="line">		<span class="keyword">if</span> err := c.ShouldBindJSON(&amp;json); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">"error"</span>: err.Error()&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> json.User != <span class="string">"manu"</span> || json.Password != <span class="string">"123"</span> &#123;</span><br><span class="line">			c.JSON(http.StatusUnauthorized, gin.H&#123;<span class="string">"status"</span>: <span class="string">"unauthorized"</span>&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		c.JSON(http.StatusOK, gin.H&#123;<span class="string">"status"</span>: <span class="string">"you are logged in"</span>&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Example for binding XML:</span></span><br><span class="line">	<span class="comment">//     &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line">	<span class="comment">//     &lt;root&gt;</span></span><br><span class="line">	<span class="comment">//         &lt;user&gt;manu&lt;/user&gt;</span></span><br><span class="line">	<span class="comment">//         &lt;password&gt;123&lt;/password&gt;</span></span><br><span class="line">	<span class="comment">//     &lt;/root&gt;</span></span><br><span class="line">	router.POST(<span class="string">"/loginXML"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		<span class="keyword">var</span> xml Login</span><br><span class="line">		<span class="keyword">if</span> err := c.ShouldBindXML(&amp;xml); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">"error"</span>: err.Error()&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> xml.User != <span class="string">"manu"</span> || xml.Password != <span class="string">"123"</span> &#123;</span><br><span class="line">			c.JSON(http.StatusUnauthorized, gin.H&#123;<span class="string">"status"</span>: <span class="string">"unauthorized"</span>&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		c.JSON(http.StatusOK, gin.H&#123;<span class="string">"status"</span>: <span class="string">"you are logged in"</span>&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Example for binding a HTML form:</span></span><br><span class="line">	<span class="comment">//     user=manu&amp;password=123</span></span><br><span class="line">	router.POST(<span class="string">"/loginForm"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		<span class="keyword">var</span> form Login</span><br><span class="line">		<span class="comment">// This will infer what binder to use depending on the content-type header.</span></span><br><span class="line">		<span class="keyword">if</span> err := c.ShouldBind(&amp;form); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">"error"</span>: err.Error()&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> form.User != <span class="string">"manu"</span> || form.Password != <span class="string">"123"</span> &#123;</span><br><span class="line">			c.JSON(http.StatusUnauthorized, gin.H&#123;<span class="string">"status"</span>: <span class="string">"unauthorized"</span>&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		c.JSON(http.StatusOK, gin.H&#123;<span class="string">"status"</span>: <span class="string">"you are logged in"</span>&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	router.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ curl -v -X POST \</span><br><span class="line">  http://localhost:8080/loginJSON \</span><br><span class="line">  -H <span class="string">'content-type: application/json'</span> \</span><br><span class="line">  -d <span class="string">'&#123; "user": "manu" &#125;'</span></span><br><span class="line">&gt; POST /loginJSON HTTP/1.1</span><br><span class="line">&gt; Host: localhost:8080</span><br><span class="line">&gt; User-Agent: curl/7.64.1</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt; content-type: application/json</span><br><span class="line">&gt; Content-Length: 18</span><br><span class="line">&gt; </span><br><span class="line">* upload completely sent off: 18 out of 18 bytes</span><br><span class="line">&lt; HTTP/1.1 400 Bad Request</span><br><span class="line">&lt; Content-Type: application/json; charset=utf-8</span><br><span class="line">&lt; Date: Sun, 06 Sep 2020 13:04:57 GMT</span><br><span class="line">&lt; Content-Length: 100</span><br><span class="line">&lt; </span><br><span class="line">&#123;<span class="string">"error"</span>:<span class="string">"Key: 'Login.Password' Error:Field validation for 'Password' failed on the 'required' tag"</span>&#125;</span><br></pre></td></tr></table></figure>
<p>注意在 <code>/loginForm</code> 里面用了 <code>ShouldBind</code>，这个会自动通过 content-type 来判断你请求用的是 Form、JSON、XML、YAML 的哪一种，然后用对应的 <code>ShouldBindXXXX</code> 把请求的内容绑定到结构体。</p>
<p>在结构体的定义中，要使用 tag 来指定字段在各种需要的 格式中的名字，并且制定是否必须绑定：</p>
<ul>
<li><code>binding:&quot;required&quot;</code> 则必须绑定，如果请求中没有对应的项则返回错误。</li>
<li><code>binding:&quot;-&quot;</code>：可选，请求中没有不会报错。</li>
</ul>
<p>Gin 是使用 <code>github.com/go-playground/validator/v10</code>  来完成验证的。这个包提供更复杂的验证功能：</p>
<blockquote>
<p>(Emmmm，学不动了，但感觉这个特别有用，从文档直接抄下来了)</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">	<span class="string">"github.com/gin-gonic/gin/binding"</span></span><br><span class="line">	<span class="string">"github.com/go-playground/validator/v10"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Booking contains binded and validated data.</span></span><br><span class="line"><span class="keyword">type</span> Booking <span class="keyword">struct</span> &#123;</span><br><span class="line">	CheckIn  time.Time <span class="string">`form:"check_in" binding:"required,bookabledate" time_format:"2006-01-02"`</span></span><br><span class="line">	CheckOut time.Time <span class="string">`form:"check_out" binding:"required,gtfield=CheckIn" time_format:"2006-01-02"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bookableDate validator.Func = <span class="function"><span class="keyword">func</span><span class="params">(fl validator.FieldLevel)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	date, ok := fl.Field().Interface().(time.Time)</span><br><span class="line">	<span class="keyword">if</span> ok &#123;</span><br><span class="line">		today := time.Now()</span><br><span class="line">		<span class="keyword">if</span> today.After(date) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	route := gin.Default()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> v, ok := binding.Validator.Engine().(*validator.Validate); ok &#123;</span><br><span class="line">		v.RegisterValidation(<span class="string">"bookabledate"</span>, bookableDate)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	route.GET(<span class="string">"/bookable"</span>, getBookable)</span><br><span class="line">	route.Run(<span class="string">":8085"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getBookable</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> b Booking</span><br><span class="line">	<span class="keyword">if</span> err := c.ShouldBindWith(&amp;b, binding.Query); err == <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(http.StatusOK, gin.H&#123;<span class="string">"message"</span>: <span class="string">"Booking dates are valid!"</span>&#125;)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">"error"</span>: err.Error()&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ curl <span class="string">"localhost:8085/bookable?check_in=2030-04-16&amp;check_out=2030-04-17"</span></span><br><span class="line">&#123;<span class="string">"message"</span>:<span class="string">"Booking dates are valid!"</span>&#125;</span><br><span class="line"></span><br><span class="line">$ curl <span class="string">"localhost:8085/bookable?check_in=2030-03-10&amp;check_out=2030-03-09"</span></span><br><span class="line">&#123;<span class="string">"error"</span>:<span class="string">"Key: 'Booking.CheckOut' Error:Field validation for 'CheckOut' failed on the 'gtfield' tag"</span>&#125;</span><br><span class="line"></span><br><span class="line">$ curl <span class="string">"localhost:8085/bookable?check_in=2000-03-09&amp;check_out=2000-03-10"</span></span><br><span class="line">&#123;<span class="string">"error"</span>:<span class="string">"Key: 'Booking.CheckIn' Error:Field validation for 'CheckIn' failed on the 'bookabledate' tag"</span>&#125;%</span><br></pre></td></tr></table></figure>
<p>Gin 还提供很多其他的关于绑定的功能，比如路径参数的绑定、上传文件的绑定、HTML 复选框的绑定等等。详细的看文档吧：<a href="https://github.com/gin-gonic/gin#model-binding-and-validation" target="_blank" rel="noopener">gin#model-binding-and-validation</a>。</p>
<h2 id="中间件"><a class="markdownIt-Anchor" href="#中间件"></a> 中间件</h2>
<p>之前我们都是用 <code>r = gin.Default()</code> 来实例化 Gin 的，这样搞出来的 r 是自带 Logger 和 Recovery 中间件的，要创建一个全新的，没有中间件的实例，使用 <code>New</code> 来替换 <code>Default</code>：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r := gin.New()</span><br></pre></td></tr></table></figure>
<p>通过 <code>r.Use(中间件())</code> 来添加中间件：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// Creates a router without any middleware by default</span></span><br><span class="line">	r := gin.New()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Global middleware</span></span><br><span class="line">	<span class="comment">// Logger middleware will write the logs to gin.DefaultWriter even if you set with GIN_MODE=release.</span></span><br><span class="line">	<span class="comment">// By default gin.DefaultWriter = os.Stdout</span></span><br><span class="line">	r.Use(gin.Logger())</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Recovery middleware recovers from any panics and writes a 500 if there was one.</span></span><br><span class="line">	r.Use(gin.Recovery())</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Per route middleware, you can add as many as you desire.</span></span><br><span class="line">	r.GET(<span class="string">"/benchmark"</span>, MyBenchLogger(), benchEndpoint)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Authorization group</span></span><br><span class="line">	<span class="comment">// authorized := r.Group("/", AuthRequired())</span></span><br><span class="line">	<span class="comment">// exactly the same as:</span></span><br><span class="line">	authorized := r.Group(<span class="string">"/"</span>)</span><br><span class="line">	<span class="comment">// per group middleware! in this case we use the custom created</span></span><br><span class="line">	<span class="comment">// AuthRequired() middleware just in the "authorized" group.</span></span><br><span class="line">	authorized.Use(AuthRequired())</span><br><span class="line">	&#123;</span><br><span class="line">		authorized.POST(<span class="string">"/login"</span>, loginEndpoint)</span><br><span class="line">		authorized.POST(<span class="string">"/submit"</span>, submitEndpoint)</span><br><span class="line">		authorized.POST(<span class="string">"/read"</span>, readEndpoint)</span><br><span class="line"></span><br><span class="line">		<span class="comment">// nested group</span></span><br><span class="line">		testing := authorized.Group(<span class="string">"testing"</span>)</span><br><span class="line">		testing.GET(<span class="string">"/analytics"</span>, analyticsEndpoint)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Listen and serve on 0.0.0.0:8080</span></span><br><span class="line">	r.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>。。。</p>
<p>写不动了，了解更多 Gin 请到 <a href="https://github.com/gin-gonic/gin" target="_blank" rel="noopener">gin 的 readme</a>。</p>

  </div>
</article>
<!--Disqus-->


<!--Livere-->

    <div class="blog-post-comments">
        <div id="lv-container" data-id="city" data-uid="MTAyMC80NjEzMi8yMjY0Mw==">
            <noscript>不启用 JavaScript 支持的人是看不到可爱的评论区的。😥</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="https://github.com/cdfmlr">项目</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#gin-入门"><span class="toc-number">1.</span> <span class="toc-text"> Gin 入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装"><span class="toc-number">1.1.</span> <span class="toc-text"> 安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#起步"><span class="toc-number">1.2.</span> <span class="toc-text"> 起步</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#路由"><span class="toc-number">1.3.</span> <span class="toc-text"> 路由</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#路径参数"><span class="toc-number">1.3.1.</span> <span class="toc-text"> 路径参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#重定向"><span class="toc-number">1.3.2.</span> <span class="toc-text"> 重定向</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#路由分组"><span class="toc-number">1.3.3.</span> <span class="toc-text"> 路由分组</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#请求内容"><span class="toc-number">1.4.</span> <span class="toc-text"> 请求内容</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#querystring-参数"><span class="toc-number">1.4.1.</span> <span class="toc-text"> Querystring 参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#post-form-参数"><span class="toc-number">1.4.2.</span> <span class="toc-text"> POST Form 参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#map-作为参数"><span class="toc-number">1.4.3.</span> <span class="toc-text"> Map 作为参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#上传文件"><span class="toc-number">1.4.4.</span> <span class="toc-text"> 上传文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#单个文件"><span class="toc-number">1.4.4.1.</span> <span class="toc-text"> 单个文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#多个文件"><span class="toc-number">1.4.4.2.</span> <span class="toc-text"> 多个文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#响应渲染"><span class="toc-number">1.5.</span> <span class="toc-text"> 响应渲染</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#json-xml-yaml"><span class="toc-number">1.5.1.</span> <span class="toc-text"> JSON, XML, YAML</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#protobuf"><span class="toc-number">1.5.2.</span> <span class="toc-text"> ProtoBuf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#html"><span class="toc-number">1.5.3.</span> <span class="toc-text"> HTML</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文件服务"><span class="toc-number">1.6.</span> <span class="toc-text"> 文件服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#静态文件服务"><span class="toc-number">1.6.1.</span> <span class="toc-text"> 静态文件服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件数据服务"><span class="toc-number">1.6.2.</span> <span class="toc-text"> 文件数据服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#用-reader-数据响应"><span class="toc-number">1.6.3.</span> <span class="toc-text"> 用 Reader 数据响应</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模型绑定"><span class="toc-number">1.7.</span> <span class="toc-text"> 模型绑定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#中间件"><span class="toc-number">1.8.</span> <span class="toc-text"> 中间件</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://clownote.github.io/2020/09/03/blog/Gin_quick_start/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://clownote.github.io/2020/09/03/blog/Gin_quick_start/&text=Gin入门"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://clownote.github.io/2020/09/03/blog/Gin_quick_start/&title=Gin入门"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://clownote.github.io/2020/09/03/blog/Gin_quick_start/&is_video=false&description=Gin入门"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Gin入门&body=Check out this article: https://clownote.github.io/2020/09/03/blog/Gin_quick_start/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://clownote.github.io/2020/09/03/blog/Gin_quick_start/&title=Gin入门"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://clownote.github.io/2020/09/03/blog/Gin_quick_start/&title=Gin入门"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://clownote.github.io/2020/09/03/blog/Gin_quick_start/&title=Gin入门"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://clownote.github.io/2020/09/03/blog/Gin_quick_start/&title=Gin入门"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://clownote.github.io/2020/09/03/blog/Gin_quick_start/&name=Gin入门&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2020 CDFMLR
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="https://github.com/cdfmlr">项目</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.css">

    <!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<!-- clipboard -->

  <script src="/lib/clipboard/clipboard.min.js"></script>
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight .code pre").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>

<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-146911386-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

    <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?9a0d2e6fde93dad496ac79f04f3aba97";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

<!-- Disqus Comments -->


<!--Livere Comments-->

    <script type="text/javascript">
      (function (d, s) {
        var j, e = d.getElementsByTagName(s)[0];

        if (typeof LivereTower === 'function') { return; }

        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;

        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>

</body>
</html>
