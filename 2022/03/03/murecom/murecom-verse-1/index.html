<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="一种(简单的)基于心情的音乐推荐系统 项目完整源码：https:&#x2F;&#x2F;github.com&#x2F;cdfmlr&#x2F;murecom-verse-1  你什么时候听音乐？快乐的时候，悲伤的时候，兴奋的时候，失落的时候……时时刻刻。 你听什么音乐？欢快的音乐，治愈的音乐，浪漫的音乐，伤感的音乐……因时而异，因心情而定。 传统的推荐系统做了什么？忠实记录你历史上任意时刻的所有听歌记录，拿去和别的用户比较，推荐他们喜">
<meta property="og:type" content="article">
<meta property="og:title" content="让AI看懂你的心情，并推荐应景的音乐，以一种简单的实现">
<meta property="og:url" content="https://clownote.github.io/2022/03/03/murecom/murecom-verse-1/index.html">
<meta property="og:site_name" content="clownote">
<meta property="og:description" content="一种(简单的)基于心情的音乐推荐系统 项目完整源码：https:&#x2F;&#x2F;github.com&#x2F;cdfmlr&#x2F;murecom-verse-1  你什么时候听音乐？快乐的时候，悲伤的时候，兴奋的时候，失落的时候……时时刻刻。 你听什么音乐？欢快的音乐，治愈的音乐，浪漫的音乐，伤感的音乐……因时而异，因心情而定。 传统的推荐系统做了什么？忠实记录你历史上任意时刻的所有听歌记录，拿去和别的用户比较，推荐他们喜">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/e6c9d24ely1gzwuuw476gj21p10u0gpn.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/e6c9d24ely1gzwuutvp0dj21ks0imt9x.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/e6c9d24ely1gzwuuuxmv4j20td0a4aar.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/e6c9d24ely1gzwuuvj3imj21iw0fuwhg.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/e6c9d24ely1gzwuuugc52j20e609gaaj.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/e6c9d24ely1gzwuuwqpl8j21jm0u043u.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/e6c9d24ely1gzwuuy520cj21r00poq8e.jpg">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/e6c9d24ely1gzwuuz27y4j21ta0qw0yf.jpg">
<meta property="article:published_time" content="2022-03-03T18:44:59.976Z">
<meta property="article:modified_time" content="2022-03-10T10:36:45.740Z">
<meta property="article:author" content="CDFMLR">
<meta property="article:tag" content="CDFMLR, blogs">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tva1.sinaimg.cn/large/e6c9d24ely1gzwuuw476gj21p10u0gpn.jpg">
    
    
        
          
              <link rel="shortcut icon" href="/images/rabbit.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/rabbit_192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/rabbit_180.png">
          
        
    
    <!-- title -->
    <title>让AI看懂你的心情，并推荐应景的音乐，以一种简单的实现</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
    <!--Google search varification (PRIVATE)-->
    <meta name="google-site-verification" content="MrqlpFAD8nDanw3Ypv7ZsIWHLnTdhRuLa4QhSVwxIvc" />
    <!--Google AdSense 关联 (PRIVATE)-->
    <script data-ad-client="ca-pub-1510963483941114" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/cdfmlr">项目</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2022/03/10/blog/latex-mac/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2022/01/24/murecom/murecom-intro/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://clownote.github.io/2022/03/03/murecom/murecom-verse-1/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://clownote.github.io/2022/03/03/murecom/murecom-verse-1/&text=让AI看懂你的心情，并推荐应景的音乐，以一种简单的实现"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://clownote.github.io/2022/03/03/murecom/murecom-verse-1/&title=让AI看懂你的心情，并推荐应景的音乐，以一种简单的实现"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://clownote.github.io/2022/03/03/murecom/murecom-verse-1/&is_video=false&description=让AI看懂你的心情，并推荐应景的音乐，以一种简单的实现"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=让AI看懂你的心情，并推荐应景的音乐，以一种简单的实现&body=Check out this article: https://clownote.github.io/2022/03/03/murecom/murecom-verse-1/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://clownote.github.io/2022/03/03/murecom/murecom-verse-1/&title=让AI看懂你的心情，并推荐应景的音乐，以一种简单的实现"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://clownote.github.io/2022/03/03/murecom/murecom-verse-1/&title=让AI看懂你的心情，并推荐应景的音乐，以一种简单的实现"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://clownote.github.io/2022/03/03/murecom/murecom-verse-1/&title=让AI看懂你的心情，并推荐应景的音乐，以一种简单的实现"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://clownote.github.io/2022/03/03/murecom/murecom-verse-1/&title=让AI看懂你的心情，并推荐应景的音乐，以一种简单的实现"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://clownote.github.io/2022/03/03/murecom/murecom-verse-1/&name=让AI看懂你的心情，并推荐应景的音乐，以一种简单的实现&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E7%A7%8D-%E7%AE%80%E5%8D%95%E7%9A%84-%E5%9F%BA%E4%BA%8E%E5%BF%83%E6%83%85%E7%9A%84%E9%9F%B3%E4%B9%90%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.</span> <span class="toc-text">一种(简单的)基于心情的音乐推荐系统</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%83%B3%E6%B3%95"><span class="toc-number">1.1.</span> <span class="toc-text">想法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.2.</span> <span class="toc-text">设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.</span> <span class="toc-text">实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9F%B3%E4%B9%90%E6%95%B0%E6%8D%AE"><span class="toc-number">1.3.1.</span> <span class="toc-text">音乐数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E6%96%87%E6%9C%AC%E6%83%85%E6%84%9F%E5%88%86%E6%9E%90"><span class="toc-number">1.3.2.</span> <span class="toc-text">中文文本情感分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B2%E7%9B%AE%E6%83%85%E6%84%9F%E6%A0%87%E6%B3%A8"><span class="toc-number">1.3.3.</span> <span class="toc-text">曲目情感标注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E6%96%87%E6%9C%AC%E8%BF%9B%E8%A1%8C%E5%BF%83%E6%83%85%E9%9F%B3%E4%B9%90%E6%8E%A8%E8%8D%90"><span class="toc-number">1.3.4.</span> <span class="toc-text">从文本进行心情音乐推荐</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E4%BA%BA%E7%89%A9%E6%83%85%E7%BB%AA%E8%AF%86%E5%88%AB"><span class="toc-number">1.3.5.</span> <span class="toc-text">图片人物情绪识别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%98%E5%88%B7%E8%84%B8%E2%80%99%E5%BF%83%E6%83%85%E9%9F%B3%E4%B9%90%E6%8E%A8%E8%8D%90"><span class="toc-number">1.3.6.</span> <span class="toc-text">‘刷脸’心情音乐推荐</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">1.4.</span> <span class="toc-text">问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE%E4%B8%8E%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.5.</span> <span class="toc-text">参考文献与项目</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        让AI看懂你的心情，并推荐应景的音乐，以一种简单的实现
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">clownote</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-03-03T18:44:59.976Z" itemprop="datePublished">2022-03-03</time>
        
        (Updated: <time datetime="2022-03-10T10:36:45.740Z" itemprop="dateModified">2022-03-10</time>)
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="一种-简单的-基于心情的音乐推荐系统"><a href="#一种-简单的-基于心情的音乐推荐系统" class="headerlink" title="一种(简单的)基于心情的音乐推荐系统"></a>一种(简单的)基于心情的音乐推荐系统</h1><blockquote>
<p>项目完整源码：<a target="_blank" rel="noopener" href="https://github.com/cdfmlr/murecom-verse-1">https://github.com/cdfmlr/murecom-verse-1</a></p>
</blockquote>
<p>你什么时候听音乐？快乐的时候，悲伤的时候，兴奋的时候，失落的时候……时时刻刻。</p>
<p>你听什么音乐？欢快的音乐，治愈的音乐，浪漫的音乐，伤感的音乐……因时而异，因心情而定。</p>
<p>传统的推荐系统做了什么？忠实记录你历史上任意时刻的所有听歌记录，拿去和别的用户比较，推荐他们喜欢的歌给你。。。不管你现在什么心情，不管你想听什么类型。这种东西往往不太懂我。</p>
<p>我是个情绪复杂的人，我早上醒来可能任沉浸在梦里，异常低落，我需要 Sasha Sloan；开始做事情要让脑子活过来，我需要 ZUTOMAYO；中午的疲惫下让 Evan Call 调整心情；午后的阳光里让 Bach 带我创作；日落时分的脑子被思念塞满，这时的 Halsey 也许不错；深夜凉爽的霓虹散发迷离的美，这时的爵士与嘻哈绝配，给我来一段 Nujabes。</p>
<p>不同时刻，不同场景，不同心情，给你听不同的歌，这就是一个基于心情的推荐系统。</p>
<p>（我认为时刻与场景作用于心情从而影响人，所以基于心情，而不是场景或时刻等外在因素）</p>
<h2 id="想法"><a href="#想法" class="headerlink" title="想法"></a>想法</h2><p>如何基于心情推荐？</p>
<p>首先，我们需要知道一首歌对应什么心情——(也许是)最简单的方法：分析歌名、歌词、以及热心网友的精彩评论。从文本获取情感，可以用比较简单的实现：每个词会对应一些既定的情感，只要<del>当地新华书店购买</del>一本「情感词典」就容易获取一个句子的情感。</p>
<p>然后，我们需要知道用户目前的心情。可以让用户输入一段话、一首诗、一篇文学大作。析文本中的情感，和前面处理歌曲如出一辙。“但我就听个歌诶，你还要让我写作，我讨厌语文，我不是诗人。”那么，对于这种不浪漫的用户，我们假设他情感比较直接，开心还是忧伤，全写在脸上，一看便知——考虑从人像识别情感。</p>
<p>最后，用户的心情与数据库中歌曲的心情一比较，找出最接近的，推荐出来，完成。</p>
<h2 id="设计"><a href="#设计" class="headerlink" title="设计"></a>设计</h2><p>想法很简单，但能实现嘛？先看看我们需要做什么。</p>
<ul>
<li>音乐数据（包括歌词、评论等）：我们可以从网易云音乐获取：网易云拥有“丰富”的曲库，“完善”的歌词，“精彩”的评论；</li>
<li>文本 =&gt; 情感：前面提到需要一个情感词典，大连理工大学的大佬们做了这样的一个<strong>情感词汇本体词典</strong>，心怀感激地拿来用：<a target="_blank" rel="noopener" href="http://ir.dlut.edu.cn/info/1013/1142.htm">http://ir.dlut.edu.cn/info/1013/1142.htm</a></li>
<li>图像 =&gt; 情感：也有大佬做过这个：<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2003.13401.pdf">Context Based Emotion Recognition using Emotic Dataset</a>，有开源的实现，可以心怀感激地拿来用：<a target="_blank" rel="noopener" href="https://github.com/Tandon-A/emotic">https://github.com/Tandon-A/emotic</a></li>
<li>心情比较、推荐：KNN，这个简单，Sk-learn 随便做，当然也是心怀感激地。</li>
</ul>
<p>所以说这个系统还是比较简单的。</p>
<p>在开始实现之前，我们还需要讨论一点细节。大连理工情感词典（以下简称 DLUT）把情感分成了 7 大类，21 小类，而那个外国的图像情感识别（以下简称 Emotic） 把情感分成了 26 类。我们需要胶合一下，把二者对应起来。这里我们选择以 DLUT 为主，将 Emotic 的分类映射到 DLUT：</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th>DLUT</th>
<th></th>
<th>Emotic</th>
</tr>
</thead>
<tbody><tr>
<td>编号</td>
<td>情感大类</td>
<td>情感类</td>
<td>例词</td>
<td>emotion categories with definitions</td>
</tr>
<tr>
<td>1</td>
<td>乐</td>
<td>快乐(PA)</td>
<td>喜悦、欢喜、笑眯眯、欢天喜地</td>
<td><strong>17. Happiness</strong>: feeling delighted; feeling enjoyment or amusement<br /><strong>20. Pleasure</strong>: feeling of delight in the senses</td>
</tr>
<tr>
<td>2</td>
<td></td>
<td>安心(PE)</td>
<td>踏实、宽心、定心丸、问心无愧</td>
<td><strong>6. Confidence</strong>: feeling of being certain; conviction that an outcome will be favorable; encouraged; proud<br /><strong>19. Peace</strong>: well being and relaxed; no worry; having positive thoughts or sensations; satisfied</td>
</tr>
<tr>
<td>3</td>
<td>好</td>
<td>尊敬(PD)</td>
<td>恭敬、敬爱、毕恭毕敬、肃然起敬</td>
<td><strong>13. Esteem</strong>: feelings of favourable opinion or judgement; respect; admiration; gratefulness</td>
</tr>
<tr>
<td>4</td>
<td></td>
<td>赞扬(PH)</td>
<td>英俊、优秀、通情达理、实事求是</td>
<td><strong>14. Excitement</strong>: feeling enthusiasm; stimulated; energetic</td>
</tr>
<tr>
<td>5</td>
<td></td>
<td>相信(PG)</td>
<td>信任、信赖、可靠、毋庸置疑</td>
<td><strong>4. Anticipation</strong>: state of looking forward; hoping on or getting prepared for possible future events<br /><strong>12. Engagement</strong>: paying attention to something; absorbed into something; curious; intereste</td>
</tr>
<tr>
<td>6</td>
<td></td>
<td>喜爱(PB)</td>
<td>倾慕、宝贝、一见钟情、爱不释手</td>
<td><strong>1. Affection</strong>: fond feelings; love; tenderness</td>
</tr>
<tr>
<td>7</td>
<td></td>
<td>祝愿(PK)</td>
<td>渴望、保佑、福寿绵长、万寿无疆</td>
<td><strong>4. Anticipation</strong>: state of looking forward; hoping on or getting prepared for possible future events</td>
</tr>
<tr>
<td>8</td>
<td>怒</td>
<td>愤怒(NA)</td>
<td>气愤、恼火、大发雷霆、七窍生烟</td>
<td><strong>2. Anger</strong>: intense displeasure or rage; furious; resentful</td>
</tr>
<tr>
<td>9</td>
<td>哀</td>
<td>悲伤(NB)</td>
<td>忧伤、悲苦、心如刀割、悲痛欲绝</td>
<td><strong>21. Sadness</strong>: feeling unhappy, sorrow, disappointed, or discouraged<br /><strong>23. Suffering</strong>: psychological or emotional pain; distressed; an- guished<br /><strong>22. Sensitivity</strong>: feeling of being physically or emotionally wounded; feeling delicate or vulnerable</td>
</tr>
<tr>
<td>10</td>
<td></td>
<td>失望(NJ)</td>
<td>憾事、绝望、灰心丧气、心灰意冷</td>
<td><strong>5. Aversion</strong>: feeling disgust, dislike, repulsion; feeling hate<br /><strong>21. Sadness</strong>: feeling unhappy, sorrow, disappointed, or discouraged</td>
</tr>
<tr>
<td>11</td>
<td></td>
<td>疚(NH)</td>
<td>内疚、忏悔、过意不去、问心有愧</td>
<td><strong>25. Sympathy</strong>: state of sharing others emotions, goals or troubles; supportive; compassionate</td>
</tr>
<tr>
<td>12</td>
<td></td>
<td>思(PF)</td>
<td>思念、相思、牵肠挂肚、朝思暮想</td>
<td><strong>15. Fatigue</strong>: weariness; tiredness; sleepy</td>
</tr>
<tr>
<td>13</td>
<td>惧</td>
<td>慌(NI)</td>
<td>慌张、心慌、不知所措、手忙脚乱</td>
<td><strong>18. Pain</strong>: physical suffering<br /><strong>3. Annoyance</strong>: bothered by something or someone; irritated; impa- tient; frustrated</td>
</tr>
<tr>
<td>14</td>
<td></td>
<td>恐惧(NC)</td>
<td>胆怯、害怕、担惊受怕、胆颤心惊</td>
<td><strong>16. Fear</strong>: feeling suspicious or afraid of danger, threat, evil or pain; horror</td>
</tr>
<tr>
<td>15</td>
<td></td>
<td>羞(NG)</td>
<td>害羞、害臊、面红耳赤、无地自容</td>
<td><strong>11. Embarrassment</strong>: feeling ashamed or guilty</td>
</tr>
<tr>
<td>16</td>
<td>恶</td>
<td>烦闷(NE)</td>
<td>憋闷、烦躁、心烦意乱、自寻烦恼</td>
<td><strong>9. Disquietment</strong>: nervous; worried; upset; anxious; tense; pres- sured; alarmed<br /><strong>8. Disconnection</strong>: feeling not interested in the main event of the surrounding; indifferent; bored; distracted</td>
</tr>
<tr>
<td>17</td>
<td></td>
<td>憎恶(ND)</td>
<td>反感、可耻、恨之入骨、深恶痛绝</td>
<td><strong>5. Aversion</strong>: feeling disgust, dislike, repulsion; feeling hate<br /><strong>7. Disapproval</strong>: feeling that something is wrong or reprehensible; contempt; hostile</td>
</tr>
<tr>
<td>18</td>
<td></td>
<td>贬责(NN)</td>
<td>呆板、虚荣、杂乱无章、心狠手辣</td>
<td><strong>3. Annoyance</strong>: bothered by something or someone; irritated; impa- tient; frustrated<br /></td>
</tr>
<tr>
<td>19</td>
<td></td>
<td>妒忌(NK)</td>
<td>眼红、吃醋、醋坛子、嫉贤妒能</td>
<td><strong>26. Yearning</strong>: strong desire to have something; jealous; envious; lust</td>
</tr>
<tr>
<td>20</td>
<td></td>
<td>怀疑(NL)</td>
<td>多心、生疑、将信将疑、疑神疑鬼</td>
<td><strong>10. Doubt/Confusion</strong>: difficulty to understand or decide; thinking about different options</td>
</tr>
<tr>
<td>21</td>
<td>惊</td>
<td>惊奇(PC)</td>
<td>奇怪、奇迹、大吃一惊、瞠目结舌</td>
<td><strong>24. Surprise</strong>: sudden discovery of something unexpected</td>
</tr>
</tbody></table>
<p>(这个映射我随便写的，有待商榷)</p>
<p>没有任何难点，直接撸代码。</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="音乐数据"><a href="#音乐数据" class="headerlink" title="音乐数据"></a>音乐数据</h3><p>在 <code>ncm</code> 目录下，我们从网易云获取了一些数据：</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzwuuw476gj21p10u0gpn.jpg" alt="db"></p>
<p>和我们<a target="_blank" rel="noopener" href="https://juejin.cn/post/7056759330472722469">上一篇文章</a>获取 Spotify 的数据不同，网易云有个特点——歌单里面曲目多，所以我们获取了不到 1 万张列表，就得到了 20 万首歌曲，100 万条热门评论。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ncm<span class="operator">=</span># <span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> playlists;</span><br><span class="line">  <span class="number">8426</span></span><br><span class="line"></span><br><span class="line">ncm<span class="operator">=</span># <span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> tracks;</span><br><span class="line"> <span class="number">219038</span></span><br><span class="line"></span><br><span class="line">ncm<span class="operator">=</span># <span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> comments;</span><br><span class="line"> <span class="number">1052112</span></span><br></pre></td></tr></table></figure>

<p>获取数据的过程如下图所示：</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzwuutvp0dj21ks0imt9x.jpg" alt="ncm"></p>
<p>（在 git commit message 中有开发每一步更详细的说明）</p>
<p>这里使用了大量 Master/Worker 模式：</p>
<table>
<thead>
<tr>
<th>Master</th>
<th>Worker</th>
<th>Worker工作</th>
</tr>
</thead>
<tbody><tr>
<td>main</td>
<td>Master</td>
<td>按照配置，启动 Task</td>
</tr>
<tr>
<td>Master</td>
<td>Task</td>
<td>一个 Task 完成一组特定分类的播放列表收集</td>
</tr>
<tr>
<td>Task</td>
<td>FetchTopPlaylists</td>
<td>获取播放列表</td>
</tr>
<tr>
<td>Task</td>
<td>PlaylistWorks</td>
<td>完善一个播放列表及其中曲目的完整信息，并保存</td>
</tr>
<tr>
<td>PlaylistWorks</td>
<td>FetchTracks</td>
<td>获取一个播放列表中的全部曲目</td>
</tr>
<tr>
<td>PlaylistWorks</td>
<td>TrackWorks</td>
<td>完善一首歌曲的完整信息</td>
</tr>
<tr>
<td>TrackWorks</td>
<td>FetchLyrics</td>
<td>获取一首歌的歌词</td>
</tr>
<tr>
<td>TrackWorks</td>
<td>FetchComments</td>
<td>获取一首歌的热门评论</td>
</tr>
</tbody></table>
<p>这些各种 Worker 都是一个单独的 Goroutine，全在并发运行，靠 channel 传数据。</p>
<p>以及一些 C/S 模式：</p>
<table>
<thead>
<tr>
<th>Client Caller</th>
<th>Server</th>
<th>工作</th>
</tr>
</thead>
<tbody><tr>
<td>PlaylistWorks</td>
<td>DB（GORM）：PostgreSQL</td>
<td>保存数据</td>
</tr>
<tr>
<td>FetchXxx</td>
<td>ncmapi</td>
<td>完成网络请求，获取数据</td>
</tr>
</tbody></table>
<p>数据库和网络作为数据入口/出口，以 C/S 模式来访问，各自集中维护自己的链接池。</p>
<p>（<code>ncm</code> 是个实验性的程序，效率并不高。我只是想尝试在编程时去面向对象化，尝试回归比较纯粹的数据驱动、面向过程、函数式，就像 Rob Pike 的代码那样。）</p>
<h3 id="中文文本情感分析"><a href="#中文文本情感分析" class="headerlink" title="中文文本情感分析"></a>中文文本情感分析</h3><p>在 <code>emotext</code> 中，实现了利用大连理工大学情感本体库进行中文文本情感分析。</p>
<p>从 DLUT 的网站下载到情感词典：<a target="_blank" rel="noopener" href="http://ir.dlut.edu.cn/info/1013/1142.htm">http://ir.dlut.edu.cn/info/1013/1142.htm</a></p>
<p>它给的是 Excel 表格，为了方便，我们将其重新导出为 CSV 格式，得到的文件形如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">词语,词性种类,词义数,词义序号,情感分类,强度,极性,辅助情感分类,强度,极性</span><br><span class="line">脏乱,adj,1,1,NN,7,2,,,</span><br><span class="line">糟报,adj,1,1,NN,5,2,,,</span><br><span class="line">战祸,noun,1,1,ND,5,2,NC,5,2</span><br><span class="line">招灾,adj,1,1,NN,5,2,,,</span><br></pre></td></tr></table></figure>

<p>接下来，要把这个大表读到程序里。我们把「词语 + 情感」视为一个 Word 对象，如果一个词有「辅助情感分类」则把它看成两个 Word：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Word</span>:</span></span><br><span class="line">    word: <span class="built_in">str</span></span><br><span class="line">    emotion: <span class="built_in">str</span></span><br><span class="line">    intensity: <span class="built_in">int</span>  <span class="comment"># 情感强度: 分为 1, 3, 5, 7, 9 五档，9 表示强度最大，1 为强度最小。</span></span><br><span class="line">    polarity: Polarity</span><br></pre></td></tr></table></figure>

<p>再写一个 Emotions 类来放所有的这些 Word 即对应情感。用一个 <code>self.words</code> dict，把每种情感的 Word 分开放。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Emotions</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.words = &#123;emo: [] <span class="keyword">for</span> emo <span class="keyword">in</span> emotions&#125;  <span class="comment"># &#123;&quot;emotion&quot;: [words...]&#125;</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/path/to/dict.csv&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            self._read_dict(f)</span><br></pre></td></tr></table></figure>

<p>现在给定一个词汇，只需在表中查找，若存在，就到的了情感与对应强度（Word 对象）；若不存在，就认为这个词没有感情，直接忽略。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_find_word</span>(<span class="params">self, w: <span class="built_in">str</span></span>) -&gt; List[Word]:</span></span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">for</span> emotion, words_of_emotion <span class="keyword">in</span> self.words.items():</span><br><span class="line">        ws = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x.word, words_of_emotion))</span><br><span class="line">        <span class="keyword">if</span> w <span class="keyword">in</span> ws:</span><br><span class="line">            result.append(words_of_emotion[ws.index(w)])</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>

<p>而给定一个句子，则先进行分词，取出句子中的前 20 个关键词，做前面的查表分析，将所有得到的关键词情感累加，就得到了句子的情感：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">emotion_count</span>(<span class="params">self, text</span>) -&gt; Emotions:</span></span><br><span class="line">    emotions = empty_emotions()</span><br><span class="line"></span><br><span class="line">    keywords = jieba.analyse.extract_tags(text, withWeight=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> word, weight <span class="keyword">in</span> keywords:</span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> self._find_word(word):</span><br><span class="line">            emotions[w.emotion] += w.intensity * weight</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> emotions</span><br></pre></td></tr></table></figure>

<p>如果你不喜欢看文字叙述，也不爱阅读代码，那么可以数学一下。这里我们使用 TF-IDF 算法抽取关键词：</p>
<ul>
<li>TF（term frequency, 词频）：字词的重要性随着它在文件中出现的次数成正比增加，但同时会随着它在语料库中出现的频率成反比下降：${\displaystyle \mathrm {tf} (t,d)={\frac {f_{t,d}}{\sum <em>{t’\in d}{f</em>{t’,d}}}}}$</li>
<li>IDF（inverse document frequency, 逆向文件频率）：由总文件数目除以包含该词语之文件的数目，再将得到的商取对数：$ \mathrm{idf}(t, D) = \log \frac{N}{|{d \in D: t \in d}|}$，这里 $D$ 使用默认的常见词典。</li>
<li>TF-IDF 权重就是把两个乘起来，达到过滤掉常见的词语，保留重要的词语的目的：${\displaystyle \mathrm {tfidf} (t,d,D)=\mathrm {tf} (t,d)\cdot \mathrm {idf} (t,D)}$</li>
<li>将词语按照得到的 tfidf 权重从大到小排序，取前 20 个作为关键词。</li>
<li>我们认为关键词最终的情感 $E_t$ 为由该词语的情感强度 $I_t$ （查字典得到）以及它的 TF-IDF 权共同决定：$\mathrm{E}_t=I_t \cdot \mathrm {tfidf} (t,d,D)$</li>
<li>那么文本 $d$ 最终的总情感为所有关键词情感的叠加：</li>
</ul>
<p>$$<br>E(d)=\sum_{t \in \mathrm{key}(d, D)}I_t\cdot \mathrm {tfidf} (t,d,D)<br>$$</p>
<p>这里我们并没有分析句子的连续特征，只是简单的用关键词分析，但对于分析常见的，不是藏的非常深的句子已经可以用了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = <span class="string">&#x27;后悔也都没有用 还不如一切没有发生过 不过就是又少一个诗人 换一个人沉迷你的笑&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = Emotext.emotion_count(t)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r.emotions = softmax(r.emotions)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e = Emotion(**r.emotions)</span><br><span class="line">Emotion(PA=<span class="number">0.0</span>, PE=<span class="number">0.0</span>, PD=<span class="number">0.0</span>, PH=<span class="number">0.0</span>, PG=<span class="number">0.2428551306285703</span>, PB=<span class="number">0.0</span>, PK=<span class="number">0.0</span>, NA=<span class="number">0.0</span>, NB=<span class="number">0.0</span>, NJ=<span class="number">0.41260819965515805</span>, NH=<span class="number">0.175202571704109</span>, PF=<span class="number">0.0</span>, NI=<span class="number">0.0</span>, NC=<span class="number">0.0</span>, NG=<span class="number">0.0</span>, NE=<span class="number">0.1693340980121628</span>, ND=<span class="number">0.0</span>, NN=<span class="number">0.0</span>, NK=<span class="number">0.0</span>, NL=<span class="number">0.0</span>, PC=<span class="number">0.0</span>)</span><br></pre></td></tr></table></figure>

<p>这里我们获取到了 NJ、PG、NH、NE 的情感，即：失望，相信，内疚，和烦闷。差不多，至于文字下埋藏的爱意，我们目前这种方式并不能让计算机理解，这是个缺陷。</p>
<p>注意到这个例子中，我们在算法外面做了 softmax，将情感权重值映射为各种情感的概率。但我们没有在算法内部进行 softmax，是因为在下面的曲目情感标注的过程中，对一首歌，我们需要处理多个文本（歌名、歌词、多条评论），其中可能有的文本情感丰富饱满，而有的干涩无情。如果在算法内部做 softmax，则它们的情感总量都会被拉到 1，我们不想要这种平均主义。我们要保留每句话的情感真实大小，情感大的重要，没感情的忽略。所以我们要在处理过程中保留每一个文本的绝对大小，最后累加完成后再做 softmax。</p>
<h3 id="曲目情感标注"><a href="#曲目情感标注" class="headerlink" title="曲目情感标注"></a>曲目情感标注</h3><p>接下来，利用刚才实现好的 emotext 文本情感分析工具，我们就可以分析曲目情感。</p>
<p>对于一首歌曲，将其歌名、歌词以及热门评论送入 emotext 进行情感分析：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">track_emotion</span>(<span class="params">t: Track</span>):</span></span><br><span class="line">    texts = [t.name, t.lyrics] + [c.content <span class="keyword">for</span> c <span class="keyword">in</span> t.comments]</span><br><span class="line">    weights = text_weights(t.name, t.lyrics, t.comments)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> text, weight <span class="keyword">in</span> <span class="built_in">zip</span>(texts, liked_weights):</span><br><span class="line">        emo_result = Emotext.emotion_count(text)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> emo_result.emotions.items():</span><br><span class="line">            track_emotions[k] += v * weight</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> softmax(track_emotions)</span><br></pre></td></tr></table></figure>

<p>其中的<code>weights</code> 是文本所占的权重：</p>
<ul>
<li>对于评论 $c$，我们认为点赞数 $Lc$ 越多，说明评论质量越高，所以权重 $w_c$ 和点赞数挂钩：$w_c=\log (L_c + 1)$</li>
<li>对于歌词 $l$，这是歌曲创作者情感的凝结，权重应该比任何评论更高：$w_l=\log(\sum L_c\cdot 10 + 2)$</li>
<li>对于歌名 $n$，权重应该是最高的，毕竟是名字诶：$w_n=\log(\sum L_c \cdot 20 +2)$</li>
</ul>
<p>在项目的 <code>emotracks</code> 子目录中实现了这些东西，遍历数据库中所有曲目，分析并写入情感信息：</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzwuuuxmv4j20td0a4aar.jpg" alt="track_emotions"></p>
<h3 id="从文本进行心情音乐推荐"><a href="#从文本进行心情音乐推荐" class="headerlink" title="从文本进行心情音乐推荐"></a>从文本进行心情音乐推荐</h3><p>完成标注之后，就可以做基于情感的音乐推荐了。实现方式和我们<a target="_blank" rel="noopener" href="https://juejin.cn/post/7056759330472722469">上一篇文章</a>里做基于音频特征的音乐推荐类似。(这个基于情感的推荐的思路，本质上来说，只是另外一种基于内容的推荐 CBF。)</p>
<p>在那篇文章中，我们分析音乐频谱，对每首歌得到一个 256 维的「音乐特征向量」，将该向量交给一个无监督的最近邻模型，推荐出最相似的歌。</p>
<p>而现在，在 <code>recommend-text.ipynb</code> 里，我们那标注好的 21 种情感作为曲目的「情感特征向量」：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Emotion = namedtuple(<span class="string">&#x27;Emotion&#x27;</span>, emotext.emotions)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">emotion_vector</span>(<span class="params">emotions: List[TrackEmotion]</span>) -&gt; Emotion:</span></span><br><span class="line">    elems = <span class="built_in">dict</span>.fromkeys(emotext.emotions, <span class="number">0.0</span>)</span><br><span class="line">    elems.update(&#123;x.emotion: x.intensity <span class="keyword">for</span> x <span class="keyword">in</span> emotions&#125;)</span><br><span class="line">    <span class="keyword">return</span> Emotion(**elems)</span><br></pre></td></tr></table></figure>

<p>然后就和之前同样的，建立数据集，训练 KNN 模型。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">data = &#123; <span class="string">&#x27;ids&#x27;</span>: [], <span class="string">&#x27;emo&#x27;</span>: [] &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># query db</span></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> session.query(Track).order_by(Track.pop.desc(), Track.<span class="built_in">id</span>):</span><br><span class="line">    data[<span class="string">&#x27;ids&#x27;</span>].append(t.<span class="built_in">id</span>)</span><br><span class="line">    data[<span class="string">&#x27;emo&#x27;</span>].append(emotion_vector(t.track_emotions_collection))</span><br><span class="line"></span><br><span class="line">X = np.array(data)</span><br><span class="line"></span><br><span class="line">nbrs = NearestNeighbors(</span><br><span class="line">    n_neighbors=<span class="number">10</span>, </span><br><span class="line">    algorithm=<span class="string">&#x27;ball_tree&#x27;</span></span><br><span class="line">).fit(X)</span><br></pre></td></tr></table></figure>

<p>训练完就可以让用户输入文本，分析其中情感，送入模型中，找出最近的邻居，即得到了推荐的曲目。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recommend_from_text</span>(<span class="params">text: <span class="built_in">str</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;给文本，算情感，找近邻，作推荐</span></span><br><span class="line"><span class="string">    :return: (emotion, distances, tracks): 计算得到的 text 情感，和推荐结果：距离与曲目</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># emotext</span></span><br><span class="line">    r = Emotext.emotion_count(text)</span><br><span class="line">    e = Emotion(**softmax(r.emotions))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># recommend</span></span><br><span class="line">    distances, indices = nbrs.kneighbors([e], <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># result tracks</span></span><br><span class="line">    tracks = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(indices[<span class="number">0</span>])):</span><br><span class="line">        tid = data[<span class="string">&#x27;ids&#x27;</span>][indices[<span class="number">0</span>][i]]</span><br><span class="line">        t = session.query(Track).where(Track.<span class="built_in">id</span> == tid)[<span class="number">0</span>]</span><br><span class="line">        tracks.append(t)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> e, distances, tracks</span><br></pre></td></tr></table></figure>

<p>沿用前面的例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = <span class="string">&#x27;后悔也都没有用 还不如一切没有发生过 不过就是又少一个诗人 换一个人沉迷你的笑&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>emotion, distances, tracks = recommend_from_text(t)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print_nbrs(distances, tracks)</span><br><span class="line">dist=<span class="number">0.3137</span>: (<span class="number">108983</span>)	  会有那么一天 - [<span class="string">&#x27;林俊杰&#x27;</span>]</span><br><span class="line">dist=<span class="number">0.3740</span>: (<span class="number">27731486</span>)	  Talk Dirty (feat. <span class="number">2</span> Chainz) - [<span class="string">&#x27;Jason Derulo&#x27;</span>, <span class="string">&#x27;2 Chainz&#x27;</span>]</span><br><span class="line">dist=<span class="number">0.3758</span>: (<span class="number">1329999687</span>) <span class="number">50</span> Feet - [<span class="string">&#x27;SoMo&#x27;</span>]</span><br><span class="line">dist=<span class="number">0.3804</span>: (<span class="number">210287</span>)	  遗憾 - [<span class="string">&#x27;陈洁仪&#x27;</span>]</span><br><span class="line">dist=<span class="number">0.3808</span>: (<span class="number">307018</span>)	  遗憾 - [<span class="string">&#x27;许美静&#x27;</span>]</span><br><span class="line">dist=<span class="number">0.3980</span>: (<span class="number">25650033</span>)	  遗憾 - [<span class="string">&#x27;李代沫&#x27;</span>]</span><br><span class="line">dist=<span class="number">0.4004</span>: (<span class="number">424262521</span>)  Rolling <span class="keyword">in</span> the deep - [<span class="string">&#x27;廖佳琳&#x27;</span>]</span><br><span class="line">dist=<span class="number">0.4019</span>: (<span class="number">1943186</span>)	  Blanc - [<span class="string">&#x27;Sylvain Chauveau&#x27;</span>]</span><br><span class="line">dist=<span class="number">0.4051</span>: (<span class="number">17405587</span>)	  Still D.R.E. - [<span class="string">&#x27;Snoop Dogg&#x27;</span>, <span class="string">&#x27;Dr. Dre&#x27;</span>]</span><br><span class="line">dist=<span class="number">0.4052</span>: (<span class="number">34834450</span>)	  雷克雅未克 - [<span class="string">&#x27;麦浚龙&#x27;</span>, <span class="string">&#x27;周国贤&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>不说推荐的有多好，起码一堆遗憾看名字就比较符合心情了。</p>
<p>当然，我们也可以不写小作文，直接写个关键词，也能推荐出适合心情的歌曲：</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzwuuvj3imj21iw0fuwhg.jpg" alt="截屏2022-03-03 09.58.37"></p>
<h3 id="图片人物情绪识别"><a href="#图片人物情绪识别" class="headerlink" title="图片人物情绪识别"></a>图片人物情绪识别</h3><p>接下来，这个比较有意思了：拍张照片，识别心情，推荐音乐。</p>
<p>我们主要是做音乐推荐系统，不想深陷计算机视觉的泥沼，所以用一点开源的实现：<a target="_blank" rel="noopener" href="https://github.com/Tandon-A/emotic">https://github.com/Tandon-A/emotic</a> （我 Fork 修改了一点点他的实现，并添加了一点边缘功能，作为一个 git submodule: <a target="_blank" rel="noopener" href="https://github.com/cdfmlr/emotic%EF%BC%89">https://github.com/cdfmlr/emotic）</a></p>
<p>大佬提供了完整的代码和训练好的模型。把代码 clone 下来，数据也下载下来。我们在 <code>emopic</code> 目录里堆放这些东西：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">emopic</span><br><span class="line">├── emotic</span><br><span class="line">│   ├── Colab_train_emotic.ipynb</span><br><span class="line">│   ├── README.md</span><br><span class="line">│   ├── emotic.py</span><br><span class="line">│   ├── ...</span><br><span class="line">│   └── yolo_utils.py</span><br><span class="line">├── experiment</span><br><span class="line">│   └── inference_file.txt</span><br><span class="line">├── models</span><br><span class="line">│   ├── model_body1.pth</span><br><span class="line">│   ├── model_context1.pth</span><br><span class="line">│   ├── model_emotic1.pth</span><br><span class="line">└── results</span><br><span class="line">    └── val_thresholds.npy</span><br></pre></td></tr></table></figure>

<p>安装好依赖的 pytorch、opencv-python 等模块后，就可以用这个东西了：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python3 emotic/yolo_inference.py --mode inference --inference_file experiment/inference_file.txt --experiment_path . --model_dir ./models</span><br></pre></td></tr></table></figure>

<p>（首次运行它会自己下载 YOLO 模型，可能用时较久，还有注意保持“网络通畅”）</p>
<p>这个东西接口有点复杂，你需要把要识别的图像绝对路径写到 <code>experiment/inference_file.txt</code> 里，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;Path&#x2F;to&#x2F;imgs&#x2F;26.jpg 10 10 1000 1000</span><br></pre></td></tr></table></figure>

<p>它会按指示读取文件，分析处理，把结果输出到 <code>result</code> 目录里。</p>
<p>当然这个项目还有其他好几种接口，总之是不太方便使用的，我重新封装了一个给人用的接口：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">yolo_emotic_infer</span>(<span class="params">image_file, verbose=<span class="literal">False</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Infer on an image_file to obtain bounding boxes of persons in the images using yolo model, and then get the emotions using emotic models.</span></span><br><span class="line"><span class="string">    :param image_file: image file to do inference: path str or a readable IO object</span></span><br><span class="line"><span class="string">    :param verbose: print the result</span></span><br><span class="line"><span class="string">    :return: infer result: a list of bbox of a person in the image,</span></span><br><span class="line"><span class="string">             the categorical Emotions dict and continuous emotion dimensions.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>这个就比较方便了：输入图片，输出结果列表：图片中的每个检测到的「人」一个对象，bbox 为人的边框坐标，cat 为离散的情感及其权重。（cont 是三种连续的情感，我们暂时用不到）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;bbox&#x27;</span>: [x1, y1, x2, y2], </span><br><span class="line">        <span class="string">&#x27;cat&#x27;</span>: &#123;<span class="string">&quot;Anger&quot;</span>: <span class="number">0.44</span>, ...&#125;, </span><br><span class="line">        <span class="string">&#x27;cont&#x27;</span>: [<span class="number">5.8</span>, <span class="number">7.1</span>, <span class="number">2.1</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>为了更方便使用，可以写一个简单的 HTTP 服务：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> aiohttp <span class="keyword">import</span> web</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">handle</span>(<span class="params">request</span>):</span></span><br><span class="line">    data = <span class="keyword">await</span> request.post()</span><br><span class="line">    img = data[<span class="string">&#x27;img&#x27;</span>].file</span><br><span class="line"></span><br><span class="line">    result = yolo_emotic_infer(img)</span><br><span class="line">    <span class="keyword">return</span> web.json_response(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = web.Application()</span><br><span class="line">app.add_routes([web.post(<span class="string">&#x27;/infer&#x27;</span>, handle)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    web.run_app(app)</span><br></pre></td></tr></table></figure>

<p>这样就容易以任何地方使用这个功能了，并且保持以 Daemon 形式运行，避免反复加载模型。</p>
<p>例如，我们给定一张图片：</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzwuuugc52j20e609gaaj.jpg" alt="女孩-伤心-肖像-沮丧-独自的-压力"></p>
<p>（图片来自 <a target="_blank" rel="noopener" href="https://pixabay.com/zh/photos/girl-sad-portrait-depression-alone-6059889/">Pixabay:  vdnhieu</a>，标签为：女孩、伤心、肖像、沮丧、独自的、压力）</p>
<p>访问服务即可得到结果：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -F <span class="string">&quot;img=@/test/imgs/26.jpg&quot;</span> http://localhost:8080/infer</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzwuuwqpl8j21jm0u043u.jpg" alt="emotic-result"></p>
<p>（左：emotic infer 响应的结果，右：emotic2emotext 转化后的 DLUT 情感）</p>
<p>可以看到机器确实识别出了图中人物的 Sadness，Suffering，Fatigue 这些情感。</p>
<p>为了和前面的工作对接，我们在 <code>emopic/emotic2emotext</code> 包中实现将 Emotic 的情感转化为 DLUT 字典情感的功能。</p>
<h3 id="‘刷脸’心情音乐推荐"><a href="#‘刷脸’心情音乐推荐" class="headerlink" title="‘刷脸’心情音乐推荐"></a>‘刷脸’心情音乐推荐</h3><p>接下来的工作，便是把这个图片人物情绪识别模块嫁接到心情音乐推荐系统上。</p>
<p>在 <code>recommend-pic.ipynb</code> 里面实现了这个。我们直接读取了 <code>recommend-text.ipynb</code> 里面处理好的数据集以及修炼好的模型：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data, nbrs = load_data_model(<span class="string">&#x27;savedata/7597.json&#x27;</span>, <span class="string">&#x27;savemodels/7597.joblib&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>把上一节的 cURL 命令翻译成 Python 代码，访问前面写好的服务，即可提取图片的「情感特征向量」：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">emotion_from_pic</span>(<span class="params">imgpath: <span class="built_in">str</span></span>) -&gt; Emotion:</span></span><br><span class="line">    emotic_result = requests.post(EMOPIC_SERVER, files=&#123;</span><br><span class="line">        <span class="string">&#x27;img&#x27;</span>: (imgpath, <span class="built_in">open</span>(imgpath, <span class="string">&#x27;rb&#x27;</span>)),</span><br><span class="line">    &#125;).json()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 总的情感</span></span><br><span class="line">    total_emotion = <span class="built_in">dict</span>.fromkeys(emotext.emotions, <span class="number">0.0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 人在图片中占的面积</span></span><br><span class="line">    area = <span class="keyword">lambda</span> bbox: (bbox[<span class="number">2</span>] - bbox[<span class="number">0</span>]) * (bbox[<span class="number">3</span>] - bbox[<span class="number">1</span>])</span><br><span class="line">    areas = [area(p[<span class="string">&#x27;bbox&#x27;</span>]) <span class="keyword">for</span> p <span class="keyword">in</span> emotic_result]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 转成 emotext 情感，面积大的人权重大</span></span><br><span class="line">    <span class="keyword">for</span> person, person_area <span class="keyword">in</span> <span class="built_in">zip</span>(emotic_result, areas):</span><br><span class="line">        person_emo = emotic2dlut(person[<span class="string">&#x27;cat&#x27;</span>], person[<span class="string">&#x27;cont&#x27;</span>])  <span class="comment"># 调用emotic2emotext包</span></span><br><span class="line">        weight = person_area / <span class="built_in">sum</span>(areas)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> emo, value <span class="keyword">in</span> person_emo.items():</span><br><span class="line">            total_emotion[emo] += value * weight</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Emotion(**softmax(total_emotion))</span><br></pre></td></tr></table></figure>

<p>这里我们把图片中识别到的所有人物都考虑进来，并且人物占图片面积越大，就认为越重要，权重越大。</p>
<p>最后，封装给图片推荐音乐的功能，和前面的 <code>recommend_from_text</code> 非常类似：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recommend_from_pic</span>(<span class="params">imgpath: <span class="built_in">str</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;给图片，算情感，找近邻，作推荐</span></span><br><span class="line"><span class="string">    :return: (emotion, distances, tracks): 计算得到的图片情感，和推荐结果：距离与曲目</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># get emotion</span></span><br><span class="line">    e = emotion_from_pic(imgpath)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># do recommend</span></span><br><span class="line">    distances, indices = nbrs.kneighbors([e], <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># result tracks</span></span><br><span class="line">    tracks = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(indices[<span class="number">0</span>])):</span><br><span class="line">        tid = data[<span class="string">&#x27;ids&#x27;</span>][indices[<span class="number">0</span>][i]]</span><br><span class="line">        t = session.query(Track).where(Track.<span class="built_in">id</span> == tid)[<span class="number">0</span>]</span><br><span class="line">        tracks.append(t)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> e, distances, tracks</span><br></pre></td></tr></table></figure>

<p>你现在就可以自己照一张照片，看看程序给你推荐什么样的音乐了。</p>
<p>对于前面例子那张伤心的图片，推荐结果如下：</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzwuuy520cj21r00poq8e.jpg" alt="推荐结果-女孩-伤心"></p>
<p>上来就 Say Something 了，够对味吧！（淦，我先去抑郁一下再接着写）后面的大多数也都很对这个画面，记事本、空白格什么的。毕竟是网抑云的数据，这种情绪给你拿捏的很准的。</p>
<p>再来一个例子：</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1gzwuuz27y4j21ta0qw0yf.jpg" alt="推荐结果-男女狗"></p>
<p>我不太懂电音，所以两首 Avicii 以及 Crazy Frog 不做评价，什么 DJ 版的也自动忽略（应该直接从数据库中把所有 DJ 版、抖音版全删了）。 另外几首 Pearl、林宥嘉、RADWIMPS、陈奕迅、TAZ 在这个场景做 BGM 都还是不错的吧，你可以把自己带入图中人物（或狗子）想象一下。只有 Hedwig’s Theme，，，似乎是机器想多了，我等麻瓜只能将其算作误推。</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>其实，如果你尝试更多的照片，或者文本，拿去推荐，有些结果是没这么好的，甚至非常差。我试过个两小孩打游戏大笑的图片，推荐出来全是伤心情歌。。。</p>
<p>我觉得比较大的问题是数据，网抑云数据杂乱，质量完全没保障。我还在想有没有构建更高质量数据集的方法。但目前我手上没有这种数据。</p>
<p>使用 DLUT 的 21 类情感是否合理也是个问题。我完全是为了实现方便而选择这种分类的。但我认为这个情感分类不如 Emotic 的。emotic 还有 3 个连续情感值，我们甚至都没有利用到。</p>
<p>还有，文本情感分析的模块，我们用了最简单的古老方法，只能说可以用，效果绝对谈不上好。我想用神经网络来做，应该效果会好得多。但没有数据。</p>
<p>大佬训练好的 Emotic 也是不太完美的，比如我本人的照片，不管笑多开心都是所有负面情绪叠满，识别不出一点正面的情感。（它倒是准确预言了我看到结果之后的心情。）要解决这个问题也是需要数据来微调模型。但没有数据。</p>
<hr>
<p>总之，如果你喜欢这个东西，欢迎 star、点赞吧；如果你有合适的数据或者其他改进的想法，请与我分享。</p>
<h2 id="参考文献与项目"><a href="#参考文献与项目" class="headerlink" title="参考文献与项目"></a>参考文献与项目</h2><p>[1] Binaryify. 网易云音乐 API. github.com/Binaryify/NeteaseCloudMusicApi</p>
<p>[2] 徐琳宏,林鸿飞,潘宇,等.情感词汇本体的构造[J]. 情报学报, 2008, 27(2): 180-185.</p>
<p>[3] hiDaDeng. 中文情感分析库. github.com/hiDaDeng/cnsenti</p>
<p>[4] Kosti R ,  Alvarez J M ,  Recasens A , et al. Context Based Emotion Recognition using EMOTIC Dataset[J].  2020.</p>
<p>[5] Tandon-A. PyTorch implementation of Emotic. github.com/Tandon-A/emotic</p>

  </div>
</article>
<!--Disqus-->


<!--Livere-->

    <div class="blog-post-comments">
        <div id="lv-container" data-id="city" data-uid="MTAyMC80NjEzMi8yMjY0Mw==">
            <noscript>不启用 JavaScript 支持的人是看不到可爱的评论区的。😥</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/cdfmlr">项目</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E7%A7%8D-%E7%AE%80%E5%8D%95%E7%9A%84-%E5%9F%BA%E4%BA%8E%E5%BF%83%E6%83%85%E7%9A%84%E9%9F%B3%E4%B9%90%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.</span> <span class="toc-text">一种(简单的)基于心情的音乐推荐系统</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%83%B3%E6%B3%95"><span class="toc-number">1.1.</span> <span class="toc-text">想法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.2.</span> <span class="toc-text">设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.</span> <span class="toc-text">实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9F%B3%E4%B9%90%E6%95%B0%E6%8D%AE"><span class="toc-number">1.3.1.</span> <span class="toc-text">音乐数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E6%96%87%E6%9C%AC%E6%83%85%E6%84%9F%E5%88%86%E6%9E%90"><span class="toc-number">1.3.2.</span> <span class="toc-text">中文文本情感分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B2%E7%9B%AE%E6%83%85%E6%84%9F%E6%A0%87%E6%B3%A8"><span class="toc-number">1.3.3.</span> <span class="toc-text">曲目情感标注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E6%96%87%E6%9C%AC%E8%BF%9B%E8%A1%8C%E5%BF%83%E6%83%85%E9%9F%B3%E4%B9%90%E6%8E%A8%E8%8D%90"><span class="toc-number">1.3.4.</span> <span class="toc-text">从文本进行心情音乐推荐</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E4%BA%BA%E7%89%A9%E6%83%85%E7%BB%AA%E8%AF%86%E5%88%AB"><span class="toc-number">1.3.5.</span> <span class="toc-text">图片人物情绪识别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%98%E5%88%B7%E8%84%B8%E2%80%99%E5%BF%83%E6%83%85%E9%9F%B3%E4%B9%90%E6%8E%A8%E8%8D%90"><span class="toc-number">1.3.6.</span> <span class="toc-text">‘刷脸’心情音乐推荐</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">1.4.</span> <span class="toc-text">问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE%E4%B8%8E%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.5.</span> <span class="toc-text">参考文献与项目</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://clownote.github.io/2022/03/03/murecom/murecom-verse-1/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://clownote.github.io/2022/03/03/murecom/murecom-verse-1/&text=让AI看懂你的心情，并推荐应景的音乐，以一种简单的实现"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://clownote.github.io/2022/03/03/murecom/murecom-verse-1/&title=让AI看懂你的心情，并推荐应景的音乐，以一种简单的实现"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://clownote.github.io/2022/03/03/murecom/murecom-verse-1/&is_video=false&description=让AI看懂你的心情，并推荐应景的音乐，以一种简单的实现"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=让AI看懂你的心情，并推荐应景的音乐，以一种简单的实现&body=Check out this article: https://clownote.github.io/2022/03/03/murecom/murecom-verse-1/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://clownote.github.io/2022/03/03/murecom/murecom-verse-1/&title=让AI看懂你的心情，并推荐应景的音乐，以一种简单的实现"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://clownote.github.io/2022/03/03/murecom/murecom-verse-1/&title=让AI看懂你的心情，并推荐应景的音乐，以一种简单的实现"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://clownote.github.io/2022/03/03/murecom/murecom-verse-1/&title=让AI看懂你的心情，并推荐应景的音乐，以一种简单的实现"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://clownote.github.io/2022/03/03/murecom/murecom-verse-1/&title=让AI看懂你的心情，并推荐应景的音乐，以一种简单的实现"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://clownote.github.io/2022/03/03/murecom/murecom-verse-1/&name=让AI看懂你的心情，并推荐应景的音乐，以一种简单的实现&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2022 CDFMLR
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/cdfmlr">项目</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight .code pre").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-146911386-1', 'auto');
        ga('send', 'pageview');
    </script>
    
    <!-- New: global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-146911386-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-146911386-1');
    </script>
    

<!-- Baidu Analytics -->

    <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?9a0d2e6fde93dad496ac79f04f3aba97";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

<!-- Disqus Comments -->


<!--Livere Comments-->

    <script type="text/javascript">
      (function (d, s) {
        var j, e = d.getElementsByTagName(s)[0];

        if (typeof LivereTower === 'function') { return; }

        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;

        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>


</body>
</html>
