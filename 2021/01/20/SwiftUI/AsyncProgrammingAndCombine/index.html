<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="异步编程与 Combine异步编程 CombineCombine: Customize handling of asynchronous events by combining event-processing operators.  PublisherPublisher 负责发布事件。 12345678910111213public protocol Publisher &amp;#123;    &#x2F;&#x2F;">
<meta property="og:type" content="article">
<meta property="og:title" content="异步编程与Combine">
<meta property="og:url" content="https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/index.html">
<meta property="og:site_name" content="clownote">
<meta property="og:description" content="异步编程与 Combine异步编程 CombineCombine: Customize handling of asynchronous events by combining event-processing operators.  PublisherPublisher 负责发布事件。 12345678910111213public protocol Publisher &amp;#123;    &#x2F;&#x2F;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/AsyncProgrammingAndCombine/asynchronous.png">
<meta property="og:image" content="https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/AsyncProgrammingAndCombine/Combine.png">
<meta property="og:image" content="https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/AsyncProgrammingAndCombine/delay.png">
<meta property="og:image" content="https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/AsyncProgrammingAndCombine/debounce.png">
<meta property="article:published_time" content="2021-01-20T12:29:01.909Z">
<meta property="article:modified_time" content="2022-03-03T10:50:02.696Z">
<meta property="article:author" content="CDFMLR">
<meta property="article:tag" content="SwiftUI">
<meta property="article:tag" content="Swift">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/AsyncProgrammingAndCombine/asynchronous.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/rabbit.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/rabbit_192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/rabbit_180.png">
          
        
    
    <!-- title -->
    <title>异步编程与Combine</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
    <!--Google search varification (PRIVATE)-->
    <meta name="google-site-verification" content="MrqlpFAD8nDanw3Ypv7ZsIWHLnTdhRuLa4QhSVwxIvc" />
    <!--Google AdSense 关联 (PRIVATE)-->
    <script data-ad-client="ca-pub-1510963483941114" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/cdfmlr">项目</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2021/01/22/SwiftUI/CombinePublisherOperator/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2021/01/16/blog/PyPiGitHubActions/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/&text=异步编程与Combine"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/&title=异步编程与Combine"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/&is_video=false&description=异步编程与Combine"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=异步编程与Combine&body=Check out this article: https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/&title=异步编程与Combine"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/&title=异步编程与Combine"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/&title=异步编程与Combine"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/&title=异步编程与Combine"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/&name=异步编程与Combine&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E4%B8%8E-Combine"><span class="toc-number">1.</span> <span class="toc-text">异步编程与 Combine</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B"><span class="toc-number">1.1.</span> <span class="toc-text">异步编程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Combine"><span class="toc-number">1.2.</span> <span class="toc-text">Combine</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Publisher"><span class="toc-number">1.2.1.</span> <span class="toc-text">Publisher</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Operator"><span class="toc-number">1.2.2.</span> <span class="toc-text">Operator</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#scan"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">scan</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#map"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">map</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Subscriber"><span class="toc-number">1.2.3.</span> <span class="toc-text">Subscriber</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Sink"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">Sink</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Assign"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">Assign</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E8%A7%92%E8%89%B2"><span class="toc-number">1.3.</span> <span class="toc-text">其他角色</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Subject"><span class="toc-number">1.3.1.</span> <span class="toc-text">Subject</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#PassthroughSubject"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">PassthroughSubject</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CurrentValueSubject"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">CurrentValueSubject</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Scheduler"><span class="toc-number">1.3.2.</span> <span class="toc-text">Scheduler</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#where"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">where</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#when"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">when</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">1.4.</span> <span class="toc-text">参考</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        异步编程与Combine
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">clownote</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2021-01-20T12:29:01.909Z" itemprop="datePublished">2021-01-20</time>
        
        (Updated: <time datetime="2022-03-03T10:50:02.696Z" itemprop="dateModified">2022-03-03</time>)
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/Swift/" rel="tag">Swift</a>, <a class="tag-link-link" href="/tags/SwiftUI/" rel="tag">SwiftUI</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="异步编程与-Combine"><a href="#异步编程与-Combine" class="headerlink" title="异步编程与 Combine"></a>异步编程与 Combine</h1><h2 id="异步编程"><a href="#异步编程" class="headerlink" title="异步编程"></a>异步编程</h2><p><img src="AsyncProgrammingAndCombine/asynchronous.png" alt="asynchronous"></p>
<h2 id="Combine"><a href="#Combine" class="headerlink" title="Combine"></a>Combine</h2><p><strong><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/combine">Combine</a></strong>: Customize handling of asynchronous events by combining event-processing operators.</p>
<p><img src="AsyncProgrammingAndCombine/Combine.png" alt="Combine"></p>
<h3 id="Publisher"><a href="#Publisher" class="headerlink" title="Publisher"></a>Publisher</h3><p>Publisher 负责发布事件。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">Publisher</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// 要发布的值类型</span></span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">Output</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 可能发布的错误类型</span></span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">Failure</span> : <span class="type">Error</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 连接订阅者，连上后 subscriber 就可以从 Publisher 接收了</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">receive</span>&lt;S&gt;<span class="params">(subscriber: S)</span></span> <span class="keyword">where</span> </span><br><span class="line">        <span class="type">S</span> : <span class="type">Subscriber</span>, </span><br><span class="line">        <span class="keyword">Self</span>.<span class="type">Failure</span> <span class="operator">==</span> <span class="type">S</span>.<span class="type">Failure</span>, </span><br><span class="line">        <span class="keyword">Self</span>.<span class="type">Output</span> <span class="operator">==</span> <span class="type">S</span>.<span class="type">Input</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Publisher 可以发布三种事件:</p>
<ul>
<li>output：事件流中发布新的值，类型为 Output；</li>
<li>failure：发生错误，事件流终止，类型为 Failure； (<code>.failure(e)</code>).</li>
<li>finished：事件流结束； (<code>.finished</code>)</li>
</ul>
<h3 id="Operator"><a href="#Operator" class="headerlink" title="Operator"></a>Operator</h3><h4 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h4><p> Publisher 的 <code>scan</code> 方法提供一个暂存值，每次事件发生时执行一个闭包来更新这个暂存值，并准备好在下一次事件时使用它。这个暂存值也将被作为新的 Publisher 事件被发送出去。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">scan</span>&lt;T&gt;<span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">_</span> initialResult: T, </span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">_</span> nextPartialResult: <span class="params">(T, <span class="keyword">Self</span>.Output)</span></span></span> -&gt; <span class="type">T</span>) </span><br><span class="line">-&gt; <span class="type">Publishers</span>.<span class="type">Scan</span>&lt;<span class="keyword">Self</span>, <span class="type">T</span>&gt;</span><br></pre></td></tr></table></figure>

<p>e.g.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> foo: <span class="type">AnyPublisher</span>&lt;<span class="type">Void</span>, <span class="type">Never</span>&gt;</span><br><span class="line"><span class="keyword">let</span> fooCounter <span class="operator">=</span> foo.scan(<span class="number">0</span>) &#123; value, <span class="keyword">_</span> <span class="keyword">in</span> value <span class="operator">+</span> <span class="number">1</span> &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>foo</code> 发出 E, E, E, …</li>
<li><code>fooCounter</code> 发出 1, 2, 3, …</li>
</ul>
<h4 id="map"><a href="#map" class="headerlink" title="map"></a>map</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">map</span>&lt;T&gt;<span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">_</span> transform: <span class="params">(<span class="keyword">Self</span>.Output)</span></span></span> -&gt; <span class="type">T</span>) </span><br><span class="line">-&gt; <span class="type">Publishers</span>.<span class="type">Map</span>&lt;<span class="keyword">Self</span>, <span class="type">T</span>&gt;</span><br></pre></td></tr></table></figure>

<p>map 也是返回一个新的 Publisher，通过一个闭包来转化原来的 Publisher 的结果。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fooCounterStr <span class="operator">=</span> foo</span><br><span class="line">    .scan(<span class="number">0</span>) &#123; value, <span class="keyword">_</span> <span class="keyword">in</span> value <span class="operator">+</span> <span class="number">1</span> &#125;</span><br><span class="line">    .map&#123; <span class="type">String</span>(<span class="variable">$0</span>) &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>foo</code> 发出 E, E, E, …</li>
<li><code>fooCounterStr</code> 发出 “1”, “2”, “3”, …</li>
</ul>
<p>类似的还有很多啦，大抵都是用这种函数式的形式，来对原有的 Publisher 进行变形等逻辑操作。这些操作就扮演了 Operator 的角色。</p>
<p>每个 Operator 都使用上游 Publisher 所发布的数据作为输入， 以此产生的新的数据，然后自身成为新的 Publisher，并将新的数据作为输出， 发布给下游。</p>
<p>通过一系列组合（Combine），就得到了一个 Publisher 的链条。首部是发生的事件，中间对事件进行变形处理，末尾就得到了可以直接供给 Subscriber 消费。</p>
<h3 id="Subscriber"><a href="#Subscriber" class="headerlink" title="Subscriber"></a>Subscriber</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">Subscriber</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// 要接收的值的类型</span></span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">Input</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 可能接收的错误类型</span></span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">Failure</span> : <span class="type">Error</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 告诉 subscriber 成功订阅了 publisher，可以接收了</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">receive</span><span class="params">(subscription: Subscription)</span></span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">receive</span><span class="params">(<span class="keyword">_</span> input: <span class="keyword">Self</span>.Input)</span></span> -&gt; <span class="type">Subscribers</span>.<span class="type">Demand</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">receive</span><span class="params">(completion: Subscribers.Completion&lt;<span class="keyword">Self</span>.Failure&gt;)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Combine 里面也已经提供了一些常用的 Subscriber 了，例如 <code>Sink</code> 和 <code>Assign</code>。</p>
<h4 id="Sink"><a href="#Sink" class="headerlink" title="Sink"></a>Sink</h4><p>Sink 是个通过闭包去处理接收到的值的 Subscriber。</p>
<p>调用 <code>sink</code> 方法，可以把 Sink Subscriber 加到 Publisher 的链条末端：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">sink</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    receiveCompletion: <span class="params">(<span class="params">(Subscribers.Completion&lt;<span class="keyword">Self</span>.Failure&gt;)</span></span></span></span> -&gt; <span class="type">Void</span>), </span><br><span class="line">    receiveValue: ((<span class="keyword">Self</span>.<span class="type">Output</span>) -&gt; <span class="type">Void</span>)) </span><br><span class="line">-&gt; <span class="type">AnyCancellable</span></span><br></pre></td></tr></table></figure>

<p>通过给 sink 的闭包，就对拿到的事件可以执行任意操作。可以用 Sink 结束响应函数式的 Publisher 链，最终桥接到基于闭包的指令式代码。</p>
<p>e.g.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> foo <span class="operator">=</span> (<span class="number">0</span> <span class="operator">...</span> <span class="number">5</span>).publisher.map &#123; <span class="keyword">_</span> <span class="keyword">in</span> &#125;</span><br><span class="line"></span><br><span class="line">foo</span><br><span class="line">    .scan(<span class="number">0</span>) &#123; value, <span class="keyword">_</span> <span class="keyword">in</span> value <span class="operator">+</span> <span class="number">1</span> &#125;</span><br><span class="line">    .map &#123; <span class="type">String</span>(<span class="variable">$0</span>) &#125;</span><br><span class="line">    .sink &#123; <span class="built_in">print</span>(<span class="string">&quot;foo count: <span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>) &#125;</span><br></pre></td></tr></table></figure>

<h4 id="Assign"><a href="#Assign" class="headerlink" title="Assign"></a>Assign</h4><p>Assign，如其名，就是个专注于赋值的 Subscriber。<code>assign</code> 接受一个某 class 的实例以及对象类型上的某个键路径 (<code>\.name</code>)。当 output 事件到来时，其中包含的值就将被设置到对应的属性上去:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Combine</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bar</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> count: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> bar <span class="operator">=</span> <span class="type">Bar</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> foo <span class="operator">=</span> (<span class="number">0</span> <span class="operator">...</span> <span class="number">5</span>).publisher.map &#123; <span class="keyword">_</span> <span class="keyword">in</span> &#125;</span><br><span class="line"></span><br><span class="line">foo</span><br><span class="line">    .scan(<span class="number">0</span>) &#123; value, <span class="keyword">_</span> <span class="keyword">in</span> value <span class="operator">+</span> <span class="number">1</span> &#125;</span><br><span class="line">    .map &#123; <span class="type">String</span>(<span class="variable">$0</span>) &#125;</span><br><span class="line">    .assign(to: \.count, on: bar)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(bar.count)  # output: <span class="number">6</span></span><br></pre></td></tr></table></figure>

<h2 id="其他角色"><a href="#其他角色" class="headerlink" title="其他角色"></a>其他角色</h2><h3 id="Subject"><a href="#Subject" class="headerlink" title="Subject"></a>Subject</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">Subject</span> : <span class="title">AnyObject</span>, <span class="title">Publisher</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// Sends a value to the subscriber.</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">send</span><span class="params">(<span class="keyword">_</span> value: <span class="keyword">Self</span>.Output)</span></span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Sends a completion signal (`.failure(e)` or `.finished`)</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">send</span><span class="params">(completion: Subscribers.Completion&lt;<span class="keyword">Self</span>.Failure&gt;)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Subject</code> 是用来给外部调用者通过 send 方法来发布 output 值、failure 或 finished 事件的。</p>
<p>和 Sink 刚好相反，Subject 可以完成“指令式 -&gt; 响应式”。</p>
<h4 id="PassthroughSubject"><a href="#PassthroughSubject" class="headerlink" title="PassthroughSubject"></a>PassthroughSubject</h4><p><code>PassthroughSubject</code> 是 Combine 中的一种 Subject 具体实现。PassthroughSubject 将 send 接收到的事件转发给下游。接收到才转发，没接收到就闲着。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mySubject <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">Int</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"></span><br><span class="line">mySubject.send(<span class="number">123</span>)  <span class="comment">// 没人监听，丢失了</span></span><br><span class="line"></span><br><span class="line">mySubject.sink(</span><br><span class="line">    receiveCompletion: &#123; <span class="built_in">print</span>(<span class="string">&quot;complete: <span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>) &#125;,</span><br><span class="line">    receiveValue: &#123; <span class="built_in">print</span>(<span class="string">&quot;value: <span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>)&#125;</span><br><span class="line">)  <span class="comment">// 开始监听</span></span><br><span class="line"></span><br><span class="line">mySubject.send(<span class="number">666</span>)</span><br><span class="line">mySubject.send(completion: .finished)</span><br></pre></td></tr></table></figure>

<p>运行输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">value: 666</span><br><span class="line">complete: finished</span><br></pre></td></tr></table></figure>

<h4 id="CurrentValueSubject"><a href="#CurrentValueSubject" class="headerlink" title="CurrentValueSubject"></a>CurrentValueSubject</h4><p><code>CurrentValueSubject</code> 相当于是个带了缓冲的 PassthroughSubject。在订阅发生的瞬间，CurrentValueSubject 会把当前保存的值发送给订阅者，之后的行为就和 PassthroughSubject 相同了。</p>
<p>也就是说，它可以缓冲一个值：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> anotherSubject <span class="operator">=</span> <span class="type">CurrentValueSubject</span>&lt;<span class="type">Int</span>, <span class="type">Never</span>&gt;(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// anotherSubject.send(2048)</span></span><br><span class="line"><span class="comment">// anotherSubject.send(4096)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;开始监听&quot;</span>)</span><br><span class="line">anotherSubject.sink(</span><br><span class="line">    receiveCompletion: &#123; <span class="built_in">print</span>(<span class="string">&quot;complete: <span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>) &#125;,</span><br><span class="line">    receiveValue: &#123; <span class="built_in">print</span>(<span class="string">&quot;value: <span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>)&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">anotherSubject.send(<span class="number">8192</span>)</span><br><span class="line">anotherSubject.send(<span class="number">16384</span>)</span><br><span class="line">anotherSubject.send(completion: .finished)</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">开始监听</span><br><span class="line">value: 1024</span><br><span class="line">value: 8192</span><br><span class="line">value: 16384</span><br><span class="line">complete: finished</span><br></pre></td></tr></table></figure>

<p>把上面的两行注释取消：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="operator">...</span></span><br><span class="line"></span><br><span class="line">anotherSubject.send(<span class="number">2048</span>)</span><br><span class="line">anotherSubject.send(<span class="number">4096</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;开始监听&quot;</span>)</span><br><span class="line"><span class="operator">...</span></span><br></pre></td></tr></table></figure>

<p>则输出：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">开始监听</span><br><span class="line">value: <span class="number">4096</span></span><br><span class="line">value: <span class="number">8192</span></span><br><span class="line">value: <span class="number">16384</span></span><br><span class="line">complete: finished</span><br></pre></td></tr></table></figure>

<h3 id="Scheduler"><a href="#Scheduler" class="headerlink" title="Scheduler"></a>Scheduler</h3><ul>
<li><code>Publisher</code>：决定发布什么事件流 (what)；</li>
<li><code>Scheduler</code>：决定在什么地方 (where)、什么时候 (when) 发布事件和执行代码；</li>
</ul>
<h4 id="where"><a href="#where" class="headerlink" title="where"></a>where</h4><p>在网络请求之后，响应是在后台线程的，用用请求的结果更新 UI，就需要转到主线程：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">URLSession</span>.shared</span><br><span class="line">    .dataTaskPublisher(<span class="keyword">for</span>: <span class="type">URL</span>(string: <span class="string">&quot;https://example.com&quot;</span>)<span class="operator">!</span>)</span><br><span class="line">    .compactMap &#123; <span class="type">String</span>(data: <span class="variable">$0</span>.data, encoding: .utf8) &#125;</span><br><span class="line">    .receive(on: <span class="type">RunLoop</span>.main)  <span class="comment">// Scheduler here</span></span><br><span class="line">    .sink(</span><br><span class="line">        receiveCompletion: &#123; <span class="keyword">_</span> <span class="keyword">in</span> &#125;, </span><br><span class="line">        receiveValue: &#123; textView.text <span class="operator">=</span> <span class="variable">$0</span> &#125;</span><br><span class="line">     )</span><br></pre></td></tr></table></figure>

<p><code>RunLoop</code> 就是实现了 Scheduler 协议的类型。<code>receive(on: RunLoop.main) </code> 把接收从后台线程转到主线程，以更新 UI。</p>
<h4 id="when"><a href="#when" class="headerlink" title="when"></a>when</h4><p>默认情况下，Publisher 会尽量及时把事件传递给下游。但可以用 Scheduler 加入延迟。</p>
<ul>
<li><code>delay</code>：将事件逐一延后一定时间</li>
</ul>
<p><img src="AsyncProgrammingAndCombine/delay.png" alt="delay操作的时序表示"></p>
<ul>
<li><code>debounce</code>：延迟所有事件，直到在一定时间里没有新的事件到来，才发生最后一次事件的值。</li>
</ul>
<p><img src="AsyncProgrammingAndCombine/debounce.png" alt="debounce 操作的时序表示"></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>[1] 王巍《SwiftUI与Combine编程》ch5</p>

  </div>
</article>
<!--Disqus-->


<!--Livere-->

    <div class="blog-post-comments">
        <div id="lv-container" data-id="city" data-uid="MTAyMC80NjEzMi8yMjY0Mw==">
            <noscript>不启用 JavaScript 支持的人是看不到可爱的评论区的。😥</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/cdfmlr">项目</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E4%B8%8E-Combine"><span class="toc-number">1.</span> <span class="toc-text">异步编程与 Combine</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B"><span class="toc-number">1.1.</span> <span class="toc-text">异步编程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Combine"><span class="toc-number">1.2.</span> <span class="toc-text">Combine</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Publisher"><span class="toc-number">1.2.1.</span> <span class="toc-text">Publisher</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Operator"><span class="toc-number">1.2.2.</span> <span class="toc-text">Operator</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#scan"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">scan</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#map"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">map</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Subscriber"><span class="toc-number">1.2.3.</span> <span class="toc-text">Subscriber</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Sink"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">Sink</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Assign"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">Assign</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E8%A7%92%E8%89%B2"><span class="toc-number">1.3.</span> <span class="toc-text">其他角色</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Subject"><span class="toc-number">1.3.1.</span> <span class="toc-text">Subject</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#PassthroughSubject"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">PassthroughSubject</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CurrentValueSubject"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">CurrentValueSubject</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Scheduler"><span class="toc-number">1.3.2.</span> <span class="toc-text">Scheduler</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#where"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">where</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#when"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">when</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">1.4.</span> <span class="toc-text">参考</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/&text=异步编程与Combine"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/&title=异步编程与Combine"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/&is_video=false&description=异步编程与Combine"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=异步编程与Combine&body=Check out this article: https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/&title=异步编程与Combine"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/&title=异步编程与Combine"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/&title=异步编程与Combine"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/&title=异步编程与Combine"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://clownote.github.io/2021/01/20/SwiftUI/AsyncProgrammingAndCombine/&name=异步编程与Combine&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2022 CDFMLR
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/cdfmlr">项目</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight .code pre").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-146911386-1', 'auto');
        ga('send', 'pageview');
    </script>
    
    <!-- New: global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-146911386-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-146911386-1');
    </script>
    

<!-- Baidu Analytics -->

    <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?9a0d2e6fde93dad496ac79f04f3aba97";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

<!-- Disqus Comments -->


<!--Livere Comments-->

    <script type="text/javascript">
      (function (d, s) {
        var j, e = d.getElementsByTagName(s)[0];

        if (typeof LivereTower === 'function') { return; }

        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;

        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>


</body>
</html>
