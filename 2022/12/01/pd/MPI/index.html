<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="æµ…å­¦ MPIã€‚ MPIåˆ†å¸ƒå¼å†…å­˜å¤šå¤„ç†å™¨ï¼š  å¤„ç†å™¨ + è¾…åŠ©ç»„ä»¶ &#x3D;&gt; èŠ‚ç‚¹ ä¸€å †èŠ‚ç‚¹ &#x3D;&gt; é«˜æ€§èƒ½è®¡ç®—ç³»ç»Ÿ èŠ‚ç‚¹ &#x3D;&gt; è¿›ç¨‹   èŠ‚ç‚¹ä¹‹é—´ï¼šæ¶ˆæ¯ä¼ é€’  MPIï¼šæ¶ˆæ¯ä¼ é€’æ¥å£ å®‰è£…è¿˜æ˜¯ç”¨ Docker æ–¹ä¾¿ã€‚ å®¿ä¸»æœºï¼š 12345sudo docker run -idt --name openmpi -v &#x2F;home&#x2F;openmpi&#x2F;:&#x2F;home&#x2F;openmpi -p 2200">
<meta property="og:type" content="article">
<meta property="og:title" content="MPI">
<meta property="og:url" content="https://clownote.github.io/2022/12/01/pd/MPI/index.html">
<meta property="og:site_name" content="clownote">
<meta property="og:description" content="æµ…å­¦ MPIã€‚ MPIåˆ†å¸ƒå¼å†…å­˜å¤šå¤„ç†å™¨ï¼š  å¤„ç†å™¨ + è¾…åŠ©ç»„ä»¶ &#x3D;&gt; èŠ‚ç‚¹ ä¸€å †èŠ‚ç‚¹ &#x3D;&gt; é«˜æ€§èƒ½è®¡ç®—ç³»ç»Ÿ èŠ‚ç‚¹ &#x3D;&gt; è¿›ç¨‹   èŠ‚ç‚¹ä¹‹é—´ï¼šæ¶ˆæ¯ä¼ é€’  MPIï¼šæ¶ˆæ¯ä¼ é€’æ¥å£ å®‰è£…è¿˜æ˜¯ç”¨ Docker æ–¹ä¾¿ã€‚ å®¿ä¸»æœºï¼š 12345sudo docker run -idt --name openmpi -v &#x2F;home&#x2F;openmpi&#x2F;:&#x2F;home&#x2F;openmpi -p 2200">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://clownote.github.io/2022/12/01/pd/MPI/imgs/mpi-bcast.png">
<meta property="og:image" content="https://clownote.github.io/2022/12/01/pd/MPI/imgs/mpi-scatter.png">
<meta property="og:image" content="https://clownote.github.io/2022/12/01/pd/MPI/imgs/mpi-gather.png">
<meta property="og:image" content="https://clownote.github.io/2022/12/01/pd/MPI/imgs/mpi-allgather.png">
<meta property="og:image" content="https://clownote.github.io/2022/12/01/pd/MPI/imgs/mpi-alltoall.png">
<meta property="article:published_time" content="2022-12-01T10:45:21.841Z">
<meta property="article:modified_time" content="2022-12-01T02:47:45.535Z">
<meta property="article:author" content="CDFMLR">
<meta property="article:tag" content="CDFMLR, blogs">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://clownote.github.io/2022/12/01/pd/MPI/imgs/mpi-bcast.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/rabbit.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/rabbit_192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/rabbit_180.png">
          
        
    
    <!-- title -->
    <title>MPI</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
    <!--Google search varification (PRIVATE)-->
    <meta name="google-site-verification" content="MrqlpFAD8nDanw3Ypv7ZsIWHLnTdhRuLa4QhSVwxIvc" />
    <!--Google AdSense å…³è” (PRIVATE)-->
    <script data-ad-client="ca-pub-1510963483941114" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">é¦–é¡µ</a></li>
         
          <li><a href="/about/">å…³äº</a></li>
         
          <li><a href="/archives/">å½’æ¡£</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/cdfmlr">é¡¹ç›®</a></li>
         
          <li><a href="/search/">æœç´¢</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2022/12/01/pd/OpenMP/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2022/10/03/blog/macOS%20Monterey%202K%20%E5%B1%8F%E5%BC%80%20HiDPI/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">ä¸Šä¸€ç¯‡</span>
      <span id="i-next" class="info" style="display:none;">ä¸‹ä¸€ç¯‡</span>
      <span id="i-top" class="info" style="display:none;">è¿”å›é¡¶éƒ¨</span>
      <span id="i-share" class="info" style="display:none;">åˆ†äº«æ–‡ç« </span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://clownote.github.io/2022/12/01/pd/MPI/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://clownote.github.io/2022/12/01/pd/MPI/&text=MPI"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://clownote.github.io/2022/12/01/pd/MPI/&title=MPI"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://clownote.github.io/2022/12/01/pd/MPI/&is_video=false&description=MPI"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=MPI&body=Check out this article: https://clownote.github.io/2022/12/01/pd/MPI/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://clownote.github.io/2022/12/01/pd/MPI/&title=MPI"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://clownote.github.io/2022/12/01/pd/MPI/&title=MPI"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://clownote.github.io/2022/12/01/pd/MPI/&title=MPI"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://clownote.github.io/2022/12/01/pd/MPI/&title=MPI"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://clownote.github.io/2022/12/01/pd/MPI/&name=MPI&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MPI"><span class="toc-number">1.</span> <span class="toc-text">MPI</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.1.</span> <span class="toc-text">å®‰è£…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MPI-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.</span> <span class="toc-text">MPI åŸºæœ¬å‘½ä»¤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hello-World"><span class="toc-number">1.3.</span> <span class="toc-text">Hello World</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E4%BF%A1%E5%99%A8"><span class="toc-number">1.4.</span> <span class="toc-text">é€šä¿¡å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#size-amp-rank"><span class="toc-number">1.4.1.</span> <span class="toc-text">size &amp; rank</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%82%B9%E5%AF%B9%E7%82%B9%E6%B6%88%E6%81%AF"><span class="toc-number">1.5.</span> <span class="toc-text">ç‚¹å¯¹ç‚¹æ¶ˆæ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E9%80%81"><span class="toc-number">1.5.1.</span> <span class="toc-text">å‘é€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E6%94%B6"><span class="toc-number">1.5.2.</span> <span class="toc-text">æ¥æ”¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90"><span class="toc-number">1.5.3.</span> <span class="toc-text">ä¾‹å­</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E9%80%9A%E4%BF%A1"><span class="toc-number">1.6.</span> <span class="toc-text">èšåˆé€šä¿¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8C%E6%AD%A5%EF%BC%9ABarrier"><span class="toc-number">1.6.1.</span> <span class="toc-text">åŒæ­¥ï¼šBarrier</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%BF%E6%92%AD%EF%BC%9ABcast"><span class="toc-number">1.6.2.</span> <span class="toc-text">å¹¿æ’­ï¼šBcast</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%95%A3%EF%BC%9AScatter"><span class="toc-number">1.6.3.</span> <span class="toc-text">åˆ†æ•£ï¼šScatter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B6%E9%9B%86%EF%BC%9AGather"><span class="toc-number">1.6.4.</span> <span class="toc-text">æ”¶é›†ï¼šGather</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E6%94%B6%E9%9B%86%EF%BC%9AAllgather"><span class="toc-number">1.6.5.</span> <span class="toc-text">å…¨å±€æ”¶é›†ï¼šAllgather</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E7%BA%A6%EF%BC%9AReduce"><span class="toc-number">1.6.6.</span> <span class="toc-text">è§„çº¦ï¼šReduce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E8%A7%84%E7%BA%A6%EF%BC%9AAllreduce"><span class="toc-number">1.6.7.</span> <span class="toc-text">å…¨å±€è§„çº¦ï¼šAllreduce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%88%B0%E5%85%A8%E5%B1%80%EF%BC%9AAlltoall"><span class="toc-number">1.6.8.</span> <span class="toc-text">å…¨å±€åˆ°å…¨å±€ï¼šAlltoall</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9E%E9%98%BB%E5%A1%9E%E9%80%9A%E4%BF%A1"><span class="toc-number">1.7.</span> <span class="toc-text">éé˜»å¡é€šä¿¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.8.</span> <span class="toc-text">è‡ªå®šä¹‰æ•°æ®ç±»å‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="toc-number">1.9.</span> <span class="toc-text">å‚è€ƒæ–‡çŒ®</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        MPI
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">clownote</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-12-01T10:45:21.841Z" itemprop="datePublished">2022-12-01</time>
        
        (Updated: <time datetime="2022-12-01T02:47:45.535Z" itemprop="dateModified">2022-12-01</time>)
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>æµ…å­¦ MPIã€‚</p>
<h1 id="MPI"><a href="#MPI" class="headerlink" title="MPI"></a>MPI</h1><p>åˆ†å¸ƒå¼å†…å­˜å¤šå¤„ç†å™¨ï¼š</p>
<ul>
<li>å¤„ç†å™¨ + è¾…åŠ©ç»„ä»¶ =&gt; èŠ‚ç‚¹</li>
<li>ä¸€å †èŠ‚ç‚¹ =&gt; é«˜æ€§èƒ½è®¡ç®—ç³»ç»Ÿ<ul>
<li>èŠ‚ç‚¹ =&gt; è¿›ç¨‹</li>
</ul>
</li>
<li>èŠ‚ç‚¹ä¹‹é—´ï¼šæ¶ˆæ¯ä¼ é€’</li>
</ul>
<p>MPIï¼šæ¶ˆæ¯ä¼ é€’æ¥å£</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>è¿˜æ˜¯ç”¨ Docker æ–¹ä¾¿ã€‚</p>
<p>å®¿ä¸»æœºï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -idt --name openmpi -v /home/openmpi/:/home/openmpi -p 22001:22 alpine</span><br><span class="line"></span><br><span class="line">sudo ufw allow 22001 comment <span class="string">&#x27;openmpi:ssh&#x27;</span></span><br><span class="line"></span><br><span class="line">sudo docker <span class="built_in">exec</span> -it openmpi sh</span><br></pre></td></tr></table></figure>

<p>å®¹å™¨å†…ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">apk add build-base  <span class="comment"># å›½å†…ç½‘ç»œæœ‰æ—¶å€™è¦å¤šè¿è¡Œå‡ æ¬¡</span></span><br><span class="line">apk add perl  <span class="comment"># Open MPI requires perl</span></span><br><span class="line">apk add linux-headers  <span class="comment"># #include &lt;linux/unistd.h&gt;</span></span><br><span class="line">apk add bash vim</span><br><span class="line">apk add gcompat libstdc++ curl</span><br><span class="line"></span><br><span class="line">apk add openssh</span><br><span class="line">vi /etc/ssh/sshd_config <span class="comment"># PermitRootLogin yes</span></span><br><span class="line">passwd <span class="comment"># é‡æ–°è®¾ä¸ª root å¯†ç </span></span><br><span class="line">/usr/sbin/sshd  <span class="comment"># å¼€ ssh æœåŠ¡åå°</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½ã€å®‰è£… OpenMPI</span></span><br><span class="line">wget https://download.open-mpi.org/release/open-mpi/v4.1/openmpi-4.1.4.tar.gz</span><br><span class="line">tar xzf openmpi-4.1.4.tar.gz</span><br><span class="line"><span class="built_in">cd</span> openmpi-4.1.4</span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span></span><br><span class="line">make all install</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•å®‰è£…</span></span><br><span class="line"><span class="built_in">cd</span> /openmpi-4.1.4/examples/</span><br><span class="line">mpicc -o hello_c hello_c.c</span><br><span class="line">mpirun -n 4 --allow-run-as-root --oversubscribe hello_c</span><br><span class="line">    <span class="comment"># --allow-run-as-root: root ç¡¬è·‘</span></span><br><span class="line">    <span class="comment"># --oversubscribe: æ²¡æœ‰å¤šå¤„ç†å™¨ï¼Œå•æ ¸å•çº¿ç¨‹ç¡¬è·‘</span></span><br></pre></td></tr></table></figure>

<p>é€€å‡ºæ¥ï¼Œå®¿ä¸»æœºï¼ŒæŠŠåˆšæ‰è£…å¥½çš„åšæˆé•œåƒå¤‡ç”¨ï¼Œå¯ä»¥æ–¹ä¾¿ä»¥åé‡å¼€ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo docker ps <span class="comment"># æ‰¾ä¸€ä¸‹åˆšæ‰é‚£ä¸ªçš„ id</span></span><br><span class="line">sudo docker commit 37c628532bae openmpi:v0.0.0</span><br></pre></td></tr></table></figure>

<p>ä»¥åå†æ¬¡æ­è¿™ä¸ªç¯å¢ƒå°±æ–¹ä¾¿äº†ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -idt --name openmpi -v /home/openmpi/:/home/openmpi -p 22001:22 openmpi:v0.0.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™ä¸ªæ²¡æœ‰ entrypointï¼Œ</span></span><br><span class="line"><span class="comment"># å¦‚æœè¦ç”¨ sshï¼Œéœ€è¦æ‰‹åŠ¨è¿›å»æ‰‹åŠ¨å¼€ä¸€ä¸‹ sshd</span></span><br><span class="line">sudo docker <span class="built_in">exec</span> -it openmpi-with-sshd sh</span><br><span class="line">å®¹å™¨å†… <span class="comment"># /usr/sbin/sshd</span></span><br></pre></td></tr></table></figure>

<p>çœ‹ç€å¤šæ˜¯ç”±äºå¥½å¤šæ­¥éª¤æ˜¯åœ¨å¼„ SSHï¼Œå¼„å¥½äº† SSHï¼Œæ­é›†ç¾¤ä¹Ÿå°±æ–¹ä¾¿äº†ã€‚ä½†æˆ‘æš‚æ—¶æ²¡æœ‰å…´è¶£ã€‚</p>
<h2 id="MPI-åŸºæœ¬å‘½ä»¤"><a href="#MPI-åŸºæœ¬å‘½ä»¤" class="headerlink" title="MPI åŸºæœ¬å‘½ä»¤"></a>MPI åŸºæœ¬å‘½ä»¤</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mpi.h&gt;  // å¯¼å…¥åŒ…</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123;</span><br><span class="line">    MPI_Init(&amp;argc, &amp;argv);  <span class="comment">// ä»»æ„å…¶ä»– MPI è°ƒç”¨å‰</span></span><br><span class="line">    ...</span><br><span class="line">    MPI_Finalize(); <span class="comment">// ä»»æ„å…¶ä»– MPI è°ƒç”¨å</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span>&#123;</span><br><span class="line">    MPI_Init(&amp;argc, &amp;argv);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello, world!\n&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    MPI_Finalize();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘è¿è¡Œï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ mpicc hello.c -o hello</span><br><span class="line">$ mpirun -n 4 --allow-run-as-root --oversubscribe hello</span><br><span class="line">Hello, world!</span><br><span class="line">Hello, world!</span><br><span class="line">Hello, world!</span><br><span class="line">Hello, world!</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ<code>--allow-run-as-root</code> å’Œ <code>--oversubscribe</code> æ˜¯ç”±äºæˆ‘è¦å¼ºåˆ¶åœ¨å•æ ¸å•çº¿ç¨‹çš„è™šæ‹Ÿæœºé‡Œç”¨ Docker é‡Œçš„ root ç”¨æˆ·è¿è¡Œ MPI ç¨‹åºï¼Œæ­£å¸¸ç¯å¢ƒä¸Šä¸ç”¨ã€‚ï¼‰</p>
<h2 id="é€šä¿¡å™¨"><a href="#é€šä¿¡å™¨" class="headerlink" title="é€šä¿¡å™¨"></a>é€šä¿¡å™¨</h2><p>ä¸Šé¢çš„ <a href="#Hello%20World">Hello World</a>ï¼šæ— å…±äº«ã€‚æ¯ä¸ªè¿›ç¨‹åšè‡ªå·±çš„ï¼Œæ²¡æœ‰äº¤äº’ï¼Œæ— æ³•åè°ƒå·¥ä½œã€‚</p>
<p>MPI çš„å¹¶å‘è¿›ç¨‹äº¤äº’ï¼š<strong>é€šä¿¡å™¨</strong>ï¼ˆcommunicatorï¼‰ï¼š</p>
<ul>
<li>åœ°å€ç©ºé—´ï¼šåŒ…å«ä¸€ç»„ MPI è¿›ç¨‹</li>
<li>å…¶ä»–å„ç§å±æ€§</li>
</ul>
<p>MPI è‡ªå¸¦æä¾›ä¸€ä¸ªå¼€ç®±å³ç”¨çš„é€šä¿¡å™¨ï¼š<code>MPI_COMM_WORLD</code>ï¼ŒåŒ…å«è¯¥ MPI ç¨‹åºçš„æ‰€æœ‰å¹¶å‘è¿›ç¨‹ã€‚</p>
<h3 id="size-amp-rank"><a href="#size-amp-rank" class="headerlink" title="size &amp; rank"></a>size &amp; rank</h3><p><code>size</code> å’Œ <code>rank</code> æ˜¯ä¸¤ä¸ªå¸¸ç”¨çš„é€šä¿¡å™¨å±æ€§ã€‚</p>
<ul>
<li><code>size</code>ï¼šé€šä¿¡å™¨çš„<strong>å¤§å°</strong>ï¼Œå³æ„æˆé€šä¿¡å™¨çš„è¿›ç¨‹æ•°é‡ï¼›</li>
<li><code>rank</code>ï¼šé€šä¿¡å™¨ä¸­æ¯ä¸ªè¿›ç¨‹çš„æ ‡è¯†ï¼ˆå”¯ä¸€è¿›ç¨‹ IDï¼Œ$\ge 0$ çš„æ•´æ•°ï¼‰ï¼Œç§°ä¸º rankï¼›</li>
</ul>
<p>ä¸¤ä¸ªå±æ€§çš„ getterï¼ˆä¸æ˜¯ setterï¼‰ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> size, rank;</span><br><span class="line"></span><br><span class="line">MPI_Comm_size(MPI_COMM_WORLD, <span class="comment">/* out */</span> &amp;size); </span><br><span class="line">MPI_Comm_rank(MPI_COMM_WORLD, <span class="comment">/* out */</span> &amp;rank);</span><br></pre></td></tr></table></figure>

<p>ï¼ˆå…¶å®è¿™ä¸¤ä¸ªå‡½æ•°æœ‰ <code>int</code> ç±»å‹çš„è¿”å›å€¼ï¼Œç›®æµ‹æˆåŠŸéƒ½æ˜¯ 0ã€‚ï¼‰</p>
<p>e.g. å¸¦ rank å’Œ size çš„ Hello Worldï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span>&#123;</span><br><span class="line">    MPI_Init(&amp;argc, &amp;argv);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> size, rank;</span><br><span class="line">    MPI_Comm_size(MPI_COMM_WORLD, &amp;size);</span><br><span class="line">    MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello from rank %d out of %d processes in MPI_COMM_WORLD\n&quot;</span>, rank, size);</span><br><span class="line"></span><br><span class="line">    MPI_Finalize();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘è¿è¡Œï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># mpicc comm.c &amp;&amp; mpirun -n 4 --allow-run-as-root --oversubscribe ./a.out</span></span><br><span class="line">Hello from rank <span class="number">0</span> out of <span class="number">4</span> processes in MPI_COMM_WORLD</span><br><span class="line">Hello from rank <span class="number">2</span> out of <span class="number">4</span> processes in MPI_COMM_WORLD</span><br><span class="line">Hello from rank <span class="number">1</span> out of <span class="number">4</span> processes in MPI_COMM_WORLD</span><br><span class="line">Hello from rank <span class="number">3</span> out of <span class="number">4</span> processes in MPI_COMM_WORLD</span><br></pre></td></tr></table></figure>

<h2 id="ç‚¹å¯¹ç‚¹æ¶ˆæ¯"><a href="#ç‚¹å¯¹ç‚¹æ¶ˆæ¯" class="headerlink" title="ç‚¹å¯¹ç‚¹æ¶ˆæ¯"></a>ç‚¹å¯¹ç‚¹æ¶ˆæ¯</h2><ul>
<li>MPI è´Ÿè´£ç®¡ç†é€šä¿¡å™¨å†…çš„è¿›ç¨‹ä¹‹é—´çš„æ•°æ®äº¤æ¢</li>
<li>MPI æ•°æ®äº¤æ¢çš„åª’ä»‹ï¼šæ¶ˆæ¯<ul>
<li>æºè¿›ç¨‹ rank</li>
<li>ç›®æ ‡è¿›ç¨‹ rank</li>
<li>åŒ…å«æºã€ç›®çš„è¿›ç¨‹çš„é€šä¿¡å™¨</li>
<li>æ ‡è®°ï¼šåŒºåˆ†ä¸¤ä¸ªè¿›ç¨‹é—´çš„ä¸€ç»„å¯èƒ½çš„æ¶ˆæ¯ï¼Œç”¨æˆ·è‡ªå®š</li>
</ul>
</li>
</ul>
<h3 id="å‘é€"><a href="#å‘é€" class="headerlink" title="å‘é€"></a>å‘é€</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MPI_Send(</span><br><span class="line">    <span class="comment">/* in */</span> <span class="keyword">void</span>* message,</span><br><span class="line">    <span class="keyword">int</span> count, MPI_Datatype datatype,</span><br><span class="line">    <span class="keyword">int</span> dest, <span class="keyword">int</span> tag, MPI_Comm comm)</span><br></pre></td></tr></table></figure>

<p>å‘é€çš„æ¶ˆæ¯å†…å®¹æ˜¯ï¼šä» <code>message</code> å‚æ•°å¤„å¼€å§‹çš„ä¸€ä¸ª <code>MPI_Datatype[count]</code> <strong>æ•°ç»„</strong>ã€‚</p>
<p>å…¶ä¸­ï¼Œ<code>count</code> æ˜¯æ•°æ®å…ƒç´ çš„æ•°é‡ï¼ˆæ•°ç»„é•¿åº¦ï¼‰ï¼›<code>MPI_Datatype</code> ä¸ºå…¶ç±»å‹ï¼ŒåŸºæœ¬å°±æ˜¯å’Œ C çš„ç®€å•æ•°æ®ç±»å‹ä¸€ä¸€å¯¹åº”ï¼š</p>
<table>
<thead>
<tr>
<th><code>MPI_Datatype</code></th>
<th>å¯¹åº”çš„ C æ•°æ®ç±»å‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>MPI_SHORT</code></td>
<td><code>short int</code></td>
</tr>
<tr>
<td><code>MPI_INT</code></td>
<td><code>int</code></td>
</tr>
<tr>
<td><code>MPI_LONG</code></td>
<td><code>long int</code></td>
</tr>
<tr>
<td><code>MPI_LONG_LONG</code></td>
<td><code>long long int</code></td>
</tr>
<tr>
<td><code>MPI_UNSIGNED_CHAR</code></td>
<td><code>unsigned char</code></td>
</tr>
<tr>
<td><code>MPI_UNSIGNED_SHORT</code></td>
<td><code>unsigned short int</code></td>
</tr>
<tr>
<td><code>MPI_UNSIGNED</code></td>
<td><code>unsigned int</code></td>
</tr>
<tr>
<td><code>MPI_UNSIGNED_LONG</code></td>
<td><code>unsigned long int</code></td>
</tr>
<tr>
<td><code>MPI_UNSIGNED_LONG_LONG</code></td>
<td><code>unsigned long long int</code></td>
</tr>
<tr>
<td><code>MPI_FLOAT</code></td>
<td><code>float</code></td>
</tr>
<tr>
<td><code>MPI_DOUBLE</code></td>
<td><code>double</code></td>
</tr>
<tr>
<td><code>MPI_LONG_DOUBLE</code></td>
<td><code>long double</code></td>
</tr>
<tr>
<td><code>MPI_BYTE</code></td>
<td><code>unsigned char</code></td>
</tr>
</tbody></table>
<p>å†æ¬¡å¼ºè°ƒï¼ŒMPI å‘é€çš„æ˜¯æ•°ç»„ã€‚å•å‘ä¸€ä¸ªæ•° <code>int a</code> ä¹Ÿè¦å°†å…¶çœ‹ä½œ <code>int msg[1] = &amp;a</code>ï¼Œæ‰€ä»¥å†™ä½œ <code>MPI_Send(&amp;a, 1, MPI_INT, ...)</code>ï¼›è€Œå¦‚æœè¦å‘é€ä¸€ä¸ªæ•°ç»„ <code>int A[3]</code>ï¼Œåˆ™ä¸å¿…å†å–åœ°å€ï¼š<code>MPI_Send(A, 3, MPI_INT, ...)</code>ã€‚</p>
<p>å†æ¬¡å¼ºè°ƒï¼ŒMPI å‘é€çš„æ˜¯æ•°ç»„ï¼Œç†è§£è¿™ç‚¹åå†å»çœ‹ MPI æ¥å£ï¼Œå°±æ²¡é‚£ä¹ˆé­”å¹»äº†ï¼Œå¾ˆå¤šéƒ½æ˜¯ã€Œæ•°ç»„é¦–åœ°å€ + é•¿åº¦ + ç±»å‹ã€è¿™ä¸‰ä¸ªé…å¥—å‡ºç°ï¼Œå¯èƒ½æœ‰å¤šç»„è¿™ä¸ªä¸‰å…ƒç»„ï¼Œä¾‹å¦‚ <a href="#%E5%88%86%E6%95%A3%EF%BC%9AScatter"><code>MPI_Scatter</code></a>ï¼Œåé¢å†åŠ ä¸Šä¸€ä¸ªã€Œæº/ç›®æ ‡è¿›ç¨‹å· + é€šä¿¡å™¨ã€ã€‚</p>
<h3 id="æ¥æ”¶"><a href="#æ¥æ”¶" class="headerlink" title="æ¥æ”¶"></a>æ¥æ”¶</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MPI_Recv(</span><br><span class="line">    <span class="comment">/* out */</span> <span class="keyword">void</span>* message,</span><br><span class="line">    <span class="keyword">int</span> count, MPI_Datatype datatype,</span><br><span class="line">    <span class="keyword">int</span> source, <span class="keyword">int</span> tag, MPI_Comm comm,</span><br><span class="line">    MPI_Status* status)</span><br></pre></td></tr></table></figure>

<p><code>status</code> å°±æ˜¯ <code>source</code> + <code>tag</code> + å¯èƒ½çš„ errorã€‚</p>
<h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><p>æŠŠä¹‹å‰çš„å¸¦ rank çš„ hello æ”¹æˆé¡ºåºç‰ˆæœ¬ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    MPI_Init(&amp;argc, &amp;argv);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> rank, size;</span><br><span class="line">    MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);</span><br><span class="line">    MPI_Comm_size(MPI_COMM_WORLD, &amp;size);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (size == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;This example requires more than one process to execute.\n&quot;</span>);</span><br><span class="line">        MPI_Finalize();</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¶ˆæ¯æ”¶å‘çš„å‚æ•°</span></span><br><span class="line">    <span class="keyword">int</span> message[<span class="number">2</span>];  <span class="comment">// buffer</span></span><br><span class="line">    <span class="keyword">int</span> dst, src;</span><br><span class="line">    <span class="keyword">int</span> tag = <span class="number">0</span>;</span><br><span class="line">    MPI_Status status;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (rank != <span class="number">0</span>) &#123;  <span class="comment">// ç»™è¿›ç¨‹ 0 å‘æ¶ˆæ¯</span></span><br><span class="line">        message[<span class="number">0</span>] = rank;</span><br><span class="line">        message[<span class="number">1</span>] = size;</span><br><span class="line"></span><br><span class="line">        dst = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        MPI_Send(message, <span class="number">2</span>, MPI_INT, dst, tag, MPI_COMM_WORLD);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  <span class="comment">// è¿›ç¨‹ 0ï¼šé¡ºåºæ”¶æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">for</span> (src = <span class="number">1</span>; src &lt; size; src++) &#123;</span><br><span class="line">            MPI_Recv(message, <span class="number">2</span>, MPI_INT, src, MPI_ANY_TAG, MPI_COMM_WORLD, &amp;status);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Hello from process %d out of %d.\n&quot;</span>,</span><br><span class="line">                   message[<span class="number">0</span>], message[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    MPI_Finalize();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘è¿è¡Œï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mpicc send-recv.c &amp;&amp; mpirun -n 4 --allow-run-as-root --oversubscribe ./a.out</span><br><span class="line">Hello from process 1 out of 4.</span><br><span class="line">Hello from process 2 out of 4.</span><br><span class="line">Hello from process 3 out of 4.</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªç¨‹åºç”¨ä¸Š master-worker æ¨¡å¼äº†ï¼š</p>
<ul>
<li>rank ä¸º 0 çš„è¿›ç¨‹æ˜¯ masterï¼Œè´Ÿè´£é¡ºåºæ”¶æ¶ˆæ¯ã€æ‰“å°ï¼›</li>
<li>rank ä¸ºå…¶ä»–å€¼çš„è¿›ç¨‹æ˜¯ workerï¼Œè´Ÿè´£å‘ä¸€æ¡æ¶ˆæ¯ç»™ masterï¼›</li>
<li><code>if-else</code> åˆ†åŒ– master å’Œ worker çš„å·¥ä½œã€‚</li>
</ul>
<h2 id="èšåˆé€šä¿¡"><a href="#èšåˆé€šä¿¡" class="headerlink" title="èšåˆé€šä¿¡"></a>èšåˆé€šä¿¡</h2><p>èšåˆé€šä¿¡ï¼šåŒ…å«é€šä¿¡å™¨å†…çš„æ‰€æœ‰è¿›ç¨‹çš„é€šä¿¡æ¨¡å¼ï¼ˆç¾¤æ¶ˆæ¯ï¼‰</p>
<h3 id="åŒæ­¥ï¼šBarrier"><a href="#åŒæ­¥ï¼šBarrier" class="headerlink" title="åŒæ­¥ï¼šBarrier"></a>åŒæ­¥ï¼šBarrier</h3><p>Barrierï¼šæ …æ ï¼š</p>
<ul>
<li>æ‰€æœ‰äººéƒ½å µåœ¨è¿™é‡Œç­‰ï¼›</li>
<li>æ‰€æœ‰äººéƒ½åˆ°é½äº†å†æ”¾è¡Œã€‚</li>
</ul>
<blockquote>
<p>æ …ï¼ˆzhÃ ï¼‰æ ï¼Œå±…ç„¶ä¸æ˜¯è¯» shÄnï¼Œæˆ‘è¯´å’‹è€æ˜¯æ‰“ä¸å‡ºæ¥ã€‚ã€‚ã€‚å¦å¤–åŸæ¥ zhÃ  æ æ˜¯è¿™ä¸ªå­—å•Šï¼Œä»æœªè®¾æƒ³è¿‡ğŸ˜­</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MPI_Barrier(MPI_Comm comm)</span><br></pre></td></tr></table></figure>

<p>e.g. åˆä¸€ä¸ª Hello Worldï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span>&#123;</span><br><span class="line">    MPI_Init(&amp;argc, &amp;argv);</span><br><span class="line"></span><br><span class="line">    MPI_Barrier(MPI_COMM_WORLD);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> size, rank;</span><br><span class="line">    MPI_Comm_size(MPI_COMM_WORLD, &amp;size);</span><br><span class="line">    MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> len;</span><br><span class="line">    <span class="keyword">char</span> name[MPI_MAX_PROCESSOR_NAME];</span><br><span class="line">    MPI_Get_processor_name(name, &amp;len);</span><br><span class="line"></span><br><span class="line">    MPI_Barrier(MPI_COMM_WORLD);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello, world! Process %d of %d on %s\n&quot;</span>, rank, size, name);</span><br><span class="line"></span><br><span class="line">    MPI_Finalize();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘è¿è¡Œï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mpicc barrier.c &amp;&amp; mpirun -n <span class="number">4</span> --allow-run-as-root --oversubscribe ./a.out</span><br><span class="line">Hello, world! Process <span class="number">0</span> of <span class="number">4</span> on c8e9719000d7</span><br><span class="line">Hello, world! Process <span class="number">2</span> of <span class="number">4</span> on c8e9719000d7</span><br><span class="line">Hello, world! Process <span class="number">3</span> of <span class="number">4</span> on c8e9719000d7</span><br><span class="line">Hello, world! Process <span class="number">1</span> of <span class="number">4</span> on c8e9719000d7</span><br></pre></td></tr></table></figure>

<p>è”æƒ³ï¼šOpenMP çš„ <a href="OpenMP.md#barrier%20%E6%8C%87%E4%BB%A4">barrier æŒ‡ä»¤</a>ã€‚</p>
<h3 id="å¹¿æ’­ï¼šBcast"><a href="#å¹¿æ’­ï¼šBcast" class="headerlink" title="å¹¿æ’­ï¼šBcast"></a>å¹¿æ’­ï¼šBcast</h3><p><img src="imgs/mpi-bcast.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MPI_Bcast(</span><br><span class="line">    <span class="keyword">void</span> *shared_data,</span><br><span class="line">    <span class="keyword">int</span> count, MPI_Datatype datatype,</span><br><span class="line">    <span class="keyword">int</span> root, MPI_Comm comm)</span><br></pre></td></tr></table></figure>

<p>æŠŠ <code>root</code> çš„ <code>shared_data</code> å¹¿æ’­ï¼ˆåŒæ­¥ï¼‰ç»™å„è¿›ç¨‹çš„ <code>shared_data</code> é‡Œã€‚</p>
<p>e.g.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span>&#123;</span><br><span class="line">    MPI_Init(&amp;argc, &amp;argv);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> size, rank;</span><br><span class="line">    MPI_Comm_size(MPI_COMM_WORLD, &amp;size);</span><br><span class="line">    MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> A[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">        A[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> root = <span class="number">0</span>;  <span class="comment">// root process</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (rank == root) &#123;</span><br><span class="line">        A[<span class="number">0</span>] = <span class="number">3</span>;</span><br><span class="line">        A[<span class="number">1</span>] = <span class="number">5</span>;</span><br><span class="line">        A[<span class="number">2</span>] = <span class="number">4</span>;</span><br><span class="line">        A[<span class="number">3</span>] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    MPI_Bcast(A, <span class="number">4</span>, MPI_INT, root, MPI_COMM_WORLD);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Rank %d: A = [%d, %d, %d, %d]\n&quot;</span>, rank, A[<span class="number">0</span>], A[<span class="number">1</span>], A[<span class="number">2</span>], A[<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">    MPI_Finalize();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘è¿è¡Œï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mpicc bcast.c &amp;&amp; mpirun -n 4 --allow-run-as-root --oversubscribe ./a.out</span><br><span class="line">Rank 0: A = [3, 5, 4, 1]</span><br><span class="line">Rank 1: A = [3, 5, 4, 1]</span><br><span class="line">Rank 2: A = [3, 5, 4, 1]</span><br><span class="line">Rank 3: A = [3, 5, 4, 1]</span><br></pre></td></tr></table></figure>

<h3 id="åˆ†æ•£ï¼šScatter"><a href="#åˆ†æ•£ï¼šScatter" class="headerlink" title="åˆ†æ•£ï¼šScatter"></a>åˆ†æ•£ï¼šScatter</h3><p><img src="imgs/mpi-scatter.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MPI_Scatter(</span><br><span class="line">    <span class="keyword">void</span> *send_data, <span class="keyword">int</span> send_count, MPI_Datatype send_type,</span><br><span class="line">    <span class="keyword">void</span> *recv_data, <span class="keyword">int</span> recv_count, MPI_Datatype recv_type,</span><br><span class="line">    <span class="keyword">int</span> root, MPI_Comm comm);</span><br></pre></td></tr></table></figure>

<p>æŠŠ <code>root</code> çš„ <code>send_data</code> åˆ†æ•£åˆ°å„ä¸ªè¿›ç¨‹çš„ <code>recv_data</code> é‡Œï¼ŒåŒ…æ‹¬è‡ªå·±çš„ï¼Œæ¯ä¸ªäººå‘ <code>send_count</code> ä¸ªã€‚</p>
<p>e.g.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span>&#123;</span><br><span class="line">    MPI_Init(&amp;argc, &amp;argv);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> size, rank;</span><br><span class="line">    MPI_Comm_size(MPI_COMM_WORLD, &amp;size);</span><br><span class="line">    MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (size != <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;This example requires 4 processes to execute.\n&quot;</span>);</span><br><span class="line">        MPI_Finalize();</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> A[<span class="number">4</span>], B[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">        A[i] = <span class="number">0</span>;</span><br><span class="line">        B[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> root = <span class="number">0</span>;  <span class="comment">// root process</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (rank == root) &#123;</span><br><span class="line">        A[<span class="number">0</span>] = <span class="number">3</span>;</span><br><span class="line">        A[<span class="number">1</span>] = <span class="number">5</span>;</span><br><span class="line">        A[<span class="number">2</span>] = <span class="number">4</span>;</span><br><span class="line">        A[<span class="number">3</span>] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    MPI_Scatter(A, <span class="number">1</span>, MPI_INT,</span><br><span class="line">                B, <span class="number">1</span>, MPI_INT,</span><br><span class="line">                root, MPI_COMM_WORLD);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Rank %d: A = [%d, %d, %d, %d], B = [%d, %d, %d, %d]\n&quot;</span>, rank, </span><br><span class="line">           A[<span class="number">0</span>], A[<span class="number">1</span>], A[<span class="number">2</span>], A[<span class="number">3</span>], </span><br><span class="line">           B[<span class="number">0</span>], B[<span class="number">1</span>], B[<span class="number">2</span>], B[<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">    MPI_Finalize();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘è¿è¡Œï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mpicc scatter.c &amp;&amp; mpirun -n 4 --allow-run-as-root --oversubscribe ./a.out</span><br><span class="line">Rank 0: A = [3, 5, 4, 1], B = [3, 0, 0, 0]</span><br><span class="line">Rank 1: A = [0, 0, 0, 0], B = [5, 0, 0, 0]</span><br><span class="line">Rank 2: A = [0, 0, 0, 0], B = [4, 0, 0, 0]</span><br><span class="line">Rank 3: A = [0, 0, 0, 0], B = [1, 0, 0, 0]</span><br></pre></td></tr></table></figure>

<h3 id="æ”¶é›†ï¼šGather"><a href="#æ”¶é›†ï¼šGather" class="headerlink" title="æ”¶é›†ï¼šGather"></a>æ”¶é›†ï¼šGather</h3><p><img src="imgs/mpi-gather.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MPI_Gather(</span><br><span class="line">    <span class="keyword">void</span> *send_data, <span class="keyword">int</span> send_count, MPI_Datatype send_type,</span><br><span class="line">    <span class="keyword">void</span> *recv_data, <span class="keyword">int</span> recv_count, MPI_Datatype recv_type,</span><br><span class="line">    <span class="keyword">int</span> dest, MPI_Comm comm);</span><br></pre></td></tr></table></figure>

<p><code>MPI_Gather</code> å°±æ˜¯åšåå‘çš„ <a href="#%E5%88%86%E6%95%A3%EF%BC%9AScatter">MPI_Scatter</a>ï¼šæŠŠå„ä¸ªè¿›ç¨‹çš„ <code>send_data</code> æ”¶é›†åˆ° <code>dest</code> çš„ <code>recv_data</code> é‡Œã€‚</p>
<p>e.g.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span>&#123;</span><br><span class="line">    MPI_Init(&amp;argc, &amp;argv);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> size, rank;</span><br><span class="line">    MPI_Comm_size(MPI_COMM_WORLD, &amp;size);</span><br><span class="line">    MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* assert size == 4 */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> A[<span class="number">4</span>], B[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">        A[i] = <span class="number">0</span>;</span><br><span class="line">        B[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    A[<span class="number">0</span>] = rank;  <span class="comment">// å„è‡ªè¿›ç¨‹çš„ç»“æœ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> dest = <span class="number">0</span>; <span class="comment">// æ”¶é›†åˆ° dest</span></span><br><span class="line"></span><br><span class="line">    MPI_Gather(A, <span class="number">1</span>, MPI_INT,</span><br><span class="line">               B, <span class="number">1</span>, MPI_INT,</span><br><span class="line">               dest, MPI_COMM_WORLD);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Rank %d: A = [%d, %d, %d, %d], B = [%d, %d, %d, %d]\n&quot;</span>, rank, </span><br><span class="line">           A[<span class="number">0</span>], A[<span class="number">1</span>], A[<span class="number">2</span>], A[<span class="number">3</span>], </span><br><span class="line">           B[<span class="number">0</span>], B[<span class="number">1</span>], B[<span class="number">2</span>], B[<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">    MPI_Finalize();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘è¿è¡Œï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mpicc gather.c &amp;&amp; mpirun -n 4 --allow-run-as-root --oversubscribe ./a.out</span><br><span class="line">Rank 0: A = [0, 0, 0, 0], B = [0, 1, 2, 3]</span><br><span class="line">Rank 1: A = [1, 0, 0, 0], B = [0, 0, 0, 0]</span><br><span class="line">Rank 2: A = [2, 0, 0, 0], B = [0, 0, 0, 0]</span><br><span class="line">Rank 3: A = [3, 0, 0, 0], B = [0, 0, 0, 0]</span><br></pre></td></tr></table></figure>

<h3 id="å…¨å±€æ”¶é›†ï¼šAllgather"><a href="#å…¨å±€æ”¶é›†ï¼šAllgather" class="headerlink" title="å…¨å±€æ”¶é›†ï¼šAllgather"></a>å…¨å±€æ”¶é›†ï¼šAllgather</h3><p><img src="imgs/mpi-allgather.png"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MPI_Gather(</span><br><span class="line">    <span class="keyword">void</span> *send_data, <span class="keyword">int</span> send_count, MPI_Datatype send_type,</span><br><span class="line">    <span class="keyword">void</span> *recv_data, <span class="keyword">int</span> recv_count, MPI_Datatype recv_type,</span><br><span class="line">    MPI_Comm comm);</span><br></pre></td></tr></table></figure>

<p>ç±»ä¼¼äº <a href="#%E6%94%B6%E9%9B%86%EF%BC%9AGather">MPI_Gather</a>ï¼Œä½†æ˜¯æ”¶é›†çš„ç»“æœæ˜¯å¹¿æ’­åˆ°æ‰€æœ‰è¿›ç¨‹ä¸Šçš„ï¼Œè€Œä¸æ˜¯ä¸Šç¼´åˆ° destï¼ˆæ‰€ä»¥ä¹Ÿå°±æ²¡è¿™ä¸ªå‚æ•°äº†ï¼‰ã€‚</p>
<p>e.g.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span>&#123;</span><br><span class="line">    MPI_Init(&amp;argc, &amp;argv);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> size, rank;</span><br><span class="line">    MPI_Comm_size(MPI_COMM_WORLD, &amp;size);</span><br><span class="line">    MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* assert size == 4 */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> A[<span class="number">4</span>], B[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">        A[i] = <span class="number">0</span>;</span><br><span class="line">        B[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    A[<span class="number">0</span>] = rank;  <span class="comment">// å„è‡ªè¿›ç¨‹çš„ç»“æœ</span></span><br><span class="line"></span><br><span class="line">    MPI_Allgather(A, <span class="number">1</span>, MPI_INT,</span><br><span class="line">                  B, <span class="number">1</span>, MPI_INT,</span><br><span class="line">                  MPI_COMM_WORLD);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Rank %d: A = [%d, %d, %d, %d], B = [%d, %d, %d, %d]\n&quot;</span>, rank, </span><br><span class="line">           A[<span class="number">0</span>], A[<span class="number">1</span>], A[<span class="number">2</span>], A[<span class="number">3</span>], </span><br><span class="line">           B[<span class="number">0</span>], B[<span class="number">1</span>], B[<span class="number">2</span>], B[<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">    MPI_Finalize();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘è¿è¡Œï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mpicc allgather.c &amp;&amp; mpirun -n 4 --allow-run-as-root --oversubscribe ./a.out</span><br><span class="line">Rank 0: A = [0, 0, 0, 0], B = [0, 1, 2, 3]</span><br><span class="line">Rank 1: A = [1, 0, 0, 0], B = [0, 1, 2, 3]</span><br><span class="line">Rank 2: A = [2, 0, 0, 0], B = [0, 1, 2, 3]</span><br><span class="line">Rank 3: A = [3, 0, 0, 0], B = [0, 1, 2, 3]</span><br></pre></td></tr></table></figure>

<h3 id="è§„çº¦ï¼šReduce"><a href="#è§„çº¦ï¼šReduce" class="headerlink" title="è§„çº¦ï¼šReduce"></a>è§„çº¦ï¼šReduce</h3><p>å…³äºã€Œè§„çº¦ã€ã€ã€Œreduceã€çš„è¯æ„ä»¥åŠè¿™ä¸ªè¿‡ç¨‹çš„ç¤ºæ„å›¾ï¼Œè§ OpenMP çš„ <a href="OpenMP.md#reduction%20%E6%8C%87%E4%BB%A4">reduction æŒ‡ä»¤</a>ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MPI_Reduce(<span class="keyword">const</span> <span class="keyword">void</span> *send_data, <span class="keyword">void</span> *recv_data,</span><br><span class="line">           <span class="keyword">int</span> count, MPI_Datatype datatype, </span><br><span class="line">           MPI_Op op,</span><br><span class="line">           <span class="keyword">int</span> dest, MPI_Comm comm);</span><br></pre></td></tr></table></figure>

<p>æ¯ä¸ªè¿›ç¨‹å‘ <code>count</code> ä¸ª <code>datatype</code> ç±»å‹çš„æœ¬åœ°ç»“æœ <code>send_data</code> åˆ° <code>dest</code>ï¼Œ<code>dest</code> å°†è¿™äº›ç»“æœåš <code>op</code> è¿ç®—ï¼Œç»“æœæ”¾åˆ° <code>recv_data</code>ã€‚</p>
<p><code>op</code> å¯ä»¥æ˜¯ï¼š</p>
<ul>
<li><code>MPI_MAX</code>ã€<code>MPI_MIN</code></li>
<li><code>MPI_SUM</code>ã€<code>MPI_PROD</code></li>
<li><code>MPI_LAND</code>ï¼ˆé€»è¾‘ä¸ï¼‰ã€<code>MPI_BAND</code>ï¼ˆæŒ‰ä½ä¸ï¼‰ï¼Œç±»ä¼¼çš„è¿˜æœ‰ ORã€XORã€‚è¦æ±‚ datatype æ˜¯æ•´å‹</li>
<li><code>MPI_MAXLOC</code>ï¼ˆæœ€å¤§å€¼<strong>å’Œ</strong>å…¶ä½ç½®ï¼‰ã€<code>MPI_MINLOC</code>ã€‚è¦æ±‚ datatype æ˜¯å¯¹ï¼š<code>MPI_DOUBLE_INT</code> æˆ– <code>MPI_2INI</code></li>
</ul>
<p>e.g. è®¡ç®—ä¸¤ä¸ªå‘é‡çš„ç‚¹ç§¯ï¼š$a \cdot b = \sum_i a_i b_i$ï¼š</p>
<p>å…·ä½“æ¥è¯´å°±æ˜¯åšè¿™ä»¶äº‹ï¼š</p>
<p>$$<br>\begin{array}{rll}<br>a \cdot b =&amp;\  [\underbrace{1,\cdots,1}_\textrm{100ä¸ª1},2,\cdots,2,\cdots] \times [2,\cdots,2]^T\<br>~ =&amp;\ \underbrace{1 \times 2 + \cdots +1 \times 2}_\textrm{100æ¬¡} +\<br>~ &amp;\  2 \times 2 + \cdots + 2 \times 2 +\<br>~ &amp;\  \cdots<br>\end{array}<br>$$</p>
<p>å…¶ä¸­ï¼Œæœ€åä¸€ä¸ªç­‰å·å³è¾¹æ¯ä¸€è¡Œç”±ä¸€ä¸ªè¿›ç¨‹æ¥ç®—ï¼Œè¡Œä¹‹é—´åŠ èµ·æ¥ç”¨ reduce æ¥åšã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    MPI_Init(&amp;argc, &amp;argv);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> size, rank;</span><br><span class="line">    MPI_Comm_size(MPI_COMM_WORLD, &amp;size);</span><br><span class="line">    MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> local_vector_size = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">int</span> global_vector_size = size * local_vector_size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> *a, *b;</span><br><span class="line">    a = (<span class="keyword">double</span> *) <span class="built_in">malloc</span>(local_vector_size * <span class="keyword">sizeof</span>(<span class="keyword">double</span>));</span><br><span class="line">    b = (<span class="keyword">double</span> *) <span class="built_in">malloc</span>(local_vector_size * <span class="keyword">sizeof</span>(<span class="keyword">double</span>));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; local_vector_size; i++) &#123;</span><br><span class="line">        a[i] = <span class="number">1.0</span> * rank;</span><br><span class="line">        b[i] = <span class="number">2.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸Šé¢éƒ½æ˜¯é€ æ•°æ®</span></span><br><span class="line">    <span class="comment">// ä¸‹é¢æ­£å¼å¼€å§‹ç®— dot productï¼Œä¸¤é˜¶æ®µï¼šæœ¬åœ°ç´¯ç§¯ã€å…¨å±€è§„çº¦</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">double</span> partial_sum = <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; local_vector_size; i++) &#123;</span><br><span class="line">        partial_sum += a[i] * b[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> root = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">double</span> sum = <span class="number">0.0</span>;</span><br><span class="line">    MPI_Reduce(&amp;partial_sum, &amp;sum, </span><br><span class="line">               <span class="number">1</span>, MPI_DOUBLE, MPI_SUM, </span><br><span class="line">               root, MPI_COMM_WORLD);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (rank == root) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;The dot product is %g\n&quot;</span>, sum);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(a);</span><br><span class="line">    <span class="built_in">free</span>(b);</span><br><span class="line"></span><br><span class="line">    MPI_Finalize();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘è¿è¡Œï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mpicc reduce.c &amp;&amp; mpirun -n 4 --allow-run-as-root --oversubscribe ./a.out</span><br><span class="line">The dot product is 1200</span><br></pre></td></tr></table></figure>

<h3 id="å…¨å±€è§„çº¦ï¼šAllreduce"><a href="#å…¨å±€è§„çº¦ï¼šAllreduce" class="headerlink" title="å…¨å±€è§„çº¦ï¼šAllreduce"></a>å…¨å±€è§„çº¦ï¼šAllreduce</h3><p>ç±»ä¼¼äºä» <a href="#%E6%94%B6%E9%9B%86%EF%BC%9AGather"><code>MPI_Gather</code></a> åˆ° <a href="#%E5%85%A8%E5%B1%80%E6%94%B6%E9%9B%86%EF%BC%9AAllgather"><code>MPI_Allgather</code></a>ï¼Œ<code>MPI_Allreduce</code> åš  <a href="#%E8%A7%84%E7%BA%A6%EF%BC%9AReduce"><code>MPI_Reduce</code></a>  çš„è¿ç®—ï¼Œä½†æ˜¯æŠŠç»“æœå¹¿æ’­åˆ°æ¯ä¸€ä¸ªè¿›ç¨‹ï¼ˆæ‰€ä»¥ä¹Ÿå°±æ— éœ€ dest å‚æ•°ï¼‰ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MPI_Allreduce(<span class="keyword">const</span> <span class="keyword">void</span> *send_data, <span class="keyword">void</span> *recv_data,</span><br><span class="line">              <span class="keyword">int</span> count, MPI_Datatype datatype, </span><br><span class="line">              MPI_Op op,</span><br><span class="line">              MPI_Comm comm);</span><br></pre></td></tr></table></figure>

<p>e.g.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    MPI_Init(&amp;argc, &amp;argv);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> size, rank;</span><br><span class="line">    MPI_Comm_size(MPI_COMM_WORLD, &amp;size);</span><br><span class="line">    MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> input = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">switch</span> (rank) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>: input = <span class="number">2</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>: input = <span class="number">7</span>; <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>: input = <span class="number">1</span>; <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> output;</span><br><span class="line">    MPI_Allreduce(&amp;input, &amp;output, <span class="number">1</span>, MPI_INT, MPI_SUM, MPI_COMM_WORLD);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Rank %d: result = %d.\n&quot;</span>, rank, output);</span><br><span class="line"></span><br><span class="line">    MPI_Finalize();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘è¿è¡Œï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mpicc allreduce.c &amp;&amp; mpirun -n 4 --allow-run-as-root --oversubscribe ./a.out</span><br><span class="line">Rank 3: result = 10.</span><br><span class="line">Rank 1: result = 10.</span><br><span class="line">Rank 2: result = 10.</span><br><span class="line">Rank 0: result = 10.</span><br></pre></td></tr></table></figure>

<h3 id="å…¨å±€åˆ°å…¨å±€ï¼šAlltoall"><a href="#å…¨å±€åˆ°å…¨å±€ï¼šAlltoall" class="headerlink" title="å…¨å±€åˆ°å…¨å±€ï¼šAlltoall"></a>å…¨å±€åˆ°å…¨å±€ï¼šAlltoall</h3><p>alltoall é€šä¿¡æ¨¡å¼ï¼š</p>
<ul>
<li>æ¯ä¸ªå‘é€å™¨ä¹Ÿæ˜¯æ¥æ”¶å™¨ï¼›</li>
<li>ä¸åŒçš„æ•°æ®è¢«å‘é€åˆ°æ¯ä¸ªæ¥æ”¶å™¨ï¼šç¬¬ i ä¸ªæ•°æ®åˆ†åŒºè¢«å‘é€åˆ°ç¬¬ j ä¸ªè¿›ç¨‹ï¼›</li>
</ul>
<p>ç”¨æ¯è¡Œè¡¨ç¤ºä¸€ä¸ªè¿›ç¨‹ï¼Œæ¯åˆ—è¡¨ç¤ºä¸€ä¸ªæ•°æ®åˆ†åŒºï¼Œåˆ™ alltoall çš„æ•ˆæœç±»ä¼¼äºçŸ©é˜µè½¬ç½®ï¼š</p>
<p><img src="imgs/mpi-alltoall.png"></p>
<p>æˆ‘çš„ç†è§£æ˜¯ <code>Alltoall = Allscatter</code>ï¼Œä¸çŸ¥é“å¯¹ä¸å¯¹å“ˆï¼š</p>
<ul>
<li>ä½œ senderï¼šæ¯ä¸ªè¿›ç¨‹æŠŠè‡ªå·±çš„æ•°ç»„ A åš <a href="#%E5%88%86%E6%95%A3%EF%BC%9AScatter"><code>Scatter</code></a> å‘åˆ°å„ä¸ªè¿›ç¨‹ï¼›</li>
<li>ä½œ recverï¼šè¿›ç¨‹ <code>i</code> æŠŠå„ä¸ªè¿›ç¨‹å‘æ¥çš„æ•°ï¼ˆ<code>A[i] from j</code>ï¼‰æŒ‰ sender çš„ rank <code>j</code> æ‹¼æˆæ–°æ•°ç»„ Bï¼š<code>B[j] = A[i] form j</code>ã€‚</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MPI_Alltoall(</span><br><span class="line">    <span class="keyword">void</span> *send_data, <span class="keyword">int</span> send_count, MPI_Datatype send_type,</span><br><span class="line">    <span class="keyword">void</span> *recv_data, <span class="keyword">int</span> recv_count, MPI_Datatype recv_type,</span><br><span class="line">    MPI_Comm comm);</span><br></pre></td></tr></table></figure>

<p>e.g.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    MPI_Init(&amp;argc, &amp;argv);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> size, rank;</span><br><span class="line">    MPI_Comm_size(MPI_COMM_WORLD, &amp;size);</span><br><span class="line">    MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);</span><br><span class="line"></span><br><span class="line">    assert((size == <span class="number">4</span>) &amp;&amp; <span class="string">&quot;this example is designed for 4 processes.&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> A[<span class="number">4</span>], B[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">        A[i] = i + <span class="number">1</span> + <span class="number">4</span> * rank;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    MPI_Alltoall(A, <span class="number">1</span>, MPI_INT, B, <span class="number">1</span>, MPI_INT, MPI_COMM_WORLD);</span><br><span class="line"></span><br><span class="line">    sleep(rank);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Rank %d: A = [%2d, %2d, %2d, %2d], B = [%2d, %2d, %2d, %2d]\n&quot;</span>, rank, </span><br><span class="line">           A[<span class="number">0</span>], A[<span class="number">1</span>], A[<span class="number">2</span>], A[<span class="number">3</span>], </span><br><span class="line">           B[<span class="number">0</span>], B[<span class="number">1</span>], B[<span class="number">2</span>], B[<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">    MPI_Finalize();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘è¿è¡Œï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mpicc alltoall.c &amp;&amp; mpirun -n 4 --allow-run-as-root --oversubscribe ./a.out</span><br><span class="line">Rank 0: A = [ 1,  2,  3,  4], B = [ 1,  5,  9, 13]</span><br><span class="line">Rank 1: A = [ 5,  6,  7,  8], B = [ 2,  6, 10, 14]</span><br><span class="line">Rank 2: A = [ 9, 10, 11, 12], B = [ 3,  7, 11, 15]</span><br><span class="line">Rank 3: A = [13, 14, 15, 16], B = [ 4,  8, 12, 16]</span><br></pre></td></tr></table></figure>

<h2 id="éé˜»å¡é€šä¿¡"><a href="#éé˜»å¡é€šä¿¡" class="headerlink" title="éé˜»å¡é€šä¿¡"></a>éé˜»å¡é€šä¿¡</h2><p>ä¸Šæ–‡çš„ <a href="#%E7%82%B9%E5%AF%B9%E7%82%B9%E6%B6%88%E6%81%AF">ç‚¹å¯¹ç‚¹æ¶ˆæ¯</a> å’Œ <a href="#%E8%81%9A%E5%90%88%E9%80%9A%E4%BF%A1">èšåˆé€šä¿¡</a> éƒ½æ˜¯é˜»å¡çš„ï¼šå‘/æ”¶ å®Œæˆä¹‹å‰ï¼Œå‡½æ•°ä¸ä¼šè¿”å›ã€‚</p>
<p>MPI è¿˜æä¾›äº†éé˜»å¡çš„æ¥å£ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">MPI_Isend(</span><br><span class="line">    <span class="keyword">void</span>* message,</span><br><span class="line">    <span class="keyword">int</span> count, MPI_Datatype datatype,</span><br><span class="line">    <span class="keyword">int</span> dest, <span class="keyword">int</span> tag, MPI_Comm comm,</span><br><span class="line">    MPI_Request *send_request)</span><br><span class="line"></span><br><span class="line">MPI_Irecv(</span><br><span class="line">    <span class="keyword">void</span>* message,</span><br><span class="line">    <span class="keyword">int</span> count, MPI_Datatype datatype,</span><br><span class="line">    <span class="keyword">int</span> source, <span class="keyword">int</span> tag, MPI_Comm comm,</span><br><span class="line">    MPI_Request *recv_request)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿˜æœ‰ç±»ä¼¼çš„ MPI_Ibarrier, MPI_Ibcast, </span></span><br><span class="line"><span class="comment">// MPI_Iscatter, MPI_Igather</span></span><br><span class="line"><span class="comment">// MPI_Ialltoall, MPI_Iallgather</span></span><br><span class="line"><span class="comment">// MPI_Ireduce, ...</span></span><br></pre></td></tr></table></figure>

<p>å°±æ˜¯å‡½æ•°å <code>MPI_Xxx</code> -&gt; <code>MPI_Ixxx</code>ï¼Œå‚æ•°æœ€ååŠ ä¸€ä¸ª <code>MPI_Request</code>ï¼Œç”¨äºè·Ÿè¸ªè¯¥å¼‚æ­¥é€šä¿¡ã€‚è¿™äº›å‡½æ•°åœ¨è°ƒç”¨åç«‹å³è¿”å›ã€‚</p>
<p>æ¬²çŸ¥å¼‚æ­¥é€šä¿¡æ˜¯å¦å®Œæˆï¼Œä½¿ç”¨ <code>MPI_Test</code>ï¼ŒæŠŠ <code>MPI_Ixxx</code> çš„ request ä¼ è¿›æ¥ï¼Œæ£€æŸ¥ï¼Œå·²å®Œæˆåˆ™ç½® flag çš„å€¼ä¸ºçœŸï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MPI_Test(MPI_Request *request, <span class="keyword">int</span> *flag, MPI_Status *status);</span><br></pre></td></tr></table></figure>

<p>åœ¨å¿…é¡»å®Œæˆå¼‚æ­¥é€šä¿¡æ—¶ï¼Œä½¿ç”¨ <code>MPI_Wait</code>ï¼Œé˜»å¡ï¼Œç­‰é€šä¿¡å®Œæˆï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MPI_Wait(MPI_Request *request, MPI_Status *status);</span><br></pre></td></tr></table></figure>

<p>ç”¨éé˜»å¡é€šä¿¡æœ‰ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œå¯ä»¥é˜²å‘†ï¼Œé¿å…ä¸€äº›ç¨‹åºé¡ºåºç‘•ç–µå¯èƒ½å¸¦æ¥çš„æ­»é”é—®é¢˜ã€‚è€ƒè™‘å¦‚ä¸‹ç¨‹åºï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    MPI_Init(&amp;argc, &amp;argv);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> rank, size;</span><br><span class="line">    MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);</span><br><span class="line">    MPI_Comm_size(MPI_COMM_WORLD, &amp;size);</span><br><span class="line"></span><br><span class="line">    assert(size == <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> tag = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> a = rank, b = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// work</span></span><br><span class="line">    MPI_Send(&amp;a, <span class="number">1</span>, MPI_INT, <span class="number">1</span> - rank, tag, MPI_COMM_WORLD);</span><br><span class="line">    MPI_Recv(&amp;b, <span class="number">1</span>, MPI_INT, <span class="number">1</span> - rank, tag, MPI_COMM_WORLD, MPI_STATUS_IGNORE);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Rank %d: recv value %d.\n&quot;</span>, rank, b);</span><br><span class="line"></span><br><span class="line">    MPI_Finalize();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>send åœ¨å‰ï¼Œrecv åœ¨åï¼Œå¯ä»¥å·¥ä½œã€‚ä½†å¦‚æœäº¤æ¢äºŒè€…é¡ºåºï¼Œå°±ç›´æ¥æ­»é”ï¼ˆéƒ½å…ˆ recvï¼Œä½†æ²¡äººå‘å•Šï¼‰ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DEADLOCK!!!</span></span><br><span class="line">MPI_Recv(&amp;b, <span class="number">1</span>, MPI_INT, <span class="number">1</span> - rank, tag, MPI_COMM_WORLD, MPI_STATUS_IGNORE);</span><br><span class="line">MPI_Send(&amp;a, <span class="number">1</span>, MPI_INT, <span class="number">1</span> - rank, tag, MPI_COMM_WORLD);</span><br></pre></td></tr></table></figure>

<p>æ”¹æˆéé˜»å¡é€šä¿¡ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    MPI_Init(&amp;argc, &amp;argv);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> rank, size;</span><br><span class="line">    MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);</span><br><span class="line">    MPI_Comm_size(MPI_COMM_WORLD, &amp;size);</span><br><span class="line"></span><br><span class="line">    assert(size == <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> tag = <span class="number">0</span>;</span><br><span class="line">    MPI_Status status;</span><br><span class="line">    MPI_Request send_req, recv_req;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> a = rank, b = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯ä»¥äº¤æ¢</span></span><br><span class="line">    MPI_Isend(&amp;a, <span class="number">1</span>, MPI_INT, <span class="number">1</span> - rank, tag, MPI_COMM_WORLD, &amp;send_req);</span><br><span class="line">    MPI_Irecv(&amp;b, <span class="number">1</span>, MPI_INT, <span class="number">1</span> - rank, tag, MPI_COMM_WORLD, &amp;recv_req);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯ä»¥äº¤æ¢</span></span><br><span class="line">    MPI_Wait(&amp;send_req, &amp;status);</span><br><span class="line">    MPI_Wait(&amp;recv_req, &amp;status);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Rank %d: recv value %d.\n&quot;</span>, rank, b);</span><br><span class="line"></span><br><span class="line">    MPI_Finalize();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘è¿è¡Œï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Rank <span class="number">0</span>: recv value <span class="number">1.</span></span><br><span class="line">Rank <span class="number">1</span>: recv value <span class="number">0.</span></span><br></pre></td></tr></table></figure>

<p>äº¤æ¢ <code>Isend</code> å’Œ <code>Irecv</code>ï¼Œç¨‹åºä¹Ÿæ­£å¸¸å·¥ä½œã€‚äº¤æ¢ä¸¤å¥ <code>Wait</code>ï¼Œä¹Ÿæ­£å¸¸å·¥ä½œã€‚æ‰€ä»¥è¿™ä¸ªå°±å¾ˆèˆ’æœäº†ã€‚</p>
<h2 id="è‡ªå®šä¹‰æ•°æ®ç±»å‹"><a href="#è‡ªå®šä¹‰æ•°æ®ç±»å‹" class="headerlink" title="è‡ªå®šä¹‰æ•°æ®ç±»å‹"></a>è‡ªå®šä¹‰æ•°æ®ç±»å‹</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MPI_Type_create_struct(<span class="keyword">int</span> count, </span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> array_of_block_lengths[],</span><br><span class="line">    <span class="keyword">const</span> MPI_Aint array_of_displacements[],</span><br><span class="line">    <span class="keyword">const</span> MPI_Datatype array_of_types[],</span><br><span class="line">    MPI_Datatype *newtype);</span><br><span class="line"></span><br><span class="line">MPI_Type_commit(MPI_Datatype *newtype);</span><br></pre></td></tr></table></figure>

<p>e.g.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> x;</span><br><span class="line">    <span class="keyword">double</span> y;</span><br><span class="line">&#125; Pair;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    MPI_Init(&amp;argc, &amp;argv);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> rank, size;</span><br><span class="line">    MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);</span><br><span class="line">    MPI_Comm_size(MPI_COMM_WORLD, &amp;size);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¦åŠ¨æ€åˆ›å»ºçš„æ–° mpi ç±»å‹</span></span><br><span class="line">    MPI_Datatype mpi_pair;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> nitems = <span class="number">2</span>;              <span class="comment">// # fields of Pair</span></span><br><span class="line">    MPI_Datatype types[nitems];  <span class="comment">// element types</span></span><br><span class="line">    MPI_Aint offsets[nitems];    <span class="comment">// element offsets</span></span><br><span class="line">    <span class="keyword">int</span> blocklengths[nitems];    <span class="comment">// element count</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Pair.x</span></span><br><span class="line">    types[<span class="number">0</span>] = MPI_INT;</span><br><span class="line">    offsets[<span class="number">0</span>] = offsetof(Pair, x);</span><br><span class="line">    blocklengths[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Pair.y</span></span><br><span class="line">    types[<span class="number">1</span>] = MPI_DOUBLE;</span><br><span class="line">    offsets[<span class="number">1</span>] = offsetof(Pair, y);</span><br><span class="line">    blocklengths[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ³¨å†Œç±»å‹</span></span><br><span class="line">    MPI_Type_create_struct(nitems, blocklengths, offsets, types, &amp;mpi_pair);</span><br><span class="line">    MPI_Type_commit(&amp;mpi_pair);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç„¶åå°±å¯ä»¥æŠŠ Pair ç»“æ„ä½“ç”¨ MPI é€šä¿¡äº†</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> root = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    Pair <span class="built_in">pair</span>;</span><br><span class="line">    <span class="keyword">if</span> (rank == root) &#123;</span><br><span class="line">        <span class="built_in">pair</span>.x = <span class="number">10</span>;</span><br><span class="line">        <span class="built_in">pair</span>.y = <span class="number">3.14</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    MPI_Bcast(&amp;<span class="built_in">pair</span>, <span class="number">1</span>, mpi_pair, root, MPI_COMM_WORLD);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Rank %d: recv Pair&#123;x=%d, y=%g&#125;\n&quot;</span>, rank, <span class="built_in">pair</span>.x, <span class="built_in">pair</span>.y);</span><br><span class="line"></span><br><span class="line">    MPI_Finalize();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘è¿è¡Œï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mpicc newtype.c &amp;&amp; mpirun -n 4 --allow-run-as-root --oversubscribe ./a.out</span><br><span class="line">Rank 0: recv Pair&#123;x=10, y=3.14&#125;</span><br><span class="line">Rank 1: recv Pair&#123;x=10, y=3.14&#125;</span><br><span class="line">Rank 3: recv Pair&#123;x=10, y=3.14&#125;</span><br><span class="line">Rank 2: recv Pair&#123;x=10, y=3.14&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ul>
<li>Thomas Sterlingï¼ŒMatthew Andersonï¼ŒMaciej Brodowicz. é«˜æ€§èƒ½è®¡ç®—ï¼šç°ä»£ç³»ç»Ÿä¸åº”ç”¨å®è·µ. ç¬¬ 8 ç«  MPI çš„åŸºç¡€</li>
<li>OpenMPI å®˜ç½‘: <a target="_blank" rel="noopener" href="https://www.open-mpi.org/">https://www.open-mpi.org/</a></li>
<li>ä¸‹è½½åœ°å€: <a target="_blank" rel="noopener" href="https://www.open-mpi.org/software/ompi/v4.1/">https://www.open-mpi.org/software/ompi/v4.1/</a></li>
<li>å®‰è£…æ–‡æ¡£: <a target="_blank" rel="noopener" href="https://www.open-mpi.org/faq/?category=building#easy-build">https://www.open-mpi.org/faq/?category=building#easy-build</a></li>
</ul>
<hr>
<p>EOF</p>

  </div>
</article>
<!--Disqus-->


<!--Livere-->

    <div class="blog-post-comments">
        <div id="lv-container" data-id="city" data-uid="MTAyMC80NjEzMi8yMjY0Mw==">
            <noscript>ä¸å¯ç”¨ JavaScript æ”¯æŒçš„äººæ˜¯çœ‹ä¸åˆ°å¯çˆ±çš„è¯„è®ºåŒºçš„ã€‚ğŸ˜¥</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">é¦–é¡µ</a></li>
         
          <li><a href="/about/">å…³äº</a></li>
         
          <li><a href="/archives/">å½’æ¡£</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/cdfmlr">é¡¹ç›®</a></li>
         
          <li><a href="/search/">æœç´¢</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MPI"><span class="toc-number">1.</span> <span class="toc-text">MPI</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.1.</span> <span class="toc-text">å®‰è£…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MPI-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.</span> <span class="toc-text">MPI åŸºæœ¬å‘½ä»¤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hello-World"><span class="toc-number">1.3.</span> <span class="toc-text">Hello World</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E4%BF%A1%E5%99%A8"><span class="toc-number">1.4.</span> <span class="toc-text">é€šä¿¡å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#size-amp-rank"><span class="toc-number">1.4.1.</span> <span class="toc-text">size &amp; rank</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%82%B9%E5%AF%B9%E7%82%B9%E6%B6%88%E6%81%AF"><span class="toc-number">1.5.</span> <span class="toc-text">ç‚¹å¯¹ç‚¹æ¶ˆæ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E9%80%81"><span class="toc-number">1.5.1.</span> <span class="toc-text">å‘é€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E6%94%B6"><span class="toc-number">1.5.2.</span> <span class="toc-text">æ¥æ”¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90"><span class="toc-number">1.5.3.</span> <span class="toc-text">ä¾‹å­</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E9%80%9A%E4%BF%A1"><span class="toc-number">1.6.</span> <span class="toc-text">èšåˆé€šä¿¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8C%E6%AD%A5%EF%BC%9ABarrier"><span class="toc-number">1.6.1.</span> <span class="toc-text">åŒæ­¥ï¼šBarrier</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%BF%E6%92%AD%EF%BC%9ABcast"><span class="toc-number">1.6.2.</span> <span class="toc-text">å¹¿æ’­ï¼šBcast</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%95%A3%EF%BC%9AScatter"><span class="toc-number">1.6.3.</span> <span class="toc-text">åˆ†æ•£ï¼šScatter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B6%E9%9B%86%EF%BC%9AGather"><span class="toc-number">1.6.4.</span> <span class="toc-text">æ”¶é›†ï¼šGather</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E6%94%B6%E9%9B%86%EF%BC%9AAllgather"><span class="toc-number">1.6.5.</span> <span class="toc-text">å…¨å±€æ”¶é›†ï¼šAllgather</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E7%BA%A6%EF%BC%9AReduce"><span class="toc-number">1.6.6.</span> <span class="toc-text">è§„çº¦ï¼šReduce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E8%A7%84%E7%BA%A6%EF%BC%9AAllreduce"><span class="toc-number">1.6.7.</span> <span class="toc-text">å…¨å±€è§„çº¦ï¼šAllreduce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%88%B0%E5%85%A8%E5%B1%80%EF%BC%9AAlltoall"><span class="toc-number">1.6.8.</span> <span class="toc-text">å…¨å±€åˆ°å…¨å±€ï¼šAlltoall</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9E%E9%98%BB%E5%A1%9E%E9%80%9A%E4%BF%A1"><span class="toc-number">1.7.</span> <span class="toc-text">éé˜»å¡é€šä¿¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.8.</span> <span class="toc-text">è‡ªå®šä¹‰æ•°æ®ç±»å‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="toc-number">1.9.</span> <span class="toc-text">å‚è€ƒæ–‡çŒ®</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://clownote.github.io/2022/12/01/pd/MPI/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://clownote.github.io/2022/12/01/pd/MPI/&text=MPI"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://clownote.github.io/2022/12/01/pd/MPI/&title=MPI"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://clownote.github.io/2022/12/01/pd/MPI/&is_video=false&description=MPI"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=MPI&body=Check out this article: https://clownote.github.io/2022/12/01/pd/MPI/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://clownote.github.io/2022/12/01/pd/MPI/&title=MPI"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://clownote.github.io/2022/12/01/pd/MPI/&title=MPI"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://clownote.github.io/2022/12/01/pd/MPI/&title=MPI"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://clownote.github.io/2022/12/01/pd/MPI/&title=MPI"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://clownote.github.io/2022/12/01/pd/MPI/&name=MPI&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> èœå•</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> ç›®å½•</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> åˆ†äº«</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> è¿”å›é¡¶éƒ¨</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2022 CDFMLR
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">é¦–é¡µ</a></li>
         
          <li><a href="/about/">å…³äº</a></li>
         
          <li><a href="/archives/">å½’æ¡£</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/cdfmlr">é¡¹ç›®</a></li>
         
          <li><a href="/search/">æœç´¢</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"å¤åˆ¶åˆ°ç²˜è´´æ¿!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight .code pre").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "å¤åˆ¶æˆåŠŸ!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-146911386-1', 'auto');
        ga('send', 'pageview');
    </script>
    
    <!-- New: global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-146911386-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-146911386-1');
    </script>
    

<!-- Baidu Analytics -->

    <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?9a0d2e6fde93dad496ac79f04f3aba97";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

<!-- Disqus Comments -->


<!--Livere Comments-->

    <script type="text/javascript">
      (function (d, s) {
        var j, e = d.getElementsByTagName(s)[0];

        if (typeof LivereTower === 'function') { return; }

        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;

        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>


</body>
</html>
